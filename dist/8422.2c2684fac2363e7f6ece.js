"use strict";(self.webpackChunktelegram_t=self.webpackChunktelegram_t||[]).push([[8422],{27225:(t,e,a)=>{a.d(e,{Co:()=>F,X9:()=>B,ft:()=>_});var i=a(33555),s=a(6137),d=a(91713),o=a(83716),n=a(92387),r=a(60298),c=a(7054),l=a(60782),h=a(69118),u=a(48670),I=a(53551),p=a(78958),f=a(42431),V=a(16974),w=a(59692),g=a(9211),C=a(44271),b=a(65054),m=a(18629);const y={id:o.awM,accessHash:"0",type:"userTypeRegular",isMin:!0,phoneNumber:""},v=new Set(["FILTERS_TOO_MUCH","CHATLISTS_TOO_MUCH","INVITES_TOO_MUCH"]),R=(0,h.P2)((t=>t()),3e3,!0),A=(0,h.Ds)((t=>t()),500,!1,!0);async function M(t,e,a){let d=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=arguments.length>4?arguments[4]:void 0,u=(0,i.Rd)(),I=(0,c.VFo)(u)?.message;const p=await(0,n.t9)("fetchChats",{limit:o.Ov0,offsetDate:a,archived:"archived"===t,withPinned:d,lastLocalServiceMessage:I});if(!p)return;const{chatIds:f}=p;if(f.length>0&&f[0]===e&&f.shift(),u=(0,i.Rd)(),I=(0,c.VFo)(u)?.message,d&&"active"===t){if(!f.includes(o.awM)){const t=await(0,n.t9)("fetchChat",{type:"user",user:y});u=(0,i.Rd)();const e=t&&(0,c.Z1J)(u,t.chatId);e&&(f.unshift(e.id),p.chats.unshift(e),I&&(e.lastMessage=I))}const e=Object.values(u.byTabId),a=e.flatMap((t=>{let{id:e}=t;const a=(0,c.jrE)(u,e);return a?[a]:[]})),s=e.flatMap((t=>{let{id:e}=t;return(0,c.P2Q)(u,e)||[]}));u.currentUserId&&u.users.byId[u.currentUserId]&&s.push(u.users.byId[u.currentUserId]),u=(0,r.s5)(u,(0,l.ee)(s.concat(p.users),"id")),u=(0,r.ps)(u,p.userStatusesById),u=(0,r.SL)(u,(0,l.ee)(a.concat(p.chats),"id")),u=(0,r.Mg)(u,t,f)}else if(d&&"archived"===t)u=(0,r.Sh)(u,(0,l.ee)(p.users,"id")),u=(0,r.zn)(u,p.userStatusesById),u=(0,r.GL)(u,(0,l.ee)(p.chats,"id")),u=(0,r.Mg)(u,t,f);else{const e=(0,l.ee)(p.chats,"id");if(f.includes(o.awM)){const t=e[o.awM];t&&I&&(e[o.awM]={...t,lastMessage:I})}u=(0,r.Sh)(u,(0,l.ee)(p.users,"id")),u=(0,r.zn)(u,p.userStatusesById),u=(0,r.GL)(u,e),u=(0,r.B1)(u,t,f)}u=(0,r.vv)(u,t,p);const V=h?p.chatIds:Object.keys(p.draftsById);V.forEach((t=>{const e=p.draftsById[t],a=(0,c.cii)(u,t,s._f);(e||a)&&((0,c.Mst)(u,t,s._f)?.isLocal||(u=(0,r.pf)(u,t,s._f,"draft",e)))}));const w=h?p.chatIds:Object.keys(p.replyingToById);w.forEach((t=>{const e=p.replyingToById[t],a=(0,c.cii)(u,t,s._f);(e||a)&&(u=(0,r.pf)(u,t,s._f,"replyingToId",e))})),0!==f.length||u.chats.isFullyLoaded[t]||(u={...u,chats:{...u.chats,isFullyLoaded:{...u.chats.isFullyLoaded,[t]:!0}}}),(0,i.R3)(u)}async function _(t,e,a){for(var s=arguments.length,d=new Array(s>3?s-3:0),o=3;o<s;o++)d[o-3]=arguments[o];let[c=(0,b._w)()]=d;const h=await(0,n.t9)("fetchFullChat",a);if(!h)return;const{users:u,userStatusesById:I,fullInfo:V,groupCall:w,membersCount:g}=h;if(t=(0,i.Rd)(),u&&(t=(0,r.Sh)(t,(0,l.ee)(u,"id"))),I&&(t=(0,r.zn)(t,I)),w){const e=(0,f.$5)(t,w.id);t=(0,p.AH)(t,w.id,(0,l.CE)(w,["connectionState","isLoaded"]),void 0,e?void 0:w.participantsCount)}void 0!==g&&(t=(0,r.a4)(t,a.id,{membersCount:g})),t=(0,r.FK)(t,a.id,V),(0,i.R3)(t);const C=V.stickerSet;return C&&e.loadStickers({stickerSetInfo:{id:C.id,accessHash:C.accessHash},tabId:c}),h}async function S(t,e,a){for(var i=arguments.length,s=new Array(i>3?i-3:0),d=3;d<i;d++)s[d-3]=arguments[d];let[o=(0,b._w)()]=s;try{return await(0,n.t9)("migrateChat",a)}catch(t){return void("CHANNELS_TOO_MUCH"===t.message?e.openLimitReachedModal({limit:"channels",tabId:o}):e.showDialog({data:{...t,hasErrorKey:!0},tabId:o}))}}async function F(t,e){t=(0,i.Rd)();const a=(0,c.DIA)(t,e);if(a&&!a.isMin)return a;const{chat:s,user:d}=await(0,n.t9)("getChatByUsername",e)||{};return s?(t=(0,i.Rd)(),t=(0,r.a4)(t,s.id,s),d&&(t=(0,r.Nq)(t,d.id,d)),(0,i.R3)(t),s):void 0}async function T(t,e,a){for(var s=arguments.length,d=new Array(s>3?s-3:0),o=3;o<s;o++)d[o-3]=arguments[o];let[h=(0,b._w)()]=d;const I=await F(t,a);if(!I)return;t=(0,i.Rd)();const p=(0,c.dyD)(t,I.id);if(!p)return;const f=(0,u.cS)(p);if(!f)return;const V=await(0,n.t9)("loadAttachBot",{bot:p});if(t=(0,i.Rd)(),V)return t=(0,r.Sh)(t,(0,l.ee)(V.users,"id")),(0,i.R3)(t),V.bot;e.showNotification({message:w.Iu("WebApp.AddToAttachmentUnavailableError"),tabId:h})}async function P(t,e,a,s,d){for(var o=arguments.length,n=new Array(o>5?o-5:0),r=5;r<o;r++)n[r-5]=arguments[r];let[c=(0,b._w)()]=n;t=(0,i.Rd)();const l=await T(t,e,s,c);l&&e.callAttachBot({bot:l,chatId:a,..."string"==typeof d&&{startParam:d},tabId:c})}async function B(t,e,a){for(var i=arguments.length,s=new Array(i>3?i-3:0),d=3;d<i;d++)s[d-3]=arguments[d];let[o=(0,b._w)()]=s;const n=(0,c.Z1J)(t,a);if(!n||!(0,u.G9)(n))return n;const r=await S(t,e,n,o);return r?(e.loadFullChat({chatId:r.id,tabId:o}),e.openChat({id:r.id,tabId:o}),r):void 0}(0,i.iw)("preloadTopChatMessages",(async(t,e)=>{const a=new Set;for(let d=0;d<o.ulj;d++){await(0,h.wO)(100),t=(0,i.Rd)();const d=Object.values(t.byTabId).map((e=>{let{id:a}=e;return(0,c.Btg)(t,a)?.chatId})).filter(Boolean),n=(0,V.gO)(o.NfV)?.find((t=>!d.includes(t)&&!a.has(t)));if(!n)return;a.add(n),e.loadViewportMessages({chatId:n,threadId:s._f,tabId:(0,b._w)()})}})),(0,i.iw)("openChat",((t,e,a)=>{const{id:i,threadId:d=s._f,noRequestThreadInfoUpdate:o,tabId:r=(0,b._w)()}=a,l=(0,c.Btg)(t,r),h=l?.chatId,I=l?.threadId;if(h&&(h!==i||I!==d)){const[e,a]=Object.values(t.byTabId).reduce(((e,a)=>{let[i,s]=e,{id:d}=a;if(d===r||i&&s)return[i,s];const o=(0,c.Btg)(t,d),n=o?.chatId===h;return[i||n,s||n&&o?.threadId===I]}),[h===i,!1]);(!e||!a)&&(0,n.t9)("abortChatRequests",{chatId:h,threadId:e?I:void 0})}if(!i)return;const{currentUserId:p}=t,f=(0,c.Z1J)(t,i);if(f?.hasUnreadMark&&e.toggleChatUnread({id:i}),f)(0,u.Hp)(f)&&!f.isMin&&e.requestChatUpdate({chatId:i});else if(i===p)(0,n.t9)("fetchChat",{type:"self"});else{const e=(0,c.dyD)(t,i);e&&(0,n.t9)("fetchChat",{type:"user",user:e})}e.closeStoryViewer({tabId:r}),d===s._f||o||e.requestThreadInfoUpdate({chatId:i,threadId:d})})),(0,i.iw)("openComments",(async(t,e,a)=>{const{id:d,threadId:o,originChannelId:h,tabId:u=(0,b._w)()}=a;if(o!==s._f){const a=(0,c.qSq)(t,d,o);if(a)e.openChat({id:d,threadId:a,tabId:u,noRequestThreadInfoUpdate:!0});else{const a=(0,c.CmE)(t,d,o);if(!a)return;e.openChat({id:d,threadId:o,tabId:u,noRequestThreadInfoUpdate:!0});const s=await(0,n.t9)("requestThreadInfoUpdate",{chat:a,threadId:o,originChannelId:h});if(!s)return void e.openPreviousChat({tabId:u});t=(0,i.Rd)(),t=(0,r.Sh)(t,(0,l.ee)(s.users,"id")),(0,i.R3)(t),e.openChat({id:d,threadId:s.topMessageId,tabId:u,shouldReplaceLast:!0,noRequestThreadInfoUpdate:!0})}}})),(0,i.iw)("openLinkedChat",(async(t,e,a)=>{const{id:i,tabId:s=(0,b._w)()}=a,d=(0,c.Z1J)(t,i);if(!d)return;const o=await(0,n.t9)("fetchFullChat",d);o?.fullInfo?.linkedChatId&&e.openChat({id:o.fullInfo.linkedChatId,tabId:s})})),(0,i.iw)("focusMessageInComments",(async(t,e,a)=>{const{chatId:s,threadId:d,messageId:o,tabId:h=(0,b._w)()}=a,u=(0,c.Z1J)(t,s);if(!u)return;const I=await(0,n.t9)("requestThreadInfoUpdate",{chat:u,threadId:d});I&&(t=(0,i.Rd)(),t=(0,r.Sh)(t,(0,l.ee)(I.users,"id")),(0,i.R3)(t),e.focusMessage({chatId:s,threadId:d,messageId:o,tabId:h}))})),(0,i.iw)("openSupportChat",(async(t,e,a)=>{const{tabId:i=(0,b._w)()}=a||{},s=(0,c.P_p)(t);if(s)return void e.openChat({id:s.id,shouldReplaceHistory:!0,tabId:i});e.openChat({id:o.mzl,shouldReplaceHistory:!0,tabId:i});const d=await(0,n.t9)("fetchChat",{type:"support"});d&&e.openChat({id:d.chatId,shouldReplaceHistory:!0,tabId:i})})),(0,i.iw)("loadAllChats",(async(t,e,a)=>{const s=a.listType,{onReplace:d}=a;let{shouldReplace:n}=a,r=0;const l=t=>t.lastMessage?.date||t.joinDate;for(;n||!t.chats.isFullyLoaded[s];){if(r++>=100)return void(o.eMD&&console.error("`actions/loadAllChats`: Infinite loop detected"));if("connectionStateReady"!==(t=(0,i.Rd)()).connectionState||"authorizationStateReady"!==t.authState)return;const e=!n&&t.chats.listIds[s],a=e?e.map((e=>t.chats.byId[e])).filter((e=>Boolean(e&&l(e))&&e.id!==o.awM&&!(0,c.epB)(t,e.id))).sort(((t,e)=>l(t)-l(e)))[0]:void 0;await M(s,a?.id,a?l(a):void 0,n,!0),n&&(d?.(),n=!1),t=(0,i.Rd)()}})),(0,i.iw)("loadFullChat",((t,e,a)=>{const{chatId:i,force:s,tabId:d=(0,b._w)()}=a,o=(0,c.Z1J)(t,i);o&&(s?_(t,e,o,d):A((()=>_(t,e,o,d))))})),(0,i.iw)("loadTopChats",(()=>{R((()=>{M("active"),M("archived")}))})),(0,i.iw)("requestChatUpdate",((t,e,a)=>{const{chatId:i}=a,s=(0,c.Z1J)(t,i);s&&(0,n.t9)("requestChatUpdate",{chat:s,...i===o.awM&&{lastLocalMessage:(0,c.VFo)(t)?.message}})})),(0,i.iw)("updateChatMutedState",((t,e,a)=>{var s;const{chatId:d,muteUntil:o=0}=a,l=(0,c.Z1J)(t,d);if(!l)return;const h=null!==(s=a.isMuted)&&void 0!==s?s:o>0;t=(0,r.a4)(t,d,{isMuted:h}),(0,i.R3)(t),(0,n.t9)("updateChatMutedState",{chat:l,isMuted:h,muteUntil:o})})),(0,i.iw)("updateTopicMutedState",((t,e,a)=>{var s;const{chatId:d,topicId:o,muteUntil:l=0}=a,h=(0,c.Z1J)(t,d);if(!h)return;const u=null!==(s=a.isMuted)&&void 0!==s?s:l>0;t=(0,r.Cn)(t,d,o,{isMuted:u}),(0,i.R3)(t),(0,n.t9)("updateTopicMutedState",{chat:h,topicId:o,isMuted:u,muteUntil:l})})),(0,i.iw)("createChannel",(async(t,e,a)=>{const{title:s,about:o,photo:l,memberIds:h,tabId:u=(0,b._w)()}=a,I=h.map((e=>(0,c.dyD)(t,e))).filter(Boolean);let p;t=(0,C.i)(t,{chatCreation:{progress:d.Nh.InProgress}},u),(0,i.R3)(t);try{p=await(0,n.t9)("createChannel",{title:s,about:o,users:I})}catch(a){t=(0,i.Rd)(),t=(0,C.i)(t,{chatCreation:{progress:d.Nh.Error}},u),(0,i.R3)(t),"CHANNELS_TOO_MUCH"===a.message?e.openLimitReachedModal({limit:"channels",tabId:u}):e.showDialog({data:{...a,hasErrorKey:!0},tabId:u})}if(!p)return;const{id:f,accessHash:V}=p;t=(0,i.Rd)(),t=(0,r.a4)(t,f,p),t=(0,C.i)(t,{chatCreation:{...(0,c.jUK)(t,u).chatCreation,progress:p?d.Nh.Complete:d.Nh.Error}},u),(0,i.R3)(t),e.openChat({id:f,shouldReplaceHistory:!0,tabId:u}),f&&V&&l&&await(0,n.t9)("editChatPhoto",{chatId:f,accessHash:V,photo:l})})),(0,i.iw)("joinChannel",(async(t,e,a)=>{const{chatId:i,tabId:s=(0,b._w)()}=a,d=(0,c.Z1J)(t,i);if(!d)return;const{id:o,accessHash:r}=d;if(o&&r)try{await(0,n.t9)("joinChannel",{channelId:o,accessHash:r})}catch(t){"CHANNELS_TOO_MUCH"===t.message?e.openLimitReachedModal({limit:"channels",tabId:s}):e.showDialog({data:{...t,hasErrorKey:!0},tabId:s})}})),(0,i.iw)("deleteChatUser",((t,e,a)=>{const{chatId:s,userId:d,tabId:o=(0,b._w)()}=a,l=(0,c.Z1J)(t,s),h=(0,c.dyD)(t,d);l&&h&&(t=(0,r.Dd)(t,s),(0,i.R3)(t),(0,c.Btg)(t,o)?.chatId===s&&e.openChat({id:void 0,tabId:o}),(0,n.t9)("deleteChatUser",{chat:l,user:h}))})),(0,i.iw)("deleteChat",((t,e,a)=>{const{chatId:s,tabId:d=(0,b._w)()}=a,o=(0,c.Z1J)(t,s);o&&(t=(0,r.Dd)(t,s),(0,i.R3)(t),(0,c.Btg)(t,d)?.chatId===s&&e.openChat({id:void 0,tabId:d}),(0,n.t9)("deleteChat",{chatId:o.id}))})),(0,i.iw)("leaveChannel",((t,e,a)=>{const{chatId:s,tabId:d=(0,b._w)()}=a,o=(0,c.Z1J)(t,s);if(!o)return;t=(0,r.Dd)(t,s),(0,i.R3)(t),(0,c.Btg)(t,d)?.chatId===s&&e.openChat({id:void 0,tabId:d});const{id:l,accessHash:h}=o;l&&h&&(0,n.t9)("leaveChannel",{channelId:l,accessHash:h})})),(0,i.iw)("deleteChannel",((t,e,a)=>{const{chatId:s,tabId:d=(0,b._w)()}=a,o=(0,c.Z1J)(t,s);if(!o)return;t=(0,r.Dd)(t,s),(0,i.R3)(t),(0,c.Btg)(t,d)?.chatId===s&&e.openChat({id:void 0,tabId:d});const{id:l,accessHash:h}=o;l&&h&&(0,n.t9)("deleteChannel",{channelId:l,accessHash:h})})),(0,i.iw)("createGroupChat",(async(t,e,a)=>{const{title:s,memberIds:o,photo:l,tabId:h=(0,b._w)()}=a,u=o.map((e=>(0,c.dyD)(t,e))).filter(Boolean);t=(0,C.i)(t,{chatCreation:{progress:d.Nh.InProgress}},h),(0,i.R3)(t);try{const a=await(0,n.t9)("createGroupChat",{title:s,users:u});if(!a)return;const{id:o}=a;t=(0,i.Rd)(),t=(0,r.a4)(t,o,a),t=(0,C.i)(t,{chatCreation:{...(0,c.jUK)(t,h).chatCreation,progress:a?d.Nh.Complete:d.Nh.Error}},h),(0,i.R3)(t),e.openChat({id:o,shouldReplaceHistory:!0,tabId:h}),o&&l&&await(0,n.t9)("editChatPhoto",{chatId:o,photo:l})}catch(e){"USERS_TOO_FEW"===e.message&&(t=(0,i.Rd)(),t=(0,C.i)(t,{chatCreation:{...(0,c.jUK)(t,h).chatCreation,progress:d.Nh.Error,error:"CreateGroupError"}},h),(0,i.R3)(t))}})),(0,i.iw)("toggleChatPinned",((t,e,a)=>{const{id:i,folderId:s,tabId:d=(0,b._w)()}=a,r=(0,c.Z1J)(t,i);if(!r)return;const l=(0,g.M)(t,"dialogFolderPinned");if(s){const e=(0,c.MwT)(t,s);if(e){const a=!(0,c.epB)(t,i,s),{pinnedChatIds:d,includedChatIds:o}=e,r=a?[i,...d||[]]:(d||[]).filter((t=>t!==i)),l=[i,...o];(0,n.t9)("editChatFolder",{id:s,folderUpdate:{...e,pinnedChatIds:r,includedChatIds:l}})}}else{const a=(0,c.EkO)(t,i),s=(0,c.epB)(t,i,"archived"===a?o.WSp:void 0);if((t.chats.orderedPinnedIds["archived"===a?"archived":"active"]?.length||0)>=l&&!s)return void e.openLimitReachedModal({limit:"dialogFolderPinned",tabId:d});(0,n.t9)("toggleChatPinned",{chat:r,shouldBePinned:!s})}})),(0,i.iw)("toggleChatArchived",((t,e,a)=>{const{id:i}=a,s=(0,c.Z1J)(t,i);s&&(0,n.t9)("toggleChatArchived",{chat:s,folderId:(0,u.pE)(s)?0:o.WSp})})),(0,i.iw)("loadChatFolders",(async t=>{const e=await(0,n.t9)("fetchChatFolders");e&&(t=(0,i.Rd)(),t={...t,chatFolders:{...t.chatFolders,...e}},(0,i.R3)(t))})),(0,i.iw)("loadRecommendedChatFolders",(async t=>{const e=await(0,n.t9)("fetchRecommendedChatFolders");e&&(t=(0,i.Rd)(),t={...t,chatFolders:{...t.chatFolders,recommended:e}},(0,i.R3)(t))})),(0,i.iw)("editChatFolders",((t,e,a)=>{const{chatId:i,idsToRemove:s,idsToAdd:d,tabId:o=(0,b._w)()}=a,r=(0,g.M)(t,"dialogFiltersChats");d.some((e=>(0,c.MwT)(t,e).includedChatIds.length>=r))?e.openLimitReachedModal({limit:"dialogFiltersChats",tabId:o}):(s.forEach((async e=>{const a=(0,c.MwT)(t,e);a&&await(0,n.t9)("editChatFolder",{id:e,folderUpdate:{...a,pinnedChatIds:a.pinnedChatIds?.filter((t=>t!==i)),includedChatIds:a.includedChatIds.filter((t=>t!==i))}})})),d.forEach((async e=>{const a=(0,c.MwT)(t,e);a&&await(0,n.t9)("editChatFolder",{id:e,folderUpdate:{...a,includedChatIds:a.includedChatIds.concat(i)}})})))})),(0,i.iw)("editChatFolder",((t,e,a)=>{const{id:i,folderUpdate:s}=a,d=(0,c.MwT)(t,i);d&&(0,n.t9)("editChatFolder",{id:i,folderUpdate:{id:i,emoticon:d.emoticon,pinnedChatIds:d.pinnedChatIds,...s}})})),(0,i.iw)("addChatFolder",(async(t,e,a)=>{const{folder:s,tabId:d=(0,b._w)()}=a,{orderedIds:r,byId:c}=t.chatFolders,l=(0,g.M)(t,"dialogFilters");if(Object.keys(c).length>=l)return void e.openLimitReachedModal({limit:"dialogFilters",tabId:d});const h=Math.max(...r||[],o.WSp),{id:u,description:I,...p}=s,f=h+1,V={id:f,...p};if(await(0,n.t9)("editChatFolder",{id:f,folderUpdate:V}),e.apiUpdate({"@type":"updateChatFolder",id:f,folder:V}),e.requestNextSettingsScreen({foldersAction:{type:"setFolderId",payload:h+1},tabId:d}),!I)return;t=(0,i.Rd)();const{recommended:w}=t.chatFolders;w&&(t={...t,chatFolders:{...t.chatFolders,recommended:w.filter((t=>{let{id:e}=t;return e!==u}))}},(0,i.R3)(t))})),(0,i.iw)("sortChatFolders",(async(t,e,a)=>{const{folderIds:s}=a;await(0,n.t9)("sortChatFolders",s)&&(t=(0,i.Rd)(),t={...t,chatFolders:{...t.chatFolders,orderedIds:s}},(0,i.R3)(t))})),(0,i.iw)("deleteChatFolder",(async(t,e,a)=>{const{id:i}=a;(0,c.MwT)(t,i)&&await(0,n.t9)("deleteChatFolder",i)})),(0,i.iw)("toggleChatUnread",((t,e,a)=>{const{id:i}=a,d=(0,c.Z1J)(t,i);d&&(d.unreadCount?(0,n.t9)("markMessageListRead",{chat:d,threadId:s._f}):(0,n.t9)("toggleDialogUnread",{chat:d,hasUnreadMark:!d.hasUnreadMark}))})),(0,i.iw)("markTopicRead",((t,e,a)=>{const{chatId:s,topicId:d}=a,o=(0,c.Z1J)(t,s);if(!o)return;const l=o.topics?.[d]?.lastMessageId;l&&((0,n.t9)("markMessageListRead",{chat:o,threadId:d,maxId:l}),t=(0,i.Rd)(),t=(0,r.Cn)(t,s,d,{unreadCount:0}),t=(0,r.Xg)(t,s,d,{lastReadInboxMessageId:l}),(0,i.R3)(t))})),(0,i.iw)("openChatByInvite",(async(t,e,a)=>{const{hash:i,tabId:s=(0,b._w)()}=a,d=await(0,n.t9)("openChatByInvite",i);d&&e.openChat({id:d.chatId,tabId:s})})),(0,i.iw)("openChatByPhoneNumber",(async(t,e,a)=>{const{phoneNumber:s,startAttach:d,attach:l,tabId:h=(0,b._w)()}=a;e.openChat({id:o.mzl,tabId:h});const u=await async function(t,e){t=(0,i.Rd)();const a=(0,c.Bki)(t,e);if(a&&!a.isMin)return(0,c.Z1J)(t,a.id);const{chat:s,user:d}=await(0,n.t9)("getChatByPhoneNumber",e)||{};return s?(t=(0,i.Rd)(),t=(0,r.a4)(t,s.id,s),(0,i.R3)(t),d&&(t=(0,r.Nq)(t,d.id,d),(0,i.R3)(t)),s):void 0}(t,s);if(!u)return e.openPreviousChat({tabId:h}),void e.showNotification({message:w.Iu("lng_username_by_phone_not_found").replace("{phone}",s),tabId:h});e.openChat({id:u.id,tabId:h}),l&&P(t=(0,i.Rd)(),e,u.id,l,d,h)})),(0,i.iw)("openTelegramLink",((t,e,a)=>{const{url:i,tabId:s=(0,b._w)()}=a,{openChatByPhoneNumber:d,openChatByInvite:n,openStickerSet:r,openChatWithDraft:l,joinVoiceChatByLink:h,showNotification:u,focusMessage:p,openInvoice:f,processAttachBotParameters:V,checkChatlistInvite:w,openChatByUsername:g,openStoryViewerByUsername:C}=e;if(i.match(o.g$l))return void(0,I.ou)(i);const m=new URL(i.toLowerCase().startsWith("http")?i:`https://${i}`);if(o.LBg.has(m.hostname)&&"/"===m.pathname)return void window.open(m.toString(),"_blank","noopener");const y=(o.LBg.has(m.hostname)?"t.me":m.hostname).split(".");if(y.length>3)return;const v=3===y.length?`${y[0]}/${m.pathname}`:m.pathname,[R,A,M]=v.split("/").filter(Boolean).map((t=>decodeURI(t))),_=Object.fromEntries(m.searchParams);let S;"joinchat"===R&&(S=A);const F=!(!_.hasOwnProperty("startattach")||_.startattach)||_.startattach,T=(0,I.GX)(_.choose),P="s"===A&&(Number(M)||void 0);if(R.match(/^\+([0-9]+)(\?|$)/))return void d({phoneNumber:R.substr(1,R.length-1),startAttach:F,attach:_.attach,tabId:s});if(P)return void C({username:R,storyId:P,tabId:s});if((R.startsWith(" ")||R.startsWith("+"))&&(S=R.substr(1,R.length-1)),S)return void n({hash:S,tabId:s});if("addstickers"===R||"addemoji"===R)return void r({stickerSetInfo:{shortName:A},tabId:s});if("share"===R)return void l({text:(0,I.QH)(_.url,_.text),tabId:s});if("addlist"===R)return void w({slug:A,tabId:s});const B=A||void 0,U=M?Number(M):void 0,H=_.comment?Number(_.comment):void 0;if(_.hasOwnProperty("voicechat")||_.hasOwnProperty("livestream"))h({username:R,inviteHash:_.voicechat||_.livestream,tabId:s});else if("c"===R&&B&&U){const e=`-${B}`;if(!(0,c.Z1J)(t,e))return void u({message:"Chat does not exist",tabId:s});p({chatId:e,messageId:U,tabId:s})}else R.startsWith("$")?f({slug:R.substring(1),tabId:s}):"invoice"===R?f({slug:A,tabId:s}):F&&T?V({username:R,filter:T,..."string"==typeof F&&{startParam:F},tabId:s}):g({username:R,messageId:U||Number(B),threadId:U?Number(B):void 0,commentId:H,startParam:_.start,startAttach:F,attach:_.attach,startApp:_.startapp,originalParts:[R,A,M],tabId:s})})),(0,i.iw)("acceptInviteConfirmation",(async(t,e,a)=>{const{hash:i,tabId:s=(0,b._w)()}=a,d=await(0,n.t9)("importChatInvite",{hash:i});d&&e.openChat({id:d.id,tabId:s})})),(0,i.iw)("openChatByUsername",(async(t,e,a)=>{const{username:s,messageId:d,commentId:h,startParam:u,startAttach:I,attach:p,threadId:f,originalParts:V,startApp:w,tabId:g=(0,b._w)()}=a,C=(0,c.jrE)(t,g),y=V?.[1],v=y&&!Number(y)&&!V?.[2];if(!h){if(!I&&d&&!u&&C?.usernames?.some((t=>t.username===s)))return void e.focusMessage({chatId:C.id,threadId:f,messageId:d,tabId:g});if(!v)return void await async function(t,e,a,s,d,n,r,l){for(var h=arguments.length,u=new Array(h>8?h-8:0),I=8;I<h;I++)u[I-8]=arguments[I];let[p=(0,b._w)()]=u;t=(0,i.Rd)();const f=(0,c.jrE)(t,p);if(r&&!l){const i=await T(t,e,a,p);if(!f||!i)return;return void e.callAttachBot({bot:i,chatId:f.id,..."string"==typeof r&&{startParam:r},tabId:p})}const V=f?.usernames?.some((t=>t.username===a));V||e.openChat({id:o.mzl,tabId:p});const w=await F(t,a);w?(d?e.focusMessage({chatId:w.id,threadId:s,messageId:d,tabId:p}):V||e.openChat({id:w.id,threadId:s,tabId:p}),n&&e.startBot({botId:w.id,param:n}),l&&P(t=(0,i.Rd)(),e,w.id,l,r,p)):V||(e.openPreviousChat({tabId:p}),e.showNotification({message:"User does not exist",tabId:p}))}(t,e,s,f,d,u,I,p,g)}const{chatId:R,type:A}=(0,c.Btg)(t,g)||{},M=(0,c.DIA)(t,s);if(R&&h&&d&&M&&"thread"===A){const a=(0,c.tZg)(t,R,d);if(a&&a.chatId===R)return void e.focusMessage({chatId:a.chatId,threadId:a.threadId,messageId:h,tabId:g})}v||e.openChat({id:o.mzl,tabId:g});const _=await F(t,s);if(!_)return;if(t=(0,i.Rd)(),v&&_){const t=(0,m.BS)();return void e.requestAppWebView({appName:y,botId:_.id,tabId:g,startApp:w,theme:t})}if(!d)return;const S=(0,c.tZg)(t,_.id,d);let B;if(S)B=S.chatId;else{const e=await(0,n.t9)("requestThreadInfoUpdate",{chat:_,threadId:d});if(!e)return;t=(0,i.Rd)(),t=(0,r.Sh)(t,(0,l.ee)(e.users,"id")),(0,i.R3)(t),B=e.discussionChatId}B&&e.focusMessage({chatId:B,threadId:d,messageId:Number(h),tabId:g})})),(0,i.iw)("togglePreHistoryHidden",(async(t,e,a)=>{const{chatId:s,isEnabled:d,tabId:o=(0,b._w)()}=a,c=await B(t,e,s,o);c&&(t=(0,i.Rd)(),t=(0,r.US)(t,c.id,{isPreHistoryHidden:d}),(0,i.R3)(t),(0,n.t9)("togglePreHistoryHidden",{chat:c,isEnabled:d}))})),(0,i.iw)("updateChatDefaultBannedRights",((t,e,a)=>{const{chatId:i,bannedRights:s}=a,d=(0,c.Z1J)(t,i);d&&(0,n.t9)("updateChatDefaultBannedRights",{chat:d,bannedRights:s})})),(0,i.iw)("updateChatMemberBannedRights",(async(t,e,a)=>{const{chatId:s,userId:d,bannedRights:o,tabId:l=(0,b._w)()}=a,h=(0,c.dyD)(t,d);if(!h)return;const u=await B(t,e,s,l);if(!u)return;await(0,n.t9)("updateChatMemberBannedRights",{chat:u,user:h,bannedRights:o}),t=(0,i.Rd)();const I=(0,c.x67)(t,s);if(!I)return;const{members:p,kickedMembers:f}=I,V=Boolean(o.viewMessages),w=!Object.keys(o).length;t=(0,r.US)(t,s,{...p&&V&&{members:p.filter((t=>t.userId!==d))},...p&&!V&&{members:p.map((t=>t.userId===d?{...t,bannedRights:o}:t))},...w&&f&&{kickedMembers:f.filter((t=>t.userId!==d))}}),(0,i.R3)(t)})),(0,i.iw)("updateChatAdmin",(async(t,e,a)=>{const{chatId:s,userId:d,adminRights:o,customTitle:l,tabId:h=(0,b._w)()}=a,u=(0,c.dyD)(t,d);if(!u)return;const I=await B(t,e,s,h);if(!I)return;await(0,n.t9)("updateChatAdmin",{chat:I,user:u,adminRights:o,customTitle:l});const p=await(0,n.t9)("fetchFullChat",I);if(!p?.fullInfo)return;const{adminMembersById:f}=p.fullInfo,V=!Object.keys(o).length;let w;if(f)if(V){const{[d]:t,...e}=f;w=e}else w={...f,[d]:{...f[d],adminRights:o,customTitle:l}};w&&(t=(0,i.Rd)(),t=(0,r.US)(t,s,{adminMembersById:w}),(0,i.R3)(t))})),(0,i.iw)("updateChat",(async(t,e,a)=>{const{chatId:s,title:o,about:l,photo:h,tabId:u=(0,b._w)()}=a,I=(0,c.Z1J)(t,s),p=(0,c.x67)(t,s);I&&(t=(0,i.Rd)(),t=(0,r.H9)(t,d.wv.InProgress,u),(0,i.R3)(t),await Promise.all([I.title!==o?(0,n.t9)("updateChatTitle",I,o):void 0,p?.about!==l?(0,n.t9)("updateChatAbout",I,l):void 0,h?(0,n.t9)("editChatPhoto",{chatId:s,accessHash:I.accessHash,photo:h}):void 0]),t=(0,i.Rd)(),t=(0,r.H9)(t,d.wv.Complete,u),(0,i.R3)(t))})),(0,i.iw)("updateChatPhoto",(async(t,e,a)=>{const{photo:s,chatId:d,tabId:o=(0,b._w)()}=a,l=(0,c.Z1J)(t,d);l&&(t=(0,r.a4)(t,d,{avatarHash:void 0}),t=(0,r.US)(t,d,{profilePhoto:void 0}),(0,i.R3)(t),await(0,n.t9)("editChatPhoto",{chatId:d,accessHash:l.accessHash,photo:s}),await(0,n.t9)("deleteProfilePhotos",[s]),e.loadFullChat({chatId:d,tabId:o}),e.loadProfilePhotos({profileId:d}))})),(0,i.iw)("deleteChatPhoto",(async(t,e,a)=>{const{photo:s,chatId:d,tabId:o=(0,b._w)()}=a,l=(0,c.Z1J)(t,d);if(!l)return;const h=[s];if(l.avatarHash===s.id){const e=l.photos?.[1];e&&h.push(e),t=(0,r.a4)(t,d,{avatarHash:void 0}),t=(0,r.US)(t,d,{profilePhoto:void 0}),(0,i.R3)(t),await(0,n.t9)("editChatPhoto",{chatId:d,accessHash:l.accessHash,photo:e})}await(0,n.t9)("deleteProfilePhotos",h)&&(e.loadFullChat({chatId:d,tabId:o}),e.loadProfilePhotos({profileId:d}))})),(0,i.iw)("toggleSignatures",((t,e,a)=>{const{chatId:i,isEnabled:s}=a,d=(0,c.Z1J)(t,i);d&&(0,n.t9)("toggleSignatures",{chat:d,isEnabled:s})})),(0,i.iw)("loadGroupsForDiscussion",(async t=>{const e=await(0,n.t9)("fetchGroupsForDiscussion");if(!e)return;const a=e.reduce(((t,e)=>(e&&!e.isForum&&(t[e.id]=e),t)),{});t=(0,i.Rd)(),t=(0,r.fZ)(t,a),t={...t,chats:{...t.chats,forDiscussionIds:Object.keys(a)}},(0,i.R3)(t)})),(0,i.iw)("linkDiscussionGroup",(async(t,e,a)=>{const{channelId:s,chatId:d,tabId:o=(0,b._w)()}=a||{},l=(0,c.Z1J)(t,s);if(!l)return;const h=await B(t,e,d,o);if(!h)return;let u=(0,c.x67)(t,h.id);if(!u){const t=await(0,n.t9)("fetchFullChat",h);if(!t)return;u=t.fullInfo}u.isPreHistoryHidden&&(t=(0,i.Rd)(),t=(0,r.US)(t,h.id,{isPreHistoryHidden:!1}),(0,i.R3)(t),await(0,n.t9)("togglePreHistoryHidden",{chat:h,isEnabled:!1})),(0,n.t9)("setDiscussionGroup",{channel:l,chat:h})})),(0,i.iw)("unlinkDiscussionGroup",(async(t,e,a)=>{const{channelId:s,tabId:d=(0,b._w)()}=a,o=(0,c.Z1J)(t,s);if(!o)return;const r=(0,c.x67)(t,s);let l;r?.linkedChatId&&(l=(0,c.Z1J)(t,r.linkedChatId)),await(0,n.t9)("setDiscussionGroup",{channel:o}),l&&_(t=(0,i.Rd)(),e,l,d)})),(0,i.iw)("setActiveChatFolder",((t,e,a)=>{const{activeChatFolder:i,tabId:s=(0,b._w)()}=a;if(!(i+1>(0,g.M)(t,"dialogFilters")))return(0,C.i)(t,{activeChatFolder:i},s);e.openLimitReachedModal({limit:"dialogFilters",tabId:s})})),(0,i.iw)("resetOpenChatWithDraft",((t,e,a)=>{const{tabId:i=(0,b._w)()}=a||{};return(0,C.i)(t,{requestedDraft:void 0},i)})),(0,i.iw)("loadMoreMembers",(async(t,e,a)=>{const{tabId:s=(0,b._w)()}=a||{},{chatId:d}=(0,c.Btg)(t,s)||{},o=d?(0,c.Z1J)(t,d):void 0;if(!o||(0,u.G9)(o))return;const h=(0,c.x67)(t,o.id)?.members?.length;if(void 0!==h&&void 0!==o.membersCount&&h>=o.membersCount)return;const I=await(0,n.t9)("fetchMembers",o.id,o.accessHash,"recent",h);if(!I)return;const{members:p,users:f,userStatusesById:V}=I;p&&p.length&&(t=(0,i.Rd)(),t=(0,r.Sh)(t,(0,l.ee)(f,"id")),t=(0,r.zn)(t,V),t=(0,r.iX)(t,o,p),(0,i.R3)(t))})),(0,i.iw)("addChatMembers",(async(t,e,a)=>{const{chatId:s,memberIds:o,tabId:r=(0,b._w)()}=a,l=(0,c.Z1J)(t,s),h=o.map((e=>(0,c.dyD)(t,e))).filter(Boolean);l&&h.length&&(e.setNewChatMembersDialogState({newChatMembersProgress:d.WB.Loading,tabId:r}),await(0,n.t9)("addChatMembers",l,h),e.setNewChatMembersDialogState({newChatMembersProgress:d.WB.Closed,tabId:r}),_(t=(0,i.Rd)(),e,l,r))})),(0,i.iw)("deleteChatMember",(async(t,e,a)=>{const{chatId:s,userId:d,tabId:o=(0,b._w)()}=a,r=(0,c.Z1J)(t,s),l=(0,c.dyD)(t,d);r&&l&&(await(0,n.t9)("deleteChatMember",r,l),_(t=(0,i.Rd)(),e,r,o))})),(0,i.iw)("toggleIsProtected",((t,e,a)=>{const{chatId:i,isProtected:s}=a,d=(0,c.Z1J)(t,i);d&&(0,n.t9)("toggleIsProtected",{chat:d,isProtected:s})})),(0,i.iw)("setChatEnabledReactions",(async(t,e,a)=>{const{chatId:s,enabledReactions:d,tabId:o=(0,b._w)()}=a,r=(0,c.Z1J)(t,s);r&&(await(0,n.t9)("setChatEnabledReactions",{chat:r,enabledReactions:d}),_(t=(0,i.Rd)(),e,r,o))})),(0,i.iw)("fetchChat",(async(t,e,a)=>{const{chatId:i}=a;if(!(0,c.Z1J)(t,i))if(i===t.currentUserId)(0,n.t9)("fetchChat",{type:"self"});else{const e=(0,c.dyD)(t,i);e&&(0,n.t9)("fetchChat",{type:"user",user:e})}})),(0,i.iw)("loadChatSettings",(async(t,e,a)=>{const{chatId:s}=a,d=(0,c.Z1J)(t,s);if(!d)return;const o=await(0,n.t9)("fetchChatSettings",d);if(!o)return;const{settings:h,users:u}=o;t=(0,i.Rd)(),t=(0,r.Sh)(t,(0,l.ee)(u,"id")),t=(0,r.a4)(t,d.id,{settings:h}),(0,i.R3)(t)})),(0,i.iw)("toggleJoinToSend",(async(t,e,a)=>{const{chatId:i,isEnabled:s}=a,d=(0,c.Z1J)(t,i);d&&((0,u.ZV)(d)||(0,u.eA)(d))&&await(0,n.t9)("toggleJoinToSend",d,s)})),(0,i.iw)("toggleJoinRequest",(async(t,e,a)=>{const{chatId:i,isEnabled:s}=a,d=(0,c.Z1J)(t,i);d&&((0,u.ZV)(d)||(0,u.eA)(d))&&await(0,n.t9)("toggleJoinRequest",d,s)})),(0,i.iw)("openForumPanel",((t,e,a)=>{const{chatId:i,tabId:s=(0,b._w)()}=a;return e.toggleStoryRibbon({isShown:!1,tabId:s}),e.toggleStoryRibbon({isShown:!1,isArchived:!0,tabId:s}),(0,C.i)(t,{forumPanelChatId:i},s)})),(0,i.iw)("closeForumPanel",((t,e,a)=>{const{tabId:i=(0,b._w)()}=a||{};return(0,C.i)(t,{forumPanelChatId:void 0},i)})),(0,i.iw)("processAttachBotParameters",(async(t,e,a)=>{const{username:s,filter:d,startParam:o,tabId:n=(0,b._w)()}=a,r=await T(t,e,s,n);if(!r)return;t=(0,i.Rd)();const{attachMenu:{bots:c}}=t;if(!c[r.id])return t=(0,C.i)(t,{requestedAttachBotInstall:{bot:r,onConfirm:{action:"requestAttachBotInChat",payload:{bot:r,filter:d,startParam:o}}}},n),void(0,i.R3)(t);e.requestAttachBotInChat({bot:r,filter:d,startParam:o,tabId:n})})),(0,i.iw)("loadTopics",(async(t,e,a)=>{const{chatId:s,force:d}=a,h=(0,c.Z1J)(t,s);if(!h)return;if(!d&&h.listedTopicIds&&h.listedTopicIds.length===h.topicsCount)return;const u=!d&&h.listedTopicIds?h.listedTopicIds.reduce(((t,e)=>{const a=h.topics?.[e],i=h.topics?.[t];return a&&(!i||a.lastMessageId<i.lastMessageId)?e:t})):void 0,{id:I,date:p,lastMessageId:f}=u&&h.topics?.[u]||{},V=await(0,n.t9)("fetchTopics",{chat:h,offsetTopicId:I,offsetId:f,offsetDate:p,limit:I?o.C1M:o.SC4});V&&(t=(0,i.Rd)(),t=(0,r.Sh)(t,(0,l.ee)(V.users,"id")),t=(0,r.fZ)(t,(0,l.ee)(V.chats,"id")),t=(0,r.m6)(t,V.messages),t=(0,r.XG)(t,s,V.count,V.topics),t=(0,r.Jr)(t,s,V.topics.map((t=>t.id))),Object.entries(V.draftsById||{}).forEach((e=>{let[a,i]=e;t=(0,r.pf)(t,s,Number(a),"draft",i?.formattedText),t=(0,r.pf)(t,s,Number(a),"replyingToId",i?.replyingToId)})),Object.entries(V.readInboxMessageIdByTopicId||{}).forEach((e=>{let[a,i]=e;t=(0,r.Xg)(t,s,Number(a),{lastReadInboxMessageId:i})})),(0,i.R3)(t))})),(0,i.iw)("loadTopicById",(async(t,e,a)=>{const{chatId:s,topicId:d}=a,o=(0,c.Z1J)(t,s);if(!o)return;const h=await(0,n.t9)("fetchTopicById",{chat:o,topicId:d});if(h)t=(0,i.Rd)(),t=(0,r.Sh)(t,(0,l.ee)(h.users,"id")),t=(0,r.fZ)(t,(0,l.ee)(h.chats,"id")),t=(0,r.m6)(t,h.messages),t=(0,r.Cn)(t,s,d,h.topic),(0,i.R3)(t);else if("tabId"in a&&a.shouldCloseChatOnError){const{tabId:t=(0,b._w)()}=a;e.openChat({id:void 0,tabId:t})}})),(0,i.iw)("toggleForum",(async(t,e,a)=>{const{chatId:s,isEnabled:d,tabId:o=(0,b._w)()}=a,c=await B(t,e,s,o);if(!c)return;t=(0,i.Rd)();const l=c.isForum;let h;t=(0,r.a4)(t,s,{isForum:d}),(0,i.R3)(t);try{h=await(0,n.t9)("toggleForum",{chat:c,isEnabled:d})}catch(t){t.message.startsWith("A wait of")?e.showNotification({message:w.Iu("FloodWait"),tabId:o}):e.showDialog({data:{...t,hasErrorKey:!0},tabId:o})}h||(t=(0,i.Rd)(),t=(0,r.a4)(t,s,{isForum:l}),(0,i.R3)(t))})),(0,i.iw)("toggleParticipantsHidden",(async(t,e,a)=>{const{chatId:s,isEnabled:d}=a,o=(0,c.Z1J)(t,s);if(!o)return;const l=(0,c.x67)(t,o.id)?.areParticipantsHidden;t=(0,r.US)(t,s,{areParticipantsHidden:d}),(0,i.R3)(t),await(0,n.t9)("toggleParticipantsHidden",{chat:o,isEnabled:d})||void 0===l||(t=(0,i.Rd)(),t=(0,r.US)(t,s,{areParticipantsHidden:l}),(0,i.R3)(t))})),(0,i.iw)("createTopic",(async(t,e,a)=>{const{chatId:s,title:d,iconColor:o,iconEmojiId:r,tabId:l=(0,b._w)()}=a,h=(0,c.Z1J)(t,s);if(!h)return;(0,c.jUK)(t,l).createTopicPanel&&(t=(0,C.i)(t,{createTopicPanel:{chatId:s,isLoading:!0}},l),(0,i.R3)(t));const u=await(0,n.t9)("createTopic",{chat:h,title:d,iconColor:o,iconEmojiId:r});u&&e.openChat({id:s,threadId:u,shouldReplaceHistory:!0,tabId:l}),e.closeCreateTopicPanel({tabId:l})})),(0,i.iw)("deleteTopic",(async(t,e,a)=>{const{chatId:s,topicId:d}=a,o=(0,c.Z1J)(t,s);o&&await(0,n.t9)("deleteTopic",{chat:o,topicId:d})&&(t=(0,i.Rd)(),t=(0,r.BK)(t,s,d),(0,i.R3)(t))})),(0,i.iw)("editTopic",(async(t,e,a)=>{const{chatId:s,topicId:d,tabId:o=(0,b._w)(),...l}=a,h=(0,c.Z1J)(t,s),u=h?.topics?.[d];h&&u&&((0,c.jUK)(t,o).editTopicPanel&&(t=(0,C.i)(t,{editTopicPanel:{chatId:s,topicId:d,isLoading:!0}},o),(0,i.R3)(t)),await(0,n.t9)("editTopic",{chat:h,topicId:d,...l})&&(t=(0,i.Rd)(),t=(0,r.Cn)(t,s,d,l),(0,i.R3)(t),e.closeEditTopicPanel({tabId:o})))})),(0,i.iw)("toggleTopicPinned",((t,e,a)=>{const{chatId:i,topicId:s,isPinned:d,tabId:o=(0,b._w)()}=a,{topicsPinnedLimit:r}=t.appConfig||{},l=(0,c.Z1J)(t,i);l&&l.topics&&r&&(d&&Object.values(l.topics).filter((t=>t.isPinned)).length>=r?e.showNotification({message:w.Iu("LimitReachedPinnedTopics",r,"i"),tabId:o}):(0,n.t9)("togglePinnedTopic",{chat:l,topicId:s,isPinned:d}))})),(0,i.iw)("checkChatlistInvite",(async(t,e,a)=>{const{slug:s,tabId:d=(0,b._w)()}=a,o=await(0,n.t9)("checkChatlistInvite",{slug:s});o?(t=(0,i.Rd)(),t=(0,r.Sh)(t,(0,l.ee)(o.users,"id")),t=(0,r.fZ)(t,(0,l.ee)(o.chats,"id")),t=(0,C.i)(t,{chatlistModal:{invite:o.invite}},d),(0,i.R3)(t)):e.showNotification({message:w.Iu("lng_group_invite_bad_link"),tabId:d})})),(0,i.iw)("joinChatlistInvite",(async(t,e,a)=>{const{invite:i,peerIds:s,tabId:d=(0,b._w)()}=a,o=s.map((e=>(0,c.Z1J)(t,e))).filter(Boolean),r=o.filter((t=>t.isNotJoined)).length,l="folderId"in i?(0,c.MwT)(t,i.folderId):void 0,h="title"in i?i.title:l?.title;try{if(!await(0,n.t9)("joinChatlistInvite",{slug:i.slug,peers:o}))return;e.showNotification({title:w.Iu(l?"FolderLinkUpdatedTitle":"FolderLinkAddedTitle",h),message:w.Iu("FolderLinkAddedSubtitle",r,"i"),tabId:d})}catch(t){"CHATLISTS_TOO_MUCH"===t.message?e.openLimitReachedModal({limit:"chatlistJoined",tabId:d}):e.showDialog({data:{...t,hasErrorKey:!0},tabId:d})}})),(0,i.iw)("leaveChatlist",(async(t,e,a)=>{const{folderId:i,peerIds:s,tabId:d=(0,b._w)()}=a,o=(0,c.MwT)(t,i),r=s?.map((e=>(0,c.Z1J)(t,e))).filter(Boolean)||[];await(0,n.t9)("leaveChatlist",{folderId:i,peers:r})&&e.showNotification({title:w.Iu("FolderLinkDeletedTitle",o.title),message:w.Iu("FolderLinkDeletedSubtitle",r.length,"i"),tabId:d})})),(0,i.iw)("loadChatlistInvites",(async(t,e,a)=>{const{folderId:s}=a,d=await(0,n.t9)("fetchChatlistInvites",{folderId:s});d&&(t=(0,i.Rd)(),t=(0,r.Sh)(t,(0,l.ee)(d.users,"id")),t=(0,r.fZ)(t,(0,l.ee)(d.chats,"id")),t={...t,chatFolders:{...t.chatFolders,invites:{...t.chatFolders.invites,[s]:d.invites}}},(0,i.R3)(t))})),(0,i.iw)("createChatlistInvite",(async(t,e,a)=>{const{folderId:s,tabId:o=(0,b._w)()}=a,r=(0,c.MwT)(t,s);if(!r)return;let l;t=(0,C.i)(t,{shareFolderScreen:{...(0,c.jUK)(t,o).shareFolderScreen,isLoading:!0}},o),(0,i.R3)(t);try{l=await(0,n.t9)("createChalistInvite",{folderId:s,peers:r.includedChatIds.concat(r.pinnedChatIds||[]).map((e=>(0,c.Z1J)(t,e)||(0,c.dyD)(t,e))).filter(Boolean)})}catch(t){v.has(t.message)?(e.openLimitReachedModal({limit:"chatlistInvites",tabId:o}),e.requestNextSettingsScreen({screen:d.MT.Folders,tabId:o})):e.showDialog({data:{...t,hasErrorKey:!0},tabId:o})}if(!l||!l.invite)return;const{shareFolderScreen:h}=(0,c.jUK)(t,o);h&&(t=(0,i.Rd)(),t={...t,chatFolders:{...t.chatFolders,byId:{...t.chatFolders.byId,[s]:{...t.chatFolders.byId[s],...l.filter}},invites:{...t.chatFolders.invites,[s]:[...t.chatFolders.invites[s]||[],l.invite]}}},t=(0,C.i)(t,{shareFolderScreen:{...h,url:l.invite.url,isLoading:!1}},o),(0,i.R3)(t))})),(0,i.iw)("editChatlistInvite",(async(t,e,a)=>{const{folderId:s,peerIds:d,url:o,tabId:r=(0,b._w)()}=a,l=o.split("/").pop();if(!l)return;const h=d.map((e=>(0,c.Z1J)(t,e)||(0,c.dyD)(t,e))).filter(Boolean);t=(0,C.i)(t,{shareFolderScreen:{...(0,c.jUK)(t,r).shareFolderScreen,isLoading:!0}},r),(0,i.R3)(t);try{const e=await(0,n.t9)("editChatlistInvite",{folderId:s,slug:l,peers:h});if(!e)return;t=(0,i.Rd)(),t={...t,chatFolders:{...t.chatFolders,invites:{...t.chatFolders.invites,[s]:t.chatFolders.invites[s]?.map((t=>t.url===o?e:t))}}},(0,i.R3)(t)}catch(t){e.showDialog({data:{...t,hasErrorKey:!0},tabId:r})}finally{t=(0,i.Rd)(),t=(0,C.i)(t,{shareFolderScreen:{...(0,c.jUK)(t,r).shareFolderScreen,isLoading:!1}},r),(0,i.R3)(t)}})),(0,i.iw)("deleteChatlistInvite",(async(t,e,a)=>{const{folderId:s,url:d}=a,o=d.split("/").pop();o&&await(0,n.t9)("deleteChatlistInvite",{folderId:s,slug:o})&&(t=(0,i.Rd)(),t={...t,chatFolders:{...t.chatFolders,invites:{...t.chatFolders.invites,[s]:t.chatFolders.invites[s]?.filter((t=>t.url!==d))}}},(0,i.R3)(t))})),(0,i.iw)("openDeleteChatFolderModal",(async(t,e,a)=>{const{folderId:s,isConfirmedForChatlist:d,tabId:o=(0,b._w)()}=a,r=(0,c.MwT)(t,s);if(r){if(r.isChatList&&(!r.hasMyInvites||d)){const e=await(0,n.t9)("fetchLeaveChatlistSuggestions",{folderId:s});return t=(0,i.Rd)(),t=(0,C.i)(t,{chatlistModal:{removal:{folderId:s,suggestedPeerIds:e}}},o),void(0,i.R3)(t)}t=(0,C.i)(t,{deleteFolderDialogModal:s},o),(0,i.R3)(t)}})),(0,i.iw)("updateChatDetectedLanguage",((t,e,a)=>{const{chatId:s,detectedLanguage:d}=a;return t=(0,i.Rd)(),(0,r.a4)(t,s,{detectedLanguage:d})})),(0,i.iw)("togglePeerTranslations",(async(t,e,a)=>{const{chatId:s,isEnabled:d}=a,o=(0,c.Z1J)(t,s);o&&void 0!==await(0,n.t9)("togglePeerTranslations",{chat:o,isEnabled:d})&&(t=(0,i.Rd)(),t=(0,u.YC)(s)?(0,r.ap)(t,s,{isTranslationDisabled:!d||void 0}):(0,r.US)(t,s,{isTranslationDisabled:!d||void 0}),(0,i.R3)(t))}))},88422:(t,e,a)=>{a.d(e,{CW:()=>F,EP:()=>v,FF:()=>M,Mt:()=>S,NH:()=>_,o5:()=>y});var i=a(57710),s=a(33555),d=a(92387),o=a(7054),n=a(64319),r=a(27225),c=a(60298),l=a(78958),h=a(42431),u=a(48670),I=a(60782),p=a(74753),f=a(601),V=a(59692),w=a(44271),g=a(65054);let C,b,m;function y(){return v(),Promise.all(Object.values(m).map((t=>{const e=t.src;return t.src="data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",t.muted=!0,t.volume=1e-4,t.play().then((()=>{t.pause(),t.volume=1,t.currentTime=0,t.muted=!1,(0,i.Yq)((()=>{t.src=e}))}))})))}function v(){if(m)return;const t=new Audio("./voicechat_join.mp3"),e=new Audio("./voicechat_connecting.mp3");e.loop=!0;const a=new Audio("./voicechat_leave.mp3"),i=new Audio("./voicechat_onallowtalk.mp3"),s=new Audio("./call_busy.mp3"),d=new Audio("./call_connect.mp3"),o=new Audio("./call_end.mp3"),n=new Audio("./call_incoming.mp3");n.loop=!0;const r=new Audio("./call_ringing.mp3");r.loop=!0,m={join:t,allowTalk:i,leave:a,connecting:e,incoming:n,end:o,connect:d,busy:s,ringing:r}}async function R(t,e){const a=await(0,d.t9)("getGroupCall",{call:e});if(!a)return;t=(0,s.Rd)();const i=(0,h.$5)(t,e.id);return t=(0,l.AH)(t,e.id,(0,I.CE)(a.groupCall,["connectionState"]),void 0,i?.isLoaded?void 0:a.groupCall.participantsCount),t=(0,c.Sh)(t,(0,I.ee)(a.users,"id")),t=(0,c.fZ)(t,(0,I.ee)(a.chats,"id")),(0,s.R3)(t),a.groupCall}async function A(t,e,a){const i=await(0,d.t9)("fetchGroupCallParticipants",{call:e,offset:a});i&&(t=(0,s.Rd)(),t=(0,c.Sh)(t,(0,I.ee)(i.users,"id")),t=(0,c.fZ)(t,(0,I.ee)(i.chats,"id")),(0,s.R3)(t))}function M(){return C}function _(){return b}function S(){C?.pause(),b=void 0,C=void 0}function F(t,e,a){for(var i=arguments.length,s=new Array(i>3?i-3:0),d=3;d<i;d++)s[d-3]=arguments[d];let[o=(0,g._w)()]=s;a?navigator.mediaDevices.getUserMedia({video:!0}).then((a=>{0===a.getVideoTracks().length?e.showNotification({message:V.Iu("Call.Camera.Error"),tabId:o}):(a.getTracks().forEach((t=>t.stop())),T(t,e,o))})).catch((()=>{e.showNotification({message:V.Iu("Call.Camera.Error"),tabId:o})})):T(t,e,o)}function T(t,e){for(var a=arguments.length,i=new Array(a>2?a-2:0),s=2;s<a;s++)i[s-2]=arguments[s];let[d=(0,g._w)()]=i;navigator.mediaDevices.getUserMedia({audio:!0}).then((t=>{0===t.getAudioTracks().length?e.showNotification({message:V.Iu("RequestAcces.Error.HaveNotAccess.Call"),tabId:d}):t.getTracks().forEach((t=>t.stop()))})).catch((()=>{e.showNotification({message:V.Iu("RequestAcces.Error.HaveNotAccess.Call"),tabId:d})}))}(0,s.iw)("toggleGroupCallPanel",((t,e,a)=>{const{force:i,tabId:s=(0,g._w)()}=a||{};return(0,w.i)(t,{isCallPanelVisible:"force"in(a||{})?i:!(0,o.jUK)(t,s).isCallPanelVisible},s)})),(0,s.iw)("subscribeToGroupCallUpdates",(async(t,e,a)=>{const{subscribed:i,id:o}=a,n=(0,h.$5)(t,o);n&&(i&&(await R(t,n),t=(0,s.Rd)(),await A(t,n)),await(0,d.t9)("toggleGroupCallStartSubscription",{subscribed:i,call:n}))})),(0,s.iw)("createGroupCall",(async(t,e,a)=>{const{chatId:i,tabId:n=(0,g._w)()}=a,r=(0,o.Z1J)(t,i);if(!r)return;const c=await(0,d.t9)("createGroupCall",{peer:r});c&&(t=(0,s.Rd)(),t=(0,l.AH)(t,c.id,{...c,chatId:i}),(0,s.R3)(t),e.requestMasterAndJoinGroupCall({id:c.id,accessHash:c.accessHash,tabId:n}))})),(0,s.iw)("createGroupCallInviteLink",(async(t,e,a)=>{const{tabId:i=(0,g._w)()}=a||{},s=(0,h.mU)(t);if(!s||!s.chatId)return;const r=(0,o.Z1J)(t,s.chatId);if(!r)return;const c=Boolean((0,u.WS)(r));let l=(0,o.x67)(t,r.id)?.inviteLink;c&&(l=await(0,d.t9)("exportGroupCallInvite",{call:s,canSelfUnmute:!1})),l&&((0,n.TE)(l),e.showNotification({message:"Link copied to clipboard",tabId:i}))})),(0,s.iw)("joinVoiceChatByLink",(async(t,e,a)=>{const{username:i,inviteHash:d,tabId:o=(0,g._w)()}=a,n=await(0,r.Co)(t,i);if(!n)return void e.showNotification({message:V.Iu("NoUsernameFound"),tabId:o});t=(0,s.Rd)();const c=await(0,r.ft)(t,e,n,o);c?.groupCall&&e.requestMasterAndJoinGroupCall({id:c.groupCall.id,accessHash:c.groupCall.accessHash,inviteHash:d,tabId:o})})),(0,s.iw)("requestMasterAndJoinGroupCall",((t,e,a)=>{e.requestMasterAndCallAction({action:"joinGroupCall",payload:a,tabId:a.tabId||(0,g._w)()})})),(0,s.iw)("requestMasterAndAcceptCall",((t,e,a)=>{e.requestMasterAndCallAction({action:"acceptCall",payload:void 0,tabId:a?.tabId||(0,g._w)()})})),(0,s.iw)("joinGroupCall",(async(t,e,a)=>{const{chatId:i,id:d,accessHash:n,inviteHash:c,tabId:u=(0,g._w)()}=a;if(!f.Bi)return void e.showNotification({message:"Sorry, your browser doesn't support group calls",tabId:u});if(t.phoneCall)return void e.toggleGroupCallPanel({tabId:u});!function(){const t=new(window.AudioContext||window.webkitAudioContext);C=new Audio,b=t,C.srcObject=(t=>{const e=t.createOscillator(),a=e.connect(t.createMediaStreamDestination());return e.start(),new MediaStream([Object.assign(a.stream.getAudioTracks()[0],{enabled:!1})])})(t),(0,p.Z)(C)}(),v(),F(t=(0,s.Rd)(),e,!0,u);const{groupCalls:{activeGroupCallId:I}}=t;let V=d?(0,h.$5)(t,d):(0,h.Bj)(t,i);if(V&&V.id===I)e.toggleGroupCallPanel({tabId:u});else if(I)"leaveGroupCall"in e&&e.leaveGroupCall({rejoin:a,tabId:u});else if(V&&I===V.id)e.toggleGroupCallPanel({tabId:u});else{if(V||d&&n||!i)!V&&d&&n&&(V=await R(t,{id:d,accessHash:n}));else{const a=(0,o.Z1J)(t,i);if(!a)return;await(0,r.ft)(t,e,a,u),t=(0,s.Rd)(),V=(0,h.Bj)(t,i)}V&&(t=(0,s.Rd)(),t=(0,l.AH)(t,V.id,{...V,inviteHash:c},void 0,V.participantsCount+1),t={...t,groupCalls:{...t.groupCalls,activeGroupCallId:V.id}},(0,s.R3)(t),e.toggleGroupCallPanel({force:!1,tabId:u}))}})),(0,s.iw)("playGroupCallSound",((t,e,a)=>{const{sound:i}=a;m[i]&&("connecting"!==i&&m.connecting.pause(),"incoming"!==i&&m.incoming.pause(),"ringing"!==i&&m.ringing.pause(),(0,p.Z)(m[i]))})),(0,s.iw)("loadMoreGroupCallParticipants",(t=>{const e=(0,h.mU)(t);e&&A(t,e,e.nextOffset)})),(0,s.iw)("requestMasterAndRequestCall",((t,e,a)=>{e.requestMasterAndCallAction({action:"requestCall",payload:a,tabId:a.tabId||(0,g._w)()})})),(0,s.iw)("requestCall",((t,e,a)=>{const{userId:i,isVideo:d,tabId:n=(0,g._w)()}=a;t.phoneCall?e.toggleGroupCallPanel({tabId:n}):(0,o.dyD)(t,i)&&(v(),F(t=(0,s.Rd)(),e,d,n),t=(0,s.Rd)(),t={...t,phoneCall:{id:"",state:"requesting",participantId:i,isVideo:d,adminId:t.currentUserId}},(0,s.R3)(t),e.toggleGroupCallPanel({force:!1,tabId:n}))}))},78958:(t,e,a)=>{a.d(e,{AH:()=>n,B6:()=>l,Ic:()=>c,dc:()=>r});var i=a(42431),s=a(60782),d=a(53475),o=a(7054);function n(t,e,a,i,d){const o=Object.values({...t.groupCalls.byId[e]?.participants,...a.participants}).filter((t=>{let{isLeft:e}=t;return!e})).reduce(((t,e)=>(t[e.id]=e,t)),{});return{...t,groupCalls:{...t.groupCalls,byId:{...t.groupCalls.byId,[e]:{...t.groupCalls.byId[e],...(0,s.CE)(a,["participantsCount"]),...i&&{participantsCount:t.groupCalls.byId[e].participantsCount+i},...void 0!==d&&{participantsCount:d},participants:o}}}}}function r(t,e){const a=(0,i.$5)(t,e);return a&&a.chatId&&(0,o.Z1J)(t,a.chatId)&&(t=(0,d.US)(t,a.chatId,{groupCallId:void 0})),{...t,groupCalls:{...t.groupCalls,byId:{...(0,s.CE)(t.groupCalls.byId,[e.toString()])}}}}function c(t,e,a){return t.groupCalls.activeGroupCallId?n(t,t.groupCalls.activeGroupCallId,e,void 0,a):t}function l(t,e,a,s){let d=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const o=(0,i.$5)(t,e);return o?n(t,e,{participants:{...o.participants,[a]:{...o.participants[a],...s}}},s.isLeft?d?0:-1:o.participants[a]||d?0:1):t}}}]);
//# sourceMappingURL=8422.2c2684fac2363e7f6ece.js.map