"use strict";(self.webpackChunktelegram_t=self.webpackChunktelegram_t||[]).push([[2394],{83320:(e,t,n)=>{n.r(t),n.d(t,{ActiveCallHeader:()=>et,GroupCall:()=>Xe,PhoneCall:()=>ot,RatePhoneCallModal:()=>st});var a=n(12859),i=n(82393),o=n(31481);function r(e){return 0|e}function s(e){return e>>>0}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(!e)return 0;const{length:n}=e;let a=0;for(let t=0;t<n;t++)a+=e[t]*e[t];const i=Math.sqrt(a/n)/255;return Math.min(1,i*t)}function l(e){return{id:e.id,name:e.name,"rtcp-fbs":e.feedbackTypes,clockrate:e.clockrate,parameters:e.parameters,channels:e.channels}}const d=.1,u="getDisplayMedia"in(navigator?.mediaDevices||{}),p=navigator?.mediaDevices?.getSupportedConstraints().echoCancellation,m=navigator?.mediaDevices?.getSupportedConstraints().noiseSuppression,g=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e||!e.sdp)throw Error("Failed parsing SDP: session description is null");const n=e.sdp.split("\r\nm=").map(((e,t)=>0===t?e:`m=${e}`)).reduce(((e,t)=>{const n=t.match(/^m=(.+?)\s/)?.[1]||"header";return e[e.hasOwnProperty(n)&&"video"===n?"screencast":n]=t.split("\r\n").filter(Boolean),e}),{}),a=(e,t)=>t?n[t]?.find((t=>t.startsWith(e)))?.substr(e.length):Object.values(n).map((t=>t.find((t=>t.startsWith(e)))?.substr(e.length))).filter(Boolean)[0],i=e=>n[e].filter((e=>e.startsWith("a=extmap"))).map((e=>{const[,t,n]=e.match(/extmap:(\d+)(?:\/.+)?\s(.+)/);return{id:Number(t),uri:n}})),o=e=>{const t=n[e].filter((e=>e.startsWith("a=rtpmap"))).map((e=>{const[,t,n]=e.match(/:(\d+)\s(.+)/)||[],[a,i,o]=n.split("/");return{id:Number(t),name:a,clockrate:Number(i),...o&&{channels:Number(o)}}})),a=n[e].filter((e=>e.startsWith("a=rtcp-fb"))).map((e=>{const[,t,n]=e.match(/:(\d+)\s(.+)/)||[],[a,i]=n.split(" ");return{id:Number(t),type:a,subtype:i||""}})),i=n[e].filter((e=>e.startsWith("a=fmtp"))).map((e=>{const[,t,n]=e.match(/:(\d+)\s(.+)/)||[],a=n.split(";").reduce(((e,t)=>{const[n,a]=t.split("=");return e[n]=a,e}),{});if(!Object.values(a).some((e=>!e)))return{id:Number(t),data:a}})).filter(Boolean);return t.map((e=>{const t=i.filter((t=>t.id===e.id)).map((e=>e.data)).reduce(((e,t)=>Object.assign(e,t)),{}),n=a.filter((t=>t.id===e.id)).map((e=>({type:e.type,subtype:e.subtype})));return{...e,...Object.keys(t).length>0&&{parameters:t},...n.length>0&&{feedbackTypes:n}}}))},s=a("a=ssrc:","audio"),c=s&&Number(s.split(" ")[0]),l=a("a=ssrc-group:","video")?.split(" ")||void 0,d=a("a=ssrc-group:","screencast")?.split(" ")||void 0;if(!l)throw Error("Failed parsing SDP: no video ssrc");const[u,p]=a("a=fingerprint:")?.split(" ")||[],m=a("a=setup:");if(!u||!p)throw Error("Failed parsing SDP: no fingerprint");console.log(n);const g=a("a=ice-ufrag:"),f=a("a=ice-pwd:");if(!g||!f)throw Error("Failed parsing SDP: no ICE ufrag or pwd");return{fingerprints:[{fingerprint:p,hash:u,setup:t?m:"active"}],pwd:f,ufrag:g,...c&&{ssrc:r(c)},...l&&{"ssrc-groups":[{semantics:l[0],sources:l.slice(1,l.length).map(Number).map(r)},t&&d&&{semantics:d[0],sources:d.slice(1,d.length).map(Number).map(r)}].filter(Boolean)},...t&&{audioExtmap:i("audio"),videoExtmap:i("video"),screencastExtmap:i("screencast"),audioPayloadTypes:o("audio"),videoPayloadTypes:o("video"),screencastPayloadTypes:o("screencast")}}},f=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=[],o=e=>{i.push(e)},{sessionId:r,ssrcs:c,audioExtensions:l,videoExtensions:d,audioPayloadTypes:u,videoPayloadTypes:p,transport:{ufrag:m,pwd:g,fingerprints:f,candidates:v}}=e;o("v=0"),o(`o=- ${r} 2 IN IP4 0.0.0.0`),o("s=-"),o("t=0 0"),o("a=ice-options:trickle"),o("a=msid-semantic:WMS *"),o(`a=group:BUNDLE ${c.map((e=>e.mid)).join(" ")}${n?"":" "+(a?"3":"2")}`),a||o("a=ice-lite");const h=e=>{if(e.sdpString)o(`a=${e.sdpString}`);else{let t="";t+="a=candidate:",t+=`${e.foundation} ${e.component} ${e.protocol} ${e.priority} ${e.ip} ${e.port} typ ${e.type}`,"rel-addr"in e&&(t+=` raddr ${e["rel-addr"]} rport ${e["rel-port"]}`),t+=` generation ${e.generation}`,o(t)}},y=()=>{o(`a=ice-ufrag:${m}`),o(`a=ice-pwd:${g}`),f.forEach((e=>{o(`a=fingerprint:${e.hash} ${e.fingerprint}`),o(`a=setup:${a?e.setup:"passive"}`)})),v.forEach(h)},A=e=>{const{channels:t,id:n,name:a,clockrate:i,parameters:r}=e;if(o(`a=rtpmap:${n} ${a}/${i}${t?`/${t}`:""}`),r){const e=Object.keys(r).map((e=>`${e}=${r[e]};`)).join(" ");o(`a=fmtp:${n} ${e}`)}e["rtcp-fbs"]?.forEach((e=>{o(`a=rtcp-fb:${n} ${e.type}${e.subtype?` ${e.subtype}`:""}`)}))},C=e=>{const n=e.isVideo?p:u,i=e.isVideo?"video":"audio";if(o(`m=${i} ${e.isMain?1:0} RTP/SAVPF ${n.map((e=>e.id)).join(" ")}`),o("c=IN IP4 0.0.0.0"),o("b=AS:1300"),o(`a=mid:${e.mid}`),o("a=rtcp-mux"),n.forEach(A),o("a=rtcp:1 IN IP4 0.0.0.0"),e.isVideo&&o("a=rtcp-rsize"),(e.isVideo?d:l).forEach((e=>{let{id:t,uri:n}=e;o(`a=extmap:${t} ${n}`)})),e.isRemoved)o("a=inactive");else{if(y(),a)o("a=sendrecv"),o("a=bundle-only");else{if(t)return void o("a=recvonly");e.isMain?o("a=sendrecv"):(o("a=sendonly"),o("a=bundle-only"))}e.sourceGroups.forEach((t=>{t.semantics&&o(`a=ssrc-group:${t.semantics} ${t.sources.map(s).join(" ")}`),t.sources.forEach((t=>{const n=s(t);o(`a=ssrc:${n} cname:${e.endpoint}`),o(`a=ssrc:${n} msid:${e.endpoint} ${e.endpoint}`),o(`a=ssrc:${n} mslabel:${e.endpoint}`),o(`a=ssrc:${n} label:${e.endpoint}`)}))}))}};return a?c.filter(C):c.filter((e=>"0"===e.mid||"1"===e.mid)).map(C),n||(o("m=application 1 UDP/DTLS/SCTP webrtc-datachannel"),o("c=IN IP4 0.0.0.0"),y(),o("a=ice-options:trickle"),o("a=mid:"+(a?"3":n?"1":"2")),o("a=sctp-port:5000"),o("a=max-message-size:262144")),a||c.filter((e=>"0"!==e.mid&&"1"!==e.mid)).map(C),`${i.join("\n")}\n`},v=e=>{const t=e.createOscillator(),n=t.connect(e.createMediaStreamDestination());return t.start(),new MediaStream([Object.assign(n.stream.getAudioTracks()[0],{enabled:!1})])},h=function(){let{width:e=640,height:t=480}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=Object.assign(document.createElement("canvas"),{width:e,height:t}),a=n.getContext("2d");if(!a)throw Error("Cannot create canvas ctx");a.fillRect(0,0,e,t);const i=n.captureStream();return new MediaStream([Object.assign(i.getVideoTracks()[0],{enabled:!1})])};var y=n(9705),A=n(41733);let C,b;function E(e){C&&(C.screenshareDataChannel?.close(),C.screenshareConnection?.close(),e||C.onUpdate?.({"@type":"updateGroupCallLeavePresentation"}))}function w(e){return C?.streams?.[e]}function S(e,t){const n=C?.participantFunctions?.[e];n&&n.setVolume?.(t)}function k(e,t){const n=t||C?.myId,a=n&&w(n)?.[e];return!!a&&a.getTracks()[0]?.enabled}function I(e){C?.onUpdate?.({"@type":"updateGroupCallStreams",userId:e,hasAudioStream:k("audio",e),hasVideoStream:k("video",e),hasPresentationStream:k("presentation",e),amplitude:C.speaking?.[e]})}async function P(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"user";if("audio"===e&&C?.audioStream)return C.audioStream;if("presentation"===e)return navigator.mediaDevices.getDisplayMedia({audio:!1,video:!0});const n=await navigator.mediaDevices.getUserMedia({audio:"audio"===e&&{...p&&{echoCancellation:!0},...m&&{noiseSuppression:!0}},video:"video"===e&&{facingMode:t}});if(C&&"audio"===e&&(C.audioStream=n),"video"===e){const e=document.createElement("video");e.srcObject=n;const t=new y.A;e.oncanplay=()=>t.resolve(),await t.promise}return n}async function N(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!(C&&C.myId&&C.connection&&C.streams))return;const n=w(C.myId)?.[e];if(!n)return;const a=n.getTracks()[0];if(!a)return;const i=[...C.connection.getSenders(),...C.screenshareConnection?.getSenders()||[]].find((e=>a.id===e.track?.id));if(i){t=void 0===t?!a.enabled:t;try{if(t&&!a.enabled){const t=await P(e);if(await i.replaceTrack(t.getTracks()[0]),C.streams[C.myId][e]=t,"video"===e)C.facingMode="user";else if("audio"===e){const{audioContext:e}=C;if(!e)return;const n=C.audioSource||e.createMediaStreamSource(t),a=C.audioAnalyser||e.createAnalyser();a.minDecibels=-100,a.maxDecibels=-30,a.smoothingTimeConstant=.05,a.fftSize=1024,n.connect(a),C={...C,audioSource:n,audioAnalyser:a,participantFunctions:{...C.participantFunctions,[C.myId]:{...C.participantFunctions?.[C.myId],getCurrentAmplitude:()=>{const e=new Uint8Array(a.frequencyBinCount);return a.getByteFrequencyData(e),c(e,1.5)}}}}}}else if(!t&&a.enabled){const t="audio"===e?C.silence:C.black;if(!t)return;await i.replaceTrack(t.getTracks()[0]),C.streams[C.myId][e]=t,"video"===e&&(C.facingMode=void 0),"audio"!==e?a.stop():(C.audioSource?.disconnect(),C.audioAnalyser?.disconnect())}I(C.myId),"presentation"!==e||t||E(!0)}catch(e){}}}function T(e){C?.onUpdate?.({"@type":"updateGroupCallConnectionState",connectionState:e})}function M(){C&&(C.myId&&C.streams?.[C.myId]&&Object.values(C.streams[C.myId]||{}).forEach((e=>{e?.getTracks().forEach((e=>{e.stop()}))})),C.audioStream?.getTracks().forEach((e=>{e.stop()})),E(!0),C.dataChannel?.close(),C.connection?.close(),T("disconnected"),C.analyserInterval&&clearInterval(C.analyserInterval),C=void 0)}function x(){C&&C.participantFunctions&&Object.keys(C.participantFunctions).forEach((e=>{const{getCurrentAmplitude:t}=C.participantFunctions[Number(e)];if(t){const n=t(),a=C.speaking[e]||0;C.speaking[e]=n,(n>d&&a<=d||n<=d&&a>d)&&I(e)}}))}async function V(e){if(!C)return;const{participants:t,conference:n,connection:a,myId:i}=C;if(!(t&&n&&a&&n.ssrcs&&n.transport&&i))return;if(e.find((e=>e.isSelf&&e.source!==C?.conference?.ssrcs?.find((e=>e.isMain&&!e.isVideo))?.sourceGroups[0].sources[0])))return void M();const o=[];if(e.forEach((e=>{if(e.isSelf)return void(e.isMuted&&!e.canSelfUnmute&&(N("audio",!1),N("video",!1),N("presentation",!1)));const{isLeft:t}=e,a=e.isMuted||e.isMutedByMe,i=!e.isVideoJoined||!e.video||t,r=!e.presentation||t;let s=!1,c=!1,l=!1;n.ssrcs.filter((t=>t.userId===e.id)).forEach((t=>{t.isVideo||(t.sourceGroups[0].sources[0]===e.source&&(c=!0),t.isRemoved=a),t.isVideo&&(t.isPresentation||(e.video&&t.endpoint===e.video.endpoint&&(s=!0),t.isRemoved=i),t.isPresentation&&(e.presentation&&t.endpoint===e.presentation.endpoint&&(l=!0),t.isRemoved=r))})),a||c||(C.lastMid=C.lastMid+1,n.ssrcs.push({userId:e.id,isMain:!1,endpoint:`audio${e.source}`,isVideo:!1,sourceGroups:[{sources:[e.source]}],mid:C.lastMid.toString()})),i||s||!e.video||(C.lastMid=C.lastMid+1,o.push(e.video.endpoint),n.ssrcs.push({userId:e.id,isMain:!1,endpoint:e.video.endpoint,isVideo:!0,sourceGroups:e.video.sourceGroups,mid:C.lastMid.toString()})),r||l||!e.presentation||(C.lastMid=C.lastMid+1,n.ssrcs.push({isPresentation:!0,userId:e.id,isMain:!1,endpoint:e.presentation.endpoint,isVideo:!0,sourceGroups:e.presentation.sourceGroups,mid:C.lastMid.toString()}))})),C.updatingParticipantsQueue)return void C.updatingParticipantsQueue.push(n);C.updatingParticipantsQueue=[];const r=f(n);await a.setRemoteDescription({type:"offer",sdp:r});try{const e=await a.createAnswer();if(await a.setLocalDescription(e),I(i),C.updatingParticipantsQueue.length>0)for(const e of C.updatingParticipantsQueue){await a.setRemoteDescription({type:"offer",sdp:f(e)});const t=await a.createAnswer();await a.setLocalDescription(t),I(i)}C.updatingParticipantsQueue=void 0}catch(e){console.error(e)}}function G(e){if(!(C&&C.audioElement&&C.audioContext&&C.mediaStream))return;const t=C.conference?.ssrcs?.find((t=>t.endpoint===e.track.id));if(!t||!t.userId)return;const{userId:n,isPresentation:a}=t,i=C.participants?.find((e=>e.id===n)),o="video"===e.track.kind?a?"presentation":"video":"audio";e.track.onended=()=>{delete C?.streams?.[n][o],I(n)};const r=e.streams[0];if("audio"===e.track.kind){const{mediaStream:e}=C,t=new window.AudioContext,a=t.createMediaStreamSource(r),o=t.createGain();o.gain.value=(i?.volume||1e4)/1e4;const s=t.createGain();o.gain.value=1;const l=t.createAnalyser();l.minDecibels=-100,l.maxDecibels=-30,l.smoothingTimeConstant=.05,l.fftSize=1024,a.connect(l).connect(s).connect(o).connect(t.destination),e.addTrack(a.mediaStream.getAudioTracks()[0]);const d=new Audio;d.srcObject=r,d.muted=!0,d.remove(),C={...C,participantFunctions:{...C.participantFunctions,[n]:{...C.participantFunctions?.[n],setVolume:e=>{o.gain.value=e>1?2*e:e},toggleMute:e=>{s.gain.value=e?0:1},getCurrentAmplitude:()=>{const e=new Uint8Array(l.frequencyBinCount);return l.getByteFrequencyData(e),c(e,1.5)}}}}}C={...C,streams:{...C.streams,[n]:{...C.streams?.[n],[o]:r}}},I(n)}function R(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=new RTCPeerConnection,i=n?void 0:function(e){const t=e.createDataChannel("data",{id:0});return t.onopen=()=>{},t.onmessage=e=>{JSON.parse(e.data).colibriClass},t.onerror=e=>{console.log("%conerror","background: green; font-size: 5em"),console.error(e)},t}(a);return e.forEach((e=>e.getTracks().forEach((t=>{a.addTrack(t,e)})))),n||(a.oniceconnectionstatechange=()=>{const e=a.iceConnectionState;console.log("iceconnectionstatechange",e),"connected"===e||"completed"===e?T("connected"):"checking"===e||"new"===e?T("connecting"):"disconnected"===a.iceConnectionState&&T("reconnecting")}),a.onconnectionstatechange=()=>{console.log("connectionstatechange",a.connectionState)},a.ontrack=G,a.onnegotiationneeded=async()=>{if(!C)return;console.log("onnegotiationneeded");const{myId:i}=C;if(!i)return;const o=await a.createOffer({offerToReceiveVideo:!0,offerToReceiveAudio:!n});if(console.log("offer created"),await a.setLocalDescription(o),console.log("local desc set"),!o.sdp)return;const r=g(o),s=n?void 0:{userId:"",sourceGroups:[{sources:[r.ssrc||0]}],isRemoved:n,isMain:!0,isVideo:!1,isPresentation:n,endpoint:n?"1":"0",mid:n?"1":"0"},c=r["ssrc-groups"]&&{isPresentation:n,userId:"",sourceGroups:r["ssrc-groups"],isMain:!0,isVideo:!0,endpoint:n?"0":"1",mid:n?"0":"1"},l=n?C.screenshareConference:C.conference,d=[];n?(c&&d.push(c),s&&d.push(s)):(s&&d.push(s),c&&d.push(c));const u=e.find((e=>"audio"===e.getTracks()[0].kind)),p=e.find((e=>"video"===e.getTracks()[0].kind));C={...C,...n?{screenshareConference:{...l,ssrcs:d}}:{conference:{...l,ssrcs:d}},streams:{...C.streams,[i]:{...C.streams?.[i],...u&&{audio:u},...!n&&p?{video:p}:{presentation:p}}}},I(i),t(r)},{connection:a,dataChannel:i}}function B(){b?.onUpdate({...b.mediaState,"@type":"updatePhoneCallMediaState"})}function L(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"user";return"presentation"===e?navigator.mediaDevices.getDisplayMedia({audio:!1,video:!0}):navigator.mediaDevices.getUserMedia({audio:"audio"===e&&{...p&&{echoCancellation:!0},...m&&{noiseSuppression:!0}},video:"video"===e&&{facingMode:t}})}async function O(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!b)return;const n="audio"===e?b.streams.ownAudio:"video"===e?b.streams.ownVideo:b.streams.ownPresentation;if(!n)return;const a=n.getTracks()[0];if(!a)return;const i=b.connection.getSenders().find((e=>a.id===e.track?.id));if(i){t=void 0===t?!a.enabled:t;try{if(t&&!a.enabled){const t=await L(e);t.getTracks()[0].onended=()=>{O(e,!1)},await i.replaceTrack(t.getTracks()[0]),"audio"===e?b.streams.ownAudio=t:"video"===e?(b.streams.ownVideo=t,b.facingMode="user"):b.streams.ownPresentation=t,"video"!==e&&"presentation"!==e||O("video"===e?"presentation":"video",!1)}else if(!t&&a.enabled){a.stop();const t="audio"===e?b.silence:"video"===e?b.blackVideo:b.blackPresentation;if(!t)return;await i.replaceTrack(t.getTracks()[0]),"audio"===e?b.streams.ownAudio=t:"video"===e?b.streams.ownVideo=t:b.streams.ownPresentation=t}B(),_()}catch(e){console.error(e)}}}function U(){b&&(b.streams.ownVideo?.getTracks().forEach((e=>e.stop())),b.streams.ownPresentation?.getTracks().forEach((e=>e.stop())),b.streams.ownAudio?.getTracks().forEach((e=>e.stop())),b.dataChannel.close(),b.connection.close(),b=void 0)}function _(){if(!b)return;const{emitSignalingData:e,streams:t}=b;e({"@type":"MediaState",videoRotation:0,isMuted:!t.ownAudio?.getTracks()[0].enabled,isBatteryLow:!0,videoState:t.ownVideo?.getTracks()[0].enabled?"active":"inactive",screencastState:t.ownPresentation?.getTracks()[0].enabled?"active":"inactive"})}function D(e){if(!b||b.isOutgoing)return e;const{payloadTypes:t}=e,n=t.findIndex((e=>"VP8"===e.name)),a=t[n],i=t.findIndex((e=>Number(e.parameters?.apt)===a.id));return e.payloadTypes=[t[n],t[i]],e}function F(e){if(!b)return;const{emitSignalingData:t}=b;e.ssrc&&e["ssrc-groups"]&&e["ssrc-groups"][0]&&e["ssrc-groups"][1]&&t({"@type":"InitialSetup",fingerprints:e.fingerprints,ufrag:e.ufrag,pwd:e.pwd,audio:{ssrc:s(e.ssrc).toString(),ssrcGroups:[],payloadTypes:e.audioPayloadTypes,rtpExtensions:e.audioExtmap},video:D({ssrc:s(e["ssrc-groups"][0].sources[0]).toString(),ssrcGroups:[{semantics:e["ssrc-groups"][0].semantics,ssrcs:e["ssrc-groups"][0].sources.map(s)}],payloadTypes:e.videoPayloadTypes,rtpExtensions:e.videoExtmap}),screencast:D({ssrc:s(e["ssrc-groups"][1].sources[0]).toString(),ssrcGroups:[{semantics:e["ssrc-groups"][1].semantics,ssrcs:e["ssrc-groups"][1].sources.map(s)}],payloadTypes:e.screencastPayloadTypes,rtpExtensions:e.screencastExtmap})})}async function $(e){if(b&&b.connection)switch(e["@type"]){case"MediaState":b.mediaState=e,B(),_();break;case"Candidates":{const{pendingCandidates:t,gotInitialSetup:n}=b;e.candidates.forEach((e=>{t.push(e.sdpString)})),n&&await J();break}case"InitialSetup":{const{connection:t,isOutgoing:n}=b;if(!t)return;const a={transport:{candidates:[],ufrag:e.ufrag,pwd:e.pwd,fingerprints:e.fingerprints,"rtcp-mux":!1,xmlns:""},sessionId:Date.now(),ssrcs:[e.audio&&{isVideo:!1,isMain:!1,userId:"123",endpoint:"0",mid:"0",sourceGroups:[{sources:[e.audio.ssrc]}]},e.video&&{isVideo:!0,isPresentation:!1,isMain:!1,userId:"123",endpoint:"1",mid:"1",sourceGroups:e.video.ssrcGroups.map((e=>({semantics:e.semantics,sources:e.ssrcs})))},e.screencast&&{isVideo:!0,isPresentation:!0,isMain:!1,userId:"123",endpoint:"2",mid:"2",sourceGroups:e.screencast.ssrcGroups.map((e=>({semantics:e.semantics,sources:e.ssrcs})))}],audioPayloadTypes:e.audio.payloadTypes?.map(l)||[],audioExtensions:e.audio.rtpExtensions,videoPayloadTypes:D(e.video).payloadTypes?.map(l)||[],videoExtensions:e.video.rtpExtensions};if(await t.setRemoteDescription({sdp:f(a,n,void 0,!0),type:n?"answer":"offer"}),b.conference=a,!n){const e=await t.createAnswer();await t.setLocalDescription(e),F(g(t.localDescription,!0))}b.gotInitialSetup=!0,await J();break}}}async function J(){if(!b)return;const{pendingCandidates:e,connection:t}=b;e.length&&(await Promise.all(e.map((e=>async function(e,t){try{await e.addIceCandidate({candidate:t,sdpMLineIndex:0})}catch(e){console.error(e)}}(t,e)))),b.pendingCandidates=[])}async function j(e,t){const n=await e.createOffer(t);await e.setLocalDescription(n),F(g(e.localDescription,!0))}var z=n(14487),K=n(4875),H=n(13439),q=n(80840),W=n(32989),Z=n(29807),Y=n(71331),Q=n(42347);(0,H.aJ)("leaveGroupCall",(async(e,t,n)=>{const{isFromLibrary:i,shouldDiscard:o,shouldRemove:r,rejoin:s,isPageUnload:c,tabId:l=(0,z.g0)()}=n||{},d=(0,Y.iT)(e);d&&(e=(0,q.R6)(e,{connectionState:"disconnected"},d.participantsCount-1),e={...e,groupCalls:{...e.groupCalls,activeGroupCallId:void 0}},(0,H.UF)(e),await(0,K.px)("leaveGroupCall",{call:d,isPageUnload:c}),await(0,K.px)("abortRequestGroup","call"),o&&await(0,K.px)("discardGroupCall",{call:d}),e=(0,H.mS)(),r&&(e=(0,q.um)(e,d.id)),(0,a.ow)(),(0,H.UF)(e),t.toggleGroupCallPanel({force:void 0,tabId:l}),i||M(),t.afterHangUp(),s&&t.requestMasterAndJoinGroupCall({...s,tabId:l}))})),(0,H.aJ)("toggleGroupCallVideo",(async e=>{const t=(0,Y.iT)(e),n=(0,Z.mBe)(e,e.currentUserId);n&&t&&(await N("video"),await(0,K.px)("editGroupCallParticipant",{call:t,videoStopped:!k("video"),participant:n}))})),(0,H.aJ)("requestToSpeak",((e,t,n)=>{const{value:a}=n||{value:!0},i=(0,Y.iT)(e),o=(0,Z.mBe)(e,e.currentUserId);o&&i&&(0,K.px)("editGroupCallParticipant",{call:i,raiseHand:a,participant:o})})),(0,H.aJ)("setGroupCallParticipantVolume",((e,t,n)=>{const{participantId:a,volume:i}=n,r=(0,Y.iT)(e),s=(0,Z.mBe)(e,a);s&&r&&(S(a,Math.floor(i/o.CH0)/100),(0,K.px)("editGroupCallParticipant",{call:r,volume:Number(i),participant:s}))})),(0,H.aJ)("toggleGroupCallMute",(async(e,t,n)=>{const{participantId:a,value:i}=n||{},o=(0,Y.iT)(e),r=(0,Z.mBe)(e,a||e.currentUserId);if(!r||!o)return;const s=void 0===i?k("audio",r.id):i;a?S(a,s?0:1):await N("audio"),await(0,K.px)("editGroupCallParticipant",{call:o,muted:s,participant:r})})),(0,H.aJ)("toggleGroupCallPresentation",(async(e,t,n)=>{const a=(0,Y.iT)(e),i=(0,Z.mBe)(e,e.currentUserId);if(i&&a){if(void 0!==n?.value?n?.value:!k("presentation")){const e=await async function(){if(C)try{const e=await P("presentation");if(!e)return;return e.getTracks()[0].onended=()=>{C&&C.myId&&(delete C.streams?.[C.myId].presentation,I(C.myId),E())},await new Promise((t=>{const{connection:n,dataChannel:a}=R([e],t,!0);C={...C,screenshareConnection:n,screenshareDataChannel:a}}))}catch(e){return}}();if(!e)return;await(0,K.px)("joinGroupCallPresentation",{call:a,params:e})}else await N("presentation",!1),await(0,K.px)("leaveGroupCallPresentation",{call:a});await(0,K.px)("editGroupCallParticipant",{call:a,presentationPaused:!k("presentation"),participant:i})}})),(0,H.aJ)("connectToActiveGroupCall",(async(e,t,n)=>{const{tabId:i=(0,z.g0)()}=n||{},o=(0,Y.iT)(e);if(!o)return;if("discarded"===o.connectionState)return void t.showNotification({message:"This voice chat is not active",tabId:i});const r=(0,a.sN)(),s=(0,a.Hc)();if(!r||!s)return;const{currentUserId:c}=e;if(!c)return;const l=await function(e,t,n,a){if(C)throw Error("Already in call");T("connecting");const i=new MediaStream;return n.srcObject=i,(0,A.A)(n),C={onUpdate:a,participants:[],myId:e,speaking:{},silence:v(t),black:h({width:640,height:480}),analyserInterval:setInterval(x,1e3),audioElement:n,audioContext:t,mediaStream:i,lastMid:3},P("audio"),new Promise((e=>{C={...C,...R([C.silence,C.black],e)}}))}(c,s,r,t.apiUpdate),d=await(0,K.px)("joinGroupCall",{call:o,params:l,inviteHash:o.inviteHash});if(e=(0,H.mS)(),!d)return t.showNotification({message:"Failed to join voice chat",tabId:i}),void t.leaveGroupCall({tabId:i});if(t.loadMoreGroupCallParticipants(),o.chatId){e=(0,H.mS)();const n=(0,Z.hds)(e,o.chatId);if(!n)return;await(0,Q.ad)(e,t,n)}})),(0,H.aJ)("connectToActivePhoneCall",(async(e,t)=>{const{phoneCall:n}=e;if(!n)return;const a=(0,Y.uu)(e);if(!a)return;const i=await(0,K.px)("getDhConfig");if(!i)return;await(0,K.px)("createPhoneCallState",[!0]);const o=await(0,K.px)("requestPhoneCall",[i]);await(0,K.px)("requestCall",{user:a,gAHash:o,isVideo:n.isVideo})||"hangUp"in t&&t.hangUp({tabId:(0,z.g0)()})})),(0,H.aJ)("acceptCall",(async e=>{const{phoneCall:t}=e;if(!t)return;const n=await(0,K.px)("getDhConfig");if(!n)return;await(0,K.px)("createPhoneCallState",[!1]);const a=await(0,K.px)("acceptPhoneCall",[n]);await(0,K.px)("acceptCall",{call:t,gB:a})})),(0,H.aJ)("sendSignalingData",((e,t,n)=>{const{phoneCall:a}=e;if(!a)return;const i=JSON.stringify(n);(async()=>{const e=await(0,K.px)("encodePhoneCallData",[i]);e&&(0,K.px)("sendSignalingData",{data:e,call:a})})()})),(0,H.aJ)("closeCallRatingModal",((e,t,n)=>{const{tabId:a=(0,z.g0)()}=n||{};return(0,W.w)(e,{ratingPhoneCall:void 0},a)})),(0,H.aJ)("setCallRating",((e,t,n)=>{const{rating:a,comment:i,tabId:o=(0,z.g0)()}=n,{ratingPhoneCall:r}=(0,Z.nTw)(e,o);if(r)return(0,K.px)("setCallRating",{call:r,rating:a,comment:i}),(0,W.w)(e,{ratingPhoneCall:void 0},o)})),(0,H.aJ)("hangUp",((e,t,n)=>{const{isPageUnload:a,tabId:i=(0,z.g0)()}=n||{},{phoneCall:o}=e;if(o){if("discarded"===o.state)return(0,K.px)("destroyPhoneCallState"),U(),e={...e,phoneCall:void 0},(0,H.UF)(e),t.toggleGroupCallPanel({force:void 0,tabId:i}),void t.afterHangUp();if((0,K.px)("destroyPhoneCallState"),U(),(0,K.px)("discardCall",{call:o,isPageUnload:a}),"requesting"===o.state)return e={...e,phoneCall:void 0},(0,H.UF)(e),t.toggleGroupCallPanel({force:void 0,tabId:i}),void t.afterHangUp();setTimeout((()=>{e=(0,H.mS)(),e={...e,phoneCall:void 0},(0,H.UF)(e),t.toggleGroupCallPanel({force:void 0,tabId:i}),t.afterHangUp()}),500)}}));var X=n(87894),ee=n(47985);const te=new Uint16Array([55357,56841,55357,56845,55357,56859,55357,56877,55357,56881,55357,56865,55357,56846,55357,56884,55357,56885,55357,56840,55357,56876,55357,56839,55357,56847,55357,56430,55357,56439,55357,56450,55357,56438,55357,56424,55357,56425,55357,56436,55357,56437,55357,56891,55357,56893,55357,56896,55357,56442,55357,56904,55357,56905,55357,56906,55357,56448,55357,56445,55357,56489,55357,56613,55357,56485,55357,56484,55357,56386,55357,56384,55357,56387,55357,56389,55357,56388,55357,56397,55357,56398,55357,56396,55357,56394,9996,9995,55357,56400,55357,56390,55357,56391,55357,56393,55357,56392,55357,56911,55357,56399,55357,56490,55357,57014,55356,57283,55357,56451,55357,56427,55357,56426,55357,56428,55357,56429,55357,56453,55356,57257,55357,56401,55357,56402,55357,56415,55357,56414,55357,56416,55357,56405,55357,56407,55357,56406,55357,56409,55357,56412,55357,56403,55356,57216,55357,56452,55357,56475,55357,56473,55357,56476,55357,56474,55357,56461,55357,56462,55357,56374,55357,56378,55357,56369,55357,56365,55357,56377,55357,56368,55357,56376,55357,56367,55357,56360,55357,56379,55357,56375,55357,56366,55357,56343,55357,56372,55357,56337,55357,56344,55357,56380,55357,56359,55357,56357,55357,56340,55357,56333,55357,56354,55357,56347,55357,56349,55357,56348,55357,56350,55357,56332,55357,56345,55357,56346,55357,56351,55357,56364,55357,56331,55357,56336,55357,56330,55357,56363,55356,57152,55356,57145,55356,57147,55356,57153,55356,57150,55356,57156,55356,57141,55356,57140,55356,57139,55356,57118,55356,57114,55356,57113,55356,57102,55356,57099,9889,9748,10052,9924,55356,57088,55356,57096,55356,57098,55356,57235,55356,57222,55356,57219,55357,56443,55356,57221,55356,57220,55356,57217,55356,57224,55357,56622,55356,57253,55357,56567,55357,56511,55357,56507,9742,55357,56545,55357,56570,55357,56571,55357,56585,55357,56596,9203,9200,8986,55357,56594,55357,56593,55357,56590,55357,56481,55357,56614,55357,56588,55357,56587,55357,57023,55357,57021,55357,56615,55357,56616,55357,57002,55357,57004,55357,56483,55357,56619,55357,56618,55357,56458,55357,56457,55357,56496,55357,56501,55357,56499,9993,55357,56555,55357,56550,55357,56517,55357,56513,9986,55357,56524,55357,56526,10002,9999,55357,56528,55357,56538,55357,56620,55357,56621,55356,57256,55356,57260,55356,57252,55356,57255,55356,57269,55356,57273,55356,57275,55356,57274,55356,57272,55357,56446,55356,57262,55356,56527,55356,57266,55356,57263,55356,57288,55356,57280,9917,9918,55356,57278,55356,57265,55356,57289,55356,57267,55356,57281,55356,57287,55356,57286,55356,57290,55356,57284,9749,55356,57212,55356,57210,55356,57207,55356,57204,55356,57173,55356,57172,55356,57183,55356,57175,55356,57201,55356,57178,55356,57180,55356,57185,55356,57203,55356,57182,55356,57193,55356,57190,55356,57218,55356,57200,55356,57194,55356,57195,55356,57197,55356,57199,55356,57166,55356,57167,55356,57162,55356,57163,55356,57170,55356,57159,55356,57161,55356,57171,55356,57169,55356,57164,55356,57168,55356,57165,55356,57158,55356,57157,55356,57149,55356,57313,55356,57317,55356,57318,9962,55356,57328,9978,55356,57325,55357,56827,55357,56829,55356,57248,55356,57249,9970,55356,57250,55357,56994,55357,56996,9875,55357,56960,9992,55357,56961,55357,56962,55357,56971,55357,56974,55357,56972,55357,56985,55357,56983,55357,56981,55357,56987,55357,57e3,55357,56980,55357,56978,55357,56977,55357,57010,55357,56992,55357,56988,55357,56998,9888,55357,56999,9981,55356,57264,55357,56831,55356,57258,55356,57261,55356,56815,55356,56821,55356,56816,55356,56823,55356,56809,55356,56810,55356,56808,55356,56819,55356,56826,55356,56824,55356,56811,55356,56823,55356,56810,55356,56824,55356,56814,55356,56825,55356,56823,55356,56826,55356,56812,55356,56807,49,8419,50,8419,51,8419,52,8419,53,8419,54,8419,55,8419,56,8419,57,8419,48,8419,55357,56607,10071,10067,9829,9830,55357,56495,55357,56599,55357,56625,55357,56628,55357,56629,55357,56630,55357,56631]),ne=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,87,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,160,162,164,166,168,170,172,174,176,178,180,182,184,186,188,190,192,194,196,198,200,202,204,206,208,210,212,214,216,218,220,222,224,226,228,230,232,234,236,238,240,242,244,246,248,250,252,254,256,258,259,260,261,262,264,266,268,270,272,274,276,278,280,282,284,286,288,290,292,294,295,297,299,301,303,305,306,307,308,310,312,314,316,318,320,322,324,326,328,330,332,334,336,338,340,342,344,346,348,350,351,353,355,357,359,360,362,364,365,366,368,370,372,374,376,378,380,382,384,386,388,390,392,394,396,398,400,402,404,406,407,408,410,412,414,416,418,420,422,424,426,427,429,431,433,435,437,439,441,443,445,447,449,451,453,455,457,459,461,463,465,467,469,471,473,475,477,479,481,483,485,487,489,491,493,495,497,499,501,503,505,507,508,510,511,513,515,517,519,521,522,524,526,528,529,531,532,534,536,538,540,542,544,546,548,550,552,554,556,558,560,562,564,566,567,569,570,572,574,576,578,582,586,590,594,598,602,606,610,614,618,620,622,624,626,628,630,632,634,636,638,640,641,642,643,644,646,648,650,652,654,656,658];(0,H.aJ)("apiUpdate",((e,t,n)=>{const{activeGroupCallId:a}=e.groupCalls;switch(n["@type"]){case"updateGroupCallLeavePresentation":t.toggleGroupCallPresentation({value:!1});break;case"updateGroupCallStreams":if(!n.userId||!a)break;if(!(0,Y.n5)(e,a,n.userId))break;return(0,q.c5)(e,a,n.userId,(0,X.cJ)(n,["@type","userId"]));case"updateGroupCallConnectionState":if(!a)break;if("disconnected"===n.connectionState){"leaveGroupCall"in t&&t.leaveGroupCall({isFromLibrary:!0,tabId:(0,z.g0)()});break}return(0,q.h9)(e,a,{connectionState:n.connectionState,isSpeakerDisabled:n.isSpeakerDisabled});case"updateGroupCallParticipants":{const{groupCallId:e,participants:t}=n;a===e&&V(t);break}case"updateGroupCallConnection":{if(n.data.stream){t.showNotification({message:"Big live streams are not yet supported",tabId:(0,z.g0)()}),"leaveGroupCall"in t&&t.leaveGroupCall({tabId:(0,z.g0)()});break}!async function(e,t){if(!C)return;const n=t?C.screenshareConference:C.conference,a=t?C.screenshareConnection:C.connection;if(!n||!a||!n.ssrcs)return;const i=Date.now(),o={...n,transport:e.transport,sessionId:i,audioExtensions:e.audio?.["rtp-hdrexts"],audioPayloadTypes:e.audio?.["payload-types"],videoExtensions:e.video?.["rtp-hdrexts"],videoPayloadTypes:e.video?.["payload-types"]};C={...C,...t?{screenshareConference:o}:{conference:o}};try{await a.setRemoteDescription({type:"answer",sdp:f(o,!0,t)})}catch(e){console.error(e)}}(n.data,n.presentation);const a=(0,Y.iT)(e);a?.participants&&Object.keys(a.participants).length>0&&V(Object.values(a.participants));break}case"updatePhoneCallMediaState":return{...e,phoneCall:{...e.phoneCall,...(0,X.cJ)(n,["@type"])}};case"updatePhoneCall":{if(!i.OL)return;const{phoneCall:a,currentUserId:r}=e,s={...a,...n.call},c=a?.adminId===r;if(e={...e,phoneCall:s},(0,H.UF)(e),e=(0,H.mS)(),a&&a.id&&s.id!==a.id)return void("discarded"!==s.state&&(0,K.px)("discardCall",{call:s,isBusy:!0}));const{accessHash:l,state:d,connections:u,gB:p}=s;if(("active"===d||"accepted"===d)&&(o=s.protocol,!o?.libraryVersions.some((e=>"4.0.0"===e||"4.0.1"===e)))){const n=(0,Y.uu)(e);return"hangUp"in t&&t.hangUp({tabId:(0,z.g0)()}),void t.showNotification({message:ee.yE("VoipPeerIncompatible",n?.firstName),tabId:(0,z.g0)()})}if("discarded"===d){if(!a)return;return(0,W.w)(e,{...s.needRating&&{ratingPhoneCall:s},isCallPanelVisible:void 0},(0,z.g0)())}return"accepted"===d&&l&&p?(async()=>{const{gA:t,keyFingerprint:n,emojis:a}=await(0,K.px)("confirmPhoneCall",[p,te,ne]),i={...(e=(0,H.mS)()).phoneCall,emojis:a};e={...e,phoneCall:i},(0,H.UF)(e),(0,K.px)("confirmCall",{call:s,gA:t,keyFingerprint:n})})():"active"===d&&u&&"active"!==a?.state&&(c||((0,K.px)("receivedCall",{call:s}),(async()=>{const{emojis:t}=await(0,K.px)("confirmPhoneCall",[s.gAOrB,te,ne]),n={...(e=(0,H.mS)()).phoneCall,emojis:t};e={...e,phoneCall:n},(0,H.UF)(e)})()),async function(e,t,n,a,i,o){const r=new RTCPeerConnection({iceServers:e.map((e=>({urls:[e.isTurn&&`turn:${e.ip}:${e.port}`,e.isStun&&`stun:${e.ip}:${e.port}`].filter(Boolean),username:e.username,credentialType:"password",credential:e.password}))),iceTransportPolicy:i?"all":"relay",bundlePolicy:"max-bundle",iceCandidatePoolSize:10});r.onicecandidate=e=>{e.candidate&&t({"@type":"Candidates",candidates:[{sdpString:e.candidate.candidate}]})},r.onconnectionstatechange=()=>{o({"@type":"updatePhoneCallConnectionState",connectionState:r.connectionState})},r.ontrack=e=>{if(!b)return;const t=e.streams[0];"audio"===e.track.kind?(b.audio.srcObject=t,b.audio.play().catch(),b.streams.audio=t):"1"===e.transceiver.mid?b.streams.video=t:b.streams.presentation=t,B()},r.oniceconnectionstatechange=async e=>{switch(r.iceConnectionState){case"disconnected":case"failed":n&&await j(r,{offerToReceiveAudio:!0,offerToReceiveVideo:!0,iceRestart:!0})}};const s=v(new AudioContext),c=h({width:640,height:480}),l=h({width:640,height:480});r.addTrack(s.getTracks()[0],s),r.addTrack(c.getTracks()[0],c),r.addTrack(l.getTracks()[0],l);const d=r.createDataChannel("data",{id:0,negotiated:!0});d.onmessage=e=>{$(JSON.parse(e.data))};const u=new Audio;b={audio:u,connection:r,emitSignalingData:t,isOutgoing:n,pendingCandidates:[],onUpdate:o,streams:{ownVideo:c,ownAudio:s,ownPresentation:l},mediaState:{isBatteryLow:!1,screencastState:"inactive",videoState:"inactive",videoRotation:0,isMuted:!0},blackVideo:c,blackPresentation:l,silence:s,dataChannel:d};try{O("audio",!0)}catch(e){console.error(e)}n&&await j(r,{offerToReceiveAudio:!0,offerToReceiveVideo:!0})}(u,t.sendSignalingData,c,Boolean(s?.isVideo),Boolean(s.isP2pAllowed),t.apiUpdate)),e}case"updatePhoneCallConnectionState":{const{connectionState:a}=n;return e.phoneCall?"closed"===a||"disconnected"===a||"failed"===a?void("hangUp"in t&&t.hangUp({tabId:(0,z.g0)()})):{...e,phoneCall:{...e.phoneCall,isConnected:"connected"===a}}:e}case"updatePhoneCallSignalingData":{const{phoneCall:t}=e;if(!t)break;(0,K.px)("decodePhoneCallData",[n.data])?.then($);break}}var o}));var ae=n(84051),ie=n(87357),oe=n(43874),re=n(37661),se=n(5912),ce=n(17712),le=n(59030),de=n(90423),ue=n(73767),pe=n(93545),me=n(64493),ge=n(19806),fe=n(12933),ve=n(8410),he=n(96374),ye=n(46222),Ae=n(4961);function Ce(e){return Math.floor((e.volume||o.iRY)/o.CH0).toString()}var be=n(10722),Ee=n(21849),we=n(34431),Se=n(22720),ke=n(71851),Ie=n(672),Pe=n(4438),Ne=n(285),Te=n(71429),Me=n(24433);function xe(){return xe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},xe.apply(this,arguments)}const Ve=[0,17],Ge=[17,34],Re=(0,ae.ph)((0,H.EK)((e=>({isAdmin:(0,Y.qI)(e)})))((e=>{let{participant:t,onCloseAnimationEnd:n,onClose:a,isDropdownOpen:i,isAdmin:r,menuRef:s,...c}=e;const{toggleGroupCallMute:l,setGroupCallParticipantVolume:d,toggleGroupCallPanel:u,openChat:p,requestToSpeak:m}=(0,H.ko)(),g=(0,le.A)(),[f,v,h]=(0,re.A)(),y=t?.id,{isMutedByMe:A,isMuted:C,isSelf:b,canSelfUnmute:E}=t||{},w=Boolean(t?.raiseHandRating),S=!E&&C,[k,I]=(0,ae.J0)(A?0:(t?.volume||o.iRY)/o.CH0),[P,N]=(0,ae.J0)(!1),T=0===k,M=T?Ve:Ge;(0,ae.vJ)((()=>{i||N(!1)}),[i]);const x=(0,ce.A)((e=>{I(e),N(0===e!==T)}));(0,ae.vJ)((()=>{I(A?0:(t?.volume||o.iRY)/o.CH0)}),[y]);const V=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return(0,Ie.A)((e=>{e()}),n,e,t)}(500),G=(0,ce.A)((e=>{e.stopPropagation(),v(),a()})),R=(0,ce.A)((e=>{e.stopPropagation(),m({value:!1}),a()})),B=(0,ce.A)((e=>{e.stopPropagation(),a(),r?S&&x((t?.volume??o.iRY)/o.CH0):x(A?o.iRY/o.CH0:0),l({participantId:y,value:r?!S:!A})})),L=(0,ce.A)((e=>{e.stopPropagation(),u(),p({id:y}),a()}));return ae.Ay.createElement("div",null,ae.Ay.createElement(Te.A,xe({isOpen:i,ref:s,withPortal:!0,onClose:a,onCloseAnimationEnd:n,className:"participant-menu with-menu-transitions"},c),!b&&!S&&ae.Ay.createElement("div",{className:"group"},ae.Ay.createElement("div",{className:(0,ie.A)("volume-control",k<50&&"low",k>=50&&k<100&&"medium",k>=100&&k<150&&"normal",k>=150&&"high")},ae.Ay.createElement("input",{type:"range",min:"0",max:"200",value:k,onChange:e=>{const t=Number(e.target.value);x(t),V((()=>{0===t?l({participantId:y,value:!0}):d({participantId:y,volume:Math.floor(t*o.CH0)})}))}}),ae.Ay.createElement("div",{className:"info"},ae.Ay.createElement(Pe.A,{tgsUrl:ke.w.Speaker,play:!!P&&M.toString(),playSegment:M,size:24}),ae.Ay.createElement("span",null,k,"%")))),ae.Ay.createElement("div",{className:"group"},w&&b&&ae.Ay.createElement(Me.A,{icon:"stop-raising-hand",onClick:R},g("VoipGroupCancelRaiseHand")),!b&&ae.Ay.createElement(Me.A,{icon:"user",onClick:L},g("VoipGroupOpenProfile")),!b&&ae.Ay.createElement(Me.A,{icon:C&&r&&S?"allow-speak":"microphone-alt",onClick:B},g(r?S?"VoipGroupAllowToSpeak":"VoipMute":A?"VoipGroupUnmuteForMe":"VoipGroupMuteForMe")),!b&&r&&ae.Ay.createElement(Me.A,{icon:"delete-user",destructive:!0,onClick:G},g("VoipGroupUserRemove")))),!b&&r&&ae.Ay.createElement(Ne.A,{isOpen:f,userId:y,onClose:h}))}))),Be=(0,ae.ph)((e=>{let{participant:t,noColor:n,className:a}=e;const{isMuted:i,isMutedByMe:o}=t,r=(t.amplitude||0)>d,s=Boolean(t.raiseHandRating),c=(0,ue.A)(s),l=!Boolean(t?.canSelfUnmute)&&i,u=(0,ue.A)(i),p=(0,ae.Kr)((()=>i&&!u?[43,64]:!i&&u?[22,42]:s&&!c?[65,84]:!l&&c?[0,21]:i?[22,23]:[43,44]),[i,l,s]),m=(0,ae.Kr)((()=>n?"#ffffff":s?"#4da6e0":l||o?"#ff706f":r?"#57bc6c":"#aaaaaa"),[n,s,l,o,r]);return ae.Ay.createElement(Pe.A,{tgsUrl:ke.w.VoiceOutlined,play:p.toString(),playSegment:p,size:28,color:m,className:a,forceAlways:!0,nonInteractive:!0})})),Le={root:"Wk7JwPx3",subtitle:"ShcCNemD",subtitleText:"UZLgp2cx",icon:"vRc6jhKf",subtitleBlue:"yA7bxEWw",subtitleRed:"DnuZwImI",subtitleGreen:"BkgYQGFq",avatar:"ouHUJ9ff"},Oe=(0,ae.ph)((0,H.EK)(((e,t)=>{let{participant:n}=t;return{peer:(0,Z.mBe)(e,n.id)||(0,Z.hds)(e,n.id)}}))((e=>{let{participant:t,peer:n}=e;const a=(0,ae.li)(null),i=(0,ae.li)(null),r=(0,le.A)(),{isSelf:s,isMutedByMe:c,isMuted:l,hasVideoStream:u,hasPresentationStream:p}=t,m=(t.amplitude||0)>d,g=Boolean(t.raiseHandRating),{isContextMenuOpen:f,contextMenuAnchor:v,handleContextMenu:h,handleBeforeContextMenu:y,handleContextMenuClose:A,handleContextMenuHide:C}=(0,be.A)(a,s),b=(0,ae.hb)((()=>a.current),[]),E=(0,ae.hb)((()=>a.current.closest(".custom-scroll, .no-scrollbar")),[]),w=(0,ae.hb)((()=>i.current),[]),S=(0,ae.hb)((()=>({withPortal:!0})),[]),k=Boolean(!l&&m&&t.volume&&t.volume!==o.iRY),[I,P]=(0,ae.Kr)((()=>c?[r("VoipGroupMutedForMe"),Le.subtitleRed]:g?[r("WantsToSpeak"),Le.subtitleBlue]:k?[r("SpeakingWithVolume",Ce(t)).replace("%%","%"),Le.subtitleGreen]:!l&&m?[r("Speaking"),Le.subtitleGreen]:s?[r("ThisIsYou"),Le.subtitleBlue]:t.about?[t.about,""]:[r("Listening"),Le.subtitleBlue]),[c,g,k,l,m,s,t,r]);if(n)return ae.Ay.createElement(Se.A,{leftElement:ae.Ay.createElement(Ee.A,{peer:n,className:Le.avatar}),rightElement:ae.Ay.createElement(Be,{participant:t,className:Le.icon}),className:Le.root,onClick:h,onMouseDown:y,onContextMenu:h,multiline:!0,ripple:!0,ref:a},ae.Ay.createElement(we.A,{peer:n,withEmojiStatus:!0,className:Le.title}),ae.Ay.createElement("span",{className:(0,ie.A)(Le.subtitle,"subtitle",P)},p&&ae.Ay.createElement("i",{className:"icon icon-share-screen","aria-hidden":!0}),u&&ae.Ay.createElement("i",{className:"icon icon-video","aria-hidden":!0}),k&&ae.Ay.createElement("i",{className:"icon icon-speaker","aria-hidden":!0}),ae.Ay.createElement("span",{className:Le.subtitleText},(0,Ae.A)(I))),ae.Ay.createElement(Re,{participant:t,isDropdownOpen:f,anchor:v,getTriggerElement:b,getRootElement:E,getMenuElement:w,getLayout:S,onClose:A,onCloseAnimationEnd:C,menuRef:i}))})));function Ue(e,t){return(0,X.zV)(!e.isMuted,!t.isMuted)||(0,X.zV)(e.presentation,t.presentation)||(0,X.zV)(e.video,t.video)||(0,X.zV)(e.raiseHandRating,t.raiseHandRating)}const _e=(0,ae.ph)((0,H.EK)((e=>{const{participantsCount:t,participants:n}=(0,Y.iT)(e)||{};return{participants:n,participantsCount:t||0}}))((e=>{let{panelOffset:t,participants:n,participantsCount:a,isLandscape:i}=e;const{loadMoreGroupCallParticipants:o}=(0,H.ko)(),r=(0,ae.Kr)((()=>Object.values(n||{}).sort(Ue).map((e=>e.id))),[n]),s=(0,ce.A)((()=>{o()})),[c,l]=(0,he.A)(s,r,r.length>=a);return ae.Ay.createElement(ye.A,{items:c,onLoadMore:l,style:`transform: translateY(${t}px);`,className:(0,ie.A)("npTa6CmI",!i&&"v7oB2HTv")},n&&c?.map((e=>n[e]&&ae.Ay.createElement(Oe,{key:e,teactOrderKey:r.indexOf(e),participant:n[e]}))))})));var De=n(32610),Fe=n(66644),$e=n(19822),Je=n(37836),je=n(32625),ze=n(55158);const Ke="eUXuK9Oz",He="O2bTiH2E",qe=(0,ae.ph)((0,H.EK)(((e,t)=>{let{participant:n}=t;return{user:n.isUser?(0,Z.mBe)(e,n.id):void 0,chat:n.isUser?void 0:(0,Z.hds)(e,n.id)}}))((e=>{let{layout:t,pinnedVideo:n,setPinned:a,canPin:r,className:s,participant:c,user:l,chat:u}=e;const p=(0,le.A)(),m=(0,ae.li)(null),g=(0,ae.li)(null),f=(0,ae.li)(null),{x:v,y:h,width:y,height:A,noAnimate:C,isRemoved:b,type:E}=t,{isSelf:S,isMutedByMe:k,isMuted:I}=c,P=n?.id===c.id&&n?.type===E,N=(c.amplitude||0)>d,T=Boolean(c.raiseHandRating),M="video"===E&&c.isSelf,x=(0,ae.Kr)((()=>S?p("ThisIsYou"):k?p("VoipGroupMutedForMe"):T?p("WantsToSpeak"):I||!N?p("Listening"):c.volume&&c.volume!==o.iRY?p("SpeakingWithVolume",Ce(c)).replace("%%","%"):p("Speaking")),[S,k,T,I,N,c,p]),V=(0,ae.li)();b||(V.current=t);const{x:G,y:R,width:B,height:L}=V.current||{},[O,U,_,D]=b?[G,R,B,L]:[v,h,y,A],[F,$]=(0,ae.J0)(!C),J=w(l?.id||u.id),j="video"===E?J?.video:J?.presentation,z=(0,ae.li)(j);j?.active&&j?.getVideoTracks()[0].enabled&&(z.current=j);const K=z.current,H=(0,ce.A)((()=>{const e=g.current;e&&(e.srcObject=null)}));(0,ae.vJ)((()=>(K?.addEventListener("inactive",H),()=>{K?.removeEventListener("inactive",H)})),[H,K]),(0,ae.vJ)((()=>{$(!1)}),[]);const[q,W]=(0,ae.J0)(!0),Z=(0,ce.A)((()=>{W(!1)}));(0,je.A)((()=>{if(!K?.active)return;const e=g.current,t=f.current;(0,Fe.RK)((()=>{t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0,t.width,t.height)}))}),1e3),(0,ae.vJ)((()=>{const e=g.current,t=m.current;if(!e||!t||!K)return;const n=t.getContext("2d",{alpha:!1});if(!n)return;let a=!0;return(0,Fe.RK)((()=>{a&&(t.width=16,t.height=16,n.filter="blur(2px)",(0,$e.i0)((()=>!!a&&!!K.active&&(n.drawImage(e,0,0,e.videoWidth,e.videoHeight,0,0,t.width,t.height),i.QH||(0,De.A)(n,0,0,t.width,t.height,2,2),!0)),Je.IJ))})),()=>{a=!1}}),[K]);const Y=(0,ae.li)(null),Q=(0,ae.li)(null),{isContextMenuOpen:X,contextMenuAnchor:ee,handleContextMenu:te,handleContextMenuClose:ne,handleContextMenuHide:oe}=(0,be.A)(Y,S),re=(0,ae.hb)((()=>Y.current),[]),se=(0,ae.hb)((()=>Y.current.closest(".custom-scroll, .no-scrollbar")),[]),de=(0,ae.hb)((()=>Q.current),[]),ue=(0,ae.hb)((()=>({withPortal:!0})),[]),pe=(0,ae.hb)((()=>{a(P?void 0:{id:l?.id||u.id,type:E})}),[u,P,a,E,l?.id]);return ae.Ay.createElement("div",{className:(0,ie.A)("DKuzmnN7",(F||b)&&"T_wodAHA",C&&"yPCkJzpi",s,P&&"B4WZhF9P"),style:`--x: ${O}px; --y: ${U}px; --width: ${_}px; --height: ${D}px;`,ref:Y,onContextMenu:te,onDoubleClick:r?pe:void 0},ae.Ay.createElement("div",{className:(0,ie.A)("eBq1NoLo",N&&"h4NcT6OS")},q&&ae.Ay.createElement(ze.A,{className:(0,ie.A)(Ke,"XedVWQii")}),K&&ae.Ay.createElement("video",{className:(0,ie.A)(Ke,M&&He),muted:!0,autoPlay:!0,playsInline:!0,srcObject:K,ref:g,onCanPlay:Z}),ae.Ay.createElement("canvas",{className:(0,ie.A)("eTpvBU_b eUXuK9Oz",M&&He),ref:f}),ae.Ay.createElement("div",{className:"R5ULTrF9"},ae.Ay.createElement("canvas",{className:(0,ie.A)("cjUWuViy",M&&He),ref:m})),r&&ae.Ay.createElement(me.A,{round:!0,size:"smaller",ripple:!0,color:"translucent",className:"lPdblo0y",ariaLabel:p(P?"lng_group_call_context_unpin_camera":"lng_group_call_context_pin_camera"),onClick:pe},ae.Ay.createElement("i",{className:(0,ie.A)("icon",P?"icon-unpin":"icon-pin")})),ae.Ay.createElement("div",{className:"T1deCDSn"},ae.Ay.createElement("div",{className:"LzFFayK3"},ae.Ay.createElement(we.A,{peer:l||u,className:"RBwMAuKp"}),ae.Ay.createElement("div",{className:"z1ZZTsjC"},x)),ae.Ay.createElement(Be,{participant:c,className:"j1aDzn1H",noColor:!0}))),ae.Ay.createElement(Re,{participant:c,isDropdownOpen:X,anchor:ee,getTriggerElement:re,getRootElement:se,getMenuElement:de,getLayout:ue,onClose:ne,onCloseAnimationEnd:oe,menuRef:Q}))}))),We=()=>{navigator.vibrate?.(50)};var Ze=n(57474);const Ye=(0,ae.ph)((0,H.EK)((e=>{const t=(0,Y.iT)(e),{connectionState:n}=t||{},a=t&&(0,Y.n5)(e,t.id,e.currentUserId),{raiseHandRating:i,hasAudioStream:o,canSelfUnmute:r,isMuted:s}=a||{};return{connectionState:n||"discarded",hasRequestedToSpeak:Boolean(i),noAudioStream:!o,canSelfUnmute:r,isMuted:s}}))((e=>{let{className:t,noAudioStream:n,canSelfUnmute:a,isMuted:i,connectionState:o}=e;const{toggleGroupCallMute:r,requestToSpeak:s,playGroupCallSound:c}=(0,H.ko)(),l=(0,le.A)(),d=(0,ae.li)("up"),[u,p]=(0,ae.J0)(!1),m="connected"!==o,g=!a&&i,f=(0,ue.A)(g);(0,ae.vJ)((()=>{f&&!g&&c({sound:"allowTalk"})}),[c,f,g]);const v=(0,ae.Kr)((()=>{if(u){const e=Math.floor(100*Math.random());return e<32?[0,120]:e<64?[120,240]:e<97?[240,420]:[420,540]}return!f&&g?n?[99,135]:[136,172]:f&&!g?[0,36]:g?[0,0]:n?[69,99]:[36,69]}),[f,u,n,g]),h=u?"HandFilled":"VoiceMini",y=(0,ae.hb)((()=>{We(),r()}),[r]),A=(0,ae.hb)((()=>{if(g){if(u)return;return We(),s(),p(!0),void setTimeout((()=>{p(!1)}),3e3)}d.current="down",n&&setTimeout((()=>{"down"===d.current&&(d.current="hold",y())}),200)}),[u,n,s,g,y]),C=(0,ae.hb)((()=>{g||(y(),d.current="up")}),[g,y]);return ae.Ay.createElement(me.A,{round:!0,size:"default",className:(0,ie.A)("lKdhQ5pw",!m&&n&&"bjKqp3SI",!m&&g&&"Ynow5UuE",t),onMouseDown:A,onMouseUp:C,ariaLabel:l(i?"VoipUnmute":"VoipMute"),disabled:m},ae.Ay.createElement(Pe.A,{tgsUrl:ke.w[h],size:36,play:v.toString(),playSegment:v,className:"Ea1XnQaX",forceAlways:!0}),ae.Ay.createElement(Ze.A,{className:(0,ie.A)("tyQNJC6B",m&&"LowChABq"),color:"white"}))}))),Qe={root:"OsO5GKfn",panelWrapper:"cUVoePr_",panel:"Thuz79M3",panelScrollTrigger:"zoK6Y6IS",panelHeader:"DMBtCL9Z",scrolled:"GdEH1Agb",fullscreen:"JJx0QI2w",landscape:"wamCuzMB",headerButton:"gmyieSid",firstButton:"hVnn6KBp",lastButton:"iy78A5rG",panelHeaderText:"TwEEA77i",title:"pNZ9skLf",bigger:"NumT3v5i",subtitle:"gmfUKabx",participants:"iTeC_RxH",participantVideos:"PZmKIdTl",addParticipantButton:"clmu2oBt",videos:"ATwoMlAV",mainVideoContainer:"hqFon3dV",videosHeader:"KPHc659W",appFullscreen:"cl2sfoBF",videosHeaderLastButton:"_t50HVNJ",videosContent:"oEEQZilE",actions:"uGzi9s97",actionButton:"foXbVcnN",destructive:"YIR9Z9CZ",canRequestToSpeak:"ZoiZQu_O",muted:"wpvv1V6m",portrait:"R6HQcMwx",noVideoParticipants:"aepCFyJQ",noSidebar:"XjgP21E6"},Xe=(0,ae.ph)((0,H.EK)(((e,t)=>{let{groupCallId:n}=t;const{connectionState:a,title:i,participants:o,participantsCount:r,chatId:s}=(0,Y.Ip)(e,n)||{},c=s?(0,Z.hds)(e,s):void 0;return{connectionState:a,title:i||c?.title,participantsCount:r,meParticipant:(0,Y.n5)(e,n,e.currentUserId),isCallPanelVisible:Boolean((0,Z.nTw)(e).isCallPanelVisible),isAdmin:(0,Y.qI)(e),participants:o,canInvite:(0,Y.O7)(e)}}))((e=>{let{groupCallId:t,isCallPanelVisible:n,connectionState:a,participantsCount:i,title:o,meParticipant:r,isAdmin:s,participants:c,canInvite:l}=e;const{toggleGroupCallVideo:d,toggleGroupCallPresentation:p,leaveGroupCall:m,toggleGroupCallPanel:g,connectToActiveGroupCall:f,playGroupCallSound:v,createGroupCallInviteLink:h}=(0,H.ko)(),y=(0,le.A)(),A=(0,ae.li)(null),C=(0,ae.li)(null),b=(0,ae.li)(null),E=(0,ae.li)(null),w=(0,ae.li)(null),[S,k]=(0,ae.J0)(!1),I=!n&&!S,{observe:P}=(0,se.BL)({rootRef:w,throttleMs:200,isDisabled:!I}),N=!(0,se.Vz)(E,I?P:void 0),{isMobile:T,isLandscape:M}=(0,oe.Ay)(),[x,V,G]=(0,re.A)(),[R,B,L]=(0,re.A)(!0),O=Boolean(x&&M),U=(0,de.zk)(),_=(0,ae.Kr)((()=>Object.values(c).find((e=>{let{presentation:t}=e;return t}))),[c]),D=(0,ae.Kr)((()=>Object.values(c).filter((e=>{let{video:t,presentation:n}=e;return t||n})).flatMap((e=>{let{id:t,video:n,presentation:a}=e;return(0,X.oE)([n?{id:t,type:"video"}:void 0,a?{id:t,type:"screen"}:void 0])}))),[c]),F=D.length>0,$=o||y("VoipGroupVoiceChat"),J=y("Participants",i,"i"),[j,z,K]=(0,re.A)(),[q,W]=(0,ae.J0)(!1),[Z,Y]=(0,ae.J0)(!1),Q=r?.hasVideoStream,ee=r?.hasPresentationStream,te=r?.hasAudioStream,ne="connected"!==a,he=r?.canSelfUnmute,ye=!he&&!te;(0,ae.vJ)((()=>{"connected"===a?v({sound:"join"}):"reconnecting"===a&&v({sound:"connecting"})}),[a]);const Ae=(0,ce.A)((()=>{K(),W(!1)})),Ce=(0,ce.A)((()=>{A.current&&!T&&(x?G():V())})),be=(0,ce.A)((()=>{R?L():B()})),Ee=(0,ce.A)((()=>{g()})),we=(0,ce.A)((()=>{h()})),Se=(0,ce.A)((()=>{d()}));(0,ae.vJ)((()=>{f()}),[f,t]);const ke=(0,ce.A)((()=>{!s||j?(v({sound:"leave"}),k(!0),K()):z()})),Ie=(0,ce.A)((()=>{S&&m({shouldDiscard:Z})})),Pe=(0,ce.A)((()=>{p()})),Ne=D.length>1&&!T,Te=O&&F,[Me,xe]=(0,ae.J0)(void 0),{videoLayout:Ve,panelOffset:Ge}=function(e){let{primaryContainerRef:t,secondaryContainerRef:n,videoParticipants:a,isLandscapeLayout:i,pinnedVideo:o}=e;const[r,s]=(0,ae.J0)([]),[c,l]=(0,ae.J0)(0),d=a.length,u=(0,ue.A)(d),p=(0,ue.A)(a),m=(0,ae.Kr)((()=>p?.filter((e=>{let{id:t,type:n}=e;return!a.some((e=>e.id===t&&e.type===n))}))),[p,a]),g=(0,ce.A)((()=>{const e=t.current,r=n.current;if(!r)return;const c=void 0!==u&&u>d?u-d:0,{x:p,y:g,width:f}=r.getBoundingClientRect(),v=[];if(void 0!==o||!e||!i){const t=!0;let n,r=!1,u=0,h=a;if(o&&e&&i&&(u=h.findIndex((e=>{let{id:t,type:n}=e;return t===o.id&&n===o.type})),-1!==u)){const{x:t,y:a,width:i,height:s}=e.getBoundingClientRect(),{id:c,type:l}=o;n={x:t,y:a,width:i,height:s,participantId:c,type:l,orderKey:u},r=!0,h=h.filter((e=>{let{id:t,type:n}=e;return t!==c||n!==o.type}))}const y=r?d-1:d,A=y%2==1,C=2,b=Math.ceil(y/C),E=(f-10*(C-1))/C,w=Math.max(0,A?240+(b-1)*E+8*(b-1):b*E+8*(b-1));for(let e=0;e<y;e++){const n=A&&0===e,a=n?f:E,i=n?240:E,o=A&&0!==e?e+1:e,r=(t?0:p)+o%C*(a+10),s=(t?0:g)+(A&&0!==e?248+(Math.floor(o/C)-1)*(i+8):Math.floor(o/C)*(i+8));v.push({x:r,y:s,width:a,height:i,shouldRemount:!t,isRemounted:t,noAnimate:!0,participantId:h[e].id,type:h[e].type,orderKey:e>=u?e+1:e})}if(n&&v.splice(u,0,n),m)for(let e=0;e<c;e++)v.push({x:0,y:0,width:0,height:0,isRemounted:t,isRemoved:!0,participantId:m[e].id,type:m[e].type,orderKey:e+d});return l(w),void s(v)}const{x:h,y,width:A,height:C}=e.getBoundingClientRect(),b=function(e){return e>=25?5:e>=13?4:e>=7?3:e>=3?2:1}(d),E=Math.ceil(d/b),w=E*b>d,S=(A-10*(b-1))/b,k=(C-8*(E-1))/E,I=S*(d%b);for(let e=0;e<d;e++){const t=Math.floor(e/b),n=h+e%b*(S+10)+(w&&t===E-1?(A-I)/2:0),i=y+Math.floor(e/b)*(k+8);v.push({x:n,y:i,width:S,height:k,participantId:a[e].id,type:a[e].type,orderKey:e})}if(m)for(let e=0;e<c;e++)v.push({x:0,y:0,width:0,height:0,isRemoved:!0,participantId:m[e].id,type:m[e].type,orderKey:e+d});l(0),s(v)}));return(0,ae.vJ)(g,[g,a,i,o]),(0,pe.A)(t,g,!t.current),(0,pe.A)(n,g,!n.current),{videoLayout:r,panelOffset:c}}({primaryContainerRef:C,secondaryContainerRef:b,videoParticipants:D,isLandscapeLayout:O,pinnedVideo:Me}),Re=(0,ce.A)((e=>{xe(e),e&&!x&&V()})),Be=(0,ce.A)((()=>{_&&xe({id:_.id,type:"screen"})}));return(0,ae.vJ)(Be,[Be,Boolean(_)]),(0,ae.vJ)((()=>{Me&&(D.some((e=>e.type===Me.type&&e.id===Me.id))||xe(void 0))}),[Me,Ve,D]),ae.Ay.createElement(ve.A,{isOpen:I,onClose:g,className:(0,ie.A)(Qe.root,(x||T)&&Qe.fullscreen,U&&Qe.appFullscreen,O&&Qe.landscape,!F&&Qe.noVideoParticipants,!O&&Qe.portrait,!R&&Te&&Qe.noSidebar),dialogRef:A,onCloseAnimationEnd:Ie},Te&&ae.Ay.createElement("div",{className:Qe.videos},ae.Ay.createElement("div",{className:Qe.videosHeader},!T&&ae.Ay.createElement(me.A,{round:!0,size:"smaller",color:"translucent",onClick:Ce,className:(0,ie.A)(Qe.headerButton,Qe.firstButton),ariaLabel:y(x?"AccExitFullscreen":"AccSwitchToFullscreen")},ae.Ay.createElement("i",{className:(0,ie.A)("icon",x?"icon-smallscreen":"icon-fullscreen"),"aria-hidden":!0})),ae.Ay.createElement("h3",{className:(0,ie.A)(Qe.title,Qe.bigger)},o||y("VoipGroupVoiceChat")),Te&&!R&&ae.Ay.createElement(me.A,{round:!0,size:"smaller",color:"translucent",className:(0,ie.A)(Qe.headerButton,Qe.videosHeaderLastButton),onClick:be,ariaLabel:y("AccDescrExpandPanel")},ae.Ay.createElement("i",{className:"icon icon-sidebar","aria-hidden":!0}))),ae.Ay.createElement("div",{className:Qe.videosContent,ref:C})),ae.Ay.createElement("div",{className:Qe.panelWrapper,ref:w},ae.Ay.createElement("div",{className:(0,ie.A)(Qe.panel,"custom-scroll")},ae.Ay.createElement("div",{className:Qe.panelScrollTrigger,ref:E}),ae.Ay.createElement("div",{className:(0,ie.A)(Qe.panelHeader,N&&Qe.scrolled)},!Te&&!T&&ae.Ay.createElement(me.A,{round:!0,size:"smaller",color:"translucent",ripple:!T,className:(0,ie.A)(Qe.firstButton,Qe.headerButton),onClick:Ce,ariaLabel:y("AccSwitchToFullscreen")},ae.Ay.createElement("i",{className:"icon icon-fullscreen","aria-hidden":!0})),T&&ae.Ay.createElement(me.A,{round:!0,size:"smaller",color:"translucent",onClick:Ee,className:(0,ie.A)(Qe.headerButton,Qe.firstButton),ariaLabel:y("Close")},ae.Ay.createElement("i",{className:(0,ie.A)("icon","icon-close"),"aria-hidden":!0})),Te&&ae.Ay.createElement(me.A,{round:!0,size:"smaller",ripple:!T,className:(0,ie.A)(Qe.firstButton,Qe.headerButton),color:"translucent",onClick:be,ariaLabel:y("AccDescrCollapsePanel")},ae.Ay.createElement("i",{className:"icon icon-sidebar","aria-hidden":!0})),ae.Ay.createElement("div",{className:Qe.panelHeaderText},ae.Ay.createElement("h3",{className:(0,ie.A)(Qe.title,Te&&Qe.bigger)},Te?J:$),!Te&&ae.Ay.createElement("span",{className:Qe.subtitle},J)),!Te&&l&&ae.Ay.createElement(me.A,{round:!0,size:"smaller",ripple:!T,className:(0,ie.A)(Qe.lastButton,Qe.headerButton),color:"translucent",onClick:we,ariaLabel:y("VoipGroupInviteMember")},ae.Ay.createElement("i",{className:"icon icon-add-user","aria-hidden":!0}))),ae.Ay.createElement("div",{className:Qe.participants},ae.Ay.createElement("div",{className:Qe.participantVideos,ref:b,style:`height: ${Ge}px;`},Ve.map((e=>{const t=c[e.participantId];return e.isRemounted&&t?ae.Ay.createElement(qe,{teactOrderKey:e.orderKey,key:`${e.participantId}_${e.type}`,layout:e,canPin:Ne,setPinned:Re,pinnedVideo:Me,participant:t}):ae.Ay.createElement("div",{teactOrderKey:e.orderKey,key:`${e.participantId}_${e.type}`})}))),ae.Ay.createElement(_e,{panelOffset:Ge,isLandscape:Te}))),ae.Ay.createElement(fe.A,{key:"add-participant",isShown:Te&&l,onClick:we,className:Qe.addParticipantButton,ariaLabel:y("VoipGroupInviteMember")},ae.Ay.createElement("i",{className:"icon icon-add-user-filled","aria-hidden":!0}))),ae.Ay.createElement("div",{className:Qe.mainVideoContainer},Ve.map((e=>{const t=c[e.participantId];return e.isRemounted||!t?ae.Ay.createElement("div",{teactOrderKey:e.orderKey,key:`${e.participantId}_${e.type}`}):ae.Ay.createElement(qe,{teactOrderKey:e.orderKey,key:`${e.participantId}_${e.type}`,layout:e,canPin:Ne,setPinned:Re,pinnedVideo:Me,participant:t,className:Qe.video})}))),ae.Ay.createElement("div",{className:Qe.actions},ae.Ay.createElement(me.A,{round:!0,size:"default",ripple:!0,className:(0,ie.A)(Qe.actionButton,!te&&Qe.muted,ye&&Qe.canRequestToSpeak),onClick:Se,ariaLabel:y(Q?"VoipStopVideo":"VoipStartVideo"),disabled:ne},ae.Ay.createElement("i",{className:(0,ie.A)("icon",Q?"icon-video":"icon-video-stop"),"aria-hidden":!0})),ae.Ay.createElement(me.A,{round:!0,size:"default",ripple:!0,className:(0,ie.A)(Qe.actionButton,!te&&Qe.muted,ye&&Qe.canRequestToSpeak),onClick:Pe,ariaLabel:y(ee?"lng_group_call_screen_share_stop":"lng_group_call_tooltip_screen"),disabled:ne||!u},ae.Ay.createElement("i",{className:(0,ie.A)("icon",ee?"icon-share-screen":"icon-share-screen-stop"),"aria-hidden":!0})),ae.Ay.createElement(Ye,{className:Qe.actionButton}),ae.Ay.createElement(me.A,{round:!0,size:"default",ripple:!0,className:(0,ie.A)(Qe.actionButton,!te&&Qe.muted,ye&&Qe.canRequestToSpeak),ariaLabel:y("lng_group_call_settings"),disabled:!0},ae.Ay.createElement("i",{className:"icon icon-settings-filled","aria-hidden":!0})),ae.Ay.createElement(me.A,{round:!0,size:"default",ripple:!0,className:(0,ie.A)(Qe.actionButton,Qe.destructive),onClick:ke,ariaLabel:y("lng_group_call_leave")},ae.Ay.createElement("i",{className:"icon icon-close","aria-hidden":!0}))),ae.Ay.createElement(ve.A,{isOpen:j,onClose:Ae,className:"error",title:y(q?"VoipGroupEndAlertTitle":"VoipGroupLeaveAlertTitle")},ae.Ay.createElement("p",null,y(q?"VoipGroupEndAlertText":"VoipGroupLeaveAlertText")),!q&&ae.Ay.createElement(ge.A,{label:y("VoipGroupEndChat"),checked:Z,onCheck:Y}),ae.Ay.createElement("div",{className:"dialog-buttons"},ae.Ay.createElement(me.A,{isText:!0,className:"confirm-dialog-button",onClick:ke},y(q?"VoipGroupEnd":"VoipGroupLeave")),ae.Ay.createElement(me.A,{isText:!0,className:"confirm-dialog-button",onClick:Ae},y("Cancel")))))}))),et=(0,ae.ph)((0,H.EK)((e=>{const t=(0,Z.nTw)(e);return{groupCall:t.isMasterTab?(0,Y.iT)(e):void 0,isCallPanelVisible:t.isCallPanelVisible,phoneCallUser:t.isMasterTab?(0,Y.uu)(e):void 0}}))((e=>{let{groupCall:t,phoneCallUser:n,isCallPanelVisible:a}=e;const{toggleGroupCallPanel:i}=(0,H.ko)(),o=(0,le.A)();if((0,ae.vJ)((()=>(document.body.classList.toggle("has-call-header",Boolean(a)),window.electron?.setTrafficLightPosition(a?"lowered":"standard"),()=>{document.body.classList.toggle("has-call-header",!1),window.electron?.setTrafficLightPosition("standard")})),[a]),t||n)return ae.Ay.createElement("div",{className:(0,ie.A)("ActiveCallHeader",a&&"open"),onClick:function(){i()}},ae.Ay.createElement("span",{className:"title"},n?.firstName||t?.title||o("VoipGroupVoiceChat")))})));var tt=n(17663),nt=n(30857);const at=(0,ae.ph)((e=>{let{onClick:t,label:n,customIcon:a,icon:i,iconClassName:o,className:r,isDisabled:s,isActive:c}=e;return ae.Ay.createElement("div",{className:"lBO3RZUM"},ae.Ay.createElement(me.A,{round:!0,className:(0,ie.A)(r,"ch2sqAKW",c&&"OQxlsRp7"),onClick:t,disabled:s},a||ae.Ay.createElement("i",{className:(0,ie.A)(o,"icon",`icon-${i}`)})),ae.Ay.createElement("div",{className:"aHguvLcL"},n))})),it={root:"GNYRVAUg",blurred:"RBmbMiou","single-column":"O7cZE08z",singleColumn:"O7cZE08z",header:"GI6dY5aJ","close-button":"ULiJZuaP",closeButton:"ULiJZuaP","emojis-backdrop":"RFBKZpjx",emojisBackdrop:"RFBKZpjx",open:"zi1NlOXX",emojis:"DFco1VIN","emoji-tooltip":"MRIShZ3V",emojiTooltip:"MRIShZ3V","user-info":"eaUe2A0c",userInfo:"eaUe2A0c",buttons:"qIeflO02",leave:"hclywYYk",accept:"ln_ZBUHy","accept-icon":"cVRd3twS",acceptIcon:"cVRd3twS","main-video":"bGlBFSJq",mainVideo:"bGlBFSJq","second-video":"TOFu1n5x",secondVideo:"TOFu1n5x",visible:"LOnSFN9w",fullscreen:"Omg5T1o6"},ot=(0,ae.ph)((0,H.EK)((e=>{const{phoneCall:t,currentUserId:n}=e,{isCallPanelVisible:a,isMasterTab:i}=(0,Z.nTw)(e),o=(0,Y.uu)(e);return{isCallPanelVisible:Boolean(a),user:o,isOutgoing:t?.adminId===n,phoneCall:i?t:void 0}}))((e=>{let{user:t,isOutgoing:n,phoneCall:a,isCallPanelVisible:o}=e;const r=(0,le.A)(),{hangUp:s,requestMasterAndAcceptCall:c,playGroupCallSound:l,toggleGroupCallPanel:d,connectToActivePhoneCall:p}=(0,H.ko)(),m=(0,ae.li)(null),[g,f,v]=(0,re.A)(),{isMobile:h}=(0,oe.Ay)(),y=(0,ae.hb)((()=>{g?v():f()}),[v,g,f]),A=(0,ae.hb)((()=>{m.current&&(g?document.exitFullscreen().then(v):m.current.requestFullscreen().then(f))}),[v,g,f]);(0,ae.vJ)((()=>{if(!i.SC)return;const e=m.current;return e?(e.addEventListener("fullscreenchange",y),()=>{e.removeEventListener("fullscreenchange",y)}):void 0}),[y]);const C=(0,ae.hb)((()=>{d(),g&&v()}),[v,g,d]),E="discarded"===a?.state,w="busy"===a?.reason,S="requested"===a?.state&&!n,k=("requested"===a?.state||"waiting"===a?.state)&&n,I="active"===a?.state,P=a?.isConnected,[N,T,M]=(0,re.A)(),x=(0,ae.hb)((()=>{T(),s()}),[s,T]);(0,ae.vJ)((()=>{N?l({sound:"end"}):S?l({sound:"incoming"}):w?l({sound:"busy"}):E?l({sound:"end"}):k?l({sound:"ringing"}):P&&l({sound:"connect"})}),[w,E,S,k,P,l,N]),(0,ae.vJ)((()=>{a?.id?M():p()}),[p,a?.id,M]);const V=(0,nt.A)();(0,je.A)(V,P?1e3:void 0);const G=(0,ae.Kr)((()=>{const e=a?.state;return N?r("lng_call_status_hanging"):w?"busy":"requesting"===e?r("lng_call_status_requesting"):"requested"===e?r(n?"lng_call_status_ringing":"lng_call_status_incoming"):"waiting"===e?r("lng_call_status_waiting"):"active"===e&&P?void 0:r("lng_call_status_exchanging")}),[w,P,N,n,r,a?.state]),R="active"===a?.videoState,U="active"===a?.screencastState,_=b?.streams,D=_?.ownAudio?.getTracks()[0].enabled,F=_?.ownPresentation?.getTracks()[0].enabled,$=_?.ownVideo?.getTracks()[0].enabled,[J,j,z]=(0,re.A)(),[K,q,W]=(0,re.A)(),Z=(0,ae.hb)((()=>{F&&j(),$&&q(),setTimeout((async()=>{await O("presentation"),z(),W()}),250)}),[F,$,j,q,z,W]),Y=(0,ae.hb)((()=>{$&&q(),F&&j(),setTimeout((async()=>{await O("video"),z(),W()}),250)}),[F,$,j,q,z,W]),Q=(0,ae.hb)((()=>{O("audio")}),[]),[X,ee,te]=(0,re.A)(),[ne,se,ce]=(0,re.A)(),de=(0,ae.hb)((()=>{se(),async function(){if(!b||!b.facingMode)return;const e=b.streams.ownVideo;if(!e)return;const t=e.getTracks()[0];if(!t)return;const n=b.connection.getSenders().find((e=>t.id===e.track?.id));if(n){b.facingMode="environment"===b.facingMode?"user":"environment";try{const e=await L("video",b.facingMode);await n.replaceTrack(e.getTracks()[0]),b.streams.ownVideo=e,B()}catch(e){}}}(),setTimeout(ce,250)}),[se,ce]),ue=a?.startDate&&Number(new Date)/1e3-a.startDate;return(0,ae.vJ)((()=>{"discarded"===a?.state&&setTimeout(s,250)}),[s,a?.reason,a?.state]),ae.Ay.createElement(ve.A,{isOpen:a&&"discarded"!==a?.state&&!o,onClose:C,className:(0,ie.A)(it.root,h&&it.singleColumn),dialogRef:m},ae.Ay.createElement(Ee.A,{peer:t,size:"jumbo",className:R||U?it.blurred:""}),"active"===a?.screencastState&&_?.presentation&&ae.Ay.createElement("video",{className:it.mainVideo,muted:!0,autoPlay:!0,playsInline:!0,srcObject:_.presentation}),"active"===a?.videoState&&_?.video&&ae.Ay.createElement("video",{className:it.mainVideo,muted:!0,autoPlay:!0,playsInline:!0,srcObject:_.video}),ae.Ay.createElement("video",{className:(0,ie.A)(it.secondVideo,!J&&F&&it.visible,g&&it.fullscreen),muted:!0,autoPlay:!0,playsInline:!0,srcObject:_?.ownPresentation}),ae.Ay.createElement("video",{className:(0,ie.A)(it.secondVideo,!K&&$&&it.visible,g&&it.fullscreen),muted:!0,autoPlay:!0,playsInline:!0,srcObject:_?.ownVideo}),ae.Ay.createElement("div",{className:it.header},i.SC&&ae.Ay.createElement(me.A,{round:!0,size:"smaller",color:"translucent",onClick:A,ariaLabel:r(g?"AccExitFullscreen":"AccSwitchToFullscreen")},ae.Ay.createElement("i",{className:(0,ie.A)("icon",g?"icon-smallscreen":"icon-fullscreen")})),ae.Ay.createElement(me.A,{round:!0,size:"smaller",color:"translucent",onClick:C,className:it.closeButton},ae.Ay.createElement("i",{className:"icon icon-close"}))),ae.Ay.createElement("div",{className:(0,ie.A)(it.emojisBackdrop,X&&it.open),onClick:X?te:ee},ae.Ay.createElement("div",{className:(0,ie.A)(it.emojis,X&&it.open)},a?.isConnected&&a?.emojis&&(0,Ae.A)(a.emojis,["emoji"])),ae.Ay.createElement("div",{className:(0,ie.A)(it.emojiTooltip,X&&it.open)},r("CallEmojiKeyTooltip",t?.firstName).replace("%%","%"))),ae.Ay.createElement("div",{className:it.userInfo},ae.Ay.createElement("h1",null,t?.firstName),ae.Ay.createElement("span",{className:it.status},G||(0,tt.QO)(ue||0))),ae.Ay.createElement("div",{className:it.buttons},ae.Ay.createElement(at,{onClick:Q,icon:"microphone",isDisabled:!I,isActive:D,label:r(D?"lng_call_mute_audio":"lng_call_unmute_audio")}),ae.Ay.createElement(at,{onClick:Y,icon:"video",isDisabled:!I,isActive:$,label:r($?"lng_call_stop_video":"lng_call_start_video")}),$&&(i.Ni||i.pz)&&ae.Ay.createElement(at,{onClick:de,customIcon:ae.Ay.createElement(Pe.A,{tgsUrl:ke.w.CameraFlip,playSegment:ne?[0,10]:[0,1],size:32}),isDisabled:!I,label:r("VoipFlip")}),u&&ae.Ay.createElement(at,{onClick:Z,icon:"share-screen",isDisabled:!I,isActive:F,label:r("lng_call_screencast")}),S&&ae.Ay.createElement(at,{onClick:c,icon:"phone-discard",isDisabled:E,label:r("lng_call_accept"),className:it.accept,iconClassName:it.acceptIcon}),ae.Ay.createElement(at,{onClick:x,icon:"phone-discard",isDisabled:E,label:r(S?"lng_call_decline":"lng_call_end_call"),className:it.leave})))})));var rt=n(40664);const st=(0,ae.ph)((e=>{let{isOpen:t}=e;const{closeCallRatingModal:n,setCallRating:a}=(0,H.ko)(),i=(0,ae.li)(null),o=(0,le.A)(),[r,s]=(0,ae.J0)(),c=(0,ae.hb)((()=>{r?a({rating:r+1,comment:i.current?.value||""}):n()}),[n,r,a]),l=(0,ae.hb)((()=>{n()}),[n]);return ae.Ay.createElement(ve.A,{title:o("lng_call_rate_label"),className:"narrow",onClose:n,isOpen:t},ae.Ay.createElement("div",{className:"P7EfDKJN"},new Array(5).fill(void 0).map(((e,t)=>{const n=void 0!==r&&r>=t;return ae.Ay.createElement("i",{className:(0,ie.A)("icon",n?"icon-favorite-filled":"icon-favorite",n&&"_XX6q8YW","t8LJLFSN"),onClick:(a=t,()=>s(r===a?void 0:a))});var a}))),ae.Ay.createElement(rt.A,{ref:i,placeholder:o("lng_call_rate_comment"),className:(0,ie.A)("EvL0WaKD",4!==r&&void 0!==r&&"v5hn1XvT")}),ae.Ay.createElement("div",{className:"dialog-buttons mt-2"},ae.Ay.createElement(me.A,{className:"confirm-dialog-button",isText:!0,onClick:c},o("Send")),ae.Ay.createElement(me.A,{className:"confirm-dialog-button",isText:!0,onClick:l},o("Cancel"))))}));(i.Yw||i.pz)&&document.addEventListener("click",a.cw,{once:!0})},285:(e,t,n)=>{n.d(t,{A:()=>d});var a=n(84051),i=n(13439),o=n(90709),r=n(29807),s=n(4961),c=n(59030),l=n(94189);const d=(0,a.ph)((0,i.EK)(((e,t)=>{let{userId:n}=t;const a=(0,r.meB)(e),i=n&&(0,r.mBe)(e,n);return{chat:a,contactName:i?(0,o.u0l)(i):void 0}}))((e=>{let{isOpen:t,chat:n,userId:o,contactName:r,onClose:d}=e;const{deleteChatMember:u}=(0,i.ko)(),p=(0,c.A)(),m=(0,a.hb)((()=>{u({chatId:n.id,userId:o}),d()}),[n,u,d,o]);if(n&&o)return a.Ay.createElement(l.A,{isOpen:t,onClose:d,title:p("GroupRemoved.Remove"),textParts:(0,s.A)(p("PeerInfo.Confirm.RemovePeer",r)),confirmLabel:p("lng_box_remove"),confirmHandler:m,confirmIsDestructive:!0})})))},71331:(e,t,n)=>{n.d(t,{Ip:()=>s,O7:()=>p,iT:()=>d,mD:()=>r,n5:()=>c,qI:()=>l,uu:()=>u});var a=n(90709),i=n(21133),o=n(19926);function r(e,t){const n=(0,i.AW)(e,t);if(n&&n.groupCallId)return s(e,n.groupCallId)}function s(e,t){return e.groupCalls.byId[t]}function c(e,t,n){return s(e,t)?.participants[n]}function l(e){const t=d(e)?.chatId;if(!t)return!1;const n=(0,i.hd)(e,t);return!!n&&((0,a.yn$)(n)&&n.isCreator||Boolean(n.adminRights?.manageCall))}function d(e){const{groupCalls:{activeGroupCallId:t}}=e;if(t)return s(e,t)}function u(e){const{phoneCall:t,currentUserId:n}=e;if(!t||!t.participantId||!t.adminId)return;const a=t.adminId===n?t.participantId:t.adminId;return(0,o.mB)(e,a)}function p(e){const t=d(e);if(!t||!t.chatId)return!1;const n=(0,i.hd)(e,t.chatId);if(!n)return!1;if(Boolean((0,a.KlG)(n)))return!0;const o=(0,i.AW)(e,n.id)?.inviteLink;return Boolean(o)}},64520:(e,t,n)=>{n.d(t,{B:()=>r,d:()=>o});var a=n(31481),i=n(19926);function o(e,t){const{appConfig:n}=e;if(!n)return a.dR$[t][0];const o=(0,i.g2)(e),{limits:r}=n,s=r[t]?.[o?1:0]??a.dR$[t][o?1:0];return"dialogFilters"===t?s+1:s}function r(e,t){const{appConfig:n}=e;if(!n)return a.dR$[t][1];const{limits:i}=n;return i[t][1]}},32625:(e,t,n)=>{n.d(t,{A:()=>o});var a=n(84051),i=n(17712);const o=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const o=(0,i.A)(e);(0,a.vJ)((()=>{if(void 0===t)return;const e=setInterval((()=>o()),t);return n||o(),()=>clearInterval(e)}),[t,n])}},90423:(e,t,n)=>{n.d(t,{Ay:()=>s,zk:()=>c});var a=n(84051),i=n(31791),o=n(82393);const r=l();function s(e,t){const[n,i]=(0,a.J0)(Boolean(r&&document[r]));return(0,a.Nf)((()=>{const n=e.current,a=()=>{const e=Boolean(r&&document[r]);i(e),n.controls=e},o=()=>{i(!0)},s=()=>{i(!1),t(!1)};return document.addEventListener("fullscreenchange",a,!1),document.addEventListener("webkitfullscreenchange",a,!1),document.addEventListener("mozfullscreenchange",a,!1),n&&(n.addEventListener("webkitbeginfullscreen",o,!1),n.addEventListener("webkitendfullscreen",s,!1)),()=>{document.removeEventListener("fullscreenchange",a,!1),document.removeEventListener("webkitfullscreenchange",a,!1),document.removeEventListener("mozfullscreenchange",a,!1),n&&(n.removeEventListener("webkitbeginfullscreen",o,!1),n.removeEventListener("webkitendfullscreen",s,!1))}}),[]),r||o.pz?[n,()=>{var t;e.current&&(r||o.pz)&&((t=e.current).requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.webkitEnterFullscreen?t.webkitEnterFullscreen():t.mozRequestFullScreen&&t.mozRequestFullScreen(),i(!0))},()=>{e.current&&(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),i(!1))}]:[!1]}const c=()=>{const[e,t]=(0,a.J0)(!1);return(0,a.vJ)((()=>{const e=()=>{t(function(){const e=l();return Boolean(e&&document[e])}())},n=window.electron?.on(i.v.FULLSCREEN_CHANGE,t);return window.electron?.isFullscreen().then(t),document.addEventListener("fullscreenchange",e,!1),document.addEventListener("webkitfullscreenchange",e,!1),document.addEventListener("mozfullscreenchange",e,!1),()=>{n?.(),document.removeEventListener("fullscreenchange",e,!1),document.removeEventListener("webkitfullscreenchange",e,!1),document.removeEventListener("mozfullscreenchange",e,!1)}}),[]),e};function l(){return void 0!==document.fullscreenElement?"fullscreenElement":void 0!==document.mozFullScreenElement?"mozFullScreenElement":void 0!==document.webkitFullscreenElement?"webkitFullscreenElement":""}},31791:(e,t,n)=>{n.d(t,{v:()=>a});let a=function(e){return e.FULLSCREEN_CHANGE="fullscreen-change",e.UPDATE_ERROR="update-error",e.UPDATE_AVAILABLE="update-available",e.DEEPLINK="deeplink",e}({})}}]);
//# sourceMappingURL=2394.0bc096c5f42703f18d0a.js.map