{"version":3,"file":"484.87953bd73fba4543a4f6.js","mappings":"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AAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,GAAI,GAAI,IAAK,IAAK,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,EAAG,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,GAAI,IAAK,GAAI,IAAK,EAAG,GAAI,IAAK,GAAI,GAAI,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,GAAI,IAAK,IAAK,GAAI,GAAI,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,GAAI,GAAI,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,IAAK,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,IAAK,IAAK,GAAI,IAAK,IAAK,EAAG,GAAI,IAAK,GAAI,IAAK,IAAK,GAAI,GAAI,IAAK,GAAI,IAAK,GAAI,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,GAAI,IAAK,GAAI,IAAK,GAE5qCC,EAAY,CAAC,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAA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","sources":["webpack://telegram-t/./src/components/common/AnimatedEmoji.tsx","webpack://telegram-t/./src/components/common/AnimatedSticker.tsx","webpack://telegram-t/./src/components/common/Audio.tsx","webpack://telegram-t/./src/util/waveform.ts","webpack://telegram-t/./src/components/common/helpers/waveform.ts","webpack://telegram-t/./src/components/common/Avatar.tsx","webpack://telegram-t/./src/components/common/ChatExtra.tsx","webpack://telegram-t/./src/components/common/DeleteChatModal.tsx","webpack://telegram-t/./src/components/common/Document.tsx","webpack://telegram-t/./src/components/common/File.tsx","webpack://telegram-t/./src/components/common/GroupChatInfo.tsx","webpack://telegram-t/./src/components/common/LastMessageMeta.tsx","webpack://telegram-t/./src/components/common/Media.tsx","webpack://telegram-t/./src/components/common/MessageOutgoingStatus.tsx","webpack://telegram-t/./src/components/common/NothingFound.tsx","webpack://telegram-t/./src/components/common/Picker.tsx","webpack://telegram-t/./src/components/common/PickerSelectedItem.tsx","webpack://telegram-t/./src/components/common/PrivateChatInfo.tsx","webpack://telegram-t/./src/components/common/ProfilePhoto.tsx","webpack://telegram-t/./src/components/common/ProfileInfo.tsx","webpack://telegram-t/./src/components/common/hooks/usePhotosPreload.ts","webpack://telegram-t/./src/components/common/StickerButton.tsx","webpack://telegram-t/./src/components/common/StickerSetModal.async.tsx","webpack://telegram-t/./src/components/common/TypingStatus.tsx","webpack://telegram-t/./src/components/common/VerifiedIcon.tsx","webpack://telegram-t/./src/components/common/WebLink.tsx","webpack://telegram-t/./src/components/common/helpers/mediaDimensions.ts","webpack://telegram-t/./src/components/common/helpers/renderMessageText.tsx","webpack://telegram-t/./src/components/left/main/hooks/useChatAnimationType.ts","webpack://telegram-t/./src/components/left/main/Badge.tsx","webpack://telegram-t/./src/components/left/main/Chat.tsx","webpack://telegram-t/./src/components/left/main/EmptyFolder.tsx","webpack://telegram-t/./src/components/left/main/ChatList.tsx","webpack://telegram-t/./src/components/middle/composer/DropTarget.tsx","webpack://telegram-t/./src/components/middle/composer/DropArea.tsx","webpack://telegram-t/./src/components/middle/composer/EmojiTooltip.async.tsx","webpack://telegram-t/./src/components/middle/composer/MessageInput.tsx","webpack://telegram-t/./src/components/middle/composer/TextFormatter.tsx","webpack://telegram-t/./src/components/middle/composer/helpers/parseMessageInput.ts","webpack://telegram-t/./src/components/middle/composer/helpers/prepareForRegExp.ts","webpack://telegram-t/./src/components/middle/composer/helpers/selection.ts","webpack://telegram-t/./src/components/middle/composer/hooks/useEmojiTooltip.ts","webpack://telegram-t/./src/components/middle/composer/helpers/searchUserName.ts","webpack://telegram-t/./src/components/middle/composer/hooks/useMentionTooltip.ts","webpack://telegram-t/./src/components/right/hooks/useAsyncRendering.ts","webpack://telegram-t/./src/components/ui/ConfirmDialog.tsx","webpack://telegram-t/./src/components/ui/FloatingActionButton.tsx","webpack://telegram-t/./src/components/ui/InfiniteScroll.tsx","webpack://telegram-t/./src/components/ui/ListItem.tsx","webpack://telegram-t/./src/components/ui/Modal.tsx","webpack://telegram-t/./src/util/trapFocus.ts","webpack://telegram-t/./src/components/ui/Notification.tsx","webpack://telegram-t/./src/components/ui/Portal.ts","webpack://telegram-t/./src/components/ui/ProgressSpinner.tsx","webpack://telegram-t/./src/components/ui/Radio.tsx","webpack://telegram-t/./src/components/ui/RadioGroup.tsx","webpack://telegram-t/./src/components/ui/SearchInput.tsx","webpack://telegram-t/./src/components/ui/ShowTransition.tsx","webpack://telegram-t/./src/components/ui/Switcher.tsx","webpack://telegram-t/./src/components/ui/Tab.tsx","webpack://telegram-t/./src/components/ui/TabList.tsx","webpack://telegram-t/./src/components/ui/Transition.tsx","webpack://telegram-t/./src/hooks/reducers/useFoldersReducer.ts","webpack://telegram-t/./src/hooks/useAudioPlayer.ts","webpack://telegram-t/./src/hooks/useBackgroundMode.ts","webpack://telegram-t/./src/hooks/useBlur.ts","webpack://telegram-t/./src/hooks/useBlurSync.ts","webpack://telegram-t/./src/hooks/useBuffering.ts","webpack://telegram-t/./src/hooks/useCanvasBlur.ts","webpack://telegram-t/./src/hooks/useChatContextActions.ts","webpack://telegram-t/./src/hooks/useContextMenuHandlers.ts","webpack://telegram-t/./src/hooks/useContextMenuPosition.ts","webpack://telegram-t/./src/hooks/useCurrentOrPrev.ts","webpack://telegram-t/./src/hooks/useEnsureMessage.ts","webpack://telegram-t/./src/hooks/useHorizontalScroll.ts","webpack://telegram-t/./src/hooks/useInfiniteScroll.ts","webpack://telegram-t/./src/hooks/useIntersectionObserver.ts","webpack://telegram-t/./src/hooks/useLayoutEffectWithPrevDeps.ts","webpack://telegram-t/./src/hooks/useMedia.ts","webpack://telegram-t/./src/hooks/useMediaDownload.ts","webpack://telegram-t/./src/hooks/useMediaWithDownloadProgress.ts","webpack://telegram-t/./src/hooks/useMouseInside.ts","webpack://telegram-t/./src/hooks/usePrevDuringAnimation.ts","webpack://telegram-t/./src/hooks/useReducer.ts","webpack://telegram-t/./src/hooks/useTransitionForMedia.ts","webpack://telegram-t/./src/hooks/useVideoCleanup.ts","webpack://telegram-t/./src/lib/fastBlur.js","webpack://telegram-t/./src/util/audioPlayer.ts","webpack://telegram-t/./src/util/captureEvents.ts","webpack://telegram-t/./src/util/clipboard.ts","webpack://telegram-t/./src/util/cssAnimationEndListeners.ts","webpack://telegram-t/./src/util/cycleRestrict.ts","webpack://telegram-t/./src/util/download.ts","webpack://telegram-t/./src/util/fastSmoothScroll.ts","webpack://telegram-t/./src/util/fastSmoothScrollHorizontal.ts","webpack://telegram-t/./src/util/focusEditableElement.ts","webpack://telegram-t/./src/util/patchSafariProgressiveAudio.ts","webpack://telegram-t/./src/util/resetScroll.ts","webpack://telegram-t/./src/util/safePlay.ts"],"sourcesContent":["import React, {\n  FC, useCallback, useRef, useState,\n} from '../../lib/teact/teact';\n\nimport { ApiMediaFormat, ApiSticker } from '../../api/types';\n\nimport { LIKE_STICKER_ID } from './helpers/mediaDimensions';\nimport { ObserveFn, useIsIntersecting } from '../../hooks/useIntersectionObserver';\nimport useMedia from '../../hooks/useMedia';\nimport useTransitionForMedia from '../../hooks/useTransitionForMedia';\nimport useFlag from '../../hooks/useFlag';\n\nimport AnimatedSticker from './AnimatedSticker';\n\nimport './AnimatedEmoji.scss';\n\ntype OwnProps = {\n  sticker: ApiSticker;\n  observeIntersection?: ObserveFn;\n  size?: 'large' | 'medium' | 'small';\n  lastSyncTime?: number;\n  forceLoadPreview?: boolean;\n};\n\nconst QUALITY = 1;\nconst WIDTH = {\n  large: 160,\n  medium: 128,\n  small: 104,\n};\n\nconst AnimatedEmoji: FC<OwnProps> = ({\n  sticker,\n  size = 'medium',\n  observeIntersection,\n  lastSyncTime,\n  forceLoadPreview,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n\n  const [isAnimationLoaded, markAnimationLoaded] = useFlag();\n  const localMediaHash = `sticker${sticker.id}`;\n\n  const isIntersecting = useIsIntersecting(ref, observeIntersection);\n\n  const thumbDataUri = sticker.thumbnail?.dataUri;\n  const previewBlobUrl = useMedia(\n    `${localMediaHash}?size=m`,\n    !isIntersecting && !forceLoadPreview,\n    ApiMediaFormat.BlobUrl,\n    lastSyncTime,\n  );\n  const { transitionClassNames } = useTransitionForMedia(previewBlobUrl, 'slow');\n\n  const mediaData = useMedia(localMediaHash, !isIntersecting, ApiMediaFormat.Lottie, lastSyncTime);\n  const isMediaLoaded = Boolean(mediaData);\n\n  const [playKey, setPlayKey] = useState(String(Math.random()));\n  const handleClick = useCallback(() => {\n    setPlayKey(String(Math.random()));\n  }, []);\n\n  const width = WIDTH[size];\n  const style = `width: ${width}px; height: ${width}px;`;\n\n  return (\n    <div\n      ref={ref}\n      className=\"AnimatedEmoji media-inner\"\n      // @ts-ignore\n      style={style}\n      onClick={handleClick}\n    >\n      {!isAnimationLoaded && thumbDataUri && (\n        <img src={thumbDataUri} className={sticker.id === LIKE_STICKER_ID ? 'like-sticker-thumb' : undefined} alt=\"\" />\n      )}\n      {!isAnimationLoaded && previewBlobUrl && (\n        <img src={previewBlobUrl} className={transitionClassNames} alt=\"\" />\n      )}\n      {isMediaLoaded && (\n        <AnimatedSticker\n          key={localMediaHash}\n          id={localMediaHash}\n          animationData={mediaData as AnyLiteral}\n          size={width}\n          quality={QUALITY}\n          play={isIntersecting && playKey}\n          noLoop\n          onLoad={markAnimationLoaded}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default AnimatedEmoji;\n","import React, {\n  FC, useEffect, useRef, memo, useCallback, useState,\n} from '../../lib/teact/teact';\n\nimport { fastRaf } from '../../util/schedulers';\nimport buildClassName from '../../util/buildClassName';\nimport useHeavyAnimationCheck from '../../hooks/useHeavyAnimationCheck';\nimport useBackgroundMode from '../../hooks/useBackgroundMode';\n\ntype OwnProps = {\n  className?: string;\n  id: string;\n  animationData: AnyLiteral;\n  play?: boolean | string;\n  playSegment?: [number, number];\n  speed?: number;\n  noLoop?: boolean;\n  size: number;\n  quality?: number;\n  isLowPriority?: boolean;\n  onLoad?: NoneToVoidFunction;\n};\n\ntype RLottieClass = typeof import('../../lib/rlottie/RLottie').default;\ntype RLottieInstance = import('../../lib/rlottie/RLottie').default;\nlet lottiePromise: Promise<RLottieClass>;\nlet RLottie: RLottieClass;\n\n// Time supposed for judges to measure \"Transferred Size\" in Dev Tools\nconst LOTTIE_LOAD_DELAY = 5000;\n\nasync function ensureLottie() {\n  if (!lottiePromise) {\n    lottiePromise = import('../../lib/rlottie/RLottie') as unknown as Promise<RLottieClass>;\n    RLottie = (await lottiePromise as any).default;\n  }\n\n  return lottiePromise;\n}\n\nsetTimeout(ensureLottie, LOTTIE_LOAD_DELAY);\n\nconst AnimatedSticker: FC<OwnProps> = ({\n  className,\n  id,\n  animationData,\n  play,\n  playSegment,\n  speed,\n  noLoop,\n  size,\n  quality,\n  isLowPriority,\n  onLoad,\n}) => {\n  const [animation, setAnimation] = useState<RLottieInstance>();\n  // eslint-disable-next-line no-null/no-null\n  const container = useRef<HTMLDivElement>(null);\n  const wasPlaying = useRef(false);\n  const isFrozen = useRef(false);\n\n  const playRef = useRef();\n  playRef.current = play;\n  const playSegmentRef = useRef<[number, number]>();\n  playSegmentRef.current = playSegment;\n\n  useEffect(() => {\n    if (animation || !animationData) {\n      return;\n    }\n\n    const exec = () => {\n      if (!container.current) {\n        return;\n      }\n\n      const newAnimation = new RLottie(\n        id,\n        container.current,\n        animationData,\n        {\n          noLoop,\n          size,\n          quality,\n          isLowPriority,\n        },\n        onLoad,\n      );\n\n      if (speed) {\n        newAnimation.setSpeed(speed);\n      }\n\n      setAnimation(newAnimation);\n    };\n\n    if (RLottie) {\n      exec();\n    } else {\n      ensureLottie().then(() => {\n        fastRaf(() => {\n          if (container.current) {\n            exec();\n          }\n        });\n      });\n    }\n  }, [animation, animationData, id, isLowPriority, noLoop, onLoad, quality, size, speed]);\n\n  useEffect(() => {\n    return () => {\n      if (animation) {\n        animation.destroy();\n      }\n    };\n  }, [animation]);\n\n  const playAnimation = useCallback((shouldRestart = false) => {\n    if (animation && (playRef.current || playSegmentRef.current)) {\n      if (playSegmentRef.current) {\n        animation.playSegment(playSegmentRef.current);\n      } else if (shouldRestart) {\n        animation.goToAndPlay(0);\n      } else {\n        animation.play();\n      }\n    }\n  }, [animation]);\n\n  const pauseAnimation = useCallback(() => {\n    if (!animation) {\n      return;\n    }\n\n    animation.pause();\n  }, [animation]);\n\n  const freezeAnimation = useCallback(() => {\n    isFrozen.current = true;\n\n    if (!animation) {\n      return;\n    }\n\n    if (!wasPlaying.current) {\n      wasPlaying.current = animation.isPlaying();\n    }\n\n    pauseAnimation();\n  }, [animation, pauseAnimation]);\n\n  const unfreezeAnimation = useCallback(() => {\n    if (wasPlaying.current) {\n      playAnimation();\n    }\n\n    wasPlaying.current = false;\n    isFrozen.current = false;\n  }, [playAnimation]);\n\n  const unfreezeAnimationOnRaf = useCallback(() => {\n    fastRaf(unfreezeAnimation);\n  }, [unfreezeAnimation]);\n\n  useEffect(() => {\n    if (!animation) {\n      return;\n    }\n\n    if (play || playSegment) {\n      if (isFrozen.current) {\n        wasPlaying.current = true;\n      } else {\n        playAnimation(noLoop);\n      }\n    } else {\n      // eslint-disable-next-line no-lonely-if\n      if (isFrozen.current) {\n        wasPlaying.current = false;\n      } else {\n        pauseAnimation();\n      }\n    }\n  }, [animation, play, playSegment, noLoop, playAnimation, pauseAnimation]);\n\n  useHeavyAnimationCheck(freezeAnimation, unfreezeAnimation);\n  // Pausing frame may not happen in background\n  // so we need to make sure it happens right after focusing,\n  // then we can play again.\n  useBackgroundMode(freezeAnimation, unfreezeAnimationOnRaf);\n\n  const fullClassName = buildClassName('AnimatedSticker', className);\n\n  const style = size ? `width: ${size}px; height: ${size}px;` : undefined;\n\n  return (\n    <div\n      ref={container}\n      className={fullClassName}\n      // @ts-ignore\n      style={style}\n    />\n  );\n};\n\nexport default memo(AnimatedSticker);\n","import React, {\n  FC, memo, useCallback, useEffect, useMemo, useRef, useState,\n} from '../../lib/teact/teact';\n\nimport {\n  ApiAudio, ApiMessage, ApiVoice,\n} from '../../api/types';\nimport { ISettings } from '../../types';\n\nimport { IS_SINGLE_COLUMN_LAYOUT } from '../../util/environment';\nimport { formatMediaDateTime, formatMediaDuration, formatPastTimeShort } from '../../util/dateFormat';\nimport {\n  getMediaDuration,\n  getMediaTransferState,\n  getMessageAudioCaption,\n  getMessageKey,\n  getMessageMediaFormat,\n  getMessageMediaHash,\n  isMessageLocal,\n  isOwnMessage,\n} from '../../modules/helpers';\nimport { renderWaveformToDataUri } from './helpers/waveform';\nimport buildClassName from '../../util/buildClassName';\nimport renderText from './helpers/renderText';\nimport { decodeWaveform, interpolateArray } from '../../util/waveform';\nimport useMediaWithDownloadProgress from '../../hooks/useMediaWithDownloadProgress';\nimport useShowTransition from '../../hooks/useShowTransition';\nimport useBuffering from '../../hooks/useBuffering';\nimport useAudioPlayer from '../../hooks/useAudioPlayer';\nimport useMediaDownload from '../../hooks/useMediaDownload';\nimport useLang, { LangFn } from '../../hooks/useLang';\n\nimport Button from '../ui/Button';\nimport ProgressSpinner from '../ui/ProgressSpinner';\nimport Link from '../ui/Link';\n\nimport './Audio.scss';\n\ntype OwnProps = {\n  theme: ISettings['theme'];\n  message: ApiMessage;\n  senderTitle?: string;\n  uploadProgress?: number;\n  target?: 'searchResult' | 'sharedMedia';\n  date?: number;\n  lastSyncTime?: number;\n  className?: string;\n  isSelectable?: boolean;\n  isSelected?: boolean;\n  onPlay: (messageId: number, chatId: number) => void;\n  onReadMedia?: () => void;\n  onCancelUpload?: () => void;\n  onDateClick?: (messageId: number, chatId: number) => void;\n};\n\ninterface ISeekMethods {\n  handleStartSeek: (e: React.MouseEvent<HTMLElement>) => void;\n  handleSeek: (e: React.MouseEvent<HTMLElement>) => void;\n  handleStopSeek: () => void;\n}\n\nconst AVG_VOICE_DURATION = 30;\nconst MIN_SPIKES = IS_SINGLE_COLUMN_LAYOUT ? 20 : 25;\nconst MAX_SPIKES = IS_SINGLE_COLUMN_LAYOUT ? 50 : 75;\n// This is needed for browsers requiring user interaction before playing.\nconst PRELOAD = true;\n\nconst Audio: FC<OwnProps> = ({\n  theme,\n  message,\n  senderTitle,\n  uploadProgress,\n  target,\n  date,\n  lastSyncTime,\n  className,\n  isSelectable,\n  isSelected,\n  onPlay,\n  onReadMedia,\n  onCancelUpload,\n  onDateClick,\n}) => {\n  const { content: { audio, voice }, isMediaUnread } = message;\n  const isVoice = Boolean(voice);\n  const isSeeking = useRef<boolean>(false);\n  const lang = useLang();\n\n  const [isActivated, setIsActivated] = useState(false);\n  const shouldDownload = (isActivated || PRELOAD) && lastSyncTime;\n\n  const { mediaData, downloadProgress } = useMediaWithDownloadProgress(\n    getMessageMediaHash(message, 'inline'),\n    !shouldDownload,\n    getMessageMediaFormat(message, 'inline'),\n  );\n\n  function handleForcePlay() {\n    setIsActivated(true);\n    onPlay(message.id, message.chatId);\n  }\n\n  const {\n    isBuffered, bufferedProgress, bufferingHandlers, checkBuffering,\n  } = useBuffering();\n\n  const {\n    isPlaying, playProgress, playPause, setCurrentTime, duration,\n  } = useAudioPlayer(\n    getMessageKey(message),\n    getMediaDuration(message)!,\n    mediaData,\n    bufferingHandlers,\n    checkBuffering,\n    isActivated,\n    handleForcePlay,\n    isMessageLocal(message),\n  );\n\n  useEffect(() => {\n    setIsActivated(isPlaying);\n  }, [isPlaying]);\n\n  const {\n    isDownloadStarted,\n    downloadProgress: directDownloadProgress,\n    handleDownloadClick,\n  } = useMediaDownload(getMessageMediaHash(message, 'download'), getMessageAudioCaption(message));\n\n  const isLoadingForPlaying = isActivated && !isBuffered;\n\n  const {\n    isUploading, isTransferring, transferProgress,\n  } = getMediaTransferState(\n    message,\n    isDownloadStarted ? directDownloadProgress : (uploadProgress || downloadProgress),\n    isLoadingForPlaying || isDownloadStarted,\n  );\n\n  const {\n    shouldRender: shouldRenderSpinner,\n    transitionClassNames: spinnerClassNames,\n  } = useShowTransition(isTransferring);\n\n  const handleButtonClick = useCallback(() => {\n    if (isUploading) {\n      if (onCancelUpload) {\n        onCancelUpload();\n      }\n\n      return;\n    }\n\n    if (!isPlaying) {\n      onPlay(message.id, message.chatId);\n    }\n\n    setIsActivated(!isActivated);\n    playPause();\n  }, [isPlaying, isUploading, message.id, message.chatId, onCancelUpload, onPlay, playPause, isActivated]);\n\n  useEffect(() => {\n    if (isPlaying && onReadMedia && isMediaUnread) {\n      onReadMedia();\n    }\n  }, [isPlaying, isMediaUnread, onReadMedia]);\n\n  const handleSeek = useCallback((e: React.MouseEvent<HTMLElement>) => {\n    if (isSeeking.current) {\n      const seekBar = e.currentTarget.closest('.seekline,.waveform');\n      if (seekBar) {\n        const { width, left } = seekBar.getBoundingClientRect();\n        setCurrentTime(duration * ((e.clientX - left) / width));\n      }\n    }\n  }, [duration, setCurrentTime]);\n\n  const handleStartSeek = useCallback((e: React.MouseEvent<HTMLElement>) => {\n    isSeeking.current = true;\n    handleSeek(e);\n  }, [handleSeek]);\n\n  const handleStopSeek = useCallback(() => {\n    isSeeking.current = false;\n  }, []);\n\n  const handleDateClick = useCallback(() => {\n    onDateClick!(message.id, message.chatId);\n  }, [onDateClick, message.id, message.chatId]);\n\n  function getFirstLine() {\n    if (isVoice) {\n      return senderTitle || 'Voice';\n    }\n\n    const { title, fileName } = audio!;\n\n    return title || fileName;\n  }\n\n  function getSecondLine() {\n    if (isVoice) {\n      return formatMediaDuration(voice!.duration);\n    }\n\n    const { performer } = audio!;\n\n    return (\n      <>\n        {performer && renderText(performer)}\n        {performer && senderTitle && <span>&bull;</span>}\n        {senderTitle && renderText(senderTitle)}\n      </>\n    );\n  }\n\n  const seekHandlers = { handleStartSeek, handleSeek, handleStopSeek };\n  const isOwn = isOwnMessage(message);\n  const renderedWaveform = useMemo(\n    () => voice && renderWaveform(voice, playProgress, isOwn, { handleStartSeek, handleSeek, handleStopSeek }, theme),\n    [voice, playProgress, isOwn, handleStartSeek, handleSeek, handleStopSeek, theme],\n  );\n\n  const fullClassName = buildClassName(\n    'Audio media-inner',\n    className,\n    isOwn && !target && 'own',\n    target && 'bigger',\n    isSelected && 'audio-is-selected',\n  );\n\n  const buttonClassNames = ['toggle-play'];\n  if (isLoadingForPlaying) {\n    buttonClassNames.push('loading');\n  } else if (isPlaying) {\n    buttonClassNames.push('pause');\n  } else if (!isPlaying) {\n    buttonClassNames.push('play');\n  }\n\n  const showSeekline = isPlaying || (playProgress > 0 && playProgress < 1);\n  const contentClassName = buildClassName('content', showSeekline && 'with-seekline');\n\n  function renderSearchResult() {\n    return (\n      <>\n        <div className={contentClassName}>\n          <div className=\"content-row\">\n            <p className=\"title\" dir=\"auto\">{renderText(getFirstLine())}</p>\n\n            <div className=\"message-date\">\n              {date && (\n                <Link\n                  className=\"date\"\n                  onClick={handleDateClick}\n                >\n                  {formatPastTimeShort(lang, date * 1000)}\n                </Link>\n              )}\n            </div>\n          </div>\n\n          {showSeekline && renderSeekline(playProgress, bufferedProgress, seekHandlers)}\n          {!showSeekline && (\n            <p className=\"duration\" dir=\"auto\">\n              {playProgress > 0 ? `${formatMediaDuration(duration * playProgress)} / ` : undefined}\n              {getSecondLine()}\n            </p>\n          )}\n        </div>\n      </>\n    );\n  }\n\n  return (\n    <div className={fullClassName} dir={lang.isRtl ? 'rtl' : undefined}>\n      {isSelectable && (\n        <div className=\"message-select-control\">\n          {isSelected && <i className=\"icon-select\" />}\n        </div>\n      )}\n      <Button\n        round\n        ripple={!IS_SINGLE_COLUMN_LAYOUT}\n        size={target ? 'smaller' : 'tiny'}\n        className={buttonClassNames.join(' ')}\n        ariaLabel={isPlaying ? 'Pause audio' : 'Play audio'}\n        onClick={handleButtonClick}\n        isRtl={lang.isRtl}\n      >\n        <i className=\"icon-play\" />\n        <i className=\"icon-pause\" />\n      </Button>\n      {shouldRenderSpinner && (\n        <div className={buildClassName('media-loading', spinnerClassNames, isLoadingForPlaying && 'interactive')}>\n          <ProgressSpinner\n            progress={transferProgress}\n            transparent\n            size={target ? 'm' : 's'}\n            onClick={isLoadingForPlaying ? handleButtonClick : undefined}\n            noCross={!isLoadingForPlaying}\n          />\n        </div>\n      )}\n      {audio && (\n        <Button\n          round\n          size=\"tiny\"\n          className=\"download-button\"\n          ariaLabel={isDownloadStarted ? 'Cancel download' : 'Download'}\n          onClick={handleDownloadClick}\n        >\n          <i className={isDownloadStarted ? 'icon-close' : 'icon-arrow-down'} />\n        </Button>\n      )}\n      {target === 'searchResult' && renderSearchResult()}\n      {target !== 'searchResult' && audio && renderAudio(\n        lang, audio, isPlaying, playProgress, bufferedProgress, seekHandlers, date,\n        onDateClick ? handleDateClick : undefined,\n      )}\n      {target !== 'searchResult' && voice && renderVoice(voice, renderedWaveform, isMediaUnread)}\n    </div>\n  );\n};\n\nfunction renderAudio(\n  lang: LangFn,\n  audio: ApiAudio,\n  isPlaying: boolean,\n  playProgress: number,\n  bufferedProgress: number,\n  seekHandlers: ISeekMethods,\n  date?: number,\n  handleDateClick?: NoneToVoidFunction,\n) {\n  const {\n    title, performer, duration, fileName,\n  } = audio;\n  const showSeekline = isPlaying || (playProgress > 0 && playProgress < 1);\n\n  return (\n    <div className=\"content\">\n      <p className=\"title\" dir=\"auto\">{renderText(title || fileName)}</p>\n      {showSeekline && renderSeekline(playProgress, bufferedProgress, seekHandlers)}\n      {!showSeekline && (\n        <div className=\"meta\" dir=\"auto\">\n          <span className=\"performer\">{renderText(performer || 'Unknown')}</span>\n          {date && (\n            <>\n              {' '}\n              &bull;\n              {' '}\n              <Link className=\"date\" onClick={handleDateClick}>{formatMediaDateTime(lang, date * 1000)}</Link>\n            </>\n          )}\n        </div>\n      )}\n      <p className=\"duration\" dir=\"auto\">\n        {playProgress > 0 ? `${formatMediaDuration(duration * playProgress)} / ` : undefined}\n        {formatMediaDuration(duration)}\n      </p>\n    </div>\n  );\n}\n\nfunction renderVoice(voice: ApiVoice, renderedWaveform: any, isMediaUnread?: boolean) {\n  return (\n    <div className=\"content\">\n      {renderedWaveform}\n      <p className=\"voice-duration\" dir=\"auto\">\n        {formatMediaDuration(voice.duration)}\n        {isMediaUnread && <span>&bull;</span>}\n      </p>\n    </div>\n  );\n}\n\nfunction renderWaveform(\n  voice: ApiVoice,\n  playProgress = 0,\n  isOwn = false,\n  { handleStartSeek, handleSeek, handleStopSeek }: ISeekMethods,\n  theme: ISettings['theme'],\n) {\n  const { waveform, duration } = voice;\n\n  if (!waveform) {\n    return undefined;\n  }\n\n  const fillColor = theme === 'dark' ? '#494B75' : '#CBCBCB';\n  const fillOwnColor = theme === 'dark' ? '#C0BBED' : '#B0DEA6';\n  const progressFillColor = theme === 'dark' ? '#868DF5' : '#54a3e6';\n  const progressFillOwnColor = theme === 'dark' ? '#FFFFFF' : '#53ad53';\n  const durationFactor = Math.min(duration / AVG_VOICE_DURATION, 1);\n  const spikesCount = Math.round(MIN_SPIKES + (MAX_SPIKES - MIN_SPIKES) * durationFactor);\n  const decodedWaveform = decodeWaveform(new Uint8Array(waveform));\n  const { data: spikes, peak } = interpolateArray(decodedWaveform, spikesCount);\n  const { src, width, height } = renderWaveformToDataUri(spikes, playProgress, {\n    peak,\n    fillStyle: isOwn ? fillOwnColor : fillColor,\n    progressFillStyle: isOwn ? progressFillOwnColor : progressFillColor,\n  });\n\n  return (\n    // eslint-disable-next-line jsx-a11y/no-noninteractive-element-interactions\n    <img\n      src={src}\n      alt=\"\"\n      width={width}\n      height={height}\n      className=\"waveform\"\n      draggable={false}\n      onMouseDown={handleStartSeek}\n      onMouseMove={handleSeek}\n      onMouseUp={handleStopSeek}\n    />\n  );\n}\n\nfunction renderSeekline(\n  playProgress: number,\n  bufferedProgress: number,\n  { handleStartSeek, handleSeek, handleStopSeek }: ISeekMethods,\n) {\n  return (\n    <div\n      className=\"seekline no-selection\"\n      onMouseDown={handleStartSeek}\n      onMouseMove={handleSeek}\n      onMouseUp={handleStopSeek}\n    >\n      <span className=\"seekline-buffered-progress\">\n        <i\n          // @ts-ignore\n          style={`transform: translateX(${bufferedProgress * 100}%)`}\n        />\n      </span>\n      <span className=\"seekline-play-progress\">\n        <i\n          // @ts-ignore\n          style={`transform: translateX(${playProgress * 100}%)`}\n        />\n      </span>\n      <span className=\"seekline-thumb\">\n        <i\n          // @ts-ignore\n          style={`transform: translateX(${playProgress * 100}%)`}\n        />\n      </span>\n    </div>\n  );\n}\n\nexport default memo(Audio);\n","/* eslint-disable no-bitwise */\n\n// eslint-disable-next-line max-len\n// Ref: https://github.com/telegramdesktop/tdesktop/blob/0743e71ab6b928d2ee5bae1aed991849b1e2b291/Telegram/SourceFiles/data/data_document.cpp#L1018\nexport function decodeWaveform(encoded5bit: Uint8Array) {\n  const bitsCount = encoded5bit.length * 8;\n  const valuesCount = Math.floor(bitsCount / 5);\n  if (!valuesCount) {\n    return [];\n  }\n\n  // Read each 5 bit of encoded5bit as 0-31 unsigned char.\n  // We count the index of the byte in which the desired 5-bit sequence starts.\n  // And then we read a uint16 starting from that byte to guarantee to get all of those 5 bits.\n  //\n  // BUT! if it is the last byte we have, we're not allowed to read a uint16 starting with it.\n  // Because it will be an overflow (we'll access one byte after the available memory).\n  // We see, that only the last 5 bits could start in the last available byte and be problematic.\n  // So we read in a general way all the entries in a general way except the last one.\n  const result = Array(valuesCount);\n  const bitsData = encoded5bit;\n  for (let i = 0, l = valuesCount - 1; i !== l; ++i) {\n    const byteIndex = Math.floor((i * 5) / 8);\n    const bitShift = Math.floor((i * 5) % 8);\n    const value = bitsData[byteIndex] + (bitsData[byteIndex + 1] << 8);\n    result[i] = ((value >> bitShift) & 0x1F);\n  }\n  const lastByteIndex = Math.floor(((valuesCount - 1) * 5) / 8);\n  const lastBitShift = Math.floor(((valuesCount - 1) * 5) % 8);\n  const lastValue = bitsData[lastByteIndex] + (bitsData[lastByteIndex + 1] << 8);\n  result[valuesCount - 1] = (lastValue >> lastBitShift) & 0x1F;\n\n  return result;\n}\n\nexport function interpolateArray(data: number[], fitCount: number) {\n  let peak = 0;\n  const newData = new Array(fitCount);\n  const springFactor = data.length / fitCount;\n  const leftFiller = data[0];\n  const rightFiller = data[data.length - 1];\n  for (let i = 0; i < fitCount; i++) {\n    const idx = Math.floor(i * springFactor);\n    const val = ((data[idx - 1] ?? leftFiller) + (data[idx] ?? leftFiller) + (data[idx + 1] ?? rightFiller)) / 3;\n    newData[i] = val;\n    if (peak < val) {\n      peak = val;\n    }\n  }\n  return { data: newData, peak };\n}\n","type IWaveformProps = {\n  peak: number;\n  fillStyle: string;\n  progressFillStyle: string;\n};\n\nconst SPIKE_WIDTH = 2;\nconst SPIKE_STEP = 4;\nconst SPIKE_RADIUS = 1;\nconst HEIGHT = 23;\n\nexport function renderWaveformToDataUri(\n  spikes: number[],\n  progress: number,\n  {\n    peak, fillStyle, progressFillStyle,\n  }: IWaveformProps,\n) {\n  const width = spikes.length * SPIKE_STEP;\n  const height = HEIGHT;\n\n  const canvas = document.createElement('canvas');\n  canvas.width = width * 2;\n  canvas.height = height * 2;\n  canvas.style.width = `${width}px`;\n  canvas.style.height = `${height}px`;\n\n  const ctx = canvas.getContext('2d')!;\n  ctx.scale(2, 2);\n\n  spikes.forEach((item, i) => {\n    ctx.globalAlpha = (i / spikes.length >= progress) ? 0.5 : 1;\n    ctx.fillStyle = progress > i / spikes.length ? progressFillStyle : fillStyle;\n    const spikeHeight = Math.max(2, HEIGHT * (item / Math.max(1, peak)));\n    roundedRectangle(ctx, i * SPIKE_STEP, height, SPIKE_WIDTH, spikeHeight, SPIKE_RADIUS);\n    ctx.fill();\n  });\n\n  return {\n    src: canvas.toDataURL(),\n    width,\n    height,\n  };\n}\n\nfunction roundedRectangle(\n  ctx: CanvasRenderingContext2D, x: number, y: number, width: number, height: number, radius: number,\n) {\n  if (width < 2 * radius) {\n    radius = width / 2;\n  }\n  if (height < 2 * radius) {\n    radius = height / 2;\n  }\n\n  ctx.beginPath();\n  ctx.moveTo(x + radius, y);\n  ctx.arcTo(x + width, y, x + width, y - height, radius);\n  ctx.arcTo(x + width, y - height, x, y - height, radius);\n  ctx.arcTo(x, y - height, x, y, radius);\n  ctx.arcTo(x, y, x + width, y, radius);\n  ctx.closePath();\n}\n","import { MouseEvent as ReactMouseEvent } from 'react';\nimport React, { FC, useCallback, memo } from '../../lib/teact/teact';\n\nimport { ApiUser, ApiChat, ApiMediaFormat } from '../../api/types';\n\nimport { IS_TEST } from '../../config';\nimport {\n  getChatAvatarHash, getChatTitle, isChatPrivate,\n  getUserFullName, isUserOnline, isDeletedUser, getUserColorKey,\n} from '../../modules/helpers';\nimport { getFirstLetters } from '../../util/textFormat';\nimport buildClassName from '../../util/buildClassName';\nimport renderText from './helpers/renderText';\nimport useMedia from '../../hooks/useMedia';\nimport useTransitionForMedia from '../../hooks/useTransitionForMedia';\nimport useLang from '../../hooks/useLang';\n\nimport './Avatar.scss';\n\ntype OwnProps = {\n  className?: string;\n  size?: 'micro' | 'tiny' | 'small' | 'medium' | 'large' | 'jumbo';\n  withOnlineStatus?: boolean;\n  chat?: ApiChat;\n  user?: ApiUser;\n  text?: string;\n  isSavedMessages?: boolean;\n  lastSyncTime?: number;\n  onClick?: (e: ReactMouseEvent<HTMLDivElement, MouseEvent>, hasPhoto: boolean) => void;\n};\n\nconst Avatar: FC<OwnProps> = ({\n  className,\n  size = 'large',\n  chat,\n  user,\n  text,\n  withOnlineStatus,\n  isSavedMessages,\n  lastSyncTime,\n  onClick,\n}) => {\n  const isDeleted = user && isDeletedUser(user);\n  let imageHash: string | undefined;\n\n  if (!isSavedMessages && !isDeleted) {\n    if (user) {\n      imageHash = getChatAvatarHash(user);\n    } else if (chat) {\n      imageHash = getChatAvatarHash(chat);\n    }\n  }\n\n  const dataUri = useMedia(imageHash, false, ApiMediaFormat.DataUri, lastSyncTime);\n  const { shouldRenderFullMedia, transitionClassNames } = useTransitionForMedia(dataUri, 'slow');\n\n  const lang = useLang();\n\n  let content: string | undefined = '';\n\n  if (isSavedMessages) {\n    content = <i className=\"icon-avatar-saved-messages\" />;\n  } else if (isDeleted) {\n    content = <i className=\"icon-avatar-deleted-account\" />;\n  } else if (shouldRenderFullMedia) {\n    content = <img src={dataUri} className={`${transitionClassNames} avatar-media`} alt=\"\" decoding=\"async\" />;\n  } else if (user) {\n    const userFullName = getUserFullName(user);\n    content = userFullName ? getFirstLetters(userFullName, 2) : undefined;\n  } else if (chat) {\n    const title = getChatTitle(lang, chat);\n    content = title && getFirstLetters(title, isChatPrivate(chat.id) ? 2 : 1);\n  } else if (text) {\n    content = getFirstLetters(text, 2);\n  }\n\n  const isOnline = !isSavedMessages && user && isUserOnline(user);\n  const fullClassName = buildClassName(\n    `Avatar size-${size}`,\n    className,\n    `color-bg-${getUserColorKey(user || chat)}`,\n    isSavedMessages && 'saved-messages',\n    isDeleted && 'deleted-account',\n    withOnlineStatus && isOnline && 'online',\n    onClick && 'interactive',\n    (!isSavedMessages && !shouldRenderFullMedia) && 'no-photo',\n  );\n\n  const handleClick = useCallback((e: ReactMouseEvent<HTMLDivElement, MouseEvent>) => {\n    if (onClick) {\n      onClick(e, isSavedMessages || shouldRenderFullMedia);\n    }\n  }, [onClick, isSavedMessages, shouldRenderFullMedia]);\n\n  const senderId = (user || chat) && (user || chat)!.id;\n\n  return (\n    <div className={fullClassName} onClick={handleClick} data-test-sender-id={IS_TEST ? senderId : undefined}>\n      {typeof content === 'string' ? renderText(content, [size === 'jumbo' ? 'hq_emoji' : 'emoji']) : content}\n    </div>\n  );\n};\n\nexport default memo(Avatar);\n","import React, {\n  FC, memo, useCallback, useEffect,\n} from '../../lib/teact/teact';\nimport { withGlobal } from '../../lib/teact/teactn';\n\nimport { GlobalActions, GlobalState } from '../../global/types';\nimport { ApiChat, ApiCountryCode, ApiUser } from '../../api/types';\n\nimport {\n  selectChat, selectNotifyExceptions, selectNotifySettings, selectUser,\n} from '../../modules/selectors';\nimport {\n  getChatDescription, getChatLink, getHasAdminRight, isChatChannel, isChatPrivate, isUserRightBanned, selectIsChatMuted,\n} from '../../modules/helpers';\nimport renderText from './helpers/renderText';\nimport { pick } from '../../util/iteratees';\nimport { copyTextToClipboard } from '../../util/clipboard';\nimport { formatPhoneNumberWithCode } from '../../util/phoneNumber';\nimport useLang from '../../hooks/useLang';\n\nimport ListItem from '../ui/ListItem';\nimport Switcher from '../ui/Switcher';\n\ntype OwnProps = {\n  chatOrUserId: number;\n  forceShowSelf?: boolean;\n};\n\ntype StateProps = {\n  user?: ApiUser;\n  chat?: ApiChat;\n  canInviteUsers?: boolean;\n  isMuted?: boolean;\n  phoneCodeList: ApiCountryCode[];\n} & Pick<GlobalState, 'lastSyncTime'>;\n\ntype DispatchProps = Pick<GlobalActions, 'loadFullUser' | 'updateChatMutedState' | 'showNotification'>;\n\nconst ChatExtra: FC<OwnProps & StateProps & DispatchProps> = ({\n  lastSyncTime,\n  user,\n  chat,\n  forceShowSelf,\n  canInviteUsers,\n  isMuted,\n  phoneCodeList,\n  loadFullUser,\n  showNotification,\n  updateChatMutedState,\n}) => {\n  const {\n    id: userId,\n    fullInfo,\n    username,\n    phoneNumber,\n    isSelf,\n  } = user || {};\n  const { id: chatId } = chat || {};\n  const lang = useLang();\n\n  useEffect(() => {\n    if (lastSyncTime && userId) {\n      loadFullUser({ userId });\n    }\n  }, [loadFullUser, userId, lastSyncTime]);\n\n  const handleNotificationChange = useCallback(() => {\n    updateChatMutedState({ chatId, isMuted: !isMuted });\n  }, [chatId, isMuted, updateChatMutedState]);\n\n  if (!chat || chat.isRestricted || (isSelf && !forceShowSelf)) {\n    return undefined;\n  }\n\n  function copy(text: string, entity: string) {\n    copyTextToClipboard(text);\n    showNotification({ message: `${entity} was copied` });\n  }\n\n  const formattedNumber = phoneNumber && formatPhoneNumberWithCode(phoneCodeList, phoneNumber);\n  const link = getChatLink(chat);\n  const description = (fullInfo?.bio) || getChatDescription(chat);\n\n  return (\n    <div className=\"ChatExtra\">\n      {formattedNumber && !!formattedNumber.length && (\n        <ListItem icon=\"phone\" multiline narrow ripple onClick={() => copy(formattedNumber, lang('Phone'))}>\n          <span className=\"title\" dir=\"auto\">{formattedNumber}</span>\n          <span className=\"subtitle\">{lang('Phone')}</span>\n        </ListItem>\n      )}\n      {username && (\n        <ListItem\n          icon=\"mention\"\n          multiline\n          narrow\n          ripple\n          onClick={() => copy(`@${username}`, lang('Username'))}\n        >\n          <span className=\"title\" dir=\"auto\">{renderText(username)}</span>\n          <span className=\"subtitle\">{lang('Username')}</span>\n        </ListItem>\n      )}\n      {description && !!description.length && (\n        <ListItem\n          icon=\"info\"\n          multiline\n          narrow\n          isStatic\n        >\n          <span className=\"title\" dir=\"auto\">\n            {renderText(description, ['br', 'links', 'emoji'])}\n          </span>\n          <span className=\"subtitle\">{lang(userId ? 'UserBio' : 'Info')}</span>\n        </ListItem>\n      )}\n      {(canInviteUsers || !username) && link && (\n        <ListItem icon=\"mention\" multiline narrow ripple onClick={() => copy(link, lang('SetUrlPlaceholder'))}>\n          <div className=\"title\">{link}</div>\n          <span className=\"subtitle\">{lang('SetUrlPlaceholder')}</span>\n        </ListItem>\n      )}\n      {!forceShowSelf && (\n        <ListItem icon=\"unmute\" ripple onClick={handleNotificationChange}>\n          <span>{lang('Notifications')}</span>\n          <Switcher\n            id=\"group-notifications\"\n            label={userId ? 'Toggle User Notifications' : 'Toggle Chat Notifications'}\n            checked={!isMuted}\n            inactive\n          />\n        </ListItem>\n      )}\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chatOrUserId }): StateProps => {\n    const { lastSyncTime, countryList: { phoneCodes: phoneCodeList } } = global;\n\n    const chat = chatOrUserId ? selectChat(global, chatOrUserId) : undefined;\n    const user = isChatPrivate(chatOrUserId) ? selectUser(global, chatOrUserId) : undefined;\n    const isMuted = chat && selectIsChatMuted(chat, selectNotifySettings(global), selectNotifyExceptions(global));\n\n    const canInviteUsers = chat && !user && (\n      (!isChatChannel(chat) && !isUserRightBanned(chat, 'inviteUsers'))\n      || getHasAdminRight(chat, 'inviteUsers')\n    );\n\n    return {\n      lastSyncTime, phoneCodeList, chat, user, canInviteUsers, isMuted,\n    };\n  },\n  (setGlobal, actions): DispatchProps => pick(actions, [\n    'loadFullUser', 'updateChatMutedState', 'showNotification',\n  ]),\n)(ChatExtra));\n","import React, { FC, useCallback, memo } from '../../lib/teact/teact';\nimport { withGlobal } from '../../lib/teact/teactn';\n\nimport { ApiChat } from '../../api/types';\nimport { GlobalActions } from '../../global/types';\n\nimport { selectIsChatWithSelf, selectUser } from '../../modules/selectors';\nimport {\n  isChatPrivate,\n  isUserBot,\n  getUserFirstOrLastName,\n  getPrivateChatUserId,\n  isChatBasicGroup,\n  isChatSuperGroup,\n  isChatChannel,\n  getChatTitle,\n} from '../../modules/helpers';\nimport { pick } from '../../util/iteratees';\nimport useLang from '../../hooks/useLang';\nimport renderText from './helpers/renderText';\n\nimport Avatar from './Avatar';\nimport Modal from '../ui/Modal';\nimport Button from '../ui/Button';\n\nimport './DeleteChatModal.scss';\n\nexport type OwnProps = {\n  isOpen: boolean;\n  chat: ApiChat;\n  onClose: () => void;\n  onCloseAnimationEnd?: () => void;\n};\n\ntype StateProps = {\n  isChannel: boolean;\n  isChatWithSelf?: boolean;\n  isBot?: boolean;\n  isPrivateChat: boolean;\n  isBasicGroup: boolean;\n  isSuperGroup: boolean;\n  currentUserId: number | undefined;\n  canDeleteForAll?: boolean;\n  contactName?: string;\n};\n\ntype DispatchProps = Pick<GlobalActions, (\n  'leaveChannel' | 'deleteHistory' | 'deleteChannel' | 'deleteChatUser' | 'blockContact'\n)>;\n\nconst DeleteChatModal: FC<OwnProps & StateProps & DispatchProps> = ({\n  isOpen,\n  chat,\n  isChannel,\n  isPrivateChat,\n  isChatWithSelf,\n  isBot,\n  isBasicGroup,\n  isSuperGroup,\n  currentUserId,\n  canDeleteForAll,\n  contactName,\n  onClose,\n  onCloseAnimationEnd,\n  leaveChannel,\n  deleteHistory,\n  deleteChannel,\n  deleteChatUser,\n  blockContact,\n}) => {\n  const lang = useLang();\n  const chatTitle = getChatTitle(lang, chat);\n\n  const handleDeleteMessageForAll = useCallback(() => {\n    deleteHistory({ chatId: chat.id, shouldDeleteForAll: true });\n\n    onClose();\n  }, [deleteHistory, chat.id, onClose]);\n\n  const handleDeleteAndStop = useCallback(() => {\n    deleteHistory({ chatId: chat.id, shouldDeleteForAll: true });\n    blockContact({ contactId: chat.id, accessHash: chat.accessHash });\n\n    onClose();\n  }, [deleteHistory, chat.id, chat.accessHash, blockContact, onClose]);\n\n  const handleDeleteChat = useCallback(() => {\n    if (isPrivateChat) {\n      deleteHistory({ chatId: chat.id, shouldDeleteForAll: false });\n    } else if (isBasicGroup) {\n      deleteChatUser({ chatId: chat.id, userId: currentUserId });\n      deleteHistory({ chatId: chat.id, shouldDeleteForAll: false });\n    } else if ((isChannel || isSuperGroup) && !chat.isCreator) {\n      leaveChannel({ chatId: chat.id });\n    } else if ((isChannel || isSuperGroup) && chat.isCreator) {\n      deleteChannel({ chatId: chat.id });\n    }\n    onClose();\n  }, [\n    isPrivateChat,\n    isBasicGroup,\n    isChannel,\n    isSuperGroup,\n    currentUserId,\n    chat.isCreator,\n    chat.id,\n    onClose,\n    deleteHistory,\n    deleteChatUser,\n    leaveChannel,\n    deleteChannel,\n  ]);\n\n  function renderHeader() {\n    return (\n      <div className=\"modal-header\" dir={lang.isRtl ? 'rtl' : undefined}>\n        <Avatar\n          size=\"tiny\"\n          chat={chat}\n          isSavedMessages={isChatWithSelf}\n        />\n        <h3 className=\"modal-title\">{lang(renderTitle())}</h3>\n      </div>\n    );\n  }\n\n  function renderTitle() {\n    if (isChannel && !chat.isCreator) {\n      return 'LeaveChannel';\n    }\n\n    if (isChannel && chat.isCreator) {\n      return 'ChannelDelete';\n    }\n\n    if (isBasicGroup || isSuperGroup) {\n      return 'Group.LeaveGroup';\n    }\n\n    return 'DeleteChatUser';\n  }\n\n  function renderMessage() {\n    if (isChannel && chat.isCreator) {\n      return <p>{renderText(lang('ChatList.DeleteAndLeaveGroupConfirmation', chatTitle), ['simple_markdown'])}</p>;\n    }\n\n    if ((isChannel && !chat.isCreator) || isBasicGroup || isSuperGroup) {\n      return <p>{renderText(lang('ChannelLeaveAlertWithName', chatTitle), ['simple_markdown'])}</p>;\n    }\n\n    return <p>{renderText(lang('ChatList.DeleteChatConfirmation', contactName), ['simple_markdown'])}</p>;\n  }\n\n  function renderActionText() {\n    if (isChannel && !chat.isCreator) {\n      return 'LeaveChannel';\n    }\n    if (isChannel && chat.isCreator) {\n      return 'Chat.Input.Delete';\n    }\n\n    if (isBasicGroup || isSuperGroup) {\n      return 'Group.LeaveGroup';\n    }\n\n    return canDeleteForAll ? 'ChatList.DeleteForCurrentUser' : 'Delete';\n  }\n\n  return (\n    <Modal\n      isOpen={isOpen}\n      className=\"DeleteChatModal\"\n      header={renderHeader()}\n      onClose={onClose}\n      onCloseAnimationEnd={onCloseAnimationEnd}\n    >\n      {renderMessage()}\n      {isBot && (\n        <Button color=\"danger\" className=\"confirm-dialog-button\" isText onClick={handleDeleteAndStop}>\n          {lang('DeleteAndStop')}\n        </Button>\n      )}\n      {canDeleteForAll && (\n        <Button color=\"danger\" className=\"confirm-dialog-button\" isText onClick={handleDeleteMessageForAll}>\n          {contactName ? renderText(lang('ChatList.DeleteForEveryone', contactName)) : lang('DeleteForAll')}\n        </Button>\n      )}\n      <Button color=\"danger\" className=\"confirm-dialog-button\" isText onClick={handleDeleteChat}>\n        {lang(renderActionText())}\n      </Button>\n      <Button className=\"confirm-dialog-button\" isText onClick={onClose}>{lang('Cancel')}</Button>\n    </Modal>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chat }): StateProps => {\n    const isPrivateChat = isChatPrivate(chat.id);\n    const isChatWithSelf = selectIsChatWithSelf(global, chat.id);\n    const user = isPrivateChat && selectUser(global, getPrivateChatUserId(chat)!);\n    const isBot = user && isUserBot(user) && !chat.isSupport;\n    const canDeleteForAll = (isPrivateChat && !isChatWithSelf && !isBot);\n    const contactName = isPrivateChat\n      ? getUserFirstOrLastName(selectUser(global, getPrivateChatUserId(chat)!))\n      : undefined;\n\n    return {\n      isPrivateChat,\n      isChatWithSelf,\n      isBot,\n      isChannel: isChatChannel(chat),\n      isBasicGroup: isChatBasicGroup(chat),\n      isSuperGroup: isChatSuperGroup(chat),\n      currentUserId: global.currentUserId,\n      canDeleteForAll,\n      contactName,\n    };\n  },\n  (setGlobal, actions): DispatchProps => pick(actions,\n    ['leaveChannel', 'deleteHistory', 'deleteChannel', 'deleteChatUser', 'blockContact']),\n)(DeleteChatModal));\n","import React, {\n  FC, useCallback, useEffect, useState, memo, useRef,\n} from '../../lib/teact/teact';\n\nimport { ApiMediaFormat, ApiMessage } from '../../api/types';\n\nimport { getDocumentExtension, getDocumentHasPreview } from './helpers/documentInfo';\nimport {\n  getMediaTransferState,\n  getMessageMediaHash,\n  getMessageMediaThumbDataUri,\n  isMessageDocumentVideo,\n} from '../../modules/helpers';\nimport { ObserveFn, useIsIntersecting } from '../../hooks/useIntersectionObserver';\nimport useMediaWithDownloadProgress from '../../hooks/useMediaWithDownloadProgress';\nimport useMedia from '../../hooks/useMedia';\nimport download from '../../util/download';\n\nimport File from './File';\n\ntype OwnProps = {\n  message: ApiMessage;\n  observeIntersection?: ObserveFn;\n  smaller?: boolean;\n  isSelected?: boolean;\n  isSelectable?: boolean;\n  uploadProgress?: number;\n  withDate?: boolean;\n  datetime?: number;\n  className?: string;\n  sender?: string;\n  onCancelUpload?: () => void;\n  onMediaClick?: () => void;\n  onDateClick?: (messageId: number, chatId: number) => void;\n};\n\nconst Document: FC<OwnProps> = ({\n  message,\n  observeIntersection,\n  smaller,\n  uploadProgress,\n  withDate,\n  datetime,\n  className,\n  sender,\n  isSelected,\n  isSelectable,\n  onCancelUpload,\n  onMediaClick,\n  onDateClick,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n\n  const document = message.content.document!;\n  const extension = getDocumentExtension(document) || '';\n  const { fileName, size, timestamp } = document;\n  const withMediaViewer = onMediaClick && Boolean(document.mediaType);\n\n  const isIntersecting = useIsIntersecting(ref, observeIntersection);\n\n  const [isDownloadAllowed, setIsDownloadAllowed] = useState(false);\n  const {\n    mediaData, downloadProgress,\n  } = useMediaWithDownloadProgress<ApiMediaFormat.BlobUrl>(\n    getMessageMediaHash(message, 'download'), !isDownloadAllowed, undefined, undefined, undefined, true,\n  );\n  const {\n    isUploading, isTransferring, transferProgress,\n  } = getMediaTransferState(message, uploadProgress || downloadProgress, isDownloadAllowed);\n\n  const hasPreview = getDocumentHasPreview(document);\n  const thumbDataUri = hasPreview ? getMessageMediaThumbDataUri(message) : undefined;\n  const localBlobUrl = hasPreview ? document.previewBlobUrl : undefined;\n  const previewData = useMedia(getMessageMediaHash(message, 'pictogram'), !isIntersecting);\n\n  const handleClick = useCallback(() => {\n    if (withMediaViewer) {\n      onMediaClick!();\n    } else if (isUploading) {\n      if (onCancelUpload) {\n        onCancelUpload();\n      }\n    } else {\n      setIsDownloadAllowed((isAllowed) => !isAllowed);\n    }\n  }, [withMediaViewer, isUploading, onCancelUpload, onMediaClick]);\n\n  const handleDateClick = useCallback(() => {\n    onDateClick!(message.id, message.chatId);\n  }, [onDateClick, message.id, message.chatId]);\n\n  useEffect(() => {\n    if (isDownloadAllowed && mediaData) {\n      download(mediaData, fileName);\n      setIsDownloadAllowed(false);\n    }\n  }, [fileName, mediaData, isDownloadAllowed]);\n\n  return (\n    <File\n      ref={ref}\n      name={fileName}\n      extension={extension}\n      size={size}\n      timestamp={withDate ? datetime || timestamp : undefined}\n      thumbnailDataUri={thumbDataUri}\n      previewData={localBlobUrl || previewData}\n      smaller={smaller}\n      isTransferring={isTransferring}\n      isUploading={isUploading}\n      transferProgress={transferProgress}\n      className={className}\n      sender={sender}\n      isSelectable={isSelectable}\n      isSelected={isSelected}\n      actionIcon={withMediaViewer ? (isMessageDocumentVideo(message) ? 'icon-play' : 'icon-eye') : 'icon-download'}\n      onClick={handleClick}\n      onDateClick={onDateClick ? handleDateClick : undefined}\n    />\n  );\n};\n\nexport default memo(Document);\n","import { RefObject } from 'react';\nimport React, { FC, memo, useRef } from '../../lib/teact/teact';\n\nimport useShowTransition from '../../hooks/useShowTransition';\nimport useTransitionForMedia from '../../hooks/useTransitionForMedia';\nimport buildClassName from '../../util/buildClassName';\nimport { formatMediaDateTime, formatPastTimeShort } from '../../util/dateFormat';\nimport { getColorFromExtension, getFileSizeString } from './helpers/documentInfo';\nimport { getDocumentThumbnailDimensions } from './helpers/mediaDimensions';\nimport renderText from './helpers/renderText';\nimport useLang from '../../hooks/useLang';\n\nimport ProgressSpinner from '../ui/ProgressSpinner';\nimport Link from '../ui/Link';\n\nimport './File.scss';\n\ntype OwnProps = {\n  ref?: RefObject<HTMLDivElement>;\n  name: string;\n  extension?: string;\n  size: number;\n  timestamp?: number;\n  sender?: string;\n  thumbnailDataUri?: string;\n  previewData?: string;\n  className?: string;\n  smaller?: boolean;\n  isTransferring?: boolean;\n  isUploading?: boolean;\n  isSelectable?: boolean;\n  isSelected?: boolean;\n  transferProgress?: number;\n  actionIcon?: string;\n  onClick?: () => void;\n  onDateClick?: (e: React.MouseEvent<HTMLAnchorElement>) => void;\n};\n\nconst File: FC<OwnProps> = ({\n  ref,\n  name,\n  size,\n  extension = '',\n  timestamp,\n  sender,\n  thumbnailDataUri,\n  previewData,\n  className,\n  smaller,\n  isTransferring,\n  isUploading,\n  isSelectable,\n  isSelected,\n  transferProgress,\n  actionIcon,\n  onClick,\n  onDateClick,\n}) => {\n  const lang = useLang();\n  // eslint-disable-next-line no-null/no-null\n  let elementRef = useRef<HTMLDivElement>(null);\n  if (ref) {\n    elementRef = ref;\n  }\n\n  const {\n    shouldRender: shouldSpinnerRender,\n    transitionClassNames: spinnerClassNames,\n  } = useShowTransition(isTransferring, undefined, true);\n  const color = getColorFromExtension(extension);\n  const sizeString = getFileSizeString(size);\n\n  const {\n    shouldRenderThumb, shouldRenderFullMedia, transitionClassNames,\n  } = useTransitionForMedia(previewData, 'slow');\n  const { width, height } = getDocumentThumbnailDimensions(smaller);\n\n  const fullClassName = buildClassName(\n    'File',\n    className,\n    smaller && 'smaller',\n    onClick && !isUploading && 'interactive',\n    isSelected && 'file-is-selected',\n  );\n\n  return (\n    <div ref={elementRef} className={fullClassName} dir={lang.isRtl ? 'rtl' : undefined}>\n      {isSelectable && (\n        <div className=\"message-select-control\">\n          {isSelected && <i className=\"icon-select\" />}\n        </div>\n      )}\n      <div className=\"file-icon-container\" onClick={isUploading ? undefined : onClick}>\n        {thumbnailDataUri || previewData ? (\n          <div className=\"file-preview media-inner\">\n            {shouldRenderThumb && (\n              <img\n                src={thumbnailDataUri}\n                width={width}\n                height={height}\n                className=\"thumbnail\"\n                alt=\"\"\n              />\n            )}\n            {shouldRenderFullMedia && (\n              <img\n                src={previewData}\n                className={`full-media ${transitionClassNames}`}\n                width={width}\n                height={height}\n                alt=\"\"\n              />\n            )}\n          </div>\n        ) : (\n          <div className={`file-icon ${color}`}>\n            {extension.length <= 4 && (\n              <span className=\"file-ext\" dir=\"auto\">{extension}</span>\n            )}\n          </div>\n        )}\n        {shouldSpinnerRender && (\n          <div className={buildClassName('file-progress', color, spinnerClassNames)}>\n            <ProgressSpinner\n              progress={transferProgress}\n              size={smaller ? 's' : 'm'}\n              onClick={isUploading ? onClick : undefined}\n            />\n          </div>\n        )}\n        {onClick && (\n          <i\n            className={buildClassName(\n              'action-icon',\n              actionIcon || 'icon-download',\n              shouldSpinnerRender && 'hidden',\n            )}\n          />\n        )}\n      </div>\n      <div className=\"file-info\">\n        <div className=\"file-title\" dir=\"auto\">{renderText(name)}</div>\n        <div className=\"file-subtitle\" dir=\"auto\">\n          <span>\n            {isTransferring && transferProgress ? `${Math.round(transferProgress * 100)}%` : sizeString}\n          </span>\n          {sender && <span className=\"file-sender\">{renderText(sender)}</span>}\n          {!sender && timestamp && (\n            <>\n              {' '}\n              <Link onClick={onDateClick}>{formatMediaDateTime(lang, timestamp * 1000)}</Link>\n            </>\n          )}\n        </div>\n      </div>\n      {sender && timestamp && (\n        <Link onClick={onDateClick}>{formatPastTimeShort(lang, timestamp * 1000)}</Link>\n      )}\n    </div>\n  );\n};\n\nexport default memo(File);\n","import { MouseEvent as ReactMouseEvent } from 'react';\nimport React, {\n  FC, useEffect, useCallback, memo,\n} from '../../lib/teact/teact';\nimport { withGlobal } from '../../lib/teact/teactn';\n\nimport { ApiChat, ApiTypingStatus } from '../../api/types';\nimport { GlobalActions, GlobalState } from '../../global/types';\nimport { MediaViewerOrigin } from '../../types';\n\nimport {\n  getChatTypeString,\n  getChatTitle,\n  isChatSuperGroup,\n} from '../../modules/helpers';\nimport { selectChat, selectChatMessages, selectChatOnlineCount } from '../../modules/selectors';\nimport renderText from './helpers/renderText';\nimport { pick } from '../../util/iteratees';\nimport useLang, { LangFn } from '../../hooks/useLang';\n\nimport Avatar from './Avatar';\nimport VerifiedIcon from './VerifiedIcon';\nimport TypingStatus from './TypingStatus';\n\ntype OwnProps = {\n  chatId: number;\n  typingStatus?: ApiTypingStatus;\n  avatarSize?: 'small' | 'medium' | 'large' | 'jumbo';\n  withMediaViewer?: boolean;\n  withUsername?: boolean;\n  withFullInfo?: boolean;\n  withUpdatingStatus?: boolean;\n  withChatType?: boolean;\n  noRtl?: boolean;\n};\n\ntype StateProps = {\n  chat?: ApiChat;\n  onlineCount?: number;\n  areMessagesLoaded: boolean;\n} & Pick<GlobalState, 'lastSyncTime'>;\n\ntype DispatchProps = Pick<GlobalActions, 'loadFullChat' | 'openMediaViewer'>;\n\nconst GroupChatInfo: FC<OwnProps & StateProps & DispatchProps> = ({\n  typingStatus,\n  avatarSize = 'medium',\n  withMediaViewer,\n  withUsername,\n  withFullInfo,\n  withUpdatingStatus,\n  withChatType,\n  noRtl,\n  chat,\n  onlineCount,\n  areMessagesLoaded,\n  lastSyncTime,\n  loadFullChat,\n  openMediaViewer,\n}) => {\n  const isSuperGroup = chat && isChatSuperGroup(chat);\n  const { id: chatId, isMin, isRestricted } = chat || {};\n\n  useEffect(() => {\n    if (chatId && !isMin && withFullInfo && lastSyncTime) {\n      loadFullChat({ chatId });\n    }\n  }, [chatId, isMin, lastSyncTime, withFullInfo, loadFullChat, isSuperGroup]);\n\n  const handleAvatarViewerOpen = useCallback((e: ReactMouseEvent<HTMLDivElement, MouseEvent>, hasPhoto: boolean) => {\n    if (chat && hasPhoto) {\n      e.stopPropagation();\n      openMediaViewer({\n        avatarOwnerId: chat.id,\n        origin: avatarSize === 'jumbo' ? MediaViewerOrigin.ProfileAvatar : MediaViewerOrigin.MiddleHeaderAvatar,\n      });\n    }\n  }, [chat, avatarSize, openMediaViewer]);\n\n  const lang = useLang();\n\n  if (!chat) {\n    return undefined;\n  }\n\n  function renderStatusOrTyping() {\n    if (withUpdatingStatus && !areMessagesLoaded && !isRestricted) {\n      return (\n        <span className=\"status\" dir=\"auto\">{lang('Updating')}</span>\n      );\n    }\n\n    if (!chat) {\n      return undefined;\n    }\n\n    if (typingStatus) {\n      return <TypingStatus typingStatus={typingStatus} />;\n    }\n\n    if (withChatType) {\n      return (\n        <div className=\"status\" dir=\"auto\">{lang(getChatTypeString(chat))}</div>\n      );\n    }\n\n    const handle = withUsername ? chat.username : undefined;\n    const groupStatus = getGroupStatus(lang, chat);\n    const onlineStatus = onlineCount ? `, ${lang('OnlineCount', onlineCount, 'i')}` : undefined;\n\n    return (\n      <div className=\"status\">\n        {handle && <span className=\"handle\">{handle}</span>}\n        <span className=\"group-status\">{groupStatus}</span>\n        {onlineStatus && <span className=\"online-status\">{onlineStatus}</span>}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"ChatInfo\" dir={!noRtl && lang.isRtl ? 'rtl' : undefined}>\n      <Avatar\n        key={chat.id}\n        size={avatarSize}\n        chat={chat}\n        onClick={withMediaViewer ? handleAvatarViewerOpen : undefined}\n      />\n      <div className=\"info\">\n        <div className=\"title\">\n          <h3 dir=\"auto\">{renderText(getChatTitle(lang, chat))}</h3>\n          {chat.isVerified && <VerifiedIcon />}\n        </div>\n        {renderStatusOrTyping()}\n      </div>\n    </div>\n  );\n};\n\nfunction getGroupStatus(lang: LangFn, chat: ApiChat) {\n  const chatTypeString = lang(getChatTypeString(chat));\n  const { membersCount } = chat;\n\n  if (chat.isRestricted) {\n    return chatTypeString === 'Channel' ? 'channel is inaccessible' : 'group is inaccessible';\n  }\n\n  if (!membersCount) {\n    return chatTypeString;\n  }\n\n  return chatTypeString === 'Channel'\n    ? lang('Subscribers', membersCount, 'i')\n    : lang('Members', membersCount, 'i');\n}\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chatId }): StateProps => {\n    const { lastSyncTime } = global;\n    const chat = selectChat(global, chatId);\n    const onlineCount = chat ? selectChatOnlineCount(global, chat) : undefined;\n    const areMessagesLoaded = Boolean(selectChatMessages(global, chatId));\n\n    return {\n      lastSyncTime, chat, onlineCount, areMessagesLoaded,\n    };\n  },\n  (setGlobal, actions): DispatchProps => pick(actions, ['loadFullChat', 'openMediaViewer']),\n)(GroupChatInfo));\n","import React, { FC, memo } from '../../lib/teact/teact';\n\nimport { ApiMessage, ApiMessageOutgoingStatus } from '../../api/types';\n\nimport { formatPastTimeShort } from '../../util/dateFormat';\nimport useLang from '../../hooks/useLang';\n\nimport MessageOutgoingStatus from './MessageOutgoingStatus';\n\nimport './LastMessageMeta.scss';\n\ntype OwnProps = {\n  message: ApiMessage;\n  outgoingStatus?: ApiMessageOutgoingStatus;\n};\n\nconst LastMessageMeta: FC<OwnProps> = ({ message, outgoingStatus }) => {\n  const lang = useLang();\n  return (\n    <div className=\"LastMessageMeta\">\n      {outgoingStatus && (\n        <MessageOutgoingStatus status={outgoingStatus} />\n      )}\n      <span className=\"time\">{formatPastTimeShort(lang, message.date * 1000)}</span>\n    </div>\n  );\n};\n\nexport default memo(LastMessageMeta);\n","import React, { FC, memo, useCallback } from '../../lib/teact/teact';\n\nimport { ApiMessage } from '../../api/types';\n\nimport { formatMediaDuration } from '../../util/dateFormat';\nimport {\n  getMessageMediaHash,\n  getMessageMediaThumbDataUri,\n  getMessageVideo,\n} from '../../modules/helpers';\nimport useMedia from '../../hooks/useMedia';\nimport useTransitionForMedia from '../../hooks/useTransitionForMedia';\n\nimport './Media.scss';\n\ntype OwnProps = {\n  message: ApiMessage;\n  idPrefix?: string;\n  onClick?: (messageId: number, chatId: number) => void;\n};\n\nconst Media: FC<OwnProps> = ({ message, idPrefix = 'shared-media', onClick }) => {\n  const handleClick = useCallback(() => {\n    onClick!(message.id, message.chatId);\n  }, [message.id, message.chatId, onClick]);\n\n  const thumbDataUri = getMessageMediaThumbDataUri(message);\n  const mediaBlobUrl = useMedia(getMessageMediaHash(message, 'pictogram'));\n  const {\n    shouldRenderThumb, shouldRenderFullMedia, transitionClassNames,\n  } = useTransitionForMedia(mediaBlobUrl, 'slow');\n\n  const video = getMessageVideo(message);\n\n  return (\n    <div id={`${idPrefix}${message.id}`} className=\"Media scroll-item\" onClick={onClick ? handleClick : undefined}>\n      {shouldRenderThumb && (\n        <img src={thumbDataUri} alt=\"\" />\n      )}\n      {shouldRenderFullMedia && (\n        <img src={mediaBlobUrl} className={`${transitionClassNames} full-media`} alt=\"\" />\n      )}\n      {video && <span className=\"video-duration\">{video.isGif ? 'GIF' : formatMediaDuration(video.duration)}</span>}\n    </div>\n  );\n};\n\nexport default memo(Media);\n","import React, { FC, memo } from '../../lib/teact/teact';\n\nimport { ApiMessageOutgoingStatus } from '../../api/types';\n\nimport Transition from '../ui/Transition';\n\nimport './MessageOutgoingStatus.scss';\n\ntype OwnProps = {\n  status: ApiMessageOutgoingStatus;\n};\n\nenum Keys {\n  failed, pending, succeeded, read,\n}\n\nconst MessageOutgoingStatus: FC<OwnProps> = ({ status }) => {\n  return (\n    <div className=\"MessageOutgoingStatus\">\n      <Transition name=\"reveal\" activeKey={Keys[status]}>\n        {() => (\n          <i className={`icon-message-${status}`} />\n        )}\n      </Transition>\n    </div>\n  );\n};\n\nexport default memo(MessageOutgoingStatus);\n","import React, { FC, memo } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\nimport useShowTransition from '../../hooks/useShowTransition';\nimport renderText from './helpers/renderText';\nimport useLang from '../../hooks/useLang';\n\nimport './NothingFound.scss';\n\ninterface OwnProps {\n  text?: string;\n  description?: string;\n}\n\nconst DEFAULT_TEXT = 'Nothing found.';\n\nconst NothingFound: FC<OwnProps> = ({ text = DEFAULT_TEXT, description }) => {\n  const lang = useLang();\n  const { transitionClassNames } = useShowTransition(true);\n\n  return (\n    <div className={buildClassName('NothingFound', transitionClassNames, description && 'with-description')}>\n      {text}\n      {description && <p className=\"description\">{renderText(lang(description), ['br'])}</p>}\n    </div>\n  );\n};\n\nexport default memo(NothingFound);\n","import React, {\n  FC, useCallback, useRef, useEffect, memo,\n} from '../../lib/teact/teact';\n\nimport { isChatPrivate } from '../../modules/helpers';\n\nimport InfiniteScroll from '../ui/InfiniteScroll';\nimport Checkbox from '../ui/Checkbox';\nimport InputText from '../ui/InputText';\nimport ListItem from '../ui/ListItem';\nimport PrivateChatInfo from './PrivateChatInfo';\nimport GroupChatInfo from './GroupChatInfo';\nimport PickerSelectedItem from './PickerSelectedItem';\nimport useInfiniteScroll from '../../hooks/useInfiniteScroll';\nimport useLang from '../../hooks/useLang';\n\nimport Loading from '../ui/Loading';\n\nimport './Picker.scss';\n\ntype OwnProps = {\n  itemIds: number[];\n  selectedIds: number[];\n  filterValue?: string;\n  filterPlaceholder?: string;\n  notFoundText?: string;\n  searchInputId?: string;\n  isLoading?: boolean;\n  noScrollRestore?: boolean;\n  onSelectedIdsChange: (ids: number[]) => void;\n  onFilterChange: (value: string) => void;\n  onLoadMore?: () => void;\n};\n\n// Focus slows down animation, also it breaks transition layout in Chrome\nconst FOCUS_DELAY_MS = 500;\n\nconst MAX_FULL_ITEMS = 10;\nconst ALWAYS_FULL_ITEMS_COUNT = 5;\n\nconst Picker: FC<OwnProps> = ({\n  itemIds,\n  selectedIds,\n  filterValue,\n  filterPlaceholder,\n  notFoundText,\n  searchInputId,\n  isLoading,\n  noScrollRestore,\n  onSelectedIdsChange,\n  onFilterChange,\n  onLoadMore,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const inputRef = useRef<HTMLInputElement>(null);\n  const shouldMinimize = selectedIds.length > MAX_FULL_ITEMS;\n\n  useEffect(() => {\n    setTimeout(() => {\n      requestAnimationFrame(() => {\n        inputRef.current!.focus();\n      });\n    }, FOCUS_DELAY_MS);\n  }, []);\n\n  const handleItemClick = useCallback((id: number) => {\n    const newSelectedIds = [...selectedIds];\n    if (newSelectedIds.includes(id)) {\n      newSelectedIds.splice(newSelectedIds.indexOf(id), 1);\n    } else {\n      newSelectedIds.push(id);\n    }\n    onSelectedIdsChange(newSelectedIds);\n    onFilterChange('');\n  }, [selectedIds, onSelectedIdsChange, onFilterChange]);\n\n  const handleFilterChange = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    const { value } = e.currentTarget;\n    onFilterChange(value);\n  }, [onFilterChange]);\n\n  const [viewportIds, getMore] = useInfiniteScroll(onLoadMore, itemIds, Boolean(filterValue));\n\n  const lang = useLang();\n\n  return (\n    <div className=\"Picker\">\n      <div className=\"picker-header custom-scroll\" dir={lang.isRtl ? 'rtl' : undefined}>\n        {selectedIds.map((id, i) => (\n          <PickerSelectedItem\n            chatOrUserId={id}\n            isMinimized={shouldMinimize && i < selectedIds.length - ALWAYS_FULL_ITEMS_COUNT}\n            canClose\n            onClick={handleItemClick}\n            clickArg={id}\n          />\n        ))}\n        <InputText\n          id={searchInputId}\n          ref={inputRef}\n          value={filterValue}\n          onChange={handleFilterChange}\n          placeholder={filterPlaceholder || lang('SelectChat')}\n        />\n      </div>\n\n      {viewportIds?.length ? (\n        <InfiniteScroll\n          className=\"picker-list custom-scroll\"\n          items={viewportIds}\n          onLoadMore={getMore}\n          noScrollRestore={noScrollRestore}\n        >\n          {viewportIds.map((id) => (\n            <ListItem\n              key={id}\n              className=\"chat-item-clickable picker-list-item\"\n              onClick={() => handleItemClick(id)}\n              ripple\n            >\n              <Checkbox label=\"\" checked={selectedIds.includes(id)} />\n              {isChatPrivate(id) ? (\n                <PrivateChatInfo userId={id} />\n              ) : (\n                <GroupChatInfo chatId={id} />\n              )}\n            </ListItem>\n          ))}\n        </InfiniteScroll>\n      ) : !isLoading && viewportIds && !viewportIds.length ? (\n        <p className=\"no-results\">{notFoundText || 'Sorry, nothing found.'}</p>\n      ) : (\n        <Loading />\n      )}\n    </div>\n  );\n};\n\nexport default memo(Picker);\n","import React, { FC, memo } from '../../lib/teact/teact';\nimport { withGlobal } from '../../lib/teact/teactn';\n\nimport { ApiChat, ApiUser } from '../../api/types';\n\nimport { selectChat, selectUser } from '../../modules/selectors';\nimport { getChatTitle, getUserFirstOrLastName, isChatPrivate } from '../../modules/helpers';\nimport renderText from './helpers/renderText';\nimport buildClassName from '../../util/buildClassName';\nimport useLang from '../../hooks/useLang';\n\nimport Avatar from './Avatar';\n\nimport './PickerSelectedItem.scss';\n\ntype OwnProps = {\n  chatOrUserId?: number;\n  icon?: string;\n  title?: string;\n  isMinimized?: boolean;\n  canClose?: boolean;\n  onClick: (arg: any) => void;\n  clickArg: any;\n  className?: string;\n};\n\ntype StateProps = {\n  chat?: ApiChat;\n  user?: ApiUser;\n};\n\nconst PickerSelectedItem: FC<OwnProps & StateProps> = ({\n  icon,\n  title,\n  isMinimized,\n  canClose,\n  onClick,\n  clickArg,\n  chat,\n  user,\n  className,\n}) => {\n  const lang = useLang();\n\n  let iconElement: any;\n  let titleText: any;\n\n  if (icon && title) {\n    iconElement = (\n      <div className=\"item-icon\">\n        <i className={`icon-${icon}`} />\n      </div>\n    );\n\n    titleText = title;\n  } else if (chat || user) {\n    iconElement = (\n      <Avatar\n        chat={chat}\n        user={user}\n        size=\"small\"\n        isSavedMessages={user?.isSelf}\n      />\n    );\n\n    const name = !chat || (user && !user.isSelf)\n      ? getUserFirstOrLastName(user)\n      : getChatTitle(lang, chat, user);\n\n    titleText = name ? renderText(name) : undefined;\n  }\n\n  const fullClassName = buildClassName(\n    'PickerSelectedItem',\n    className,\n    isMinimized && 'minimized',\n    canClose && 'closeable',\n  );\n\n  return (\n    <div\n      className={fullClassName}\n      onClick={() => onClick(clickArg)}\n      title={isMinimized ? titleText : undefined}\n      dir={lang.isRtl ? 'rtl' : undefined}\n    >\n      {iconElement}\n      {!isMinimized && (\n        <div className=\"item-name\" dir=\"auto\">\n          {titleText}\n        </div>\n      )}\n      {canClose && (\n        <div className=\"item-remove\">\n          <i className=\"icon-close\" />\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chatOrUserId }): StateProps => {\n    if (!chatOrUserId) {\n      return {};\n    }\n\n    const chat = chatOrUserId ? selectChat(global, chatOrUserId) : undefined;\n    const user = isChatPrivate(chatOrUserId) ? selectUser(global, chatOrUserId) : undefined;\n\n    return {\n      chat,\n      user,\n    };\n  },\n)(PickerSelectedItem));\n","import { MouseEvent as ReactMouseEvent } from 'react';\nimport React, {\n  FC, useEffect, useCallback, memo,\n} from '../../lib/teact/teact';\nimport { withGlobal } from '../../lib/teact/teactn';\n\nimport { ApiUser, ApiTypingStatus } from '../../api/types';\nimport { GlobalActions, GlobalState } from '../../global/types';\nimport { MediaViewerOrigin } from '../../types';\n\nimport { selectChatMessages, selectUser } from '../../modules/selectors';\nimport { getUserFullName, getUserStatus, isUserOnline } from '../../modules/helpers';\nimport renderText from './helpers/renderText';\nimport { pick } from '../../util/iteratees';\nimport useLang from '../../hooks/useLang';\n\nimport Avatar from './Avatar';\nimport VerifiedIcon from './VerifiedIcon';\nimport TypingStatus from './TypingStatus';\n\ntype OwnProps = {\n  userId: number;\n  typingStatus?: ApiTypingStatus;\n  avatarSize?: 'tiny' | 'small' | 'medium' | 'large' | 'jumbo';\n  forceShowSelf?: boolean;\n  status?: string;\n  withMediaViewer?: boolean;\n  withUsername?: boolean;\n  withFullInfo?: boolean;\n  withUpdatingStatus?: boolean;\n  noStatusOrTyping?: boolean;\n  noRtl?: boolean;\n};\n\ntype StateProps = {\n  user?: ApiUser;\n  isSavedMessages?: boolean;\n  areMessagesLoaded: boolean;\n  serverTimeOffset: number;\n} & Pick<GlobalState, 'lastSyncTime'>;\n\ntype DispatchProps = Pick<GlobalActions, 'loadFullUser' | 'openMediaViewer'>;\n\nconst PrivateChatInfo: FC<OwnProps & StateProps & DispatchProps> = ({\n  typingStatus,\n  avatarSize = 'medium',\n  status,\n  withMediaViewer,\n  withUsername,\n  withFullInfo,\n  withUpdatingStatus,\n  noStatusOrTyping,\n  noRtl,\n  user,\n  isSavedMessages,\n  areMessagesLoaded,\n  lastSyncTime,\n  loadFullUser,\n  openMediaViewer,\n  serverTimeOffset,\n}) => {\n  const { id: userId } = user || {};\n  const fullName = getUserFullName(user);\n\n  useEffect(() => {\n    if (withFullInfo && lastSyncTime && userId) {\n      loadFullUser({ userId });\n    }\n  }, [userId, loadFullUser, lastSyncTime, withFullInfo]);\n\n  const handleAvatarViewerOpen = useCallback((e: ReactMouseEvent<HTMLDivElement, MouseEvent>, hasPhoto: boolean) => {\n    if (user && hasPhoto) {\n      e.stopPropagation();\n      openMediaViewer({\n        avatarOwnerId: user.id,\n        origin: avatarSize === 'jumbo' ? MediaViewerOrigin.ProfileAvatar : MediaViewerOrigin.MiddleHeaderAvatar,\n      });\n    }\n  }, [user, avatarSize, openMediaViewer]);\n\n  const lang = useLang();\n\n  if (!user) {\n    return undefined;\n  }\n\n  function renderStatusOrTyping() {\n    if (status) {\n      return (\n        <span className=\"status\" dir=\"auto\">{status}</span>\n      );\n    }\n\n    if (withUpdatingStatus && !areMessagesLoaded) {\n      return (\n        <span className=\"status\" dir=\"auto\">{lang('Updating')}</span>\n      );\n    }\n\n    if (!user) {\n      return undefined;\n    }\n\n    if (typingStatus) {\n      return <TypingStatus typingStatus={typingStatus} />;\n    }\n\n    return (\n      <div className={`status ${isUserOnline(user) ? 'online' : ''}`}>\n        {withUsername && user.username && <span className=\"handle\">{user.username}</span>}\n        <span className=\"user-status\" dir=\"auto\">{getUserStatus(lang, user, serverTimeOffset)}</span>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"ChatInfo\" dir={!noRtl && lang.isRtl ? 'rtl' : undefined}>\n      <Avatar\n        key={user.id}\n        size={avatarSize}\n        user={user}\n        isSavedMessages={isSavedMessages}\n        onClick={withMediaViewer ? handleAvatarViewerOpen : undefined}\n      />\n      <div className=\"info\">\n        {isSavedMessages ? (\n          <div className=\"title\">\n            <h3>{lang('SavedMessages')}</h3>\n          </div>\n        ) : (\n          <div className=\"title\">\n            <h3 dir=\"auto\">{fullName && renderText(fullName)}</h3>\n            {user?.isVerified && <VerifiedIcon />}\n          </div>\n        )}\n        {(status || (!isSavedMessages && !noStatusOrTyping)) && renderStatusOrTyping()}\n      </div>\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { userId, forceShowSelf }): StateProps => {\n    const { lastSyncTime, serverTimeOffset } = global;\n    const user = selectUser(global, userId);\n    const isSavedMessages = !forceShowSelf && user && user.isSelf;\n    const areMessagesLoaded = Boolean(selectChatMessages(global, userId));\n\n    return {\n      lastSyncTime, user, isSavedMessages, areMessagesLoaded, serverTimeOffset,\n    };\n  },\n  (setGlobal, actions): DispatchProps => pick(actions, ['loadFullUser', 'openMediaViewer']),\n)(PrivateChatInfo));\n","import React, { FC, memo } from '../../lib/teact/teact';\n\nimport {\n  ApiUser, ApiChat, ApiMediaFormat, ApiPhoto,\n} from '../../api/types';\n\nimport {\n  getChatAvatarHash, isDeletedUser, getUserColorKey, getChatTitle, isChatPrivate, getUserFullName,\n} from '../../modules/helpers';\nimport renderText from './helpers/renderText';\nimport buildClassName from '../../util/buildClassName';\nimport { getFirstLetters } from '../../util/textFormat';\nimport useMedia from '../../hooks/useMedia';\nimport useBlurSync from '../../hooks/useBlurSync';\nimport usePrevious from '../../hooks/usePrevious';\nimport useLang from '../../hooks/useLang';\n\nimport Spinner from '../ui/Spinner';\n\nimport './ProfilePhoto.scss';\n\ntype OwnProps = {\n  chat?: ApiChat;\n  user?: ApiUser;\n  isFirstPhoto?: boolean;\n  isSavedMessages?: boolean;\n  photo?: ApiPhoto;\n  lastSyncTime?: number;\n  onClick: NoneToVoidFunction;\n};\n\nconst ProfilePhoto: FC<OwnProps> = ({\n  chat,\n  user,\n  photo,\n  isFirstPhoto,\n  isSavedMessages,\n  lastSyncTime,\n  onClick,\n}) => {\n  const lang = useLang();\n  const isDeleted = user && isDeletedUser(user);\n\n  function getMediaHash(size: 'normal' | 'big' = 'big', forceAvatar?: boolean) {\n    if (photo && !forceAvatar) {\n      return `photo${photo.id}?size=c`;\n    }\n\n    let hash: string | undefined;\n    if (!isSavedMessages && !isDeleted) {\n      if (user) {\n        hash = getChatAvatarHash(user, size);\n      } else if (chat) {\n        hash = getChatAvatarHash(chat, size);\n      }\n    }\n\n    return hash;\n  }\n\n  const imageHash = getMediaHash();\n  const fullMediaData = useMedia(\n    imageHash,\n    false,\n    imageHash?.startsWith('avatar') ? ApiMediaFormat.DataUri : ApiMediaFormat.BlobUrl,\n    lastSyncTime,\n  );\n  const avatarThumbnailData = useMedia(\n    !fullMediaData && isFirstPhoto ? getMediaHash('normal', true) : undefined,\n    false,\n    ApiMediaFormat.DataUri,\n    lastSyncTime,\n  );\n  const thumbDataUri = useBlurSync(!fullMediaData && photo && photo.thumbnail && photo.thumbnail.dataUri);\n  const imageSrc = fullMediaData || avatarThumbnailData || thumbDataUri;\n  const prevImageSrc = usePrevious(imageSrc);\n\n  let content: string | undefined = '';\n\n  if (isSavedMessages) {\n    content = <i className=\"icon-avatar-saved-messages\" />;\n  } else if (isDeleted) {\n    content = <i className=\"icon-avatar-deleted-account\" />;\n  } else if (imageSrc) {\n    content = <img src={imageSrc} className=\"avatar-media\" alt=\"\" decoding=\"async\" />;\n  } else if (!imageSrc && user) {\n    const userFullName = getUserFullName(user);\n    content = userFullName ? getFirstLetters(userFullName, 2) : undefined;\n  } else if (!imageSrc && chat) {\n    const title = getChatTitle(lang, chat);\n    content = title && getFirstLetters(title, isChatPrivate(chat.id) ? 2 : 1);\n  } else {\n    content = (\n      <div className=\"spinner-wrapper\">\n        <Spinner color=\"white\" />\n      </div>\n    );\n  }\n\n  const fullClassName = buildClassName(\n    'ProfilePhoto',\n    `color-bg-${getUserColorKey(user || chat)}`,\n    isSavedMessages && 'saved-messages',\n    isDeleted && 'deleted-account',\n    (!isSavedMessages && !(imageSrc)) && 'no-photo',\n  );\n\n  return (\n    <div className={fullClassName} onClick={imageSrc ? onClick : undefined}>\n      {prevImageSrc && imageSrc && prevImageSrc !== imageSrc && (\n        <img src={prevImageSrc} className=\"prev-avatar-media\" alt=\"\" decoding=\"async\" />\n      )}\n      {typeof content === 'string' ? renderText(content, ['hq_emoji']) : content}\n    </div>\n  );\n};\n\nexport default memo(ProfilePhoto);\n","import React, {\n  FC, useEffect, useCallback, memo, useState,\n} from '../../lib/teact/teact';\nimport { withGlobal } from '../../lib/teact/teactn';\n\nimport { ApiUser, ApiChat } from '../../api/types';\nimport { GlobalActions, GlobalState } from '../../global/types';\nimport { MediaViewerOrigin } from '../../types';\n\nimport { IS_TOUCH_ENV } from '../../util/environment';\nimport { selectChat, selectUser } from '../../modules/selectors';\nimport {\n  getUserFullName, getUserStatus, isChatChannel, isUserOnline,\n} from '../../modules/helpers';\nimport renderText from './helpers/renderText';\nimport { pick } from '../../util/iteratees';\nimport { captureEvents, SwipeDirection } from '../../util/captureEvents';\nimport buildClassName from '../../util/buildClassName';\nimport usePhotosPreload from './hooks/usePhotosPreload';\nimport useLang from '../../hooks/useLang';\n\nimport VerifiedIcon from './VerifiedIcon';\nimport ProfilePhoto from './ProfilePhoto';\nimport Transition from '../ui/Transition';\n\nimport './ProfileInfo.scss';\n\ntype OwnProps = {\n  userId: number;\n  forceShowSelf?: boolean;\n};\n\ntype StateProps = {\n  user?: ApiUser;\n  chat?: ApiChat;\n  isSavedMessages?: boolean;\n  animationLevel: 0 | 1 | 2;\n  serverTimeOffset: number;\n} & Pick<GlobalState, 'connectionState'>;\n\ntype DispatchProps = Pick<GlobalActions, 'loadFullUser' | 'openMediaViewer'>;\n\nconst ProfileInfo: FC<OwnProps & StateProps & DispatchProps> = ({\n  forceShowSelf,\n  user,\n  chat,\n  isSavedMessages,\n  connectionState,\n  animationLevel,\n  loadFullUser,\n  openMediaViewer,\n  serverTimeOffset,\n}) => {\n  const { id: userId } = user || {};\n  const { id: chatId } = chat || {};\n  const fullName = user ? getUserFullName(user) : (chat ? chat.title : '');\n  const photos = user?.photos || chat?.photos || [];\n  const slideAnimation = animationLevel >= 1 ? 'slide' : 'none';\n\n  const [currentPhotoIndex, setCurrentPhotoIndex] = useState(0);\n  const isFirst = isSavedMessages || photos.length <= 1 || currentPhotoIndex === 0;\n  const isLast = isSavedMessages || photos.length <= 1 || currentPhotoIndex === photos.length - 1;\n\n  // Deleting the last profile photo may result in an error\n  useEffect(() => {\n    if (currentPhotoIndex > photos.length) {\n      setCurrentPhotoIndex(Math.max(0, photos.length - 1));\n    }\n  }, [currentPhotoIndex, photos.length]);\n\n  const lang = useLang();\n\n  useEffect(() => {\n    if (connectionState === 'connectionStateReady' && userId && !forceShowSelf) {\n      loadFullUser({ userId });\n    }\n  }, [userId, loadFullUser, connectionState, forceShowSelf]);\n\n  usePhotosPreload(user || chat, photos, currentPhotoIndex);\n\n  const handleProfilePhotoClick = useCallback(() => {\n    openMediaViewer({\n      avatarOwnerId: userId || chatId,\n      profilePhotoIndex: currentPhotoIndex,\n      origin: forceShowSelf ? MediaViewerOrigin.SettingsAvatar : MediaViewerOrigin.ProfileAvatar,\n    });\n  }, [openMediaViewer, userId, chatId, currentPhotoIndex, forceShowSelf]);\n\n  const selectPreviousMedia = useCallback(() => {\n    if (isFirst) {\n      return;\n    }\n\n    setCurrentPhotoIndex(currentPhotoIndex - 1);\n  }, [currentPhotoIndex, isFirst]);\n\n  const selectNextMedia = useCallback(() => {\n    if (isLast) {\n      return;\n    }\n\n    setCurrentPhotoIndex(currentPhotoIndex + 1);\n  }, [currentPhotoIndex, isLast]);\n\n  // Support for swipe gestures and closing on click\n  useEffect(() => {\n    const element = document.querySelector<HTMLDivElement>('.photo-wrapper');\n    if (!element) {\n      return undefined;\n    }\n\n    return captureEvents(element, {\n      selectorToPreventScroll: '.Profile, .settings-content',\n      onSwipe: IS_TOUCH_ENV ? (e, direction) => {\n        if (direction === SwipeDirection.Right) {\n          selectPreviousMedia();\n          return true;\n        } else if (direction === SwipeDirection.Left) {\n          selectNextMedia();\n          return true;\n        }\n\n        return false;\n      } : undefined,\n    });\n  }, [selectNextMedia, selectPreviousMedia]);\n\n  if (!user && !chat) {\n    return undefined;\n  }\n\n  function renderPhotoTabs() {\n    if (isSavedMessages || !photos || photos.length <= 1) {\n      return undefined;\n    }\n\n    return (\n      <div className=\"photo-dashes\">\n        {photos.map((_, i) => (\n          <span className={`photo-dash ${i === currentPhotoIndex ? 'current' : ''}`} />\n        ))}\n      </div>\n    );\n  }\n\n  function renderPhoto() {\n    const photo = !isSavedMessages && photos && photos.length > 0 ? photos[currentPhotoIndex] : undefined;\n\n    return (\n      <ProfilePhoto\n        key={currentPhotoIndex}\n        user={user}\n        chat={chat}\n        photo={photo}\n        isSavedMessages={isSavedMessages}\n        isFirstPhoto={isFirst}\n        onClick={handleProfilePhotoClick}\n      />\n    );\n  }\n\n  function renderStatus() {\n    if (user) {\n      return (\n        <div className={`status ${isUserOnline(user) ? 'online' : ''}`}>\n          <span className=\"user-status\" dir=\"auto\">{getUserStatus(lang, user, serverTimeOffset)}</span>\n        </div>\n      );\n    }\n\n    return (\n      <span className=\"status\" dir=\"auto\">{\n        isChatChannel(chat!)\n          ? lang('Subscribers', chat!.membersCount ?? 0, 'i')\n          : lang('Members', chat!.membersCount ?? 0, 'i')\n      }\n      </span>\n    );\n  }\n\n  const isVerifiedIconShown = (user || chat)?.isVerified;\n\n  return (\n    <div className={buildClassName('ProfileInfo', forceShowSelf && 'self')} dir={lang.isRtl ? 'rtl' : undefined}>\n      <div className=\"photo-wrapper\">\n        {renderPhotoTabs()}\n        <Transition activeKey={currentPhotoIndex} name={slideAnimation} className=\"profile-slide-container\">\n          {renderPhoto}\n        </Transition>\n\n        {!isFirst && (\n          <button\n            type=\"button\"\n            className=\"navigation prev\"\n            aria-label={lang('AccDescrPrevious')}\n            onClick={selectPreviousMedia}\n          />\n        )}\n        {!isLast && (\n          <button\n            type=\"button\"\n            className=\"navigation next\"\n            aria-label={lang('Next')}\n            onClick={selectNextMedia}\n          />\n        )}\n      </div>\n\n      <div className=\"info\" dir={lang.isRtl ? 'rtl' : 'auto'}>\n        {isSavedMessages ? (\n          <div className=\"title\">\n            <h3 dir=\"auto\">{lang('SavedMessages')}</h3>\n          </div>\n        ) : (\n          <div className=\"title\">\n            <h3 dir=\"auto\">{fullName && renderText(fullName)}</h3>\n            {isVerifiedIconShown && <VerifiedIcon />}\n          </div>\n        )}\n        {!isSavedMessages && renderStatus()}\n      </div>\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { userId, forceShowSelf }): StateProps => {\n    const { connectionState, serverTimeOffset } = global;\n    const user = selectUser(global, userId);\n    const chat = selectChat(global, userId);\n    const isSavedMessages = !forceShowSelf && user && user.isSelf;\n    const { animationLevel } = global.settings.byKey;\n\n    return {\n      connectionState, user, chat, isSavedMessages, animationLevel, serverTimeOffset,\n    };\n  },\n  (setGlobal, actions): DispatchProps => pick(actions, ['loadFullUser', 'openMediaViewer']),\n)(ProfileInfo));\n","import {\n  ApiChat, ApiMediaFormat, ApiPhoto, ApiUser,\n} from '../../../api/types';\nimport { useEffect } from '../../../lib/teact/teact';\nimport * as mediaLoader from '../../../util/mediaLoader';\n\nconst PHOTOS_TO_PRELOAD = 4;\n\nexport default function usePhotosPreload(\n  profile: ApiUser | ApiChat | undefined,\n  photos: ApiPhoto[],\n  currentIndex: number,\n) {\n  useEffect(() => {\n    photos.slice(currentIndex, currentIndex + PHOTOS_TO_PRELOAD).forEach((photo) => {\n      const mediaData = mediaLoader.getFromMemory(`photo${photo.id}?size=c`);\n      if (!mediaData) {\n        mediaLoader.fetch(`photo${photo.id}?size=c`, ApiMediaFormat.BlobUrl);\n      }\n    });\n  }, [currentIndex, photos]);\n}\n","import { MouseEvent as ReactMouseEvent } from 'react';\nimport React, {\n  FC, memo, useEffect, useRef,\n} from '../../lib/teact/teact';\n\nimport { ApiMediaFormat, ApiSticker } from '../../api/types';\n\nimport { useIsIntersecting, ObserveFn } from '../../hooks/useIntersectionObserver';\nimport useMedia from '../../hooks/useMedia';\nimport useTransitionForMedia from '../../hooks/useTransitionForMedia';\nimport useFlag from '../../hooks/useFlag';\nimport buildClassName from '../../util/buildClassName';\nimport { preventMessageInputBlurWithBubbling } from '../middle/helpers/preventMessageInputBlur';\n\nimport AnimatedSticker from './AnimatedSticker';\nimport Button from '../ui/Button';\n\nimport './StickerButton.scss';\n\ntype OwnProps = {\n  sticker: ApiSticker;\n  size: number;\n  observeIntersection: ObserveFn;\n  noAnimate?: boolean;\n  title?: string;\n  className?: string;\n  onClick?: (arg: any) => void;\n  clickArg?: any;\n  onUnfaveClick?: (sticker: ApiSticker) => void;\n};\n\nconst StickerButton: FC<OwnProps> = ({\n  sticker, size, observeIntersection, noAnimate, title, className, onClick, clickArg, onUnfaveClick,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n\n  const localMediaHash = `sticker${sticker.id}`;\n  const stickerSelector = `sticker-button-${sticker.id}`;\n\n  const isIntersecting = useIsIntersecting(ref, observeIntersection);\n\n  const thumbDataUri = sticker.thumbnail ? sticker.thumbnail.dataUri : undefined;\n  const previewBlobUrl = useMedia(`${localMediaHash}?size=m`, !isIntersecting, ApiMediaFormat.BlobUrl);\n\n  const shouldPlay = isIntersecting && !noAnimate;\n  const lottieData = useMedia(sticker.isAnimated && localMediaHash, !shouldPlay, ApiMediaFormat.Lottie);\n  const [isAnimationLoaded, markLoaded, unmarkLoaded] = useFlag(Boolean(lottieData));\n  const canAnimatedPlay = isAnimationLoaded && shouldPlay;\n\n  const {\n    shouldRenderThumb,\n    shouldRenderFullMedia: shouldRenderPreview,\n    transitionClassNames: previewTransitionClassNames,\n  } = useTransitionForMedia(previewBlobUrl || canAnimatedPlay, 'slow');\n\n  // To avoid flickering\n  useEffect(() => {\n    if (!shouldPlay) {\n      unmarkLoaded();\n    }\n  }, [unmarkLoaded, shouldPlay]);\n\n  function handleClick() {\n    if (onClick) {\n      onClick(clickArg);\n    }\n  }\n\n  function handleUnfaveClick(e: ReactMouseEvent<HTMLButtonElement, MouseEvent>) {\n    e.stopPropagation();\n    e.preventDefault();\n\n    onUnfaveClick!(sticker);\n  }\n\n  const fullClassName = buildClassName(\n    'StickerButton',\n    sticker.isAnimated && 'animated',\n    stickerSelector,\n    className,\n  );\n\n  const style = shouldRenderThumb && thumbDataUri ? `background-image: url('${thumbDataUri}');` : '';\n\n  return (\n    <div\n      ref={ref}\n      className={fullClassName}\n      title={title || (sticker?.emoji)}\n      // @ts-ignore\n      style={style}\n      data-sticker-id={sticker.id}\n      onMouseDown={preventMessageInputBlurWithBubbling}\n      onClick={handleClick}\n    >\n      {shouldRenderPreview && !canAnimatedPlay && (\n        // eslint-disable-next-line jsx-a11y/alt-text\n        <img src={previewBlobUrl} className={previewTransitionClassNames} />\n      )}\n      {shouldPlay && lottieData && (\n        <AnimatedSticker\n          id={localMediaHash}\n          animationData={lottieData}\n          play\n          size={size}\n          isLowPriority\n          onLoad={markLoaded}\n        />\n      )}\n      {onUnfaveClick && (\n        <Button\n          className=\"sticker-unfave-button\"\n          color=\"dark\"\n          round\n          onClick={handleUnfaveClick}\n        >\n          <i className=\"icon-close\" />\n        </Button>\n      )}\n    </div>\n  );\n};\n\nexport default memo(StickerButton);\n","import React, { FC, memo } from '../../lib/teact/teact';\nimport { OwnProps } from './StickerSetModal';\nimport { Bundles } from '../../util/moduleLoader';\n\nimport useModuleLoader from '../../hooks/useModuleLoader';\n\nconst StickerSetModalAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const StickerSetModal = useModuleLoader(Bundles.Extra, 'StickerSetModal', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return StickerSetModal ? <StickerSetModal {...props} /> : undefined;\n};\n\nexport default memo(StickerSetModalAsync);\n","import React, { FC, memo } from '../../lib/teact/teact';\nimport { withGlobal } from '../../lib/teact/teactn';\n\nimport { ApiUser, ApiTypingStatus } from '../../api/types';\n\nimport { selectUser } from '../../modules/selectors';\nimport { getUserFirstOrLastName } from '../../modules/helpers';\nimport renderText from './helpers/renderText';\nimport useLang from '../../hooks/useLang';\n\nimport './TypingStatus.scss';\n\ntype OwnProps = {\n  typingStatus: ApiTypingStatus;\n};\n\ntype StateProps = {\n  typingUser?: ApiUser;\n};\n\nconst TypingStatus: FC<OwnProps & StateProps> = ({ typingStatus, typingUser }) => {\n  const lang = useLang();\n  const typingUserName = typingUser && !typingUser.isSelf && getUserFirstOrLastName(typingUser);\n\n  return (\n    <p className=\"typing-status\" dir={lang.isRtl ? 'rtl' : 'auto'}>\n      {typingUserName && (\n        <span className=\"sender-name\" dir=\"auto\">{renderText(typingUserName)}</span>\n      )}\n      {/* fix for translation \"username _is_ typing\" */}\n      {lang(typingStatus.action).replace('{user}', '').trim()}\n      <span className=\"ellipsis\" />\n    </p>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { typingStatus }): StateProps => {\n    if (!typingStatus.userId) {\n      return {};\n    }\n\n    const typingUser = selectUser(global, typingStatus.userId);\n\n    return { typingUser };\n  },\n)(TypingStatus));\n","import React, { FC } from '../../lib/teact/teact';\n\nimport './VerifiedIcon.scss';\n\nconst VerifiedIcon: FC = () => {\n  return (\n    <span className=\"VerifiedIcon\" />\n  );\n};\n\nexport default VerifiedIcon;\n","import React, { FC, memo, useCallback } from '../../lib/teact/teact';\n\nimport { ApiMessage, ApiWebPage } from '../../api/types';\n\nimport { getFirstLinkInMessage, getMessageSummaryText, getMessageWebPage } from '../../modules/helpers';\nimport buildClassName from '../../util/buildClassName';\nimport trimText from '../../util/trimText';\nimport renderText from './helpers/renderText';\nimport { formatPastTimeShort } from '../../util/dateFormat';\nimport useLang from '../../hooks/useLang';\n\nimport Media from './Media';\nimport Link from '../ui/Link';\nimport SafeLink from './SafeLink';\n\nimport './WebLink.scss';\n\nconst MAX_TEXT_LENGTH = 170; // symbols\n\ntype OwnProps = {\n  message: ApiMessage;\n  senderTitle?: string;\n  onMessageClick: (messageId: number, chatId: number) => void;\n};\n\nconst WebLink: FC<OwnProps> = ({ message, senderTitle, onMessageClick }) => {\n  const lang = useLang();\n\n  let linkData: ApiWebPage | undefined = getMessageWebPage(message);\n\n  if (!linkData) {\n    const link = getFirstLinkInMessage(message);\n    if (link) {\n      const { url, domain } = link;\n      const messageText = getMessageSummaryText(lang, message);\n\n      linkData = {\n        siteName: domain.replace(/^www./, ''),\n        url: url.includes('://') ? url : url.includes('@') ? `mailto:${url}` : `http://${url}`,\n        description: messageText !== url ? messageText : undefined,\n      } as ApiWebPage;\n    }\n  }\n\n  const handleMessageClick = useCallback(() => {\n    onMessageClick(message.id, message.chatId);\n  }, [onMessageClick, message.id, message.chatId]);\n\n  if (!linkData) {\n    return undefined;\n  }\n\n  const {\n    siteName,\n    url,\n    displayUrl,\n    title,\n    description,\n    photo,\n    video,\n  } = linkData;\n\n  const truncatedDescription = !senderTitle && trimText(description, MAX_TEXT_LENGTH);\n\n  const className = buildClassName(\n    'WebLink scroll-item',\n    (!photo && !video) && 'without-media',\n  );\n\n  return (\n    <div\n      className={className}\n      data-initial={(siteName || displayUrl)[0]}\n      dir={lang.isRtl ? 'rtl' : undefined}\n    >\n      {photo && (\n        <Media message={message} />\n      )}\n      <div className=\"content\">\n        <Link isRtl={lang.isRtl} className=\"site-title\" onClick={handleMessageClick}>\n          {renderText(title || siteName || displayUrl)}\n        </Link>\n        {truncatedDescription && (\n          <Link isRtl={lang.isRtl} className=\"site-description\" onClick={handleMessageClick}>\n            {renderText(truncatedDescription)}\n          </Link>\n        )}\n        <SafeLink\n          url={url}\n          className=\"site-name\"\n          text=\"\"\n          isRtl={lang.isRtl}\n        >\n          {url.replace('mailto:', '') || displayUrl}\n        </SafeLink>\n        {senderTitle && <div className=\"sender-name\">{renderText(senderTitle)}</div>}\n      </div>\n      {senderTitle && (\n        <div className=\"message-date\">\n          <Link\n            className=\"date\"\n            onClick={handleMessageClick}\n            isRtl={lang.isRtl}\n          >\n            {formatPastTimeShort(lang, message.date * 1000)}\n          </Link>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default memo(WebLink);\n","import {\n  ApiPhoto, ApiVideo, ApiSticker, ApiDimensions,\n} from '../../../api/types';\n\nimport { STICKER_SIZE_INLINE_DESKTOP_FACTOR, STICKER_SIZE_INLINE_MOBILE_FACTOR } from '../../../config';\nimport { IS_SINGLE_COLUMN_LAYOUT } from '../../../util/environment';\nimport windowSize from '../../../util/windowSize';\nimport { getPhotoInlineDimensions, getVideoDimensions } from '../../../modules/helpers';\n\nexport const MEDIA_VIEWER_MEDIA_QUERY = '(max-height: 640px)';\nexport const REM = parseInt(getComputedStyle(document.documentElement).fontSize, 10);\nexport const ROUND_VIDEO_DIMENSIONS = 200;\nexport const AVATAR_FULL_DIMENSIONS = { width: 640, height: 640 };\nexport const LIKE_STICKER_ID = '1258816259753933';\n\nconst DEFAULT_MEDIA_DIMENSIONS: ApiDimensions = { width: 100, height: 100 };\nconst MOBILE_SCREEN_NO_AVATARS_MESSAGE_EXTRA_WIDTH_REM = 4.5;\nconst MOBILE_SCREEN_MESSAGE_EXTRA_WIDTH_REM = 7;\nconst MESSAGE_MAX_WIDTH_REM = 29;\nconst MESSAGE_OWN_MAX_WIDTH_REM = 30;\n\nlet cachedMaxWidthOwn: number | undefined;\nlet cachedMaxWidth: number | undefined;\nlet cachedMaxWidthNoAvatar: number | undefined;\n\nfunction getMaxMessageWidthRem(fromOwnMessage: boolean, noAvatars?: boolean) {\n  const regularMaxWidth = fromOwnMessage ? MESSAGE_OWN_MAX_WIDTH_REM : MESSAGE_MAX_WIDTH_REM;\n  if (!IS_SINGLE_COLUMN_LAYOUT) {\n    return regularMaxWidth;\n  }\n\n  const { width: windowWidth } = windowSize.get();\n\n  // @optimization Limitation: changing device screen width not supported\n  if (!cachedMaxWidthOwn) {\n    cachedMaxWidthOwn = Math.min(\n      MESSAGE_OWN_MAX_WIDTH_REM,\n      windowWidth / REM - MOBILE_SCREEN_NO_AVATARS_MESSAGE_EXTRA_WIDTH_REM,\n    );\n  }\n  if (!cachedMaxWidth) {\n    cachedMaxWidth = Math.min(\n      MESSAGE_MAX_WIDTH_REM,\n      windowWidth / REM - MOBILE_SCREEN_MESSAGE_EXTRA_WIDTH_REM,\n    );\n  }\n  if (!cachedMaxWidthNoAvatar) {\n    cachedMaxWidthNoAvatar = Math.min(\n      MESSAGE_MAX_WIDTH_REM,\n      windowWidth / REM - MOBILE_SCREEN_NO_AVATARS_MESSAGE_EXTRA_WIDTH_REM,\n    );\n  }\n\n  return fromOwnMessage\n    ? cachedMaxWidthOwn\n    : (noAvatars ? cachedMaxWidthNoAvatar : cachedMaxWidth);\n}\n\nexport function getAvailableWidth(\n  fromOwnMessage: boolean,\n  isForwarded?: boolean,\n  isWebPagePhoto?: boolean,\n  noAvatars?: boolean,\n) {\n  const extraPaddingRem = isForwarded || isWebPagePhoto ? 1.625 : 0;\n  const availableWidthRem = getMaxMessageWidthRem(fromOwnMessage, noAvatars) - extraPaddingRem;\n\n  return availableWidthRem * REM;\n}\n\nfunction getAvailableHeight(isGif?: boolean, aspectRatio?: number) {\n  if (\n    isGif && aspectRatio\n    && aspectRatio >= 0.75 && aspectRatio <= 1.25\n  ) {\n    return 20 * REM;\n  }\n\n  return 27 * REM;\n}\n\nfunction calculateDimensionsForMessageMedia({\n  width,\n  height,\n  fromOwnMessage,\n  isForwarded,\n  isWebPagePhoto,\n  isGif,\n  noAvatars,\n}: {\n  width: number;\n  height: number;\n  fromOwnMessage: boolean;\n  isForwarded?: boolean;\n  isWebPagePhoto?: boolean;\n  isGif?: boolean;\n  noAvatars?: boolean;\n}): ApiDimensions {\n  const aspectRatio = height / width;\n  const availableWidth = getAvailableWidth(fromOwnMessage, isForwarded, isWebPagePhoto, noAvatars);\n  const availableHeight = getAvailableHeight(isGif, aspectRatio);\n\n  return calculateDimensions(availableWidth, availableHeight, width, height);\n}\n\nexport function getMediaViewerAvailableDimensions(withFooter: boolean, isVideo: boolean): ApiDimensions {\n  const mql = window.matchMedia(MEDIA_VIEWER_MEDIA_QUERY);\n  const { width: windowWidth, height: windowHeight } = windowSize.get();\n  let occupiedHeightRem = isVideo && mql.matches ? 10 : 8.25;\n  if (withFooter) {\n    occupiedHeightRem = mql.matches ? 10 : 15;\n  }\n\n  return {\n    width: windowWidth,\n    height: windowHeight - occupiedHeightRem * REM,\n  };\n}\n\nexport function calculateInlineImageDimensions(\n  photo: ApiPhoto,\n  fromOwnMessage: boolean,\n  isForwarded?: boolean,\n  isWebPagePhoto?: boolean,\n  noAvatars?: boolean,\n) {\n  const { width, height } = getPhotoInlineDimensions(photo) || DEFAULT_MEDIA_DIMENSIONS;\n\n  return calculateDimensionsForMessageMedia({\n    width,\n    height,\n    fromOwnMessage,\n    isForwarded,\n    isWebPagePhoto,\n    noAvatars,\n  });\n}\n\nexport function calculateVideoDimensions(\n  video: ApiVideo,\n  fromOwnMessage: boolean,\n  isForwarded?: boolean,\n  noAvatars?: boolean,\n) {\n  const { width, height } = getVideoDimensions(video) || DEFAULT_MEDIA_DIMENSIONS;\n\n  return calculateDimensionsForMessageMedia({\n    width,\n    height,\n    fromOwnMessage,\n    isForwarded,\n    isGif: video.isGif,\n    noAvatars,\n  });\n}\n\nexport function getPictogramDimensions(): ApiDimensions {\n  return {\n    width: 2 * REM,\n    height: 2 * REM,\n  };\n}\n\nexport function getDocumentThumbnailDimensions(smaller?: boolean): ApiDimensions {\n  if (smaller) {\n    return {\n      width: 3 * REM,\n      height: 3 * REM,\n    };\n  }\n\n  return {\n    width: 3.375 * REM,\n    height: 3.375 * REM,\n  };\n}\n\nexport function getStickerDimensions(sticker: ApiSticker): ApiDimensions {\n  const { width } = sticker;\n  let { height } = sticker;\n\n  // For some reason this sticker has some weird `height` value\n  if (sticker.id === LIKE_STICKER_ID) {\n    height = width;\n  }\n\n  const aspectRatio = (height && width) && height / width;\n  const baseWidth = REM * (\n    IS_SINGLE_COLUMN_LAYOUT\n      ? STICKER_SIZE_INLINE_MOBILE_FACTOR\n      : STICKER_SIZE_INLINE_DESKTOP_FACTOR\n  );\n  const calculatedHeight = aspectRatio ? baseWidth * aspectRatio : baseWidth;\n\n  if (aspectRatio && calculatedHeight > baseWidth) {\n    return {\n      width: Math.round(baseWidth / aspectRatio),\n      height: baseWidth,\n    };\n  }\n\n  return {\n    width: baseWidth,\n    height: calculatedHeight,\n  };\n}\n\nexport function calculateMediaViewerDimensions(\n  { width, height }: ApiDimensions, withFooter: boolean, isVideo: boolean = false,\n): ApiDimensions {\n  const { width: availableWidth, height: availableHeight } = getMediaViewerAvailableDimensions(withFooter, isVideo);\n\n  return calculateDimensions(availableWidth, availableHeight, width, height);\n}\n\nexport function calculateDimensions(\n  availableWidth: number,\n  availableHeight: number,\n  mediaWidth: number,\n  mediaHeight: number,\n): ApiDimensions {\n  const aspectRatio = mediaHeight / mediaWidth;\n  const calculatedWidth = Math.min(mediaWidth, availableWidth);\n  const calculatedHeight = Math.round(calculatedWidth * aspectRatio);\n\n  if (calculatedHeight > availableHeight) {\n    return {\n      width: Math.round(availableHeight / aspectRatio),\n      height: availableHeight,\n    };\n  }\n\n  return {\n    width: calculatedWidth,\n    height: Math.round(calculatedWidth * aspectRatio),\n  };\n}\n","import { MouseEvent } from 'react';\nimport React from '../../../lib/teact/teact';\nimport { getDispatch } from '../../../lib/teact/teactn';\n\nimport { ApiMessageEntity, ApiMessageEntityTypes, ApiMessage } from '../../../api/types';\n\nimport { getMessageText } from '../../../modules/helpers';\nimport renderText from './renderText';\n\nimport MentionLink from '../../middle/message/MentionLink';\nimport SafeLink from '../SafeLink';\n\nexport type TextPart = string | Element;\n\nexport function renderMessageText(message: ApiMessage, highlight?: string, shouldRenderHqEmoji?: boolean) {\n  const formattedText = message.content.text;\n\n  if (!formattedText || !formattedText.text) {\n    const rawText = getMessageText(message);\n    return rawText ? [rawText] : undefined;\n  }\n  const { text, entities } = formattedText;\n\n  return renderTextWithEntities(text, entities, highlight, shouldRenderHqEmoji);\n}\n\ninterface IOrganizedEntity {\n  entity: ApiMessageEntity;\n  organizedIndexes: Set<number>;\n  nestedEntities: IOrganizedEntity[];\n}\n\nfunction organizeEntity(\n  entity: ApiMessageEntity,\n  index: number,\n  entities: ApiMessageEntity[],\n  organizedEntityIndexes: Set<number>,\n): IOrganizedEntity | undefined {\n  const { offset, length } = entity;\n  const organizedIndexes = new Set([index]);\n\n  if (organizedEntityIndexes.has(index)) {\n    return undefined;\n  }\n\n  // Determine any nested entities inside current entity\n  const nestedEntities: IOrganizedEntity[] = [];\n  const parsedNestedEntities = entities\n    .filter((e, i) => i > index && e.offset >= offset && e.offset < offset + length)\n    .map((e) => organizeEntity(e, entities.indexOf(e), entities, organizedEntityIndexes))\n    .filter<IOrganizedEntity>(Boolean as any);\n\n  parsedNestedEntities.forEach((parsedEntity) => {\n    let isChanged = false;\n\n    parsedEntity.organizedIndexes.forEach((organizedIndex) => {\n      if (!isChanged && !organizedIndexes.has(organizedIndex)) {\n        isChanged = true;\n      }\n\n      organizedIndexes.add(organizedIndex);\n    });\n\n    if (isChanged) {\n      nestedEntities.push(parsedEntity);\n    }\n  });\n\n  return {\n    entity,\n    organizedIndexes,\n    nestedEntities,\n  };\n}\n\n// Organize entities in a tree-like structure to better represent how the text will be displayed\nfunction organizeEntities(entities: ApiMessageEntity[]) {\n  const organizedEntityIndexes: Set<number> = new Set();\n  const organizedEntities: IOrganizedEntity[] = [];\n\n  entities.forEach((entity, index) => {\n    if (organizedEntityIndexes.has(index)) {\n      return;\n    }\n\n    const organizedEntity = organizeEntity(entity, index, entities, organizedEntityIndexes);\n    if (organizedEntity) {\n      organizedEntity.organizedIndexes.forEach((organizedIndex) => {\n        organizedEntityIndexes.add(organizedIndex);\n      });\n\n      organizedEntities.push(organizedEntity);\n    }\n  });\n\n  return organizedEntities;\n}\n\nexport function renderTextWithEntities(\n  text: string,\n  entities?: ApiMessageEntity[],\n  highlight?: string,\n  shouldRenderHqEmoji?: boolean,\n  shouldRenderAsHtml?: boolean,\n) {\n  if (!entities || !entities.length) {\n    return renderMessagePart(text, highlight, shouldRenderHqEmoji, shouldRenderAsHtml);\n  }\n\n  const result: TextPart[] = [];\n  let deleteLineBreakAfterPre = false;\n\n  const organizedEntities = organizeEntities(entities);\n\n  // Recursive function to render regular and nested entities\n  function renderEntity(\n    textPartStart: number,\n    textPartEnd: number,\n    organizedEntity: IOrganizedEntity,\n    isLastEntity: boolean,\n  ) {\n    const renderResult: TextPart[] = [];\n    const { entity, nestedEntities } = organizedEntity;\n    const { offset, length, type } = entity;\n\n    // Render text before the entity\n    let textBefore = text.substring(textPartStart, offset);\n    const textBeforeLength = textBefore.length;\n    if (textBefore) {\n      if (deleteLineBreakAfterPre && textBefore.length > 0 && textBefore[0] === '\\n') {\n        textBefore = textBefore.substr(1);\n        deleteLineBreakAfterPre = false;\n      }\n      if (textBefore) {\n        renderResult.push(...renderMessagePart(\n          textBefore, highlight, shouldRenderHqEmoji, shouldRenderAsHtml,\n        ) as TextPart[]);\n      }\n    }\n\n    const entityStartIndex = textPartStart + textBeforeLength;\n    const entityEndIndex = entityStartIndex + length;\n\n    let entityContent: TextPart = text.substring(offset, offset + length);\n    const nestedEntityContent: TextPart[] = [];\n\n    if (deleteLineBreakAfterPre && entityContent.length > 0 && entityContent[0] === '\\n') {\n      entityContent = entityContent.substr(1);\n      deleteLineBreakAfterPre = false;\n    }\n\n    if (type === ApiMessageEntityTypes.Pre) {\n      deleteLineBreakAfterPre = true;\n    }\n\n    // Render nested entities, if any\n    if (nestedEntities.length) {\n      let nestedIndex = entityStartIndex;\n\n      nestedEntities.forEach((nestedEntity, nestedEntityIndex) => {\n        const {\n          renderResult: nestedResult,\n          entityEndIndex: nestedEntityEndIndex,\n        } = renderEntity(\n          nestedIndex,\n          entityEndIndex,\n          nestedEntity,\n          nestedEntityIndex === nestedEntities.length - 1,\n        );\n\n        nestedEntityContent.push(...nestedResult);\n        nestedIndex = nestedEntityEndIndex;\n      });\n    }\n\n    // Render the entity itself\n    const newEntity = shouldRenderAsHtml\n      ? processEntityAsHtml(entity, entityContent, nestedEntityContent)\n      : processEntity(entity, entityContent, nestedEntityContent);\n\n    if (Array.isArray(newEntity)) {\n      renderResult.push(...newEntity);\n    } else {\n      renderResult.push(newEntity);\n    }\n\n    // Render text after the entity, if it is the last entity in the text,\n    // or the last nested entity inside of another entity\n    if (isLastEntity && entityEndIndex < textPartEnd) {\n      let textAfter = text.substring(entityEndIndex, textPartEnd);\n      if (deleteLineBreakAfterPre && textAfter.length > 0 && textAfter[0] === '\\n') {\n        textAfter = textAfter.substring(1);\n      }\n      if (textAfter) {\n        renderResult.push(...renderMessagePart(\n          textAfter, highlight, shouldRenderHqEmoji, shouldRenderAsHtml,\n        ) as TextPart[]);\n      }\n    }\n\n    return {\n      renderResult,\n      entityEndIndex,\n    };\n  }\n\n  // Process highest-level entities\n  let index = 0;\n\n  organizedEntities.forEach((entity, arrayIndex) => {\n    const { renderResult, entityEndIndex } = renderEntity(\n      index,\n      text.length,\n      entity,\n      arrayIndex === organizedEntities.length - 1,\n    );\n\n    result.push(...renderResult);\n    index = entityEndIndex;\n  });\n\n  return result;\n}\n\nfunction processEntity(\n  entity: ApiMessageEntity,\n  entityContent: TextPart,\n  nestedEntityContent: TextPart[],\n) {\n  const entityText = typeof entityContent === 'string' && entityContent;\n  const renderedContent = nestedEntityContent.length ? nestedEntityContent : entityContent;\n\n  if (!entityText) {\n    return renderMessagePart(renderedContent);\n  }\n\n  switch (entity.type) {\n    case ApiMessageEntityTypes.Bold:\n      return <strong>{renderMessagePart(renderedContent)}</strong>;\n    case ApiMessageEntityTypes.Blockquote:\n      return <blockquote>{renderMessagePart(renderedContent)}</blockquote>;\n    case ApiMessageEntityTypes.BotCommand:\n      return (\n        <a\n          onClick={handleBotCommandClick}\n          className=\"text-entity-link\"\n          dir=\"auto\"\n        >\n          {renderMessagePart(renderedContent)}\n        </a>\n      );\n    case ApiMessageEntityTypes.Hashtag:\n      return (\n        <a\n          onClick={handleHashtagClick}\n          className=\"text-entity-link\"\n          dir=\"auto\"\n        >\n          {renderMessagePart(renderedContent)}\n        </a>\n      );\n    case ApiMessageEntityTypes.Cashtag:\n      return (\n        <a\n          onClick={handleHashtagClick}\n          className=\"text-entity-link\"\n          dir=\"auto\"\n        >\n          {renderMessagePart(renderedContent)}\n        </a>\n      );\n    case ApiMessageEntityTypes.Code:\n      return <code className=\"text-entity-code\">{renderMessagePart(renderedContent)}</code>;\n    case ApiMessageEntityTypes.Email:\n      return (\n        <a\n          href={`mailto:${entityText}`}\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          className=\"text-entity-link\"\n          dir=\"auto\"\n        >\n          {renderMessagePart(renderedContent)}\n        </a>\n      );\n    case ApiMessageEntityTypes.Italic:\n      return <em>{renderMessagePart(renderedContent)}</em>;\n    case ApiMessageEntityTypes.MentionName:\n      return (\n        <MentionLink userId={entity.userId}>\n          {renderMessagePart(renderedContent)}\n        </MentionLink>\n      );\n    case ApiMessageEntityTypes.Mention:\n      return (\n        <MentionLink username={entityText}>\n          {renderMessagePart(renderedContent)}\n        </MentionLink>\n      );\n    case ApiMessageEntityTypes.Phone:\n      return (\n        <a\n          href={`tel:${entityText}`}\n          className=\"text-entity-link\"\n          dir=\"auto\"\n        >\n          {renderMessagePart(renderedContent)}\n        </a>\n      );\n    case ApiMessageEntityTypes.Pre:\n      return <pre className=\"text-entity-pre\">{renderMessagePart(renderedContent)}</pre>;\n    case ApiMessageEntityTypes.Strike:\n      return <del>{renderMessagePart(renderedContent)}</del>;\n    case ApiMessageEntityTypes.TextUrl:\n    case ApiMessageEntityTypes.Url:\n      return (\n        <SafeLink\n          url={getLinkUrl(entityText, entity)}\n          text={entityText}\n        >\n          {renderMessagePart(renderedContent)}\n        </SafeLink>\n      );\n    case ApiMessageEntityTypes.Underline:\n      return <ins>{renderMessagePart(renderedContent)}</ins>;\n    default:\n      return renderMessagePart(renderedContent);\n  }\n}\n\nfunction renderMessagePart(\n  content: TextPart | TextPart[],\n  highlight?: string,\n  shouldRenderHqEmoji?: boolean,\n  shouldRenderAsHtml?: boolean,\n) {\n  if (Array.isArray(content)) {\n    const result: TextPart[] = [];\n\n    content.forEach((c) => {\n      result.push(...renderMessagePart(c, highlight, shouldRenderHqEmoji, shouldRenderAsHtml));\n    });\n\n    return result;\n  }\n\n  if (shouldRenderAsHtml) {\n    return renderText(content, ['escape_html', 'emoji_html', 'br_html']);\n  }\n\n  const emojiFilter = shouldRenderHqEmoji ? 'hq_emoji' : 'emoji';\n\n  if (highlight) {\n    return renderText(content, [emojiFilter, 'br', 'highlight'], { highlight });\n  } else {\n    return renderText(content, [emojiFilter, 'br']);\n  }\n}\n\nfunction getLinkUrl(entityContent: string, entity: ApiMessageEntity) {\n  const { type, url } = entity;\n  return type === ApiMessageEntityTypes.TextUrl && url ? url : entityContent;\n}\n\nfunction handleBotCommandClick(e: MouseEvent<HTMLAnchorElement>) {\n  getDispatch().sendBotCommand({ command: e.currentTarget.innerText });\n}\n\nfunction handleHashtagClick(e: MouseEvent<HTMLAnchorElement>) {\n  getDispatch().setLocalTextSearchQuery({ query: e.currentTarget.innerText });\n  getDispatch().searchTextMessagesLocal();\n}\n\nfunction processEntityAsHtml(\n  entity: ApiMessageEntity,\n  entityContent: TextPart,\n  nestedEntityContent: TextPart[],\n) {\n  const rawEntityText = typeof entityContent === 'string' && entityContent;\n\n  const renderedContent = nestedEntityContent.length\n    ? nestedEntityContent.join('')\n    : renderText(entityContent, ['escape_html', 'emoji_html', 'br_html']).join('');\n\n  if (!rawEntityText) {\n    return renderedContent;\n  }\n\n  switch (entity.type) {\n    case ApiMessageEntityTypes.Bold:\n      return `<b>${renderedContent}</b>`;\n    case ApiMessageEntityTypes.Italic:\n      return `<i>${renderedContent}</i>`;\n    case ApiMessageEntityTypes.Underline:\n      return `<u>${renderedContent}</u>`;\n    case ApiMessageEntityTypes.Code:\n      return `<code class=\"text-entity-code\">${renderedContent}</code>`;\n    case ApiMessageEntityTypes.Pre:\n      return `\\`\\`\\`<br/>${renderedContent}<br/>\\`\\`\\``;\n    case ApiMessageEntityTypes.Strike:\n      return `<del>${renderedContent}</del>`;\n    case ApiMessageEntityTypes.MentionName:\n      return `<a\n        class=\"text-entity-link\"\n        data-entity-type=\"${ApiMessageEntityTypes.MentionName}\"\n        data-user-id=\"${entity.userId}\"\n        contenteditable=\"false\"\n        dir=\"auto\"\n      >${renderedContent}</a>`;\n    case ApiMessageEntityTypes.Url:\n    case ApiMessageEntityTypes.TextUrl:\n      return `<a\n        class=\"text-entity-link\"\n        href=${getLinkUrl(rawEntityText, entity)}\n        data-entity-type=\"${entity.type}\"\n        dir=\"auto\"\n      >${renderedContent}</a>`;\n    default:\n      return renderedContent;\n  }\n}\n","import { useCallback } from '../../../../lib/teact/teact';\n\nexport enum ChatAnimationTypes {\n  Move,\n  Opacity,\n  None,\n}\n\nexport function useChatAnimationType(orderDiffById: Record<number, number>) {\n  const movesUp = useCallback((id: number) => orderDiffById[id] < 0, [orderDiffById]);\n  const movesDown = useCallback((id: number) => orderDiffById[id] > 0, [orderDiffById]);\n\n  const orderDiffIds = Object.keys(orderDiffById).map(Number);\n  const numberOfUp = orderDiffIds.filter(movesUp).length;\n  const numberOfDown = orderDiffIds.filter(movesDown).length;\n\n  return useCallback((chatId: number): ChatAnimationTypes => {\n    const orderDiff = orderDiffById[chatId];\n\n    if (orderDiff === 0) {\n      return ChatAnimationTypes.None;\n    }\n\n    if (\n      orderDiff === Infinity\n      || orderDiff === -Infinity\n      || (movesUp(chatId) && numberOfUp <= numberOfDown)\n      || (movesDown(chatId) && numberOfDown < numberOfUp)\n    ) {\n      return ChatAnimationTypes.Opacity;\n    }\n\n    return ChatAnimationTypes.Move;\n  }, [movesDown, movesUp, numberOfDown, numberOfUp, orderDiffById]);\n}\n","import React, { FC, memo } from '../../../lib/teact/teact';\n\nimport { ApiChat } from '../../../api/types';\n\nimport { formatIntegerCompact } from '../../../util/textFormat';\nimport buildClassName from '../../../util/buildClassName';\n\nimport ShowTransition from '../../ui/ShowTransition';\n\nimport './Badge.scss';\n\ntype OwnProps = {\n  chat: ApiChat;\n  isPinned?: boolean;\n  isMuted?: boolean;\n};\n\nconst Badge: FC<OwnProps> = ({ chat, isPinned, isMuted }) => {\n  const isShown = Boolean(chat.unreadCount || chat.hasUnreadMark || isPinned);\n  const className = buildClassName(\n    'Badge',\n    isMuted && 'muted',\n    isPinned && 'pinned',\n    Boolean(chat.unreadCount || chat.hasUnreadMark) && 'unread',\n  );\n\n  function renderContent() {\n    if (chat.unreadCount) {\n      if (chat.unreadMentionsCount) {\n        return (\n          <div className=\"Badge-wrapper\">\n            <div className=\"Badge mention\">\n              <i className=\"icon-mention\" />\n            </div>\n            <div className={className}>\n              {formatIntegerCompact(chat.unreadCount)}\n            </div>\n          </div>\n        );\n      }\n\n      return (\n        <div className={className}>\n          {formatIntegerCompact(chat.unreadCount)}\n        </div>\n      );\n    } else if (chat.hasUnreadMark) {\n      return (\n        <div className={className} />\n      );\n    } else if (isPinned) {\n      return (\n        <div className={className}>\n          <i className=\"icon-pinned-chat\" />\n        </div>\n      );\n    }\n\n    return undefined;\n  }\n\n  return (\n    <ShowTransition isCustom className=\"Badge-transition\" isOpen={isShown}>\n      {renderContent}\n    </ShowTransition>\n  );\n};\n\nexport default memo(Badge);\n","import React, {\n  FC, memo, useCallback, useLayoutEffect, useMemo, useRef,\n} from '../../../lib/teact/teact';\nimport { withGlobal } from '../../../lib/teact/teactn';\n\nimport useLang, { LangFn } from '../../../hooks/useLang';\n\nimport { GlobalActions } from '../../../global/types';\nimport {\n  ApiChat, ApiUser, ApiMessage, ApiMessageOutgoingStatus, ApiFormattedText, MAIN_THREAD_ID,\n} from '../../../api/types';\n\nimport { ANIMATION_END_DELAY } from '../../../config';\nimport { IS_SINGLE_COLUMN_LAYOUT } from '../../../util/environment';\nimport {\n  getChatTitle,\n  isChatPrivate,\n  isActionMessage,\n  getPrivateChatUserId,\n  getMessageAction,\n  getMessageSenderName,\n  isChatChannel,\n  getMessageMediaHash,\n  getMessageSummaryText,\n  getMessageMediaThumbDataUri,\n  getMessageVideo,\n  getMessageSticker,\n  selectIsChatMuted,\n  getMessageRoundVideo,\n} from '../../../modules/helpers';\nimport {\n  selectChat, selectUser, selectChatMessage, selectOutgoingStatus, selectDraft, selectCurrentMessageList,\n  selectNotifySettings, selectNotifyExceptions,\n} from '../../../modules/selectors';\nimport { renderActionMessageText } from '../../common/helpers/renderActionMessageText';\nimport renderText from '../../common/helpers/renderText';\nimport { fastRaf } from '../../../util/schedulers';\nimport buildClassName from '../../../util/buildClassName';\nimport { pick } from '../../../util/iteratees';\nimport useEnsureMessage from '../../../hooks/useEnsureMessage';\nimport useChatContextActions from '../../../hooks/useChatContextActions';\nimport useFlag from '../../../hooks/useFlag';\nimport useMedia from '../../../hooks/useMedia';\nimport { ChatAnimationTypes } from './hooks';\n\nimport Avatar from '../../common/Avatar';\nimport VerifiedIcon from '../../common/VerifiedIcon';\nimport TypingStatus from '../../common/TypingStatus';\nimport LastMessageMeta from '../../common/LastMessageMeta';\nimport DeleteChatModal from '../../common/DeleteChatModal';\nimport ListItem from '../../ui/ListItem';\nimport Badge from './Badge';\n\nimport './Chat.scss';\n\ntype OwnProps = {\n  style?: string;\n  chatId: number;\n  folderId?: number;\n  orderDiff: number;\n  animationType: ChatAnimationTypes;\n  isPinned?: boolean;\n};\n\ntype StateProps = {\n  chat?: ApiChat;\n  isMuted?: boolean;\n  privateChatUser?: ApiUser;\n  actionTargetUserIds?: number[];\n  usersById?: Record<number, ApiUser>;\n  actionTargetMessage?: ApiMessage;\n  actionTargetChatId?: number;\n  lastMessageSender?: ApiUser;\n  lastMessageOutgoingStatus?: ApiMessageOutgoingStatus;\n  draft?: ApiFormattedText;\n  animationLevel?: number;\n  isSelected?: boolean;\n  canScrollDown?: boolean;\n  lastSyncTime?: number;\n};\n\ntype DispatchProps = Pick<GlobalActions, 'openChat' | 'focusLastMessage'>;\n\nconst ANIMATION_DURATION = 200;\n\nconst Chat: FC<OwnProps & StateProps & DispatchProps> = ({\n  style,\n  chatId,\n  folderId,\n  orderDiff,\n  animationType,\n  isPinned,\n  chat,\n  isMuted,\n  privateChatUser,\n  actionTargetUserIds,\n  usersById,\n  lastMessageSender,\n  lastMessageOutgoingStatus,\n  actionTargetMessage,\n  actionTargetChatId,\n  draft,\n  animationLevel,\n  isSelected,\n  canScrollDown,\n  lastSyncTime,\n  openChat,\n  focusLastMessage,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n\n  const [isDeleteModalOpen, openDeleteModal, closeDeleteModal] = useFlag();\n  const [shouldRenderDeleteModal, markRenderDeleteModal, unmarkRenderDeleteModal] = useFlag();\n\n  const { lastMessage, typingStatus } = chat || {};\n  const isAction = lastMessage && isActionMessage(lastMessage);\n\n  useEnsureMessage(chatId, isAction ? lastMessage!.replyToMessageId : undefined, actionTargetMessage);\n\n  const mediaThumbnail = lastMessage && !getMessageSticker(lastMessage)\n    ? getMessageMediaThumbDataUri(lastMessage)\n    : undefined;\n  const mediaBlobUrl = useMedia(lastMessage ? getMessageMediaHash(lastMessage, 'micro') : undefined);\n  const isRoundVideo = Boolean(lastMessage && getMessageRoundVideo(lastMessage));\n\n  const actionTargetUsers = useMemo(() => {\n    return actionTargetUserIds\n      ? actionTargetUserIds.map((userId) => usersById?.[userId]).filter<ApiUser>(Boolean as any)\n      : undefined;\n  }, [actionTargetUserIds, usersById]);\n\n  // Sets animation excess values when `orderDiff` changes and then resets excess values to animate.\n  useLayoutEffect(() => {\n    const element = ref.current;\n\n    if (animationLevel === 0 || !element) {\n      return;\n    }\n\n    // TODO Refactor animation: create `useListAnimation` that owns `orderDiff` and `animationType`\n    if (animationType === ChatAnimationTypes.Opacity) {\n      element.style.opacity = '0';\n\n      fastRaf(() => {\n        element.classList.add('animate-opacity');\n        element.style.opacity = '1';\n      });\n    } else if (animationType === ChatAnimationTypes.Move) {\n      element.style.transform = `translate3d(0, ${-orderDiff * 100}%, 0)`;\n\n      fastRaf(() => {\n        element.classList.add('animate-transform');\n        element.style.transform = '';\n      });\n    } else {\n      return;\n    }\n\n    setTimeout(() => {\n      fastRaf(() => {\n        element.classList.remove('animate-opacity', 'animate-transform');\n        element.style.opacity = '';\n        element.style.transform = '';\n      });\n    }, ANIMATION_DURATION + ANIMATION_END_DELAY);\n  }, [animationLevel, orderDiff, animationType]);\n\n  const handleClick = useCallback(() => {\n    openChat({ id: chatId, shouldReplaceHistory: true });\n\n    if (isSelected && canScrollDown) {\n      focusLastMessage();\n    }\n  }, [\n    isSelected,\n    canScrollDown,\n    openChat,\n    chatId,\n    focusLastMessage,\n  ]);\n\n  function handleDelete() {\n    markRenderDeleteModal();\n    openDeleteModal();\n  }\n\n  const contextActions = useChatContextActions({\n    chat,\n    privateChatUser,\n    handleDelete,\n    folderId,\n    isPinned,\n    isMuted,\n  });\n\n  const lang = useLang();\n\n  if (!chat) {\n    return undefined;\n  }\n\n  function renderLastMessageOrTyping() {\n    if (typingStatus && lastMessage && typingStatus.timestamp > lastMessage.date * 1000) {\n      return <TypingStatus typingStatus={typingStatus} />;\n    }\n\n    if (draft?.text.length) {\n      return (\n        <p className=\"last-message\" dir={lang.isRtl ? 'auto' : 'ltr'}>\n          <span className=\"draft\">{lang('Draft')}</span>\n          {renderText(draft.text)}\n        </p>\n      );\n    }\n\n    if (!lastMessage) {\n      return undefined;\n    }\n\n    if (isAction) {\n      const actionOrigin = chat && (isChatChannel(chat) || lastMessage.senderId === lastMessage.chatId)\n        ? chat\n        : lastMessageSender;\n\n      return (\n        <p className=\"last-message\" dir={lang.isRtl ? 'auto' : 'ltr'}>\n          {renderText(renderActionMessageText(\n            lang,\n            lastMessage,\n            actionOrigin,\n            actionTargetUsers,\n            actionTargetMessage,\n            actionTargetChatId,\n            { asPlain: true },\n          ) as string)}\n        </p>\n      );\n    }\n\n    const senderName = getMessageSenderName(lang, chatId, lastMessageSender);\n\n    return (\n      <p className=\"last-message\" dir={lang.isRtl ? 'auto' : 'ltr'}>\n        {senderName && (\n          <>\n            <span className=\"sender-name\">{renderText(senderName)}</span>\n            <span className=\"colon\">:</span>\n          </>\n        )}\n        {renderMessageSummary(lang, lastMessage!, mediaBlobUrl || mediaThumbnail, isRoundVideo)}\n      </p>\n    );\n  }\n\n  const className = buildClassName(\n    'Chat chat-item-clickable',\n    isChatPrivate(chatId) ? 'private' : 'group',\n    isSelected && 'selected',\n  );\n\n  return (\n    <ListItem\n      ref={ref}\n      className={className}\n      style={style}\n      ripple={!IS_SINGLE_COLUMN_LAYOUT}\n      contextActions={contextActions}\n      onClick={handleClick}\n    >\n      <div className=\"status\">\n        <Avatar\n          chat={chat}\n          user={privateChatUser}\n          withOnlineStatus\n          isSavedMessages={privateChatUser?.isSelf}\n          lastSyncTime={lastSyncTime}\n        />\n      </div>\n      <div className=\"info\">\n        <div className=\"title\">\n          <h3>{renderText(getChatTitle(lang, chat, privateChatUser))}</h3>\n          {chat.isVerified && <VerifiedIcon />}\n          {isMuted && <i className=\"icon-muted-chat\" />}\n          {chat.lastMessage && (\n            <LastMessageMeta message={chat.lastMessage} outgoingStatus={lastMessageOutgoingStatus} />\n          )}\n        </div>\n        <div className=\"subtitle\">\n          {renderLastMessageOrTyping()}\n          <Badge chat={chat} isPinned={isPinned} isMuted={isMuted} />\n        </div>\n      </div>\n      {shouldRenderDeleteModal && (\n        <DeleteChatModal\n          isOpen={isDeleteModalOpen}\n          onClose={closeDeleteModal}\n          onCloseAnimationEnd={unmarkRenderDeleteModal}\n          chat={chat}\n        />\n      )}\n    </ListItem>\n  );\n};\n\nfunction renderMessageSummary(lang: LangFn, message: ApiMessage, blobUrl?: string, isRoundVideo?: boolean) {\n  if (!blobUrl) {\n    return renderText(getMessageSummaryText(lang, message));\n  }\n\n  return (\n    <span className=\"media-preview\">\n      <img src={blobUrl} alt=\"\" className={isRoundVideo ? 'round' : undefined} />\n      {getMessageVideo(message) && <i className=\"icon-play\" />}\n      {renderText(getMessageSummaryText(lang, message, true))}\n    </span>\n  );\n}\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chatId }): StateProps => {\n    const chat = selectChat(global, chatId);\n    if (!chat || !chat.lastMessage) {\n      return {};\n    }\n\n    const { senderId, replyToMessageId, isOutgoing } = chat.lastMessage;\n    const lastMessageSender = senderId ? selectUser(global, senderId) : undefined;\n    const lastMessageAction = getMessageAction(chat.lastMessage);\n    const actionTargetMessage = lastMessageAction && replyToMessageId\n      ? selectChatMessage(global, chat.id, replyToMessageId)\n      : undefined;\n    const { targetUserIds: actionTargetUserIds, targetChatId: actionTargetChatId } = lastMessageAction || {};\n    const privateChatUserId = getPrivateChatUserId(chat);\n    const { byId: usersById } = global.users;\n    const {\n      chatId: currentChatId,\n      threadId: currentThreadId,\n      type: messageListType,\n    } = selectCurrentMessageList(global) || {};\n    const isSelected = chatId === currentChatId && currentThreadId === MAIN_THREAD_ID;\n\n    return {\n      chat,\n      isMuted: selectIsChatMuted(chat, selectNotifySettings(global), selectNotifyExceptions(global)),\n      lastMessageSender,\n      actionTargetUserIds,\n      actionTargetChatId,\n      actionTargetMessage,\n      draft: selectDraft(global, chatId, MAIN_THREAD_ID),\n      animationLevel: global.settings.byKey.animationLevel,\n      isSelected,\n      canScrollDown: isSelected && messageListType === 'thread',\n      lastSyncTime: global.lastSyncTime,\n      ...(isOutgoing && { lastMessageOutgoingStatus: selectOutgoingStatus(global, chat.lastMessage) }),\n      ...(privateChatUserId && { privateChatUser: selectUser(global, privateChatUserId) }),\n      ...(actionTargetUserIds && { usersById }),\n    };\n  },\n  (setGlobal, actions): DispatchProps => pick(actions, [\n    'openChat',\n    'focusLastMessage',\n  ]),\n)(Chat));\n","import React, { FC, memo, useCallback } from '../../../lib/teact/teact';\nimport { withGlobal } from '../../../lib/teact/teactn';\n\nimport { ApiChatFolder, ApiSticker } from '../../../api/types';\nimport { SettingsScreens } from '../../../types';\nimport { FolderEditDispatch } from '../../../hooks/reducers/useFoldersReducer';\n\nimport { IS_SINGLE_COLUMN_LAYOUT } from '../../../util/environment';\nimport { selectAnimatedEmoji, selectChatFolder } from '../../../modules/selectors';\nimport useLang from '../../../hooks/useLang';\n\nimport Button from '../../ui/Button';\nimport AnimatedEmoji from '../../common/AnimatedEmoji';\n\nimport './EmptyFolder.scss';\n\ntype OwnProps = {\n  folderId?: number;\n  folderType: 'all' | 'archived' | 'folder';\n  foldersDispatch?: FolderEditDispatch;\n  onScreenSelect?: (screen: SettingsScreens) => void;\n};\n\ntype StateProps = {\n  chatFolder?: ApiChatFolder;\n  animatedEmoji?: ApiSticker;\n};\n\nconst EmptyFolder: FC<OwnProps & StateProps> = ({\n  chatFolder, animatedEmoji, foldersDispatch, onScreenSelect,\n}) => {\n  const lang = useLang();\n\n  const handleEditFolder = useCallback(() => {\n    foldersDispatch!({ type: 'editFolder', payload: chatFolder });\n    onScreenSelect!(SettingsScreens.FoldersEditFolderFromChatList);\n  }, [chatFolder, foldersDispatch, onScreenSelect]);\n\n  return (\n    <div className=\"EmptyFolder\">\n      <div className=\"sticker\">{animatedEmoji && <AnimatedEmoji sticker={animatedEmoji} />}</div>\n      <h3 className=\"title\" dir=\"auto\">{lang('FilterNoChatsToDisplay')}</h3>\n      <p className=\"description\" dir=\"auto\">\n        {lang(chatFolder ? 'ChatList.EmptyChatListFilterText' : 'Chat.EmptyChat')}\n      </p>\n      {chatFolder && foldersDispatch && onScreenSelect && (\n        <Button\n          ripple={!IS_SINGLE_COLUMN_LAYOUT}\n          fluid\n          pill\n          onClick={handleEditFolder}\n          size=\"smaller\"\n          isRtl={lang.isRtl}\n        >\n          <i className=\"icon-settings\" />\n          {lang('ChatList.EmptyChatListEditFilter')}\n        </Button>\n      )}\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>((global, { folderId, folderType }): StateProps => {\n  const chatFolder = folderId && folderType === 'folder' ? selectChatFolder(global, folderId) : undefined;\n\n  return {\n    chatFolder,\n    animatedEmoji: selectAnimatedEmoji(global, ''),\n  };\n})(EmptyFolder));\n","import React, {\n  FC, memo, useMemo, useCallback, useEffect,\n} from '../../../lib/teact/teact';\nimport { withGlobal } from '../../../lib/teact/teactn';\n\nimport { GlobalActions } from '../../../global/types';\nimport {\n  ApiChat, ApiChatFolder, ApiUser,\n} from '../../../api/types';\nimport { NotifyException, NotifySettings, SettingsScreens } from '../../../types';\nimport { FolderEditDispatch } from '../../../hooks/reducers/useFoldersReducer';\n\nimport { ALL_CHATS_PRELOAD_DISABLED, CHAT_HEIGHT_PX, CHAT_LIST_SLICE } from '../../../config';\nimport { IS_ANDROID, IS_MAC_OS, IS_PWA } from '../../../util/environment';\nimport usePrevious from '../../../hooks/usePrevious';\nimport { mapValues, pick } from '../../../util/iteratees';\nimport { getChatOrder, prepareChatList, prepareFolderListIds } from '../../../modules/helpers';\nimport {\n  selectChatFolder, selectNotifyExceptions, selectNotifySettings,\n} from '../../../modules/selectors';\nimport useInfiniteScroll from '../../../hooks/useInfiniteScroll';\nimport { useChatAnimationType } from './hooks';\n\nimport InfiniteScroll from '../../ui/InfiniteScroll';\nimport Loading from '../../ui/Loading';\nimport Chat from './Chat';\nimport EmptyFolder from './EmptyFolder';\n\ntype OwnProps = {\n  folderType: 'all' | 'archived' | 'folder';\n  folderId?: number;\n  isActive: boolean;\n  onScreenSelect?: (screen: SettingsScreens) => void;\n  foldersDispatch?: FolderEditDispatch;\n};\n\ntype StateProps = {\n  chatsById: Record<number, ApiChat>;\n  usersById: Record<number, ApiUser>;\n  chatFolder?: ApiChatFolder;\n  listIds?: number[];\n  orderedPinnedIds?: number[];\n  lastSyncTime?: number;\n  notifySettings: NotifySettings;\n  notifyExceptions?: Record<number, NotifyException>;\n};\n\ntype DispatchProps = Pick<GlobalActions, 'loadMoreChats' | 'preloadTopChatMessages' | 'openChat' | 'openNextChat'>;\n\nenum FolderTypeToListType {\n  'all' = 'active',\n  'archived' = 'archived',\n}\n\nconst ChatList: FC<OwnProps & StateProps & DispatchProps> = ({\n  folderType,\n  folderId,\n  isActive,\n  chatFolder,\n  chatsById,\n  usersById,\n  listIds,\n  orderedPinnedIds,\n  lastSyncTime,\n  foldersDispatch,\n  notifySettings,\n  notifyExceptions,\n  onScreenSelect,\n  loadMoreChats,\n  preloadTopChatMessages,\n  openChat,\n  openNextChat,\n}) => {\n  const [currentListIds, currentPinnedIds] = useMemo(() => {\n    return folderType === 'folder' && chatFolder\n      ? prepareFolderListIds(chatsById, usersById, chatFolder, notifySettings, notifyExceptions)\n      : [listIds, orderedPinnedIds];\n  }, [folderType, chatFolder, chatsById, usersById, notifySettings, notifyExceptions, listIds, orderedPinnedIds]);\n\n  const [orderById, orderedIds] = useMemo(() => {\n    if (!currentListIds || (folderType === 'folder' && !chatFolder)) {\n      return [];\n    }\n    const newChatArrays = prepareChatList(chatsById, currentListIds, currentPinnedIds, folderType);\n    const singleList = [...newChatArrays.pinnedChats, ...newChatArrays.otherChats];\n    const newOrderedIds = singleList.map(({ id }) => id);\n    const newOrderById = singleList.reduce((acc, chat, i) => {\n      acc[chat.id] = i;\n      return acc;\n    }, {} as Record<string, number>);\n\n    return [newOrderById, newOrderedIds];\n  }, [currentListIds, currentPinnedIds, folderType, chatFolder, chatsById]);\n\n  const prevOrderById = usePrevious(orderById);\n\n  const orderDiffById = useMemo(() => {\n    if (!orderById || !prevOrderById) {\n      return {};\n    }\n\n    return mapValues(orderById, (order, id) => {\n      return order - (prevOrderById[id] !== undefined ? prevOrderById[id] : Infinity);\n    });\n  }, [orderById, prevOrderById]);\n\n  const loadMoreOfType = useCallback(() => {\n    loadMoreChats({ listType: folderType === 'archived' ? 'archived' : 'active' });\n  }, [loadMoreChats, folderType]);\n\n  const [viewportIds, getMore] = useInfiniteScroll(\n    lastSyncTime ? loadMoreOfType : undefined,\n    orderedIds,\n    undefined,\n    CHAT_LIST_SLICE,\n    folderType === 'all' && !ALL_CHATS_PRELOAD_DISABLED,\n  );\n\n  // TODO Refactor to not call `prepareChatList` twice\n  const chatArrays = viewportIds && prepareChatList(chatsById, viewportIds, currentPinnedIds, folderType);\n\n  useEffect(() => {\n    if (lastSyncTime && folderType === 'all') {\n      preloadTopChatMessages();\n    }\n  }, [lastSyncTime, folderType, preloadTopChatMessages]);\n\n  const getAnimationType = useChatAnimationType(orderDiffById);\n\n  function renderChats() {\n    const viewportOffset = orderedIds!.indexOf(viewportIds![0]);\n    const pinnedOffset = viewportOffset + chatArrays!.pinnedChats.length;\n\n    return (\n      <div\n        className=\"scroll-container\"\n        // @ts-ignore\n        style={IS_ANDROID ? `height: ${orderedIds!.length * CHAT_HEIGHT_PX}px` : undefined}\n        teactFastList\n      >\n        {chatArrays!.pinnedChats.map(({ id }, i) => (\n          <Chat\n            key={id}\n            teactOrderKey={i}\n            chatId={id}\n            isPinned\n            folderId={folderId}\n            animationType={getAnimationType(id)}\n            orderDiff={orderDiffById[id]}\n            // @ts-ignore\n            style={`top: ${(viewportOffset + i) * CHAT_HEIGHT_PX}px;`}\n          />\n        ))}\n        {chatArrays!.otherChats.map((chat, i) => (\n          <Chat\n            key={chat.id}\n            teactOrderKey={getChatOrder(chat)}\n            chatId={chat.id}\n            folderId={folderId}\n            animationType={getAnimationType(chat.id)}\n            orderDiff={orderDiffById[chat.id]}\n            // @ts-ignore\n            style={`top: ${(pinnedOffset + i) * CHAT_HEIGHT_PX}px;`}\n          />\n        ))}\n      </div>\n    );\n  }\n\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (isActive && orderedIds) {\n        if (IS_PWA && ((IS_MAC_OS && e.metaKey) || (!IS_MAC_OS && e.ctrlKey)) && e.code.startsWith('Digit')) {\n          const [, digit] = e.code.match(/Digit(\\d)/) || [];\n          if (!digit) return;\n\n          const position = Number(digit) - 1;\n          if (position > orderedIds.length - 1) return;\n\n          openChat({ id: orderedIds[position], shouldReplaceHistory: true });\n        }\n\n        if (e.altKey) {\n          const targetIndexDelta = e.key === 'ArrowDown' ? 1 : e.key === 'ArrowUp' ? -1 : undefined;\n          if (!targetIndexDelta) return;\n\n          e.preventDefault();\n          openNextChat({ targetIndexDelta, orderedIds });\n        }\n      }\n    };\n\n    document.addEventListener('keydown', handleKeyDown, false);\n\n    return () => {\n      document.removeEventListener('keydown', handleKeyDown, false);\n    };\n  });\n\n  return (\n    <InfiniteScroll\n      className=\"chat-list custom-scroll\"\n      items={viewportIds}\n      onLoadMore={getMore}\n      preloadBackwards={CHAT_LIST_SLICE}\n      noFastList\n      noScrollRestore\n    >\n      {viewportIds?.length && chatArrays ? (\n        renderChats()\n      ) : viewportIds && !viewportIds.length ? (\n        (\n          <EmptyFolder\n            folderId={folderId}\n            folderType={folderType}\n            foldersDispatch={foldersDispatch}\n            onScreenSelect={onScreenSelect}\n          />\n        )\n      ) : (\n        <Loading key=\"loading\" />\n      )}\n    </InfiniteScroll>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { folderType, folderId }): StateProps => {\n    const {\n      chats: {\n        listIds,\n        byId: chatsById,\n        orderedPinnedIds,\n      },\n      users: { byId: usersById },\n      lastSyncTime,\n    } = global;\n    const listType = folderType !== 'folder' ? FolderTypeToListType[folderType] : undefined;\n    const chatFolder = folderId ? selectChatFolder(global, folderId) : undefined;\n\n    return {\n      chatsById,\n      usersById,\n      lastSyncTime,\n      notifySettings: selectNotifySettings(global),\n      notifyExceptions: selectNotifyExceptions(global),\n      ...(listType ? {\n        listIds: listIds[listType],\n        orderedPinnedIds: orderedPinnedIds[listType],\n      } : {\n        chatFolder,\n      }),\n    };\n  },\n  (setGlobal, actions): DispatchProps => pick(actions, [\n    'loadMoreChats',\n    'preloadTopChatMessages',\n    'openChat',\n    'openNextChat',\n  ]),\n)(ChatList));\n","import React, { FC, memo } from '../../../lib/teact/teact';\n\nimport useFlag from '../../../hooks/useFlag';\nimport buildClassName from '../../../util/buildClassName';\n\nimport './DropTarget.scss';\n\nexport type OwnProps = {\n  isQuick?: boolean;\n  onFileSelect: (e: React.DragEvent<HTMLDivElement>) => void;\n};\n\nconst DropTarget: FC<OwnProps> = ({ isQuick, onFileSelect }) => {\n  const [isHovered, markHovered, unmarkHovered] = useFlag();\n\n  const handleDragEnter = () => { markHovered(); };\n  const handleDragLeave = (e: React.DragEvent<HTMLDivElement>) => {\n    const { relatedTarget: toTarget } = e;\n\n    if (toTarget) {\n      e.stopPropagation();\n    }\n\n    unmarkHovered();\n  };\n\n  const className = buildClassName(\n    'DropTarget',\n    isHovered && 'hovered',\n  );\n\n  return (\n    <div\n      className={className}\n      onDrop={onFileSelect}\n      onDragEnter={handleDragEnter}\n      onDragLeave={handleDragLeave}\n    >\n      <div className=\"target-content\">\n        <div className={`icon icon-${isQuick ? 'photo' : 'document'}`} />\n        <div className=\"title\">Drop files here to send them</div>\n        <div className=\"description\">{isQuick ? 'in a quick way' : 'without compression'}</div>\n      </div>\n    </div>\n  );\n};\n\nexport default memo(DropTarget);\n","import React, {\n  FC, memo, useCallback, useEffect, useRef,\n} from '../../../lib/teact/teact';\n\nimport useShowTransition from '../../../hooks/useShowTransition';\nimport buildClassName from '../../../util/buildClassName';\n\nimport captureEscKeyListener from '../../../util/captureEscKeyListener';\nimport usePrevious from '../../../hooks/usePrevious';\n\nimport DropTarget from './DropTarget';\n\nimport './DropArea.scss';\n\nexport type OwnProps = {\n  isOpen: boolean;\n  withQuick?: boolean;\n  onHide: NoneToVoidFunction;\n  onFileSelect: (files: File[], isQuick: boolean) => void;\n};\n\nexport enum DropAreaState {\n  None = 'none',\n  Document = 'document',\n  QuickFile = 'quick_file',\n}\n\nconst DROP_LEAVE_TIMEOUT_MS = 150;\n\nconst DropArea: FC<OwnProps> = ({\n  isOpen, withQuick, onHide, onFileSelect,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const hideTimeoutRef = useRef<number>(null);\n  const prevWithQuick = usePrevious(withQuick);\n  const { shouldRender, transitionClassNames } = useShowTransition(isOpen);\n\n  useEffect(() => (isOpen ? captureEscKeyListener(onHide) : undefined), [isOpen, onHide]);\n\n  const handleFilesDrop = useCallback((e: React.DragEvent<HTMLDivElement>) => {\n    const { dataTransfer: dt } = e;\n\n    if (dt.files && dt.files.length > 0) {\n      onHide();\n      onFileSelect(Array.from(dt.files), false);\n    }\n  }, [onFileSelect, onHide]);\n\n  const handleQuickFilesDrop = useCallback((e: React.DragEvent<HTMLDivElement>) => {\n    const { dataTransfer: dt } = e;\n\n    if (dt.files && dt.files.length > 0) {\n      onHide();\n      onFileSelect(Array.from(dt.files), true);\n    }\n  }, [onFileSelect, onHide]);\n\n  const handleDragLeave = useCallback((e: React.DragEvent<HTMLDivElement>) => {\n    e.stopPropagation();\n\n    const { target: fromTarget, relatedTarget: toTarget } = e;\n\n    // Esc button pressed during drag event\n    if ((fromTarget as HTMLDivElement).matches('.DropTarget, .DropArea') && !toTarget) {\n      hideTimeoutRef.current = window.setTimeout(() => {\n        onHide();\n      }, DROP_LEAVE_TIMEOUT_MS);\n    }\n  }, [onHide]);\n\n  const handleDragOver = () => {\n    if (hideTimeoutRef.current) {\n      window.clearTimeout(hideTimeoutRef.current);\n    }\n  };\n\n  if (!shouldRender) {\n    return undefined;\n  }\n\n  const className = buildClassName(\n    'DropArea',\n    transitionClassNames,\n  );\n\n  return (\n    <div className={className} onDragLeave={handleDragLeave} onDragOver={handleDragOver} onDrop={onHide}>\n      <DropTarget onFileSelect={handleFilesDrop} />\n      {(withQuick || prevWithQuick) && <DropTarget onFileSelect={handleQuickFilesDrop} isQuick />}\n    </div>\n  );\n};\n\nexport default memo(DropArea);\n","import React, { FC, memo } from '../../../lib/teact/teact';\nimport { OwnProps } from './EmojiTooltip';\nimport { Bundles } from '../../../util/moduleLoader';\n\nimport useModuleLoader from '../../../hooks/useModuleLoader';\n\nconst EmojiTooltipAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const EmojiTooltip = useModuleLoader(Bundles.Extra, 'EmojiTooltip', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return EmojiTooltip ? <EmojiTooltip {...props} /> : undefined;\n};\n\nexport default memo(EmojiTooltipAsync);\n","import { ChangeEvent } from 'react';\nimport React, {\n  FC, useEffect, useRef, memo, useState, useCallback,\n} from '../../../lib/teact/teact';\nimport { withGlobal } from '../../../lib/teact/teactn';\n\nimport { GlobalActions } from '../../../global/types';\nimport { IAnchorPosition, ISettings } from '../../../types';\n\nimport { EDITABLE_INPUT_ID } from '../../../config';\nimport { selectCurrentMessageList, selectReplyingToId } from '../../../modules/selectors';\nimport { debounce } from '../../../util/schedulers';\nimport focusEditableElement from '../../../util/focusEditableElement';\nimport buildClassName from '../../../util/buildClassName';\nimport { pick } from '../../../util/iteratees';\nimport {\n  IS_ANDROID, IS_IOS, IS_SINGLE_COLUMN_LAYOUT, IS_TOUCH_ENV,\n} from '../../../util/environment';\nimport captureKeyboardListeners from '../../../util/captureKeyboardListeners';\nimport useLayoutEffectWithPrevDeps from '../../../hooks/useLayoutEffectWithPrevDeps';\nimport useFlag from '../../../hooks/useFlag';\nimport parseEmojiOnlyString from '../../common/helpers/parseEmojiOnlyString';\nimport { isSelectionInsideInput } from './helpers/selection';\nimport useLang from '../../../hooks/useLang';\nimport renderText from '../../common/helpers/renderText';\n\nimport TextFormatter from './TextFormatter';\n\nconst CONTEXT_MENU_CLOSE_DELAY_MS = 100;\n// Focus slows down animation, also it breaks transition layout in Chrome\nconst FOCUS_DELAY_MS = 350;\nconst TRANSITION_DURATION_FACTOR = 50;\n\ntype OwnProps = {\n  id: string;\n  isAttachmentModalInput?: boolean;\n  editableInputId?: string;\n  html: string;\n  placeholder: string;\n  forcedPlaceholder?: string;\n  shouldSetFocus: boolean;\n  shouldSuppressFocus?: boolean;\n  shouldSuppressTextFormatter?: boolean;\n  onUpdate: (html: string) => void;\n  onSuppressedFocus?: () => void;\n  onSend: () => void;\n};\n\ntype StateProps = {\n  currentChatId?: number;\n  replyingToId?: number;\n  noTabCapture?: boolean;\n  messageSendKeyCombo?: ISettings['messageSendKeyCombo'];\n};\n\ntype DispatchProps = Pick<GlobalActions, 'editLastMessage' | 'replyToNextMessage'>;\n\nconst MAX_INPUT_HEIGHT = IS_SINGLE_COLUMN_LAYOUT ? 256 : 416;\nconst TAB_INDEX_PRIORITY_TIMEOUT = 2000;\nconst TEXT_FORMATTER_SAFE_AREA_PX = 90;\n// For some reason Safari inserts `<br>` after user removes text from input\nconst SAFARI_BR = '<br>';\n\nfunction clearSelection() {\n  const selection = window.getSelection();\n  if (!selection) {\n    return;\n  }\n\n  if (selection.removeAllRanges) {\n    selection.removeAllRanges();\n  } else if (selection.empty) {\n    selection.empty();\n  }\n}\n\nconst MessageInput: FC<OwnProps & StateProps & DispatchProps> = ({\n  id,\n  isAttachmentModalInput,\n  editableInputId,\n  html,\n  placeholder,\n  forcedPlaceholder,\n  shouldSetFocus,\n  shouldSuppressFocus,\n  shouldSuppressTextFormatter,\n  onUpdate,\n  onSuppressedFocus,\n  onSend,\n  currentChatId,\n  replyingToId,\n  noTabCapture,\n  messageSendKeyCombo,\n  editLastMessage,\n  replyToNextMessage,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const inputRef = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const cloneRef = useRef<HTMLDivElement>(null);\n\n  const lang = useLang();\n  const isContextMenuOpenRef = useRef(false);\n  const [isTextFormatterOpen, openTextFormatter, closeTextFormatter] = useFlag();\n  const [textFormatterAnchorPosition, setTextFormatterAnchorPosition] = useState<IAnchorPosition>();\n  const [selectedRange, setSelectedRange] = useState<Range>();\n\n  useEffect(() => {\n    if (!isAttachmentModalInput) return;\n    updateInputHeight(false);\n  }, [isAttachmentModalInput]);\n\n  useLayoutEffectWithPrevDeps(([prevHtml]) => {\n    if (html !== inputRef.current!.innerHTML) {\n      inputRef.current!.innerHTML = html;\n    }\n\n    if (html !== cloneRef.current!.innerHTML) {\n      cloneRef.current!.innerHTML = html;\n    }\n\n    if (prevHtml !== undefined && prevHtml !== html) {\n      updateInputHeight(!html.length);\n    }\n  }, [html]);\n\n  const focusInput = useCallback(() => {\n    // Avoid focusing during animation\n    if (inputRef.current!.closest('.from, .to')) {\n      setTimeout(focusInput, FOCUS_DELAY_MS);\n      return;\n    }\n\n    focusEditableElement(inputRef.current!);\n  }, []);\n\n  const handleCloseTextFormatter = useCallback(() => {\n    closeTextFormatter();\n    clearSelection();\n  }, [closeTextFormatter]);\n\n  function checkSelection() {\n    // Disable the formatter on iOS devices for now.\n    if (IS_IOS) {\n      return false;\n    }\n\n    const selection = window.getSelection();\n    if (!selection || !selection.rangeCount || isContextMenuOpenRef.current) {\n      closeTextFormatter();\n      return false;\n    }\n\n    const selectionRange = selection.getRangeAt(0);\n    const selectedText = selectionRange.toString().trim();\n    if (\n      shouldSuppressTextFormatter\n      || !isSelectionInsideInput(selectionRange, editableInputId || EDITABLE_INPUT_ID)\n      || !selectedText\n      || parseEmojiOnlyString(selectedText)\n      || !selectionRange.START_TO_END\n    ) {\n      closeTextFormatter();\n      return false;\n    }\n\n    return true;\n  }\n\n  function processSelection() {\n    if (!checkSelection()) {\n      return;\n    }\n\n    const selectionRange = window.getSelection()!.getRangeAt(0);\n    const selectionRect = selectionRange.getBoundingClientRect();\n    const inputRect = inputRef.current!.getBoundingClientRect();\n\n    let x = (selectionRect.left + selectionRect.width / 2) - inputRect.left;\n\n    if (x < TEXT_FORMATTER_SAFE_AREA_PX) {\n      x = TEXT_FORMATTER_SAFE_AREA_PX;\n    } else if (x > inputRect.width - TEXT_FORMATTER_SAFE_AREA_PX) {\n      x = inputRect.width - TEXT_FORMATTER_SAFE_AREA_PX;\n    }\n\n    setTextFormatterAnchorPosition({\n      x,\n      y: selectionRect.top - inputRect.top,\n    });\n\n    setSelectedRange(selectionRange);\n    openTextFormatter();\n  }\n\n  function handleMouseDown(event: React.MouseEvent<HTMLDivElement, MouseEvent>) {\n    function handleMouseUp() {\n      processSelection();\n\n      event.target.removeEventListener('mouseup', handleMouseUp);\n    }\n\n    if (event.button !== 2) {\n      event.target.addEventListener('mouseup', handleMouseUp);\n      return;\n    }\n\n    if (isContextMenuOpenRef.current === true) {\n      return;\n    }\n\n    isContextMenuOpenRef.current = true;\n\n    function closeContextMenuMouseListener() {\n      setTimeout(() => {\n        isContextMenuOpenRef.current = false;\n      }, CONTEXT_MENU_CLOSE_DELAY_MS);\n\n      window.removeEventListener('mouseup', closeContextMenuMouseListener);\n    }\n\n    function closeContextMenuKeyListener(e: KeyboardEvent) {\n      if (e.key !== 'Esc' && e.key !== 'Escape') {\n        return;\n      }\n\n      setTimeout(() => {\n        isContextMenuOpenRef.current = false;\n      }, CONTEXT_MENU_CLOSE_DELAY_MS);\n\n      window.removeEventListener('keydown', closeContextMenuKeyListener);\n    }\n\n    document.addEventListener('mousedown', closeContextMenuMouseListener);\n    document.addEventListener('keydown', closeContextMenuKeyListener);\n  }\n\n  function handleKeyDown(e: React.KeyboardEvent<HTMLDivElement>) {\n    function handleKeyUp() {\n      processSelection();\n\n      e.target.removeEventListener('keyup', handleKeyUp);\n    }\n\n    if (e.metaKey && !html.length) {\n      const targetIndexDelta = e.key === 'ArrowDown' ? 1 : e.key === 'ArrowUp' ? -1 : undefined;\n      if (targetIndexDelta) {\n        e.preventDefault();\n\n        replyToNextMessage({ targetIndexDelta });\n        return;\n      }\n    }\n\n    if (e.key === 'Enter' && !e.shiftKey) {\n      if (\n        !(IS_IOS || IS_ANDROID)\n        && (\n          (messageSendKeyCombo === 'enter' && !e.shiftKey)\n          || (messageSendKeyCombo === 'ctrl-enter' && (e.ctrlKey || e.metaKey))\n        )\n      ) {\n        e.preventDefault();\n\n        closeTextFormatter();\n        onSend();\n      }\n    } else if (e.key === 'ArrowUp' && !html.length && !e.metaKey && !e.altKey) {\n      e.preventDefault();\n      editLastMessage();\n    } else {\n      e.target.addEventListener('keyup', handleKeyUp);\n    }\n  }\n\n  function handleChange(e: ChangeEvent<HTMLDivElement>) {\n    const { innerHTML, textContent } = e.currentTarget;\n\n    onUpdate(innerHTML === SAFARI_BR ? '' : innerHTML);\n\n    // Reset focus on the input to remove any active styling when input is cleared\n    if (!IS_TOUCH_ENV && (!textContent || !textContent.length)) {\n      const selection = window.getSelection()!;\n      if (selection) {\n        inputRef.current!.blur();\n        selection.removeAllRanges();\n        focusEditableElement(inputRef.current!, true);\n      }\n    }\n  }\n\n  function stopEvent(e: React.MouseEvent<HTMLDivElement, MouseEvent>) {\n    if (!checkSelection()) {\n      return;\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  function updateInputHeight(willSend = false) {\n    const input = inputRef.current!;\n    const clone = cloneRef.current!;\n    const currentHeight = Number(input.style.height.replace('px', ''));\n    const newHeight = Math.min(clone.scrollHeight, MAX_INPUT_HEIGHT);\n    if (newHeight === currentHeight) {\n      return;\n    }\n\n    const transitionDuration = Math.round(\n      TRANSITION_DURATION_FACTOR * Math.log(Math.abs(newHeight - currentHeight)),\n    );\n\n    const exec = () => {\n      input.style.height = `${newHeight}px`;\n      input.style.transitionDuration = `${transitionDuration}ms`;\n      input.classList.toggle('overflown', clone.scrollHeight > MAX_INPUT_HEIGHT);\n    };\n\n    if (willSend) {\n      // Sync with sending animation\n      requestAnimationFrame(exec);\n    } else {\n      exec();\n    }\n  }\n\n  useEffect(() => {\n    if (IS_TOUCH_ENV) {\n      return;\n    }\n\n    if (shouldSetFocus) {\n      focusInput();\n    }\n  }, [currentChatId, focusInput, replyingToId, shouldSetFocus]);\n\n  useEffect(() => {\n    if (noTabCapture) {\n      return undefined;\n    }\n\n    const captureFirstTab = debounce((e: KeyboardEvent) => {\n      if (e.key === 'Tab') {\n        e.preventDefault();\n        requestAnimationFrame(focusInput);\n      }\n    }, TAB_INDEX_PRIORITY_TIMEOUT, true, false);\n\n    return captureKeyboardListeners({ onTab: captureFirstTab });\n  }, [focusInput, noTabCapture]);\n\n  useEffect(() => {\n    const input = inputRef.current!;\n\n    function suppressFocus() {\n      input.blur();\n    }\n\n    if (shouldSuppressFocus) {\n      input.addEventListener('focus', suppressFocus);\n    }\n\n    return () => {\n      input.removeEventListener('focus', suppressFocus);\n    };\n  }, [shouldSuppressFocus]);\n\n  const className = buildClassName(\n    'form-control custom-scroll',\n    html.length > 0 && 'touched',\n    shouldSuppressFocus && 'focus-disabled',\n  );\n\n  return (\n    <div id={id} onClick={shouldSuppressFocus ? onSuppressedFocus : undefined} dir={lang.isRtl ? 'rtl' : undefined}>\n      <div\n        ref={inputRef}\n        id={editableInputId || EDITABLE_INPUT_ID}\n        className={className}\n        contentEditable\n        dir=\"auto\"\n        onClick={focusInput}\n        onChange={handleChange}\n        onKeyDown={handleKeyDown}\n        onMouseDown={handleMouseDown}\n        onContextMenu={IS_ANDROID ? stopEvent : undefined}\n        onTouchCancel={IS_ANDROID ? processSelection : undefined}\n      />\n      <div ref={cloneRef} className={buildClassName(className, 'clone')} dir=\"auto\" />\n      {!forcedPlaceholder && <span className=\"placeholder-text\" dir=\"auto\">{placeholder}</span>}\n      <TextFormatter\n        isOpen={isTextFormatterOpen}\n        anchorPosition={textFormatterAnchorPosition}\n        selectedRange={selectedRange}\n        onClose={handleCloseTextFormatter}\n      />\n      {forcedPlaceholder && <span className=\"forced-placeholder\">{renderText(forcedPlaceholder!)}</span>}\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global): StateProps => {\n    const { chatId: currentChatId, threadId } = selectCurrentMessageList(global) || {};\n    const { messageSendKeyCombo } = global.settings.byKey;\n\n    return {\n      currentChatId,\n      messageSendKeyCombo,\n      replyingToId: currentChatId && threadId ? selectReplyingToId(global, currentChatId, threadId) : undefined,\n      noTabCapture: global.isPollModalOpen || global.payment.isPaymentModalOpen,\n    };\n  },\n  (setGlobal, actions): DispatchProps => pick(actions, ['editLastMessage', 'replyToNextMessage']),\n)(MessageInput));\n","import React, {\n  FC, memo, useCallback, useEffect, useRef, useState,\n} from '../../../lib/teact/teact';\n\nimport { IAnchorPosition } from '../../../types';\n\nimport { EDITABLE_INPUT_ID } from '../../../config';\nimport buildClassName from '../../../util/buildClassName';\nimport captureEscKeyListener from '../../../util/captureEscKeyListener';\nimport useShowTransition from '../../../hooks/useShowTransition';\nimport useVirtualBackdrop from '../../../hooks/useVirtualBackdrop';\nimport useFlag from '../../../hooks/useFlag';\nimport useLang from '../../../hooks/useLang';\n\nimport Button from '../../ui/Button';\n\nimport './TextFormatter.scss';\n\nexport type OwnProps = {\n  isOpen: boolean;\n  anchorPosition?: IAnchorPosition;\n  selectedRange?: Range;\n  onClose: () => void;\n};\n\ninterface ISelectedTextFormats {\n  bold?: boolean;\n  italic?: boolean;\n  underline?: boolean;\n  strikethrough?: boolean;\n  monospace?: boolean;\n}\n\nconst TEXT_FORMAT_BY_TAG_NAME: Record<string, keyof ISelectedTextFormats> = {\n  B: 'bold',\n  STRONG: 'bold',\n  I: 'italic',\n  EM: 'italic',\n  U: 'underline',\n  DEL: 'strikethrough',\n  CODE: 'monospace',\n};\nconst fragmentEl = document.createElement('div');\n\nconst TextFormatter: FC<OwnProps> = ({\n  isOpen,\n  anchorPosition,\n  selectedRange,\n  onClose,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const containerRef = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const linkUrlInputRef = useRef<HTMLInputElement>(null);\n  const { shouldRender, transitionClassNames } = useShowTransition(isOpen);\n  const [isLinkControlOpen, openLinkControl, closeLinkControl] = useFlag();\n  const [linkUrl, setLinkUrl] = useState('');\n  const [isEditingLink, setIsEditingLink] = useState(false);\n  const [inputClassName, setInputClassName] = useState<string | undefined>();\n  const [selectedTextFormats, setSelectedTextFormats] = useState<ISelectedTextFormats>({});\n\n  useEffect(() => (isOpen ? captureEscKeyListener(onClose) : undefined), [isOpen, onClose]);\n  useVirtualBackdrop(\n    isOpen,\n    containerRef,\n    onClose,\n  );\n\n  useEffect(() => {\n    if (isLinkControlOpen) {\n      linkUrlInputRef.current!.focus();\n    } else {\n      setLinkUrl('');\n      setIsEditingLink(false);\n    }\n  }, [isLinkControlOpen]);\n\n  useEffect(() => {\n    if (!shouldRender) {\n      closeLinkControl();\n      setSelectedTextFormats({});\n      setInputClassName(undefined);\n    }\n  }, [closeLinkControl, shouldRender]);\n\n  useEffect(() => {\n    if (!isOpen || !selectedRange) {\n      return;\n    }\n\n    const selectedFormats: ISelectedTextFormats = {};\n    let { parentElement } = selectedRange.commonAncestorContainer;\n    while (parentElement && parentElement.id !== EDITABLE_INPUT_ID) {\n      const textFormat = TEXT_FORMAT_BY_TAG_NAME[parentElement.tagName];\n      if (textFormat) {\n        selectedFormats[textFormat] = true;\n      }\n\n      parentElement = parentElement.parentElement;\n    }\n\n    setSelectedTextFormats(selectedFormats);\n  }, [isOpen, selectedRange, openLinkControl]);\n\n  function restoreSelection() {\n    if (!selectedRange) {\n      return;\n    }\n\n    const selection = window.getSelection();\n    if (selection) {\n      selection.removeAllRanges();\n      selection.addRange(selectedRange);\n    }\n  }\n\n  const getSelectedText = useCallback(() => {\n    if (!selectedRange) {\n      return undefined;\n    }\n    fragmentEl.innerText = selectedRange.toString();\n\n    return fragmentEl.innerHTML;\n  }, [selectedRange]);\n\n  const getSelectedElement = useCallback(() => {\n    if (!selectedRange) {\n      return undefined;\n    }\n\n    return selectedRange.commonAncestorContainer.parentElement;\n  }, [selectedRange]);\n\n  function updateInputStyles() {\n    const input = linkUrlInputRef.current;\n    if (!input) {\n      return;\n    }\n\n    const { offsetWidth, scrollWidth, scrollLeft } = input;\n    if (scrollWidth <= offsetWidth) {\n      setInputClassName(undefined);\n      return;\n    }\n\n    let className = '';\n    if (scrollLeft < scrollWidth - offsetWidth) {\n      className = 'mask-right';\n    }\n    if (scrollLeft > 0) {\n      className += ' mask-left';\n    }\n\n    setInputClassName(className);\n  }\n\n  function handleLinkUrlChange(e: React.ChangeEvent<HTMLInputElement>) {\n    setLinkUrl(e.target.value);\n    updateInputStyles();\n  }\n\n  function getFormatButtonClassName(key: keyof ISelectedTextFormats) {\n    if (selectedTextFormats[key]) {\n      return 'active';\n    }\n\n    if (key === 'monospace' || key === 'strikethrough') {\n      if (Object.keys(selectedTextFormats).some(\n        (fKey) => fKey !== key && !!selectedTextFormats[fKey as keyof ISelectedTextFormats],\n      )) {\n        return 'disabled';\n      }\n    } else if (selectedTextFormats.monospace || selectedTextFormats.strikethrough) {\n      return 'disabled';\n    }\n\n    return undefined;\n  }\n\n  const handleBoldText = useCallback(() => {\n    setSelectedTextFormats((selectedFormats) => {\n      // Somehow re-applying 'bold' command to already bold text doesn't work\n      document.execCommand(selectedFormats.bold ? 'removeFormat' : 'bold');\n      Object.keys(selectedFormats).forEach((key) => {\n        if ((key === 'italic' || key === 'underline') && !!selectedFormats[key]) {\n          document.execCommand(key);\n        }\n      });\n\n      return {\n        ...selectedFormats,\n        bold: !selectedFormats.bold,\n      };\n    });\n  }, []);\n\n  const handleItalicText = useCallback(() => {\n    document.execCommand('italic');\n    setSelectedTextFormats((selectedFormats) => ({\n      ...selectedFormats,\n      italic: !selectedFormats.italic,\n    }));\n  }, []);\n\n  const handleUnderlineText = useCallback(() => {\n    document.execCommand('underline');\n    setSelectedTextFormats((selectedFormats) => ({\n      ...selectedFormats,\n      underline: !selectedFormats.underline,\n    }));\n  }, []);\n\n  const handleStrikethroughText = useCallback(() => {\n    if (selectedTextFormats.strikethrough) {\n      const element = getSelectedElement();\n      if (\n        !selectedRange\n        || !element\n        || element.tagName !== 'DEL'\n        || !element.textContent\n      ) {\n        return;\n      }\n\n      element.replaceWith(element.textContent);\n      setSelectedTextFormats((selectedFormats) => ({\n        ...selectedFormats,\n        strikethrough: false,\n      }));\n\n      return;\n    }\n\n    const text = getSelectedText();\n    document.execCommand('insertHTML', false, `<del>${text}</del>`);\n    onClose();\n  }, [\n    getSelectedElement, getSelectedText, onClose,\n    selectedRange, selectedTextFormats.strikethrough,\n  ]);\n\n  const handleMonospaceText = useCallback(() => {\n    if (selectedTextFormats.monospace) {\n      const element = getSelectedElement();\n      if (\n        !selectedRange\n        || !element\n        || element.tagName !== 'CODE'\n        || !element.textContent\n      ) {\n        return;\n      }\n\n      element.replaceWith(element.textContent);\n      setSelectedTextFormats((selectedFormats) => ({\n        ...selectedFormats,\n        monospace: false,\n      }));\n      return;\n    }\n\n    const text = getSelectedText();\n    document.execCommand('insertHTML', false, `<code class=\"text-entity-code\" dir=\"auto\">${text}</code>`);\n    onClose();\n  }, [\n    getSelectedElement, getSelectedText, onClose,\n    selectedRange, selectedTextFormats.monospace,\n  ]);\n\n  function handleLinkUrlConfirm() {\n    const formattedLinkUrl = encodeURI(linkUrl.includes('://') ? linkUrl : `http://${linkUrl}`);\n\n    if (isEditingLink) {\n      const element = getSelectedElement();\n      if (!element || element.tagName !== 'A') {\n        return;\n      }\n\n      (element as HTMLAnchorElement).href = formattedLinkUrl;\n\n      onClose();\n      return;\n    }\n\n    const text = getSelectedText();\n    restoreSelection();\n    document.execCommand(\n      'insertHTML',\n      false,\n      `<a href=${formattedLinkUrl} class=\"text-entity-link\" dir=\"auto\">${text}</a>`,\n    );\n    onClose();\n  }\n\n  const handleKeyDown = useCallback((e: KeyboardEvent) => {\n    const HANDLERS_BY_KEY_CODE: Record<string, AnyToVoidFunction> = {\n      KeyK: openLinkControl,\n      KeyB: handleBoldText,\n      KeyU: handleUnderlineText,\n      KeyI: handleItalicText,\n      KeyM: handleMonospaceText,\n      KeyS: handleStrikethroughText,\n    };\n\n    const handler = HANDLERS_BY_KEY_CODE[e.code];\n\n    if (\n      e.altKey\n      || !(e.ctrlKey || e.metaKey)\n      || !handler\n    ) {\n      return;\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n    handler();\n  }, [\n    handleBoldText, handleItalicText, handleUnderlineText,\n    handleMonospaceText, handleStrikethroughText,\n    openLinkControl,\n  ]);\n\n  useEffect(() => {\n    if (isOpen) {\n      document.addEventListener('keydown', handleKeyDown);\n    }\n\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, [isOpen, handleKeyDown]);\n\n  const lang = useLang();\n\n  function handleContainerKeyDown(e: React.KeyboardEvent<HTMLDivElement>) {\n    if (e.key === 'Enter' && isLinkControlOpen) {\n      handleLinkUrlConfirm();\n      e.preventDefault();\n    }\n  }\n\n  if (!shouldRender) {\n    return undefined;\n  }\n\n  const className = buildClassName(\n    'TextFormatter',\n    transitionClassNames,\n    isLinkControlOpen && 'link-control-shown',\n  );\n\n  const linkUrlConfirmClassName = buildClassName(\n    'TextFormatter-link-url-confirm',\n    !!linkUrl.length && 'shown',\n  );\n\n  const style = anchorPosition\n    ? `left: ${anchorPosition.x}px; top: ${anchorPosition.y}px;--text-formatter-left: ${anchorPosition.x}px;`\n    : '';\n\n  return (\n    <div\n      ref={containerRef}\n      className={className}\n      // @ts-ignore Teact feature\n      style={style}\n      onKeyDown={handleContainerKeyDown}\n    >\n      <div className=\"TextFormatter-buttons\">\n        <Button\n          color=\"translucent\"\n          ariaLabel=\"Bold text\"\n          className={getFormatButtonClassName('bold')}\n          onClick={handleBoldText}\n        >\n          <i className=\"icon-bold\" />\n        </Button>\n        <Button\n          color=\"translucent\"\n          ariaLabel=\"Italic text\"\n          className={getFormatButtonClassName('italic')}\n          onClick={handleItalicText}\n        >\n          <i className=\"icon-italic\" />\n        </Button>\n        <Button\n          color=\"translucent\"\n          ariaLabel=\"Underlined text\"\n          className={getFormatButtonClassName('underline')}\n          onClick={handleUnderlineText}\n        >\n          <i className=\"icon-underlined\" />\n        </Button>\n        <Button\n          color=\"translucent\"\n          ariaLabel=\"Strikethrough text\"\n          className={getFormatButtonClassName('strikethrough')}\n          onClick={handleStrikethroughText}\n        >\n          <i className=\"icon-strikethrough\" />\n        </Button>\n        <Button\n          color=\"translucent\"\n          ariaLabel=\"Monospace text\"\n          className={getFormatButtonClassName('monospace')}\n          onClick={handleMonospaceText}\n        >\n          <i className=\"icon-monospace\" />\n        </Button>\n        <div className=\"TextFormatter-divider\" />\n        <Button color=\"translucent\" ariaLabel={lang('TextFormat.AddLinkTitle')} onClick={openLinkControl}>\n          <i className=\"icon-link\" />\n        </Button>\n      </div>\n\n      <div className=\"TextFormatter-link-control\">\n        <div className=\"TextFormatter-buttons\">\n          <Button color=\"translucent\" ariaLabel={lang('Cancel')} onClick={closeLinkControl}>\n            <i className=\"icon-arrow-left\" />\n          </Button>\n          <div className=\"TextFormatter-divider\" />\n\n          <div\n            className={buildClassName('TextFormatter-link-url-input-wrapper', inputClassName)}\n          >\n            <input\n              ref={linkUrlInputRef}\n              className=\"TextFormatter-link-url-input\"\n              type=\"text\"\n              value={linkUrl}\n              placeholder=\"Enter URL...\"\n              autoComplete=\"off\"\n              inputMode=\"url\"\n              dir=\"auto\"\n              onChange={handleLinkUrlChange}\n              onScroll={updateInputStyles}\n            />\n          </div>\n\n          <div className={linkUrlConfirmClassName}>\n            <div className=\"TextFormatter-divider\" />\n            <Button\n              color=\"translucent\"\n              ariaLabel={lang('Save')}\n              className=\"color-primary\"\n              onClick={handleLinkUrlConfirm}\n            >\n              <i className=\"icon-check\" />\n            </Button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default memo(TextFormatter);\n","import { ApiMessageEntity, ApiMessageEntityTypes, ApiFormattedText } from '../../../../api/types';\nimport { IS_EMOJI_SUPPORTED } from '../../../../util/environment';\n\nconst ENTITY_CLASS_BY_NODE_NAME: Record<string, string> = {\n  B: ApiMessageEntityTypes.Bold,\n  STRONG: ApiMessageEntityTypes.Bold,\n  I: ApiMessageEntityTypes.Italic,\n  EM: ApiMessageEntityTypes.Italic,\n  U: ApiMessageEntityTypes.Underline,\n  S: ApiMessageEntityTypes.Strike,\n  STRIKE: ApiMessageEntityTypes.Strike,\n  DEL: ApiMessageEntityTypes.Strike,\n  CODE: ApiMessageEntityTypes.Code,\n  PRE: ApiMessageEntityTypes.Pre,\n  BLOCKQUOTE: ApiMessageEntityTypes.Blockquote,\n};\n\nconst MAX_TAG_DEEPNESS = 3;\n\nexport default function parseMessageInput(html: string): ApiFormattedText {\n  const fragment = document.createElement('div');\n  fragment.innerHTML = parseMarkdown(html);\n  const text = fragment.innerText.trim().replace(/\\u200b+/g, '');\n  let textIndex = 0;\n  let recursionDeepness = 0;\n  const entities: ApiMessageEntity[] = [];\n\n  function addEntity(node: ChildNode) {\n    const { index, entity } = getEntityDataFromNode(node, text, textIndex);\n\n    if (entity) {\n      textIndex = index;\n      entities.push(entity);\n    } else if (node.textContent) {\n      textIndex += node.textContent.length;\n    }\n\n    if (node.hasChildNodes() && recursionDeepness <= MAX_TAG_DEEPNESS) {\n      recursionDeepness += 1;\n      Array.from(node.childNodes).forEach(addEntity);\n    }\n  }\n\n  Array.from(fragment.childNodes).forEach((node) => {\n    recursionDeepness = 1;\n    addEntity(node);\n  });\n\n  return {\n    text,\n    entities: entities.length ? entities : undefined,\n  };\n}\n\nfunction parseMarkdown(html: string) {\n  let parsedHtml = html.slice(0);\n\n  if (!IS_EMOJI_SUPPORTED) {\n    // Emojis\n    parsedHtml = parsedHtml.replace(/<img[^>]+alt=\"([^\"]+)\"[^>]*>/gm, '$1');\n  }\n\n  // Strip redundant <span> tags\n  parsedHtml = parsedHtml.replace(/<\\/?span([^>]*)?>/g, '');\n\n  // Strip redundant nbsp's\n  parsedHtml = parsedHtml.replace(/&nbsp;/g, ' ');\n\n  // Replace <div><br></div> with newline (new line in Safari)\n  parsedHtml = parsedHtml.replace(/<div><br([^>]*)?><\\/div>/g, '\\n');\n  // Replace <br> with newline\n  parsedHtml = parsedHtml.replace(/<br([^>]*)?>/g, '\\n');\n\n  // Strip redundant <div> tags\n  parsedHtml = parsedHtml.replace(/<\\/div>(\\s*)<div>/g, '\\n');\n  parsedHtml = parsedHtml.replace(/<div>/g, '\\n');\n  parsedHtml = parsedHtml.replace(/<\\/div>/g, '');\n\n  // Pre\n  parsedHtml = parsedHtml.replace(/^`{3}(.*[\\n\\r][^]*?^)`{3}/gm, '<pre>$1</pre>');\n  parsedHtml = parsedHtml.replace(/[`]{3}([^`]+)[`]{3}/g, '<pre>$1</pre>');\n\n  // Code\n  parsedHtml = parsedHtml.replace(/[`]{1}([^`\\n]+)[`]{1}/g, '<code>$1</code>');\n\n  // Other simple markdown\n  parsedHtml = parsedHtml.replace(/[*]{2}([^*\\n]+)[*]{2}/g, '<b>$1</b>');\n  parsedHtml = parsedHtml.replace(/[_]{2}([^*\\n]+)[_]{2}/g, '<i>$1</i>');\n  parsedHtml = parsedHtml.replace(/[~]{2}([^~\\n]+)[~]{2}/g, '<s>$1</s>');\n\n  return parsedHtml;\n}\n\nfunction getEntityDataFromNode(\n  node: ChildNode,\n  rawText: string,\n  textIndex: number,\n): { index: number; entity?: ApiMessageEntity } {\n  const type = getEntityTypeFromNode(node);\n  if (!type || !node.textContent) {\n    return {\n      index: textIndex,\n      entity: undefined,\n    };\n  }\n\n  const rawIndex = rawText.indexOf(node.textContent, textIndex);\n  // In some cases, last text entity ends with a newline (which gets trimmed from `rawText`).\n  // In this case, `rawIndex` would return `-1`, so we use `textIndex` instead.\n  const index = rawIndex >= 0 ? rawIndex : textIndex;\n  const offset = rawText.substring(0, index).length;\n  const { length } = rawText.substring(index, index + node.textContent.length);\n\n  let url: string | undefined;\n  let userId: number | undefined;\n  if (type === ApiMessageEntityTypes.TextUrl) {\n    url = (node as HTMLAnchorElement).href;\n  }\n  if (type === ApiMessageEntityTypes.MentionName) {\n    userId = Number((node as HTMLAnchorElement).dataset.userId);\n  }\n\n  return {\n    index,\n    entity: {\n      type,\n      offset,\n      length,\n      ...(url && { url }),\n      ...(userId && { userId }),\n    },\n  };\n}\n\nfunction getEntityTypeFromNode(node: ChildNode) {\n  if (ENTITY_CLASS_BY_NODE_NAME[node.nodeName]) {\n    return ENTITY_CLASS_BY_NODE_NAME[node.nodeName];\n  }\n\n  if (node.nodeName === 'A') {\n    const anchor = node as HTMLAnchorElement;\n    if (anchor.dataset.entityType === ApiMessageEntityTypes.MentionName) {\n      return ApiMessageEntityTypes.MentionName;\n    }\n    if (anchor.dataset.entityType === ApiMessageEntityTypes.Url) {\n      return ApiMessageEntityTypes.Url;\n    }\n    if (anchor.href.startsWith('mailto:')) {\n      return ApiMessageEntityTypes.Email;\n    }\n    if (anchor.href.startsWith('tel:')) {\n      return ApiMessageEntityTypes.Phone;\n    }\n    if (anchor.href !== anchor.textContent) {\n      return ApiMessageEntityTypes.TextUrl;\n    }\n\n    return ApiMessageEntityTypes.Url;\n  }\n\n  if (node.nodeName === 'SPAN') {\n    return (node as HTMLElement).dataset.entityType;\n  }\n\n  return undefined;\n}\n","const RE_BR = /(<br>|<br\\s?\\/>)/g;\nconst RE_SPACE = /(&nbsp;|\\u00A0)/g;\nconst RE_CLEAN_HTML = /(<div>|<\\/div>)/gi;\nconst RE_EXTRA_NEW_LINE = /\\n$/i;\n\nexport function prepareForRegExp(html: string) {\n  return html\n    .replace(RE_SPACE, ' ')\n    .replace(RE_BR, '\\n')\n    .replace(RE_CLEAN_HTML, '')\n    .replace(RE_EXTRA_NEW_LINE, '');\n}\n","const MAX_NESTING_PARENTS = 5;\n\nexport function isSelectionInsideInput(selectionRange: Range, inputId: string) {\n  const { commonAncestorContainer } = selectionRange;\n  let parentNode: HTMLElement | null = commonAncestorContainer as HTMLElement;\n  let iterations = 1;\n  while (parentNode && parentNode.id !== inputId && iterations < MAX_NESTING_PARENTS) {\n    parentNode = parentNode.parentElement;\n    iterations++;\n  }\n\n  return Boolean(parentNode && parentNode.id === inputId);\n}\n","import {\n  useCallback, useEffect, useMemo, useState,\n} from '../../../../lib/teact/teact';\n\nimport { EDITABLE_INPUT_ID } from '../../../../config';\nimport { MEMO_EMPTY_ARRAY } from '../../../../util/memo';\nimport { prepareForRegExp } from '../helpers/prepareForRegExp';\nimport {\n  EmojiData, EmojiModule, EmojiRawData, uncompressEmoji,\n} from '../../../../util/emoji';\nimport focusEditableElement from '../../../../util/focusEditableElement';\nimport {\n  buildCollectionByKey, flatten, mapValues, pickTruthy, unique,\n} from '../../../../util/iteratees';\nimport useFlag from '../../../../hooks/useFlag';\n\nlet emojiDataPromise: Promise<EmojiModule>;\nlet emojiRawData: EmojiRawData;\nlet emojiData: EmojiData;\n\nlet RE_EMOJI_SEARCH: RegExp;\nconst EMOJIS_LIMIT = 36;\nconst FILTER_MIN_LENGTH = 2;\n\ntry {\n  RE_EMOJI_SEARCH = new RegExp('(^|\\\\s):[-+_:\\\\p{L}\\\\p{N}]*$', 'gui');\n} catch (e) {\n  // Support for older versions of firefox\n  RE_EMOJI_SEARCH = new RegExp('(^|\\\\s):[-+_:\\\\d\\\\w-]*$', 'gi');\n}\n\nexport default function useEmojiTooltip(\n  isAllowed: boolean,\n  html: string,\n  recentEmojiIds: string[],\n  inputId = EDITABLE_INPUT_ID,\n  onUpdateHtml: (html: string) => void,\n  baseEmojiKeywords?: Record<string, string[]>,\n  emojiKeywords?: Record<string, string[]>,\n  isDisabled = false,\n) {\n  const [isOpen, markIsOpen, unmarkIsOpen] = useFlag();\n\n  const [byId, setById] = useState<Record<string, Emoji> | undefined>();\n  const [keywords, setKeywords] = useState<string[]>();\n  const [byKeyword, setByKeyword] = useState<Record<string, Emoji[]>>({});\n  const [names, setNames] = useState<string[]>();\n  const [byName, setByName] = useState<Record<string, Emoji[]>>({});\n  const [shouldForceInsertEmoji, setShouldForceInsertEmoji] = useState(false);\n\n  const [filteredEmojis, setFilteredEmojis] = useState<Emoji[]>(MEMO_EMPTY_ARRAY);\n\n  const recentEmojis = useMemo(\n    () => {\n      if (!byId || !recentEmojiIds.length) {\n        return [];\n      }\n\n      return Object.values(pickTruthy(byId, recentEmojiIds));\n    },\n    [byId, recentEmojiIds],\n  );\n\n  // Initialize data on first render.\n  useEffect(() => {\n    if (isDisabled) return;\n    const exec = () => {\n      setById(emojiData.emojis);\n    };\n\n    if (emojiData) {\n      exec();\n    } else {\n      ensureEmojiData()\n        .then(exec);\n    }\n  }, [isDisabled]);\n\n  useEffect(() => {\n    if (!byId || isDisabled) {\n      return;\n    }\n\n    const emojis = Object.values(byId);\n\n    const byNative = buildCollectionByKey(emojis, 'native');\n    const baseEmojisByKeyword = baseEmojiKeywords\n      ? mapValues(baseEmojiKeywords, (natives) => {\n        return Object.values(pickTruthy(byNative, natives));\n      })\n      : {};\n    const emojisByKeyword = emojiKeywords\n      ? mapValues(emojiKeywords, (natives) => {\n        return Object.values(pickTruthy(byNative, natives));\n      })\n      : {};\n\n    setByKeyword({ ...baseEmojisByKeyword, ...emojisByKeyword });\n    setKeywords([...Object.keys(baseEmojisByKeyword), ...Object.keys(emojisByKeyword)]);\n\n    const emojisByName = emojis.reduce((result, emoji) => {\n      emoji.names.forEach((name) => {\n        if (!result[name]) {\n          result[name] = [];\n        }\n\n        result[name].push(emoji);\n      });\n\n      return result;\n    }, {} as Record<string, Emoji[]>);\n    setByName(emojisByName);\n    setNames(Object.keys(emojisByName));\n  }, [isDisabled, baseEmojiKeywords, byId, emojiKeywords]);\n\n  useEffect(() => {\n    if (!isAllowed || !html || !byId || !keywords || !keywords.length) {\n      unmarkIsOpen();\n      return;\n    }\n\n    const code = html.includes(':') && getEmojiCode(html);\n    if (!code) {\n      setFilteredEmojis(MEMO_EMPTY_ARRAY);\n      unmarkIsOpen();\n      return;\n    }\n\n    const forceSend = code.length > 2 && code.endsWith(':');\n    const filter = code.substr(1, forceSend ? code.length - 2 : undefined);\n    let matched: Emoji[] = [];\n\n    setShouldForceInsertEmoji(forceSend);\n\n    if (!filter) {\n      matched = recentEmojis;\n    } else if (filter.length >= FILTER_MIN_LENGTH) {\n      const matchedKeywords = keywords.filter((keyword) => keyword.startsWith(filter)).sort();\n      matched = matched.concat(flatten(Object.values(pickTruthy(byKeyword, matchedKeywords))));\n\n      // Also search by names, which is useful for non-English languages\n      const matchedNames = names.filter((name) => name.startsWith(filter));\n      matched = matched.concat(flatten(Object.values(pickTruthy(byName, matchedNames))));\n\n      matched = unique(matched);\n    }\n\n    if (matched.length) {\n      if (!forceSend) {\n        markIsOpen();\n      }\n      setFilteredEmojis(matched.slice(0, EMOJIS_LIMIT));\n    } else {\n      unmarkIsOpen();\n    }\n  }, [\n    byId, byKeyword, keywords, byName, names, html, isAllowed, markIsOpen,\n    recentEmojis, unmarkIsOpen, setShouldForceInsertEmoji,\n  ]);\n\n  const insertEmoji = useCallback((textEmoji: string, isForce?: boolean) => {\n    const atIndex = html.lastIndexOf(':', isForce ? html.lastIndexOf(':') - 1 : undefined);\n    if (atIndex !== -1) {\n      onUpdateHtml(`${html.substr(0, atIndex)}${textEmoji}`);\n      const messageInput = document.getElementById(inputId)!;\n      requestAnimationFrame(() => {\n        focusEditableElement(messageInput, true);\n      });\n    }\n\n    unmarkIsOpen();\n  }, [html, inputId, onUpdateHtml, unmarkIsOpen]);\n\n  useEffect(() => {\n    if (isOpen && shouldForceInsertEmoji && filteredEmojis.length) {\n      insertEmoji(filteredEmojis[0].native, true);\n    }\n  }, [filteredEmojis, insertEmoji, isOpen, shouldForceInsertEmoji]);\n\n  return {\n    isEmojiTooltipOpen: isOpen,\n    closeEmojiTooltip: unmarkIsOpen,\n    filteredEmojis,\n    insertEmoji,\n  };\n}\n\nfunction getEmojiCode(html: string) {\n  const emojis = prepareForRegExp(html).match(RE_EMOJI_SEARCH);\n\n  return emojis ? emojis[0].trim() : undefined;\n}\n\nasync function ensureEmojiData() {\n  if (!emojiDataPromise) {\n    emojiDataPromise = import('emoji-data-ios/emoji-data.json') as unknown as Promise<EmojiModule>;\n    emojiRawData = (await emojiDataPromise).default;\n\n    emojiData = uncompressEmoji(emojiRawData);\n  }\n\n  return emojiDataPromise;\n}\n","import { ApiUser } from '../../../../api/types';\nimport { getUserFullName } from '../../../../modules/helpers';\nimport searchWords from '../../../../util/searchWords';\n\n// TODO: Support cyrillic translit search\nexport default function searchUserName(filter: string, user: ApiUser) {\n  const usernameLowered = user.username.toLowerCase();\n  const fullName = getUserFullName(user);\n  const fullNameLowered = fullName && fullName.toLowerCase();\n  const filterLowered = filter.toLowerCase();\n\n  return usernameLowered.startsWith(filterLowered) || (\n    fullNameLowered && searchWords(fullNameLowered, filterLowered)\n  );\n}\n","import {\n  useCallback, useEffect, useState, useMemo,\n} from '../../../../lib/teact/teact';\n\nimport { ApiMessageEntityTypes, ApiChatMember, ApiUser } from '../../../../api/types';\nimport { EDITABLE_INPUT_ID } from '../../../../config';\nimport { getUserFirstOrLastName } from '../../../../modules/helpers';\nimport searchUserName from '../helpers/searchUserName';\nimport { prepareForRegExp } from '../helpers/prepareForRegExp';\nimport focusEditableElement from '../../../../util/focusEditableElement';\nimport useFlag from '../../../../hooks/useFlag';\nimport { unique } from '../../../../util/iteratees';\nimport { throttle } from '../../../../util/schedulers';\n\nconst runThrottled = throttle((cb) => cb(), 500, true);\nlet RE_USERNAME_SEARCH: RegExp;\n\ntry {\n  RE_USERNAME_SEARCH = new RegExp('(^|\\\\s)@[-_\\\\p{L}\\\\p{M}\\\\p{N}]*$', 'gui');\n} catch (e) {\n  // Support for older versions of firefox\n  RE_USERNAME_SEARCH = new RegExp('(^|\\\\s)@[-_\\\\d\\\\w-]*$', 'gi');\n}\n\nexport default function useMentionTooltip(\n  canSuggestMembers: boolean | undefined,\n  html: string,\n  onUpdateHtml: (html: string) => void,\n  inputId: string = EDITABLE_INPUT_ID,\n  groupChatMembers?: ApiChatMember[],\n  topInlineBotIds?: number[],\n  currentUserId?: number,\n  usersById?: Record<number, ApiUser>,\n) {\n  const [isOpen, markIsOpen, unmarkIsOpen] = useFlag();\n  const [usersToMention, setUsersToMention] = useState<ApiUser[] | undefined>();\n\n  const topInlineBots = useMemo(() => {\n    return (topInlineBotIds || []).map((id) => usersById?.[id]).filter<ApiUser>(Boolean as any);\n  }, [topInlineBotIds, usersById]);\n\n  const getFilteredUsers = useCallback((filter, withInlineBots: boolean) => {\n    if (!(groupChatMembers || topInlineBotIds) || !usersById) {\n      setUsersToMention(undefined);\n\n      return;\n    }\n    runThrottled(() => {\n      const inlineBots = (withInlineBots ? topInlineBots : []).filter((inlineBot) => {\n        return !filter || searchUserName(filter, inlineBot);\n      });\n\n      const chatMembers = (groupChatMembers || [])\n        .map(({ userId }) => usersById[userId])\n        .filter((user) => {\n          if (!user || user.id === currentUserId) {\n            return false;\n          }\n\n          return !filter || searchUserName(filter, user);\n        });\n\n      setUsersToMention(unique(inlineBots.concat(chatMembers)));\n    });\n  }, [currentUserId, groupChatMembers, topInlineBotIds, topInlineBots, usersById]);\n\n  useEffect(() => {\n    if (!canSuggestMembers || !html.length) {\n      unmarkIsOpen();\n      return;\n    }\n\n    const usernameFilter = html.includes('@') && getUsernameFilter(html);\n\n    if (usernameFilter) {\n      const filter = usernameFilter ? usernameFilter.substr(1) : '';\n      getFilteredUsers(filter, canSuggestInlineBots(html));\n    } else {\n      unmarkIsOpen();\n    }\n  }, [canSuggestMembers, html, getFilteredUsers, markIsOpen, unmarkIsOpen]);\n\n  useEffect(() => {\n    if (usersToMention?.length) {\n      markIsOpen();\n    } else {\n      unmarkIsOpen();\n    }\n  }, [markIsOpen, unmarkIsOpen, usersToMention]);\n\n  const insertMention = useCallback((user: ApiUser, forceFocus = false) => {\n    if (!user.username && !getUserFirstOrLastName(user)) {\n      return;\n    }\n\n    const insertedHtml = user.username\n      ? `@${user.username}`\n      : `<a\n          class=\"text-entity-link\"\n          data-entity-type=\"${ApiMessageEntityTypes.MentionName}\"\n          data-user-id=\"${user.id}\"\n          contenteditable=\"false\"\n          dir=\"auto\"\n        >${getUserFirstOrLastName(user)}</a>`;\n\n    const atIndex = html.lastIndexOf('@');\n    if (atIndex !== -1) {\n      onUpdateHtml(`${html.substr(0, atIndex)}${insertedHtml}&nbsp;`);\n      const messageInput = document.getElementById(inputId)!;\n      requestAnimationFrame(() => {\n        focusEditableElement(messageInput, forceFocus);\n      });\n    }\n\n    unmarkIsOpen();\n  }, [html, inputId, onUpdateHtml, unmarkIsOpen]);\n\n  return {\n    isMentionTooltipOpen: isOpen,\n    closeMentionTooltip: unmarkIsOpen,\n    insertMention,\n    mentionFilteredUsers: usersToMention,\n  };\n}\n\nfunction getUsernameFilter(html: string) {\n  const username = prepareForRegExp(html).match(RE_USERNAME_SEARCH);\n\n  return username ? username[0].trim() : undefined;\n}\n\nfunction canSuggestInlineBots(html: string) {\n  return html.startsWith('@');\n}\n","import { useEffect, useRef } from '../../../lib/teact/teact';\n\nimport useOnChange from '../../../hooks/useOnChange';\nimport useForceUpdate from '../../../hooks/useForceUpdate';\n\nexport default function useAsyncRendering<T extends any[]>(dependencies: T, delay?: number) {\n  const isDisabled = delay === undefined;\n  const shouldRenderRef = useRef(isDisabled);\n  const timeoutRef = useRef<number>();\n  const forceUpdate = useForceUpdate();\n\n  useOnChange(() => {\n    if (isDisabled) {\n      return;\n    }\n\n    shouldRenderRef.current = false;\n\n    if (timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n      timeoutRef.current = undefined;\n    }\n  }, dependencies);\n\n  useEffect(() => {\n    if (isDisabled || shouldRenderRef.current) {\n      return;\n    }\n\n    const exec = () => {\n      shouldRenderRef.current = true;\n      forceUpdate();\n    };\n\n    if (delay! > 0) {\n      timeoutRef.current = window.setTimeout(exec, delay);\n    } else {\n      exec();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, dependencies);\n\n  return shouldRenderRef.current;\n}\n","import React, { FC, memo } from '../../lib/teact/teact';\n\nimport useLang from '../../hooks/useLang';\nimport { TextPart } from '../common/helpers/renderMessageText';\n\nimport Modal from './Modal';\nimport Button from './Button';\n\ntype OwnProps = {\n  isOpen: boolean;\n  onClose: () => void;\n  onCloseAnimationEnd?: () => void;\n  title?: string;\n  header?: FC;\n  textParts?: TextPart[];\n  text?: string;\n  confirmLabel?: string;\n  confirmHandler: () => void;\n  confirmIsDestructive?: boolean;\n  isButtonsInOneRow?: boolean;\n};\n\nconst ConfirmDialog: FC<OwnProps> = ({\n  isOpen,\n  onClose,\n  onCloseAnimationEnd,\n  title,\n  header,\n  text,\n  textParts,\n  confirmLabel = 'Confirm',\n  confirmHandler,\n  confirmIsDestructive,\n  isButtonsInOneRow,\n}) => {\n  const lang = useLang();\n\n  return (\n    <Modal\n      className=\"confirm\"\n      title={title}\n      header={header}\n      isOpen={isOpen}\n      onClose={onClose}\n      onCloseAnimationEnd={onCloseAnimationEnd}\n      onEnter={confirmHandler}\n    >\n      {text && text.split('\\\\n').map((textPart) => (\n        <p>{textPart}</p>\n      ))}\n      {textParts}\n      <div className={isButtonsInOneRow ? 'dialog-buttons mt-2' : ''}>\n        <Button\n          className=\"confirm-dialog-button\"\n          isText\n          onClick={confirmHandler}\n          color={confirmIsDestructive ? 'danger' : 'primary'}\n        >\n          {confirmLabel}\n        </Button>\n        <Button className=\"confirm-dialog-button\" isText onClick={onClose}>{lang('Cancel')}</Button>\n      </div>\n    </Modal>\n  );\n};\n\nexport default memo(ConfirmDialog);\n","import React, { FC } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport Button, { OwnProps as ButtonProps } from './Button';\n\nimport './FloatingActionButton.scss';\n\ntype OwnProps = {\n  isShown: boolean;\n  className?: string;\n  color?: ButtonProps['color'];\n  ariaLabel?: ButtonProps['ariaLabel'];\n  disabled?: boolean;\n  onClick: () => void;\n  children: any;\n};\n\nconst FloatingActionButton: FC<OwnProps> = ({\n  isShown,\n  className,\n  color = 'primary',\n  ariaLabel,\n  disabled,\n  onClick,\n  children,\n}) => {\n  const buttonClassName = buildClassName(\n    'FloatingActionButton',\n    isShown && 'revealed',\n    className,\n  );\n\n  return (\n    <Button\n      className={buttonClassName}\n      color={color}\n      round\n      disabled={disabled}\n      onClick={isShown && !disabled ? onClick : undefined}\n      ariaLabel={ariaLabel}\n      tabIndex={-1}\n    >\n      {children}\n    </Button>\n  );\n};\n\nexport default FloatingActionButton;\n","import { RefObject, UIEvent } from 'react';\nimport { LoadMoreDirection } from '../../types';\n\nimport React, {\n  FC, useCallback, useEffect, useLayoutEffect, useMemo, useRef,\n} from '../../lib/teact/teact';\n\nimport { debounce } from '../../util/schedulers';\nimport resetScroll from '../../util/resetScroll';\n\ntype OwnProps = {\n  ref?: RefObject<HTMLDivElement>;\n  className?: string;\n  onLoadMore?: ({ direction }: { direction: LoadMoreDirection; noScroll?: boolean }) => void;\n  onScroll?: (e: UIEvent<HTMLDivElement>) => void;\n  onKeyDown?: (e: React.KeyboardEvent<any>) => void;\n  items?: any[];\n  itemSelector?: string;\n  preloadBackwards?: number;\n  sensitiveArea?: number;\n  noScrollRestore?: boolean;\n  noScrollRestoreOnTop?: boolean;\n  noFastList?: boolean;\n  cacheBuster?: any;\n  children: any;\n};\n\nconst DEFAULT_LIST_SELECTOR = '.ListItem';\nconst DEFAULT_PRELOAD_BACKWARDS = 20;\nconst DEFAULT_SENSITIVE_AREA = 800;\n\nconst InfiniteScroll: FC<OwnProps> = ({\n  ref,\n  className,\n  onLoadMore,\n  onScroll,\n  onKeyDown,\n  items,\n  itemSelector = DEFAULT_LIST_SELECTOR,\n  preloadBackwards = DEFAULT_PRELOAD_BACKWARDS,\n  sensitiveArea = DEFAULT_SENSITIVE_AREA,\n  // Used to turn off restoring scroll position (e.g. for frequently re-ordered chat or user lists)\n  noScrollRestore = false,\n  noScrollRestoreOnTop = false,\n  noFastList,\n  // Used to re-query `listItemElements` if rendering is delayed by transition\n  cacheBuster,\n  children,\n}: OwnProps) => {\n  // eslint-disable-next-line no-null/no-null\n  let containerRef = useRef<HTMLDivElement>(null);\n  if (ref) {\n    containerRef = ref;\n  }\n\n  const stateRef = useRef<{\n    listItemElements?: NodeListOf<HTMLDivElement>;\n    isScrollTopJustUpdated?: boolean;\n    currentAnchor?: HTMLDivElement | undefined;\n    currentAnchorTop?: number;\n  }>({});\n\n  const [loadMoreBackwards, loadMoreForwards] = useMemo(() => {\n    if (!onLoadMore) {\n      return [];\n    }\n\n    return [\n      debounce((noScroll = false) => {\n        onLoadMore({ direction: LoadMoreDirection.Backwards, noScroll });\n      }, 1000, true, false),\n      debounce(() => {\n        onLoadMore({ direction: LoadMoreDirection.Forwards });\n      }, 1000, true, false),\n    ];\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [onLoadMore, items]);\n\n  // Initial preload\n  useEffect(() => {\n    if (!loadMoreBackwards) {\n      return;\n    }\n\n    if (preloadBackwards > 0 && (!items || items.length < preloadBackwards)) {\n      loadMoreBackwards(true);\n      return;\n    }\n\n    const { scrollHeight, clientHeight } = containerRef.current!;\n    if (clientHeight && scrollHeight <= clientHeight) {\n      loadMoreBackwards();\n    }\n  }, [items, loadMoreBackwards, preloadBackwards]);\n\n  // Restore `scrollTop` after adding items\n  useLayoutEffect(() => {\n    const container = containerRef.current!;\n    const state = stateRef.current;\n\n    state.listItemElements = container.querySelectorAll<HTMLDivElement>(itemSelector);\n\n    let newScrollTop;\n\n    if (state.currentAnchor && Array.from(state.listItemElements).includes(state.currentAnchor)) {\n      const { scrollTop } = container;\n      const newAnchorTop = state.currentAnchor.getBoundingClientRect().top;\n      newScrollTop = scrollTop + (newAnchorTop - state.currentAnchorTop!);\n    } else {\n      const nextAnchor = state.listItemElements[0];\n      if (nextAnchor) {\n        state.currentAnchor = nextAnchor;\n        state.currentAnchorTop = nextAnchor.getBoundingClientRect().top;\n      }\n    }\n\n    if (noScrollRestore) {\n      return;\n    }\n\n    if (noScrollRestoreOnTop && container.scrollTop === 0) {\n      return;\n    }\n\n    resetScroll(container, newScrollTop);\n\n    state.isScrollTopJustUpdated = true;\n  }, [items, itemSelector, noScrollRestore, noScrollRestoreOnTop, cacheBuster]);\n\n  const handleScroll = useCallback((e: UIEvent<HTMLDivElement>) => {\n    if (loadMoreForwards && loadMoreBackwards) {\n      const {\n        isScrollTopJustUpdated, currentAnchor, currentAnchorTop,\n      } = stateRef.current;\n      const listItemElements = stateRef.current.listItemElements!;\n\n      if (isScrollTopJustUpdated) {\n        stateRef.current.isScrollTopJustUpdated = false;\n        return;\n      }\n\n      const listLength = listItemElements.length;\n      const container = containerRef.current!;\n      const { scrollTop, scrollHeight, offsetHeight } = container;\n      const top = listLength ? listItemElements[0].offsetTop : 0;\n      const isNearTop = scrollTop <= top + sensitiveArea;\n      const bottom = listLength\n        ? listItemElements[listLength - 1].offsetTop + listItemElements[listLength - 1].offsetHeight\n        : scrollHeight;\n      const isNearBottom = bottom - (scrollTop + offsetHeight) <= sensitiveArea;\n      let isUpdated = false;\n\n      if (isNearTop) {\n        const nextAnchor = listItemElements[0];\n        if (nextAnchor) {\n          const nextAnchorTop = nextAnchor.getBoundingClientRect().top;\n          const newAnchorTop = currentAnchor?.offsetParent && currentAnchor !== nextAnchor\n            ? currentAnchor.getBoundingClientRect().top\n            : nextAnchorTop;\n          const isMovingUp = (\n            currentAnchor && currentAnchorTop !== undefined && newAnchorTop > currentAnchorTop\n          );\n\n          if (isMovingUp) {\n            stateRef.current.currentAnchor = nextAnchor;\n            stateRef.current.currentAnchorTop = nextAnchorTop;\n            isUpdated = true;\n            resetScroll(container);\n            loadMoreForwards();\n          }\n        }\n      }\n\n      if (isNearBottom) {\n        const nextAnchor = listItemElements[listLength - 1];\n        if (nextAnchor) {\n          const nextAnchorTop = nextAnchor.getBoundingClientRect().top;\n          const newAnchorTop = currentAnchor?.offsetParent && currentAnchor !== nextAnchor\n            ? currentAnchor.getBoundingClientRect().top\n            : nextAnchorTop;\n          const isMovingDown = (\n            currentAnchor && currentAnchorTop !== undefined && newAnchorTop < currentAnchorTop\n          );\n\n          if (isMovingDown) {\n            stateRef.current.currentAnchor = nextAnchor;\n            stateRef.current.currentAnchorTop = nextAnchorTop;\n            isUpdated = true;\n            resetScroll(container);\n            loadMoreBackwards();\n          }\n        }\n      }\n\n      if (!isUpdated) {\n        if (currentAnchor?.offsetParent) {\n          stateRef.current.currentAnchorTop = currentAnchor.getBoundingClientRect().top;\n        } else {\n          const nextAnchor = listItemElements[0];\n\n          if (nextAnchor) {\n            stateRef.current.currentAnchor = nextAnchor;\n            stateRef.current.currentAnchorTop = nextAnchor.getBoundingClientRect().top;\n          }\n        }\n      }\n    }\n\n    if (onScroll) {\n      onScroll(e);\n    }\n  }, [loadMoreBackwards, loadMoreForwards, onScroll, sensitiveArea]);\n\n  return (\n    <div\n      ref={containerRef}\n      className={className}\n      onScroll={handleScroll}\n      teactFastList={!noFastList}\n      onKeyDown={onKeyDown}\n    >\n      {children}\n    </div>\n  );\n};\n\nexport default InfiniteScroll;\n","import { RefObject } from 'react';\nimport React, { FC, useRef, useCallback } from '../../lib/teact/teact';\n\nimport { IS_TOUCH_ENV } from '../../util/environment';\nimport { fastRaf } from '../../util/schedulers';\nimport buildClassName from '../../util/buildClassName';\nimport useContextMenuHandlers from '../../hooks/useContextMenuHandlers';\nimport useContextMenuPosition from '../../hooks/useContextMenuPosition';\nimport useFlag from '../../hooks/useFlag';\nimport useLang from '../../hooks/useLang';\n\nimport RippleEffect from './RippleEffect';\nimport Menu from './Menu';\nimport MenuItem from './MenuItem';\n\nimport './ListItem.scss';\n\ninterface MenuItemContextAction {\n  title: string;\n  icon: string;\n  destructive?: boolean;\n  handler?: () => void;\n}\n\ninterface OwnProps {\n  ref?: RefObject<HTMLDivElement>;\n  buttonRef?: RefObject<HTMLDivElement>;\n  icon?: string;\n  className?: string;\n  style?: string;\n  children: any;\n  disabled?: boolean;\n  ripple?: boolean;\n  narrow?: boolean;\n  inactive?: boolean;\n  focus?: boolean;\n  destructive?: boolean;\n  multiline?: boolean;\n  isStatic?: boolean;\n  contextActions?: MenuItemContextAction[];\n  onMouseDown?: (e: React.MouseEvent<HTMLDivElement>) => void;\n  onClick?: (e: React.MouseEvent<HTMLDivElement>) => void;\n}\n\nconst ListItem: FC<OwnProps> = (props) => {\n  const {\n    ref,\n    buttonRef,\n    icon,\n    className,\n    style,\n    children,\n    disabled,\n    ripple,\n    narrow,\n    inactive,\n    focus,\n    destructive,\n    multiline,\n    isStatic,\n    contextActions,\n    onMouseDown,\n    onClick,\n  } = props;\n\n  // eslint-disable-next-line no-null/no-null\n  let containerRef = useRef<HTMLDivElement>(null);\n  if (ref) {\n    containerRef = ref;\n  }\n  const [isTouched, markIsTouched, unmarkIsTouched] = useFlag();\n\n  const {\n    isContextMenuOpen, contextMenuPosition,\n    handleBeforeContextMenu, handleContextMenu,\n    handleContextMenuClose, handleContextMenuHide,\n  } = useContextMenuHandlers(containerRef, !contextActions);\n\n  const getTriggerElement = useCallback(() => containerRef.current, []);\n\n  const getRootElement = useCallback(\n    () => containerRef.current!.closest('.custom-scroll'),\n    [],\n  );\n\n  const getMenuElement = useCallback(\n    () => containerRef.current!.querySelector('.ListItem-context-menu .bubble'),\n    [],\n  );\n\n  const { positionX, positionY, style: menuStyle } = useContextMenuPosition(\n    contextMenuPosition,\n    getTriggerElement,\n    getRootElement,\n    getMenuElement,\n  );\n\n  const handleClick = useCallback((e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    if (disabled || !onClick) {\n      return;\n    }\n    onClick(e);\n\n    if (IS_TOUCH_ENV && !ripple) {\n      markIsTouched();\n      fastRaf(unmarkIsTouched);\n    }\n  }, [disabled, markIsTouched, onClick, ripple, unmarkIsTouched]);\n\n  const handleMouseDown = useCallback((e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    if (inactive || IS_TOUCH_ENV) {\n      return;\n    }\n    if (contextActions && (e.button === 2 || !onClick)) {\n      handleBeforeContextMenu(e);\n    }\n    if (e.button === 0) {\n      if (!onClick) {\n        handleContextMenu(e);\n      } else {\n        handleClick(e);\n      }\n    }\n  }, [inactive, contextActions, onClick, handleBeforeContextMenu, handleContextMenu, handleClick]);\n\n  const lang = useLang();\n\n  const fullClassName = buildClassName(\n    'ListItem',\n    className,\n    !isStatic && 'no-selection',\n    ripple && 'has-ripple',\n    narrow && 'narrow',\n    disabled && 'disabled',\n    inactive && 'inactive',\n    contextMenuPosition && 'has-menu-open',\n    focus && 'focus',\n    destructive && 'destructive',\n    multiline && 'multiline',\n    isStatic && 'is-static',\n  );\n\n  return (\n    <div\n      ref={containerRef}\n      className={fullClassName}\n      dir={lang.isRtl ? 'rtl' : undefined}\n      // @ts-ignore\n      style={style}\n      onMouseDown={onMouseDown}\n    >\n      <div\n        className={buildClassName('ListItem-button', isTouched && 'active')}\n        role=\"button\"\n        ref={buttonRef}\n        tabIndex={0}\n        onClick={!inactive && IS_TOUCH_ENV ? handleClick : undefined}\n        onMouseDown={handleMouseDown}\n        onContextMenu={!inactive && contextActions ? handleContextMenu : undefined}\n      >\n        {icon && (\n          <i className={`icon-${icon}`} />\n        )}\n        {multiline && (<div className=\"multiline-item\">{children}</div>)}\n        {!multiline && children}\n        {!disabled && !inactive && ripple && (\n          <RippleEffect />\n        )}\n      </div>\n      {contextActions && contextMenuPosition !== undefined && (\n        <Menu\n          isOpen={isContextMenuOpen}\n          positionX={positionX}\n          positionY={positionY}\n          style={menuStyle}\n          className=\"ListItem-context-menu\"\n          autoClose\n          onClose={handleContextMenuClose}\n          onCloseAnimationEnd={handleContextMenuHide}\n        >\n          {contextActions.map((action) => (\n            <MenuItem\n              key={action.title}\n              icon={action.icon}\n              destructive={action.destructive}\n              disabled={!action.handler}\n              onClick={action.handler}\n            >\n              {action.title}\n            </MenuItem>\n          ))}\n        </Menu>\n      )}\n    </div>\n  );\n};\n\nexport default ListItem;\n","import React, {\n  FC, useEffect, useRef,\n} from '../../lib/teact/teact';\n\nimport { TextPart } from '../common/helpers/renderMessageText';\n\nimport captureKeyboardListeners from '../../util/captureKeyboardListeners';\nimport trapFocus from '../../util/trapFocus';\nimport buildClassName from '../../util/buildClassName';\nimport { dispatchHeavyAnimationEvent } from '../../hooks/useHeavyAnimationCheck';\nimport useShowTransition from '../../hooks/useShowTransition';\nimport useEffectWithPrevDeps from '../../hooks/useEffectWithPrevDeps';\nimport useLang from '../../hooks/useLang';\nimport useHistoryBack from '../../hooks/useHistoryBack';\n\nimport Button from './Button';\nimport Portal from './Portal';\n\nimport './Modal.scss';\n\nconst ANIMATION_DURATION = 200;\n\ntype OwnProps = {\n  title?: string | TextPart[];\n  className?: string;\n  isOpen?: boolean;\n  header?: any;\n  hasCloseButton?: boolean;\n  noBackdrop?: boolean;\n  children: any;\n  onClose: () => void;\n  onCloseAnimationEnd?: () => void;\n  onEnter?: () => void;\n};\n\ntype StateProps = {\n  shouldSkipHistoryAnimations?: boolean;\n};\n\nconst Modal: FC<OwnProps & StateProps> = ({\n  title,\n  className,\n  isOpen,\n  header,\n  hasCloseButton,\n  noBackdrop,\n  children,\n  onClose,\n  onCloseAnimationEnd,\n  onEnter,\n  shouldSkipHistoryAnimations,\n}) => {\n  const {\n    shouldRender,\n    transitionClassNames,\n  } = useShowTransition(\n    isOpen, onCloseAnimationEnd, shouldSkipHistoryAnimations, undefined, shouldSkipHistoryAnimations,\n  );\n  // eslint-disable-next-line no-null/no-null\n  const modalRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => (isOpen\n    ? captureKeyboardListeners({ onEsc: onClose, onEnter })\n    : undefined), [isOpen, onClose, onEnter]);\n  useEffect(() => (isOpen && modalRef.current ? trapFocus(modalRef.current) : undefined), [isOpen]);\n\n  const { forceClose } = useHistoryBack(isOpen, onClose);\n\n  // For modals that are closed by unmounting without changing `isOpen` to `false`\n  useEffect(() => {\n    return () => {\n      if (isOpen) {\n        forceClose();\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffectWithPrevDeps(([prevIsOpen]) => {\n    document.body.classList.toggle('has-open-dialog', isOpen);\n\n    if (isOpen || (!isOpen && prevIsOpen !== undefined)) {\n      dispatchHeavyAnimationEvent(ANIMATION_DURATION);\n    }\n\n    return () => {\n      document.body.classList.remove('has-open-dialog');\n    };\n  }, [isOpen]);\n\n  const lang = useLang();\n\n  if (!shouldRender) {\n    return undefined;\n  }\n\n  function renderHeader() {\n    if (header) {\n      return header;\n    }\n\n    if (!title) {\n      return undefined;\n    }\n\n    return (\n      <div className=\"modal-header\">\n        {hasCloseButton && (\n          <Button\n            round\n            color=\"translucent\"\n            size=\"smaller\"\n            ariaLabel={lang('Close')}\n            onClick={onClose}\n          >\n            <i className=\"icon-close\" />\n          </Button>\n        )}\n        <div className=\"modal-title\">{title}</div>\n      </div>\n    );\n  }\n\n  const fullClassName = buildClassName(\n    'Modal',\n    className,\n    transitionClassNames,\n    noBackdrop && 'transparent-backdrop',\n  );\n\n  return (\n    <Portal>\n      <div\n        ref={modalRef}\n        className={fullClassName}\n        tabIndex={-1}\n        role=\"dialog\"\n      >\n        <div className=\"modal-container\">\n          <div className=\"modal-backdrop\" onClick={onClose} />\n          <div className=\"modal-dialog\">\n            {renderHeader()}\n            <div className=\"modal-content custom-scroll\">\n              {children}\n            </div>\n          </div>\n        </div>\n      </div>\n    </Portal>\n  );\n};\n\nexport default Modal;\n","export default function trapFocus(element: HTMLElement) {\n  function handleKeyDown(e: KeyboardEvent) {\n    if (e.key !== 'Tab') {\n      return;\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n\n    const focusableElements = Array.from(\n      element.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'),\n    ) as HTMLElement[];\n    if (!focusableElements.length) {\n      return;\n    }\n\n    const currentFocusedIndex = focusableElements.findIndex((em) => em.isSameNode(document.activeElement));\n    let newFocusedIndex = 0;\n    if (currentFocusedIndex >= 0) {\n      if (e.shiftKey) {\n        newFocusedIndex = currentFocusedIndex > 0\n          ? currentFocusedIndex - 1\n          : focusableElements.length - 1;\n      } else {\n        newFocusedIndex = currentFocusedIndex < focusableElements.length - 1\n          ? currentFocusedIndex + 1\n          : 0;\n      }\n    }\n\n    focusableElements[newFocusedIndex].focus();\n  }\n\n  document.addEventListener('keydown', handleKeyDown, false);\n\n  return () => {\n    document.removeEventListener('keydown', handleKeyDown, false);\n  };\n}\n","import React, {\n  FC,\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from '../../lib/teact/teact';\n\nimport { ANIMATION_END_DELAY } from '../../config';\nimport useShowTransition from '../../hooks/useShowTransition';\nimport { TextPart } from '../common/helpers/renderMessageText';\nimport buildClassName from '../../util/buildClassName';\nimport captureEscKeyListener from '../../util/captureEscKeyListener';\n\nimport Portal from './Portal';\n\nimport './Notification.scss';\n\ntype OwnProps = {\n  containerId?: string;\n  message: TextPart[];\n  duration?: number;\n  onDismiss: () => void;\n};\n\nconst DEFAULT_DURATION = 3000;\nconst ANIMATION_DURATION = 150;\n\nconst Notification: FC<OwnProps> = ({\n  message, duration = DEFAULT_DURATION, containerId, onDismiss,\n}) => {\n  const [isOpen, setIsOpen] = useState(true);\n  // eslint-disable-next-line no-null/no-null\n  const timerRef = useRef<number | undefined>(null);\n\n  const { transitionClassNames } = useShowTransition(isOpen);\n\n  const closeAndDismiss = useCallback(() => {\n    setIsOpen(false);\n    setTimeout(onDismiss, ANIMATION_DURATION + ANIMATION_END_DELAY);\n  }, [onDismiss]);\n\n  useEffect(() => (isOpen ? captureEscKeyListener(closeAndDismiss) : undefined), [isOpen, closeAndDismiss]);\n\n  useEffect(() => {\n    timerRef.current = window.setTimeout(closeAndDismiss, duration);\n\n    return () => {\n      if (timerRef.current) {\n        clearTimeout(timerRef.current);\n        timerRef.current = undefined;\n      }\n    };\n  }, [duration, closeAndDismiss]);\n\n  const handleMouseEnter = useCallback(() => {\n    if (timerRef.current) {\n      clearTimeout(timerRef.current);\n      timerRef.current = undefined;\n    }\n  }, []);\n\n  const handleMouseLeave = useCallback(() => {\n    timerRef.current = window.setTimeout(closeAndDismiss, duration);\n  }, [duration, closeAndDismiss]);\n\n  return (\n    <Portal className=\"Notification-container\" containerId={containerId}>\n      <div\n        className={buildClassName('Notification', transitionClassNames)}\n        onClick={closeAndDismiss}\n        onMouseEnter={handleMouseEnter}\n        onMouseLeave={handleMouseLeave}\n      >\n        <div className=\"content\">\n          {message}\n        </div>\n      </div>\n    </Portal>\n  );\n};\n\nexport default Notification;\n","import { FC, useRef, useLayoutEffect } from '../../lib/teact/teact';\nimport TeactDOM from '../../lib/teact/teact-dom';\n\ntype OwnProps = {\n  containerId?: string;\n  className?: string;\n  children: any;\n};\n\nconst Portal: FC<OwnProps> = ({ containerId, className, children }) => {\n  const elementRef = useRef<HTMLDivElement>();\n  if (!elementRef.current) {\n    elementRef.current = document.createElement('div');\n  }\n\n  useLayoutEffect(() => {\n    const container = document.querySelector<HTMLDivElement>(containerId || '#portals');\n    if (!container) {\n      return undefined;\n    }\n\n    const element = elementRef.current!;\n    if (className) {\n      element.classList.add(className);\n    }\n\n    container.appendChild(element);\n\n    return () => {\n      TeactDOM.render(undefined, element);\n      container.removeChild(element);\n    };\n  }, [className, containerId]);\n\n  return TeactDOM.render(children, elementRef.current);\n};\n\nexport default Portal;\n","import React, {\n  FC, useEffect, useRef, memo,\n} from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport './ProgressSpinner.scss';\n\nconst RADIUSES = {\n  s: 22, m: 25, l: 28, xl: 20,\n};\nconst STROKE_WIDTH = 2;\nconst MIN_PROGRESS = 0.05;\nconst MAX_PROGRESS = 1;\n\nconst ProgressSpinner: FC<{\n  progress?: number;\n  size?: 's' | 'm' | 'l' | 'xl';\n  square?: boolean;\n  transparent?: boolean;\n  noCross?: boolean;\n  onClick?: (e: React.MouseEvent<HTMLElement, MouseEvent>) => void;\n}> = ({\n  progress = 0,\n  size = 'l',\n  square,\n  transparent,\n  noCross,\n  onClick,\n}) => {\n  const radius = RADIUSES[size];\n  const circleRadius = radius - STROKE_WIDTH * 2;\n  const borderRadius = radius - 1;\n  const circumference = circleRadius * 2 * Math.PI;\n  // eslint-disable-next-line no-null/no-null\n  const container = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (!container.current) {\n      return;\n    }\n\n    const svg = container.current.firstElementChild;\n    const strokeDashOffset = circumference - Math.min(Math.max(MIN_PROGRESS, progress), MAX_PROGRESS) * circumference;\n\n    if (!svg) {\n      container.current.innerHTML = `<svg\n        viewBox=\"0 0 ${borderRadius * 2} ${borderRadius * 2}\"\n        height=\"${borderRadius * 2}\"\n        width=\"${borderRadius * 2}\"\n      >\n        <circle\n          stroke=\"white\"\n          fill=\"transparent\"\n          stroke-width=${STROKE_WIDTH}\n          stroke-dasharray=\"${circumference} ${circumference}\"}\n          stroke-dashoffset=\"${strokeDashOffset}\"\n          stroke-linecap=\"round\"\n          r=${circleRadius}\n          cx=${borderRadius}\n          cy=${borderRadius}\n        />\n      </svg>`;\n    } else {\n      (svg.firstElementChild as SVGElement).setAttribute('stroke-dashoffset', strokeDashOffset.toString());\n    }\n  }, [container, circumference, borderRadius, circleRadius, progress]);\n\n  const className = buildClassName(\n    `ProgressSpinner size-${size}`,\n    transparent && 'transparent',\n    square && 'square',\n    noCross && 'no-cross',\n  );\n\n  return (\n    <div\n      ref={container}\n      className={className}\n      onClick={onClick}\n    />\n  );\n};\n\nexport default memo(ProgressSpinner);\n","import { ChangeEvent } from 'react';\nimport React, { FC, memo } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\nimport useLang from '../../hooks/useLang';\n\nimport Spinner from './Spinner';\n\nimport './Radio.scss';\n\ntype OwnProps = {\n  id?: string;\n  name: string;\n  label: string;\n  subLabel?: string;\n  value: string;\n  checked: boolean;\n  disabled?: boolean;\n  hidden?: boolean;\n  isLoading?: boolean;\n  onChange: (e: ChangeEvent<HTMLInputElement>) => void;\n};\n\nconst Radio: FC<OwnProps> = ({\n  id,\n  label,\n  subLabel,\n  value,\n  name,\n  checked,\n  disabled,\n  hidden,\n  isLoading,\n  onChange,\n}) => {\n  const lang = useLang();\n  const className = buildClassName(\n    'Radio',\n    disabled && 'disabled',\n    hidden && 'hidden-widget',\n    isLoading && 'loading',\n  );\n\n  return (\n    <label className={className} dir={lang.isRtl ? 'rtl' : undefined}>\n      <input\n        type=\"radio\"\n        name={name}\n        value={value}\n        id={id}\n        checked={checked}\n        onChange={onChange}\n        disabled={disabled || hidden}\n      />\n      <div className=\"Radio-main\">\n        <span className=\"label\" dir={lang.isRtl ? 'auto' : undefined}>{label}</span>\n        {subLabel && <span className=\"subLabel\" dir={lang.isRtl ? 'auto' : undefined}>{subLabel}</span>}\n      </div>\n      {isLoading && <Spinner />}\n    </label>\n  );\n};\n\nexport default memo(Radio);\n","import { ChangeEvent } from 'react';\nimport React, { FC, useCallback, memo } from '../../lib/teact/teact';\n\nimport Radio from './Radio';\n\ntype IRadioOption = {\n  label: string;\n  subLabel?: string;\n  value: string;\n  hidden?: boolean;\n};\n\ntype OwnProps = {\n  id?: string;\n  name: string;\n  options: IRadioOption[];\n  selected?: string;\n  disabled?: boolean;\n  loadingOption?: string;\n  onChange: (value: string) => void;\n};\n\nconst RadioGroup: FC<OwnProps> = ({\n  id,\n  name,\n  options,\n  selected,\n  disabled,\n  loadingOption,\n  onChange,\n}) => {\n  const handleChange = useCallback((event: ChangeEvent<HTMLInputElement>) => {\n    const { value } = event.currentTarget;\n    onChange(value);\n  }, [onChange]);\n\n  return (\n    <div id={id} className=\"radio-group\">\n      {options.map((option) => (\n        <Radio\n          name={name}\n          label={option.label}\n          subLabel={option.subLabel}\n          value={option.value}\n          checked={option.value === selected}\n          hidden={option.hidden}\n          disabled={disabled}\n          isLoading={loadingOption ? loadingOption === option.value : undefined}\n          onChange={handleChange}\n        />\n      ))}\n    </div>\n  );\n};\n\nexport default memo(RadioGroup);\n","import { RefObject } from 'react';\nimport React, {\n  FC, useRef, useEffect, memo, useCallback,\n} from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\nimport useFlag from '../../hooks/useFlag';\nimport useLang from '../../hooks/useLang';\n\nimport Loading from './Loading';\nimport Button from './Button';\n\nimport './SearchInput.scss';\n\ntype OwnProps = {\n  ref?: RefObject<HTMLInputElement>;\n  children?: any;\n  parentContainerClassName?: string;\n  className?: string;\n  inputId?: string;\n  value?: string;\n  focused?: boolean;\n  isLoading?: boolean;\n  placeholder?: string;\n  disabled?: boolean;\n  autoComplete?: string;\n  canClose?: boolean;\n  onChange: (value: string) => void;\n  onReset?: NoneToVoidFunction;\n  onFocus?: NoneToVoidFunction;\n  onBlur?: NoneToVoidFunction;\n};\n\nconst SearchInput: FC<OwnProps> = ({\n  ref,\n  children,\n  parentContainerClassName,\n  value,\n  inputId,\n  className,\n  focused,\n  isLoading,\n  placeholder,\n  disabled,\n  autoComplete,\n  canClose,\n  onChange,\n  onReset,\n  onFocus,\n  onBlur,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  let inputRef = useRef<HTMLInputElement>(null);\n  if (ref) {\n    inputRef = ref;\n  }\n\n  const [isInputFocused, markInputFocused, unmarkInputFocused] = useFlag(focused);\n\n  useEffect(() => {\n    if (!inputRef.current) {\n      return;\n    }\n\n    if (focused) {\n      inputRef.current.focus();\n    } else {\n      inputRef.current.blur();\n    }\n  }, [focused, placeholder]); // Trick for setting focus when selecting a contact to search for\n\n  const lang = useLang();\n\n  function handleChange(event: React.ChangeEvent<HTMLInputElement>) {\n    const { currentTarget } = event;\n    onChange(currentTarget.value);\n  }\n\n  function handleFocus() {\n    markInputFocused();\n    if (onFocus) {\n      onFocus();\n    }\n  }\n\n  function handleBlur() {\n    unmarkInputFocused();\n    if (onBlur) {\n      onBlur();\n    }\n  }\n\n  const handleKeyDown = useCallback((e: React.KeyboardEvent) => {\n    if (e.key === 'ArrowDown' || e.key === 'Enter') {\n      const element = document.querySelector(`.${parentContainerClassName} .ListItem-button`) as HTMLElement;\n      if (element) {\n        element.focus();\n      }\n    }\n  }, [parentContainerClassName]);\n\n  return (\n    <div\n      className={buildClassName('SearchInput', className, isInputFocused && 'has-focus')}\n      dir={lang.isRtl ? 'rtl' : undefined}\n    >\n      {children}\n      <input\n        ref={inputRef}\n        id={inputId}\n        type=\"text\"\n        dir=\"auto\"\n        placeholder={placeholder || lang('Search')}\n        className=\"form-control\"\n        value={value}\n        disabled={disabled}\n        autoComplete={autoComplete}\n        onChange={handleChange}\n        onFocus={handleFocus}\n        onBlur={handleBlur}\n        onKeyDown={handleKeyDown}\n      />\n      <i className=\"icon-search\" />\n      {isLoading && (\n        <Loading />\n      )}\n      {!isLoading && (value || canClose) && onReset && (\n        <Button\n          round\n          size=\"tiny\"\n          color=\"translucent\"\n          onClick={onReset}\n        >\n          <span className=\"icon-close\" />\n        </Button>\n      )}\n    </div>\n  );\n};\n\nexport default memo(SearchInput);\n","import React, { FC, useRef } from '../../lib/teact/teact';\n\nimport useShowTransition from '../../hooks/useShowTransition';\nimport usePrevious from '../../hooks/usePrevious';\nimport buildClassName from '../../util/buildClassName';\n\ntype ChildrenFn = () => any;\n\ntype OwnProps = {\n  isOpen: boolean;\n  isCustom?: boolean;\n  id?: string;\n  className?: string;\n  onClick?: (e: React.MouseEvent<HTMLElement, MouseEvent>) => void;\n  children: ChildrenFn;\n};\n\nconst ShowTransition: FC<OwnProps> = ({\n  isOpen, isCustom, id, className, onClick, children,\n}) => {\n  const { shouldRender, transitionClassNames } = useShowTransition(\n    isOpen, undefined, undefined, isCustom ? false : undefined,\n  );\n  const prevIsOpen = usePrevious(isOpen);\n  const prevChildren = usePrevious(children);\n  const fromChildrenRef = useRef<ChildrenFn>();\n\n  if (prevIsOpen && !isOpen) {\n    fromChildrenRef.current = prevChildren;\n  }\n\n  return (\n    shouldRender && (\n      <div id={id} className={buildClassName(className, transitionClassNames)} onClick={onClick}>\n        {isOpen ? children() : fromChildrenRef.current!()}\n      </div>\n    )\n  );\n};\n\nexport default ShowTransition;\n","import { ChangeEvent } from 'react';\nimport React, { FC, memo, useCallback } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport './Switcher.scss';\n\ntype OwnProps = {\n  id?: string;\n  name?: string;\n  value?: string;\n  label: string;\n  checked?: boolean;\n  disabled?: boolean;\n  inactive?: boolean;\n  noAnimation?: boolean;\n  onChange?: (e: ChangeEvent<HTMLInputElement>) => void;\n  onCheck?: (isChecked: boolean) => void;\n};\n\nconst Switcher: FC<OwnProps> = ({\n  id,\n  name,\n  value,\n  label,\n  checked = false,\n  disabled,\n  inactive,\n  noAnimation,\n  onChange,\n  onCheck,\n}) => {\n  const handleChange = useCallback((e: ChangeEvent<HTMLInputElement>) => {\n    if (onChange) {\n      onChange(e);\n    }\n\n    if (onCheck) {\n      onCheck(e.currentTarget.checked);\n    }\n  }, [onChange, onCheck]);\n\n  const className = buildClassName(\n    'Switcher',\n    disabled && 'disabled',\n    inactive && 'inactive',\n    noAnimation && 'no-animation',\n  );\n\n  return (\n    <label className={className} title={label}>\n      <input\n        type=\"checkbox\"\n        id={id}\n        name={name}\n        value={value}\n        checked={checked}\n        disabled={disabled}\n        onChange={handleChange}\n      />\n      <span className=\"widget\" />\n    </label>\n  );\n};\n\nexport default memo(Switcher);\n","import React, {\n  FC, useLayoutEffect, useRef, memo,\n} from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\nimport renderText from '../common/helpers/renderText';\n\nimport './Tab.scss';\n\ntype OwnProps = {\n  className?: string;\n  title: string;\n  active?: boolean;\n  badgeCount?: number;\n  isBadgeActive?: boolean;\n  previousActiveTab?: number;\n  onClick: (arg: number) => void;\n  clickArg: number;\n};\n\nconst Tab: FC<OwnProps> = ({\n  className,\n  title,\n  active,\n  badgeCount,\n  isBadgeActive,\n  previousActiveTab,\n  onClick,\n  clickArg,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const tabRef = useRef<HTMLButtonElement>(null);\n\n  useLayoutEffect(() => {\n    if (!active || previousActiveTab === undefined) {\n      return;\n    }\n\n    const tab = tabRef.current!;\n    const indicator = tab.querySelector('i')!;\n    const prevTab = tab.parentElement!.children[previousActiveTab];\n    if (!prevTab) {\n      return;\n    }\n    const currentIndicator = prevTab.querySelector('i')!;\n\n    currentIndicator.classList.remove('animate');\n    indicator.classList.remove('animate');\n\n    // We move and resize our indicator so it repeats the position and size of the previous one.\n    const shiftLeft = currentIndicator.parentElement!.offsetLeft - indicator.parentElement!.offsetLeft;\n    const scaleFactor = currentIndicator.clientWidth / indicator.clientWidth;\n    indicator.style.transform = `translate3d(${shiftLeft}px, 0, 0) scale3d(${scaleFactor}, 1, 1)`;\n\n    // 3 AFs needed here to synchronize animations with Transition component\n    requestAnimationFrame(() => {\n      requestAnimationFrame(() => {\n        requestAnimationFrame(() => {\n          // Now we remove the transform to let it animate to its own position and size.\n          indicator.classList.add('animate');\n          indicator.style.transform = 'none';\n        });\n      });\n    });\n  }, [active, previousActiveTab]);\n\n  return (\n    <button\n      type=\"button\"\n      className={buildClassName('Tab', className, active && 'active')}\n      onClick={() => onClick(clickArg)}\n      ref={tabRef}\n    >\n      <span>\n        {renderText(title)}\n        {!!badgeCount && (\n          <span className={buildClassName('badge', isBadgeActive && 'active')}>{badgeCount}</span>\n        )}\n        <i />\n      </span>\n    </button>\n  );\n};\n\nexport default memo(Tab);\n","import React, {\n  FC, memo, useRef, useEffect,\n} from '../../lib/teact/teact';\n\nimport fastSmoothScrollHorizontal from '../../util/fastSmoothScrollHorizontal';\nimport usePrevious from '../../hooks/usePrevious';\nimport useHorizontalScroll from '../../hooks/useHorizontalScroll';\nimport useLang from '../../hooks/useLang';\n\nimport Tab from './Tab';\n\nimport './TabList.scss';\n\nexport type TabWithProperties = {\n  title: string;\n  badgeCount?: number;\n  isBadgeActive?: boolean;\n};\n\ntype OwnProps = {\n  tabs: readonly TabWithProperties[];\n  activeTab: number;\n  big?: boolean;\n  onSwitchTab: (index: number) => void;\n};\n\nconst TAB_SCROLL_THRESHOLD_PX = 16;\n\nconst TabList: FC<OwnProps> = ({\n  tabs, activeTab, big, onSwitchTab,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const containerRef = useRef<HTMLDivElement>(null);\n  const previousActiveTab = usePrevious(activeTab);\n\n  useHorizontalScroll(containerRef.current);\n\n  // Scroll container to place active tab in the center\n  useEffect(() => {\n    const container = containerRef.current!;\n    if (container.scrollWidth <= container.offsetWidth) {\n      return;\n    }\n\n    const activeTabElement = container.querySelector('.Tab.active') as HTMLElement | null;\n    if (activeTabElement) {\n      const newLeft = activeTabElement.offsetLeft - (container.offsetWidth / 2) + (activeTabElement.offsetWidth / 2);\n\n      // Prevent scrolling by only a couple of pixels, which doesn't look smooth\n      if (Math.abs(newLeft - container.scrollLeft) < TAB_SCROLL_THRESHOLD_PX) {\n        return;\n      }\n\n      fastSmoothScrollHorizontal(container, newLeft);\n    }\n  }, [activeTab]);\n\n  const lang = useLang();\n\n  return (\n    <div\n      className={`TabList no-selection no-scrollbar ${big ? 'big' : ''}`}\n      ref={containerRef}\n      dir={lang.isRtl ? 'rtl' : undefined}\n    >\n      {tabs.map((tab, i) => (\n        <Tab\n          key={tab.title}\n          title={lang(tab.title)}\n          active={i === activeTab}\n          badgeCount={tab.badgeCount}\n          isBadgeActive={tab.isBadgeActive}\n          previousActiveTab={previousActiveTab}\n          onClick={onSwitchTab}\n          clickArg={i}\n        />\n      ))}\n    </div>\n  );\n};\n\nexport default memo(TabList);\n","import { RefObject } from 'react';\nimport React, {\n  FC, useLayoutEffect, useRef,\n} from '../../lib/teact/teact';\nimport { getGlobal } from '../../lib/teact/teactn';\n\nimport useForceUpdate from '../../hooks/useForceUpdate';\nimport usePrevious from '../../hooks/usePrevious';\nimport buildClassName from '../../util/buildClassName';\nimport { dispatchHeavyAnimationEvent } from '../../hooks/useHeavyAnimationCheck';\nimport { waitForAnimationEnd } from '../../util/cssAnimationEndListeners';\n\nimport './Transition.scss';\n\ntype ChildrenFn = (isActive: boolean, isFrom: boolean, currentKey: number) => any;\ntype OwnProps = {\n  ref?: RefObject<HTMLDivElement>;\n  activeKey: number;\n  name: (\n    'none' | 'slide' | 'slide-reversed' | 'mv-slide' | 'slide-fade' | 'zoom-fade' | 'slide-layers'\n    | 'fade' | 'push-slide' | 'reveal'\n  );\n  direction?: 'auto' | 'inverse' | 1 | -1;\n  renderCount?: number;\n  shouldRestoreHeight?: boolean;\n  shouldCleanup?: boolean;\n  cleanupExceptionKey?: number;\n  id?: string;\n  className?: string;\n  onStart?: () => void;\n  onStop?: () => void;\n  children: ChildrenFn;\n};\n\nconst CLEANED_UP = Symbol('CLEANED_UP');\n\nconst Transition: FC<OwnProps> = ({\n  ref,\n  activeKey,\n  name,\n  direction = 'auto',\n  renderCount,\n  shouldRestoreHeight,\n  shouldCleanup,\n  cleanupExceptionKey,\n  id,\n  className,\n  onStart,\n  onStop,\n  children,\n}) => {\n  // No need for a container to update on change\n  const { animationLevel } = getGlobal().settings.byKey;\n  const currentKeyRef = useRef<number>();\n\n  // eslint-disable-next-line no-null/no-null\n  let containerRef = useRef<HTMLDivElement>(null);\n  if (ref) {\n    containerRef = ref;\n  }\n\n  const rendersRef = useRef<Record<number, ChildrenFn | typeof CLEANED_UP>>({});\n  const prevActiveKey = usePrevious<any>(activeKey);\n  const forceUpdate = useForceUpdate();\n\n  const activeKeyChanged = prevActiveKey !== undefined && activeKey !== prevActiveKey;\n\n  if (!renderCount && activeKeyChanged) {\n    rendersRef.current = { [prevActiveKey]: rendersRef.current[prevActiveKey] };\n  }\n\n  rendersRef.current[activeKey] = children;\n\n  useLayoutEffect(() => {\n    function cleanup() {\n      if (!shouldCleanup || (cleanupExceptionKey !== undefined && cleanupExceptionKey === prevActiveKey)) {\n        return;\n      }\n\n      rendersRef.current = { [prevActiveKey]: CLEANED_UP };\n      forceUpdate();\n    }\n\n    const container = containerRef.current!;\n\n    const childElements = container.children;\n    if (childElements.length === 1 && !activeKeyChanged) {\n      childElements[0].classList.add('active');\n\n      return;\n    }\n\n    const childNodes = Array.from(container.childNodes);\n\n    if (!activeKeyChanged || !childNodes.length) {\n      return;\n    }\n\n    const isBackwards = (\n      direction === -1\n      || (direction === 'auto' && prevActiveKey > activeKey)\n      || (direction === 'inverse' && prevActiveKey < activeKey)\n    );\n\n    container.classList.remove('animating');\n    container.classList.toggle('backwards', isBackwards);\n\n    const keys = Object.keys(rendersRef.current).map(Number);\n    const prevActiveIndex = renderCount ? prevActiveKey : keys.indexOf(prevActiveKey);\n    const activeIndex = renderCount ? activeKey : keys.indexOf(activeKey);\n\n    if (name === 'none' || animationLevel === 0) {\n      childNodes.forEach((node, i) => {\n        if (node instanceof HTMLElement) {\n          node.classList.remove('from', 'through', 'to');\n          node.classList.toggle('active', i === activeIndex);\n        }\n      });\n\n      cleanup();\n\n      return;\n    }\n\n    childNodes.forEach((node, i) => {\n      if (node instanceof HTMLElement) {\n        node.classList.remove('active');\n        node.classList.toggle('from', i === prevActiveIndex);\n        node.classList.toggle('through', (\n          (i > prevActiveIndex && i < activeIndex) || (i < prevActiveIndex && i > activeIndex)\n        ));\n        node.classList.toggle('to', i === activeIndex);\n      }\n    });\n\n    let dispatchHeavyAnimationStop: NoneToVoidFunction;\n    if (animationLevel > 0) {\n      dispatchHeavyAnimationStop = dispatchHeavyAnimationEvent();\n    }\n\n    requestAnimationFrame(() => {\n      container.classList.add('animating');\n\n      if (onStart) {\n        onStart();\n      }\n\n      function onAnimationEnd() {\n        requestAnimationFrame(() => {\n          if (activeKey !== currentKeyRef.current) {\n            return;\n          }\n\n          container.classList.remove('animating', 'backwards');\n\n          childNodes.forEach((node, i) => {\n            if (node instanceof HTMLElement) {\n              node.classList.remove('from', 'through', 'to');\n              node.classList.toggle('active', i === activeIndex);\n            }\n          });\n\n          if (shouldRestoreHeight) {\n            const activeElement = container.querySelector<HTMLDivElement>('.active');\n\n            if (activeElement) {\n              activeElement.style.height = 'auto';\n              container.style.height = `${activeElement.clientHeight}px`;\n            }\n          }\n\n          if (dispatchHeavyAnimationStop) {\n            dispatchHeavyAnimationStop();\n          }\n\n          cleanup();\n\n          if (onStop) {\n            onStop();\n          }\n        });\n      }\n\n      const watchedNode = name === 'mv-slide'\n        ? childNodes[activeIndex]?.firstChild\n        : name === 'reveal' && isBackwards\n          ? childNodes[prevActiveIndex]\n          : childNodes[activeIndex];\n\n      currentKeyRef.current = activeKey;\n\n      if (animationLevel > 0 && watchedNode) {\n        waitForAnimationEnd(watchedNode, onAnimationEnd);\n      } else {\n        onAnimationEnd();\n      }\n    });\n  }, [\n    activeKey,\n    prevActiveKey,\n    activeKeyChanged,\n    direction,\n    name,\n    onStart,\n    onStop,\n    renderCount,\n    shouldRestoreHeight,\n    shouldCleanup,\n    cleanupExceptionKey,\n    animationLevel,\n    forceUpdate,\n  ]);\n\n  useLayoutEffect(() => {\n    if (shouldRestoreHeight) {\n      const container = containerRef.current!;\n      const activeElement = container.querySelector<HTMLDivElement>('.active')\n        || container.querySelector<HTMLDivElement>('.from');\n\n      if (activeElement) {\n        activeElement.style.height = 'auto';\n        container.style.height = `${activeElement.clientHeight}px`;\n        container.style.flexBasis = `${activeElement.clientHeight}px`;\n      }\n    }\n  }, [shouldRestoreHeight, children]);\n\n  const renders = rendersRef.current;\n  const collection = Object.keys(renderCount ? new Array(renderCount).fill(undefined) : renders).map(Number);\n  const contents = collection.map((key) => {\n    const render = renders[key];\n\n    return (\n      typeof render === 'function'\n        ? <div key={key}>{render(key === activeKey, key === prevActiveKey, activeKey)}</div>\n        : undefined\n    );\n  });\n\n  const fullClassName = buildClassName(\n    'Transition',\n    className,\n    name,\n  );\n\n  return (\n    <div ref={containerRef} id={id} className={fullClassName}>\n      {contents}\n    </div>\n  );\n};\n\nexport default Transition;\n","import useReducer, { StateReducer, Dispatch } from '../useReducer';\nimport { ApiChatFolder } from '../../api/types';\nimport { pick, omit } from '../../util/iteratees';\n\nexport type FolderChatType = {\n  icon: string;\n  title: string;\n  key: keyof Pick<ApiChatFolder, (\n    'contacts' | 'nonContacts' | 'groups' | 'channels' | 'bots' |\n    'excludeMuted' | 'excludeArchived' | 'excludeRead'\n  )>;\n};\n\nexport const INCLUDED_CHAT_TYPES: FolderChatType[] = [\n  { icon: 'user', title: 'FilterContacts', key: 'contacts' },\n  { icon: 'non-contacts', title: 'FilterNonContacts', key: 'nonContacts' },\n  { icon: 'group', title: 'FilterGroups', key: 'groups' },\n  { icon: 'channel', title: 'FilterChannels', key: 'channels' },\n  { icon: 'bots', title: 'FilterBots', key: 'bots' },\n];\n\nexport const EXCLUDED_CHAT_TYPES: FolderChatType[] = [\n  { icon: 'mute', title: 'FilterMuted', key: 'excludeMuted' },\n  { icon: 'archive', title: 'FilterArchived', key: 'excludeArchived' },\n  { icon: 'readchats', title: 'FilterRead', key: 'excludeRead' },\n];\n\nconst INCLUDE_FILTER_FIELDS: Array<keyof FolderIncludeFilters> = [\n  'includedChatIds', 'bots', 'channels', 'groups', 'contacts', 'nonContacts',\n];\nconst EXCLUDE_FILTER_FIELDS: Array<keyof FolderExcludeFilters> = [\n  'excludedChatIds', 'excludeArchived', 'excludeMuted', 'excludeRead',\n];\n\nexport function selectChatFilters(state: FoldersState, mode: 'included' | 'excluded', selectTemp?: boolean) {\n  let selectedChatIds: number[] = [];\n  let selectedChatTypes: FolderChatType['key'][] = [];\n\n  if (mode === 'included') {\n    const {\n      includedChatIds,\n      ...includeFilters\n    } = selectTemp\n      ? state.includeFilters || {}\n      : pick(\n        state.folder,\n        INCLUDE_FILTER_FIELDS,\n      );\n\n    selectedChatIds = includedChatIds || [];\n    selectedChatTypes = (Object.keys(includeFilters) as Array<keyof typeof includeFilters>)\n      .filter((key) => Boolean(includeFilters[key]));\n  } else {\n    const {\n      excludedChatIds,\n      ...excludeFilters\n    } = selectTemp\n      ? state.excludeFilters || {}\n      : pick(\n        state.folder,\n        EXCLUDE_FILTER_FIELDS,\n      );\n\n    selectedChatIds = excludedChatIds || [];\n    selectedChatTypes = (Object.keys(excludeFilters) as Array<keyof typeof excludeFilters>)\n      .filter((key) => Boolean(excludeFilters[key]));\n  }\n\n  return {\n    selectedChatIds,\n    selectedChatTypes,\n  };\n}\n\nfunction getSuggestedFolderName(includeFilters?: FolderIncludeFilters) {\n  if (includeFilters) {\n    const {\n      includedChatIds,\n      ...filters\n    } = includeFilters;\n\n    if (\n      Object.values(filters).filter(Boolean).length > 1\n      || (includedChatIds?.length)\n    ) {\n      return '';\n    }\n\n    if (filters.bots) {\n      return 'Bots';\n    } else if (filters.groups) {\n      return 'Groups';\n    } else if (filters.channels) {\n      return 'Channels';\n    } else if (filters.contacts) {\n      return 'Contacts';\n    } else if (filters.nonContacts) {\n      return 'Non-Contacts';\n    }\n  }\n\n  return '';\n}\n\ntype FolderIncludeFilters = Pick<ApiChatFolder, (\n  'includedChatIds' | 'bots' | 'channels' | 'groups' | 'contacts' | 'nonContacts'\n)>;\ntype FolderExcludeFilters = Pick<ApiChatFolder, 'excludedChatIds' | 'excludeArchived' | 'excludeMuted' | 'excludeRead'>;\n\nexport type FoldersState = {\n  mode: 'create' | 'edit';\n  isLoading?: boolean;\n  isTouched?: boolean;\n  error?: string;\n  folderId?: number;\n  chatFilter: string;\n  folder: Omit<ApiChatFolder, 'id' | 'description' | 'emoticon'>;\n  includeFilters?: FolderIncludeFilters;\n  excludeFilters?: FolderExcludeFilters;\n};\nexport type FoldersActions = (\n  'setTitle' | 'saveFilters' | 'editFolder' | 'reset' | 'setChatFilter' | 'setIsLoading' | 'setError' |\n  'editIncludeFilters' | 'editExcludeFilters' | 'setIncludeFilters' | 'setExcludeFilters'\n);\nexport type FolderEditDispatch = Dispatch<FoldersActions>;\n\nconst INITIAL_STATE: FoldersState = {\n  mode: 'create',\n  chatFilter: '',\n  folder: {\n    title: '',\n    includedChatIds: [],\n    excludedChatIds: [],\n  },\n};\n\nconst foldersReducer: StateReducer<FoldersState, FoldersActions> = (\n  state,\n  action,\n) => {\n  switch (action.type) {\n    case 'setTitle':\n      return {\n        ...state,\n        folder: {\n          ...state.folder,\n          title: action.payload,\n        },\n        isTouched: true,\n      };\n    case 'editIncludeFilters':\n      return {\n        ...state,\n        includeFilters: pick(\n          state.folder,\n          INCLUDE_FILTER_FIELDS,\n        ),\n      };\n    case 'editExcludeFilters':\n      return {\n        ...state,\n        excludeFilters: pick(\n          state.folder,\n          EXCLUDE_FILTER_FIELDS,\n        ),\n      };\n    case 'setIncludeFilters':\n      return {\n        ...state,\n        includeFilters: action.payload,\n        chatFilter: '',\n      };\n    case 'setExcludeFilters':\n      return {\n        ...state,\n        excludeFilters: action.payload,\n        chatFilter: '',\n      };\n    case 'saveFilters':\n      if (state.includeFilters) {\n        return {\n          ...state,\n          folder: {\n            ...omit(state.folder, INCLUDE_FILTER_FIELDS),\n            title: state.folder.title ? state.folder.title : getSuggestedFolderName(state.includeFilters),\n            ...state.includeFilters,\n          },\n          includeFilters: undefined,\n          chatFilter: '',\n          isTouched: true,\n        };\n      } else if (state.excludeFilters) {\n        return {\n          ...state,\n          folder: {\n            ...omit(state.folder, EXCLUDE_FILTER_FIELDS),\n            ...state.excludeFilters,\n          },\n          excludeFilters: undefined,\n          chatFilter: '',\n          isTouched: true,\n        };\n      } else {\n        return state;\n      }\n    case 'editFolder': {\n      const { id: folderId, description, ...folder } = action.payload;\n\n      return {\n        mode: 'edit',\n        folderId,\n        folder,\n        chatFilter: '',\n      };\n    }\n    case 'setChatFilter': {\n      return {\n        ...state,\n        chatFilter: action.payload,\n      };\n    }\n    case 'setIsLoading': {\n      return {\n        ...state,\n        isLoading: action.payload,\n      };\n    }\n    case 'setError': {\n      return {\n        ...state,\n        error: action.payload,\n      };\n    }\n    case 'reset':\n      return INITIAL_STATE;\n    default:\n      return state;\n  }\n};\n\nexport default () => {\n  return useReducer(foldersReducer, INITIAL_STATE);\n};\n","import {\n  useCallback, useEffect, useRef, useState,\n} from '../lib/teact/teact';\n\nimport { register } from '../util/audioPlayer';\nimport useEffectWithPrevDeps from './useEffectWithPrevDeps';\nimport { isSafariPatchInProgress } from '../util/patchSafariProgressiveAudio';\nimport useOnChange from './useOnChange';\n\ntype Handler = (e: Event) => void;\n\nexport default (\n  trackId: string,\n  originalDuration: number, // Sometimes incorrect for voice messages\n  src?: string,\n  handlers?: Record<string, Handler>,\n  onInit?: (element: HTMLAudioElement) => void,\n  shouldPlay = false,\n  onForcePlay?: NoneToVoidFunction,\n  noPlaylist = false,\n) => {\n  // eslint-disable-next-line no-null/no-null\n  const controllerRef = useRef<ReturnType<typeof register>>(null);\n\n  const [isPlaying, setIsPlaying] = useState(false);\n  let isPlayingSync = isPlaying;\n\n  const [playProgress, setPlayProgress] = useState<number>(0);\n\n  useOnChange(() => {\n    controllerRef.current = register(trackId, (eventName, e) => {\n      switch (eventName) {\n        case 'onPlay':\n          setIsPlaying(true);\n          break;\n        case 'onPause':\n          setIsPlaying(false);\n          break;\n        case 'onTimeUpdate': {\n          const { proxy } = controllerRef.current!;\n          const duration = proxy.duration && Number.isFinite(proxy.duration) ? proxy.duration : originalDuration;\n          setPlayProgress(proxy.currentTime / duration);\n          break;\n        }\n      }\n\n      handlers?.[eventName]?.(e);\n    }, onForcePlay);\n\n    const { proxy } = controllerRef.current!;\n\n    if (!isPlaying && !proxy.paused) {\n      setIsPlaying(true);\n      isPlayingSync = true;\n    }\n\n    if (onInit) {\n      onInit(proxy);\n    }\n  }, [trackId]);\n\n  const {\n    play, pause, setCurrentTime, proxy, destroy,\n  } = controllerRef.current!;\n  const duration = proxy.duration && Number.isFinite(proxy.duration) ? proxy.duration : originalDuration;\n\n  // RAF progress\n  useEffect(() => {\n    if (duration && !isSafariPatchInProgress(proxy)) {\n      setPlayProgress(proxy.currentTime / duration);\n    }\n  }, [duration, playProgress, proxy]);\n\n  // Cleanup\n  useEffect(() => () => {\n    destroy(noPlaylist);\n  }, [destroy, noPlaylist]);\n\n  // Autoplay once `src` is present\n  useEffectWithPrevDeps(([prevShouldPlay, prevSrc]) => {\n    if (prevShouldPlay === shouldPlay && src === prevSrc) {\n      return;\n    }\n\n    // When paused by another player\n    if (proxy.src && proxy.paused) {\n      return;\n    }\n\n    if (shouldPlay && src && !isPlaying) {\n      play(src);\n    }\n  }, [shouldPlay, src, isPlaying, play, proxy.src, proxy.paused]);\n\n  const playPause = useCallback(() => {\n    if (isPlaying) {\n      pause();\n    } else if (src) {\n      play(src);\n    }\n  }, [src, pause, play, isPlaying]);\n\n  return {\n    isPlaying: isPlayingSync,\n    playProgress,\n    playPause,\n    setCurrentTime,\n    audioProxy: proxy,\n    duration,\n  };\n};\n","import { useEffect } from '../lib/teact/teact';\n\nexport default function useBackgroundMode(\n  onBlur?: AnyToVoidFunction,\n  onFocus?: AnyToVoidFunction,\n) {\n  useEffect(() => {\n    if (onBlur && !document.hasFocus()) {\n      onBlur();\n    }\n\n    if (onBlur) {\n      window.addEventListener('blur', onBlur);\n    }\n\n    if (onFocus) {\n      window.addEventListener('focus', onFocus);\n    }\n\n    return () => {\n      if (onFocus) {\n        window.removeEventListener('focus', onFocus);\n      }\n\n      if (onBlur) {\n        window.removeEventListener('blur', onBlur);\n      }\n    };\n  }, [onBlur, onFocus]);\n}\n","import { useEffect, useRef } from '../lib/teact/teact';\n\nimport fastBlur from '../lib/fastBlur';\nimport { imgToCanvas } from '../util/files';\nimport useForceUpdate from './useForceUpdate';\n\nconst RADIUS = 2;\nconst ITERATIONS = 2;\nconst MAX_CACHE_SIZE = 1000;\n\nconst cache = new Map<string, string>();\n\nexport default function useBlur(dataUri?: string, isDisabled = false, delay?: number) {\n  const blurredRef = useRef<string | undefined>(dataUri ? cache.get(dataUri) : undefined);\n  const timeoutRef = useRef<number>();\n  const forceUpdate = useForceUpdate();\n\n  if (timeoutRef.current && isDisabled) {\n    clearTimeout(timeoutRef.current);\n    timeoutRef.current = undefined;\n  }\n\n  useEffect(() => {\n    if (!dataUri || blurredRef.current || isDisabled) {\n      return;\n    }\n\n    const img = new Image();\n\n    img.onload = () => {\n      const canvas = imgToCanvas(img);\n      fastBlur(canvas.getContext('2d'), 0, 0, canvas.width, canvas.height, RADIUS, ITERATIONS);\n      const blurredDataUri = canvas.toDataURL();\n\n      blurredRef.current = blurredDataUri;\n      forceUpdate();\n\n      if (cache.size >= MAX_CACHE_SIZE) {\n        cache.clear();\n      }\n      cache.set(dataUri, blurredDataUri);\n    };\n\n    if (delay) {\n      timeoutRef.current = window.setTimeout(() => {\n        img.src = dataUri;\n      }, delay);\n    } else {\n      img.src = dataUri;\n    }\n  }, [dataUri, delay, forceUpdate, isDisabled]);\n\n  return blurredRef.current;\n}\n","import { useRef } from '../lib/teact/teact';\n\nimport fastBlur from '../lib/fastBlur';\nimport useOnChange from './useOnChange';\nimport useBlur from './useBlur';\nimport { imgToCanvas } from '../util/files';\n\nconst RADIUS = 2;\nconst ITERATIONS = 2;\n\nexport default function useBlurSync(dataUri: string | false | undefined) {\n  const blurredRef = useRef<string>();\n\n  let isChanged = false;\n\n  useOnChange(() => {\n    isChanged = true;\n\n    blurredRef.current = undefined;\n\n    if (!dataUri) {\n      return;\n    }\n\n    const img = new Image();\n    img.src = dataUri;\n    if (!img.width) {\n      return;\n    }\n\n    const canvas = imgToCanvas(img);\n    fastBlur(canvas.getContext('2d'), 0, 0, canvas.width, canvas.height, RADIUS, ITERATIONS);\n\n    blurredRef.current = canvas.toDataURL();\n  }, [dataUri]);\n\n  // Sometimes `Image` do not manage to load synchronously,\n  // so we fall back the non-blurred variant and prepare the async one at least for the next time\n  const blurredAsync = useBlur(dataUri || undefined, Boolean(blurredRef.current));\n\n  return blurredRef.current || (!isChanged && blurredAsync) || dataUri || undefined;\n}\n","import React, { useCallback, useMemo, useState } from '../lib/teact/teact';\nimport { debounce } from '../util/schedulers';\nimport { isSafariPatchInProgress } from '../util/patchSafariProgressiveAudio';\n\ntype BufferingEvent = (e: Event | React.SyntheticEvent<HTMLMediaElement>) => void;\n\nconst MIN_READY_STATE = 3;\n// Avoid flickering when re-mounting previously buffered video\nconst DEBOUNCE = 200;\n\nexport default (noInitiallyBuffered = false) => {\n  const [isBuffered, setIsBuffered] = useState(!noInitiallyBuffered);\n  const [bufferedProgress, setBufferedProgress] = useState(0);\n\n  const setIsBufferedDebounced = useMemo(() => {\n    return debounce(setIsBuffered, DEBOUNCE, false, true);\n  }, []);\n\n  const handleBuffering = useCallback<BufferingEvent>((e) => {\n    const media = e.currentTarget as HTMLMediaElement;\n\n    if (!isSafariPatchInProgress(media)) {\n      if (media.buffered.length) {\n        setBufferedProgress(media.buffered.end(0) / media.duration);\n      }\n\n      setIsBufferedDebounced(media.readyState >= MIN_READY_STATE || media.currentTime > 0);\n    }\n  }, [setIsBufferedDebounced]);\n\n  const bufferingHandlers = {\n    onLoadedData: handleBuffering,\n    onPlaying: handleBuffering,\n    onLoadStart: handleBuffering, // Needed for Safari to start\n    onPause: handleBuffering, // Needed for Chrome when seeking\n    onTimeUpdate: handleBuffering, // Needed for audio buffering progress\n    onProgress: handleBuffering, // Needed for video buffering progress\n  };\n\n  return {\n    isBuffered,\n    bufferedProgress,\n    bufferingHandlers,\n    checkBuffering(element: HTMLMediaElement) {\n      setIsBufferedDebounced(element.readyState >= MIN_READY_STATE);\n    },\n  };\n};\n","import { useEffect, useRef } from '../lib/teact/teact';\n\nimport fastBlur from '../lib/fastBlur';\nimport useForceUpdate from './useForceUpdate';\nimport { IS_CANVAS_FILTER_SUPPORTED } from '../util/environment';\n\nconst RADIUS = 2;\nconst ITERATIONS = 2;\n\nexport default function useCanvasBlur(dataUri?: string, isDisabled = false, withRaf?: boolean) {\n  // eslint-disable-next-line no-null/no-null\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const forceUpdate = useForceUpdate();\n\n  useEffect(() => {\n    const canvas = canvasRef.current;\n\n    if (!dataUri || !canvas || isDisabled) {\n      return;\n    }\n\n    const img = new Image();\n\n    const processBlur = () => {\n      canvas.width = img.width;\n      canvas.height = img.height;\n\n      const ctx = canvas.getContext('2d', { alpha: false })!;\n\n      if (IS_CANVAS_FILTER_SUPPORTED) {\n        ctx.filter = `blur(${RADIUS}px)`;\n      }\n\n      ctx.drawImage(img, -RADIUS * 2, -RADIUS * 2, canvas.width + RADIUS * 4, canvas.height + RADIUS * 4);\n\n      if (!IS_CANVAS_FILTER_SUPPORTED) {\n        fastBlur(ctx, 0, 0, canvas.width, canvas.height, RADIUS, ITERATIONS);\n      }\n    };\n\n    img.onload = () => {\n      if (withRaf) {\n        requestAnimationFrame(processBlur);\n      } else {\n        processBlur();\n      }\n    };\n\n    img.src = dataUri;\n  }, [canvasRef, dataUri, forceUpdate, isDisabled, withRaf]);\n\n  return canvasRef;\n}\n","import { useMemo } from '../lib/teact/teact';\nimport { getDispatch } from '../lib/teact/teactn';\n\nimport { ApiChat, ApiUser } from '../api/types';\n\nimport {\n  isChatArchived, getCanDeleteChat, isChatPrivate, isChatChannel,\n} from '../modules/helpers';\nimport useLang from './useLang';\n\nexport default ({\n  chat,\n  privateChatUser,\n  handleDelete,\n  folderId,\n  isPinned,\n  isMuted,\n}: {\n  chat: ApiChat | undefined;\n  privateChatUser: ApiUser | undefined;\n  handleDelete: () => void;\n  folderId?: number;\n  isPinned?: boolean;\n  isMuted?: boolean;\n}, isInSearch = false) => {\n  const lang = useLang();\n\n  return useMemo(() => {\n    if (!chat) {\n      return undefined;\n    }\n\n    const {\n      toggleChatPinned,\n      updateChatMutedState,\n      toggleChatArchived,\n      toggleChatUnread,\n    } = getDispatch();\n\n    const actionPin = isPinned\n      ? {\n        title: lang('UnpinFromTop'),\n        icon: 'unpin',\n        handler: () => toggleChatPinned({ id: chat.id, folderId }),\n      }\n      : { title: lang('PinToTop'), icon: 'pin', handler: () => toggleChatPinned({ id: chat.id, folderId }) };\n\n    if (isInSearch) {\n      return [actionPin];\n    }\n\n    const actionUnreadMark = chat.unreadCount || chat.hasUnreadMark\n      ? { title: lang('MarkAsRead'), icon: 'readchats', handler: () => toggleChatUnread({ id: chat.id }) }\n      : { title: lang('MarkAsUnread'), icon: 'unread', handler: () => toggleChatUnread({ id: chat.id }) };\n\n    const actionMute = isMuted\n      ? {\n        title: lang('ChatList.Unmute'),\n        icon: 'unmute',\n        handler: () => updateChatMutedState({ chatId: chat.id, isMuted: false }),\n      }\n      : {\n        title: lang('ChatList.Mute'),\n        icon: 'mute',\n        handler: () => updateChatMutedState({ chatId: chat.id, isMuted: true }),\n      };\n\n    const actionArchive = isChatArchived(chat)\n      ? { title: lang('Unarchive'), icon: 'unarchive', handler: () => toggleChatArchived({ id: chat.id }) }\n      : { title: lang('Archive'), icon: 'archive', handler: () => toggleChatArchived({ id: chat.id }) };\n\n    const actionDelete = {\n      title: isChatPrivate(chat.id)\n        ? lang('Delete')\n        : lang(getCanDeleteChat(chat)\n          ? 'DeleteChat'\n          : (isChatChannel(chat) ? 'LeaveChannel' : 'Group.LeaveGroup')),\n      icon: 'delete',\n      destructive: true,\n      handler: handleDelete,\n    };\n\n    return [\n      actionUnreadMark,\n      actionPin,\n      ...(!privateChatUser?.isSelf ? [\n        actionMute,\n        actionArchive,\n      ] : []),\n      actionDelete,\n    ];\n  }, [chat, isPinned, lang, isInSearch, isMuted, handleDelete, privateChatUser?.isSelf, folderId]);\n};\n","import { RefObject } from 'react';\nimport { useState, useEffect, useCallback } from '../lib/teact/teact';\n\nimport { IAnchorPosition } from '../types';\nimport { IS_TOUCH_ENV, IS_SINGLE_COLUMN_LAYOUT } from '../util/environment';\n\nconst LONG_TAP_DURATION_MS = 200;\n\nfunction checkIsDisabledForMobile() {\n  return IS_SINGLE_COLUMN_LAYOUT\n  && window.document.body.classList.contains('enable-symbol-menu-transforms');\n}\n\nexport default (\n  elementRef: RefObject<HTMLElement>,\n  isMenuDisabled?: boolean,\n  shouldDisableOnLink?: boolean,\n  shouldDisableOnLongTap?: boolean,\n) => {\n  const [isContextMenuOpen, setIsContextMenuOpen] = useState(false);\n  const [contextMenuPosition, setContextMenuPosition] = useState<IAnchorPosition | undefined>(undefined);\n\n  const handleBeforeContextMenu = useCallback((e: React.MouseEvent) => {\n    if (!isMenuDisabled && e.button === 2) {\n      document.body.classList.add('no-selection');\n    }\n  }, [isMenuDisabled]);\n\n  const handleContextMenu = useCallback((e: React.MouseEvent) => {\n    document.body.classList.remove('no-selection');\n\n    if (isMenuDisabled || (shouldDisableOnLink && (e.target as HTMLElement).matches('a[href]'))) {\n      return;\n    }\n    e.preventDefault();\n\n    if (contextMenuPosition) {\n      return;\n    }\n\n    setIsContextMenuOpen(true);\n    setContextMenuPosition({ x: e.clientX, y: e.clientY });\n  }, [isMenuDisabled, shouldDisableOnLink, contextMenuPosition]);\n\n  const handleContextMenuClose = useCallback(() => {\n    setIsContextMenuOpen(false);\n  }, []);\n\n  const handleContextMenuHide = useCallback(() => {\n    setContextMenuPosition(undefined);\n    document.body.classList.remove('no-selection');\n  }, []);\n\n  // Support context menu on touch-devices\n  useEffect(() => {\n    if (isMenuDisabled || !IS_TOUCH_ENV || shouldDisableOnLongTap) {\n      return undefined;\n    }\n\n    const element = elementRef.current;\n    if (!element) {\n      return undefined;\n    }\n\n    let timer: number | undefined;\n\n    const clearLongPressTimer = () => {\n      if (timer) {\n        clearTimeout(timer);\n        timer = undefined;\n      }\n    };\n\n    const emulateContextMenuEvent = (originalEvent: TouchEvent) => {\n      clearLongPressTimer();\n\n      const { clientX, clientY, target } = originalEvent.touches[0];\n\n      if (contextMenuPosition || (shouldDisableOnLink && (target as HTMLElement).matches('a[href]'))) {\n        return;\n      }\n\n      // temporarily intercept and clear the next click\n      element.addEventListener('touchend', function cancelClickOnce(e) {\n        element.removeEventListener('touchend', cancelClickOnce, true);\n        e.stopImmediatePropagation();\n        e.preventDefault();\n        e.stopPropagation();\n      }, true);\n\n      document.body.classList.add('no-selection');\n      setIsContextMenuOpen(true);\n      setContextMenuPosition({ x: clientX, y: clientY });\n    };\n\n    const startLongPressTimer = (e: TouchEvent) => {\n      if (isMenuDisabled || checkIsDisabledForMobile()) {\n        return;\n      }\n      clearLongPressTimer();\n\n      timer = window.setTimeout(() => emulateContextMenuEvent(e), LONG_TAP_DURATION_MS);\n    };\n\n    // @perf Consider event delegation\n    element.addEventListener('touchstart', startLongPressTimer, { passive: true });\n    element.addEventListener('touchcancel', clearLongPressTimer, true);\n    element.addEventListener('touchend', clearLongPressTimer, true);\n    element.addEventListener('touchmove', clearLongPressTimer, { passive: true });\n\n    return () => {\n      clearLongPressTimer();\n      element.removeEventListener('touchstart', startLongPressTimer);\n      element.removeEventListener('touchcancel', clearLongPressTimer, true);\n      element.removeEventListener('touchend', clearLongPressTimer, true);\n      element.removeEventListener('touchmove', clearLongPressTimer);\n    };\n  }, [contextMenuPosition, isMenuDisabled, shouldDisableOnLongTap, elementRef, shouldDisableOnLink]);\n\n  return {\n    isContextMenuOpen,\n    contextMenuPosition,\n    handleBeforeContextMenu,\n    handleContextMenu,\n    handleContextMenuClose,\n    handleContextMenuHide,\n  };\n};\n","import { useState, useEffect } from '../lib/teact/teact';\nimport { IAnchorPosition } from '../types';\n\nconst MENU_POSITION_VISUAL_COMFORT_SPACE_PX = 16;\n\nexport default (\n  anchor: IAnchorPosition | undefined,\n  getTriggerElement: () => HTMLElement | null,\n  getRootElement: () => HTMLElement | null,\n  getMenuElement: () => HTMLElement | null,\n  extraPaddingX = 0,\n  extraTopPadding = 0,\n) => {\n  const [positionX, setPositionX] = useState<'right' | 'left'>('right');\n  const [positionY, setPositionY] = useState<'top' | 'bottom'>('bottom');\n  const [style, setStyle] = useState('');\n\n  useEffect(() => {\n    const triggerEl = getTriggerElement();\n    if (!anchor || !triggerEl) {\n      return;\n    }\n\n    let { x, y } = anchor;\n    const emptyRect = {\n      width: 0, left: 0, height: 0, top: 0,\n    };\n\n    const menuEl = getMenuElement();\n    const rootEl = getRootElement();\n\n    const triggerRect = triggerEl.getBoundingClientRect();\n    const menuRect = menuEl ? { width: menuEl.offsetWidth, height: menuEl.offsetHeight } : emptyRect;\n    const rootRect = rootEl ? rootEl.getBoundingClientRect() : emptyRect;\n\n    let horizontalPostition: 'left' | 'right';\n    if (x + menuRect.width + extraPaddingX < rootRect.width + rootRect.left) {\n      x += 3;\n      horizontalPostition = 'left';\n    } else if (x - menuRect.width > 0) {\n      horizontalPostition = 'right';\n      x -= 3;\n    } else {\n      horizontalPostition = 'left';\n      x = 16;\n    }\n    setPositionX(horizontalPostition);\n\n    if (y + menuRect.height < rootRect.height + rootRect.top) {\n      setPositionY('top');\n    } else {\n      setPositionY('bottom');\n\n      if (y - menuRect.height < rootRect.top + extraTopPadding) {\n        y = rootRect.top + extraTopPadding + menuRect.height;\n      }\n    }\n\n    const left = horizontalPostition === 'left'\n      ? Math.min(x - triggerRect.left, rootRect.width - menuRect.width - MENU_POSITION_VISUAL_COMFORT_SPACE_PX)\n      : Math.max((x - triggerRect.left), menuRect.width + MENU_POSITION_VISUAL_COMFORT_SPACE_PX);\n\n    setStyle(`left: ${left}px; top: ${y - triggerRect.top}px;`);\n  }, [\n    anchor, extraPaddingX, extraTopPadding,\n    getMenuElement, getRootElement, getTriggerElement,\n  ]);\n\n  return {\n    positionX,\n    positionY,\n    style,\n  };\n};\n","import usePrevious from './usePrevious';\n\nexport default function useCurrentOrPrev<T extends any>(\n  current: T, shouldSkipUndefined = false, shouldForceCurrent = false,\n): T | undefined {\n  const prev = usePrevious(current, shouldSkipUndefined);\n\n  // eslint-disable-next-line no-null/no-null\n  return shouldForceCurrent || (current !== null && current !== undefined) ? current : prev;\n}\n","import { useEffect, useMemo } from '../lib/teact/teact';\nimport { getDispatch } from '../lib/teact/teactn';\n\nimport { ApiMessage } from '../api/types';\n\nimport { throttle } from '../util/schedulers';\n\nexport default (\n  chatId: number,\n  messageId?: number,\n  message?: ApiMessage,\n  replyOriginForId?: number,\n) => {\n  const { loadMessage } = getDispatch();\n  const loadMessageThrottled = useMemo(() => {\n    const throttled = throttle(loadMessage, 500, true);\n    return () => {\n      throttled({ chatId, messageId, replyOriginForId });\n    };\n  }, [loadMessage, chatId, messageId, replyOriginForId]);\n\n  useEffect(() => {\n    if (messageId && !message) {\n      loadMessageThrottled();\n    }\n  });\n};\n","import { useEffect } from '../lib/teact/teact';\n\nexport default (container: HTMLElement | null, isDisabled?: boolean) => {\n  useEffect(() => {\n    if (!container) {\n      return undefined;\n    }\n\n    function handleScroll(e: WheelEvent) {\n      // Ignore horizontal scroll and let it work natively (e.g. on touchpad)\n      if (!e.deltaX) {\n        container!.scrollLeft += e.deltaY / 4;\n      }\n    }\n\n    container.addEventListener('wheel', handleScroll, { passive: true });\n\n    return () => {\n      container.removeEventListener('wheel', handleScroll);\n    };\n  }, [container, isDisabled]);\n};\n","import { useCallback, useEffect, useRef } from '../lib/teact/teact';\nimport { LoadMoreDirection } from '../types';\n\nimport { areSortedArraysEqual } from '../util/iteratees';\nimport useForceUpdate from './useForceUpdate';\nimport usePrevious from './usePrevious';\n\ntype GetMore = (args: { direction: LoadMoreDirection }) => void;\ntype LoadMoreBackwards = (args: { offsetId?: number }) => void;\n\nconst DEFAULT_LIST_SLICE = 30;\n\nexport default (\n  loadMoreBackwards?: LoadMoreBackwards,\n  listIds?: number[],\n  isDisabled = false,\n  listSlice = DEFAULT_LIST_SLICE,\n  forceFullPreload = false,\n): [number[]?, GetMore?] => {\n  const lastParamsRef = useRef<{\n    direction?: LoadMoreDirection;\n    offsetId?: number;\n  }>();\n\n  const viewportIdsRef = useRef<number[] | undefined>((() => {\n    // Only run once to initialize\n    if (!listIds || lastParamsRef.current) {\n      return undefined;\n    }\n\n    const { newViewportIds } = getViewportSlice(listIds, listIds[0], LoadMoreDirection.Forwards, listSlice);\n    return newViewportIds;\n  })());\n\n  const forceUpdate = useForceUpdate();\n\n  const prevListIds = usePrevious(listIds);\n  const prevIsDisabled = usePrevious(isDisabled);\n  if (listIds && !isDisabled && (listIds !== prevListIds || isDisabled !== prevIsDisabled)) {\n    const { offsetId = listIds[0], direction = LoadMoreDirection.Forwards } = lastParamsRef.current || {};\n    const { newViewportIds } = getViewportSlice(listIds, offsetId, direction, listSlice);\n\n    if (!viewportIdsRef.current || !areSortedArraysEqual(viewportIdsRef.current, newViewportIds)) {\n      viewportIdsRef.current = newViewportIds;\n    }\n  }\n\n  useEffect(() => {\n    if (listIds && !isDisabled && loadMoreBackwards && forceFullPreload) {\n      const viewportIds = viewportIdsRef.current!;\n      loadMoreBackwards({ offsetId: viewportIds[viewportIds.length - 1] });\n    }\n  }, [listIds, isDisabled, loadMoreBackwards, forceFullPreload]);\n\n  const getMore: GetMore = useCallback(({\n    direction,\n    noScroll,\n  }: { direction: LoadMoreDirection; noScroll?: boolean }) => {\n    const viewportIds = viewportIdsRef.current;\n\n    const offsetId = viewportIds\n      ? direction === LoadMoreDirection.Backwards ? viewportIds[viewportIds.length - 1] : viewportIds[0]\n      : undefined;\n\n    if (!listIds) {\n      if (loadMoreBackwards) {\n        loadMoreBackwards({ offsetId });\n      }\n\n      return;\n    }\n\n    if (!noScroll) {\n      lastParamsRef.current = { ...lastParamsRef.current, direction, offsetId };\n    }\n\n    const {\n      newViewportIds, areSomeLocal, areAllLocal,\n    } = getViewportSlice(listIds, offsetId, direction, listSlice);\n\n    if (areSomeLocal && !(viewportIds && areSortedArraysEqual(viewportIds, newViewportIds))) {\n      viewportIdsRef.current = newViewportIds;\n      forceUpdate();\n    }\n\n    if (!areAllLocal && loadMoreBackwards) {\n      loadMoreBackwards({ offsetId });\n    }\n  }, [listIds, listSlice, loadMoreBackwards, forceUpdate]);\n\n  return isDisabled ? [listIds] : [viewportIdsRef.current, getMore];\n};\n\nfunction getViewportSlice(\n  sourceIds: number[],\n  offsetId = 0,\n  direction: LoadMoreDirection,\n  listSlice: number,\n) {\n  const { length } = sourceIds;\n  const index = sourceIds.indexOf(offsetId);\n  const isForwards = direction === LoadMoreDirection.Forwards;\n  const indexForDirection = isForwards ? index : (index + 1) || length;\n  const from = Math.max(0, indexForDirection - listSlice);\n  const to = indexForDirection + listSlice - 1;\n  const newViewportIds = sourceIds.slice(Math.max(0, from), to + 1);\n\n  let areSomeLocal;\n  let areAllLocal;\n  switch (direction) {\n    case LoadMoreDirection.Forwards:\n      areSomeLocal = indexForDirection > 0;\n      areAllLocal = from >= 0;\n      break;\n    case LoadMoreDirection.Backwards:\n      areSomeLocal = indexForDirection < length;\n      areAllLocal = to <= length - 1;\n      break;\n  }\n\n  return { newViewportIds, areSomeLocal, areAllLocal };\n}\n","import { RefObject } from 'react';\nimport {\n  useEffect, useRef, useCallback, useState,\n} from '../lib/teact/teact';\n\nimport { throttle, debounce } from '../util/schedulers';\nimport useHeavyAnimationCheck from './useHeavyAnimationCheck';\n\ntype TargetCallback = (entry: IntersectionObserverEntry) => void;\ntype RootCallback = (entries: IntersectionObserverEntry[]) => void;\ntype ObserveCleanup = NoneToVoidFunction;\nexport type ObserveFn = (target: HTMLElement, targetCallback?: TargetCallback) => ObserveCleanup;\n\ninterface IntersectionController {\n  observer: IntersectionObserver;\n  callbacks: Map<HTMLElement, TargetCallback>;\n}\n\ninterface Response {\n  observe: ObserveFn;\n  freeze: NoneToVoidFunction;\n  unfreeze: NoneToVoidFunction;\n}\n\nconst AUTO_UNFREEZE_TIMEOUT = 2000;\n\nexport function useIntersectionObserver({\n  rootRef,\n  throttleMs,\n  debounceMs,\n  shouldSkipFirst,\n  margin,\n  threshold,\n  isDisabled,\n}: {\n  rootRef: RefObject<HTMLDivElement>;\n  throttleMs?: number;\n  debounceMs?: number;\n  shouldSkipFirst?: boolean;\n  margin?: number;\n  threshold?: number | number[];\n  isDisabled?: boolean;\n}, rootCallback?: RootCallback): Response {\n  const controllerRef = useRef<IntersectionController>();\n  const rootCallbackRef = useRef<RootCallback>();\n  const freezeFlagsRef = useRef(0);\n  const autoUnfreezeTimeoutRef = useRef<number>();\n  const onUnfreezeRef = useRef<NoneToVoidFunction>();\n\n  rootCallbackRef.current = rootCallback;\n\n  const unfreeze = useCallback(() => {\n    if (!freezeFlagsRef.current) {\n      return;\n    }\n\n    freezeFlagsRef.current--;\n\n    if (!freezeFlagsRef.current && onUnfreezeRef.current) {\n      onUnfreezeRef.current();\n      onUnfreezeRef.current = undefined;\n    }\n  }, []);\n\n  const freeze = useCallback(() => {\n    freezeFlagsRef.current++;\n\n    if (autoUnfreezeTimeoutRef.current) {\n      clearTimeout(autoUnfreezeTimeoutRef.current);\n      autoUnfreezeTimeoutRef.current = undefined;\n    }\n\n    // Make sure to unfreeze even if unfreeze callback was not called (which was some hardly-reproducible bug)\n    autoUnfreezeTimeoutRef.current = window.setTimeout(() => {\n      autoUnfreezeTimeoutRef.current = undefined;\n\n      if (!freezeFlagsRef.current) {\n        return;\n      }\n\n      freezeFlagsRef.current = 1;\n      unfreeze();\n    }, AUTO_UNFREEZE_TIMEOUT);\n  }, [unfreeze]);\n\n  useHeavyAnimationCheck(freeze, unfreeze);\n\n  useEffect(() => {\n    if (isDisabled) {\n      return undefined;\n    }\n\n    return () => {\n      if (controllerRef.current) {\n        controllerRef.current.observer.disconnect();\n        controllerRef.current.callbacks.clear();\n        controllerRef.current = undefined;\n      }\n    };\n  }, [isDisabled]);\n\n  function initController() {\n    const callbacks = new Map();\n    const entriesAccumulator = new Map<Element, IntersectionObserverEntry>();\n    const observerCallbackSync = () => {\n      const entries = Array.from(entriesAccumulator.values());\n\n      entries.forEach((entry: IntersectionObserverEntry) => {\n        const callback = callbacks.get(entry.target);\n        if (callback) {\n          callback!(entry, entries);\n        }\n      });\n\n      if (rootCallbackRef.current) {\n        rootCallbackRef.current(entries);\n      }\n\n      entriesAccumulator.clear();\n    };\n    const scheduler = throttleMs ? throttle : debounceMs ? debounce : undefined;\n    const observerCallback = scheduler\n      ? scheduler(observerCallbackSync, (throttleMs || debounceMs)!, !shouldSkipFirst)\n      : observerCallbackSync;\n    const observer = new IntersectionObserver(\n      (entries) => {\n        entries.forEach((entry) => {\n          entriesAccumulator.set(entry.target, entry);\n        });\n\n        if (freezeFlagsRef.current) {\n          onUnfreezeRef.current = () => {\n            observerCallback();\n          };\n        } else {\n          observerCallback();\n        }\n      },\n      {\n        root: rootRef.current,\n        rootMargin: margin ? `${margin}px` : undefined,\n        threshold,\n      },\n    );\n\n    controllerRef.current = { observer, callbacks };\n  }\n\n  const observe = useCallback((target, targetCallback) => {\n    if (!controllerRef.current) {\n      initController();\n    }\n\n    const controller = controllerRef.current!;\n    controller.observer.observe(target);\n\n    if (targetCallback) {\n      controller.callbacks.set(target, targetCallback);\n    }\n\n    return () => {\n      if (targetCallback) {\n        controller.callbacks.delete(target);\n      }\n\n      controller.observer.unobserve(target);\n    };\n    // Arguments should never change\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isDisabled]);\n\n  return { observe, freeze, unfreeze };\n}\n\nexport function useOnIntersect(\n  targetRef: RefObject<HTMLDivElement>, observe?: ObserveFn, callback?: TargetCallback,\n) {\n  useEffect(() => {\n    return observe ? observe(targetRef.current!, callback) : undefined;\n    // Arguments should never change\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n}\n\nexport function useIsIntersecting(\n  targetRef: RefObject<HTMLDivElement>, observe?: ObserveFn, callback?: TargetCallback,\n) {\n  const [isIntersecting, setIsIntersecting] = useState(!observe);\n\n  useOnIntersect(targetRef, observe, (entry) => {\n    setIsIntersecting(entry.isIntersecting);\n\n    if (callback) {\n      callback(entry);\n    }\n  });\n\n  return isIntersecting;\n}\n","import { useLayoutEffect } from '../lib/teact/teact';\nimport usePrevious from './usePrevious';\n\nexport default <T extends any[], PT = T>(cb: (args: PT) => void, dependencies: T, debugKey?: string) => {\n  const prevDeps = usePrevious<T>(dependencies);\n  return useLayoutEffect(() => {\n    // @ts-ignore (workaround for \"could be instantiated with a different subtype\" issue)\n    return cb(prevDeps || []);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, dependencies, debugKey);\n};\n","import { useEffect } from '../lib/teact/teact';\n\nimport { ApiMediaFormat } from '../api/types';\n\nimport * as mediaLoader from '../util/mediaLoader';\nimport useForceUpdate from './useForceUpdate';\n\nexport default <T extends ApiMediaFormat = ApiMediaFormat.BlobUrl>(\n  mediaHash: string | false | undefined,\n  noLoad = false,\n  // @ts-ignore (workaround for \"could be instantiated with a different subtype\" issue)\n  mediaFormat: T = ApiMediaFormat.BlobUrl,\n  cacheBuster?: number,\n  delay?: number | false,\n) => {\n  const mediaData = mediaHash ? mediaLoader.getFromMemory<T>(mediaHash) : undefined;\n  const forceUpdate = useForceUpdate();\n\n  useEffect(() => {\n    if (!noLoad && mediaHash && !mediaData) {\n      const startedAt = Date.now();\n\n      mediaLoader.fetch(mediaHash, mediaFormat).then(() => {\n        const spentTime = Date.now() - startedAt;\n        if (!delay || spentTime >= delay) {\n          forceUpdate();\n        } else {\n          setTimeout(forceUpdate, delay - spentTime);\n        }\n      });\n    }\n  }, [noLoad, mediaHash, mediaData, mediaFormat, cacheBuster, forceUpdate, delay]);\n\n  return mediaData;\n};\n","import React, { useCallback, useEffect, useState } from '../lib/teact/teact';\n\nimport useMediaWithDownloadProgress from './useMediaWithDownloadProgress';\nimport download from '../util/download';\n\nexport default function useMediaDownload(\n  mediaHash?: string,\n  fileName?: string,\n) {\n  const [isDownloadStarted, setIsDownloadStarted] = useState(false);\n\n  const { mediaData, downloadProgress } = useMediaWithDownloadProgress(mediaHash, !isDownloadStarted);\n\n  // Download with browser when fully loaded\n  useEffect(() => {\n    if (isDownloadStarted && mediaData) {\n      download(mediaData, fileName!);\n      setIsDownloadStarted(false);\n    }\n  }, [fileName, mediaData, isDownloadStarted]);\n\n  // Cancel download on source change\n  useEffect(() => {\n    setIsDownloadStarted(false);\n  }, [mediaHash]);\n\n  const handleDownloadClick = useCallback((e: React.SyntheticEvent<HTMLElement>) => {\n    e.stopPropagation();\n    setIsDownloadStarted((isAllowed) => !isAllowed);\n  }, []);\n\n  return {\n    isDownloadStarted,\n    downloadProgress,\n    handleDownloadClick,\n  };\n}\n","import {\n  useEffect, useMemo, useRef, useState,\n} from '../lib/teact/teact';\n\nimport { IS_PROGRESSIVE_SUPPORTED } from '../util/environment';\nimport { ApiMediaFormat } from '../api/types';\nimport { throttle } from '../util/schedulers';\nimport * as mediaLoader from '../util/mediaLoader';\nimport useForceUpdate from './useForceUpdate';\n\nconst STREAMING_PROGRESS = 0.75;\nconst STREAMING_TIMEOUT = 1500;\nconst PROGRESS_THROTTLE = 500;\n\nexport default <T extends ApiMediaFormat = ApiMediaFormat.BlobUrl>(\n  mediaHash: string | undefined,\n  noLoad = false,\n  // @ts-ignore (workaround for \"could be instantiated with a different subtype\" issue)\n  mediaFormat: T = ApiMediaFormat.BlobUrl,\n  cacheBuster?: number,\n  delay?: number | false,\n  isHtmlAllowed = false,\n) => {\n  const mediaData = mediaHash ? mediaLoader.getFromMemory<T>(mediaHash) : undefined;\n  const isStreaming = mediaFormat === ApiMediaFormat.Stream || (\n    IS_PROGRESSIVE_SUPPORTED && mediaFormat === ApiMediaFormat.Progressive\n  );\n  const forceUpdate = useForceUpdate();\n  const [downloadProgress, setDownloadProgress] = useState(mediaData && !isStreaming ? 1 : 0);\n  const startedAtRef = useRef<number>();\n\n  const handleProgress = useMemo(() => {\n    return throttle((progress: number) => {\n      if (!delay || (Date.now() - startedAtRef.current! > delay)) {\n        setDownloadProgress(progress);\n      }\n    }, PROGRESS_THROTTLE, true);\n  }, [delay]);\n\n  useEffect(() => {\n    if (!noLoad && mediaHash) {\n      if (!mediaData) {\n        setDownloadProgress(0);\n\n        if (startedAtRef.current) {\n          mediaLoader.cancelProgress(handleProgress);\n        }\n\n        startedAtRef.current = Date.now();\n\n        mediaLoader.fetch(mediaHash, mediaFormat, isHtmlAllowed, handleProgress).then(() => {\n          const spentTime = Date.now() - startedAtRef.current!;\n          startedAtRef.current = undefined;\n\n          if (!delay || spentTime >= delay) {\n            forceUpdate();\n          } else {\n            setTimeout(forceUpdate, delay - spentTime);\n          }\n        });\n      } else if (isStreaming) {\n        setTimeout(() => {\n          setDownloadProgress(STREAMING_PROGRESS);\n        }, STREAMING_TIMEOUT);\n      }\n    }\n  }, [\n    noLoad, mediaHash, mediaData, mediaFormat, cacheBuster, forceUpdate, isStreaming, delay, handleProgress,\n    isHtmlAllowed,\n  ]);\n\n  useEffect(() => {\n    if (noLoad && startedAtRef.current) {\n      mediaLoader.cancelProgress(handleProgress);\n      setDownloadProgress(0);\n    }\n  }, [handleProgress, noLoad]);\n\n  return { mediaData, downloadProgress };\n};\n","import { useCallback, useEffect, useRef } from '../lib/teact/teact';\n\nimport { IS_TOUCH_ENV } from '../util/environment';\n\nconst MENU_CLOSE_TIMEOUT = 250;\nlet closeTimeout: number | undefined;\n\nexport default function useMouseInside(\n  isOpen: boolean, onClose: NoneToVoidFunction, menuCloseTimeout = MENU_CLOSE_TIMEOUT, isDisabled = false,\n) {\n  const isMouseInside = useRef(true);\n\n  useEffect(() => {\n    if (isOpen) {\n      isMouseInside.current = true;\n    }\n  }, [isOpen]);\n\n  useEffect(() => {\n    if (closeTimeout) {\n      clearTimeout(closeTimeout);\n      closeTimeout = undefined;\n    }\n\n    if (isOpen && !IS_TOUCH_ENV && !isDisabled) {\n      closeTimeout = window.setTimeout(() => {\n        if (!isMouseInside.current) {\n          onClose();\n        }\n      }, menuCloseTimeout * 2);\n    }\n  }, [isDisabled, isOpen, menuCloseTimeout, onClose]);\n\n  const handleMouseEnter = useCallback(() => {\n    isMouseInside.current = true;\n  }, []);\n\n  const handleMouseLeave = useCallback(() => {\n    isMouseInside.current = false;\n\n    if (closeTimeout) {\n      clearTimeout(closeTimeout);\n      closeTimeout = undefined;\n    }\n\n    closeTimeout = window.setTimeout(() => {\n      if (!isMouseInside.current) {\n        onClose();\n      }\n    }, menuCloseTimeout);\n  }, [menuCloseTimeout, onClose]);\n\n  return [handleMouseEnter, handleMouseLeave];\n}\n","import { useRef } from '../lib/teact/teact';\n\nimport usePrevious from './usePrevious';\nimport useForceUpdate from './useForceUpdate';\nimport useOnChange from './useOnChange';\n\nexport default function usePrevDuringAnimation(current: any, duration?: number) {\n  const prev = usePrevious(current, true);\n  const timeoutRef = useRef<number>();\n  const forceUpdate = useForceUpdate();\n  // eslint-disable-next-line no-null/no-null\n  const isCurrentPresent = current !== undefined && current !== null;\n  // eslint-disable-next-line no-null/no-null\n  const isPrevPresent = prev !== undefined && prev !== null;\n\n  if (isCurrentPresent && timeoutRef.current) {\n    clearTimeout(timeoutRef.current);\n    timeoutRef.current = undefined;\n  }\n\n  useOnChange(() => {\n    // When `current` becomes empty\n    if (duration && !isCurrentPresent && isPrevPresent && !timeoutRef.current) {\n      timeoutRef.current = window.setTimeout(() => {\n        timeoutRef.current = undefined;\n        forceUpdate();\n      }, duration);\n    }\n  }, [current]);\n\n  return !timeoutRef.current || !duration || isCurrentPresent ? current : prev;\n}\n","import { useState, useCallback, useRef } from '../lib/teact/teact';\n\nexport type ReducerAction<Actions> = { type: Actions; payload?: any };\nexport type StateReducer<State, Actions> = (state: State, action: ReducerAction<Actions>) => State;\nexport type Dispatch<Actions> = (action: ReducerAction<Actions>) => void;\n\nexport default function useReducer<State, Actions>(\n  reducer: StateReducer<State, Actions>,\n  initialState: State,\n) {\n  const reducerRef = useRef(reducer);\n  const [state, setState] = useState<State>(initialState);\n\n  const dispatch = useCallback((action: ReducerAction<Actions>) => {\n    setState((currentState) => reducerRef.current(currentState, action));\n  }, []);\n\n  return [\n    state,\n    dispatch,\n  ] as [State, Dispatch<Actions>];\n}\n","import { useEffect, useRef, useState } from '../lib/teact/teact';\n\nimport useShowTransition from './useShowTransition';\n\nconst SPEED = {\n  fast: 200,\n  slow: 350,\n};\n\nexport default (mediaData?: any, speed: keyof typeof SPEED = 'fast', noAnimate = false) => {\n  const isMediaLoaded = Boolean(mediaData);\n  const willAnimate = !useRef(isMediaLoaded).current && !noAnimate;\n  const [shouldRenderThumb, setShouldRenderThumb] = useState(!isMediaLoaded);\n\n  const {\n    shouldRender: shouldRenderFullMedia,\n    transitionClassNames,\n  } = useShowTransition(isMediaLoaded, undefined, !willAnimate, speed);\n\n  useEffect(() => {\n    if (shouldRenderFullMedia) {\n      if (willAnimate) {\n        setTimeout(() => {\n          setShouldRenderThumb(false);\n        }, SPEED[speed]);\n      } else {\n        setShouldRenderThumb(false);\n      }\n    }\n  }, [willAnimate, shouldRenderFullMedia, speed]);\n\n  return {\n    shouldRenderThumb,\n    shouldRenderFullMedia,\n    transitionClassNames,\n  };\n};\n","import { RefObject } from 'react';\nimport { useEffect } from '../lib/teact/teact';\nimport { fastRaf } from '../util/schedulers';\n\n// Fix for memory leak when unmounting video element\nexport default function useVideoCleanup(videoRef: RefObject<HTMLVideoElement>, dependencies: any[]) {\n  useEffect(() => {\n    const videoEl = videoRef.current;\n\n    return () => {\n      if (videoEl) {\n        fastRaf(() => {\n          videoEl.pause();\n          videoEl.src = '';\n          videoEl.load();\n        });\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, dependencies);\n}\n","/* eslint-disable no-nested-ternary */\n/* eslint-disable no-bitwise */\n/* eslint-disable no-multi-assign */\n/* eslint-disable no-cond-assign */\n/* eslint-disable no-param-reassign */\n/* eslint-disable prefer-const */\n/* eslint-disable eqeqeq */\n\n/*\nSuperfast Blur - a fast Box Blur For Canvas\n\nVersion:     0.5\nAuthor:        Mario Klingemann\nContact:     mario@quasimondo.com\nWebsite:    http://www.quasimondo.com/BoxBlurForCanvas\nTwitter:    @quasimondo\n\nIn case you find this class useful - especially in commercial projects -\nI am not totally unhappy for a small donation to my PayPal account\nmario@quasimondo.de\n\nOr support me on flattr:\nhttps://flattr.com/thing/140066/Superfast-Blur-a-pretty-fast-Box-Blur-Effect-for-CanvasJavascript\n\nCopyright (c) 2011 Mario Klingemann\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n\n// eslint-disable-next-line max-len\nconst mul_table = [1, 57, 41, 21, 203, 34, 97, 73, 227, 91, 149, 62, 105, 45, 39, 137, 241, 107, 3, 173, 39, 71, 65, 238, 219, 101, 187, 87, 81, 151, 141, 133, 249, 117, 221, 209, 197, 187, 177, 169, 5, 153, 73, 139, 133, 127, 243, 233, 223, 107, 103, 99, 191, 23, 177, 171, 165, 159, 77, 149, 9, 139, 135, 131, 253, 245, 119, 231, 224, 109, 211, 103, 25, 195, 189, 23, 45, 175, 171, 83, 81, 79, 155, 151, 147, 9, 141, 137, 67, 131, 129, 251, 123, 30, 235, 115, 113, 221, 217, 53, 13, 51, 50, 49, 193, 189, 185, 91, 179, 175, 43, 169, 83, 163, 5, 79, 155, 19, 75, 147, 145, 143, 35, 69, 17, 67, 33, 65, 255, 251, 247, 243, 239, 59, 29, 229, 113, 111, 219, 27, 213, 105, 207, 51, 201, 199, 49, 193, 191, 47, 93, 183, 181, 179, 11, 87, 43, 85, 167, 165, 163, 161, 159, 157, 155, 77, 19, 75, 37, 73, 145, 143, 141, 35, 138, 137, 135, 67, 33, 131, 129, 255, 63, 250, 247, 61, 121, 239, 237, 117, 29, 229, 227, 225, 111, 55, 109, 216, 213, 211, 209, 207, 205, 203, 201, 199, 197, 195, 193, 48, 190, 47, 93, 185, 183, 181, 179, 178, 176, 175, 173, 171, 85, 21, 167, 165, 41, 163, 161, 5, 79, 157, 78, 154, 153, 19, 75, 149, 74, 147, 73, 144, 143, 71, 141, 140, 139, 137, 17, 135, 134, 133, 66, 131, 65, 129, 1];\n// eslint-disable-next-line max-len\nconst shg_table = [0, 9, 10, 10, 14, 12, 14, 14, 16, 15, 16, 15, 16, 15, 15, 17, 18, 17, 12, 18, 16, 17, 17, 19, 19, 18, 19, 18, 18, 19, 19, 19, 20, 19, 20, 20, 20, 20, 20, 20, 15, 20, 19, 20, 20, 20, 21, 21, 21, 20, 20, 20, 21, 18, 21, 21, 21, 21, 20, 21, 17, 21, 21, 21, 22, 22, 21, 22, 22, 21, 22, 21, 19, 22, 22, 19, 20, 22, 22, 21, 21, 21, 22, 22, 22, 18, 22, 22, 21, 22, 22, 23, 22, 20, 23, 22, 22, 23, 23, 21, 19, 21, 21, 21, 23, 23, 23, 22, 23, 23, 21, 23, 22, 23, 18, 22, 23, 20, 22, 23, 23, 23, 21, 22, 20, 22, 21, 22, 24, 24, 24, 24, 24, 22, 21, 24, 23, 23, 24, 21, 24, 23, 24, 22, 24, 24, 22, 24, 24, 22, 23, 24, 24, 24, 20, 23, 22, 23, 24, 24, 24, 24, 24, 24, 24, 23, 21, 23, 22, 23, 24, 24, 24, 22, 24, 24, 24, 23, 22, 24, 24, 25, 23, 25, 25, 23, 24, 25, 25, 24, 22, 25, 25, 25, 24, 23, 24, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 23, 25, 23, 24, 25, 25, 25, 25, 25, 25, 25, 25, 25, 24, 22, 25, 25, 23, 25, 25, 20, 24, 25, 24, 25, 25, 22, 24, 25, 24, 25, 24, 25, 25, 24, 25, 25, 25, 25, 22, 25, 25, 25, 24, 25, 24, 25, 18];\n\nexport default function boxBlurCanvasRGB(context, top_x, top_y, width, height, radius, iterations) {\n  if (Number.isNaN(radius) || radius < 1) return;\n\n  radius |= 0;\n\n  if (Number.isNaN(iterations)) iterations = 1;\n  iterations |= 0;\n  if (iterations > 3) iterations = 3;\n  if (iterations < 1) iterations = 1;\n\n  const imageData = context.getImageData(top_x, top_y, width, height);\n\n  const pixels = imageData.data;\n\n  let rsum;\n  let gsum;\n  let bsum;\n  let x;\n  let y;\n  let i;\n  let p;\n  let p1;\n  let p2;\n  let yp;\n  let yi;\n  let yw;\n  let wm = width - 1;\n  let hm = height - 1;\n  let rad1 = radius + 1;\n\n  let r = [];\n  let g = [];\n  let b = [];\n\n  let mul_sum = mul_table[radius];\n  let shg_sum = shg_table[radius];\n\n  let vmin = [];\n  let vmax = [];\n\n  while (iterations-- > 0) {\n    yw = yi = 0;\n\n    for (y = 0; y < height; y++) {\n      rsum = pixels[yw] * rad1;\n      gsum = pixels[yw + 1] * rad1;\n      bsum = pixels[yw + 2] * rad1;\n\n      for (i = 1; i <= radius; i++) {\n        p = yw + (((i > wm ? wm : i)) << 2);\n        rsum += pixels[p++];\n        gsum += pixels[p++];\n        bsum += pixels[p++];\n      }\n\n      for (x = 0; x < width; x++) {\n        r[yi] = rsum;\n        g[yi] = gsum;\n        b[yi] = bsum;\n\n        if (y == 0) {\n          vmin[x] = ((p = x + rad1) < wm ? p : wm) << 2;\n          vmax[x] = ((p = x - radius) > 0 ? p << 2 : 0);\n        }\n\n        p1 = yw + vmin[x];\n        p2 = yw + vmax[x];\n\n        rsum += pixels[p1++] - pixels[p2++];\n        gsum += pixels[p1++] - pixels[p2++];\n        bsum += pixels[p1++] - pixels[p2++];\n\n        yi++;\n      }\n      yw += (width << 2);\n    }\n\n    for (x = 0; x < width; x++) {\n      yp = x;\n      rsum = r[yp] * rad1;\n      gsum = g[yp] * rad1;\n      bsum = b[yp] * rad1;\n\n      for (i = 1; i <= radius; i++) {\n        yp += (i > hm ? 0 : width);\n        rsum += r[yp];\n        gsum += g[yp];\n        bsum += b[yp];\n      }\n\n      yi = x << 2;\n      for (y = 0; y < height; y++) {\n        pixels[yi] = (rsum * mul_sum) >>> shg_sum;\n        pixels[yi + 1] = (gsum * mul_sum) >>> shg_sum;\n        pixels[yi + 2] = (bsum * mul_sum) >>> shg_sum;\n\n        if (x == 0) {\n          vmin[y] = ((p = y + rad1) < hm ? p : hm) * width;\n          vmax[y] = ((p = y - radius) > 0 ? p * width : 0);\n        }\n\n        p1 = x + vmin[y];\n        p2 = x + vmax[y];\n\n        rsum += r[p1] - r[p2];\n        gsum += g[p1] - g[p2];\n        bsum += b[p1] - b[p2];\n\n        yi += width << 2;\n      }\n    }\n  }\n\n  context.putImageData(imageData, top_x, top_y);\n}\n","import { IS_SAFARI } from './environment';\nimport safePlay from './safePlay';\nimport { patchSafariProgressiveAudio, isSafariPatchInProgress } from './patchSafariProgressiveAudio';\nimport { getDispatch } from '../lib/teact/teactn';\nimport { parseMessageKey } from '../modules/helpers';\n\ntype Handler = (eventName: string, e: Event) => void;\n\ninterface Track {\n  audio: HTMLAudioElement;\n  proxy: HTMLAudioElement;\n  handlers: Handler[];\n  onForcePlay?: NoneToVoidFunction;\n}\n\nconst tracks = new Map<string, Track>();\nlet queue: string[] = [];\n\nlet currentTrackId: string | undefined;\n\nfunction createAudio(trackId: string, onForcePlay?: NoneToVoidFunction) {\n  const audio = new Audio();\n\n  function handleEvent(eventName: string) {\n    return (e: Event) => {\n      if (!tracks.has(trackId)) {\n        return;\n      }\n\n      if (isSafariPatchInProgress(audio)) {\n        return;\n      }\n\n      tracks.get(trackId)!.handlers.forEach((handler) => {\n        handler(eventName, e);\n      });\n    };\n  }\n\n  audio.addEventListener('timeupdate', handleEvent('onTimeUpdate'));\n  audio.addEventListener('play', handleEvent('onPlay'));\n  audio.addEventListener('pause', handleEvent('onPause'));\n  audio.addEventListener('loadstart', handleEvent('onLoadStart'));\n  audio.addEventListener('loadeddata', handleEvent('onLoadedData'));\n  audio.addEventListener('playing', handleEvent('onPlaying'));\n  audio.addEventListener('ended', () => {\n    if (isSafariPatchInProgress(audio)) {\n      return;\n    }\n\n    const nextTrackId = queue[queue.indexOf(trackId) + 1];\n    if (!nextTrackId) {\n      return;\n    }\n\n    if (!tracks.has(nextTrackId)) {\n      // A bit hacky way to continue playlist when switching chat\n      getDispatch().openAudioPlayer(parseMessageKey(nextTrackId));\n\n      return;\n    }\n\n    const nextTrack = tracks.get(nextTrackId)!;\n\n    if (nextTrack.onForcePlay) {\n      nextTrack.onForcePlay();\n    }\n\n    currentTrackId = nextTrackId;\n\n    if (nextTrack.audio.src) {\n      safePlay(nextTrack.audio);\n    }\n  });\n\n  return {\n    audio,\n    proxy: new Proxy(audio, {\n      get: (origin, key: keyof HTMLAudioElement) => origin[key],\n    }),\n    handlers: [],\n    onForcePlay,\n  };\n}\n\nexport function stopCurrentAudio() {\n  const currentTrack = currentTrackId && tracks.get(currentTrackId);\n  if (currentTrack) {\n    currentTrack.audio.pause();\n  }\n}\n\nexport function register(trackId: string, handler: Handler, onForcePlay?: NoneToVoidFunction) {\n  if (!tracks.has(trackId)) {\n    tracks.set(trackId, createAudio(trackId, onForcePlay));\n\n    if (!queue.includes(trackId)) {\n      queue.push(trackId);\n    }\n  }\n\n  const { audio, proxy, handlers } = tracks.get(trackId)!;\n\n  handlers.push(handler);\n\n  return {\n    play(src: string) {\n      if (currentTrackId && currentTrackId !== trackId) {\n        tracks.get(currentTrackId)!.audio.pause();\n      }\n\n      currentTrackId = trackId;\n\n      if (!audio.src) {\n        audio.src = src;\n        audio.preload = 'auto';\n\n        if (src.includes('/progressive/') && IS_SAFARI) {\n          patchSafariProgressiveAudio(audio);\n        }\n      }\n\n      safePlay(audio);\n    },\n\n    pause() {\n      if (currentTrackId === trackId) {\n        audio.pause();\n      }\n    },\n\n    setCurrentTime(time: number) {\n      if (currentTrackId === trackId) {\n        audio.currentTime = time;\n      }\n    },\n\n    proxy,\n\n    destroy(shouldRemoveFromQueue = false) {\n      const track = tracks.get(trackId);\n      if (!track) {\n        return;\n      }\n\n      track.handlers = track.handlers.filter((h) => h !== handler);\n\n      if (!track.handlers.length) {\n        track.audio.pause();\n        tracks.delete(trackId);\n\n        if (shouldRemoveFromQueue) {\n          queue = queue.filter((id) => id !== trackId);\n        }\n\n        if (trackId === currentTrackId) {\n          currentTrackId = undefined;\n        }\n      }\n    },\n  };\n}\n","import { IS_IOS } from './environment';\n\nexport enum SwipeDirection {\n  Up,\n  Down,\n  Left,\n  Right,\n}\n\ninterface CaptureOptions {\n  onCapture?: (e: MouseEvent | TouchEvent) => void;\n  onRelease?: (e: MouseEvent | TouchEvent) => void;\n  onDrag?: (\n    e: MouseEvent | TouchEvent,\n    captureEvent: MouseEvent | TouchEvent,\n    params: {\n      dragOffsetX: number;\n      dragOffsetY: number;\n    },\n  ) => void;\n  onSwipe?: (e: Event, direction: SwipeDirection) => boolean;\n  onClick?: (e: MouseEvent | TouchEvent) => void;\n  excludedClosestSelector?: string;\n  selectorToPreventScroll?: string;\n  withCursor?: boolean;\n}\n\n// https://stackoverflow.com/questions/11287877/how-can-i-get-e-offsetx-on-mobile-ipad\n// Android does not have this value, and iOS has it but as read-only\nexport interface RealTouchEvent extends TouchEvent {\n  pageX?: number;\n  pageY?: number;\n}\n\ntype TSwipeAxis =\n  'x'\n  | 'y'\n  | undefined;\n\nconst IOS_SCREEN_EDGE_THRESHOLD = 20;\nconst MOVED_THRESHOLD = 15;\nconst SWIPE_THRESHOLD = 50;\n\nexport function captureEvents(element: HTMLElement, options: CaptureOptions) {\n  let captureEvent: MouseEvent | RealTouchEvent | undefined;\n  let hasMoved = false;\n  let hasSwiped = false;\n  let initialSwipeAxis: TSwipeAxis | undefined;\n\n  function onCapture(e: MouseEvent | RealTouchEvent) {\n    if (options.excludedClosestSelector && (\n      (e.target as HTMLElement).matches(options.excludedClosestSelector)\n      || (e.target as HTMLElement).closest(options.excludedClosestSelector)\n    )) {\n      return;\n    }\n\n    captureEvent = e;\n\n    if (e.type === 'mousedown') {\n      document.addEventListener('mousemove', onMove);\n      document.addEventListener('mouseup', onRelease);\n    } else if (e.type === 'touchstart') {\n      // We need to always listen on `touchstart` target:\n      // https://stackoverflow.com/questions/33298828/touch-move-event-dont-fire-after-touch-start-target-is-removed\n      const target = e.target as HTMLElement;\n      target.addEventListener('touchmove', onMove, { passive: true });\n      target.addEventListener('touchend', onRelease);\n      target.addEventListener('touchcancel', onRelease);\n\n      if ('touches' in e) {\n        if (e.pageX === undefined) {\n          e.pageX = e.touches[0].pageX;\n        }\n\n        if (e.pageY === undefined) {\n          e.pageY = e.touches[0].pageY;\n        }\n      }\n    }\n\n    document.body.classList.add('no-selection');\n    if (options.withCursor) {\n      document.body.classList.add('cursor-grabbing');\n    }\n\n    if (options.onCapture) {\n      options.onCapture(e);\n    }\n  }\n\n  function onRelease(e: MouseEvent | TouchEvent) {\n    if (captureEvent) {\n      if (options.withCursor) {\n        document.body.classList.remove('cursor-grabbing');\n      }\n      document.body.classList.remove('no-selection');\n\n      document.removeEventListener('mouseup', onRelease);\n      document.removeEventListener('mousemove', onMove);\n      (captureEvent.target as HTMLElement).removeEventListener('touchcancel', onRelease);\n      (captureEvent.target as HTMLElement).removeEventListener('touchend', onRelease);\n      (captureEvent.target as HTMLElement).removeEventListener('touchmove', onMove);\n\n      captureEvent = undefined;\n\n      if (IS_IOS && options.selectorToPreventScroll) {\n        Array.from(document.querySelectorAll<HTMLElement>(options.selectorToPreventScroll)).forEach((scrollable) => {\n          scrollable.style.overflow = '';\n        });\n      }\n\n      if (hasMoved) {\n        if (options.onRelease) {\n          options.onRelease(e);\n        }\n      } else if (options.onClick && (!('button' in e) || e.button === 0)) {\n        options.onClick(e);\n      }\n    }\n\n    hasMoved = false;\n    hasSwiped = false;\n    initialSwipeAxis = undefined;\n  }\n\n  function onMove(e: MouseEvent | RealTouchEvent) {\n    if (captureEvent) {\n      if (e.type === 'touchmove' && ('touches' in e)) {\n        if (e.pageX === undefined) {\n          e.pageX = e.touches[0].pageX;\n        }\n\n        if (e.pageY === undefined) {\n          e.pageY = e.touches[0].pageY;\n        }\n      }\n\n      const dragOffsetX = e.pageX! - captureEvent.pageX!;\n      const dragOffsetY = e.pageY! - captureEvent.pageY!;\n\n      if (Math.abs(dragOffsetX) >= MOVED_THRESHOLD || Math.abs(dragOffsetY) >= MOVED_THRESHOLD) {\n        hasMoved = true;\n      }\n\n      let shouldPreventScroll = false;\n\n      if (options.onDrag) {\n        options.onDrag(e, captureEvent, { dragOffsetX, dragOffsetY });\n        shouldPreventScroll = true;\n      }\n\n      if (options.onSwipe && !hasSwiped) {\n        hasSwiped = onSwipe(e, dragOffsetX, dragOffsetY);\n        shouldPreventScroll = hasSwiped;\n      }\n\n      if (IS_IOS && shouldPreventScroll && options.selectorToPreventScroll) {\n        Array.from(document.querySelectorAll<HTMLElement>(options.selectorToPreventScroll)).forEach((scrollable) => {\n          scrollable.style.overflow = 'hidden';\n        });\n      }\n    }\n  }\n\n  function onSwipe(e: MouseEvent | RealTouchEvent, dragOffsetX: number, dragOffsetY: number) {\n    // Avoid conflicts with swipe-to-back gestures\n    if (IS_IOS) {\n      const x = (e as RealTouchEvent).touches[0].pageX;\n      if (x <= IOS_SCREEN_EDGE_THRESHOLD || x >= window.innerWidth - IOS_SCREEN_EDGE_THRESHOLD) {\n        return false;\n      }\n    }\n\n    const xAbs = Math.abs(dragOffsetX);\n    const yAbs = Math.abs(dragOffsetY);\n\n    if (dragOffsetX && dragOffsetY) {\n      const ratio = Math.max(xAbs, yAbs) / Math.min(xAbs, yAbs);\n      // Diagonal swipe\n      if (ratio < 2) {\n        return false;\n      }\n    }\n\n    let axis: TSwipeAxis | undefined;\n    if (xAbs >= SWIPE_THRESHOLD) {\n      axis = 'x';\n    } else if (yAbs >= SWIPE_THRESHOLD) {\n      axis = 'y';\n    }\n\n    if (!axis) {\n      return false;\n    }\n\n    if (!initialSwipeAxis) {\n      initialSwipeAxis = axis;\n    } else if (initialSwipeAxis !== axis) {\n      // Prevent horizontal swipe after vertical to prioritize scroll\n      return false;\n    }\n\n    return processSwipe(e, axis, dragOffsetX, dragOffsetY, options.onSwipe!);\n  }\n\n  element.addEventListener('mousedown', onCapture);\n  element.addEventListener('touchstart', onCapture, { passive: true });\n\n  return () => {\n    element.removeEventListener('mousedown', onCapture);\n    element.removeEventListener('touchstart', onCapture);\n  };\n}\n\nfunction processSwipe(\n  e: Event,\n  currentSwipeAxis: TSwipeAxis,\n  dragOffsetX: number,\n  dragOffsetY: number,\n  onSwipe: (e: Event, direction: SwipeDirection) => boolean,\n) {\n  if (currentSwipeAxis === 'x') {\n    if (dragOffsetX < 0) {\n      return onSwipe(e, SwipeDirection.Left);\n    } else {\n      return onSwipe(e, SwipeDirection.Right);\n    }\n  } else if (currentSwipeAxis === 'y') {\n    if (dragOffsetY < 0) {\n      return onSwipe(e, SwipeDirection.Up);\n    } else {\n      return onSwipe(e, SwipeDirection.Down);\n    }\n  }\n\n  return false;\n}\n","import { DEBUG } from '../config';\n\nexport const CLIPBOARD_ITEM_SUPPORTED = navigator.clipboard && window.ClipboardItem;\n\nconst textCopyEl = document.createElement('textarea');\ntextCopyEl.setAttribute('readonly', '');\ntextCopyEl.tabIndex = -1;\ntextCopyEl.className = 'visually-hidden';\n\nexport const copyTextToClipboard = (str: string): void => {\n  textCopyEl.value = str;\n  document.body.appendChild(textCopyEl);\n  const selection = document.getSelection();\n\n  if (selection) {\n    // Store previous selection\n    const rangeToRestore = selection.rangeCount > 0 && selection.getRangeAt(0);\n    textCopyEl.select();\n    document.execCommand('copy');\n    // Restore the original selection\n    if (rangeToRestore) {\n      selection.removeAllRanges();\n      selection.addRange(rangeToRestore);\n    }\n  }\n\n  document.body.removeChild(textCopyEl);\n};\n\nexport const copyImageToClipboard = (imageUrl?: string) => {\n  if (!imageUrl) return;\n  const canvas = document.createElement('canvas');\n  const ctx = canvas.getContext('2d');\n  const imageEl = new Image();\n  imageEl.onload = (e: Event) => {\n    if (ctx && e.currentTarget) {\n      const img = e.currentTarget as HTMLImageElement;\n      canvas.width = img.width;\n      canvas.height = img.height;\n      ctx.drawImage(img, 0, 0, img.width, img.height);\n      canvas.toBlob(copyBlobToClipboard, 'image/png', 1);\n    }\n  };\n\n  imageEl.src = imageUrl;\n};\n\nasync function copyBlobToClipboard(pngBlob: Blob | null) {\n  if (!pngBlob || !CLIPBOARD_ITEM_SUPPORTED) {\n    return;\n  }\n\n  try {\n    await navigator.clipboard.write([\n      new window.ClipboardItem({\n        [pngBlob.type]: pngBlob,\n      }),\n    ]);\n  } catch (error) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.error(error);\n    }\n  }\n}\n","// Sometimes event is fired earlier than animation completes\nconst ANIMATION_END_DELAY = 50;\n\nexport function waitForTransitionEnd(node: Node, handler: NoneToVoidFunction, propertyName?: string) {\n  waitForEndEvent('transitionend', node, handler, propertyName);\n}\n\nexport function waitForAnimationEnd(node: Node, handler: NoneToVoidFunction, animationName?: string) {\n  waitForEndEvent('animationend', node, handler, animationName);\n}\n\nfunction waitForEndEvent(\n  eventType: 'transitionend' | 'animationend',\n  node: Node,\n  handler: NoneToVoidFunction,\n  detailedName?: string,\n) {\n  let isHandled = false;\n\n  node.addEventListener(eventType, function handleAnimationEnd(e: TransitionEvent | AnimationEvent) {\n    if (isHandled || e.target !== e.currentTarget) {\n      return;\n    }\n\n    if (detailedName && (\n      (e instanceof TransitionEvent && e.propertyName === detailedName)\n      || (e instanceof AnimationEvent && e.animationName === detailedName)\n    )) {\n      return;\n    }\n\n    isHandled = true;\n\n    node.removeEventListener(eventType, handleAnimationEnd as EventListener);\n\n    setTimeout(() => {\n      handler();\n    }, ANIMATION_END_DELAY);\n  } as EventListener);\n}\n","export default function cycleRestrict(length: number, index: number) {\n  return index - Math.floor(index / length) * length;\n}\n","export default function download(url: string, filename: string) {\n  const link = document.createElement('a');\n  link.href = url;\n  link.download = filename;\n  link.click();\n}\n","import { getGlobal } from '../lib/teact/teactn';\n\nimport { FocusDirection } from '../types';\n\nimport {\n  ANIMATION_LEVEL_MIN,\n  FAST_SMOOTH_MAX_DISTANCE, FAST_SMOOTH_MAX_DURATION, FAST_SMOOTH_MIN_DURATION,\n  FAST_SMOOTH_SHORT_TRANSITION_MAX_DISTANCE,\n} from '../config';\nimport { dispatchHeavyAnimationEvent } from '../hooks/useHeavyAnimationCheck';\nimport { animateSingle } from './animation';\n\nlet isAnimating = false;\n\nexport default function fastSmoothScroll(\n  container: HTMLElement,\n  element: HTMLElement,\n  position: ScrollLogicalPosition | 'centerOrTop',\n  margin = 0,\n  maxDistance = FAST_SMOOTH_MAX_DISTANCE,\n  forceDirection?: FocusDirection,\n  forceDuration?: number,\n  forceNormalContainerHeight?: boolean,\n) {\n  const scrollFrom = calculateScrollFrom(container, element, maxDistance, forceDirection);\n\n  if (forceDirection === FocusDirection.Static) {\n    scrollWithJs(container, element, scrollFrom, position, margin, 0);\n    return;\n  }\n\n  if (getGlobal().settings.byKey.animationLevel === ANIMATION_LEVEL_MIN) {\n    forceDuration = 0;\n  }\n\n  scrollWithJs(container, element, scrollFrom, position, margin, forceDuration, forceNormalContainerHeight);\n}\n\nexport function isAnimatingScroll() {\n  return isAnimating;\n}\n\nfunction calculateScrollFrom(\n  container: HTMLElement,\n  element: HTMLElement,\n  maxDistance = FAST_SMOOTH_MAX_DISTANCE,\n  forceDirection?: FocusDirection,\n) {\n  const { offsetTop: elementTop } = element;\n  const { scrollTop } = container;\n\n  if (forceDirection === undefined) {\n    const offset = elementTop - container.scrollTop;\n\n    if (offset < -maxDistance) {\n      return scrollTop + (offset + maxDistance);\n    } else if (offset > maxDistance) {\n      return scrollTop + (offset - maxDistance);\n    }\n  } else if (forceDirection === FocusDirection.Up) {\n    return elementTop + maxDistance;\n  } else if (forceDirection === FocusDirection.Down) {\n    return Math.max(0, elementTop - maxDistance);\n  }\n\n  return scrollTop;\n}\n\nfunction scrollWithJs(\n  container: HTMLElement,\n  element: HTMLElement,\n  scrollFrom: number,\n  position: ScrollLogicalPosition | 'centerOrTop',\n  margin = 0,\n  forceDuration?: number,\n  forceNormalContainerHeight?: boolean,\n) {\n  const { offsetTop: elementTop, offsetHeight: elementHeight } = element;\n  const { scrollTop: currentScrollTop, offsetHeight: containerHeight, scrollHeight } = container;\n  const targetContainerHeight = forceNormalContainerHeight && container.dataset.normalHeight\n    ? Number(container.dataset.normalHeight)\n    : containerHeight;\n\n  if (currentScrollTop !== scrollFrom) {\n    container.scrollTop = scrollFrom;\n  }\n\n  let path!: number;\n\n  switch (position) {\n    case 'start':\n      path = (elementTop - margin) - scrollFrom;\n      break;\n    case 'end':\n      path = (elementTop + elementHeight + margin) - (scrollFrom + targetContainerHeight);\n      break;\n    // 'nearest' is not supported yet\n    case 'nearest':\n    case 'center':\n    case 'centerOrTop':\n      path = elementHeight < targetContainerHeight\n        ? (elementTop + elementHeight / 2) - (scrollFrom + targetContainerHeight / 2)\n        : (elementTop - margin) - scrollFrom;\n      break;\n  }\n\n  if (path < 0) {\n    const remainingPath = -scrollFrom;\n    path = Math.max(path, remainingPath);\n  } else if (path > 0) {\n    const remainingPath = scrollHeight - (scrollFrom + targetContainerHeight);\n    path = Math.min(path, remainingPath);\n  }\n\n  if (path === 0) {\n    return;\n  }\n\n  const target = scrollFrom + path;\n\n  if (forceDuration === 0) {\n    container.scrollTop = target;\n    return;\n  }\n\n  isAnimating = true;\n\n  const absPath = Math.abs(path);\n  const transition = absPath < FAST_SMOOTH_SHORT_TRANSITION_MAX_DISTANCE ? shortTransition : longTransition;\n  const duration = forceDuration || (\n    FAST_SMOOTH_MIN_DURATION\n    + (absPath / FAST_SMOOTH_MAX_DISTANCE) * (FAST_SMOOTH_MAX_DURATION - FAST_SMOOTH_MIN_DURATION)\n  );\n  const startAt = Date.now();\n  const onHeavyAnimationStop = dispatchHeavyAnimationEvent();\n\n  animateSingle(() => {\n    const t = Math.min((Date.now() - startAt) / duration, 1);\n    const currentPath = path * (1 - transition(t));\n\n    container.scrollTop = Math.round(target - currentPath);\n\n    isAnimating = t < 1;\n\n    if (!isAnimating) {\n      onHeavyAnimationStop();\n    }\n\n    return isAnimating;\n  });\n}\n\nfunction longTransition(t: number) {\n  return 1 - ((1 - t) ** 5);\n}\n\nfunction shortTransition(t: number) {\n  return 1 - ((1 - t) ** 3.5);\n}\n","import { getGlobal } from '../lib/teact/teactn';\n\nimport { ANIMATION_LEVEL_MIN } from '../config';\nimport { IS_IOS } from './environment';\nimport { animate } from './animation';\n\nconst DEFAULT_DURATION = 300;\n\nexport default function fastSmoothScrollHorizontal(container: HTMLElement, left: number, duration = DEFAULT_DURATION) {\n  if (getGlobal().settings.byKey.animationLevel === ANIMATION_LEVEL_MIN) {\n    duration = 0;\n  }\n\n  // Native way seems to be smoother in Chrome\n  if (!IS_IOS) {\n    container.scrollTo({\n      left,\n      ...(duration && { behavior: 'smooth' }),\n    });\n  } else {\n    scrollWithJs(container, left, duration);\n  }\n}\n\nfunction scrollWithJs(container: HTMLElement, left: number, duration: number) {\n  const { scrollLeft, offsetWidth: containerWidth, scrollWidth } = container;\n  let path = left - scrollLeft;\n\n  if (path < 0) {\n    const remainingPath = -scrollLeft;\n    path = Math.max(path, remainingPath);\n  } else if (path > 0) {\n    const remainingPath = scrollWidth - (scrollLeft + containerWidth);\n    path = Math.min(path, remainingPath);\n  }\n\n  if (path === 0) {\n    return;\n  }\n\n  const target = scrollLeft + path;\n\n  if (duration === 0) {\n    container.scrollLeft = target;\n    return;\n  }\n\n  const startAt = Date.now();\n\n  animate(() => {\n    const t = Math.min((Date.now() - startAt) / duration, 1);\n\n    const currentPath = path * (1 - transition(t));\n    container.scrollLeft = Math.round(target - currentPath);\n\n    return t < 1;\n  });\n}\n\nfunction transition(t: number) {\n  return 1 - ((1 - t) ** 3.5);\n}\n","import { IS_TOUCH_ENV } from './environment';\n\nexport default function focusEditableElement(element: HTMLElement, force?: boolean) {\n  if (!force && element === document.activeElement) {\n    return;\n  }\n\n  const selection = window.getSelection()!;\n  const range = document.createRange();\n  const lastChild = element.lastChild || element;\n\n  if (!IS_TOUCH_ENV && (!lastChild || !lastChild.nodeValue)) {\n    element.focus();\n    return;\n  }\n\n  range.selectNodeContents(lastChild);\n  // `false` means collapse to the end rather than the start\n  range.collapse(false);\n  selection.removeAllRanges();\n  selection.addRange(range);\n}\n","/*\n * Thanks to Ace Monkey for this mind-blowing patch.\n */\n\nexport function patchSafariProgressiveAudio(audioEl: HTMLAudioElement) {\n  if (audioEl.dataset.patchedForSafari) {\n    return;\n  }\n\n  audioEl.addEventListener('play', () => {\n    const t = audioEl.currentTime;\n\n    function onProgress() {\n      if (!audioEl.buffered.length) {\n        return;\n      }\n\n      audioEl.dataset.patchForSafariInProgress = 'true';\n      audioEl.currentTime = audioEl.duration - 1;\n      audioEl.addEventListener('progress', () => {\n        delete audioEl.dataset.patchForSafariInProgress;\n        audioEl.currentTime = t;\n        if (audioEl.paused) {\n          audioEl.play();\n        }\n      }, { once: true });\n\n      audioEl.removeEventListener('progress', onProgress);\n    }\n\n    audioEl.addEventListener('progress', onProgress);\n  }, { once: true });\n\n  audioEl.dataset.patchedForSafari = 'true';\n}\n\nexport function isSafariPatchInProgress(audioEl: HTMLAudioElement) {\n  return Boolean(audioEl.dataset.patchForSafariInProgress);\n}\n","import { IS_IOS } from './environment';\n\nexport default (container: HTMLDivElement, scrollTop?: number) => {\n  if (IS_IOS) {\n    container.style.overflow = 'hidden';\n  }\n\n  if (scrollTop !== undefined) {\n    container.scrollTop = scrollTop;\n  }\n\n  if (IS_IOS) {\n    container.style.overflow = '';\n  }\n};\n","import { DEBUG } from '../config';\n\nexport default (mediaEl: HTMLMediaElement) => {\n  mediaEl.play().catch((err) => {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn(err);\n    }\n  });\n};\n"],"names":["WIDTH","large","medium","small","sticker","size","observeIntersection","lastSyncTime","forceLoadPreview","ref","useRef","isAnimationLoaded","markAnimationLoaded","useFlag","localMediaHash","id","isIntersecting","useIsIntersecting","thumbDataUri","thumbnail","dataUri","previewBlobUrl","useMedia","ApiMediaFormat","transitionClassNames","useTransitionForMedia","mediaData","isMediaLoaded","Boolean","playKey","setPlayKey","useState","String","Math","random","handleClick","useCallback","width","style","className","onClick","src","LIKE_STICKER_ID","undefined","alt","key","animationData","quality","play","noLoop","onLoad","lottiePromise","RLottie","async","ensureLottie","default","setTimeout","memo","playSegment","speed","isLowPriority","animation","setAnimation","container","wasPlaying","isFrozen","playRef","current","playSegmentRef","useEffect","exec","newAnimation","setSpeed","then","fastRaf","destroy","playAnimation","shouldRestart","goToAndPlay","pauseAnimation","pause","freezeAnimation","isPlaying","unfreezeAnimation","unfreezeAnimationOnRaf","useHeavyAnimationCheck","useBackgroundMode","fullClassName","buildClassName","MIN_SPIKES","IS_SINGLE_COLUMN_LAYOUT","MAX_SPIKES","renderSeekline","playProgress","bufferedProgress","handleStartSeek","handleSeek","handleStopSeek","onMouseDown","onMouseMove","onMouseUp","theme","message","senderTitle","uploadProgress","target","date","isSelectable","isSelected","onPlay","onReadMedia","onCancelUpload","onDateClick","content","audio","voice","isMediaUnread","isVoice","isSeeking","lang","useLang","isActivated","setIsActivated","shouldDownload","downloadProgress","useMediaWithDownloadProgress","getMessageMediaHash","getMessageMediaFormat","isBuffered","bufferingHandlers","checkBuffering","useBuffering","playPause","setCurrentTime","duration","useAudioPlayer","getMessageKey","getMediaDuration","chatId","isMessageLocal","isDownloadStarted","directDownloadProgress","handleDownloadClick","useMediaDownload","getMessageAudioCaption","isLoadingForPlaying","isUploading","isTransferring","transferProgress","getMediaTransferState","shouldRender","shouldRenderSpinner","spinnerClassNames","useShowTransition","handleButtonClick","e","seekBar","currentTarget","closest","left","getBoundingClientRect","clientX","handleDateClick","seekHandlers","isOwn","isOwnMessage","renderedWaveform","useMemo","waveform","fillColor","fillOwnColor","progressFillColor","progressFillOwnColor","durationFactor","min","spikesCount","round","decodedWaveform","encoded5bit","bitsCount","length","valuesCount","floor","result","Array","bitsData","i","l","byteIndex","bitShift","value","lastByteIndex","lastBitShift","lastValue","decodeWaveform","Uint8Array","data","spikes","peak","fitCount","newData","springFactor","leftFiller","rightFiller","idx","val","interpolateArray","height","progress","fillStyle","progressFillStyle","canvas","document","createElement","ctx","getContext","scale","forEach","item","globalAlpha","spikeHeight","max","x","y","radius","beginPath","moveTo","arcTo","closePath","roundedRectangle","fill","toDataURL","renderWaveformToDataUri","draggable","renderWaveform","buttonClassNames","push","showSeekline","contentClassName","dir","isRtl","Button","ripple","join","ariaLabel","ProgressSpinner","transparent","noCross","renderText","title","fileName","getFirstLine","Link","formatPastTimeShort","formatMediaDuration","performer","getSecondLine","formatMediaDateTime","renderAudio","renderVoice","chat","user","text","withOnlineStatus","isSavedMessages","isDeleted","isDeletedUser","imageHash","getChatAvatarHash","shouldRenderFullMedia","decoding","userFullName","getUserFullName","getFirstLetters","getChatTitle","isChatPrivate","isOnline","isUserOnline","getUserColorKey","senderId","IS_TEST","withGlobal","global","chatOrUserId","countryList","phoneCodes","phoneCodeList","selectChat","selectUser","isMuted","selectIsChatMuted","selectNotifySettings","selectNotifyExceptions","canInviteUsers","isChatChannel","isUserRightBanned","getHasAdminRight","setGlobal","actions","pick","forceShowSelf","loadFullUser","showNotification","updateChatMutedState","userId","fullInfo","username","phoneNumber","isSelf","handleNotificationChange","isRestricted","copy","entity","copyTextToClipboard","formattedNumber","formatPhoneNumberWithCode","link","getChatLink","description","bio","getChatDescription","icon","multiline","narrow","isStatic","label","checked","inactive","isPrivateChat","isChatWithSelf","selectIsChatWithSelf","getPrivateChatUserId","isBot","isUserBot","isSupport","canDeleteForAll","contactName","getUserFirstOrLastName","isChannel","isBasicGroup","isChatBasicGroup","isSuperGroup","isChatSuperGroup","currentUserId","isOpen","onClose","onCloseAnimationEnd","leaveChannel","deleteHistory","deleteChannel","deleteChatUser","blockContact","chatTitle","handleDeleteMessageForAll","shouldDeleteForAll","handleDeleteAndStop","contactId","accessHash","handleDeleteChat","isCreator","header","color","isText","smaller","withDate","datetime","sender","onMediaClick","extension","getDocumentExtension","timestamp","withMediaViewer","mediaType","isDownloadAllowed","setIsDownloadAllowed","hasPreview","getDocumentHasPreview","getMessageMediaThumbDataUri","localBlobUrl","previewData","isAllowed","download","name","thumbnailDataUri","actionIcon","isMessageDocumentVideo","elementRef","shouldSpinnerRender","getColorFromExtension","sizeString","getFileSizeString","shouldRenderThumb","getDocumentThumbnailDimensions","onlineCount","selectChatOnlineCount","areMessagesLoaded","selectChatMessages","typingStatus","avatarSize","withUsername","withFullInfo","withUpdatingStatus","withChatType","noRtl","loadFullChat","openMediaViewer","isMin","handleAvatarViewerOpen","hasPhoto","stopPropagation","avatarOwnerId","origin","MediaViewerOrigin","isVerified","getChatTypeString","handle","groupStatus","chatTypeString","membersCount","getGroupStatus","onlineStatus","renderStatusOrTyping","outgoingStatus","status","idPrefix","mediaBlobUrl","video","getMessageVideo","isGif","Keys","activeKey","itemIds","selectedIds","filterValue","filterPlaceholder","notFoundText","searchInputId","isLoading","noScrollRestore","onSelectedIdsChange","onFilterChange","onLoadMore","inputRef","shouldMinimize","requestAnimationFrame","focus","handleItemClick","newSelectedIds","includes","splice","indexOf","handleFilterChange","viewportIds","getMore","useInfiniteScroll","map","isMinimized","canClose","clickArg","onChange","placeholder","items","iconElement","titleText","serverTimeOffset","noStatusOrTyping","fullName","getUserStatus","photo","isFirstPhoto","getMediaHash","forceAvatar","hash","fullMediaData","startsWith","avatarThumbnailData","useBlurSync","imageSrc","prevImageSrc","usePrevious","Spinner","connectionState","animationLevel","settings","byKey","photos","slideAnimation","currentPhotoIndex","setCurrentPhotoIndex","isFirst","isLast","profile","currentIndex","slice","mediaLoader","usePhotosPreload","handleProfilePhotoClick","profilePhotoIndex","selectPreviousMedia","selectNextMedia","element","querySelector","captureEvents","selectorToPreventScroll","onSwipe","IS_TOUCH_ENV","direction","SwipeDirection","renderPhoto","isVerifiedIconShown","_","renderPhotoTabs","Transition","type","VerifiedIcon","noAnimate","onUnfaveClick","stickerSelector","shouldPlay","lottieData","isAnimated","markLoaded","unmarkLoaded","canAnimatedPlay","shouldRenderPreview","previewTransitionClassNames","emoji","preventMessageInputBlurWithBubbling","preventDefault","props","StickerSetModal","useModuleLoader","Bundles","typingUser","typingUserName","action","replace","trim","onMessageClick","linkData","getMessageWebPage","getFirstLinkInMessage","url","domain","messageText","getMessageSummaryText","siteName","handleMessageClick","displayUrl","truncatedDescription","trimText","MEDIA_VIEWER_MEDIA_QUERY","REM","parseInt","getComputedStyle","documentElement","fontSize","ROUND_VIDEO_DIMENSIONS","AVATAR_FULL_DIMENSIONS","DEFAULT_MEDIA_DIMENSIONS","cachedMaxWidthOwn","cachedMaxWidth","cachedMaxWidthNoAvatar","getAvailableWidth","fromOwnMessage","isForwarded","isWebPagePhoto","noAvatars","extraPaddingRem","regularMaxWidth","windowWidth","windowSize","getMaxMessageWidthRem","calculateDimensionsForMessageMedia","aspectRatio","calculateDimensions","getAvailableHeight","getMediaViewerAvailableDimensions","withFooter","isVideo","mql","window","matchMedia","windowHeight","occupiedHeightRem","matches","calculateInlineImageDimensions","getPhotoInlineDimensions","calculateVideoDimensions","getVideoDimensions","getPictogramDimensions","getStickerDimensions","baseWidth","STICKER_SIZE_INLINE_MOBILE_FACTOR","STICKER_SIZE_INLINE_DESKTOP_FACTOR","calculatedHeight","calculateMediaViewerDimensions","availableWidth","availableHeight","mediaWidth","mediaHeight","calculatedWidth","renderMessageText","highlight","shouldRenderHqEmoji","formattedText","rawText","getMessageText","entities","renderTextWithEntities","organizeEntity","index","organizedEntityIndexes","offset","organizedIndexes","Set","has","nestedEntities","filter","parsedEntity","isChanged","organizedIndex","add","organizeEntities","organizedEntities","organizedEntity","shouldRenderAsHtml","renderMessagePart","deleteLineBreakAfterPre","renderEntity","textPartStart","textPartEnd","isLastEntity","renderResult","textBefore","substring","textBeforeLength","substr","entityStartIndex","entityEndIndex","entityContent","nestedEntityContent","ApiMessageEntityTypes","nestedIndex","nestedEntity","nestedEntityIndex","nestedResult","nestedEntityEndIndex","newEntity","rawEntityText","renderedContent","getLinkUrl","processEntityAsHtml","entityText","handleBotCommandClick","handleHashtagClick","href","rel","processEntity","isArray","textAfter","arrayIndex","c","emojiFilter","getDispatch","sendBotCommand","command","innerText","setLocalTextSearchQuery","query","searchTextMessagesLocal","ChatAnimationTypes","isPinned","isShown","unreadCount","hasUnreadMark","renderContent","unreadMentionsCount","formatIntegerCompact","ShowTransition","isCustom","lastMessage","replyToMessageId","isOutgoing","lastMessageSender","lastMessageAction","getMessageAction","actionTargetMessage","selectChatMessage","targetUserIds","actionTargetUserIds","targetChatId","actionTargetChatId","privateChatUserId","byId","usersById","users","currentChatId","threadId","currentThreadId","messageListType","selectCurrentMessageList","MAIN_THREAD_ID","draft","selectDraft","canScrollDown","lastMessageOutgoingStatus","selectOutgoingStatus","privateChatUser","folderId","orderDiff","animationType","openChat","focusLastMessage","isDeleteModalOpen","openDeleteModal","closeDeleteModal","shouldRenderDeleteModal","markRenderDeleteModal","unmarkRenderDeleteModal","isAction","isActionMessage","useEnsureMessage","mediaThumbnail","getMessageSticker","isRoundVideo","getMessageRoundVideo","actionTargetUsers","useLayoutEffect","Opacity","opacity","classList","Move","transform","remove","ANIMATION_END_DELAY","shouldReplaceHistory","contextActions","useChatContextActions","handleDelete","ListItem","Avatar","LastMessageMeta","TypingStatus","actionOrigin","renderActionMessageText","asPlain","senderName","getMessageSenderName","blobUrl","renderMessageSummary","renderLastMessageOrTyping","DeleteChatModal","folderType","chatFolder","selectChatFolder","animatedEmoji","selectAnimatedEmoji","foldersDispatch","onScreenSelect","handleEditFolder","payload","SettingsScreens","AnimatedEmoji","fluid","pill","FolderTypeToListType","chats","listIds","chatsById","orderedPinnedIds","listType","notifySettings","notifyExceptions","isActive","loadMoreChats","preloadTopChatMessages","openNextChat","currentListIds","currentPinnedIds","prepareFolderListIds","orderById","orderedIds","newChatArrays","prepareChatList","singleList","pinnedChats","otherChats","newOrderedIds","reduce","acc","prevOrderById","orderDiffById","mapValues","order","Infinity","loadMoreOfType","CHAT_LIST_SLICE","ALL_CHATS_PRELOAD_DISABLED","chatArrays","getAnimationType","movesUp","movesDown","orderDiffIds","Object","keys","Number","numberOfUp","numberOfDown","None","useChatAnimationType","handleKeyDown","IS_PWA","IS_MAC_OS","metaKey","ctrlKey","code","digit","match","position","altKey","targetIndexDelta","addEventListener","removeEventListener","InfiniteScroll","preloadBackwards","noFastList","viewportOffset","pinnedOffset","IS_ANDROID","CHAT_HEIGHT_PX","teactFastList","teactOrderKey","getChatOrder","renderChats","Loading","isQuick","onFileSelect","isHovered","markHovered","unmarkHovered","onDrop","onDragEnter","onDragLeave","relatedTarget","toTarget","DropAreaState","withQuick","onHide","hideTimeoutRef","prevWithQuick","captureEscKeyListener","handleFilesDrop","dataTransfer","dt","files","from","handleQuickFilesDrop","handleDragLeave","fromTarget","onDragOver","clearTimeout","EmojiTooltip","MAX_INPUT_HEIGHT","messageSendKeyCombo","replyingToId","selectReplyingToId","noTabCapture","isPollModalOpen","payment","isPaymentModalOpen","isAttachmentModalInput","editableInputId","html","forcedPlaceholder","shouldSetFocus","shouldSuppressFocus","shouldSuppressTextFormatter","onUpdate","onSuppressedFocus","onSend","editLastMessage","replyToNextMessage","cloneRef","isContextMenuOpenRef","isTextFormatterOpen","openTextFormatter","closeTextFormatter","textFormatterAnchorPosition","setTextFormatterAnchorPosition","selectedRange","setSelectedRange","updateInputHeight","useLayoutEffectWithPrevDeps","prevHtml","innerHTML","focusInput","focusEditableElement","handleCloseTextFormatter","selection","getSelection","removeAllRanges","empty","clearSelection","checkSelection","IS_IOS","rangeCount","selectionRange","getRangeAt","selectedText","toString","isSelectionInsideInput","EDITABLE_INPUT_ID","parseEmojiOnlyString","START_TO_END","processSelection","selectionRect","inputRect","top","willSend","input","clone","currentHeight","newHeight","scrollHeight","transitionDuration","log","abs","toggle","captureFirstTab","debounce","captureKeyboardListeners","onTab","suppressFocus","blur","contentEditable","textContent","onKeyDown","shiftKey","handleKeyUp","event","button","closeContextMenuMouseListener","closeContextMenuKeyListener","handleMouseUp","onContextMenu","onTouchCancel","anchorPosition","TEXT_FORMAT_BY_TAG_NAME","B","STRONG","I","EM","U","DEL","CODE","fragmentEl","containerRef","linkUrlInputRef","isLinkControlOpen","openLinkControl","closeLinkControl","linkUrl","setLinkUrl","isEditingLink","setIsEditingLink","inputClassName","setInputClassName","selectedTextFormats","setSelectedTextFormats","useVirtualBackdrop","selectedFormats","parentElement","commonAncestorContainer","textFormat","tagName","getSelectedText","getSelectedElement","updateInputStyles","offsetWidth","scrollWidth","scrollLeft","getFormatButtonClassName","some","fKey","monospace","strikethrough","handleBoldText","execCommand","bold","handleItalicText","italic","handleUnderlineText","underline","handleStrikethroughText","replaceWith","handleMonospaceText","handleLinkUrlConfirm","formattedLinkUrl","encodeURI","addRange","restoreSelection","handler","KeyK","KeyB","KeyU","KeyI","KeyM","KeyS","linkUrlConfirmClassName","autoComplete","inputMode","onScroll","ENTITY_CLASS_BY_NODE_NAME","S","STRIKE","PRE","BLOCKQUOTE","parseMessageInput","fragment","parsedHtml","IS_EMOJI_SUPPORTED","parseMarkdown","textIndex","recursionDeepness","addEntity","node","nodeName","anchor","dataset","entityType","getEntityTypeFromNode","rawIndex","getEntityDataFromNode","hasChildNodes","childNodes","RE_BR","RE_SPACE","RE_CLEAN_HTML","RE_EXTRA_NEW_LINE","prepareForRegExp","inputId","parentNode","iterations","emojiDataPromise","emojiRawData","emojiData","RE_EMOJI_SEARCH","RegExp","useEmojiTooltip","recentEmojiIds","onUpdateHtml","baseEmojiKeywords","emojiKeywords","isDisabled","markIsOpen","unmarkIsOpen","setById","keywords","setKeywords","byKeyword","setByKeyword","names","setNames","byName","setByName","shouldForceInsertEmoji","setShouldForceInsertEmoji","filteredEmojis","setFilteredEmojis","MEMO_EMPTY_ARRAY","recentEmojis","values","pickTruthy","emojis","uncompressEmoji","ensureEmojiData","byNative","buildCollectionByKey","baseEmojisByKeyword","natives","emojisByKeyword","emojisByName","getEmojiCode","forceSend","endsWith","matched","matchedKeywords","keyword","sort","concat","flatten","matchedNames","unique","insertEmoji","textEmoji","isForce","atIndex","lastIndexOf","messageInput","getElementById","native","isEmojiTooltipOpen","closeEmojiTooltip","searchUserName","usernameLowered","toLowerCase","fullNameLowered","filterLowered","searchWords","runThrottled","throttle","cb","RE_USERNAME_SEARCH","useMentionTooltip","canSuggestMembers","groupChatMembers","topInlineBotIds","usersToMention","setUsersToMention","topInlineBots","getFilteredUsers","withInlineBots","inlineBots","inlineBot","chatMembers","usernameFilter","getUsernameFilter","canSuggestInlineBots","insertMention","forceFocus","insertedHtml","isMentionTooltipOpen","closeMentionTooltip","mentionFilteredUsers","useAsyncRendering","dependencies","delay","shouldRenderRef","timeoutRef","forceUpdate","useForceUpdate","useOnChange","textParts","confirmLabel","confirmHandler","confirmIsDestructive","isButtonsInOneRow","onEnter","split","textPart","disabled","children","buttonClassName","tabIndex","itemSelector","sensitiveArea","noScrollRestoreOnTop","cacheBuster","stateRef","loadMoreBackwards","loadMoreForwards","noScroll","LoadMoreDirection","clientHeight","state","newScrollTop","listItemElements","querySelectorAll","currentAnchor","scrollTop","currentAnchorTop","nextAnchor","resetScroll","isScrollTopJustUpdated","handleScroll","listLength","offsetHeight","isNearTop","offsetTop","isNearBottom","isUpdated","nextAnchorTop","newAnchorTop","offsetParent","buttonRef","destructive","isTouched","markIsTouched","unmarkIsTouched","isContextMenuOpen","contextMenuPosition","handleBeforeContextMenu","handleContextMenu","handleContextMenuClose","handleContextMenuHide","useContextMenuHandlers","getTriggerElement","getRootElement","getMenuElement","positionX","positionY","menuStyle","useContextMenuPosition","handleMouseDown","role","autoClose","hasCloseButton","noBackdrop","shouldSkipHistoryAnimations","modalRef","onEsc","focusableElements","currentFocusedIndex","findIndex","em","isSameNode","activeElement","newFocusedIndex","trapFocus","forceClose","useHistoryBack","useEffectWithPrevDeps","prevIsOpen","body","dispatchHeavyAnimationEvent","Portal","containerId","onDismiss","setIsOpen","timerRef","closeAndDismiss","handleMouseEnter","handleMouseLeave","onMouseEnter","onMouseLeave","appendChild","TeactDOM","removeChild","RADIUSES","s","m","xl","square","circleRadius","STROKE_WIDTH","borderRadius","circumference","PI","svg","firstElementChild","strokeDashOffset","setAttribute","subLabel","hidden","options","selected","loadingOption","handleChange","option","parentContainerClassName","focused","onReset","onFocus","onBlur","isInputFocused","markInputFocused","unmarkInputFocused","prevChildren","fromChildrenRef","noAnimation","onCheck","active","badgeCount","isBadgeActive","previousActiveTab","tabRef","tab","indicator","prevTab","currentIndicator","shiftLeft","offsetLeft","scaleFactor","clientWidth","tabs","activeTab","big","onSwitchTab","useHorizontalScroll","activeTabElement","newLeft","fastSmoothScrollHorizontal","CLEANED_UP","Symbol","renderCount","shouldRestoreHeight","shouldCleanup","cleanupExceptionKey","onStart","onStop","getGlobal","currentKeyRef","rendersRef","prevActiveKey","activeKeyChanged","cleanup","childElements","isBackwards","prevActiveIndex","activeIndex","HTMLElement","dispatchHeavyAnimationStop","onAnimationEnd","watchedNode","firstChild","waitForAnimationEnd","flexBasis","renders","contents","render","INCLUDED_CHAT_TYPES","EXCLUDED_CHAT_TYPES","INCLUDE_FILTER_FIELDS","EXCLUDE_FILTER_FIELDS","selectChatFilters","mode","selectTemp","selectedChatIds","selectedChatTypes","includedChatIds","includeFilters","folder","excludedChatIds","excludeFilters","getSuggestedFolderName","filters","bots","groups","channels","contacts","nonContacts","INITIAL_STATE","chatFilter","foldersReducer","omit","error","useReducer","trackId","originalDuration","handlers","onInit","onForcePlay","noPlaylist","controllerRef","setIsPlaying","isPlayingSync","setPlayProgress","register","eventName","proxy","isFinite","currentTime","paused","isSafariPatchInProgress","prevShouldPlay","prevSrc","audioProxy","hasFocus","cache","Map","blurredRef","img","Image","imgToCanvas","fastBlur","blurredAsync","get","onload","blurredDataUri","clear","set","useBlur","noInitiallyBuffered","setIsBuffered","setBufferedProgress","setIsBufferedDebounced","handleBuffering","media","buffered","end","readyState","onLoadedData","onPlaying","onLoadStart","onPause","onTimeUpdate","onProgress","useCanvasBlur","withRaf","canvasRef","processBlur","alpha","IS_CANVAS_FILTER_SUPPORTED","drawImage","RADIUS","isInSearch","toggleChatPinned","toggleChatArchived","toggleChatUnread","actionPin","actionUnreadMark","actionMute","actionArchive","isChatArchived","actionDelete","getCanDeleteChat","isMenuDisabled","shouldDisableOnLink","shouldDisableOnLongTap","setIsContextMenuOpen","setContextMenuPosition","clientY","timer","clearLongPressTimer","startLongPressTimer","contains","originalEvent","touches","cancelClickOnce","stopImmediatePropagation","emulateContextMenuEvent","passive","extraPaddingX","extraTopPadding","setPositionX","setPositionY","setStyle","triggerEl","emptyRect","menuEl","rootEl","triggerRect","menuRect","rootRect","horizontalPostition","useCurrentOrPrev","shouldSkipUndefined","shouldForceCurrent","prev","messageId","replyOriginForId","loadMessage","loadMessageThrottled","throttled","deltaX","deltaY","listSlice","forceFullPreload","lastParamsRef","viewportIdsRef","newViewportIds","getViewportSlice","prevListIds","prevIsDisabled","offsetId","areSortedArraysEqual","areSomeLocal","areAllLocal","sourceIds","indexForDirection","to","useIntersectionObserver","rootRef","throttleMs","debounceMs","shouldSkipFirst","margin","threshold","rootCallback","rootCallbackRef","freezeFlagsRef","autoUnfreezeTimeoutRef","onUnfreezeRef","unfreeze","freeze","observer","disconnect","callbacks","observe","targetCallback","entriesAccumulator","observerCallbackSync","entries","entry","callback","scheduler","observerCallback","IntersectionObserver","root","rootMargin","initController","controller","delete","unobserve","useOnIntersect","targetRef","setIsIntersecting","debugKey","prevDeps","mediaHash","noLoad","mediaFormat","startedAt","Date","now","spentTime","setIsDownloadStarted","isHtmlAllowed","isStreaming","IS_PROGRESSIVE_SUPPORTED","setDownloadProgress","startedAtRef","handleProgress","closeTimeout","useMouseInside","menuCloseTimeout","isMouseInside","usePrevDuringAnimation","isCurrentPresent","isPrevPresent","reducer","initialState","reducerRef","setState","currentState","SPEED","fast","slow","willAnimate","setShouldRenderThumb","useVideoCleanup","videoRef","videoEl","load","mul_table","shg_table","boxBlurCanvasRGB","context","top_x","top_y","isNaN","imageData","getImageData","pixels","rsum","gsum","bsum","p","p1","p2","yp","yi","yw","wm","hm","rad1","r","g","b","mul_sum","shg_sum","vmin","vmax","putImageData","tracks","currentTrackId","queue","stopCurrentAudio","currentTrack","Audio","handleEvent","nextTrackId","openAudioPlayer","parseMessageKey","nextTrack","safePlay","Proxy","createAudio","preload","IS_SAFARI","patchSafariProgressiveAudio","time","shouldRemoveFromQueue","track","h","captureEvent","initialSwipeAxis","hasMoved","hasSwiped","onCapture","excludedClosestSelector","onMove","onRelease","pageX","pageY","withCursor","scrollable","overflow","dragOffsetX","dragOffsetY","shouldPreventScroll","onDrag","innerWidth","xAbs","yAbs","axis","currentSwipeAxis","Left","Right","Up","Down","processSwipe","CLIPBOARD_ITEM_SUPPORTED","navigator","clipboard","ClipboardItem","textCopyEl","str","rangeToRestore","select","copyImageToClipboard","imageUrl","imageEl","toBlob","copyBlobToClipboard","pngBlob","write","DEBUG","console","waitForTransitionEnd","propertyName","waitForEndEvent","animationName","eventType","detailedName","isHandled","handleAnimationEnd","TransitionEvent","AnimationEvent","cycleRestrict","filename","click","isAnimating","fastSmoothScroll","maxDistance","FAST_SMOOTH_MAX_DISTANCE","forceDirection","forceDuration","forceNormalContainerHeight","scrollFrom","elementTop","FocusDirection","calculateScrollFrom","ANIMATION_LEVEL_MIN","scrollWithJs","isAnimatingScroll","elementHeight","currentScrollTop","containerHeight","targetContainerHeight","normalHeight","path","remainingPath","absPath","transition","FAST_SMOOTH_SHORT_TRANSITION_MAX_DISTANCE","shortTransition","longTransition","FAST_SMOOTH_MIN_DURATION","FAST_SMOOTH_MAX_DURATION","startAt","onHeavyAnimationStop","animateSingle","t","currentPath","containerWidth","animate","scrollTo","behavior","force","range","createRange","lastChild","nodeValue","selectNodeContents","collapse","audioEl","patchedForSafari","patchForSafariInProgress","once","mediaEl","catch","err","warn"],"sourceRoot":""}