{"version":3,"file":"main.9cba199dffc1d3ce8290.js","mappings":"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AO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KA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","sources":["webpack://telegram-t/webpack/runtime/create fake namespace object","webpack://telegram-t/webpack/runtime/load script","webpack://telegram-t/./src/hooks/useCurrentOrPrev.ts","webpack://telegram-t/./src/util/searchWords.ts","webpack://telegram-t/./src/hooks/useThrottledCallback.ts","webpack://telegram-t/./src/global/selectors/stories.ts","webpack://telegram-t/./src/util/handleError.ts","webpack://telegram-t/./src/hooks/media/useThumbnail.ts","webpack://telegram-t/./src/components/ui/Portal.ts","webpack://telegram-t/./src/global/helpers/messageSummary.ts","webpack://telegram-t/./src/util/installPrompt.ts","webpack://telegram-t/./src/components/middle/message/helpers/messageActions.tsx","webpack://telegram-t/./src/util/multiaccount.ts","webpack://telegram-t/./src/components/common/AnimatedIcon.tsx","webpack://telegram-t/./src/api/gramjs/worker/connector.ts","webpack://telegram-t/./src/components/common/helpers/renderText.tsx","webpack://telegram-t/./src/global/actions/apiUpdaters/initial.ts","webpack://telegram-t/./src/global/selectors/tabs.ts","webpack://telegram-t/./src/util/notifications.tsx","webpack://telegram-t/./src/hooks/useSignalEffect.ts","webpack://telegram-t/./src/hooks/useIntersectionObserver.ts","webpack://telegram-t/./src/util/arePropsShallowEqual.ts","webpack://telegram-t/./src/util/element/jsxToHtml.ts","webpack://telegram-t/./src/lib/teact/heavyAnimation.ts","webpack://telegram-t/./src/components/common/icons/StarIcon.module.scss?d424","webpack://telegram-t/./src/components/common/icons/StarIcon.tsx","webpack://telegram-t/./src/util/Deferred.ts","webpack://telegram-t/./src/util/entities/ids.ts","webpack://telegram-t/./src/lib/teact/dom-events.ts","webpack://telegram-t/./src/util/media/ipRevealingMedia.ts","webpack://telegram-t/./src/hooks/useKeyboardListNavigation.ts","webpack://telegram-t/./src/util/entities/username.ts","webpack://telegram-t/./src/global/actions/ui/settings.ts","webpack://telegram-t/./src/hooks/useFastClick.ts","webpack://telegram-t/./src/util/captureEscKeyListener.ts","webpack://telegram-t/./src/limits.ts","webpack://telegram-t/./src/global/index.ts","webpack://telegram-t/./src/util/generateUniqueId.ts","webpack://telegram-t/./src/util/textFormat.ts","webpack://telegram-t/./src/util/establishMultitabRole.ts","webpack://telegram-t/./src/hooks/useUniqueId.ts","webpack://telegram-t/./src/hooks/useEffectOnce.ts","webpack://telegram-t/./src/lib/twemojiRegex.js","webpack://telegram-t/./src/global/reducers/chats.ts","webpack://telegram-t/./src/util/visibility/getOffsetToContainer.ts","webpack://telegram-t/./src/hooks/useDebouncedCallback.ts","webpack://telegram-t/./src/util/formatCurrency.tsx","webpack://telegram-t/./src/util/emoji/parseEmojiOnlyString.ts","webpack://telegram-t/./src/util/dates/dateFormat.ts","webpack://telegram-t/./src/hooks/useLastCallback.ts","webpack://telegram-t/./src/global/reducers/symbols.ts","webpack://telegram-t/./src/global/reducers/users.ts","webpack://telegram-t/./src/global/reducers/globalSearch.ts","webpack://telegram-t/./src/global/reducers/management.ts","webpack://telegram-t/./src/global/reducers/settings.ts","webpack://telegram-t/./src/global/reducers/sharedState.ts","webpack://telegram-t/./src/global/reducers/twoFaSettings.ts","webpack://telegram-t/./src/global/reducers/passcode.ts","webpack://telegram-t/./src/global/reducers/payments.ts","webpack://telegram-t/./src/global/reducers/statistics.ts","webpack://telegram-t/./src/global/reducers/peers.ts","webpack://telegram-t/./src/global/reducers/stories.ts","webpack://telegram-t/./src/global/reducers/topics.ts","webpack://telegram-t/./src/components/common/AnimatedSticker.tsx","webpack://telegram-t/./src/components/common/icons/Icon.tsx","webpack://telegram-t/./src/components/common/Blockquote.tsx","webpack://telegram-t/./src/components/common/Blockquote.module.scss?d7ef","webpack://telegram-t/./src/util/prettyCodeLanguageNames.ts","webpack://telegram-t/./src/components/common/code/CodeOverlay.module.scss?733a","webpack://telegram-t/./src/components/common/code/CodeOverlay.tsx","webpack://telegram-t/./src/components/common/code/CodeBlock.tsx","webpack://telegram-t/./src/components/common/spoiler/Spoiler.tsx","webpack://telegram-t/./src/components/common/helpers/renderTextWithEntities.tsx","webpack://telegram-t/./src/components/common/MessageSummary.tsx","webpack://telegram-t/./src/hooks/useDerivedState.ts","webpack://telegram-t/./src/util/withCache.ts","webpack://telegram-t/./src/global/selectors/messages.ts","webpack://telegram-t/./src/util/permanentWebVersion.ts","webpack://telegram-t/./src/components/ui/Checkbox.tsx","webpack://telegram-t/./src/util/animation.ts","webpack://telegram-t/./src/global/selectors/users.ts","webpack://telegram-t/./src/lib/teact/jsx-runtime.ts","webpack://telegram-t/./src/global/helpers/bots.ts","webpack://telegram-t/./src/global/initialState.ts","webpack://telegram-t/./src/global/selectors/chats.ts","webpack://telegram-t/./src/util/dates/units.ts","webpack://telegram-t/./src/util/perfomanceSettings.ts","webpack://telegram-t/./src/components/common/Avatar.tsx","webpack://telegram-t/./src/util/signals.ts","webpack://telegram-t/./src/components/ui/DropdownMenu.tsx","webpack://telegram-t/./src/hooks/useVirtualBackdrop.ts","webpack://telegram-t/./src/util/areDeepEqual.ts","webpack://telegram-t/./src/util/emoji/fixNonStandardEmoji.ts","webpack://telegram-t/./src/components/ui/MenuItem.tsx","webpack://telegram-t/./src/lib/punycode.js","webpack://telegram-t/./src/util/browser/url.ts","webpack://telegram-t/./src/global/helpers/middleSearch.ts","webpack://telegram-t/./src/util/imageResize.ts","webpack://telegram-t/./src/util/cssAnimationEndListeners.ts","webpack://telegram-t/./src/hooks/useHistoryBack.ts","webpack://telegram-t/./src/util/appBadge.ts","webpack://telegram-t/./src/global/helpers/replies.ts","webpack://telegram-t/./src/global/actions/api/settings.ts","webpack://telegram-t/./src/global/helpers/notifications.ts","webpack://telegram-t/./src/util/svgController.ts","webpack://telegram-t/./src/hooks/usePrevious.ts","webpack://telegram-t/./src/global/selectors/symbols.ts","webpack://telegram-t/./src/global/selectors/sharedState.ts","webpack://telegram-t/./src/global/selectors/settings.ts","webpack://telegram-t/./src/hooks/useForceUpdate.ts","webpack://telegram-t/./src/config.ts","webpack://telegram-t/./src/hooks/schedulers/useInterval.ts","webpack://telegram-t/./src/global/reducers/tabs.ts","webpack://telegram-t/./src/util/requestActionTimeout.ts","webpack://telegram-t/./src/util/deepMerge.ts","webpack://telegram-t/./src/hooks/useShowTransition.ts","webpack://telegram-t/./src/hooks/usePriorityPlaybackCheck.ts","webpack://telegram-t/./src/components/common/helpers/peerColor.ts","webpack://telegram-t/./src/global/helpers/stars.ts","webpack://telegram-t/./src/hooks/useSyncEffect.ts","webpack://telegram-t/./src/api/types/media.ts","webpack://telegram-t/./src/hooks/stickers/useColorFilter.tsx","webpack://telegram-t/./src/hooks/useFlag.ts","webpack://telegram-t/./src/util/schedulers.ts","webpack://telegram-t/./src/lib/teact/teactn.tsx","webpack://telegram-t/./src/hooks/useMediaTransition.ts","webpack://telegram-t/./src/hooks/window/useDevicePixelRatio.ts","webpack://telegram-t/./src/hooks/useLang.ts","webpack://telegram-t/./src/hooks/window/useWindowSize.ts","webpack://telegram-t/./src/util/browser/unloadVideo.ts","webpack://telegram-t/./src/components/common/embedded/EmojiIconBackground.tsx","webpack://telegram-t/./src/components/common/embedded/EmojiIconBackground.module.scss?aa76","webpack://telegram-t/./src/components/ui/InputText.tsx","webpack://telegram-t/./src/components/ui/Transition.tsx","webpack://telegram-t/./src/hooks/useStateRef.ts","webpack://telegram-t/./src/util/forceReflow.ts","webpack://telegram-t/./src/util/safePlay.ts","webpack://telegram-t/./src/global/cache.ts","webpack://telegram-t/./src/components/ui/RippleEffect.tsx","webpack://telegram-t/./src/util/data/readStrings.ts","webpack://telegram-t/./src/util/data/readFallbackStrings.ts","webpack://telegram-t/./src/assets/localization/initialStrings.ts","webpack://telegram-t/./src/util/localization/index.ts","webpack://telegram-t/./src/util/browser/intlListFormat.ts","webpack://telegram-t/./src/util/math.ts","webpack://telegram-t/./src/util/windowSize.ts","webpack://telegram-t/./src/hooks/useAppLayout.ts","webpack://telegram-t/./src/global/selectors/peers.ts","webpack://telegram-t/./src/util/deepLinkParser.ts","webpack://telegram-t/./node_modules/@tauri-apps/api/external/tslib/tslib.es6.js","webpack://telegram-t/./src/util/callbacks.ts","webpack://telegram-t/./src/hooks/useSharedIntersectionObserver.ts","webpack://telegram-t/./src/hooks/useEnsureCustomEmoji.ts","webpack://telegram-t/./src/components/common/hooks/useCustomEmoji.ts","webpack://telegram-t/./src/global/actions/api/initial.ts","webpack://telegram-t/./src/util/localization/format.tsx","webpack://telegram-t/./src/util/colors.ts","webpack://telegram-t/./src/util/folderManager.ts","webpack://telegram-t/./src/util/safeExec.ts","webpack://telegram-t/./src/util/captureEvents.ts","webpack://telegram-t/./src/util/lethargy.ts","webpack://telegram-t/./src/hooks/useShowTransitionDeprecated.ts","webpack://telegram-t/./src/components/middle/message/ActionMessage.module.scss?5fb2","webpack://telegram-t/./src/util/emoji/emoji.ts","webpack://telegram-t/./src/util/captureKeyboardListeners.ts","webpack://telegram-t/./src/components/ui/Loading.tsx","webpack://telegram-t/./src/components/middle/helpers/preventMessageInputBlur.ts","webpack://telegram-t/./src/util/deeplink.ts","webpack://telegram-t/./src/global/shared/sharedStateConnector.ts","webpack://telegram-t/./src/global/selectors/payments.ts","webpack://telegram-t/./node_modules/@tauri-apps/api/core.js","webpack://telegram-t/./src/util/swipeController.ts","webpack://telegram-t/./src/components/middle/message/MentionLink.tsx","webpack://telegram-t/./src/global/selectors/media.ts","webpack://telegram-t/./src/hooks/useAsync.ts","webpack://telegram-t/./src/util/keys/searchResultKey.ts","webpack://telegram-t/./src/components/ui/Spinner.tsx","webpack://telegram-t/./src/hooks/element/useCollapsibleLines.ts","webpack://telegram-t/./src/util/sessions.ts","webpack://telegram-t/./src/components/common/helpers/animatedAssets.ts","webpack://telegram-t/./src/util/oggToWav.ts","webpack://telegram-t/./src/util/mediaLoader.ts","webpack://telegram-t/./src/components/middle/composer/helpers/customEmoji.ts","webpack://telegram-t/./src/util/trimText.ts","webpack://telegram-t/./src/hooks/useOldLang.ts","webpack://telegram-t/./src/util/browser/multitab.ts","webpack://telegram-t/./src/util/themeStyle.ts","webpack://telegram-t/./src/util/oldLangProvider.ts","webpack://telegram-t/./src/util/emoji/customEmojiManager.ts","webpack://telegram-t/./src/util/keys/messageKey.ts","webpack://telegram-t/./src/hooks/window/useBackgroundMode.ts","webpack://telegram-t/./src/util/debugConsole.ts","webpack://telegram-t/./src/lib/teact/teact-dom.ts","webpack://telegram-t/./src/global/helpers/chats.ts","webpack://telegram-t/./src/hooks/useMedia.ts","webpack://telegram-t/./src/util/browser/globalEnvironment.ts","webpack://telegram-t/./src/hooks/data/useSelector.ts","webpack://telegram-t/./src/components/ui/Button.tsx","webpack://telegram-t/./src/global/selectors/limits.ts","webpack://telegram-t/./src/util/phoneNumber.ts","webpack://telegram-t/./src/components/middle/message/hooks/useVideoAutoPause.ts","webpack://telegram-t/./src/components/ui/OptimizedVideo.tsx","webpack://telegram-t/./src/hooks/useSyncEffectWithPrevDeps.ts","webpack://telegram-t/./src/util/routing.ts","webpack://telegram-t/./src/lib/fasterdom/fasterdom.ts","webpack://telegram-t/./src/hooks/animations/useViewTransition.ts","webpack://telegram-t/./src/global/reducers/middleSearch.ts","webpack://telegram-t/./src/global/helpers/peers.ts","webpack://telegram-t/./node_modules/idb-keyval/dist/index.js","webpack://telegram-t/./src/util/browser/idb.ts","webpack://telegram-t/./src/util/dates/timestamp.ts","webpack://telegram-t/./src/util/passcode.ts","webpack://telegram-t/./src/util/switchTheme.ts","webpack://telegram-t/./src/hooks/useMenuPosition.ts","webpack://telegram-t/./src/components/ui/Menu.tsx","webpack://telegram-t/./src/hooks/useBuffering.ts","webpack://telegram-t/./src/hooks/useVideoCleanup.ts","webpack://telegram-t/./src/hooks/usePreviousDeprecated.ts","webpack://telegram-t/./src/util/theme.ts","webpack://telegram-t/./src/util/cacheApi.ts","webpack://telegram-t/./src/components/common/MessageText.tsx","webpack://telegram-t/./src/lib/fasterdom/layoutCauses.ts","webpack://telegram-t/./src/lib/fasterdom/stricterdom.ts","webpack://telegram-t/./src/components/common/helpers/mediaDimensions.ts","webpack://telegram-t/./src/components/common/TopicDefaultIcon.module.scss?06b0","webpack://telegram-t/./src/components/common/TopicDefaultIcon.tsx","webpack://telegram-t/./src/global/helpers/messageMedia.ts","webpack://telegram-t/./src/global/helpers/symbols.ts","webpack://telegram-t/./src/global/helpers/users.ts","webpack://telegram-t/./src/util/memo.ts","webpack://telegram-t/./src/util/moduleLoader.ts","webpack://telegram-t/./src/util/serverTime.ts","webpack://telegram-t/./src/hooks/useModuleLoader.ts","webpack://telegram-t/./src/util/patchSafariProgressiveAudio.ts","webpack://telegram-t/./src/hooks/useEffectWithPrevDeps.ts","webpack://telegram-t/./src/global/helpers/getEmojiOnlyCountForMessage.ts","webpack://telegram-t/./src/global/reducers/messages.ts","webpack://telegram-t/./src/components/common/StickerView.module.scss?7ce5","webpack://telegram-t/./src/components/common/StickerView.tsx","webpack://telegram-t/./src/hooks/useMountAfterHeavyAnimation.ts","webpack://telegram-t/./src/hooks/useMediaTransitionDeprecated.ts","webpack://telegram-t/./src/hooks/useDerivedSignal.ts","webpack://telegram-t/./src/util/localization/types.ts","webpack://telegram-t/./src/util/stopEvent.ts","webpack://telegram-t/./src/util/debugOverlay.ts","webpack://telegram-t/./src/lib/teact/teact.ts","webpack://telegram-t/./src/hooks/useHeavyAnimation.ts","webpack://telegram-t/./src/util/systemTheme.ts","webpack://telegram-t/./src/api/types/messages.ts","webpack://telegram-t/./src/util/websync.ts","webpack://telegram-t/./src/components/common/SafeLink.tsx","webpack://telegram-t/./src/util/primitives/LimitedMap.ts","webpack://telegram-t/./src/components/common/Sparkles.module.scss?15c2","webpack://telegram-t/./src/components/common/Sparkles.tsx","webpack://telegram-t/./src/util/clipboard.ts","webpack://telegram-t/./src/components/common/PeerColorWrapper.tsx","webpack://telegram-t/./src/components/common/PeerColorWrapper.module.scss?b340","webpack://telegram-t/./src/global/helpers/messages.ts","webpack://telegram-t/./src/hooks/element/useStyleObserver.ts","webpack://telegram-t/./src/hooks/stickers/useDynamicColorListener.ts","webpack://telegram-t/./src/util/buildClassName.ts","webpack://telegram-t/./src/components/common/CustomEmoji.tsx","webpack://telegram-t/./src/components/common/CustomEmoji.module.scss?8f5a","webpack://telegram-t/./src/util/files.ts","webpack://telegram-t/./src/util/iteratees.ts","webpack://telegram-t/./src/global/selectors/topics.ts","webpack://telegram-t/./src/lib/rlottie/RLottie.async.ts","webpack://telegram-t/./src/components/common/AvatarStoryCircle.tsx","webpack://telegram-t/./src/global/actions/ui/initial.ts","webpack://telegram-t/./src/types/index.ts","webpack://telegram-t/./src/util/forumColors.ts","webpack://telegram-t/./src/global/helpers/reactions.ts","webpack://telegram-t/./src/global/helpers/media.ts","webpack://telegram-t/./src/global/helpers/misc.ts","webpack://telegram-t/./src/global/selectors/management.ts","webpack://telegram-t/./src/global/selectors/statistics.ts","webpack://telegram-t/./src/global/selectors/ui.ts","webpack://telegram-t/./src/global/selectors/globalSearch.ts","webpack://telegram-t/./src/components/common/helpers/documentInfo.ts","webpack://telegram-t/./src/util/element/calcTextLineHeightAndCount.ts","webpack://telegram-t/./src/hooks/useResizeObserver.ts","webpack://telegram-t/./src/hooks/useMultiaccountInfo.ts","webpack://telegram-t/./src/global/selectors/middleSearch.ts","webpack://telegram-t/./src/hooks/useCoordsInSharedCanvas.ts","webpack://telegram-t/./src/util/deepDiff.ts","webpack://telegram-t/./src/global/reducers/translations.ts","webpack://telegram-t/./src/util/buildStyle.ts","webpack://telegram-t/./src/util/browser/windowEnvironment.ts","webpack://telegram-t/./src/components/ui/Link.tsx","webpack://telegram-t/./src/components/ui/Link.module.scss?2387","webpack://telegram-t/./src/util/localization/utils.ts","webpack://telegram-t/./src/components/middle/message/ActionMessageText.tsx","webpack://telegram-t/./src/hooks/data/useSelectorSignal.ts","webpack://telegram-t/./src/util/replaceWithTeact.ts","webpack://telegram-t/./src/util/getReadableErrorText.ts","webpack://telegram-t/webpack/bootstrap","webpack://telegram-t/webpack/runtime/define property getters","webpack://telegram-t/webpack/runtime/ensure chunk","webpack://telegram-t/webpack/runtime/get javascript chunk filename","webpack://telegram-t/webpack/runtime/get mini-css chunk filename","webpack://telegram-t/webpack/runtime/global","webpack://telegram-t/webpack/runtime/hasOwnProperty shorthand","webpack://telegram-t/webpack/runtime/make namespace object","webpack://telegram-t/webpack/runtime/publicPath","webpack://telegram-t/webpack/runtime/css loading","webpack://telegram-t/webpack/runtime/jsonp chunk loading","webpack://telegram-t/./src/util/setupServiceWorker.ts","webpack://telegram-t/./src/global/intervals.ts","webpack://telegram-t/./src/util/init.ts","webpack://telegram-t/./src/global/init.ts","webpack://telegram-t/./src/util/betterView.ts","webpack://telegram-t/./src/util/tauri/setupTauriListeners.ts","webpack://telegram-t/./src/components/auth/AuthCode.async.tsx","webpack://telegram-t/./src/components/auth/AuthPassword.async.tsx","webpack://telegram-t/./src/util/fonts.ts","webpack://telegram-t/./src/components/auth/helpers/backNavigation.ts","webpack://telegram-t/./src/components/auth/helpers/getSuggestedLanguage.ts","webpack://telegram-t/./src/hooks/useLangString.ts","webpack://telegram-t/./src/components/auth/CountryCodeInput.tsx","webpack://telegram-t/./src/components/auth/AuthPhoneNumber.tsx","webpack://telegram-t/./src/components/auth/AuthQrCode.tsx","webpack://telegram-t/./src/components/auth/AuthRegister.async.tsx","webpack://telegram-t/./src/components/auth/Auth.tsx","webpack://telegram-t/./src/components/App.module.scss?a9d3","webpack://telegram-t/./src/components/common/UiLoader.module.scss?03f6","webpack://telegram-t/./src/components/common/UiLoader.tsx","webpack://telegram-t/./src/components/main/AppInactive.tsx","webpack://telegram-t/./src/components/main/LockScreen.async.tsx","webpack://telegram-t/./src/components/main/Main.async.tsx","webpack://telegram-t/./src/components/App.tsx","webpack://telegram-t/./src/hooks/tauri/useTauriDrag.ts","webpack://telegram-t/./src/index.tsx","webpack://telegram-t/./src/util/tauri/initTauriApi.ts","webpack://telegram-t/./src/util/browser/listenOtherClients.ts","webpack://telegram-t/./src/util/updateWebmanifest.ts"],"sourcesContent":["var getProto = Object.getPrototypeOf ? (obj) => (Object.getPrototypeOf(obj)) : (obj) => (obj.__proto__);\nvar leafPrototypes;\n// create a fake namespace object\n// mode & 1: value is a module id, require it\n// mode & 2: merge all properties of value into the ns\n// mode & 4: return value when already ns object\n// mode & 16: return value when it's Promise-like\n// mode & 8|1: behave like require\n__webpack_require__.t = function(value, mode) {\n\tif(mode & 1) value = this(value);\n\tif(mode & 8) return value;\n\tif(typeof value === 'object' && value) {\n\t\tif((mode & 4) && value.__esModule) return value;\n\t\tif((mode & 16) && typeof value.then === 'function') return value;\n\t}\n\tvar ns = Object.create(null);\n\t__webpack_require__.r(ns);\n\tvar def = {};\n\tleafPrototypes = leafPrototypes || [null, getProto({}), getProto([]), getProto(getProto)];\n\tfor(var current = mode & 2 && value; typeof current == 'object' && !~leafPrototypes.indexOf(current); current = getProto(current)) {\n\t\tObject.getOwnPropertyNames(current).forEach((key) => (def[key] = () => (value[key])));\n\t}\n\tdef['default'] = () => (value);\n\t__webpack_require__.d(ns, def);\n\treturn ns;\n};","var inProgress = {};\nvar dataWebpackPrefix = \"telegram-t:\";\n// loadScript function to load a script via script tag\n__webpack_require__.l = (url, done, key, chunkId) => {\n\tif(inProgress[url]) { inProgress[url].push(done); return; }\n\tvar script, needAttach;\n\tif(key !== undefined) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tfor(var i = 0; i < scripts.length; i++) {\n\t\t\tvar s = scripts[i];\n\t\t\tif(s.getAttribute(\"src\") == url || s.getAttribute(\"data-webpack\") == dataWebpackPrefix + key) { script = s; break; }\n\t\t}\n\t}\n\tif(!script) {\n\t\tneedAttach = true;\n\t\tscript = document.createElement('script');\n\n\t\tscript.charset = 'utf-8';\n\t\tscript.timeout = 120;\n\t\tif (__webpack_require__.nc) {\n\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t}\n\t\tscript.setAttribute(\"data-webpack\", dataWebpackPrefix + key);\n\n\t\tscript.src = url;\n\t}\n\tinProgress[url] = [done];\n\tvar onScriptComplete = (prev, event) => {\n\t\t// avoid mem leaks in IE.\n\t\tscript.onerror = script.onload = null;\n\t\tclearTimeout(timeout);\n\t\tvar doneFns = inProgress[url];\n\t\tdelete inProgress[url];\n\t\tscript.parentNode && script.parentNode.removeChild(script);\n\t\tdoneFns && doneFns.forEach((fn) => (fn(event)));\n\t\tif(prev) return prev(event);\n\t}\n\tvar timeout = setTimeout(onScriptComplete.bind(null, undefined, { type: 'timeout', target: script }), 120000);\n\tscript.onerror = onScriptComplete.bind(null, script.onerror);\n\tscript.onload = onScriptComplete.bind(null, script.onload);\n\tneedAttach && document.head.appendChild(script);\n};","import usePreviousDeprecated from './usePreviousDeprecated';\n\nexport default function useCurrentOrPrev<T>(\n  current: T, shouldSkipUndefined = false, shouldForceCurrent = false,\n): T | undefined {\n  const prev = usePreviousDeprecated(current, shouldSkipUndefined);\n\n  // eslint-disable-next-line no-null/no-null\n  return shouldForceCurrent || (current !== null && current !== undefined) ? current : prev;\n}\n","let RE_NOT_LETTER: RegExp;\n\ntry {\n  RE_NOT_LETTER = /[^\\p{L}\\p{M}]+/ui;\n} catch (e) {\n  // Support for older versions of firefox\n  RE_NOT_LETTER = /[^\\w-]+/i;\n}\n\nexport default function searchWords(haystack: string, needle: string | string[]) {\n  if (!haystack || !needle) {\n    return false;\n  }\n\n  const needleWords = typeof needle === 'string' ? needle.toLowerCase().split(RE_NOT_LETTER) : needle;\n  const haystackLower = haystack.toLowerCase();\n\n  // @optimization\n  if (needleWords.length === 1 && !haystackLower.includes(needleWords[0])) {\n    return false;\n  }\n\n  let haystackWords: string[];\n\n  return needleWords.every((needleWord) => {\n    if (!haystackLower.includes(needleWord)) {\n      return false;\n    }\n\n    if (!haystackWords) {\n      haystackWords = haystackLower.split(RE_NOT_LETTER);\n    }\n\n    return haystackWords.some((haystackWord) => haystackWord.startsWith(needleWord));\n  });\n}\n\nexport function prepareSearchWordsForNeedle(needle: string) {\n  const needleWords = needle.toLowerCase().split(RE_NOT_LETTER);\n\n  return (haystack: string) => searchWords(haystack, needleWords);\n}\n","import { useCallback, useMemo } from '../lib/teact/teact';\n\nimport type { Scheduler } from '../util/schedulers';\n\nimport { throttle, throttleWith } from '../util/schedulers';\n\nexport default function useThrottledCallback<T extends AnyToVoidFunction>(\n  fn: T,\n  deps: any[],\n  msOrSchedulerFn: number | Scheduler,\n  noFirst = false,\n) {\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  const fnMemo = useCallback(fn, deps);\n\n  return useMemo(() => {\n    if (typeof msOrSchedulerFn === 'number') {\n      return throttle(fnMemo, msOrSchedulerFn, !noFirst);\n    } else {\n      return throttleWith(msOrSchedulerFn, fnMemo);\n    }\n  }, [fnMemo, msOrSchedulerFn, noFirst]);\n}\n","import type { ApiPeerStories, ApiTypeStory } from '../../api/types';\nimport type { GlobalState, TabArgs } from '../types';\nimport type { ProfileCollectionKey } from './payments';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { selectPeer } from './peers';\nimport { selectTabState } from './tabs';\n\nexport function selectCurrentViewedStory<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { storyViewer: { peerId, storyId } } = selectTabState(global, tabId);\n\n  return { peerId, storyId };\n}\n\nexport function selectIsStoryViewerOpen<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { peerId, storyId } = selectCurrentViewedStory(global, tabId);\n\n  return Boolean(peerId) && Boolean(storyId);\n}\n\nexport function selectPeerStories<T extends GlobalState>(\n  global: T, peerId: string,\n): ApiPeerStories | undefined {\n  return global.stories.byPeerId[peerId];\n}\n\nexport function selectPeerStory<T extends GlobalState>(\n  global: T, peerId: string, storyId: number,\n): ApiTypeStory | undefined {\n  return selectPeerStories(global, peerId)?.byId[storyId];\n}\n\nexport function selectPinnedStories<T extends GlobalState>(\n  global: T, peerId: string,\n) {\n  const stories = selectPeerStories(global, peerId);\n  if (!stories?.pinnedIds?.length) return undefined;\n  return stories.pinnedIds.map((id) => stories.byId[id]).filter((s) => (\n    s && 'isInProfile' in s && s.isInProfile\n  ));\n}\n\nexport function selectPeerFirstUnreadStoryId<T extends GlobalState>(\n  global: T, peerId: string,\n) {\n  const peerStories = selectPeerStories(global, peerId);\n  if (!peerStories) {\n    return undefined;\n  }\n\n  if (!peerStories.lastReadId) {\n    return peerStories.orderedIds?.[0];\n  }\n\n  const lastReadIndex = peerStories.orderedIds.findIndex((id) => id === peerStories.lastReadId);\n\n  return peerStories.orderedIds?.[lastReadIndex + 1];\n}\n\nexport function selectPeerFirstStoryId<T extends GlobalState>(\n  global: T, peerId: string,\n) {\n  return selectPeerStories(global, peerId)?.orderedIds?.[0];\n}\n\nexport function selectStoryListForViewer<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  storyId?: number,\n  isSingleStory?: boolean,\n  isSinglePeer?: boolean,\n  isPrivate?: boolean,\n  isArchive?: boolean,\n): {\n  peerIds: string[];\n  storyIdsByPeerId: Record<string, number[]>;\n} | undefined {\n  const currentStoryId = storyId\n    || selectPeerFirstUnreadStoryId(global, peerId)\n    || selectPeerFirstStoryId(global, peerId);\n  if (!currentStoryId) {\n    return undefined;\n  }\n\n  if (isSingleStory) {\n    return {\n      peerIds: [peerId],\n      storyIdsByPeerId: { [peerId]: [currentStoryId] },\n    };\n  }\n\n  const peer = selectPeer(global, peerId);\n  const story = selectPeerStory(global, peerId, currentStoryId);\n  if (!peer || !story) {\n    return undefined;\n  }\n\n  const isUnread = (global.stories.byPeerId[peerId].lastReadId || 0) < story.id;\n\n  if (isSinglePeer) {\n    const storyIds = getPeerStoryIdsForViewer(global, peerId, isUnread, isArchive, isPrivate);\n\n    return storyIds?.length\n      ? { peerIds: [peerId], storyIdsByPeerId: { [peerId]: storyIds } }\n      : undefined;\n  }\n\n  const { orderedPeerIds: { active, archived } } = global.stories;\n  const orderedPeerIds = (peer.areStoriesHidden ? archived : active) ?? [];\n  const peerIds: string[] = [];\n  const storyIdsByPeerId: Record<string, number[]> = {};\n\n  for (const currentPeerId of orderedPeerIds) {\n    const storyIds = getPeerStoryIdsForViewer(global, currentPeerId, isUnread, isArchive, isPrivate);\n    if (storyIds?.length) {\n      peerIds.push(currentPeerId);\n      storyIdsByPeerId[currentPeerId] = storyIds;\n    }\n  }\n\n  return peerIds.length ? { peerIds, storyIdsByPeerId } : undefined;\n}\n\nfunction getPeerStoryIdsForViewer<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  isUnread?: boolean,\n  isArchive?: boolean,\n  isPrivate?: boolean,\n): number[] | undefined {\n  const peerStories = selectPeerStories(global, peerId);\n  const storySourceProp = isArchive ? 'archiveIds' : isPrivate ? 'profileIds' : 'orderedIds';\n  const storyIds = peerStories?.[storySourceProp];\n\n  if (!peerStories || !storyIds?.length) {\n    return undefined;\n  }\n\n  if (!peerStories.lastReadId || !isUnread) {\n    return storyIds.slice();\n  }\n\n  const lastReadIndex = storyIds.indexOf(peerStories.lastReadId);\n  return (storyIds.length > lastReadIndex + 1)\n    ? storyIds.slice(lastReadIndex + 1)\n    : undefined;\n}\n\nexport function selectActiveStoriesCollectionId<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): ProfileCollectionKey {\n  return selectTabState(global, tabId).selectedStoryAlbumId || 'all';\n}\n","import { DEBUG, DEBUG_ALERT_MSG } from '../config';\nimport { isCurrentTabMaster } from './establishMultitabRole';\nimport { throttle } from './schedulers';\n\nlet showError = true;\nlet error: Error | undefined;\n\nwindow.addEventListener('error', handleErrorEvent);\nwindow.addEventListener('unhandledrejection', handleErrorEvent);\n\nif (DEBUG) {\n  window.addEventListener('focus', () => {\n    if (!isCurrentTabMaster()) {\n      return;\n    }\n    showError = true;\n    if (error) {\n      window.alert(getErrorMessage(error));\n      error = undefined;\n    }\n  });\n  window.addEventListener('blur', () => {\n    if (!isCurrentTabMaster()) {\n      return;\n    }\n    showError = false;\n  });\n}\n\nconst throttleError = throttle((err) => {\n  if (showError) {\n    window.alert(getErrorMessage(err));\n  } else {\n    error = err;\n  }\n}, 1500);\n\nexport function handleError(err: Error) {\n  // eslint-disable-next-line no-console\n  console.error(err);\n  if (DEBUG) {\n    throttleError(err);\n  }\n}\n\nfunction handleErrorEvent(e: ErrorEvent | PromiseRejectionEvent) {\n  if (e instanceof ErrorEvent) {\n    // https://stackoverflow.com/questions/49384120/resizeobserver-loop-limit-exceeded\n    if (e.message === 'ResizeObserver loop limit exceeded') {\n      return;\n    }\n\n    // Flood wait errors\n    if (e.message.includes('A wait of')) {\n      return;\n    }\n  }\n\n  e.preventDefault();\n  handleError(e instanceof ErrorEvent ? (e.error || e.message) : e.reason);\n}\n\nfunction getErrorMessage(err: Error) {\n  return `${DEBUG_ALERT_MSG}\\n\\n${(err?.message) || err}\\n${err?.stack}`;\n}\n","import { useMemo } from '../../lib/teact/teact';\nimport { getGlobal } from '../../global';\n\nimport type { ApiThumbnail, MediaContainer } from '../../api/types';\n\nimport { selectTheme } from '../../global/selectors';\nimport { selectMessageMediaThumbDataUri } from '../../global/selectors/media';\n\nexport default function useThumbnail(media?: MediaContainer | ApiThumbnail) {\n  const isMediaContainer = media && 'content' in media;\n  const global = getGlobal();\n  const thumbDataUri = isMediaContainer ? selectMessageMediaThumbDataUri(global, media) : media?.dataUri;\n\n  // TODO Find a way to update thumbnail on theme change\n  const theme = selectTheme(global);\n\n  const dataUri = useMemo(() => {\n    const uri = thumbDataUri;\n    if (!uri || theme !== 'dark') return uri;\n\n    return uri.replace('<svg', '<svg fill=\"white\"');\n  }, [thumbDataUri, theme]);\n\n  return dataUri;\n}\n","import type { FC, VirtualElement } from '../../lib/teact/teact';\nimport { useLayoutEffect, useRef } from '../../lib/teact/teact';\nimport TeactDOM from '../../lib/teact/teact-dom';\n\ntype OwnProps = {\n  containerSelector?: string;\n  className?: string;\n  children: VirtualElement;\n};\n\nconst Portal: FC<OwnProps> = ({ containerSelector, className, children }) => {\n  const elementRef = useRef<HTMLDivElement>();\n  if (!elementRef.current) {\n    elementRef.current = document.createElement('div');\n  }\n\n  useLayoutEffect(() => {\n    const container = document.querySelector<HTMLDivElement>(containerSelector || '#portals');\n    if (!container) {\n      return undefined;\n    }\n\n    const element = elementRef.current!;\n    if (className) {\n      element.classList.add(className);\n    }\n\n    container.appendChild(element);\n\n    return () => {\n      TeactDOM.render(undefined, element);\n      container.removeChild(element);\n    };\n  }, [className, containerSelector]);\n\n  return TeactDOM.render(children, elementRef.current);\n};\n\nexport default Portal;\n","import type { TeactNode } from '../../lib/teact/teact';\n\nimport type {\n  ApiMediaExtendedPreview, ApiMessage, MediaContent, StatefulMediaContent,\n} from '../../api/types';\nimport { ApiMessageEntityTypes } from '../../api/types';\n\nimport { type LangFn } from '../../util/localization';\nimport trimText from '../../util/trimText';\nimport { renderTextWithEntities } from '../../components/common/helpers/renderTextWithEntities';\nimport {\n  getMessageTextWithFallback, getMessageTranscription,\n} from './messages';\n\nconst SPOILER_CHARS = ['', '', '', ''];\nexport const TRUNCATED_SUMMARY_LENGTH = 80;\n\nexport function getMessageSummaryText(\n  lang: LangFn,\n  message: ApiMessage,\n  statefulContent: StatefulMediaContent | undefined,\n  noEmoji = false,\n  truncateLength = TRUNCATED_SUMMARY_LENGTH,\n  isExtended = false,\n) {\n  const emoji = !noEmoji && getMessageSummaryEmoji(message);\n  const emojiWithSpace = emoji ? `${emoji} ` : '';\n  const text = trimText(getMessageTextWithSpoilers(lang, message, statefulContent), truncateLength);\n  const description = getMessageSummaryDescription(lang, message, statefulContent, text, isExtended) as string;\n\n  return `${emojiWithSpace}${description}`;\n}\n\nexport function getMessageTextWithSpoilers(\n  lang: LangFn,\n  message: ApiMessage,\n  statefulContent: StatefulMediaContent | undefined,\n) {\n  const transcription = getMessageTranscription(message);\n\n  const textWithoutTranscription = getMessageTextWithFallback(lang, statefulContent?.story || message)?.text;\n  if (!textWithoutTranscription) {\n    return transcription;\n  }\n\n  const { entities } = message.content.text || {};\n  if (!entities?.length) {\n    return transcription ? `${transcription}\\n${textWithoutTranscription}` : textWithoutTranscription;\n  }\n\n  const text = entities.reduce((accText, {\n    type,\n    offset,\n    length,\n  }) => {\n    if (type !== ApiMessageEntityTypes.Spoiler) {\n      return accText;\n    }\n\n    const spoiler = generateBrailleSpoiler(length);\n\n    return `${accText.slice(0, offset)}${spoiler}${accText.slice(offset + length)}`;\n  }, textWithoutTranscription);\n\n  return transcription ? `${transcription}\\n${text}` : text;\n}\n\nexport function getMessageSummaryEmoji(message: ApiMessage) {\n  const {\n    photo,\n    video,\n    audio,\n    voice,\n    document,\n    sticker,\n    pollId,\n    paidMedia,\n    todo,\n  } = message.content;\n\n  if (message.groupedId || photo || paidMedia) {\n    return '';\n  }\n\n  if (video) {\n    return '';\n  }\n\n  if (sticker) {\n    return sticker.emoji;\n  }\n\n  if (audio) {\n    return '';\n  }\n\n  if (voice) {\n    return '';\n  }\n\n  if (document) {\n    return '';\n  }\n\n  if (pollId) {\n    return '';\n  }\n\n  if (todo) {\n    return '';\n  }\n\n  return undefined;\n}\n\nexport function getMediaContentTypeDescription(\n  lang: LangFn, content: MediaContent, statefulContent: StatefulMediaContent | undefined,\n) {\n  return getSummaryDescription(lang, content, statefulContent);\n}\nexport function getMessageSummaryDescription(\n  lang: LangFn,\n  message: ApiMessage,\n  statefulContent: StatefulMediaContent | undefined,\n  truncatedText?: string | TeactNode,\n  isExtended = false,\n) {\n  return getSummaryDescription(lang, message.content, statefulContent, message, truncatedText, isExtended);\n}\nfunction getSummaryDescription(\n  lang: LangFn,\n  mediaContent: MediaContent,\n  statefulContent: StatefulMediaContent | undefined,\n  message?: ApiMessage,\n  truncatedText?: string | TeactNode,\n  isExtended = false,\n) {\n  const {\n    text,\n    photo,\n    video,\n    audio,\n    voice,\n    document,\n    sticker,\n    contact,\n    invoice,\n    location,\n    game,\n    storyData,\n    giveaway,\n    giveawayResults,\n    paidMedia,\n    todo,\n  } = mediaContent;\n  const { poll } = statefulContent || {};\n\n  let hasUsedTruncatedText = false;\n  let summary: TeactNode | undefined;\n\n  const boughtExtendedMedia = paidMedia?.isBought && paidMedia.extendedMedia;\n  const previewExtendedMedia = paidMedia && !paidMedia.isBought\n    ? paidMedia.extendedMedia as ApiMediaExtendedPreview[] : undefined;\n\n  const isPaidMediaAlbum = paidMedia && paidMedia.extendedMedia.length > 1;\n  const isPaidMediaSingleVideo = !isPaidMediaAlbum\n    && (boughtExtendedMedia?.[0].video || previewExtendedMedia?.[0].duration);\n  const isPaidMediaSinglePhoto = !isPaidMediaAlbum && !isPaidMediaSingleVideo;\n\n  if (message?.groupedId || isPaidMediaAlbum) {\n    hasUsedTruncatedText = true;\n    summary = truncatedText || lang('Album');\n  }\n\n  if (photo || isPaidMediaSinglePhoto) {\n    hasUsedTruncatedText = true;\n    summary = truncatedText || lang('AttachPhoto');\n  }\n\n  if (video || isPaidMediaSingleVideo) {\n    hasUsedTruncatedText = true;\n    summary = truncatedText || lang(video?.isGif ? 'AttachGif' : 'AttachVideo');\n  }\n\n  if (sticker) {\n    summary = lang('AttachSticker').trim();\n  }\n\n  if (audio) {\n    summary = getMessageAudioCaption(mediaContent) || lang('AttachMusic');\n  }\n\n  if (voice) {\n    hasUsedTruncatedText = true;\n    summary = truncatedText || lang('AttachAudio');\n  }\n\n  if (document) {\n    hasUsedTruncatedText = !isExtended;\n    summary = isExtended ? document.fileName : (truncatedText || document.fileName);\n  }\n\n  if (contact) {\n    summary = lang('AttachContact');\n  }\n\n  if (poll) {\n    summary = renderTextWithEntities({\n      text: poll.summary.question.text,\n      entities: poll.summary.question.entities,\n      asPreview: true,\n    });\n  }\n\n  if (invoice) {\n    summary = invoice.extendedMedia ? invoice.title : lang('AttachInvoice', { description: invoice.description });\n  }\n\n  if (text) {\n    if (isExtended && summary && !hasUsedTruncatedText) {\n      (summary as string) += `\\n${truncatedText as string}`;\n    } else {\n      summary = truncatedText as string;\n    }\n  }\n\n  if (location?.mediaType === 'geo' || location?.mediaType === 'venue') {\n    summary = lang('AttachLocation');\n  }\n\n  if (location?.mediaType === 'geoLive') {\n    summary = lang('AttachLiveLocation');\n  }\n\n  if (game) {\n    summary = ` ${game.title}`;\n  }\n\n  if (giveaway) {\n    summary = lang('AttachGiveaway');\n  }\n\n  if (giveawayResults) {\n    summary = lang('AttachGiveawayResults');\n  }\n\n  if (storyData) {\n    summary = truncatedText || lang('AttachStory');\n  }\n\n  if (todo) {\n    summary = renderTextWithEntities({\n      text: todo.todo.title.text,\n      entities: todo.todo.title.entities,\n      asPreview: true,\n    });\n  }\n\n  return summary || lang('MessageUnsupported');\n}\n\nexport function generateBrailleSpoiler(length: number) {\n  return new Array(length)\n    .fill(undefined)\n    .map(() => SPOILER_CHARS[Math.floor(Math.random() * SPOILER_CHARS.length)])\n    .join('');\n}\n\nfunction getMessageAudioCaption(mediaContent: MediaContent) {\n  const {\n    audio,\n    text,\n  } = mediaContent;\n\n  return (audio && [audio.title, audio.performer].filter(Boolean)\n    .join('  ')) || (text?.text);\n}\n","import { getActions } from '../global';\n\nlet promptInstall: () => Promise<void>;\n\nexport function setupBeforeInstallPrompt() {\n  window.addEventListener('beforeinstallprompt', (e: any) => {\n    promptInstall = async () => {\n      e.prompt();\n      const userChoice = await e.userChoice;\n      const isInstalled = userChoice.outcome === 'accepted';\n\n      if (!isInstalled) return;\n      getActions().setInstallPrompt({ canInstall: false });\n    };\n    getActions().setInstallPrompt({ canInstall: true });\n  });\n}\n\nexport function getPromptInstall() {\n  return promptInstall;\n}\n","import { type TeactNode } from '../../../../lib/teact/teact';\nimport { getActions } from '../../../../global';\n\nimport type { ApiMessage } from '../../../../api/types';\nimport type { ApiMessageActionPhoneCall } from '../../../../api/types/messageActions';\nimport type {\n  LangKey,\n  LangPairPluralWithVariables,\n  LangPairWithVariables,\n  PluralLangKeyWithVariables,\n  RegularLangKey,\n  RegularLangKeyWithVariables,\n} from '../../../../types/language';\nimport type { LangFn } from '../../../../util/localization';\n\nimport { getMessageContent } from '../../../../global/helpers';\nimport { IS_SAFARI } from '../../../../util/browser/windowEnvironment';\nimport buildClassName from '../../../../util/buildClassName';\nimport renderText from '../../../common/helpers/renderText';\n\nimport Link from '../../../ui/Link';\n\nimport styles from '../ActionMessage.module.scss';\n\ntype SuffixKey<T, K extends keyof T> = `${K & string}You` extends keyof T ? T[`${K & string}You`] : never;\ntype VariablesForKey<K extends LangKey> =\n  K extends RegularLangKeyWithVariables\n    ? LangPairWithVariables<TeactNode | undefined>[K] | SuffixKey<LangPairWithVariables, K>\n    : K extends PluralLangKeyWithVariables\n      ? LangPairPluralWithVariables<TeactNode | undefined>[K] | SuffixKey<LangPairPluralWithVariables, K>\n      : undefined;\n\nexport function translateWithYou<K extends LangKey>(\n  lang: LangFn,\n  key: K,\n  isYou: boolean,\n  variables: VariablesForKey<K>,\n  options?: {\n    pluralValue?: number;\n    asText?: boolean;\n    withMarkdown?: boolean;\n    renderTextFilters?: string[];\n  },\n): TeactNode {\n  const { pluralValue, asText, withMarkdown, renderTextFilters } = options || {};\n  const translationKey = isYou ? (`${key}You` as LangKey) : key;\n\n  return lang(\n    // @ts-ignore -- I have no idea if this even possible to type correctly\n    translationKey,\n    variables,\n    {\n      withNodes: !asText, withMarkdown, pluralValue, renderTextFilters,\n    },\n  );\n}\n\nexport function getPinnedMediaValue(lang: LangFn, message: ApiMessage) {\n  const {\n    audio, contact, document, game, giveaway, giveawayResults, paidMedia, storyData,\n    invoice, location, photo, pollId, sticker, video, voice,\n  } = getMessageContent(message);\n\n  if (message.groupedId || paidMedia) return lang('ActionPinnedMediaAlbum');\n  if (photo) return lang('ActionPinnedMediaPhoto');\n  if (audio) return lang('ActionPinnedMediaAudio');\n  if (voice) return lang('ActionPinnedMediaVoice');\n  if (video?.isRound) return lang('ActionPinnedMediaVideoMessage');\n  if (video?.isGif) return lang('ActionPinnedMediaGif');\n  if (video) return lang('ActionPinnedMediaVideo');\n  if (sticker) return lang('ActionPinnedMediaSticker');\n  if (document) return lang('ActionPinnedMediaFile');\n  if (contact) return lang('ActionPinnedMediaContact');\n  if (location) return lang('ActionPinnedMediaLocation');\n  if (storyData) return lang('ActionPinnedMediaStory');\n  if (invoice) return lang('ActionPinnedMediaInvoice');\n  if (game) return lang('ActionPinnedMediaGame', { game: game.title });\n  if (pollId) return lang('ActionPinnedMediaPoll');\n  if (giveaway) return lang('ActionPinnedMediaGiveaway');\n  if (giveawayResults) return lang('ActionPinnedMediaGiveawayResults');\n\n  return undefined;\n}\n\nexport function renderPeerLink(peerId: string | undefined, text: string, asPreview?: boolean) {\n  if (!peerId || asPreview) {\n    return renderText(text);\n  }\n\n  return (\n    <Link\n      className={buildClassName(styles.peerLink, styles.strong)}\n\n      onClick={(e) => {\n        e.stopPropagation();\n        getActions().openChat({ id: peerId });\n      }}\n      // box-decoration-break: clone; is broken when child has `dir` attribute\n      withMultilineFix={IS_SAFARI}\n    >\n      {renderText(text)}\n    </Link>\n  );\n}\n\nexport function renderMessageLink(\n  targetMessage: ApiMessage | undefined,\n  text: TeactNode,\n  asPreview: boolean | undefined,\n  params?: {\n    noEllipsis?: boolean;\n  },\n) {\n  const { noEllipsis } = params || {};\n\n  if (asPreview || !targetMessage) return text;\n\n  return (\n    <Link\n      className={buildClassName(styles.messageLink, noEllipsis && styles.noEllipsis)}\n      onClick={(e) => {\n        e.stopPropagation();\n        getActions().focusMessage({ chatId: targetMessage.chatId, messageId: targetMessage.id });\n      }}\n      withMultilineFix={IS_SAFARI}\n    >\n      {text}\n    </Link>\n  );\n}\n\nexport function getCallMessageKey(action: ApiMessageActionPhoneCall, isOutgoing: boolean): RegularLangKey {\n  const isMissed = action.reason === 'missed';\n  const isCancelled = action.reason === 'busy' || action.duration === undefined;\n  if (action.isVideo) {\n    if (isMissed) return isOutgoing ? 'CallMessageVideoOutgoingMissed' : 'CallMessageVideoIncomingMissed';\n    if (isCancelled) return 'CallMessageVideoIncomingDeclined';\n\n    return isOutgoing ? 'CallMessageVideoOutgoing' : 'CallMessageVideoIncoming';\n  } else {\n    if (isMissed) return isOutgoing ? 'CallMessageOutgoingMissed' : 'CallMessageIncomingMissed';\n    if (isCancelled) return 'CallMessageIncomingDeclined';\n\n    return isOutgoing ? 'CallMessageOutgoing' : 'CallMessageIncoming';\n  }\n}\n","import type { AccountInfo, SessionUserInfo, SharedSessionData } from '../types';\n\nimport {\n  ACCOUNT_QUERY,\n  DATA_BROADCAST_CHANNEL_PREFIX,\n  ESTABLISH_BROADCAST_CHANNEL_PREFIX,\n  GLOBAL_STATE_CACHE_PREFIX,\n  MULTITAB_LOCALSTORAGE_KEY_PREFIX,\n  SESSION_ACCOUNT_PREFIX,\n} from '../config';\nimport { IS_MULTIACCOUNT_SUPPORTED } from './browser/globalEnvironment';\n\nconst WORKER_NAME = typeof WorkerGlobalScope !== 'undefined' && globalThis.self instanceof WorkerGlobalScope\n  ? globalThis.self.name : undefined;\nconst WORKER_ACCOUNT_SLOT = WORKER_NAME ? Number(new URLSearchParams(WORKER_NAME).get(ACCOUNT_QUERY)) : undefined;\n\nexport const ACCOUNT_SLOT = WORKER_ACCOUNT_SLOT || (\n  IS_MULTIACCOUNT_SUPPORTED ? getAccountSlot(globalThis.location.href) : undefined\n);\n\nexport const DATA_BROADCAST_CHANNEL_NAME = `${DATA_BROADCAST_CHANNEL_PREFIX}_${ACCOUNT_SLOT || 1}`;\nexport const ESTABLISH_BROADCAST_CHANNEL_NAME = `${ESTABLISH_BROADCAST_CHANNEL_PREFIX}_${ACCOUNT_SLOT || 1}`;\nexport const MULTITAB_STORAGE_KEY = `${MULTITAB_LOCALSTORAGE_KEY_PREFIX}_${ACCOUNT_SLOT || 1}`;\nexport const GLOBAL_STATE_CACHE_KEY = ACCOUNT_SLOT\n  ? `${GLOBAL_STATE_CACHE_PREFIX}_${ACCOUNT_SLOT}` : GLOBAL_STATE_CACHE_PREFIX;\n\nexport function getAccountSlot(url: string) {\n  const params = new URL(url).searchParams;\n  const slot = params.get(ACCOUNT_QUERY);\n  const slotNumber = slot ? Number(slot) : 1;\n  if (!slotNumber || Number.isNaN(slotNumber) || slotNumber === 1) return undefined;\n  return slotNumber;\n}\n\nexport function getAccountsInfo() {\n  if (!IS_MULTIACCOUNT_SUPPORTED) return {};\n  const allKeys = Object.keys(localStorage);\n  const allSlots = allKeys.filter((key) => key.startsWith(SESSION_ACCOUNT_PREFIX));\n  const accountInfo: Record<number, AccountInfo> = {};\n  for (const key of allSlots) {\n    const i = Number(key.slice(SESSION_ACCOUNT_PREFIX.length));\n    const info = getAccountInfo(i);\n    if (info) {\n      accountInfo[i] = info;\n    }\n  }\n  return accountInfo;\n}\n\nfunction getAccountInfo(slot: number): AccountInfo | undefined {\n  const sessionData = loadSlotSession(slot);\n  const {\n    userId, avatarUri, color, emojiStatusId, firstName, lastName, isPremium, isTest, phone,\n  } = sessionData || {};\n\n  if (!userId) return undefined;\n\n  return {\n    userId,\n    avatarUri,\n    color,\n    emojiStatusId,\n    firstName,\n    lastName,\n    isPremium,\n    isTest,\n    phone,\n  };\n}\n\nexport function loadSlotSession(slot: number | undefined): SharedSessionData | undefined {\n  try {\n    const data = JSON.parse(localStorage.getItem(`${SESSION_ACCOUNT_PREFIX}${slot || 1}`) || '{}') as SharedSessionData;\n    if (!data.dcId) return undefined;\n    return data;\n  } catch (e) {\n    return undefined;\n  }\n}\n\nexport function storeAccountData(slot: number | undefined, data: Partial<SessionUserInfo>) {\n  const currentSlotData = loadSlotSession(slot);\n\n  if (!currentSlotData) return;\n\n  const updatedSharedData: SharedSessionData = {\n    ...currentSlotData,\n    ...data,\n  };\n\n  if (!updatedSharedData.userId) return;\n\n  writeSlotSession(slot, updatedSharedData);\n}\n\nexport function writeSlotSession(slot: number | undefined, data: SharedSessionData) {\n  localStorage.setItem(`${SESSION_ACCOUNT_PREFIX}${slot || 1}`, JSON.stringify(data));\n}\n\nexport function getAccountSlotUrl(slot: number, forLogin?: boolean, isTest?: boolean) {\n  const url = new URL(globalThis.location.href);\n  if (slot !== 1) {\n    url.searchParams.set(ACCOUNT_QUERY, String(slot));\n  } else {\n    url.searchParams.delete(ACCOUNT_QUERY);\n  }\n\n  if (isTest) {\n    url.searchParams.set('test', 'true');\n  } else {\n    url.searchParams.delete('test');\n  }\n\n  url.hash = forLogin ? 'login' : '';\n  return url.toString();\n}\n\n// Validate current version across all tabs to avoid conflicts\nif (typeof window === 'object') {\n  const versionChannel = new BroadcastChannel('tt-version');\n  versionChannel.postMessage({ version: APP_VERSION });\n\n  versionChannel.addEventListener('message', (event) => {\n    const { version } = event.data;\n    if (!version) return;\n    if (semverCompare(APP_VERSION, version) === -1) {\n      window.location.reload();\n    }\n\n    // If incoming version is older, send back the current version\n    if (semverCompare(APP_VERSION, version) === 1) {\n      versionChannel.postMessage({ version: APP_VERSION });\n    }\n  });\n}\n\nfunction semverCompare(a: string, b: string) {\n  if (a.startsWith(`${b}-`)) return -1;\n  if (b.startsWith(`${a}-`)) return 1;\n  return a.localeCompare(b, undefined, { numeric: true, sensitivity: 'case', caseFirst: 'upper' });\n}\n","import { memo, useState } from '../../lib/teact/teact';\n\nimport type { OwnProps as AnimatedStickerProps } from './AnimatedSticker';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport useFlag from '../../hooks/useFlag';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useMediaTransitionDeprecated from '../../hooks/useMediaTransitionDeprecated';\n\nimport AnimatedSticker from './AnimatedSticker';\n\nconst DEFAULT_SIZE = 150;\n\nexport type OwnProps =\n  Partial<AnimatedStickerProps>\n  & { noTransition?: boolean; nonInteractive?: boolean };\n\nfunction AnimatedIcon(props: OwnProps) {\n  const {\n    size = DEFAULT_SIZE,\n    play = true,\n    noLoop = true,\n    className,\n    noTransition,\n    nonInteractive,\n    onLoad,\n    onClick,\n    ...otherProps\n  } = props;\n  const [isAnimationLoaded, markAnimationLoaded] = useFlag(false);\n  const transitionClassNames = useMediaTransitionDeprecated(noTransition || isAnimationLoaded);\n\n  const handleLoad = useLastCallback(() => {\n    markAnimationLoaded();\n    onLoad?.();\n  });\n\n  const [playKey, setPlayKey] = useState(String(Math.random()));\n\n  const handleClick = useLastCallback(() => {\n    if (play === true) {\n      setPlayKey(String(Math.random()));\n    }\n\n    onClick?.();\n  });\n\n  return (\n    <AnimatedSticker\n      className={buildClassName(className, transitionClassNames)}\n      size={size}\n      play={play === true ? playKey : play}\n      noLoop={noLoop}\n      onClick={!nonInteractive ? handleClick : undefined}\n      onLoad={handleLoad}\n\n      {...otherProps}\n    />\n  );\n}\n\nexport default memo(AnimatedIcon);\n","import type { Api } from '../../../lib/gramjs';\nimport type { TypedBroadcastChannel } from '../../../util/browser/multitab';\nimport type { ApiInitialArgs, ApiOnProgress, OnApiUpdate } from '../../types';\nimport type { LocalDb } from '../localDb';\nimport type { MethodArgs, MethodResponse, Methods } from '../methods/types';\nimport type { OriginPayload, ThenArg, WorkerMessageEvent } from './types';\n\nimport { DEBUG, IGNORE_UNHANDLED_ERRORS } from '../../../config';\nimport { IS_TAURI } from '../../../util/browser/globalEnvironment';\nimport { logDebugMessage } from '../../../util/debugConsole';\nimport Deferred from '../../../util/Deferred';\nimport { getCurrentTabId, subscribeToMasterChange } from '../../../util/establishMultitabRole';\nimport generateUniqueId from '../../../util/generateUniqueId';\nimport { ACCOUNT_SLOT, DATA_BROADCAST_CHANNEL_NAME } from '../../../util/multiaccount';\nimport { pause, throttleWithTickEnd } from '../../../util/schedulers';\n\ntype RequestState = {\n  messageId: string;\n  resolve: AnyToVoidFunction;\n  reject: AnyToVoidFunction;\n  callback?: AnyToVoidFunction;\n  DEBUG_payload?: any;\n};\n\ntype EnsurePromise<T> = Promise<Awaited<T>>;\n\nconst HEALTH_CHECK_TIMEOUT = 150;\nconst HEALTH_CHECK_MIN_DELAY = 5 * 1000; // 5 sec\nconst NO_QUEUE_BEFORE_INIT = new Set(['destroy']);\n\nlet worker: Worker | undefined;\n\nconst requestStates = new Map<string, RequestState>();\nconst requestStatesByCallback = new Map<AnyToVoidFunction, RequestState>();\n\nlet pendingPayloads: OriginPayload[] = [];\n\nconst savedLocalDb: LocalDb = {\n  chats: {},\n  users: {},\n  documents: {},\n  stickerSets: {},\n  photos: {},\n  webDocuments: {},\n  commonBoxState: {},\n  channelPtsById: {},\n};\n\nlet isMasterTab = true;\nsubscribeToMasterChange((isMasterTabNew) => {\n  isMasterTab = isMasterTabNew;\n});\n\nconst channel = new BroadcastChannel(DATA_BROADCAST_CHANNEL_NAME) as TypedBroadcastChannel;\n\nconst postMessagesOnTickEnd = throttleWithTickEnd(() => {\n  const payloads = pendingPayloads;\n  pendingPayloads = [];\n  worker?.postMessage({ payloads });\n});\n\nfunction postMessageOnTickEnd(payload: OriginPayload) {\n  pendingPayloads.push(payload);\n  postMessagesOnTickEnd();\n}\n\nexport function initApiOnMasterTab(initialArgs: ApiInitialArgs) {\n  channel.postMessage({\n    type: 'initApi',\n    token: getCurrentTabId(),\n    initialArgs,\n  });\n}\n\nlet updateCallback: OnApiUpdate;\n\nlet localApiRequestsQueue: { fnName: any; args: any; deferred: Deferred<any> }[] = [];\nlet apiRequestsQueue: { fnName: any; args: any; deferred: Deferred<any> }[] = [];\nlet isInited = false;\n\nexport function initApi(onUpdate: OnApiUpdate, initialArgs: ApiInitialArgs) {\n  updateCallback = onUpdate;\n\n  if (!isMasterTab) {\n    initApiOnMasterTab(initialArgs);\n    return Promise.resolve();\n  }\n\n  if (!worker) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.log('>>> START LOAD WORKER');\n    }\n\n    const params = new URLSearchParams();\n    if (ACCOUNT_SLOT) {\n      params.set('account', String(ACCOUNT_SLOT));\n    }\n\n    worker = new Worker(new URL('./worker.ts', import.meta.url), {\n      name: params.toString(),\n    });\n    subscribeToWorker(onUpdate);\n\n    if (initialArgs.platform === 'iOS' || (initialArgs.platform === 'macOS' && IS_TAURI)) {\n      setupHealthCheck();\n    }\n  }\n\n  return makeRequest({\n    type: 'initApi',\n    args: [initialArgs, savedLocalDb],\n  }).then(() => {\n    isInited = true;\n\n    apiRequestsQueue.forEach((request) => {\n      callApi(request.fnName, ...request.args)\n        .then(request.deferred.resolve)\n        .catch(request.deferred.reject);\n    });\n    apiRequestsQueue = [];\n\n    localApiRequestsQueue.forEach((request) => {\n      callApiLocal(request.fnName, ...request.args)\n        .then(request.deferred.resolve)\n        .catch(request.deferred.reject);\n    });\n    localApiRequestsQueue = [];\n  });\n}\n\nexport function updateLocalDb(name: keyof LocalDb, prop: string, value: any) {\n  savedLocalDb[name][prop] = value;\n}\n\nexport function updateFullLocalDb(initial: LocalDb) {\n  Object.assign(savedLocalDb, initial);\n}\n\nexport function callApiOnMasterTab(payload: any) {\n  channel.postMessage({\n    type: 'callApi',\n    token: getCurrentTabId(),\n    ...payload,\n  });\n}\n\nexport function setShouldEnableDebugLog(value: boolean) {\n  return makeRequest({\n    type: 'toggleDebugMode',\n    isEnabled: value,\n  });\n}\n\n/*\n * Call a worker method on this tab's worker, without transferring to master tab\n * Mostly needed to disconnect worker when re-electing master\n */\nexport function callApiLocal<T extends keyof Methods>(\n  fnName: T, ...args: MethodArgs<T>\n): EnsurePromise<MethodResponse<T>> {\n  if (!isInited) {\n    if (NO_QUEUE_BEFORE_INIT.has(fnName)) {\n      return Promise.resolve(undefined) as EnsurePromise<MethodResponse<T>>;\n    }\n\n    const deferred = new Deferred();\n    localApiRequestsQueue.push({ fnName, args, deferred });\n\n    return deferred.promise as EnsurePromise<MethodResponse<T>>;\n  }\n\n  const promise = makeRequest({\n    type: 'callMethod',\n    name: fnName,\n    args,\n  });\n\n  // Some TypeScript magic to make sure `VirtualClass` is never returned from any method\n  if (DEBUG) {\n    (async () => {\n      try {\n        type ForbiddenTypes =\n          Api.VirtualClass<any>\n          | (Api.VirtualClass<any> | undefined)[];\n        type ForbiddenResponses =\n          ForbiddenTypes\n          | (AnyLiteral & Record<string, ForbiddenTypes>);\n\n        // Unwrap all chained promises\n        const response = await promise;\n        // Make sure responses do not include `VirtualClass` instances\n        const allowedResponse: Exclude<typeof response, ForbiddenResponses> = response;\n        // Suppress \"unused variable\" constraint\n        void allowedResponse;\n      } catch (err) {\n        // Do noting\n      }\n    })();\n  }\n\n  return promise as EnsurePromise<MethodResponse<T>>;\n}\n\nexport function callApi<T extends keyof Methods>(fnName: T, ...args: MethodArgs<T>): EnsurePromise<MethodResponse<T>> {\n  if (!isInited && isMasterTab) {\n    if (NO_QUEUE_BEFORE_INIT.has(fnName)) {\n      return Promise.resolve(undefined) as EnsurePromise<MethodResponse<T>>;\n    }\n\n    const deferred = new Deferred();\n    apiRequestsQueue.push({ fnName, args, deferred });\n\n    return deferred.promise as EnsurePromise<MethodResponse<T>>;\n  }\n\n  const promise = isMasterTab ? makeRequest({\n    type: 'callMethod',\n    name: fnName,\n    args,\n  }) : makeRequestToMaster({\n    name: fnName,\n    args,\n  });\n\n  // Some TypeScript magic to make sure `VirtualClass` is never returned from any method\n  if (DEBUG) {\n    (async () => {\n      try {\n        type ForbiddenTypes =\n          Api.VirtualClass<any>\n          | (Api.VirtualClass<any> | undefined)[];\n        type ForbiddenResponses =\n          ForbiddenTypes\n          | (AnyLiteral & Record<string, ForbiddenTypes>);\n\n        // Unwrap all chained promises\n        const response = await promise;\n        // Make sure responses do not include `VirtualClass` instances\n        const allowedResponse: Exclude<typeof response, ForbiddenResponses> = response;\n        // Suppress \"unused variable\" constraint\n        void allowedResponse;\n      } catch (err) {\n        // Do noting\n      }\n    })();\n  }\n\n  return promise as EnsurePromise<MethodResponse<T>>;\n}\n\nexport function cancelApiProgress(progressCallback: ApiOnProgress) {\n  progressCallback.isCanceled = true;\n\n  const { messageId } = requestStatesByCallback.get(progressCallback) || {};\n  if (!messageId) {\n    return;\n  }\n\n  if (isMasterTab) {\n    cancelApiProgressMaster(messageId);\n  } else {\n    channel.postMessage({\n      type: 'cancelApiProgress',\n      token: getCurrentTabId(),\n      messageId,\n    });\n  }\n}\n\nexport function cancelApiProgressMaster(messageId: string) {\n  postMessageOnTickEnd({\n    type: 'cancelProgress',\n    messageId,\n  });\n}\n\nfunction subscribeToWorker(onUpdate: OnApiUpdate) {\n  worker?.addEventListener('message', ({ data }: WorkerMessageEvent) => {\n    data?.payloads.forEach((payload) => {\n      if (payload.type === 'updates') {\n        let DEBUG_startAt: number | undefined;\n        if (DEBUG) {\n          DEBUG_startAt = performance.now();\n        }\n\n        payload.updates.forEach(onUpdate);\n\n        if (DEBUG) {\n          const duration = performance.now() - DEBUG_startAt!;\n          if (duration > 5) {\n            // eslint-disable-next-line no-console\n            console.warn(`[API] Slow updates processing: ${payload.updates.length} updates in ${duration} ms`);\n          }\n        }\n      } else if (payload.type === 'methodResponse') {\n        handleMethodResponse(payload);\n      } else if (payload.type === 'methodCallback') {\n        handleMethodCallback(payload);\n      } else if (payload.type === 'unhandledError') {\n        const message = payload.error?.message;\n        if (message && IGNORE_UNHANDLED_ERRORS.has(message)) return;\n        throw new Error(message);\n      } else if (payload.type === 'sendBeacon') {\n        navigator.sendBeacon(payload.url, payload.data);\n      } else if (payload.type === 'debugLog') {\n        logDebugMessage(payload.level, ...payload.args);\n      }\n    });\n  });\n}\n\nexport function handleMethodResponse(data: {\n  messageId: string;\n  response?: ThenArg<MethodResponse<keyof Methods>>;\n  error?: { message: string };\n}) {\n  const requestState = requestStates.get(data.messageId);\n  if (requestState) {\n    if (data.error) {\n      requestState.reject(data.error);\n    } else {\n      requestState.resolve(data.response);\n    }\n  }\n}\n\nexport function handleMethodCallback(data: {\n  messageId: string;\n  callbackArgs: any[];\n}) {\n  requestStates.get(data.messageId)?.callback?.(...data.callbackArgs);\n}\n\nfunction makeRequestToMaster(message: {\n  messageId?: string;\n  name: keyof Methods;\n  args: MethodArgs<keyof Methods>;\n  withCallback?: boolean;\n}) {\n  const messageId = generateUniqueId();\n  const payload = {\n    messageId,\n    ...message,\n  };\n\n  const requestState = { messageId } as RequestState;\n\n  // Re-wrap type because of `postMessage`\n  const promise = new Promise<MethodResponse<keyof Methods>>((resolve, reject) => {\n    Object.assign(requestState, { resolve, reject });\n  });\n\n  if ('args' in payload && 'name' in payload && typeof payload.args[1] === 'function') {\n    payload.withCallback = true;\n\n    const callback = payload.args.pop() as AnyToVoidFunction;\n    requestState.callback = callback;\n    requestStatesByCallback.set(callback, requestState);\n  }\n\n  requestStates.set(messageId, requestState);\n\n  promise\n    .catch(() => undefined)\n    .finally(() => {\n      requestStates.delete(messageId);\n\n      if (requestState.callback) {\n        requestStatesByCallback.delete(requestState.callback);\n      }\n    });\n\n  callApiOnMasterTab(payload);\n\n  return promise;\n}\n\nfunction makeRequest(message: OriginPayload) {\n  const messageId = generateUniqueId();\n  const payload: OriginPayload = {\n    messageId,\n    ...message,\n  };\n\n  const requestState = { messageId } as RequestState;\n\n  // Re-wrap type because of `postMessage`\n  const promise = new Promise<MethodResponse<keyof Methods>>((resolve, reject) => {\n    Object.assign(requestState, { resolve, reject });\n  });\n\n  if ('args' in payload && 'name' in payload && typeof payload.args[1] === 'function') {\n    payload.withCallback = true;\n\n    const callback = payload.args.pop() as AnyToVoidFunction;\n    requestState.callback = callback;\n    requestStatesByCallback.set(callback, requestState);\n  }\n\n  requestState.DEBUG_payload = payload;\n\n  requestStates.set(messageId, requestState);\n\n  promise\n    .catch(() => undefined)\n    .finally(() => {\n      requestStates.delete(messageId);\n\n      if (requestState.callback) {\n        requestStatesByCallback.delete(requestState.callback);\n      }\n    });\n\n  postMessageOnTickEnd(payload);\n\n  return promise;\n}\n\nconst startedAt = Date.now();\n\n// Workaround for iOS sometimes stops interacting with worker\nfunction setupHealthCheck() {\n  window.addEventListener('focus', () => {\n    void ensureWorkerPing();\n    // Sometimes a single check is not enough\n    setTimeout(() => ensureWorkerPing(), 1000);\n  });\n}\n\nasync function ensureWorkerPing() {\n  let isResolved = false;\n\n  try {\n    await Promise.race([\n      makeRequest({ type: 'ping' }),\n      pause(HEALTH_CHECK_TIMEOUT)\n        .then(() => (isResolved ? undefined : Promise.reject(new Error('HEALTH_CHECK_TIMEOUT')))),\n    ]);\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.error(err);\n\n    if (Date.now() - startedAt >= HEALTH_CHECK_MIN_DELAY) {\n      worker?.terminate();\n      worker = undefined;\n      updateCallback({ '@type': 'requestReconnectApi' });\n    }\n  } finally {\n    isResolved = true;\n  }\n}\n","import type { TeactNode } from '../../../lib/teact/teact';\n\nimport type { TextPart } from '../../../types';\n\nimport { RE_LINK_TEMPLATE, RE_MENTION_TEMPLATE } from '../../../config';\nimport EMOJI_REGEX from '../../../lib/twemojiRegex';\nimport { IS_EMOJI_SUPPORTED } from '../../../util/browser/windowEnvironment';\nimport buildClassName from '../../../util/buildClassName';\nimport { isDeepLink } from '../../../util/deepLinkParser';\nimport {\n  handleEmojiLoad,\n  LOADED_EMOJIS,\n  nativeToUnifiedExtendedWithCache,\n} from '../../../util/emoji/emoji';\nimport fixNonStandardEmoji from '../../../util/emoji/fixNonStandardEmoji';\nimport { compact } from '../../../util/iteratees';\n\nimport MentionLink from '../../middle/message/MentionLink';\nimport SafeLink from '../SafeLink';\n\nexport type TextFilter = (\n  'escape_html' | 'hq_emoji' | 'emoji' | 'emoji_html' | 'br' | 'br_html' | 'highlight' | 'links' |\n  'simple_markdown' | 'simple_markdown_html' | 'tg_links'\n  );\n\nconst SIMPLE_MARKDOWN_REGEX = /(\\*\\*|__).+?\\1/g;\n\nexport default function renderText(\n  part: TextPart,\n  filters: Array<TextFilter> = ['emoji'],\n  params?: {\n    highlight?: string;\n    markdownPostProcessor?: (part: string) => TeactNode;\n  },\n): TeactNode[] {\n  if (typeof part !== 'string') {\n    return [part];\n  }\n\n  return compact(filters.reduce((text, filter) => {\n    switch (filter) {\n      case 'escape_html':\n        return escapeHtml(text);\n\n      case 'hq_emoji':\n        EMOJI_REGEX.lastIndex = 0;\n        return replaceEmojis(text, 'big', 'jsx');\n\n      case 'emoji':\n        EMOJI_REGEX.lastIndex = 0;\n        return replaceEmojis(text, 'small', 'jsx');\n\n      case 'emoji_html':\n        EMOJI_REGEX.lastIndex = 0;\n        return replaceEmojis(text, 'small', 'html');\n\n      case 'br':\n        return addLineBreaks(text, 'jsx');\n\n      case 'br_html':\n        return addLineBreaks(text, 'html');\n\n      case 'highlight':\n        return addHighlight(text, params!.highlight);\n\n      case 'links':\n        return addLinks(text);\n\n      case 'tg_links':\n        return addLinks(text, true);\n\n      case 'simple_markdown':\n        return replaceSimpleMarkdown(text, 'jsx', params?.markdownPostProcessor);\n\n      case 'simple_markdown_html':\n        return replaceSimpleMarkdown(text, 'html');\n    }\n\n    return text;\n  }, [part] as TextPart[]));\n}\n\nfunction escapeHtml(textParts: TextPart[]): TextPart[] {\n  const divEl = document.createElement('div');\n  return textParts.reduce((result: TextPart[], part) => {\n    if (typeof part !== 'string') {\n      result.push(part);\n      return result;\n    }\n\n    divEl.innerText = part;\n    result.push(divEl.innerHTML);\n\n    return result;\n  }, []);\n}\n\nfunction replaceEmojis(textParts: TextPart[], size: 'big' | 'small', type: 'jsx' | 'html'): TextPart[] {\n  if (IS_EMOJI_SUPPORTED) {\n    return textParts;\n  }\n\n  return textParts.reduce((result: TextPart[], part: TextPart) => {\n    if (typeof part !== 'string') {\n      result.push(part);\n      return result;\n    }\n\n    part = fixNonStandardEmoji(part);\n    const parts = part.split(EMOJI_REGEX);\n    const emojis: string[] = part.match(EMOJI_REGEX) || [];\n    result.push(parts[0]);\n\n    return emojis.reduce((emojiResult: TextPart[], emoji, i) => {\n      const code = nativeToUnifiedExtendedWithCache(emoji);\n      if (!code) {\n        emojiResult.push(emoji);\n      } else {\n        const src = `./img-apple-${size === 'big' ? '160' : '64'}/${code}.png`;\n        const className = buildClassName(\n          'emoji',\n          size === 'small' && 'emoji-small',\n        );\n\n        if (type === 'jsx') {\n          const isLoaded = LOADED_EMOJIS.has(src);\n\n          emojiResult.push(\n            <img\n              src={src}\n              className={`${className}${!isLoaded ? ' opacity-transition slow shown' : ''}`}\n              alt={emoji}\n              data-path={src}\n              draggable={false}\n              onLoad={!isLoaded ? handleEmojiLoad : undefined}\n            />,\n          );\n        }\n        if (type === 'html') {\n          emojiResult.push(\n            `<img\\\n            draggable=\"false\"\\\n            class=\"${className}\"\\\n            src=\"${src}\"\\\n            alt=\"${emoji}\"\\\n          />`,\n          );\n        }\n      }\n\n      const index = i * 2 + 2;\n      if (parts[index]) {\n        emojiResult.push(parts[index]);\n      }\n\n      return emojiResult;\n    }, result);\n  }, [] as TextPart[]);\n}\n\nfunction addLineBreaks(textParts: TextPart[], type: 'jsx' | 'html'): TextPart[] {\n  return textParts.reduce((result: TextPart[], part) => {\n    if (typeof part !== 'string') {\n      result.push(part);\n      return result;\n    }\n\n    const splittenParts = part\n      .split(/\\r\\n|\\r|\\n/g)\n      .reduce((parts: TextPart[], line: string, i, source) => {\n        // This adds non-breaking space if line was indented with spaces, to preserve the indentation\n        const trimmedLine = line.trimLeft();\n        const indentLength = line.length - trimmedLine.length;\n        parts.push(String.fromCharCode(160).repeat(indentLength) + trimmedLine);\n\n        if (i !== source.length - 1) {\n          parts.push(\n            type === 'jsx' ? <br /> : '<br />',\n          );\n        }\n\n        return parts;\n      }, []);\n\n    return [...result, ...splittenParts];\n  }, []);\n}\n\nfunction addHighlight(textParts: TextPart[], highlight: string | undefined): TextPart[] {\n  return textParts.reduce<TextPart[]>((result, part) => {\n    if (typeof part !== 'string' || !highlight) {\n      result.push(part);\n      return result;\n    }\n\n    const lowerCaseText = part.toLowerCase();\n    const queryPosition = lowerCaseText.indexOf(highlight.toLowerCase());\n    if (queryPosition < 0) {\n      result.push(part);\n      return result;\n    }\n\n    const newParts: TextPart[] = [];\n    newParts.push(part.substring(0, queryPosition));\n    newParts.push(\n      <span className=\"matching-text-highlight\">\n        {part.substring(queryPosition, queryPosition + highlight.length)}\n      </span>,\n    );\n    newParts.push(part.substring(queryPosition + highlight.length));\n    return [...result, ...newParts];\n  }, []);\n}\n\nconst RE_LINK = new RegExp(`${RE_LINK_TEMPLATE}|${RE_MENTION_TEMPLATE}`, 'ig');\n\nfunction addLinks(textParts: TextPart[], allowOnlyTgLinks?: boolean): TextPart[] {\n  return textParts.reduce<TextPart[]>((result, part) => {\n    if (typeof part !== 'string') {\n      result.push(part);\n      return result;\n    }\n\n    const links = part.match(RE_LINK);\n    if (!links || !links.length) {\n      result.push(part);\n      return result;\n    }\n\n    const content: TextPart[] = [];\n\n    let nextLink = links.shift();\n    let lastIndex = 0;\n    while (nextLink) {\n      const index = part.indexOf(nextLink, lastIndex);\n      content.push(part.substring(lastIndex, index));\n      if (nextLink.startsWith('@')) {\n        content.push(\n          <MentionLink username={nextLink}>\n            {nextLink}\n          </MentionLink>,\n        );\n      } else {\n        if (nextLink.endsWith('?')) {\n          nextLink = nextLink.slice(0, nextLink.length - 1);\n        }\n\n        if (!allowOnlyTgLinks || isDeepLink(nextLink)) {\n          content.push(\n            <SafeLink text={nextLink} url={nextLink} />,\n          );\n        } else {\n          content.push(nextLink);\n        }\n      }\n      lastIndex = index + nextLink.length;\n      nextLink = links.shift();\n    }\n    content.push(part.substring(lastIndex));\n\n    return [...result, ...content];\n  }, []);\n}\n\nfunction replaceSimpleMarkdown(\n  textParts: TextPart[], type: 'jsx' | 'html', postProcessor?: (part: string) => TeactNode,\n): TextPart[] {\n  // Currently supported only for JSX. If needed, add typings to support HTML as well.\n  const postProcess = postProcessor || ((part: string) => part);\n\n  return textParts.reduce<TextPart[]>((result, part) => {\n    if (typeof part !== 'string') {\n      result.push(part);\n      return result;\n    }\n\n    const parts = part.split(SIMPLE_MARKDOWN_REGEX);\n    const entities: string[] = part.match(SIMPLE_MARKDOWN_REGEX) || [];\n    result.push(postProcess(parts[0]));\n\n    return entities.reduce((entityResult: TextPart[], entity, i) => {\n      if (type === 'jsx') {\n        entityResult.push(\n          entity.startsWith('**')\n            ? <b>{postProcess(entity.replace(/\\*\\*/g, ''))}</b>\n            : <i>{postProcess(entity.replace(/__/g, ''))}</i>,\n        );\n      } else {\n        entityResult.push(\n          entity.startsWith('**')\n            ? `<b>${entity.replace(/\\*\\*/g, '')}</b>`\n            : `<i>${entity.replace(/__/g, '')}</i>`,\n        );\n      }\n\n      const index = i * 2 + 2;\n      if (parts[index]) {\n        entityResult.push(postProcess(parts[index]));\n      }\n\n      return entityResult;\n    }, result);\n  }, []);\n}\n\nexport function areLinesWrapping(text: string, element: HTMLElement) {\n  const lines = (text.trim().match(/\\n/g) || '').length + 1;\n  const { lineHeight } = getComputedStyle(element);\n  const lineHeightParsed = parseFloat(lineHeight.split('px')[0]);\n\n  return element.clientHeight >= (lines + 1) * lineHeightParsed;\n}\n","import type {\n  ApiUpdateAuthorizationError,\n  ApiUpdateAuthorizationState,\n  ApiUpdateConnectionState,\n  ApiUpdateCurrentUser,\n  ApiUpdateServerTimeOffset,\n  ApiUpdateSession,\n} from '../../../api/types';\nimport type { LangCode } from '../../../types';\nimport type { RequiredGlobalActions } from '../../index';\nimport type { ActionReturnType, GlobalState } from '../../types';\n\nimport { getCurrentTabId } from '../../../util/establishMultitabRole';\nimport { getShippingError, shouldClosePaymentModal } from '../../../util/getReadableErrorText';\nimport { unique } from '../../../util/iteratees';\nimport { oldSetLanguage } from '../../../util/oldLangProvider';\nimport { clearWebTokenAuth } from '../../../util/routing';\nimport { setServerTimeOffset } from '../../../util/serverTime';\nimport { updateSessionUserId } from '../../../util/sessions';\nimport { forceWebsync } from '../../../util/websync';\nimport { isChatChannel, isChatSuperGroup } from '../../helpers';\nimport {\n  addActionHandler, getGlobal, setGlobal,\n} from '../../index';\nimport { updateUser, updateUserFullInfo } from '../../reducers';\nimport { updateTabState } from '../../reducers/tabs';\nimport { selectTabState } from '../../selectors';\nimport { selectSharedSettings } from '../../selectors/sharedState';\n\naddActionHandler('apiUpdate', (global, actions, update): ActionReturnType => {\n  switch (update['@type']) {\n    case 'updateApiReady':\n      onUpdateApiReady(global);\n      break;\n\n    case 'updateAuthorizationState':\n      onUpdateAuthorizationState(global, update);\n      break;\n\n    case 'updateAuthorizationError':\n      onUpdateAuthorizationError(global, update);\n      break;\n\n    case 'updateWebAuthTokenFailed':\n      onUpdateWebAuthTokenFailed(global);\n      break;\n\n    case 'updateConnectionState':\n      onUpdateConnectionState(global, actions, update);\n      break;\n\n    case 'updateSession':\n      onUpdateSession(global, actions, update);\n      break;\n\n    case 'updateServerTimeOffset':\n      onUpdateServerTimeOffset(update);\n      break;\n\n    case 'updateCurrentUser':\n      onUpdateCurrentUser(global, update);\n      break;\n\n    case 'requestReconnectApi':\n      global = { ...global, isSynced: false };\n      setGlobal(global);\n\n      onUpdateConnectionState(global, actions, {\n        '@type': 'updateConnectionState',\n        connectionState: 'connectionStateConnecting',\n      });\n      actions.initApi();\n      break;\n\n    case 'requestSync':\n      actions.sync();\n      break;\n\n    case 'updateFetchingDifference':\n      global = { ...global, isFetchingDifference: update.isFetching };\n      setGlobal(global);\n      break;\n\n    case 'error': {\n      Object.values(global.byTabId).forEach(({ id: tabId }) => {\n        const paymentShippingError = getShippingError(update.error);\n        if (paymentShippingError) {\n          actions.addPaymentError({ error: paymentShippingError, tabId });\n        } else if (shouldClosePaymentModal(update.error)) {\n          actions.closePaymentModal({ tabId });\n        } else if (actions.showDialog) {\n          actions.showDialog({ data: update.error, tabId });\n        }\n      });\n\n      break;\n    }\n\n    case 'notSupportedInFrozenAccount': {\n      actions.showNotification({\n        title: {\n          key: 'NotificationTitleNotSupportedInFrozenAccount',\n        },\n        message: {\n          key: 'NotificationMessageNotSupportedInFrozenAccount',\n        },\n        tabId: getCurrentTabId(),\n      });\n      break;\n    }\n  }\n});\n\nfunction onUpdateApiReady<T extends GlobalState>(global: T) {\n  void oldSetLanguage(selectSharedSettings(global).language as LangCode);\n}\n\nfunction onUpdateAuthorizationState<T extends GlobalState>(global: T, update: ApiUpdateAuthorizationState) {\n  global = getGlobal();\n\n  const wasAuthReady = global.authState === 'authorizationStateReady';\n  const authState = update.authorizationState;\n\n  global = {\n    ...global,\n    authState,\n    authIsLoading: false,\n  };\n  setGlobal(global);\n\n  global = getGlobal();\n\n  switch (authState) {\n    case 'authorizationStateLoggingOut':\n      void forceWebsync(false);\n\n      global = {\n        ...global,\n        isLoggingOut: true,\n      };\n      setGlobal(global);\n      break;\n    case 'authorizationStateWaitCode':\n      global = {\n        ...global,\n        authIsCodeViaApp: update.isCodeViaApp,\n      };\n      setGlobal(global);\n      break;\n    case 'authorizationStateWaitPassword':\n      global = {\n        ...global,\n        authHint: update.hint,\n      };\n\n      if (update.noReset) {\n        global = {\n          ...global,\n          hasWebAuthTokenPasswordRequired: true,\n        };\n      }\n\n      setGlobal(global);\n      break;\n    case 'authorizationStateWaitQrCode':\n      global = {\n        ...global,\n        authIsLoadingQrCode: false,\n        authQrCode: update.qrCode,\n      };\n      setGlobal(global);\n      break;\n    case 'authorizationStateReady': {\n      if (wasAuthReady) {\n        break;\n      }\n\n      void forceWebsync(true);\n\n      global = {\n        ...global,\n        isLoggingOut: false,\n      };\n      Object.values(global.byTabId).forEach(({ id: tabId }) => {\n        global = updateTabState(global, {\n          inactiveReason: undefined,\n        }, tabId);\n      });\n      setGlobal(global);\n\n      break;\n    }\n  }\n}\n\nfunction onUpdateAuthorizationError<T extends GlobalState>(global: T, update: ApiUpdateAuthorizationError) {\n  // TODO: Investigate why TS is not happy with spread for lang related types\n  global = {\n    ...global,\n  };\n  global.authErrorKey = update.errorKey;\n  setGlobal(global);\n}\n\nfunction onUpdateWebAuthTokenFailed<T extends GlobalState>(global: T) {\n  clearWebTokenAuth();\n  global = getGlobal();\n\n  global = {\n    ...global,\n    hasWebAuthTokenFailed: true,\n  };\n  setGlobal(global);\n}\n\nfunction onUpdateConnectionState<T extends GlobalState>(\n  global: T, actions: RequiredGlobalActions, update: ApiUpdateConnectionState,\n) {\n  const { connectionState } = update;\n\n  global = getGlobal();\n  const tabState = selectTabState(global, getCurrentTabId());\n  if (connectionState === 'connectionStateReady' && tabState.isMasterTab && tabState.multitabNextAction) {\n    // @ts-ignore\n    actions[tabState.multitabNextAction.action](tabState.multitabNextAction.payload);\n    actions.clearMultitabNextAction({ tabId: tabState.id });\n  }\n\n  if (connectionState === global.connectionState) {\n    return;\n  }\n\n  global = {\n    ...global,\n    connectionState,\n  };\n  setGlobal(global);\n\n  if (global.isSynced) {\n    const channelStackIds = Object.values(global.byTabId)\n      .flatMap((tab) => tab.messageLists)\n      .map((messageList) => messageList.chatId)\n      .filter((chatId) => {\n        const chat = global.chats.byId[chatId];\n        return chat && (isChatChannel(chat) || isChatSuperGroup(chat));\n      });\n    if (connectionState === 'connectionStateReady' && channelStackIds.length) {\n      unique(channelStackIds).forEach((chatId) => {\n        actions.requestChannelDifference({ chatId });\n      });\n    }\n  }\n\n  if (connectionState === 'connectionStateBroken') {\n    actions.signOut({ forceInitApi: true });\n  }\n}\n\nfunction onUpdateSession<T extends GlobalState>(global: T, actions: RequiredGlobalActions, update: ApiUpdateSession) {\n  const { sessionData } = update;\n  const { authRememberMe, authState } = global;\n  const isEmpty = !sessionData || !sessionData.mainDcId;\n\n  const isTest = sessionData?.isTest;\n  if (isTest) {\n    global = {\n      ...global,\n      config: {\n        ...global.config,\n        isTestServer: isTest,\n      },\n    };\n    setGlobal(global);\n  }\n\n  if (!authRememberMe || authState !== 'authorizationStateReady' || isEmpty) {\n    return;\n  }\n\n  actions.saveSession({ sessionData });\n}\n\nfunction onUpdateServerTimeOffset(update: ApiUpdateServerTimeOffset) {\n  setServerTimeOffset(update.serverTimeOffset);\n}\n\nfunction onUpdateCurrentUser<T extends GlobalState>(global: T, update: ApiUpdateCurrentUser) {\n  const { currentUser, currentUserFullInfo } = update;\n\n  global = {\n    ...updateUser(global, currentUser.id, currentUser),\n    currentUserId: currentUser.id,\n  };\n  global = updateUserFullInfo(global, currentUser.id, currentUserFullInfo);\n  setGlobal(global);\n\n  updateSessionUserId(currentUser.id);\n}\n","import type {\n  GlobalState, TabArgs,\n  TabState,\n} from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\n\nexport function selectTabState<T extends GlobalState>(\n  global: T, ...[tabId = getCurrentTabId()]: TabArgs<T>\n): TabState {\n  return global.byTabId[tabId];\n}\n","import { getActions, getGlobal, setGlobal } from '../global';\n\nimport type {\n  ApiChat, ApiMessage, ApiPeer, ApiPeerReaction,\n  ApiPhoneCall, ApiUser,\n} from '../api/types';\nimport { ApiMediaFormat } from '../api/types';\n\nimport { APP_NAME, DEBUG, IS_TEST } from '../config';\nimport {\n  getChatAvatarHash,\n  getChatTitle,\n  getMessageRecentReaction,\n  getPrivateChatUserId,\n  getUserFullName,\n} from '../global/helpers';\nimport { getIsChatMuted, getIsChatSilent, getShouldShowMessagePreview } from '../global/helpers/notifications';\nimport { getMessageSenderName } from '../global/helpers/peers';\nimport {\n  selectCurrentMessageList,\n  selectCustomEmoji,\n  selectIsChatWithSelf,\n  selectNotifyDefaults,\n  selectNotifyException,\n  selectPeer,\n  selectSender,\n  selectSettingsKeys,\n  selectTopicFromMessage,\n} from '../global/selectors';\nimport { callApi } from '../api/gramjs';\nimport { IS_TAURI } from './browser/globalEnvironment';\nimport { IS_SERVICE_WORKER_SUPPORTED, IS_TOUCH_ENV } from './browser/windowEnvironment';\nimport jsxToHtml from './element/jsxToHtml';\nimport { buildCollectionByKey } from './iteratees';\nimport { getTranslationFn } from './localization';\nimport * as mediaLoader from './mediaLoader';\nimport { oldTranslate } from './oldLangProvider';\nimport { debounce } from './schedulers';\nimport { getServerTime } from './serverTime';\n\nimport MessageSummary from '../components/common/MessageSummary';\n\nfunction getDeviceToken(subscription: PushSubscription) {\n  const data = subscription.toJSON();\n  return JSON.stringify({\n    endpoint: data.endpoint,\n    keys: data.keys,\n  });\n}\n\nfunction checkIfPushSupported() {\n  if (!IS_SERVICE_WORKER_SUPPORTED || IS_TAURI) return false;\n\n  if (!('showNotification' in ServiceWorkerRegistration.prototype)) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('[PUSH] Push notifications aren\\'t supported.');\n    }\n    return false;\n  }\n\n  // If permission is denied, it is blocked until the user manually changes their settings\n  if (Notification.permission === 'denied') {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('[PUSH] The user has blocked push notifications.');\n    }\n    return false;\n  }\n\n  // Check if push messaging is supported\n  if (!('PushManager' in window)) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('[PUSH] Push messaging isn\\'t supported.');\n    }\n    return false;\n  }\n\n  return true;\n}\n\nexport function checkIfNotificationsSupported() {\n  // Let's check if the browser supports notifications\n  if (!('Notification' in window)) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('[PUSH] This browser does not support desktop notification');\n    }\n    return false;\n  }\n\n  if (Notification.permission === 'denied') {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('[PUSH] The user has blocked push notifications.');\n    }\n    return false;\n  }\n  return true;\n}\n\nconst expirationTime = 12 * 60 * 60 * 1000; // 12 hours\n// Notification id is removed from soundPlayed cache after 3 seconds\nconst soundPlayedDelay = 3 * 1000;\nconst soundPlayedIds = new Set<string>();\nconst notificationSound = new Audio('./notification.mp3');\nnotificationSound.setAttribute('mozaudiochannel', 'notification');\n\nexport async function playNotifySound(id?: string, volume?: number) {\n  if (id !== undefined && soundPlayedIds.has(id)) return;\n  const { notificationSoundVolume } = selectSettingsKeys(getGlobal());\n  const currentVolume = volume ? volume / 10 : notificationSoundVolume / 10;\n  if (currentVolume === 0) return;\n  notificationSound.volume = currentVolume;\n  if (id !== undefined) {\n    notificationSound.addEventListener('ended', () => {\n      soundPlayedIds.add(id);\n    }, { once: true });\n\n    setTimeout(() => {\n      soundPlayedIds.delete(id);\n    }, soundPlayedDelay);\n  }\n\n  try {\n    await notificationSound.play();\n  } catch (error) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('[PUSH] Unable to play notification sound');\n    }\n  }\n}\n\nexport const playNotifySoundDebounced = debounce(playNotifySound, 1000, true, false);\n\nfunction checkIfShouldResubscribe(subscription: PushSubscription | null) {\n  const global = getGlobal();\n  if (!global.push || !subscription) return true;\n  if (getDeviceToken(subscription) !== global.push.deviceToken) return true;\n  return Date.now() - global.push.subscribedAt > expirationTime;\n}\n\nexport async function requestPermission() {\n  if (IS_TAURI) {\n    const tauriPlugin = await import('@tauri-apps/plugin-notification');\n    const tauriPermissionGranted = await tauriPlugin.isPermissionGranted();\n\n    if (!tauriPermissionGranted) {\n      const permission = await tauriPlugin.requestPermission();\n\n      return permission === 'granted';\n    }\n\n    return true;\n  }\n\n  if (!('Notification' in window)) {\n    return false;\n  }\n  let permission = Notification.permission;\n  if (!['granted', 'denied'].includes(permission)) {\n    permission = await Notification.requestPermission();\n  }\n  return permission === 'granted';\n}\n\nasync function unsubscribeFromPush(subscription: PushSubscription | null) {\n  const { deleteDeviceToken } = getActions();\n  if (subscription) {\n    try {\n      const deviceToken = getDeviceToken(subscription);\n      await callApi('unregisterDevice', deviceToken);\n      await subscription.unsubscribe();\n      deleteDeviceToken();\n      return;\n    } catch (error) {\n      if (DEBUG) {\n        // eslint-disable-next-line no-console\n        console.log('[PUSH] Unable to unsubscribe from push.', error);\n      }\n    }\n  }\n  const global = getGlobal();\n  if (global.push) {\n    await callApi('unregisterDevice', global.push.deviceToken);\n    deleteDeviceToken();\n  }\n}\n\nexport async function unsubscribe() {\n  if (!checkIfPushSupported()) return;\n  const serviceWorkerRegistration = await navigator.serviceWorker.ready;\n  const subscription = await serviceWorkerRegistration.pushManager.getSubscription();\n  await unsubscribeFromPush(subscription);\n}\n\n// Load custom emoji from the api if it's not cached already\nasync function loadCustomEmoji(id: string) {\n  let global = getGlobal();\n  if (selectCustomEmoji(global, id)) return;\n  const customEmoji = await callApi('fetchCustomEmoji', {\n    documentId: [id],\n  });\n  if (!customEmoji) return;\n  global = getGlobal();\n  global = {\n    ...global,\n    customEmojis: {\n      ...global.customEmojis,\n      byId: {\n        ...global.customEmojis.byId,\n        ...buildCollectionByKey(customEmoji, 'id'),\n      },\n    },\n  };\n  setGlobal(global);\n}\n\nlet isSubscriptionFailed = false;\nexport function checkIfOfflinePushFailed() {\n  return isSubscriptionFailed;\n}\n\nexport async function subscribe() {\n  const { setDeviceToken, updateWebNotificationSettings } = getActions();\n  let hasWebNotifications = false;\n  let hasPushNotifications = false;\n  if (!checkIfPushSupported()) {\n    // Ask for notification permissions only if service worker notifications are not supported\n    // As pushManager.subscribe automatically triggers permission popup\n    hasWebNotifications = await requestPermission();\n    updateWebNotificationSettings({\n      hasWebNotifications,\n      hasPushNotifications,\n    });\n    return;\n  }\n  const serviceWorkerRegistration = await navigator.serviceWorker.ready;\n  let subscription = await serviceWorkerRegistration.pushManager.getSubscription();\n  if (!checkIfShouldResubscribe(subscription)) return;\n  await unsubscribeFromPush(subscription);\n  try {\n    subscription = await serviceWorkerRegistration.pushManager.subscribe({\n      userVisibleOnly: true,\n    });\n    const deviceToken = getDeviceToken(subscription);\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.log('[PUSH] Received push subscription: ', deviceToken);\n    }\n    await callApi('registerDevice', deviceToken);\n    setDeviceToken({ token: deviceToken });\n    hasPushNotifications = true;\n    hasWebNotifications = true;\n  } catch (error: any) {\n    if (Notification.permission === 'denied') {\n      // The user denied the notification permission which\n      // means we failed to subscribe and the user will need\n      // to manually change the notification permission to\n      // subscribe to push messages\n      if (DEBUG) {\n        // eslint-disable-next-line no-console\n        console.warn('[PUSH] The user has blocked push notifications.');\n      }\n    } else {\n      // A problem occurred with the subscription, this can\n      // often be down to an issue or lack of the gcm_sender_id\n      // and / or gcm_user_visible_only\n      if (DEBUG) {\n        // eslint-disable-next-line no-console\n        console.log('[PUSH] Unable to subscribe to push.', error);\n      }\n      // Request permissions and fall back to local notifications\n      // if pushManager.subscribe was aborted due to invalid VAPID key.\n      if ([DOMException.ABORT_ERR, DOMException.NOT_SUPPORTED_ERR].includes(error.code)) {\n        isSubscriptionFailed = true;\n        hasWebNotifications = await requestPermission();\n      }\n    }\n  }\n  updateWebNotificationSettings({\n    hasWebNotifications,\n    hasPushNotifications,\n  });\n}\n\nfunction checkIfShouldNotify(chat: ApiChat, message: Partial<ApiMessage>) {\n  const global = getGlobal();\n  const isChatMuted = getIsChatMuted(chat, selectNotifyDefaults(global), selectNotifyException(global, chat.id));\n  const topic = selectTopicFromMessage(global, message as ApiMessage);\n  const topicMutedUntil = topic?.notifySettings.mutedUntil;\n  const isMuted = topicMutedUntil === undefined ? isChatMuted : topicMutedUntil > getServerTime();\n  const shouldIgnoreMute = message.isMentioned;\n\n  const shouldNotifyAboutMessage = message.content?.action?.type !== 'phoneCall';\n  if ((isMuted && !shouldIgnoreMute) || !shouldNotifyAboutMessage\n    || chat.isNotJoined || !chat.isListed || selectIsChatWithSelf(global, chat.id)) {\n    return false;\n  }\n  // On touch devices show notifications when chat is not active\n  if (IS_TOUCH_ENV) {\n    const {\n      chatId,\n      type,\n    } = selectCurrentMessageList(global) || {};\n    return !(chatId === chat.id && type === 'thread');\n  }\n  // On desktop show notifications when window is not focused\n  return !document.hasFocus();\n}\n\nfunction getNotificationContent(chat: ApiChat, message: ApiMessage, reaction?: ApiPeerReaction) {\n  const global = getGlobal();\n  let sender = selectSender(global, message);\n  const hasReaction = Boolean(reaction);\n  if (hasReaction) {\n    sender = selectPeer(global, reaction.peerId);\n  }\n\n  const { isScreenLocked } = global.passcode;\n  const privateChatUserId = getPrivateChatUserId(chat);\n  const isSelf = privateChatUserId === global.currentUserId;\n\n  let body: string;\n  if (\n    !isScreenLocked\n    && getShouldShowMessagePreview(chat, selectNotifyDefaults(global), selectNotifyException(global, chat.id))\n  ) {\n    const senderName = sender ? getMessageSenderName(getTranslationFn(), chat.id, sender) : undefined;\n    let summary = jsxToHtml(<span><MessageSummary message={message} /></span>)[0].textContent || '';\n\n    if (hasReaction) {\n      const emoji = getReactionEmoji(reaction);\n      summary = oldTranslate('PushReactText', [emoji, summary]);\n    }\n\n    body = senderName ? `${senderName}: ${summary}` : summary;\n  } else {\n    body = getTranslationFn()('NotificationMessageTextHidden');\n  }\n\n  let title = isScreenLocked ? APP_NAME : getChatTitle(oldTranslate, chat, isSelf);\n\n  if (message.isSilent) {\n    title += ' ';\n  }\n\n  return { title, body };\n}\n\nasync function getAvatar(chat: ApiPeer) {\n  const imageHash = getChatAvatarHash(chat);\n  if (!imageHash) return undefined;\n  let mediaData = mediaLoader.getFromMemory(imageHash);\n  if (!mediaData) {\n    await mediaLoader.fetch(imageHash, ApiMediaFormat.BlobUrl);\n    mediaData = mediaLoader.getFromMemory(imageHash);\n  }\n  return mediaData;\n}\n\nfunction getReactionEmoji(reaction: ApiPeerReaction) {\n  let emoji;\n  if (reaction.reaction.type === 'emoji') {\n    emoji = reaction.reaction.emoticon;\n  }\n\n  if (reaction.reaction.type === 'custom') {\n    emoji = selectCustomEmoji(getGlobal(), reaction.reaction.documentId)?.emoji;\n  }\n  return emoji || '';\n}\n\nexport async function notifyAboutCall({\n  call, user,\n}: {\n  call: ApiPhoneCall; user: ApiUser;\n}) {\n  const { hasWebNotifications } = selectSettingsKeys(getGlobal());\n  if (document.hasFocus() || !hasWebNotifications) return;\n  const areNotificationsSupported = checkIfNotificationsSupported();\n  if (!areNotificationsSupported) return;\n\n  const icon = await getAvatar(user);\n\n  const options: NotificationOptions = {\n    body: getUserFullName(user),\n    icon,\n    badge: icon,\n    tag: `call_${call.id}`,\n  };\n\n  if ('vibrate' in navigator) {\n    // @ts-ignore\n    options.vibrate = [200, 100, 200];\n  }\n\n  const notification = new Notification(oldTranslate('VoipIncoming'), options);\n\n  notification.onclick = () => {\n    notification.close();\n    if (window.focus) {\n      window.focus();\n    }\n  };\n}\n\nexport async function notifyAboutMessage({\n  chat,\n  message,\n  isReaction = false,\n}: { chat: ApiChat; message: Partial<ApiMessage>; isReaction?: boolean }) {\n  const global = getGlobal();\n  const { hasWebNotifications } = selectSettingsKeys(global);\n  if (!checkIfShouldNotify(chat, message)) return;\n  const isChatSilent = getIsChatSilent(\n    chat, selectNotifyDefaults(getGlobal()), selectNotifyException(getGlobal(), chat.id),\n  );\n  const topic = selectTopicFromMessage(global, message as ApiMessage);\n  const isSilent = topic?.notifySettings.hasSound === undefined ? isChatSilent : !topic.notifySettings.hasSound;\n\n  const areNotificationsSupported = checkIfNotificationsSupported();\n  if (!hasWebNotifications || !areNotificationsSupported) {\n    if (!isSilent && !message.isSilent && !isReaction && !IS_TAURI) {\n      // Only play sound if web notifications are disabled\n      playNotifySoundDebounced(String(message.id) || chat.id);\n    }\n\n    return;\n  }\n  if (!areNotificationsSupported) return;\n\n  if (!message.id) return;\n\n  const activeReaction = getMessageRecentReaction(message);\n  // Do not notify about reactions on messages that are not outgoing\n  if (isReaction && !activeReaction) return;\n\n  // If this is a custom emoji reaction we need to make sure it is loaded\n  if (isReaction && activeReaction && activeReaction.reaction.type === 'custom') {\n    await loadCustomEmoji(activeReaction.reaction.documentId);\n  }\n\n  const icon = await getAvatar(chat);\n\n  const {\n    title,\n    body,\n  } = getNotificationContent(chat, message as ApiMessage, activeReaction);\n\n  if (checkIfPushSupported()) {\n    if (navigator.serviceWorker?.controller) {\n      // notify service worker about new message notification\n      navigator.serviceWorker.controller.postMessage({\n        type: 'showMessageNotification',\n        payload: {\n          title,\n          body,\n          icon,\n          chatId: chat.id,\n          messageId: message.id,\n          shouldReplaceHistory: true,\n          isSilent: isSilent || message.isSilent,\n          reaction: activeReaction?.reaction,\n        },\n      });\n    }\n  } else {\n    const dispatch = getActions();\n    const options: NotificationOptions = {\n      body,\n      icon,\n      badge: icon,\n      tag: String(message.id),\n    };\n\n    if ('vibrate' in navigator) {\n      // @ts-ignore\n      options.vibrate = [200, 100, 200];\n    }\n\n    const notification = new Notification(title, options);\n\n    notification.onclick = () => {\n      notification.close();\n      dispatch.focusMessage({\n        chatId: chat.id,\n        messageId: message.id!,\n        shouldReplaceHistory: true,\n      });\n      if (window.focus) {\n        window.focus();\n      }\n    };\n\n    // Play sound when notification is displayed\n    notification.onshow = () => {\n      // TODO Update when reaction badges are implemented\n      if (isReaction || message.isSilent || IS_TAURI) return;\n      playNotifySoundDebounced(String(message.id) || chat.id);\n    };\n  }\n}\n\nexport function closeMessageNotifications(payload: { chatId: string; lastReadInboxMessageId?: number }) {\n  if (IS_TEST || !navigator.serviceWorker?.controller) return;\n  navigator.serviceWorker.controller.postMessage({\n    type: 'closeMessageNotifications',\n    payload,\n  });\n}\n\n// Notify service worker that client is fully loaded\nexport function notifyClientReady() {\n  if (!navigator.serviceWorker?.controller) return;\n  navigator.serviceWorker.controller.postMessage({\n    type: 'clientReady',\n  });\n}\n","import { useRef, useUnmountCleanup } from '../lib/teact/teact';\n\nimport { cleanupEffect, isSignal } from '../util/signals';\n\nexport function useSignalEffect(effect: NoneToVoidFunction, dependencies: readonly any[]) {\n  // The is extracted from `useEffectOnce` to run before all effects\n  const isFirstRun = useRef(true);\n  if (isFirstRun.current) {\n    isFirstRun.current = false;\n\n    dependencies?.forEach((dependency) => {\n      if (isSignal(dependency)) {\n        dependency.subscribe(effect);\n      }\n    });\n  }\n\n  useUnmountCleanup(() => {\n    cleanupEffect(effect);\n  });\n}\n","import type { ElementRef } from '../lib/teact/teact';\nimport { useEffect, useRef, useState } from '../lib/teact/teact';\n\nimport type { Scheduler } from '../util/schedulers';\n\nimport { type CallbackManager, createCallbackManager } from '../util/callbacks';\nimport {\n  debounce, throttle, throttleWith,\n} from '../util/schedulers';\nimport useHeavyAnimation from './useHeavyAnimation';\nimport useLastCallback from './useLastCallback';\n\ntype TargetCallback = (entry: IntersectionObserverEntry) => void;\ntype RootCallback = (entries: IntersectionObserverEntry[]) => void;\ntype ObserveCleanup = NoneToVoidFunction;\nexport type ObserveFn = (target: HTMLElement, targetCallback?: TargetCallback) => ObserveCleanup;\n\ninterface IntersectionController {\n  observer: IntersectionObserver;\n  addCallback: (element: HTMLElement, callback: TargetCallback) => void;\n  removeCallback: (element: HTMLElement, callback: TargetCallback) => void;\n  destroy: NoneToVoidFunction;\n}\n\ninterface Response {\n  observe: ObserveFn;\n  freeze: NoneToVoidFunction;\n  unfreeze: NoneToVoidFunction;\n}\n\nexport function useIntersectionObserver({\n  rootRef,\n  throttleMs,\n  throttleScheduler,\n  debounceMs,\n  shouldSkipFirst,\n  margin,\n  threshold,\n  isDisabled,\n}: {\n  rootRef: ElementRef<HTMLDivElement>;\n  throttleMs?: number;\n  throttleScheduler?: Scheduler;\n  debounceMs?: number;\n  shouldSkipFirst?: boolean;\n  margin?: number;\n  threshold?: number | number[];\n  isDisabled?: boolean;\n}, rootCallback?: RootCallback): Response {\n  const controllerRef = useRef<IntersectionController>();\n  const rootCallbackRef = useRef<RootCallback>();\n  const freezeFlagsRef = useRef(0);\n  const onUnfreezeRef = useRef<NoneToVoidFunction>();\n\n  rootCallbackRef.current = rootCallback;\n\n  const freeze = useLastCallback(() => {\n    freezeFlagsRef.current++;\n  });\n\n  const unfreeze = useLastCallback(() => {\n    if (!freezeFlagsRef.current) {\n      return;\n    }\n\n    freezeFlagsRef.current--;\n\n    if (!freezeFlagsRef.current && onUnfreezeRef.current) {\n      onUnfreezeRef.current();\n      onUnfreezeRef.current = undefined;\n    }\n  });\n\n  useHeavyAnimation(freeze, unfreeze);\n\n  useEffect(() => {\n    if (isDisabled) {\n      return undefined;\n    }\n\n    return () => {\n      if (controllerRef.current) {\n        controllerRef.current.observer.disconnect();\n        controllerRef.current.destroy();\n        controllerRef.current = undefined;\n      }\n    };\n  }, [isDisabled]);\n\n  function initController() {\n    const callbacks = new Map<HTMLElement, CallbackManager<TargetCallback>>();\n    const entriesAccumulator = new Map<Element, IntersectionObserverEntry>();\n\n    let observerCallback: typeof observerCallbackSync;\n    if (typeof throttleScheduler === 'function') {\n      observerCallback = throttleWith(throttleScheduler, observerCallbackSync);\n    } else if (throttleMs) {\n      observerCallback = throttle(observerCallbackSync, throttleMs, !shouldSkipFirst);\n    } else if (debounceMs) {\n      observerCallback = debounce(observerCallbackSync, debounceMs, !shouldSkipFirst);\n    } else {\n      observerCallback = observerCallbackSync;\n    }\n\n    function observerCallbackSync() {\n      if (freezeFlagsRef.current) {\n        onUnfreezeRef.current = observerCallback;\n        return;\n      }\n\n      const entries = Array.from(entriesAccumulator.values());\n\n      entries.forEach((entry: IntersectionObserverEntry) => {\n        const callbackManager = callbacks.get(entry.target as HTMLElement);\n        callbackManager?.runCallbacks(entry);\n      });\n\n      if (rootCallbackRef.current) {\n        rootCallbackRef.current(entries);\n      }\n\n      entriesAccumulator.clear();\n    }\n\n    function addCallback(element: HTMLElement, callback: TargetCallback) {\n      if (!callbacks.get(element)) {\n        callbacks.set(element, createCallbackManager<TargetCallback>());\n      }\n\n      const callbackManager = callbacks.get(element)!;\n      callbackManager.addCallback(callback);\n    }\n\n    function removeCallback(element: HTMLElement, callback: TargetCallback) {\n      const callbackManager = callbacks.get(element);\n      if (!callbackManager) return;\n      callbackManager.removeCallback(callback);\n\n      if (!callbackManager.hasCallbacks()) {\n        callbacks.delete(element);\n      }\n    }\n\n    const observer = new IntersectionObserver(\n      (entries) => {\n        entries.forEach((entry) => {\n          entriesAccumulator.set(entry.target, entry);\n        });\n\n        if (freezeFlagsRef.current) {\n          onUnfreezeRef.current = observerCallback;\n        } else {\n          observerCallback();\n        }\n      },\n      {\n        root: rootRef.current,\n        rootMargin: margin ? `${margin}px` : undefined,\n        threshold,\n      },\n    );\n\n    function destroy() {\n      callbacks.clear();\n      observer.disconnect();\n      entriesAccumulator.clear();\n    }\n\n    controllerRef.current = {\n      observer,\n      addCallback,\n      removeCallback,\n      destroy,\n    };\n  }\n\n  const observe = useLastCallback((target, targetCallback) => {\n    if (!controllerRef.current) {\n      initController();\n    }\n\n    const controller = controllerRef.current!;\n    controller.observer.observe(target);\n\n    if (targetCallback) {\n      controller.addCallback(target, targetCallback);\n    }\n\n    return () => {\n      if (targetCallback) {\n        controller.removeCallback(target, targetCallback);\n      }\n\n      controller.observer.unobserve(target);\n    };\n  });\n\n  return { observe, freeze, unfreeze };\n}\n\nexport function useOnIntersect(\n  targetRef: ElementRef<HTMLDivElement>, observe?: ObserveFn, callback?: TargetCallback,\n) {\n  const lastCallback = useLastCallback(callback);\n\n  useEffect(() => {\n    return observe ? observe(targetRef.current!, lastCallback) : undefined;\n  }, [lastCallback, observe, targetRef]);\n}\n\nexport function useIsIntersecting(\n  targetRef: ElementRef<HTMLDivElement>, observe?: ObserveFn, callback?: TargetCallback,\n) {\n  const [isIntersecting, setIsIntersecting] = useState(!observe);\n\n  useOnIntersect(targetRef, observe, (entry) => {\n    setIsIntersecting(entry.isIntersecting);\n\n    if (callback) {\n      callback(entry);\n    }\n  });\n\n  return isIntersecting;\n}\n","export default function arePropsShallowEqual(currentProps: AnyLiteral, newProps: AnyLiteral) {\n  if (currentProps === newProps) {\n    return true;\n  }\n\n  const currentKeys = Object.keys(currentProps);\n  const currentKeysLength = currentKeys.length;\n  const newKeysLength = Object.keys(newProps).length;\n\n  if (currentKeysLength !== newKeysLength) {\n    return false;\n  }\n\n  if (currentKeysLength === 0) {\n    return true;\n  }\n\n  for (let i = 0; i < currentKeysLength; i++) {\n    const prop = currentKeys[i];\n    if (currentProps[prop] !== newProps[prop]) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nexport function logUnequalProps(currentProps: AnyLiteral, newProps: AnyLiteral, msg: string, debugKey = '') {\n  const currentKeys = Object.keys(currentProps);\n  const currentKeysLength = currentKeys.length;\n  const newKeysLength = Object.keys(newProps).length;\n\n  if (currentKeysLength !== newKeysLength) {\n    // eslint-disable-next-line no-console\n    console.log(`${msg} LENGTH`);\n    return;\n  }\n\n  // eslint-disable-next-line no-console\n  console.log(msg);\n  currentKeys.forEach((prop) => {\n    if (currentProps[prop] !== newProps[prop]) {\n      // eslint-disable-next-line no-console\n      console.log(debugKey, prop, ':', currentProps[prop], '=>', newProps[prop]);\n    }\n  });\n}\n","import type { VirtualElement } from '../../lib/teact/teact';\nimport TeactDOM from '../../lib/teact/teact-dom';\n\nexport default function jsxToHtml(jsx: VirtualElement) {\n  const fragment = document.createElement('div');\n  TeactDOM.render(jsx, fragment);\n\n  const children = Array.from(fragment.children);\n  TeactDOM.render(undefined, fragment);\n\n  return children;\n}\n","import { onIdle, throttleWith } from '../../util/schedulers';\nimport { createSignal } from '../../util/signals';\nimport { requestMeasure } from '../fasterdom/fasterdom';\n\nconst AUTO_END_TIMEOUT = 1000;\n\nlet counter = 0;\nlet counterBlocking = 0;\n\nconst [getIsAnimating, setIsAnimating] = createSignal(false);\nconst [getIsBlockingAnimating, setIsBlockingAnimating] = createSignal(false);\n\nexport const getIsHeavyAnimating = getIsAnimating;\nexport { getIsBlockingAnimating };\n\nexport function beginHeavyAnimation(duration = AUTO_END_TIMEOUT, isBlocking = false) {\n  counter++;\n\n  if (counter === 1) {\n    setIsAnimating(true);\n  }\n\n  if (isBlocking) {\n    counterBlocking++;\n\n    if (counterBlocking === 1) {\n      setIsBlockingAnimating(true);\n    }\n  }\n\n  const timeout = window.setTimeout(onEnd, duration);\n\n  let hasEnded = false;\n\n  function onEnd() {\n    if (hasEnded) return;\n    hasEnded = true;\n\n    clearTimeout(timeout);\n\n    counter--;\n\n    if (counter === 0) {\n      setIsAnimating(false);\n    }\n\n    if (isBlocking) {\n      counterBlocking--;\n\n      if (counterBlocking === 0) {\n        setIsBlockingAnimating(false);\n      }\n    }\n  }\n\n  return onEnd;\n}\n\nexport function onFullyIdle(cb: NoneToVoidFunction) {\n  onIdle(() => {\n    if (getIsAnimating()) {\n      requestMeasure(() => {\n        onFullyIdle(cb);\n      });\n    } else {\n      cb();\n    }\n  });\n}\n\nexport function throttleWithFullyIdle<F extends AnyToVoidFunction>(fn: F) {\n  return throttleWith(onFullyIdle, fn);\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"qEhgJEpm\",\"middle\":\"GjxPnwZR\",\"big\":\"HRLrnZvQ\",\"adaptive\":\"ebO2WJkv\",\"svg\":\"lbK6aMGA\",\"clickable\":\"hqg1cKl7\"};","import type { FC } from '../../../lib/teact/teact';\nimport { memo } from '../../../lib/teact/teact';\n\nimport buildClassName from '../../../util/buildClassName';\n\nimport useUniqueId from '../../../hooks/useUniqueId';\n\nimport styles from './StarIcon.module.scss';\n\ntype OwnProps = {\n  type?: 'gold' | 'premium' | 'regular';\n  size?: 'small' | 'middle' | 'big' | 'adaptive';\n  className?: string;\n  style?: string;\n  onClick?: VoidFunction;\n};\n\n/* eslint-disable @stylistic/max-len */\nconst STAR_PATH = 'M6.63869 12.1902L3.50621 14.1092C3.18049 14.3087 2.75468 14.2064 2.55515 13.8807C2.45769 13.7216 2.42864 13.5299 2.47457 13.3491L2.95948 11.4405C3.13452 10.7515 3.60599 10.1756 4.24682 9.86791L7.6642 8.22716C7.82352 8.15067 7.89067 7.95951 7.81418 7.80019C7.75223 7.67116 7.61214 7.59896 7.47111 7.62338L3.66713 8.28194C2.89387 8.41581 2.1009 8.20228 1.49941 7.69823L0.297703 6.69116C0.00493565 6.44581 -0.0335059 6.00958 0.211842 5.71682C0.33117 5.57442 0.502766 5.48602 0.687982 5.47153L4.35956 5.18419C4.61895 5.16389 4.845 4.99974 4.94458 4.75937L6.36101 1.3402C6.5072 0.987302 6.91179 0.819734 7.26469 0.965925C7.43413 1.03612 7.56876 1.17075 7.63896 1.3402L9.05539 4.75937C9.15496 4.99974 9.38101 5.16389 9.6404 5.18419L13.3322 5.47311C13.713 5.50291 13.9975 5.83578 13.9677 6.2166C13.9534 6.39979 13.8667 6.56975 13.7269 6.68896L10.9114 9.08928C10.7131 9.25826 10.6267 9.52425 10.6876 9.77748L11.5532 13.3733C11.6426 13.7447 11.414 14.1182 11.0427 14.2076C10.8642 14.2506 10.676 14.2208 10.5195 14.1249L7.36128 12.1902C7.13956 12.0544 6.8604 12.0544 6.63869 12.1902Z';\n/* eslint-enable @stylistic/max-len */\n\nconst StarIcon: FC<OwnProps> = ({\n  type = 'regular',\n  size = 'small',\n  className,\n  style,\n  onClick,\n}) => {\n  const randomId = useUniqueId();\n  const validSvgRandomId = `svg-${randomId}`; // ID must start with a letter\n\n  const renderIcon = () => {\n    switch (type) {\n      case 'gold':\n        return <GoldStarIcon randomId={validSvgRandomId} />;\n      case 'premium':\n        return <PremiumStarIcon randomId={validSvgRandomId} />;\n      default:\n        return <RegularStarIcon />;\n    }\n  };\n\n  return (\n    <i\n      onClick={onClick}\n      className={buildClassName(\n        'StarIcon',\n        styles.root,\n        className,\n        onClick && styles.clickable,\n        styles[size],\n      )}\n      style={style}\n    >\n      {renderIcon()}\n    </i>\n  );\n};\n\nfunction GoldStarIcon({ randomId }: { randomId: string }) {\n  const mask1Id = `${randomId}-mask1`;\n  const mask2Id = `${randomId}-mask2`;\n  const gradient1Id = `${randomId}-gradient1`;\n  const gradient2Id = `${randomId}-gradient2`;\n  const gradient3Id = `${randomId}-gradient3`;\n\n  return (\n    <svg className={styles.svg} width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n      <g clip-path=\"url(#clip0_4913_7387)\">\n        <mask id={mask1Id} style=\"mask-type:luminance\" maskUnits=\"userSpaceOnUse\" x=\"-2\" y=\"-2\" width=\"24\" height=\"24\">\n          <path d=\"M21.416 -1.42493H-1.08398V21.0751H21.416V-1.42493Z\" fill=\"white\" />\n        </mask>\n        <g mask={`url(#${mask1Id})`}>\n          <mask\n            id={mask2Id}\n            style=\"mask-type:luminance\"\n            maskUnits=\"userSpaceOnUse\"\n            x=\"-2\"\n            y=\"-2\"\n            width=\"24\"\n            height=\"24\"\n          >\n            <path d=\"M-1.08398 -1.42493H21.416V21.0751H-1.08398V-1.42493Z\" fill=\"white\" />\n          </mask>\n          <g mask={`url(#${mask2Id})`}>\n            <path d=\"M7.26843 6.25162L9.28943 2.22541C9.52311 1.76121 10.0884 1.5749 10.5494 1.80857C10.7294 1.90015 10.8747 2.04857 10.9662 2.23172L12.8767 6.11583C13.0314 6.43477 13.3378 6.64951 13.6883 6.69056L17.6829 7.17055C18.2261 7.23686 18.6145 7.73264 18.5513 8.27894C18.5229 8.50314 18.4218 8.71156 18.2608 8.86945L15.0998 11.9862C14.9703 12.1125 14.9103 12.2894 14.9324 12.4694L15.4598 16.6756C15.5356 17.2787 15.1093 17.8282 14.5093 17.904C14.2819 17.9324 14.0546 17.8913 13.8525 17.7808L10.5147 15.9556C10.2715 15.823 9.98099 15.8198 9.73784 15.9461L6.27687 17.7208C5.79057 17.9703 5.1969 17.7745 4.94743 17.285C4.8527 17.1019 4.82112 16.8966 4.84954 16.6945L5.12427 14.7619C5.26006 13.8177 5.84425 12.9967 6.69055 12.5641L10.5305 10.6031C10.6315 10.5526 10.6726 10.4263 10.622 10.322C10.581 10.2431 10.4957 10.1957 10.4073 10.2084L5.70847 10.8841C4.99164 10.9852 4.26535 10.7831 3.7001 10.322L2.13698 9.04629C1.69173 8.68314 1.6191 8.02 1.98225 7.57159C2.15277 7.36317 2.39592 7.22739 2.66118 7.19265L6.6716 6.67793C6.92739 6.64319 7.15159 6.4853 7.26843 6.25162Z\" fill={`url(#${gradient1Id})`} />\n            <path d=\"M10.8242 2.9422C10.4168 2.85062 9.98417 3.0464 9.78839 3.43797L7.76423 7.46419C7.64739 7.69787 7.42634 7.85576 7.1674 7.89049L3.15698 8.40837C2.89804 8.44311 2.6612 8.56942 2.49384 8.76837L3.97801 9.98097C4.44537 10.3631 5.05167 10.5304 5.64849 10.4452L10.3442 9.77255C10.6221 9.73466 10.8936 9.8736 11.0168 10.1231C11.1778 10.442 11.0515 10.8336 10.7326 10.9978L9.50734 11.623L10.9031 11.4209C10.9915 11.4083 11.0799 11.4557 11.1178 11.5346C11.1715 11.6388 11.1273 11.7651 11.0263 11.8157L7.18635 13.7767C6.34006 14.2093 5.75586 15.0303 5.62007 15.9745L5.44008 17.2282C5.60428 17.3924 5.86322 17.4366 6.07796 17.326L9.53261 15.5514C9.90839 15.3587 10.3536 15.365 10.7231 15.5671L14.0609 17.3924C14.1809 17.4587 14.3199 17.4839 14.4556 17.4682C14.8093 17.4239 15.0651 17.0955 15.0209 16.7324L14.4967 12.523C14.4588 12.2072 14.5662 11.8946 14.7904 11.6736L17.9513 8.55679C18.005 8.50311 18.0461 8.43995 18.0745 8.37048L14.1841 7.90312C13.8336 7.86207 13.5304 7.64418 13.3725 7.3284L13.2209 7.01578C12.902 6.87683 12.6399 6.63052 12.482 6.31159L10.8242 2.9422Z\" fill={`url(#${gradient2Id})`} />\n            <path d=\"M10.7484 1.41397C10.0663 1.06977 9.23893 1.3445 8.89789 2.02659L6.87373 6.05596C6.8232 6.15701 6.72531 6.22649 6.61478 6.23912L2.60436 6.757C2.22542 6.80437 1.87806 7.00015 1.63807 7.29699C1.12334 7.93486 1.22124 8.86958 1.85596 9.38746L3.42223 10.6664C4.08222 11.2032 4.93167 11.44 5.77165 11.32L9.09051 10.8432L6.48847 12.1727C5.51271 12.6716 4.84325 13.6126 4.68852 14.6989L4.41063 16.6315C4.36958 16.9252 4.41695 17.222 4.55273 17.4873C4.90956 18.1915 5.77481 18.4725 6.479 18.1125L9.93681 16.3378C10.0505 16.2778 10.1863 16.281 10.3 16.3441L13.6378 18.1662C13.9188 18.3209 14.2441 18.3841 14.563 18.343C15.4061 18.2357 15.9998 17.462 15.8956 16.622L15.3714 12.4126C15.3651 12.3716 15.3809 12.3274 15.4093 12.299L18.5703 9.1822C18.8008 8.95168 18.9492 8.65169 18.9871 8.32959C19.0787 7.5433 18.5229 6.82963 17.7366 6.73489L13.7388 6.25491C13.5399 6.2328 13.363 6.10649 13.2715 5.92334L11.3641 2.03606C11.2315 1.76765 11.0136 1.54976 10.7484 1.41397ZM9.68418 2.42132C9.80734 2.17501 10.1073 2.07712 10.3505 2.20027C10.4452 2.24764 10.5242 2.32974 10.5715 2.42763L12.482 6.31175C12.7031 6.76332 13.1357 7.06962 13.6346 7.12962L17.6324 7.60961C17.9324 7.64435 18.1471 7.91908 18.1124 8.22538C18.0966 8.3517 18.0398 8.46854 17.9513 8.55695L14.7904 11.6737C14.5662 11.8948 14.4588 12.2074 14.4967 12.5232L15.0209 16.7325C15.0651 17.0957 14.8093 17.4241 14.4556 17.4683C14.3199 17.4841 14.1809 17.4588 14.0609 17.3925L10.7231 15.5673C10.3536 15.3652 9.90839 15.362 9.53261 15.5547L6.0748 17.3294C5.80638 17.4652 5.47797 17.3578 5.33903 17.0862C5.2885 16.9852 5.26956 16.8683 5.28534 16.7546L5.56007 14.8252C5.67376 14.0231 6.17269 13.3253 6.88952 12.959L10.7294 10.9979C11.0515 10.8337 11.1778 10.4422 11.0168 10.1232C10.8905 9.87376 10.6221 9.73482 10.3442 9.77271L5.64534 10.4453C5.04851 10.5306 4.44537 10.3632 3.97801 9.98113L2.41489 8.70221C2.15595 8.49064 2.1149 8.10854 2.32647 7.8496C2.42436 7.72961 2.56331 7.65066 2.71488 7.63171L6.72531 7.11383C7.12951 7.06331 7.48003 6.81384 7.66318 6.45069L9.68418 2.42132Z\" fill={`url(#${gradient3Id})`} />\n          </g>\n        </g>\n      </g>\n      <defs>\n        <linearGradient\n          id={gradient1Id}\n          x1=\"10.1547\"\n          y1=\"1.70752\"\n          x2=\"10.1547\"\n          y2=\"17.9134\"\n          gradientUnits=\"userSpaceOnUse\"\n        >\n          <stop stop-color=\"#FFF0C2\" />\n          <stop offset=\"1\" stop-color=\"#FFEBBA\" />\n        </linearGradient>\n        <linearGradient\n          id={gradient2Id}\n          x1=\"10.2842\"\n          y1=\"2.92009\"\n          x2=\"14.7304\"\n          y2=\"17.4713\"\n          gradientUnits=\"userSpaceOnUse\"\n        >\n          <stop stop-color=\"#FFD147\" />\n          <stop offset=\"1\" stop-color=\"#FFB526\" />\n        </linearGradient>\n        <linearGradient\n          id={gradient3Id}\n          x1=\"10.1547\"\n          y1=\"1.26556\"\n          x2=\"14.0546\"\n          y2=\"18.3525\"\n          gradientUnits=\"userSpaceOnUse\"\n        >\n          <stop stop-color=\"#E58F0D\" />\n          <stop offset=\"1\" stop-color=\"#EB7814\" />\n        </linearGradient>\n        <clipPath id=\"clip0_4913_7387\">\n          <rect width=\"20\" height=\"20\" fill=\"white\" />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n}\n\nfunction PremiumStarIcon({ randomId }: { randomId: string }) {\n  return (\n    <svg className={styles.svg} width=\"14\" height=\"15\" viewBox=\"0 0 14 15\" fill=\"none\">\n      <defs>\n        <linearGradient id={randomId} x1=\"3\" y1=\"63.5001\" x2=\"84.1475\" y2=\"-1.32262\" gradientUnits=\"userSpaceOnUse\">\n          <stop stop-color=\"#6B93FF\" />\n          <stop offset=\"0.439058\" stop-color=\"#976FFF\" />\n          <stop offset=\"1\" stop-color=\"#E46ACE\" />\n        </linearGradient>\n      </defs>\n      <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d={STAR_PATH} fill={`url(#${randomId})`} />\n    </svg>\n  );\n}\n\nfunction RegularStarIcon() {\n  return (\n    <svg className={styles.svg} width=\"14\" height=\"15\" viewBox=\"0 0 14 15\" fill=\"none\">\n      <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d={STAR_PATH} fill=\"var(--color-fill)\" />\n    </svg>\n  );\n}\n\nexport default memo(StarIcon);\n","export default class Deferred<T = void> {\n  promise: Promise<T>;\n\n  reject!: (reason?: any) => void;\n\n  resolve!: (value: T | PromiseLike<T>) => void;\n\n  constructor() {\n    this.promise = new Promise((resolve, reject) => {\n      this.reject = reject;\n      this.resolve = resolve;\n    });\n  }\n\n  static resolved(): Deferred<void>;\n  static resolved<T>(value: T): Deferred<T>;\n  static resolved<T>(value?: T): Deferred<T | void> {\n    const deferred = new Deferred<T | void>();\n    deferred.resolve(value);\n    return deferred;\n  }\n}\n","import { CHANNEL_ID_BASE } from '../../config';\n\nexport function isUserId(entityId: string) {\n  return !entityId.startsWith('-');\n}\n\nexport function isChannelId(entityId: string) {\n  const n = Number(entityId);\n  return n < -CHANNEL_ID_BASE;\n}\n\nexport function toChannelId(mtpId: string) {\n  const n = Number(mtpId);\n  return String(-CHANNEL_ID_BASE - n);\n}\n\nexport function getCleanPeerId(peerId: string) {\n  return isChannelId(peerId)\n    // Remove -1 and leading zeros\n    ? peerId.replace(/^-10+/, '')\n    : peerId.replace('-', '');\n}\n\nexport function getPeerIdDividend(peerId: string) {\n  return Math.abs(Number(getCleanPeerId(peerId)));\n}\n","import { DEBUG } from '../../config';\n\ntype Handler = (e: Event) => void;\ntype DelegationRegistry = Map<Element, Handler>;\n\nconst NON_BUBBLEABLE_EVENTS = new Set(['scroll', 'mouseenter', 'mouseleave', 'load', 'error']);\n\nconst documentEventCounters: Record<string, number> = {};\nconst delegationRegistryByEventType: Record<string, DelegationRegistry> = {};\nconst delegatedEventTypesByElement = new Map<Element, Set<string>>();\n\nexport function addEventListener(element: Element, propName: string, handler: Handler, asCapture = false) {\n  const eventType = resolveEventType(propName, element);\n  if (canUseEventDelegation(eventType, element, asCapture)) {\n    addDelegatedListener(eventType, element, handler);\n  } else {\n    element.addEventListener(eventType, handler, asCapture);\n  }\n}\n\nexport function removeEventListener(element: Element, propName: string, handler: Handler, asCapture = false) {\n  const eventType = resolveEventType(propName, element);\n  if (canUseEventDelegation(eventType, element, asCapture)) {\n    removeDelegatedListener(eventType, element);\n  } else {\n    element.removeEventListener(eventType, handler, asCapture);\n  }\n}\n\nexport function resolveEventType(propName: string, element: Element) {\n  const eventType = propName\n    .replace(/^on/, '')\n    .replace(/Capture$/, '').toLowerCase();\n\n  if (eventType === 'change' && element.tagName !== 'SELECT') {\n    // React behavior repeated here.\n    // https://stackoverflow.com/questions/38256332/in-react-whats-the-difference-between-onchange-and-oninput\n    return 'input';\n  }\n\n  if (eventType === 'doubleclick') {\n    return 'dblclick';\n  }\n\n  // Replace focus/blur by their \"bubbleable\" versions\n  if (eventType === 'focus') {\n    return 'focusin';\n  }\n\n  if (eventType === 'blur') {\n    return 'focusout';\n  }\n\n  return eventType;\n}\n\nfunction canUseEventDelegation(realEventType: string, element: Element, asCapture: boolean) {\n  return (\n    !asCapture\n    && !NON_BUBBLEABLE_EVENTS.has(realEventType)\n    && element.tagName !== 'VIDEO'\n    && element.tagName !== 'IFRAME'\n  );\n}\n\nfunction addDelegatedListener(eventType: string, element: Element, handler: Handler) {\n  if (!documentEventCounters[eventType]) {\n    documentEventCounters[eventType] = 0;\n    document.addEventListener(eventType, handleEvent);\n  }\n\n  resolveDelegationRegistry(eventType).set(element, handler);\n  resolveDelegatedEventTypes(element).add(eventType);\n  documentEventCounters[eventType]++;\n}\n\nfunction removeDelegatedListener(eventType: string, element: Element) {\n  documentEventCounters[eventType]--;\n  if (!documentEventCounters[eventType]) {\n    // Synchronous deletion on 0 will cause perf degradation in the case of 1 element\n    // which is not a real case, so it's ok to do it this way\n    document.removeEventListener(eventType, handleEvent);\n  }\n\n  delegationRegistryByEventType[eventType].delete(element);\n  delegatedEventTypesByElement.get(element)!.delete(eventType);\n}\n\nexport function removeAllDelegatedListeners(element: Element) {\n  const eventTypes = delegatedEventTypesByElement.get(element);\n  if (!eventTypes) {\n    return;\n  }\n\n  eventTypes.forEach((eventType) => removeDelegatedListener(eventType, element));\n  delegatedEventTypesByElement.delete(element);\n}\n\nfunction handleEvent(realEvent: Event) {\n  const events = delegationRegistryByEventType[realEvent.type];\n\n  if (events) {\n    let furtherCallsPrevented = false;\n    let current: Element = realEvent.target as Element;\n\n    const stopPropagation = () => {\n      furtherCallsPrevented = true;\n    };\n\n    const preventDefault = () => {\n      realEvent.preventDefault();\n    };\n\n    // Proxy is a simplest way to provide an access to the event property\n    const event = new Proxy(realEvent, {\n      get(target, p) {\n        if (p === 'currentTarget') {\n          return current;\n        }\n        if (p === 'stopPropagation' || p === 'stopImmediatePropagation') {\n          return stopPropagation;\n        }\n        if (p === 'preventDefault') {\n          // \"this\" is changed to proxy and one can't call methods via it\n          return preventDefault;\n        }\n        return Reflect.get(target, p);\n      },\n    });\n\n    // This can also be limited by teact root\n    while (current && current !== document.body) {\n      const handler = events.get(current);\n      if (handler) {\n        handler(event);\n        if (furtherCallsPrevented) {\n          return;\n        }\n      }\n\n      current = current.parentNode as Element;\n    }\n  }\n}\n\nfunction resolveDelegationRegistry(eventType: string) {\n  if (!delegationRegistryByEventType[eventType]) {\n    delegationRegistryByEventType[eventType] = new Map();\n  }\n\n  return delegationRegistryByEventType[eventType];\n}\n\nfunction resolveDelegatedEventTypes(element: Element) {\n  const existing = delegatedEventTypesByElement.get(element);\n  if (existing) {\n    return existing;\n  }\n\n  const newSet = new Set<string>();\n  delegatedEventTypesByElement.set(element, newSet);\n\n  return newSet;\n}\n\nif (DEBUG) {\n  document.addEventListener('dblclick', () => {\n    const documentListenersCount = Object.keys(documentEventCounters).length;\n    const delegatedHandlersCount1 = Object.values(documentEventCounters)\n      .reduce((acc, counter) => acc + counter, 0);\n    const delegationRegistriesCount = Object.keys(delegationRegistryByEventType).length;\n    const delegatedHandlersCount2 = Object.values(delegationRegistryByEventType)\n      .reduce((acc, delegationRegistry) => acc + delegationRegistry.size, 0);\n    const delegationElementsCount = delegatedEventTypesByElement.size;\n    const delegatedEventTypesCount = Array.from(delegatedEventTypesByElement.values())\n      .reduce((acc, eventTypes) => acc + eventTypes.size, 0);\n\n    // eslint-disable-next-line no-console\n    console.warn('DELEGATED EVENTS STATS', {\n      delegatedHandlersCount1,\n      delegatedHandlersCount2,\n      delegatedEventTypesCount,\n      delegationRegistriesCount,\n      delegationElementsCount,\n      documentListenersCount,\n    });\n  });\n}\n","import { SVG_EXTENSIONS } from '../../config';\n\nconst UNSAFE_MIME_TYPES = new Set(['text/html', 'image/svg+xml']);\nconst UNSAFE_EXTENSIONS = new Set([\n  ...SVG_EXTENSIONS,\n  'htm', 'html', 'svg', 'm4v', 'm3u', 'm3u8', 'xhtml', 'xml',\n]);\n\nexport function isIpRevealingMedia({ mimeType, extension }: { mimeType?: string; extension: string }) {\n  if (mimeType && UNSAFE_MIME_TYPES.has(mimeType)) {\n    return true;\n  }\n\n  if (UNSAFE_EXTENSIONS.has(extension)) {\n    return true;\n  }\n\n  return false;\n}\n","import type { ElementRef } from '../lib/teact/teact';\nimport { useEffect, useState } from '../lib/teact/teact';\n\nimport { requestMeasure, requestMutation } from '../lib/fasterdom/fasterdom';\nimport useLastCallback from './useLastCallback';\n\nconst useKeyboardListNavigation = (\n  elementRef: ElementRef<HTMLElement>,\n  isOpen: boolean,\n  onSelectWithEnter?: (index: number) => void,\n  itemSelector?: string,\n  noCaptureFocus?: boolean,\n) => {\n  const [focusedIndex, setFocusedIndex] = useState(-1);\n\n  useEffect(() => {\n    setFocusedIndex(-1);\n\n    const element = elementRef.current;\n    if (isOpen && element && !noCaptureFocus) {\n      requestMutation(() => {\n        element.tabIndex = -1;\n      });\n      requestMeasure(() => element.focus());\n    }\n  }, [elementRef, isOpen, noCaptureFocus]);\n\n  return useLastCallback((e: React.KeyboardEvent<any>) => {\n    const element = elementRef.current;\n\n    if (!element) {\n      return;\n    }\n\n    if (e.keyCode === 13 && onSelectWithEnter) {\n      onSelectWithEnter(focusedIndex);\n      return;\n    }\n\n    if (e.keyCode !== 38 && e.keyCode !== 40) {\n      return;\n    }\n\n    const focusedElement = document.activeElement;\n    const elementChildren = Array.from(itemSelector ? element.querySelectorAll(itemSelector) : element.children);\n\n    let newIndex = (focusedElement && elementChildren.indexOf(focusedElement)) || focusedIndex;\n\n    if (e.keyCode === 38 && newIndex > 0) {\n      newIndex--;\n    } else if (e.keyCode === 40 && newIndex < elementChildren.length - 1) {\n      newIndex++;\n    } else if (elementChildren.length === 1) {\n      newIndex = 0;\n    } else {\n      return;\n    }\n\n    const item = elementChildren[newIndex] as HTMLElement;\n    if (item) {\n      setFocusedIndex(newIndex);\n      item.focus();\n    }\n  });\n};\n\nexport default useKeyboardListNavigation;\n","export const MIN_USERNAME_LENGTH = 3; // Some bots have 3-letter usernames\nexport const MIN_UPDATE_USERNAME_LENGTH = 5; // 4 letter usernames are only available on Fragment\nexport const MAX_USERNAME_LENGTH = 32;\nexport const USERNAME_REGEX = /^[a-zA-Z]\\w+$/;\n\nexport function isUsernameValid(username: string, isUpdating?: boolean) {\n  const minUsernameLength = isUpdating ? MIN_UPDATE_USERNAME_LENGTH : MIN_USERNAME_LENGTH;\n  return username.length >= minUsernameLength\n    && username.length <= MAX_USERNAME_LENGTH\n    && USERNAME_REGEX.test(username);\n}\n","import { addCallback } from '../../../lib/teact/teactn';\n\nimport type { ActionReturnType, GlobalState } from '../../types';\nimport { type LangCode, LeftColumnContent, SettingsScreens } from '../../../types';\n\nimport { requestMutation } from '../../../lib/fasterdom/fasterdom';\nimport { IS_IOS } from '../../../util/browser/windowEnvironment';\nimport { disableDebugConsole, initDebugConsole } from '../../../util/debugConsole';\nimport { getCurrentTabId } from '../../../util/establishMultitabRole';\nimport { oldSetLanguage, setTimeFormat } from '../../../util/oldLangProvider';\nimport { applyPerformanceSettings } from '../../../util/perfomanceSettings';\nimport switchTheme from '../../../util/switchTheme';\nimport { updatePeerColors } from '../../../util/theme';\nimport { callApi, setShouldEnableDebugLog } from '../../../api/gramjs';\nimport {\n  addActionHandler, getActions, setGlobal,\n} from '../../index';\nimport { replaceSettings, updateSharedSettings, updateThemeSettings } from '../../reducers';\nimport { updateTabState } from '../../reducers/tabs';\nimport { selectCanAnimateInterface, selectChatFolder, selectTabState } from '../../selectors';\nimport { selectSharedSettings } from '../../selectors/sharedState';\n\nlet prevGlobal: GlobalState | undefined;\n\naddCallback((global: GlobalState) => {\n  const { updatePageTitle, updateShouldDebugExportedSenders, updateShouldEnableDebugLog } = getActions();\n\n  const oldGlobal = prevGlobal;\n  prevGlobal = global;\n\n  if (!oldGlobal) return;\n\n  const oldSharedSettings = selectSharedSettings(oldGlobal);\n  const sharedSettings = selectSharedSettings(global);\n\n  const performance = sharedSettings.performance;\n  const prevPerformance = oldSharedSettings.performance;\n  const peerColors = global.peerColors;\n  const prevPeerColors = oldGlobal.peerColors;\n\n  if (peerColors && peerColors !== prevPeerColors) {\n    updatePeerColors(peerColors.general);\n  }\n\n  if (performance !== prevPerformance) {\n    requestMutation(() => {\n      applyPerformanceSettings(performance);\n    });\n  }\n\n  if (sharedSettings.theme !== oldSharedSettings.theme) {\n    const withAnimation = document.hasFocus() ? selectCanAnimateInterface(global) : false;\n    switchTheme(sharedSettings.theme, withAnimation);\n  }\n\n  if (sharedSettings.language !== oldSharedSettings.language) {\n    oldSetLanguage(sharedSettings.language as LangCode);\n  }\n\n  if (sharedSettings.timeFormat !== oldSharedSettings.timeFormat) {\n    setTimeFormat(sharedSettings.timeFormat);\n  }\n\n  if (sharedSettings.messageTextSize !== oldSharedSettings.messageTextSize) {\n    document.documentElement.style.setProperty(\n      '--composer-text-size', `${Math.max(sharedSettings.messageTextSize, IS_IOS ? 16 : 15)}px`,\n    );\n    document.documentElement.style.setProperty('--message-meta-height',\n      `${Math.floor(sharedSettings.messageTextSize * 1.3125)}px`);\n    document.documentElement.style.setProperty('--message-text-size', `${sharedSettings.messageTextSize}px`);\n    document.documentElement.setAttribute('data-message-text-size', sharedSettings.messageTextSize.toString());\n  }\n\n  if (sharedSettings.canDisplayChatInTitle !== oldSharedSettings.canDisplayChatInTitle) {\n    updatePageTitle();\n  }\n\n  if (sharedSettings.shouldForceHttpTransport !== oldSharedSettings.shouldForceHttpTransport) {\n    callApi('setForceHttpTransport', Boolean(sharedSettings.shouldForceHttpTransport));\n  }\n\n  if (sharedSettings.shouldAllowHttpTransport !== oldSharedSettings.shouldAllowHttpTransport) {\n    callApi('setAllowHttpTransport', Boolean(sharedSettings.shouldAllowHttpTransport));\n    if (!sharedSettings.shouldAllowHttpTransport && sharedSettings.shouldForceHttpTransport) {\n      global = updateSharedSettings(global, {\n        shouldForceHttpTransport: false,\n      });\n      setGlobal(global);\n    }\n  }\n\n  if (sharedSettings.shouldDebugExportedSenders !== oldSharedSettings.shouldDebugExportedSenders) {\n    updateShouldDebugExportedSenders();\n  }\n\n  if (sharedSettings.shouldCollectDebugLogs !== oldSharedSettings.shouldCollectDebugLogs) {\n    updateShouldEnableDebugLog();\n  }\n});\n\naddActionHandler('updateShouldEnableDebugLog', (global): ActionReturnType => {\n  const settings = selectSharedSettings(global);\n\n  if (settings.shouldCollectDebugLogs) {\n    setShouldEnableDebugLog(true);\n    initDebugConsole();\n  } else {\n    setShouldEnableDebugLog(false);\n    disableDebugConsole();\n  }\n});\n\naddActionHandler('updateShouldDebugExportedSenders', (global): ActionReturnType => {\n  const settings = selectSharedSettings(global);\n  callApi('setShouldDebugExportedSenders', Boolean(settings.shouldDebugExportedSenders));\n});\n\naddActionHandler('setSettingOption', (global, actions, payload): ActionReturnType => {\n  return replaceSettings(global, payload);\n});\n\naddActionHandler('setSharedSettingOption', (global, actions, payload): ActionReturnType => {\n  return updateSharedSettings(global, payload);\n});\n\naddActionHandler('updatePerformanceSettings', (global, actions, payload): ActionReturnType => {\n  const settings = selectSharedSettings(global);\n  global = updateSharedSettings(global, {\n    performance: {\n      ...settings.performance,\n      ...payload,\n    },\n    wasAnimationLevelSetManually: true,\n  });\n\n  return global;\n});\n\naddActionHandler('setThemeSettings', (global, actions, payload): ActionReturnType => {\n  const { theme, ...settings } = payload;\n\n  return updateThemeSettings(global, theme, settings);\n});\n\naddActionHandler('requestNextFoldersAction', (global, actions, payload): ActionReturnType => {\n  const { foldersAction, tabId = getCurrentTabId() } = payload;\n  return updateTabState(global, {\n    nextFoldersAction: foldersAction,\n  }, tabId);\n});\n\naddActionHandler('openLeftColumnContent', (global, actions, payload): ActionReturnType => {\n  const { contentKey = LeftColumnContent.ChatList, tabId = getCurrentTabId() } = payload;\n  const tabState = selectTabState(global, tabId);\n  return updateTabState(global, {\n    leftColumn: {\n      ...tabState.leftColumn,\n      contentKey,\n    },\n  }, tabId);\n});\n\naddActionHandler('openSettingsScreen', (global, actions, payload): ActionReturnType => {\n  const { screen = SettingsScreens.Main, tabId = getCurrentTabId() } = payload;\n  const tabState = selectTabState(global, tabId);\n  // Force settings only if new screen is passed, do not on resets\n  if (payload.screen) actions.openLeftColumnContent({ contentKey: LeftColumnContent.Settings, tabId });\n  return updateTabState(global, {\n    leftColumn: {\n      ...tabState.leftColumn,\n      settingsScreen: screen,\n    },\n  }, tabId);\n});\n\naddActionHandler('openEditChatFolder', (global, actions, payload): ActionReturnType => {\n  const { folderId, isOnlyInvites, tabId = getCurrentTabId() } = payload;\n\n  const chatFolder = selectChatFolder(global, folderId);\n  if (!chatFolder) return;\n\n  actions.openSettingsScreen({\n    screen: isOnlyInvites ? SettingsScreens.FoldersEditFolderInvites : SettingsScreens.FoldersEditFolderFromChatList,\n    tabId,\n  });\n  actions.requestNextFoldersAction({\n    foldersAction: {\n      type: 'editFolder',\n      payload: chatFolder,\n    },\n    tabId,\n  });\n});\n\naddActionHandler('openShareChatFolderModal', (global, actions, payload): ActionReturnType => {\n  const {\n    folderId, url, noRequestNextScreen, tabId = getCurrentTabId(),\n  } = payload;\n\n  const chatFolder = selectChatFolder(global, folderId);\n  const isChatList = chatFolder?.isChatList;\n  if (isChatList && !noRequestNextScreen) {\n    actions.openEditChatFolder({ folderId, isOnlyInvites: true, tabId });\n    return undefined;\n  }\n\n  if (!noRequestNextScreen) actions.openSettingsScreen({ screen: SettingsScreens.FoldersShare, tabId });\n\n  return updateTabState(global, {\n    shareFolderScreen: {\n      folderId,\n      isFromSettings: Boolean(noRequestNextScreen),\n      url,\n    },\n  }, tabId);\n});\n\naddActionHandler('closeShareChatFolderModal', (global, actions, payload): ActionReturnType => {\n  const { tabId = getCurrentTabId() } = payload || {};\n\n  actions.openSettingsScreen({ screen: undefined, tabId });\n\n  return updateTabState(global, {\n    shareFolderScreen: undefined,\n  }, tabId);\n});\n","import type React from '../lib/teact/teact';\n\nimport { IS_TOUCH_ENV, MouseButton } from '../util/browser/windowEnvironment';\nimport useLastCallback from './useLastCallback';\n\ntype EventArg<E> = React.MouseEvent<E>;\ntype EventHandler<E> = (e: EventArg<E>) => void;\n\nexport function useFastClick<T extends HTMLDivElement | HTMLButtonElement>(callback?: EventHandler<T>) {\n  const handler = useLastCallback((e: EventArg<T>) => {\n    if (e.type === 'mousedown' && e.button !== MouseButton.Main) {\n      return;\n    }\n\n    callback!(e);\n  });\n\n  return IS_TOUCH_ENV\n    ? { handleClick: callback ? handler : undefined }\n    : { handleMouseDown: callback ? handler : undefined };\n}\n","import captureKeyboardListener from './captureKeyboardListeners';\n\ntype IHandlerFunction = () => void;\n\nexport default function captureEscKeyListener(handler: IHandlerFunction) {\n  return captureKeyboardListener({ onEsc: handler });\n}\n","import type { ApiAppConfig, ApiLimitType } from './api/types';\n\nimport { MULTIACCOUNT_MAX_SLOTS } from './config';\n\nexport const MAX_UNIQUE_REACTIONS = 11;\nexport const GROUP_CALL_PARTICIPANTS_LIMIT = 100;\nexport const STORY_LIST_LIMIT = 100;\nexport const API_GENERAL_ID_LIMIT = 100;\nexport const RESALE_GIFTS_LIMIT = 50;\nexport const PINNED_MESSAGES_LIMIT = 50;\nexport const BLOCKED_LIST_LIMIT = 100;\nexport const GLOBAL_SEARCH_CONTACTS_LIMIT = 20;\n\n// As in Telegram for Android\n// https://github.com/DrKLO/Telegram/blob/51e9947527/TMessagesProj/src/main/java/org/telegram/messenger/MediaDataController.java#L7799\nexport const TOP_REACTIONS_LIMIT = 100;\nexport const RECENT_REACTIONS_LIMIT = 50;\nexport const REACTION_LIST_LIMIT = 100;\n\nexport const DEFAULT_LIMITS: Record<ApiLimitType, readonly [number, number]> = {\n  uploadMaxFileparts: [4000, 8000],\n  stickersFaved: [5, 10],\n  savedGifs: [200, 400],\n  dialogFiltersChats: [100, 200],\n  dialogFilters: [10, 20],\n  dialogFolderPinned: [5, 10],\n  captionLength: [1024, 4096],\n  channels: [500, 1000],\n  channelsPublic: [10, 20],\n  aboutLength: [70, 140],\n  chatlistInvites: [3, 100],\n  chatlistJoined: [2, 20],\n  recommendedChannels: [10, 100],\n  savedDialogsPinned: [5, 100],\n  maxReactions: [1, 3],\n  moreAccounts: [3, MULTIACCOUNT_MAX_SLOTS],\n};\n\nexport const DEFAULT_MAX_MESSAGE_LENGTH = 4096;\n\nexport const DEFAULT_APP_CONFIG: ApiAppConfig = {\n  hash: 0,\n  limits: {\n    uploadMaxFileparts: DEFAULT_LIMITS.uploadMaxFileparts,\n    stickersFaved: DEFAULT_LIMITS.stickersFaved,\n    savedGifs: DEFAULT_LIMITS.savedGifs,\n    dialogFiltersChats: DEFAULT_LIMITS.dialogFiltersChats,\n    dialogFilters: DEFAULT_LIMITS.dialogFilters,\n    dialogFolderPinned: DEFAULT_LIMITS.dialogFolderPinned,\n    captionLength: DEFAULT_LIMITS.captionLength,\n    channels: DEFAULT_LIMITS.channels,\n    channelsPublic: DEFAULT_LIMITS.channelsPublic,\n    aboutLength: DEFAULT_LIMITS.aboutLength,\n    chatlistInvites: DEFAULT_LIMITS.chatlistInvites,\n    chatlistJoined: DEFAULT_LIMITS.chatlistJoined,\n    recommendedChannels: DEFAULT_LIMITS.recommendedChannels,\n    savedDialogsPinned: DEFAULT_LIMITS.savedDialogsPinned,\n    moreAccounts: DEFAULT_LIMITS.moreAccounts,\n    maxReactions: DEFAULT_LIMITS.maxReactions,\n  },\n  autologinDomains: [\n    'instantview.telegram.org',\n    'translations.telegram.org',\n    'contest.dev',\n    'contest.com',\n    'bugs.telegram.org',\n    'suggestions.telegram.org',\n    'themes.telegram.org',\n    'promote.telegram.org',\n    'ads.telegram.org',\n  ],\n  channelLevelMax: 100,\n  boostsPerSentGift: 3,\n  channelRestrictAdsLevelMin: 50,\n  seenByExpiresAt: 604800,\n  seenByMaxChatMembers: 100,\n  defaultEmojiStatusesStickerSetId: '773947703670341676',\n  emojiSounds: {},\n  giveawayAddPeersMax: 10,\n  giveawayBoostsPerPremium: 4,\n  giveawayCountriesMax: 10,\n  isGiveawayGiftsPurchaseAvailable: false,\n  groupTranscribeLevelMin: 6,\n  hiddenMembersMinCount: 100,\n  ignoreRestrictionReasons: [],\n  canLimitNewMessagesWithoutPremium: false,\n  readDateExpiresAt: 604800,\n  premiumBotUsername: 'PremiumBot',\n  premiumPromoOrder: [\n    'stories',\n    'more_upload',\n    'double_limits',\n    // 'business',\n    'last_seen',\n    'voice_to_text',\n    'faster_download',\n    'translations',\n    'animated_emoji',\n    'emoji_status',\n    'saved_tags',\n    // 'peer_colors',\n    // 'wallpapers',\n    'profile_badge',\n    'message_privacy',\n    'advanced_chat_management',\n    'no_ads',\n    // 'app_icons',\n    'infinite_reactions',\n    'animated_userpics',\n    'premium_stickers',\n    'effects',\n  ],\n  isPremiumPurchaseBlocked: false,\n  maxUniqueReactions: 11,\n  starGiftMaxConvertPeriod: 7776000,\n  starGiftMaxMessageLength: 255,\n  starRefStartPrefixes: [\n    '_tgr_',\n  ],\n  isStarsGiftEnabled: true,\n  paidReactionMaxAmount: 2500,\n  starsUsdWithdrawRateX1000: 1300,\n  storyChangelogUserId: '777000',\n  maxPinnedStoriesCount: 3,\n  starsSuggestedPostAmountMax: 100000,\n  starsSuggestedPostAmountMin: 5,\n  starsSuggestedPostAgeMin: 86400,\n  starsSuggestedPostFutureMin: 300,\n  starsSuggestedPostFutureMax: 2678400,\n  starsSuggestedPostCommissionPermille: 850,\n  tonSuggestedPostCommissionPermille: 850,\n  todoItemLengthMax: 64,\n  todoItemsMax: 30,\n  todoTitleLengthMax: 32,\n  tonSuggestedPostAmountMax: 10000000000000,\n  tonSuggestedPostAmountMin: 10000000,\n  tonTopupUrl: 'https://fragment.com/ads/topup',\n  storyViewersExpirePeriod: 86400,\n  topicsPinnedLimit: 5,\n  bandwidthPremiumDownloadSpeedup: 10,\n  bandwidthPremiumNotifyPeriod: 3600,\n  bandwidthPremiumUploadSpeedup: 10,\n  urlAuthDomains: [\n    'web.telegram.org',\n    'web.t.me',\n    'k.t.me',\n    'z.t.me',\n    'a.t.me',\n  ],\n  whitelistedDomains: [\n    'telegram.dog',\n    'telegram.me',\n    'telegram.org',\n    't.me',\n    'telesco.pe',\n    'fragment.com',\n    'translations.telegram.org',\n  ],\n};\n","import type { ActionOptions } from '../lib/teact/teactn';\nimport { typify } from '../lib/teact/teactn';\n\nimport type {\n  ActionPayloads, GlobalState, RequiredActionPayloads, RequiredGlobalState,\n} from './types';\n\nconst typed = typify<GlobalState, ActionPayloads & RequiredActionPayloads>();\n\ntype ProjectActionTypes =\n  ActionPayloads\n  & RequiredActionPayloads;\n\ntype ProjectActionNames = keyof ProjectActionTypes;\n\ntype Helper<T, E> = Exclude<T, E> extends never ? unknown : Exclude<T, E>;\n\nexport type TabStateActionNames = {\n  [ActionName in ProjectActionNames]:\n  'tabId' extends keyof Helper<ProjectActionTypes[ActionName], undefined> ? ActionName : never\n}[ProjectActionNames];\n// `Required` actions are called from actions to ensure the `tabId` is always provided if needed.\n// There are three types of actions:\n// 1. With tabId, which is made required when calling action from another action handler\n// 2. Without payload (= undefined), hence made the payload not required\n// 3. With payload, hence made the payload required\nexport type RequiredGlobalActions = {\n  [ActionName in ProjectActionNames]: ActionName extends TabStateActionNames ? ((\n    payload: ProjectActionTypes[ActionName] & { tabId: number },\n    options?: ActionOptions,\n  ) => void) :\n    (undefined extends ProjectActionTypes[ActionName] ? (\n      (payload?: ProjectActionTypes[ActionName], options?: ActionOptions) => void\n    ) : (\n      (payload: ProjectActionTypes[ActionName], options?: ActionOptions) => void\n    ))\n} & { _: never };\n\ntype ActionHandlers = {\n  [ActionName in keyof ProjectActionTypes]: (\n    global: RequiredGlobalState,\n    actions: RequiredGlobalActions,\n    payload: ProjectActionTypes[ActionName],\n  ) => GlobalState | void | Promise<void>;\n};\n\nexport const getGlobal = typed.getGlobal;\nexport const setGlobal = typed.setGlobal;\nexport const getActions = typed.getActions;\nexport const getPromiseActions = typed.getPromiseActions;\nexport const addActionHandler = typed.addActionHandler as <ActionName extends ProjectActionNames>(\n  name: ActionName,\n  handler: ActionHandlers[ActionName],\n) => void;\nexport const execAfterActions = typed.execAfterActions;\nexport const withGlobal = typed.withGlobal;\nexport type GlobalActions = ReturnType<typeof getActions>;\n","export default function generateUniqueId() {\n  return Date.now().toString(36) + Math.random().toString(36).slice(2);\n}\n\nexport function generateUniqueNumberId() {\n  const timestamp = Date.now() % 100000000;\n  const random = Math.floor(Math.random() * 1000);\n  return timestamp + random;\n}\n","import type { OldLangFn } from '../hooks/useOldLang';\nimport type { LangFn } from './localization';\n\nimport EMOJI_REGEX from '../lib/twemojiRegex';\nimport fixNonStandardEmoji from './emoji/fixNonStandardEmoji';\nimport { floor } from './math';\nimport withCache from './withCache';\n\nexport function formatInteger(value: number) {\n  return String(value).replace(/\\d(?=(\\d{3})+$)/g, '$& ');\n}\n\nexport function formatIntegerCompact(lang: LangFn, views: number) {\n  if (views < 1e3) {\n    return lang.number(views);\n  }\n\n  if (views < 1e6) {\n    return `${lang.number(floor(views / 1e3, 1))}K`;\n  }\n\n  return `${lang.number(floor(views / 1e6, 1))}M`;\n}\n\nexport function formatPercent(value: number, fractionDigits = 1) {\n  return `${Number.isInteger(value) ? value : value.toFixed(fractionDigits)}%`;\n}\n\nexport const getFirstLetters = withCache((phrase: string, count = 2) => {\n  return phrase\n    .replace(/[.,!@#$%^&*()_+=\\-`~[\\]/\\\\{}:\"|<>?]+/gi, '')\n    .trim()\n    .split(/\\s+/)\n    .slice(0, count)\n    .map((word: string) => {\n      if (!word.length) return '';\n      word = fixNonStandardEmoji(word);\n      const emojis = word.match(EMOJI_REGEX);\n      if (emojis && word.startsWith(emojis[0])) {\n        return emojis[0];\n      }\n      return word.match(/./u)![0].toUpperCase();\n    })\n    .join('');\n});\n\nconst FILE_SIZE_UNITS = ['B', 'KB', 'MB', 'GB'];\nexport function formatFileSize(lang: OldLangFn, bytes: number, decimals = 1): string {\n  if (bytes === 0) {\n    return lang('FileSize.B', 0);\n  }\n\n  const k = 1024;\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  const value = (bytes / (k ** i)).toFixed(Math.max(decimals, 0));\n\n  return lang(`FileSize.${FILE_SIZE_UNITS[i]}`, value);\n}\n","import { IS_TAURI } from './browser/globalEnvironment';\nimport { createCallbackManager } from './callbacks';\nimport { ESTABLISH_BROADCAST_CHANNEL_NAME } from './multiaccount';\nimport { getPasscodeHash, setPasscodeHash } from './passcode';\n\nimport Deferred from './Deferred';\n\nconst ESTABLISH_TIMEOUT = 100;\n\nconst { addCallback, runCallbacks } = createCallbackManager();\nconst { addCallback: addCallbackTokenDied, runCallbacks: runCallbacksTokenDied } = createCallbackManager();\nconst token = Number(Math.random().toString().substring(2));\nconst collectedTokens = new Set([token]);\nconst channel = new BroadcastChannel(ESTABLISH_BROADCAST_CHANNEL_NAME);\n\nlet isEstablished = false;\nconst initialEstablishment = new Deferred();\nlet masterToken: number | undefined;\nlet isWaitingForMaster = false;\nlet reestablishToken: number | undefined;\nlet isChannelClosed = false;\n\ntype EstablishMessage = {\n  collectedTokens: Set<number>;\n  masterToken?: number;\n  tokenDied?: number;\n  currentPasscodeHash?: ArrayBuffer;\n  reestablishToken?: number;\n  shouldGiveUpMaster?: boolean;\n  hasGaveUpMaster?: boolean;\n};\n\nconst handleMessage = ({ data }: { data: EstablishMessage }) => {\n  if (!data) return;\n\n  if (data.currentPasscodeHash) {\n    setPasscodeHash(data.currentPasscodeHash);\n  }\n\n  if (data.hasGaveUpMaster && isWaitingForMaster) {\n    masterToken = token;\n    isWaitingForMaster = false;\n    initialEstablishment.resolve();\n    runCallbacks(true);\n    return;\n  }\n\n  if (data.shouldGiveUpMaster) {\n    if (masterToken === token) {\n      runCallbacks(false);\n      channel.postMessage({ currentPasscodeHash: getPasscodeHash(), hasGaveUpMaster: true });\n    }\n    masterToken = data.masterToken;\n    return;\n  }\n\n  if (data.tokenDied) {\n    runCallbacksTokenDied(data.tokenDied);\n    collectedTokens.delete(data.tokenDied);\n    if (data.tokenDied === masterToken) {\n      collectedTokens.delete(data.tokenDied);\n      masterToken = undefined;\n      isEstablished = false;\n      reestablishToken = data.tokenDied;\n\n      channel.postMessage({\n        collectedTokens,\n        masterToken,\n        reestablishToken,\n      });\n      if (collectedTokens.size === 1) {\n        isEstablished = true;\n        masterToken = token;\n        reestablishToken = undefined;\n        initialEstablishment.resolve();\n        runCallbacks(true);\n      }\n    }\n  }\n\n  if (data.collectedTokens) {\n    if (!data.reestablishToken && reestablishToken) {\n      return;\n    }\n    if (data.reestablishToken && reestablishToken !== data.reestablishToken) {\n      data.collectedTokens.delete(data.reestablishToken);\n\n      reestablishToken = data.reestablishToken;\n    }\n    const prevLength = collectedTokens.size;\n    data.collectedTokens.forEach((l) => collectedTokens.add(l));\n    if (reestablishToken) data.collectedTokens.delete(reestablishToken);\n\n    if (!isEstablished) {\n      if (data.masterToken) {\n        reestablishToken = undefined;\n        masterToken = data.masterToken;\n        runCallbacks(masterToken === token);\n\n        if (!isEstablished) {\n          channel.postMessage({\n            collectedTokens,\n            masterToken,\n            reestablishToken,\n          });\n        }\n        initialEstablishment.resolve();\n        isEstablished = true;\n      } else if (prevLength !== collectedTokens.size) {\n        channel.postMessage({\n          collectedTokens,\n          masterToken,\n          reestablishToken,\n        });\n      } else {\n        reestablishToken = undefined;\n        masterToken = Math.max(...Array.from(collectedTokens));\n        runCallbacks(masterToken === token);\n\n        if (!isEstablished) {\n          channel.postMessage({\n            collectedTokens,\n            masterToken,\n            reestablishToken,\n          });\n        }\n        initialEstablishment.resolve();\n        isEstablished = true;\n      }\n    } else if (!data.masterToken) {\n      channel.postMessage({\n        collectedTokens,\n        masterToken,\n        reestablishToken,\n      });\n    }\n  }\n};\n\nexport function establishMultitabRole(shouldReestablishMasterToSelf?: boolean) {\n  if (isChannelClosed) return;\n  channel.addEventListener('message', handleMessage);\n\n  channel.postMessage({ collectedTokens });\n\n  // To make the connection faster, we can ignore the waiting and connect right away,\n  // and then if we realize we're not master, drop the connection\n  setTimeout(() => {\n    if (masterToken === undefined) {\n      masterToken = token;\n      initialEstablishment.resolve();\n      runCallbacks(true);\n    } else if (shouldReestablishMasterToSelf) {\n      reestablishMasterToSelf();\n    }\n  }, ESTABLISH_TIMEOUT);\n\n  window.addEventListener('beforeunload', signalTokenDead);\n  if (IS_TAURI) window.addEventListener('unload', signalTokenDead);\n}\n\nexport function signalTokenDead() {\n  if (isChannelClosed) return;\n  runCallbacksTokenDied(token);\n  channel.removeEventListener('message', handleMessage);\n  channel.postMessage({ tokenDied: token, currentPasscodeHash: getPasscodeHash() });\n  channel.close();\n  isChannelClosed = true;\n}\n\nexport function signalPasscodeHash() {\n  channel.postMessage({ currentPasscodeHash: getPasscodeHash() });\n}\n\nexport function getCurrentTabId() {\n  return token;\n}\n\nexport function getAllMultitabTokens() {\n  return Array.from(collectedTokens);\n}\n\nexport function reestablishMasterToSelf() {\n  isWaitingForMaster = true;\n  channel.postMessage({\n    collectedTokens, masterToken: token, shouldGiveUpMaster: true,\n  });\n}\n\nexport const subscribeToTokenDied = addCallbackTokenDied;\nexport const subscribeToMasterChange = addCallback;\n\nexport const initialEstablishmentPromise = initialEstablishment.promise;\n\nexport function isCurrentTabMaster() {\n  return masterToken === token;\n}\n","import { useRef } from '../lib/teact/teact';\n\nimport generateUniqueId from '../util/generateUniqueId';\n\nexport default function useUniqueId() {\n  const idRef = useRef<string>();\n\n  if (!idRef.current) {\n    idRef.current = generateUniqueId();\n  }\n\n  return idRef.current;\n}\n","import { useEffect } from '../lib/teact/teact';\n\nfunction useEffectOnce(effect: React.EffectCallback) {\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  useEffect(effect, []);\n}\n\nexport default useEffectOnce;\n","// Copyright Twitter Inc. Licensed under MIT\n// https://github.com/twitter/twemoji-parser/blob/master/LICENSE.md\n// Emoji 16.0.0 support was taken here https://github.com/jdecked/twemoji-parser\n// Version ab019e0 14.04.2025\n\nconst vs16RegExp = /\\uFE0F/g;\n// avoid using a string literal like `\\u200D` here because minifiers expand it inline\nconst zeroWidthJoiner = String.fromCharCode(0x200d);\n\nexport function removeVS16s(rawEmoji) {\n  return rawEmoji.indexOf(zeroWidthJoiner) < 0 ? rawEmoji.replace(vs16RegExp, '') : rawEmoji;\n}\n\n// Default Twemoji regex was modified here.\n// An exception for ascii emoji has been added to the beginning of the regular string: .\n// UTF-16 endcoding are `\\ud83c\\udd70`, `\\ud83c\\udd71`, `\\ud83c\\udd7e` and `\\ud83c\\udd7f`.\n// These emojis in the graphic version must end with the `\\ufe0f` symbol.\n// Therefore, they should be excluded from the regular expression.\n// You must remove next substring `\\udd70\\udd71\\udd7e\\udd7f` from the middle of the regex on every update.\n\n// This file is generated by source/emoji/scripts/generate.sh\n// eslint-disable-next-line @stylistic/max-len\nexport default /(?:\\ud83c[\\udd70\\udd71\\udd7e\\udd7f]\\ufe0f)|(?:\\ud83d\\udc68\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83e\\uddd1\\ud83c[\\udffc-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83e\\uddd1\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83e\\uddd1\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83e\\uddd1\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83e\\uddd1\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udffe]|\\ud83d\\udc68\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffb\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffc-\\udfff]|\\ud83d\\udc68\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffc\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83d\\udc68\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffd\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83d\\udc68\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffe\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83d\\udc68\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udfff\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udffe]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffc-\\udfff]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc69\\ud83c[\\udffc-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc69\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc69\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udffe]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udffe]|\\ud83e\\uddd1\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83e\\uddd1\\ud83c[\\udffc-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffb\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83e\\uddd1\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffc\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83e\\uddd1\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83e\\uddd1\\ud83c\\udffd\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83e\\uddd1\\ud83c\\udffe\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udfff]|\\ud83e\\uddd1\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udffe]|\\ud83e\\uddd1\\ud83c\\udfff\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68|\\ud83d\\udc69\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d[\\udc68\\udc69]|\\ud83e\\udef1\\ud83c\\udffb\\u200d\\ud83e\\udef2\\ud83c[\\udffc-\\udfff]|\\ud83e\\udef1\\ud83c\\udffc\\u200d\\ud83e\\udef2\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83e\\udef1\\ud83c\\udffd\\u200d\\ud83e\\udef2\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83e\\udef1\\ud83c\\udffe\\u200d\\ud83e\\udef2\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83e\\udef1\\ud83c\\udfff\\u200d\\ud83e\\udef2\\ud83c[\\udffb-\\udffe]|\\ud83d\\udc68\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68|\\ud83d\\udc69\\u200d\\u2764\\ufe0f\\u200d\\ud83d[\\udc68\\udc69]|\\ud83e\\uddd1\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1|\\ud83d\\udc6b\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc6c\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc6d\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc8f\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc91\\ud83c[\\udffb-\\udfff]|\\ud83e\\udd1d\\ud83c[\\udffb-\\udfff]|\\ud83d[\\udc6b-\\udc6d\\udc8f\\udc91]|\\ud83e\\udd1d)|(?:\\ud83d[\\udc68\\udc69]|\\ud83e\\uddd1)(?:\\ud83c[\\udffb-\\udfff])?\\u200d(?:\\u2695\\ufe0f|\\u2696\\ufe0f|\\u2708\\ufe0f|\\ud83c[\\udf3e\\udf73\\udf7c\\udf84\\udf93\\udfa4\\udfa8\\udfeb\\udfed]|\\ud83d[\\udcbb\\udcbc\\udd27\\udd2c\\ude80\\ude92]|\\ud83e[\\uddaf-\\uddb3\\uddbc\\uddbd])(?:\\u200d\\u27a1\\ufe0f)?|(?:\\ud83c[\\udfcb\\udfcc]|\\ud83d[\\udd74\\udd75]|\\u26f9)((?:\\ud83c[\\udffb-\\udfff]|\\ufe0f)\\u200d[\\u2640\\u2642]\\ufe0f(?:\\u200d\\u27a1\\ufe0f)?)|(?:\\ud83c[\\udfc3\\udfc4\\udfca]|\\ud83d[\\udc6e\\udc70\\udc71\\udc73\\udc77\\udc81\\udc82\\udc86\\udc87\\ude45-\\ude47\\ude4b\\ude4d\\ude4e\\udea3\\udeb4-\\udeb6]|\\ud83e[\\udd26\\udd35\\udd37-\\udd39\\udd3d\\udd3e\\uddb8\\uddb9\\uddcd-\\uddcf\\uddd4\\uddd6-\\udddd])(?:\\ud83c[\\udffb-\\udfff])?\\u200d[\\u2640\\u2642]\\ufe0f(?:\\u200d\\u27a1\\ufe0f)?|(?:\\ud83d\\udc68\\u200d\\ud83d\\udc68\\u200d\\ud83d\\udc66\\u200d\\ud83d\\udc66|\\ud83d\\udc68\\u200d\\ud83d\\udc68\\u200d\\ud83d\\udc67\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc68\\u200d\\ud83d\\udc69\\u200d\\ud83d\\udc66\\u200d\\ud83d\\udc66|\\ud83d\\udc68\\u200d\\ud83d\\udc69\\u200d\\ud83d\\udc67\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc69\\u200d\\ud83d\\udc69\\u200d\\ud83d\\udc66\\u200d\\ud83d\\udc66|\\ud83d\\udc69\\u200d\\ud83d\\udc69\\u200d\\ud83d\\udc67\\u200d\\ud83d[\\udc66\\udc67]|\\ud83e\\uddd1\\u200d\\ud83e\\uddd1\\u200d\\ud83e\\uddd2\\u200d\\ud83e\\uddd2|\\ud83d\\udc68\\u200d\\ud83d\\udc66\\u200d\\ud83d\\udc66|\\ud83d\\udc68\\u200d\\ud83d\\udc67\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc68\\u200d\\ud83d\\udc68\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc68\\u200d\\ud83d\\udc69\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc69\\u200d\\ud83d\\udc66\\u200d\\ud83d\\udc66|\\ud83d\\udc69\\u200d\\ud83d\\udc67\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc69\\u200d\\ud83d\\udc69\\u200d\\ud83d[\\udc66\\udc67]|\\ud83e\\uddd1\\u200d\\ud83e\\uddd1\\u200d\\ud83e\\uddd2|\\ud83e\\uddd1\\u200d\\ud83e\\uddd2\\u200d\\ud83e\\uddd2|\\ud83c\\udff3\\ufe0f\\u200d\\u26a7\\ufe0f|\\ud83c\\udff3\\ufe0f\\u200d\\ud83c\\udf08|\\ud83d\\ude36\\u200d\\ud83c\\udf2b\\ufe0f|\\u26d3\\ufe0f\\u200d\\ud83d\\udca5|\\u2764\\ufe0f\\u200d\\ud83d\\udd25|\\u2764\\ufe0f\\u200d\\ud83e\\ude79|\\ud83c\\udf44\\u200d\\ud83d\\udfeb|\\ud83c\\udf4b\\u200d\\ud83d\\udfe9|\\ud83c\\udff4\\u200d\\u2620\\ufe0f|\\ud83d\\udc15\\u200d\\ud83e\\uddba|\\ud83d\\udc26\\u200d\\ud83d\\udd25|\\ud83d\\udc3b\\u200d\\u2744\\ufe0f|\\ud83d\\udc41\\u200d\\ud83d\\udde8|\\ud83d\\udc68\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc69\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc6f\\u200d\\u2640\\ufe0f|\\ud83d\\udc6f\\u200d\\u2642\\ufe0f|\\ud83d\\ude2e\\u200d\\ud83d\\udca8|\\ud83d\\ude35\\u200d\\ud83d\\udcab|\\ud83d\\ude42\\u200d\\u2194\\ufe0f|\\ud83d\\ude42\\u200d\\u2195\\ufe0f|\\ud83e\\udd3c\\u200d\\u2640\\ufe0f|\\ud83e\\udd3c\\u200d\\u2642\\ufe0f|\\ud83e\\uddd1\\u200d\\ud83e\\uddd2|\\ud83e\\uddde\\u200d\\u2640\\ufe0f|\\ud83e\\uddde\\u200d\\u2642\\ufe0f|\\ud83e\\udddf\\u200d\\u2640\\ufe0f|\\ud83e\\udddf\\u200d\\u2642\\ufe0f|\\ud83d\\udc08\\u200d\\u2b1b|\\ud83d\\udc26\\u200d\\u2b1b)|[#*0-9]\\ufe0f?\\u20e3|(?:[\\u2122\\u265f]\\ufe0f)|(?:\\ud83c[\\udc04\\ude02\\ude1a\\ude2f\\ude37\\udf21\\udf24-\\udf2c\\udf36\\udf7d\\udf96\\udf97\\udf99-\\udf9b\\udf9e\\udf9f\\udfcd\\udfce\\udfd4-\\udfdf\\udff3\\udff5\\udff7]|\\ud83d[\\udc3f\\udc41\\udcfd\\udd49\\udd4a\\udd6f\\udd70\\udd73\\udd76-\\udd79\\udd87\\udd8a-\\udd8d\\udda5\\udda8\\uddb1\\uddb2\\uddbc\\uddc2-\\uddc4\\uddd1-\\uddd3\\udddc-\\uddde\\udde1\\udde3\\udde8\\uddef\\uddf3\\uddfa\\udecb\\udecd-\\udecf\\udee0-\\udee5\\udee9\\udef0\\udef3]|[\\u203c\\u2049\\u2139\\u2194-\\u2199\\u21a9\\u21aa\\u231a\\u231b\\u2328\\u23cf\\u23ed-\\u23ef\\u23f1\\u23f2\\u23f8-\\u23fa\\u24c2\\u25aa\\u25ab\\u25b6\\u25c0\\u25fb-\\u25fe\\u2600-\\u2604\\u260e\\u2611\\u2614\\u2615\\u2618\\u2620\\u2622\\u2623\\u2626\\u262a\\u262e\\u262f\\u2638-\\u263a\\u2640\\u2642\\u2648-\\u2653\\u2660\\u2663\\u2665\\u2666\\u2668\\u267b\\u267f\\u2692-\\u2697\\u2699\\u269b\\u269c\\u26a0\\u26a1\\u26a7\\u26aa\\u26ab\\u26b0\\u26b1\\u26bd\\u26be\\u26c4\\u26c5\\u26c8\\u26cf\\u26d1\\u26d3\\u26d4\\u26e9\\u26ea\\u26f0-\\u26f5\\u26f8\\u26fa\\u26fd\\u2702\\u2708\\u2709\\u270f\\u2712\\u2714\\u2716\\u271d\\u2721\\u2733\\u2734\\u2744\\u2747\\u2757\\u2763\\u2764\\u27a1\\u2934\\u2935\\u2b05-\\u2b07\\u2b1b\\u2b1c\\u2b50\\u2b55\\u3030\\u303d\\u3297\\u3299])(?:\\ufe0f|(?!\\ufe0e))|(?:(?:\\ud83c[\\udfcb\\udfcc]|\\ud83d[\\udd74\\udd75\\udd90]|\\ud83e\\udef0|[\\u261d\\u26f7\\u26f9\\u270c\\u270d])(?:\\ufe0f|(?!\\ufe0e))|(?:\\ud83c\\udfc3|\\ud83d\\udeb6|\\ud83e\\uddce)(?:\\ud83c[\\udffb-\\udfff])?(?:\\u200d\\u27a1\\ufe0f)?|(?:\\ud83c[\\udf85\\udfc2\\udfc4\\udfc7\\udfca]|\\ud83d[\\udc42\\udc43\\udc46-\\udc50\\udc66-\\udc69\\udc6e\\udc70-\\udc78\\udc7c\\udc81-\\udc83\\udc85-\\udc87\\udcaa\\udd7a\\udd95\\udd96\\ude45-\\ude47\\ude4b-\\ude4f\\udea3\\udeb4\\udeb5\\udec0\\udecc]|\\ud83e[\\udd0c\\udd0f\\udd18-\\udd1c\\udd1e\\udd1f\\udd26\\udd30-\\udd39\\udd3d\\udd3e\\udd77\\uddb5\\uddb6\\uddb8\\uddb9\\uddbb\\uddcd\\uddcf\\uddd1-\\udddd\\udec3-\\udec5\\udef1-\\udef8]|[\\u270a\\u270b]))(?:\\ud83c[\\udffb-\\udfff])?|(?:\\ud83c\\udff4\\udb40\\udc67\\udb40\\udc62\\udb40\\udc65\\udb40\\udc6e\\udb40\\udc67\\udb40\\udc7f|\\ud83c\\udff4\\udb40\\udc67\\udb40\\udc62\\udb40\\udc73\\udb40\\udc63\\udb40\\udc74\\udb40\\udc7f|\\ud83c\\udff4\\udb40\\udc67\\udb40\\udc62\\udb40\\udc77\\udb40\\udc6c\\udb40\\udc73\\udb40\\udc7f|\\ud83c\\udde6\\ud83c[\\udde8-\\uddec\\uddee\\uddf1\\uddf2\\uddf4\\uddf6-\\uddfa\\uddfc\\uddfd\\uddff]|\\ud83c\\udde7\\ud83c[\\udde6\\udde7\\udde9-\\uddef\\uddf1-\\uddf4\\uddf6-\\uddf9\\uddfb\\uddfc\\uddfe\\uddff]|\\ud83c\\udde8\\ud83c[\\udde6\\udde8\\udde9\\uddeb-\\uddee\\uddf0-\\uddf7\\uddfa-\\uddff]|\\ud83c\\udde9\\ud83c[\\uddea\\uddec\\uddef\\uddf0\\uddf2\\uddf4\\uddff]|\\ud83c\\uddea\\ud83c[\\udde6\\udde8\\uddea\\uddec\\udded\\uddf7-\\uddfa]|\\ud83c\\uddeb\\ud83c[\\uddee-\\uddf0\\uddf2\\uddf4\\uddf7]|\\ud83c\\uddec\\ud83c[\\udde6\\udde7\\udde9-\\uddee\\uddf1-\\uddf3\\uddf5-\\uddfa\\uddfc\\uddfe]|\\ud83c\\udded\\ud83c[\\uddf0\\uddf2\\uddf3\\uddf7\\uddf9\\uddfa]|\\ud83c\\uddee\\ud83c[\\udde8-\\uddea\\uddf1-\\uddf4\\uddf6-\\uddf9]|\\ud83c\\uddef\\ud83c[\\uddea\\uddf2\\uddf4\\uddf5]|\\ud83c\\uddf0\\ud83c[\\uddea\\uddec-\\uddee\\uddf2\\uddf3\\uddf5\\uddf7\\uddfc\\uddfe\\uddff]|\\ud83c\\uddf1\\ud83c[\\udde6-\\udde8\\uddee\\uddf0\\uddf7-\\uddfb\\uddfe]|\\ud83c\\uddf2\\ud83c[\\udde6\\udde8-\\udded\\uddf0-\\uddff]|\\ud83c\\uddf3\\ud83c[\\udde6\\udde8\\uddea-\\uddec\\uddee\\uddf1\\uddf4\\uddf5\\uddf7\\uddfa\\uddff]|\\ud83c\\uddf4\\ud83c\\uddf2|\\ud83c\\uddf5\\ud83c[\\udde6\\uddea-\\udded\\uddf0-\\uddf3\\uddf7-\\uddf9\\uddfc\\uddfe]|\\ud83c\\uddf6\\ud83c\\udde6|\\ud83c\\uddf7\\ud83c[\\uddea\\uddf4\\uddf8\\uddfa\\uddfc]|\\ud83c\\uddf8\\ud83c[\\udde6-\\uddea\\uddec-\\uddf4\\uddf7-\\uddf9\\uddfb\\uddfd-\\uddff]|\\ud83c\\uddf9\\ud83c[\\udde6\\udde8\\udde9\\uddeb-\\udded\\uddef-\\uddf4\\uddf7\\uddf9\\uddfb\\uddfc\\uddff]|\\ud83c\\uddfa\\ud83c[\\udde6\\uddec\\uddf2\\uddf3\\uddf8\\uddfe\\uddff]|\\ud83c\\uddfb\\ud83c[\\udde6\\udde8\\uddea\\uddec\\uddee\\uddf3\\uddfa]|\\ud83c\\uddfc\\ud83c[\\uddeb\\uddf8]|\\ud83c\\uddfd\\ud83c\\uddf0|\\ud83c\\uddfe\\ud83c[\\uddea\\uddf9]|\\ud83c\\uddff\\ud83c[\\udde6\\uddf2\\uddfc]|\\ud83c[\\udccf\\udd8e\\udd91-\\udd9a\\udde6-\\uddff\\ude01\\ude32-\\ude36\\ude38-\\ude3a\\ude50\\ude51\\udf00-\\udf20\\udf2d-\\udf35\\udf37-\\udf7c\\udf7e-\\udf84\\udf86-\\udf93\\udfa0-\\udfc1\\udfc5\\udfc6\\udfc8\\udfc9\\udfcf-\\udfd3\\udfe0-\\udff0\\udff4\\udff8-\\udfff]|\\ud83d[\\udc00-\\udc3e\\udc40\\udc44\\udc45\\udc51-\\udc65\\udc6a\\udc6f\\udc79-\\udc7b\\udc7d-\\udc80\\udc84\\udc88-\\udc8e\\udc90\\udc92-\\udca9\\udcab-\\udcfc\\udcff-\\udd3d\\udd4b-\\udd4e\\udd50-\\udd67\\udda4\\uddfb-\\ude44\\ude48-\\ude4a\\ude80-\\udea2\\udea4-\\udeb3\\udeb7-\\udebf\\udec1-\\udec5\\uded0-\\uded2\\uded5-\\uded7\\udedc-\\udedf\\udeeb\\udeec\\udef4-\\udefc\\udfe0-\\udfeb\\udff0]|\\ud83e[\\udd0d\\udd0e\\udd10-\\udd17\\udd20-\\udd25\\udd27-\\udd2f\\udd3a\\udd3c\\udd3f-\\udd45\\udd47-\\udd76\\udd78-\\uddb4\\uddb7\\uddba\\uddbc-\\uddcc\\uddd0\\uddde-\\uddff\\ude70-\\ude7c\\ude80-\\ude89\\ude8f-\\udec2\\udec6\\udece-\\udedc\\udedf-\\udee9]|[\\u23e9-\\u23ec\\u23f0\\u23f3\\u267e\\u26ce\\u2705\\u2728\\u274c\\u274e\\u2753-\\u2755\\u2795-\\u2797\\u27b0\\u27bf\\ue50a])|\\ufe0f/g;\n","import type {\n  ApiChat, ApiChatFullInfo, ApiChatMember,\n} from '../../api/types';\nimport type { ChatListType } from '../../types';\nimport type { GlobalState } from '../types';\n\nimport { ARCHIVED_FOLDER_ID } from '../../config';\nimport { areDeepEqual } from '../../util/areDeepEqual';\nimport {\n  areSortedArraysEqual, buildCollectionByKey, omit, omitUndefined, pick, unique,\n} from '../../util/iteratees';\nimport { selectChatFullInfo } from '../selectors';\n\nconst DEFAULT_CHAT_LISTS: ChatListType[] = ['active', 'archived'];\n\nexport function replaceChatListIds<T extends GlobalState>(\n  global: T,\n  type: ChatListType,\n  newIds: string[] | undefined,\n): T {\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      listIds: {\n        ...global.chats.listIds,\n        [type]: newIds,\n      },\n    },\n  };\n}\n\nexport function replaceChatListLoadingParameters<T extends GlobalState>(\n  global: T, type: ChatListType, nextOffsetId?: number, nextOffsetPeerId?: string, nextOffsetDate?: number,\n): T {\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      loadingParameters: {\n        ...global.chats.loadingParameters,\n        [type]: {\n          nextOffsetId,\n          nextOffsetPeerId,\n          nextOffsetDate,\n        },\n      },\n    },\n  };\n}\n\nexport function updateChatLastMessageId<T extends GlobalState>(\n  global: T, chatId: string, lastMessageId: number, listType?: ChatListType,\n): T {\n  const key = listType === 'saved' ? 'saved' : 'all';\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      lastMessageIds: {\n        ...global.chats.lastMessageIds,\n        [key]: {\n          ...global.chats.lastMessageIds[key],\n          [chatId]: lastMessageId,\n        },\n      },\n    },\n  };\n}\n\nexport function updateChatsLastMessageId<T extends GlobalState>(\n  global: T, messageIds: Record<string, number>, listType?: ChatListType,\n): T {\n  const key = listType === 'saved' ? 'saved' : 'all';\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      lastMessageIds: {\n        ...global.chats.lastMessageIds,\n        [key]: {\n          ...global.chats.lastMessageIds[key],\n          ...messageIds,\n        },\n      },\n    },\n  };\n}\n\nexport function addChatListIds<T extends GlobalState>(\n  global: T, type: ChatListType, idsUpdate: string[],\n): T {\n  const { [type]: listIds } = global.chats.listIds;\n  const newIds = listIds?.length\n    ? idsUpdate.filter((id) => !listIds.includes(id))\n    : idsUpdate;\n\n  if (listIds && !newIds.length) {\n    return global;\n  }\n\n  return replaceChatListIds(global, type, [\n    ...(listIds || []),\n    ...newIds,\n  ]);\n}\n\nexport function replaceChats<T extends GlobalState>(global: T, newById: Record<string, ApiChat>): T {\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      byId: newById,\n    },\n  };\n}\n\nexport function addUnreadMentions<T extends GlobalState>(\n  global: T, chatId: string, chat: ApiChat, ids: number[], shouldUpdateCount: boolean = false,\n): T {\n  const prevChatUnreadMentions = (chat.unreadMentions || []);\n  const updatedUnreadMentions = unique([...prevChatUnreadMentions, ...ids]).sort((a, b) => b - a);\n  global = updateChat(global, chatId, {\n    unreadMentions: updatedUnreadMentions,\n  });\n\n  if (shouldUpdateCount) {\n    const updatedUnreadMentionsCount = (chat.unreadMentionsCount || 0)\n      + Math.max(0, updatedUnreadMentions.length - prevChatUnreadMentions.length);\n\n    global = updateChat(global, chatId, {\n      unreadMentionsCount: updatedUnreadMentionsCount,\n    });\n  }\n  return global;\n}\n\nexport function removeUnreadMentions<T extends GlobalState>(\n  global: T, chatId: string, chat: ApiChat, ids: number[], shouldUpdateCount: boolean = false,\n): T {\n  const prevChatUnreadMentions = (chat.unreadMentions || []);\n  const updatedUnreadMentions = prevChatUnreadMentions?.filter((id) => !ids.includes(id));\n\n  global = updateChat(global, chatId, {\n    unreadMentions: updatedUnreadMentions,\n  });\n\n  if (shouldUpdateCount && chat.unreadMentionsCount) {\n    const removedCount = prevChatUnreadMentions.length - updatedUnreadMentions.length;\n    const updatedUnreadMentionsCount = Math.max(chat.unreadMentionsCount - removedCount, 0) || undefined;\n\n    global = updateChat(global, chatId, {\n      unreadMentionsCount: updatedUnreadMentionsCount,\n    });\n  }\n  return global;\n}\n\nexport function updateChat<T extends GlobalState>(\n  global: T, chatId: string, chatUpdate: Partial<ApiChat>, noOmitUnreadReactionCount = false, withDeepCheck = false,\n): T {\n  const { byId } = global.chats;\n\n  const chat = byId[chatId];\n  if (withDeepCheck && chat) {\n    const updateKeys = Object.keys(chatUpdate) as (keyof ApiChat)[];\n    if (areDeepEqual(pick(chat, updateKeys), chatUpdate)) {\n      return global;\n    }\n  }\n\n  const updatedChat = getUpdatedChat(global, chatId, chatUpdate, noOmitUnreadReactionCount);\n  if (!updatedChat) {\n    return global;\n  }\n\n  return replaceChats(global, {\n    ...byId,\n    [chatId]: updatedChat,\n  });\n}\n\nexport function updateChatFullInfo<T extends GlobalState>(\n  global: T, chatId: string, fullInfoUpdate: Partial<ApiChatFullInfo>,\n): T {\n  const currentFullInfo = selectChatFullInfo(global, chatId);\n  const updatedFullInfo = {\n    ...currentFullInfo,\n    ...fullInfoUpdate,\n  };\n\n  if (areDeepEqual(currentFullInfo, updatedFullInfo)) {\n    return global;\n  }\n\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      fullInfoById: {\n        ...global.chats.fullInfoById,\n        [chatId]: updatedFullInfo,\n      },\n    },\n  };\n}\n\nexport function replaceChatFullInfo<T extends GlobalState>(global: T, chatId: string, fullInfo: ApiChatFullInfo): T {\n  const currentFullInfo = selectChatFullInfo(global, chatId);\n\n  if (areDeepEqual(currentFullInfo, fullInfo)) {\n    return global;\n  }\n\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      fullInfoById: {\n        ...global.chats.fullInfoById,\n        [chatId]: fullInfo,\n      },\n    },\n  };\n}\n\nexport function updateChats<T extends GlobalState>(global: T, newById: Record<string, ApiChat>): T {\n  const updatedById = Object.keys(newById).reduce((acc: Record<string, ApiChat>, id) => {\n    const updatedChat = getUpdatedChat(global, id, newById[id]);\n    if (updatedChat) {\n      acc[id] = updatedChat;\n    }\n\n    return acc;\n  }, {});\n\n  global = replaceChats(global, {\n    ...global.chats.byId,\n    ...updatedById,\n  });\n\n  return global;\n}\n\n// @optimization Allows to avoid redundant updates which cause a lot of renders\nexport function addChats<T extends GlobalState>(global: T, newById: Record<string, ApiChat>): T {\n  const { byId } = global.chats;\n  let isUpdated = false;\n\n  const addedById = Object.keys(newById).reduce<Record<string, ApiChat>>((acc, id) => {\n    const existingChat = byId[id];\n    const newChat = newById[id];\n\n    const membersCountChanged = !existingChat?.membersCount && newChat.membersCount;\n\n    if (existingChat && !existingChat.isMin && !membersCountChanged\n      && (newChat.isMin || existingChat.accessHash === newChat.accessHash)) {\n      return acc;\n    }\n\n    const updatedChat = getUpdatedChat(global, id, newChat);\n    if (updatedChat) {\n      acc[id] = updatedChat;\n      if (!isUpdated) {\n        isUpdated = true;\n      }\n    }\n\n    return acc;\n  }, {});\n\n  if (!isUpdated) {\n    return global;\n  }\n\n  global = replaceChats(global, {\n    ...byId,\n    ...addedById,\n  });\n\n  return global;\n}\n\n// @optimization Don't spread/unspread global for each element, do it in a batch\nfunction getUpdatedChat<T extends GlobalState>(\n  global: T, chatId: string, chatUpdate: Partial<ApiChat>,\n  noOmitUnreadReactionCount = false,\n) {\n  const { byId } = global.chats;\n  const chat = byId[chatId];\n  const omitProps: (keyof ApiChat)[] = [];\n\n  if (chatUpdate.isMin && chat && !chat.isMin) {\n    return undefined; // Do not apply updates from min constructor\n  }\n\n  if (!noOmitUnreadReactionCount) {\n    omitProps.push('unreadReactionsCount');\n  }\n\n  if (areDeepEqual(chat?.usernames, chatUpdate.usernames)) {\n    omitProps.push('usernames');\n  }\n\n  const updatedChat: ApiChat = {\n    ...chat,\n    ...omit(chatUpdate, omitProps),\n  } as ApiChat;\n\n  if (!updatedChat.id || !updatedChat.type) {\n    return undefined;\n  }\n\n  return omitUndefined(updatedChat);\n}\n\nexport function updateChatListType<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  folderId?: number,\n): T {\n  const listType = folderId === ARCHIVED_FOLDER_ID ? 'archived' : 'active';\n\n  let currentListIds = global.chats.listIds;\n  (Object.keys(currentListIds) as Array<keyof typeof currentListIds>).forEach((listTypeKey) => {\n    const currentFolderList = currentListIds[listTypeKey] || [];\n    if (listTypeKey === listType && !currentFolderList.includes(chatId)) {\n      currentListIds = {\n        ...currentListIds,\n        [listTypeKey]: [...currentFolderList, chatId],\n      };\n    } else if (listTypeKey !== listType && currentFolderList.includes(chatId)) {\n      currentListIds = {\n        ...currentListIds,\n        [listTypeKey]: currentFolderList.filter((id) => id !== chatId),\n      };\n    }\n  });\n\n  global = {\n    ...global,\n    chats: {\n      ...global.chats,\n      listIds: currentListIds,\n    },\n  };\n\n  global = updateChat(global, chatId, { folderId: folderId || undefined });\n\n  return global;\n}\n\nexport function updateChatListSecondaryInfo<T extends GlobalState>(\n  global: T,\n  type: ChatListType,\n  info: {\n    orderedPinnedIds?: string[];\n    totalChatCount: number;\n  },\n): T {\n  const totalCountKey = type === 'active' ? 'all' : type;\n\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      ...(info.orderedPinnedIds && {\n        orderedPinnedIds: {\n          ...global.chats.orderedPinnedIds,\n          [type]: info.orderedPinnedIds,\n        },\n      }),\n      totalCount: {\n        ...global.chats.totalCount,\n        [totalCountKey]: info.totalChatCount,\n      },\n    },\n  };\n}\n\nexport function leaveChat<T extends GlobalState>(global: T, leftChatId: string): T {\n  global = removeChatFromChatLists(global, leftChatId);\n\n  global = updateChat(global, leftChatId, { isNotJoined: true });\n  global = updateChatFullInfo(global, leftChatId, { joinInfo: undefined });\n\n  return global;\n}\n\nexport function removeChatFromChatLists<T extends GlobalState>(\n  global: T, chatId: string, type: 'all' | 'saved' = 'all',\n): T {\n  const chatLists = type === 'all' ? DEFAULT_CHAT_LISTS : [type];\n  chatLists.forEach((listType) => {\n    global = replaceChatListIds(global, listType, global.chats.listIds[listType]?.filter((id) => id !== chatId));\n  });\n\n  return global;\n}\n\nexport function addChatMembers<T extends GlobalState>(global: T, chat: ApiChat, membersToAdd: ApiChatMember[]): T {\n  const currentMembers = selectChatFullInfo(global, chat.id)?.members;\n  const newMemberIds = new Set(membersToAdd.map((m) => m.userId));\n  const updatedMembers = [\n    ...currentMembers?.filter(({ userId }) => !newMemberIds.has(userId)) || [],\n    ...membersToAdd,\n  ];\n  const currentIds = currentMembers?.map(({ userId }) => userId) || [];\n  const updatedIds = updatedMembers.map(({ userId }) => userId);\n\n  if (areSortedArraysEqual(currentIds, updatedIds)) {\n    return global;\n  }\n\n  const adminMembers = updatedMembers.filter(({ isAdmin, isOwner }) => isAdmin || isOwner);\n\n  return updateChatFullInfo(global, chat.id, {\n    members: updatedMembers,\n    adminMembersById: buildCollectionByKey(adminMembers, 'userId'),\n  });\n}\n\nexport function replaceSimilarChannels<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  similarChannelIds: string[],\n  count?: number,\n) {\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      similarChannelsById: {\n        ...global.chats.similarChannelsById,\n        [chatId]: {\n          similarChannelIds,\n          count: count || similarChannelIds.length,\n        },\n      },\n    },\n  };\n}\n\nexport function toggleSimilarChannels<T extends GlobalState>(\n  global: T,\n  chatId: string,\n) {\n  const similarChannels = global.chats.similarChannelsById[chatId];\n\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      similarChannelsById: {\n        ...global.chats.similarChannelsById,\n        [chatId]: {\n          ...similarChannels,\n          isExpanded: !similarChannels?.isExpanded,\n        },\n      },\n    },\n  };\n}\n\nexport function addSimilarBots<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  similarBotsIds: string[],\n  count?: number,\n) {\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      similarBotsById: {\n        ...global.chats.similarBotsById,\n        [chatId]: {\n          similarBotsIds,\n          count,\n        },\n      },\n    },\n  };\n}\n","export default function getOffsetToContainer(element: HTMLElement, container: HTMLElement) {\n  let offsetTop = 0;\n  let offsetLeft = 0;\n\n  let current: HTMLElement | null = element;\n\n  while (current && current !== container && !current.contains(container)) {\n    offsetTop += current.offsetTop;\n    offsetLeft += current.offsetLeft;\n\n    current = current.offsetParent as HTMLElement | null;\n  }\n\n  offsetTop -= container.clientTop;\n  offsetLeft -= container.clientLeft;\n\n  return { top: offsetTop, left: offsetLeft };\n}\n","import { useCallback, useMemo } from '../lib/teact/teact';\n\nimport { debounce } from '../util/schedulers';\n\nexport default function useDebouncedCallback<T extends AnyToVoidFunction>(\n  fn: T,\n  deps: any[],\n  ms: number,\n  noFirst = false,\n  noLast = false,\n) {\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  const fnMemo = useCallback(fn, deps);\n\n  return useMemo(() => {\n    return debounce(fnMemo, ms, !noFirst, !noLast);\n  }, [fnMemo, ms, noFirst, noLast]);\n}\n","import { type TeactNode } from '../lib/teact/teact';\n\nimport type { LangFn } from './localization';\n\nimport { STARS_CURRENCY_CODE, TON_CURRENCY_CODE } from '../config';\nimport { formatStarsAsIcon, formatTonAsIcon } from './localization/format';\n\nexport function convertCurrencyFromBaseUnit(amount: number, currency: string) {\n  return amount / 10 ** getCurrencyExp(currency);\n}\n\nexport function convertCurrencyToBaseUnit(amount: number, currency: string) {\n  return amount * 10 ** getCurrencyExp(currency);\n}\n\nexport function convertTonFromNanos(nanos: number): number {\n  return convertCurrencyFromBaseUnit(nanos, TON_CURRENCY_CODE);\n}\n\nexport function convertTonToNanos(ton: number): number {\n  return convertCurrencyToBaseUnit(ton, TON_CURRENCY_CODE);\n}\n\nexport function formatCurrency(\n  lang: LangFn,\n  totalPrice: number,\n  currency: string,\n  options?: {\n    shouldOmitFractions?: boolean;\n    iconClassName?: string;\n    asFontIcon?: boolean;\n  },\n): TeactNode {\n  const price = convertCurrencyFromBaseUnit(totalPrice, currency);\n\n  if (currency === STARS_CURRENCY_CODE) {\n    return formatStarsAsIcon(lang, price, { asFont: options?.asFontIcon, className: options?.iconClassName });\n  }\n\n  if (currency === TON_CURRENCY_CODE) {\n    return formatTonAsIcon(lang, price, { className: options?.iconClassName });\n  }\n\n  return formatCurrencyAsString(totalPrice, currency, lang.code, options);\n}\n\nexport function convertTonToUsd(amount: number, usdRate: number, isInNanos: boolean = false): number {\n  const tonInRegularUnits = isInNanos ? convertTonFromNanos(amount) : amount;\n  return tonInRegularUnits * usdRate * 100;\n}\n\nexport function formatCurrencyAsString(\n  totalPrice: number,\n  currency: string,\n  locale: string = 'en',\n  options?: {\n    shouldOmitFractions?: boolean;\n  },\n) {\n  const price = convertCurrencyFromBaseUnit(totalPrice, currency);\n\n  if ((options?.shouldOmitFractions || currency === STARS_CURRENCY_CODE) && Number.isInteger(price)) {\n    return new Intl.NumberFormat(locale, {\n      style: 'currency',\n      currency,\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 0,\n    }).format(price);\n  }\n\n  if (currency === TON_CURRENCY_CODE) {\n    return new Intl.NumberFormat(locale, {\n      style: 'currency',\n      currency,\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 10,\n    }).format(price);\n  }\n\n  return new Intl.NumberFormat(locale, {\n    style: 'currency',\n    currency,\n  }).format(price);\n}\n\nfunction getCurrencyExp(currency: string) {\n  if (currency === TON_CURRENCY_CODE) {\n    return 9;\n  }\n  if (currency === 'CLF') {\n    return 4;\n  }\n  if (['BHD', 'IQD', 'JOD', 'KWD', 'LYD', 'OMR', 'TND'].includes(currency)) {\n    return 3;\n  }\n  if ([\n    'BIF', 'BYR', 'CLP', 'CVE', 'DJF', 'GNF', 'ISK', 'JPY', 'KMF', 'KRW', 'MGA', 'PYG', 'RWF', 'UGX', 'UYI',\n    'VND', 'VUV', 'XAF', 'XOF', 'XPF', STARS_CURRENCY_CODE,\n  ].includes(currency)) {\n    return 0;\n  }\n  if (currency === 'MRO') {\n    return 1;\n  }\n  return 2;\n}\n","import EMOJI_REGEX from '../../lib/twemojiRegex';\nimport fixNonStandardEmoji from './fixNonStandardEmoji';\n\nconst DETECT_UP_TO = 100;\nconst MAX_LENGTH = DETECT_UP_TO * 8; // Maximum 8 code points per one emoji.\n\nexport default function parseEmojiOnlyString(text: string): number | false {\n  const standardizedText = fixNonStandardEmoji(text);\n  const lines = standardizedText.split('\\n');\n  const textWithoutNewlines = lines.join('');\n  if (textWithoutNewlines.length > MAX_LENGTH) {\n    return false;\n  }\n\n  const totalCount = countIfEmojiOnly(textWithoutNewlines);\n  if (!totalCount || totalCount > DETECT_UP_TO) {\n    return false;\n  }\n\n  // Calculate max emoji count per column or line. Used in UI to determine the size of the emoji.\n  let max = lines.length;\n  for (const line of lines) {\n    const count = countIfEmojiOnly(line);\n    if (count === false) {\n      return false;\n    }\n    if (count > max) {\n      max = count;\n    }\n  }\n\n  return max;\n}\n\nfunction countIfEmojiOnly(line: string): false | number {\n  const iterator = line.matchAll(EMOJI_REGEX);\n  let count = 0;\n  let currentIndex = 0;\n\n  for (const match of iterator) {\n    if (match.index !== currentIndex) {\n      return false;\n    }\n\n    count++;\n    currentIndex = match.index + match[0].length;\n  }\n\n  if (currentIndex !== line.length) {\n    return false;\n  }\n\n  return count;\n}\n","import type { OldLangFn } from '../../hooks/useOldLang';\nimport type { TimeFormat } from '../../types';\nimport type { LangFn } from '../localization';\n\nimport { getServerTime } from '../serverTime';\nimport withCache from '../withCache';\nimport { getDays, getHours, getMinutes } from './units';\n\nconst WEEKDAYS_FULL = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\nconst MONTHS_FULL = [\n  'January', 'February', 'March', 'April', 'May', 'June',\n  'July', 'August', 'September', 'October', 'November', 'December',\n];\n\nconst MONTHS_FULL_LOWERCASE = MONTHS_FULL.map((month) => month.toLowerCase());\nconst MIN_SEARCH_YEAR = 2015;\nconst MAX_DAY_IN_MONTH = 31;\nconst MAX_MONTH_IN_YEAR = 12;\nexport const MILLISECONDS_IN_DAY = 24 * 60 * 60 * 1000;\n\nexport function isToday(date: Date) {\n  return getDayStartAt(new Date()) === getDayStartAt(date);\n}\n\nexport function getDayStart(datetime: number | Date) {\n  const date = new Date(datetime);\n  date.setHours(0, 0, 0, 0);\n  return date;\n}\n\nexport function getDayStartAt(datetime: number | Date) {\n  return getDayStart(datetime).getTime();\n}\n\nexport function toYearMonth(timestamp: number) {\n  const date = new Date(timestamp * 1000);\n  return `${date.getFullYear()}-${date.getMonth()}`;\n}\n\nfunction toIsoString(date: Date) {\n  return `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;\n}\n\n// @optimization `toLocaleTimeString` is avoided because of bad performance\nexport function formatTime(lang: OldLangFn, datetime: number | Date) {\n  const date = typeof datetime === 'number' ? new Date(datetime) : datetime;\n  const timeFormat = lang.timeFormat || '24h';\n\n  let hours = date.getHours();\n  let marker = '';\n  if (timeFormat === '12h') {\n    marker = hours >= 12 ? '\\xa0PM' : '\\xa0AM'; // NBSP\n    hours = hours > 12 ? hours % 12 : hours;\n  }\n\n  return `${String(hours).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}${marker}`;\n}\n\nexport function formatPastTimeShort(lang: OldLangFn, datetime: number | Date, alwaysShowTime = false) {\n  const date = typeof datetime === 'number' ? new Date(datetime) : datetime;\n\n  const time = formatTime(lang, date);\n\n  const today = getDayStart(new Date());\n  if (date >= today) {\n    return time;\n  }\n\n  const weekAgo = new Date(today);\n  weekAgo.setDate(today.getDate() - 7);\n  if (date >= weekAgo) {\n    const weekday = lang(`Weekday.Short${WEEKDAYS_FULL[date.getDay()]}`);\n    return alwaysShowTime ? lang('FullDateTimeFormat', [weekday, time]) : weekday;\n  }\n\n  const noYear = date.getFullYear() === today.getFullYear();\n\n  const formattedDate = formatDateToString(date, lang.code, noYear);\n  return alwaysShowTime ? lang('FullDateTimeFormat', [formattedDate, time]) : formattedDate;\n}\n\nexport function formatFullDate(lang: OldLangFn | LangFn, datetime: number | Date) {\n  return formatDateToString(datetime, lang.code, false, 'numeric');\n}\n\nexport function formatMonthAndYear(lang: OldLangFn | LangFn, date: Date, isShort = false) {\n  return formatDateToString(date, lang.code, false, isShort ? 'short' : 'long', true);\n}\n\nexport function formatCountdown(\n  lang: LangFn,\n  secondsLeft: number,\n) {\n  const days = getDays(secondsLeft);\n  if (secondsLeft < 0) {\n    return 0;\n  } else if (days < 1) {\n    return formatMediaDuration(secondsLeft);\n  } else if (days < 7) {\n    const count = days;\n    return lang('Days', { count }, { pluralValue: count });\n  } else if (days < 30) {\n    const count = Math.floor(days / 7);\n    return lang('Weeks', { count }, { pluralValue: count });\n  } else if (days < 365) {\n    const count = Math.floor(days / 30);\n    return lang('Months', { count }, { pluralValue: count });\n  } else {\n    const count = Math.floor(days / 365);\n    return lang('Years', { count }, { pluralValue: count });\n  }\n}\n\nexport function formatCountdownShort(lang: OldLangFn, msLeft: number): string {\n  if (msLeft < 60 * 1000) {\n    return Math.ceil(msLeft / 1000).toString();\n  } else if (msLeft < 60 * 60 * 1000) {\n    return Math.ceil(msLeft / (60 * 1000)).toString();\n  } else if (msLeft < MILLISECONDS_IN_DAY) {\n    return lang('MessageTimer.ShortHours', Math.ceil(msLeft / (60 * 60 * 1000)));\n  } else {\n    return lang('MessageTimer.ShortDays', Math.ceil(msLeft / MILLISECONDS_IN_DAY));\n  }\n}\n\nexport function formatLocationLastUpdate(lang: OldLangFn, currentTime: number, lastUpdated = currentTime) {\n  const seconds = currentTime - lastUpdated;\n  if (seconds < 60) {\n    return lang('LiveLocationUpdated.JustNow');\n  } else if (seconds < 60 * 60) {\n    return lang('LiveLocationUpdated.MinutesAgo', Math.floor(seconds / 60));\n  } else {\n    return lang('LiveLocationUpdated.TodayAt', formatTime(lang, lastUpdated));\n  }\n}\n\nexport function formatRelativePastTime(lang: OldLangFn, currentTime: number, lastUpdated = currentTime) {\n  const seconds = currentTime - lastUpdated;\n\n  if (seconds < 60) {\n    return lang('Time.JustNow');\n  }\n\n  // within an hour\n  if (seconds < 60 * 60) {\n    return lang('Time.MinutesAgo', Math.floor(seconds / 60));\n  }\n\n  const lastUpdatedDate = new Date(lastUpdated * 1000);\n  const today = getDayStart(new Date());\n  if (lastUpdatedDate >= today) {\n    return lang('Time.TodayAt', formatTime(lang, lastUpdatedDate));\n  }\n\n  const yesterday = new Date(today);\n  yesterday.setDate(today.getDate() - 1);\n  if (lastUpdatedDate > yesterday) {\n    return lang('Time.YesterdayAt', formatTime(lang, lastUpdatedDate));\n  }\n\n  return lang('Time.AtDate', formatFullDate(lang, lastUpdatedDate));\n}\n\nexport function formatPastDatetime(lang: LangFn, pastTime: number, currentTime = getServerTime()) {\n  const seconds = currentTime - pastTime;\n  const minutes = getMinutes(seconds);\n  const hours = getHours(seconds);\n  const days = getDays(seconds);\n\n  if (seconds < 60) {\n    return lang('JustNowAgo');\n  }\n\n  if (minutes < 60) {\n    return lang('MinutesAgo', { count: minutes }, { pluralValue: minutes });\n  }\n\n  if (hours < 24) {\n    return lang('HoursAgo', { count: hours }, { pluralValue: hours });\n  }\n\n  if (days < 28) {\n    return lang('DaysAgo', { count: days }, { pluralValue: days });\n  }\n\n  return lang('AtDateAgo', { date: formatFullDate(lang, pastTime) });\n}\n\ntype DurationType = 'Seconds' | 'Minutes' | 'Hours' | 'Days' | 'Weeks';\n\nexport function formatTimeDuration(lang: OldLangFn, duration: number, showLast = 2) {\n  if (!duration) {\n    return undefined;\n  }\n\n  const durationRecords: { duration: number; type: DurationType }[] = [];\n  const labels = [\n    { multiplier: 1, type: 'Seconds' },\n    { multiplier: 60, type: 'Minutes' },\n    { multiplier: 60, type: 'Hours' },\n    { multiplier: 24, type: 'Days' },\n    { multiplier: 7, type: 'Weeks' },\n  ] as Array<{ multiplier: number; type: DurationType }>;\n  let t = 1;\n  labels.forEach((label, idx) => {\n    t *= label.multiplier;\n\n    if (duration < t) {\n      return;\n    }\n\n    const modulus = labels[idx === (labels.length - 1) ? idx : idx + 1].multiplier;\n    durationRecords.push({\n      duration: Math.floor((duration / t) % modulus),\n      type: label.type,\n    });\n  });\n\n  const out = durationRecords.slice(-showLast).reverse();\n  for (let i = out.length - 1; i >= 0; --i) {\n    if (out[i].duration === 0) {\n      out.splice(i, 1);\n    }\n  }\n\n  // TODO In arabic we don't use \",\" as delimiter rather we use \"and\" each time\n  return out.map((part) => lang(part.type, part.duration, 'i')).join(', ');\n}\n\nexport function formatScheduledDateTime(\n  scheduleDateTimestamp: number,\n  lang: LangFn,\n  oldLang: OldLangFn,\n): string {\n  const scheduleDate = new Date(scheduleDateTimestamp * 1000);\n\n  return lang('FormatDateAtTime', {\n    date: isToday(scheduleDate)\n      ? lang('WeekdayToday')\n      : formatHumanDate(oldLang, scheduleDateTimestamp * 1000, true, false, true),\n    time: formatTime(oldLang, scheduleDateTimestamp * 1000),\n  });\n}\n\nexport function formatHumanDate(\n  lang: OldLangFn,\n  datetime: number | Date,\n  isShort = false,\n  noWeekdays = false,\n  isUpperFirst?: boolean,\n) {\n  const date = typeof datetime === 'number' ? new Date(datetime) : datetime;\n\n  const today = getDayStart(new Date());\n\n  if (!noWeekdays) {\n    if (toIsoString(date) === toIsoString(today)) {\n      return (isUpperFirst || !isShort ? upperFirst : lowerFirst)(lang('Weekday.Today'));\n    }\n\n    const yesterday = new Date(today);\n    yesterday.setDate(today.getDate() - 1);\n    if (toIsoString(date) === toIsoString(yesterday)) {\n      return (isUpperFirst || !isShort ? upperFirst : lowerFirst)(lang('Weekday.Yesterday'));\n    }\n\n    const limitBefore = new Date(today);\n    limitBefore.setDate(today.getDate() - 6); // Avoid returning same weekday as today\n    const limitAhead = new Date(today);\n    limitAhead.setDate(today.getDate() + 6);\n\n    if (date >= limitBefore && date <= limitAhead) {\n      const weekDayString = formatWeekday(lang, date.getDay(), isShort);\n      return (isUpperFirst || !isShort ? upperFirst : lowerFirst)(weekDayString);\n    }\n  }\n\n  const noYear = date.getFullYear() === today.getFullYear();\n  const formattedDate = formatDateToString(date, lang.code, noYear, isShort ? 'short' : 'long');\n\n  return (isUpperFirst || !isShort ? upperFirst : lowerFirst)(formattedDate);\n}\n\n/**\n * Returns weekday name\n * @param day 0 - Sunday, 1 - Monday, ...\n */\nexport function formatWeekday(lang: OldLangFn, day: number, isShort = false) {\n  const weekDay = WEEKDAYS_FULL[day];\n  return isShort ? lang(`Weekday.Short${weekDay}`) : lang(`Weekday.${weekDay}`);\n}\n\nexport function formatMediaDateTime(\n  lang: OldLangFn,\n  datetime: number | Date,\n  isUpperFirst?: boolean,\n) {\n  const date = typeof datetime === 'number' ? new Date(datetime) : datetime;\n\n  return `${formatHumanDate(lang, date, true, undefined, isUpperFirst)}, ${formatTime(lang, date)}`;\n}\n\nexport function formatMediaDuration(duration: number, maxValue?: number) {\n  const hours = Math.floor(duration / 3600);\n  const minutes = Math.floor((duration % 3600) / 60);\n  const seconds = Math.floor(duration % 3600 % 60);\n\n  const maxHours = maxValue ? Math.floor(maxValue / 3600) : 0;\n  const maxMinutes = maxValue ? Math.floor((maxValue % 3600) / 60) : 0;\n  let string = '';\n  if (hours > 0 || maxHours > 0) {\n    string += `${String(hours).padStart(2, '0')}:`;\n    string += `${String(minutes).padStart(2, '0')}:`;\n  } else if (maxMinutes >= 10) {\n    string += `${String(minutes).padStart(2, '0')}:`;\n  } else {\n    string += `${String(minutes)}:`;\n  }\n  string += String(seconds).padStart(2, '0');\n\n  return string;\n}\n\nexport function formatVoiceRecordDuration(durationInMs: number) {\n  const parts = [];\n\n  let milliseconds = durationInMs % 1000;\n  durationInMs -= milliseconds;\n  milliseconds = Math.floor(milliseconds / 10);\n\n  durationInMs = Math.floor(durationInMs / 1000);\n  const seconds = durationInMs % 60;\n  durationInMs -= seconds;\n\n  durationInMs = Math.floor(durationInMs / 60);\n  const minutes = durationInMs % 60;\n  durationInMs -= minutes;\n\n  durationInMs = Math.floor(durationInMs / 60);\n  const hours = durationInMs % 60;\n\n  if (hours > 0) {\n    parts.push(String(hours).padStart(2, '0'));\n  }\n  parts.push(String(minutes).padStart(hours > 0 ? 2 : 1, '0'));\n  parts.push(String(seconds).padStart(2, '0'));\n\n  return `${parts.join(':')},${String(milliseconds).padStart(2, '0')}`;\n}\n\nconst formatDayToStringWithCache = withCache((\n  dayStartAt: number,\n  locale: string,\n  noYear?: boolean,\n  monthFormat: 'short' | 'long' | 'numeric' = 'short',\n  noDay?: boolean,\n) => {\n  return new Date(dayStartAt).toLocaleString(\n    locale,\n    {\n      year: noYear ? undefined : 'numeric',\n      month: monthFormat,\n      day: noDay ? undefined : 'numeric',\n    },\n  );\n});\n\nexport function formatDateToString(\n  datetime: Date | number,\n  locale = 'en-US',\n  noYear = false,\n  monthFormat: 'short' | 'long' | 'numeric' = 'short',\n  noDay = false,\n) {\n  const date = typeof datetime === 'number' ? new Date(datetime) : datetime;\n  const dayStartAt = getDayStartAt(date);\n\n  return formatDayToStringWithCache(dayStartAt, locale, noYear, monthFormat, noDay);\n}\n\nexport function formatDateTimeToString(\n  datetime: Date | number, locale = 'en-US', noSeconds?: boolean,\n  timeFormat?: TimeFormat,\n) {\n  const date = typeof datetime === 'number' ? new Date(datetime) : datetime;\n  return date.toLocaleString(\n    locale,\n    {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric',\n      hour: 'numeric',\n      minute: 'numeric',\n      second: noSeconds ? undefined : 'numeric',\n      hourCycle: timeFormat === '12h' ? 'h12' : 'h23',\n    },\n  );\n}\n\nexport function formatDateAtTime(\n  lang: OldLangFn,\n  datetime: number | Date,\n) {\n  const date = typeof datetime === 'number' ? new Date(datetime) : datetime;\n\n  const today = getDayStart(new Date());\n  const time = formatTime(lang, date);\n\n  if (toIsoString(date) === toIsoString(today)) {\n    return lang('Time.TodayAt', time);\n  }\n\n  const yesterday = new Date(today);\n  yesterday.setDate(today.getDate() - 1);\n  if (toIsoString(date) === toIsoString(yesterday)) {\n    return lang('Time.YesterdayAt', time);\n  }\n\n  const noYear = date.getFullYear() === today.getFullYear();\n  const formattedDate = formatDateToString(date, lang.code, noYear);\n\n  return lang('formatDateAtTime', [formattedDate, time]);\n}\n\nexport function formatShortDuration(lang: LangFn, duration: number, hoursPriority?: boolean) {\n  if (duration < 0) {\n    return lang('RightNow');\n  }\n\n  if (duration < 60) {\n    const count = Math.ceil(duration);\n    return lang('Seconds', { count }, { pluralValue: duration });\n  }\n\n  if (duration < 60 * 60) {\n    const count = Math.ceil(duration / 60);\n    return lang('Minutes', { count }, { pluralValue: count });\n  }\n\n  if (duration < 60 * 60 * 24 || (hoursPriority && duration <= 60 * 60 * 24 * 2)) {\n    const count = Math.ceil(duration / (60 * 60));\n    return lang('Hours', { count }, { pluralValue: count });\n  }\n\n  const count = Math.ceil(duration / (60 * 60 * 24));\n  return lang('Days', { count }, { pluralValue: count });\n}\n\nfunction isValidDate(day: number, month: number, year = 2021): boolean {\n  if (month > (MAX_MONTH_IN_YEAR - 1) || day > MAX_DAY_IN_MONTH) {\n    return false;\n  }\n  const date = new Date(year, month, day);\n  return !Number.isNaN(date.getTime()) && date.getDate() === day;\n}\n\nexport function parseDateString(query = ''): string | undefined {\n  const matchStringDate = query.match(/\\d{1,2}\\s[a-zA-Z]{3,}/);\n  const matchEuropeStringDate = query.match(/[a-zA-Z]{3,}\\s\\d{1,2}/);\n  const matchNumberDate = query.match(/\\d{1,2}[./-]\\d{1,2}([./-]\\d{2,4})?/);\n  if (!matchStringDate && !matchNumberDate && !matchEuropeStringDate) {\n    return undefined;\n  }\n\n  if (matchNumberDate) {\n    const [date, month, year] = query.split(/[./-]/).map(Number);\n    return !(year && year < MIN_SEARCH_YEAR) && isValidDate(date, month - 1, year || undefined)\n      ? `${year ? `${year}-` : ''}${String(month).padStart(2, '0')}-${String(date).padStart(2, '0')}`\n      : undefined;\n  }\n\n  const dateParts = query.split(' ');\n  const date = matchStringDate ? dateParts[0] : dateParts[1];\n  const month = (matchStringDate ? dateParts[1] : dateParts[0]).toLowerCase();\n  const monthIndex = MONTHS_FULL_LOWERCASE.findIndex((item) => item.startsWith(month));\n\n  return monthIndex !== -1 && isValidDate(Number(date), monthIndex)\n    ? `${String(monthIndex + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`\n    : undefined;\n}\n\nexport function timestampPlusDay(timestamp: number) {\n  return timestamp + MILLISECONDS_IN_DAY / 1000;\n}\n\nfunction lowerFirst(str: string) {\n  return `${str[0].toLowerCase()}${str.slice(1)}`;\n}\n\nfunction upperFirst(str: string) {\n  return `${str[0].toUpperCase()}${str.slice(1)}`;\n}\n\nexport function formatRegistrationMonth(lang: string, dateString: string) {\n  const [month, year] = dateString.split('.');\n  const date = new Date(`${year}-${month}`);\n\n  return new Intl.DateTimeFormat(lang, { month: 'long', year: 'numeric' }).format(date);\n}\n","import { useCallback } from '../lib/teact/teact';\n\nimport { useStateRef } from './useStateRef';\n\nexport default function useLastCallback<T extends AnyFunction>(callback?: T) {\n  const ref = useStateRef(callback);\n\n  // No need for ref dependency\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  return useCallback((...args: Parameters<T>) => ref.current?.(...args), []) as T;\n}\n","import type { ApiSticker, ApiStickerSet, ApiVideo } from '../../api/types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { buildCollectionByKey, unique } from '../../util/iteratees';\nimport { selectCustomEmojiForEmoji, selectStickersForEmoji, selectTabState } from '../selectors';\nimport { updateTabState } from './tabs';\n\nexport function updateStickerSearch<T extends GlobalState>(\n  global: T,\n  hash: string,\n  resultIds?: string[],\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    stickerSearch: {\n      ...selectTabState(global, tabId).stickerSearch,\n      hash,\n      resultIds,\n    },\n  }, tabId);\n}\n\nexport function updateStickerSets<T extends GlobalState>(\n  global: T,\n  category: 'added' | 'featured' | 'search',\n  hash: string,\n  sets: ApiStickerSet[],\n): T {\n  const updatedSets = sets.map((stickerSet) => {\n    const existing = global.stickers.setsById[stickerSet.id];\n    if (!existing) {\n      return stickerSet;\n    }\n\n    return {\n      ...existing,\n      ...stickerSet,\n    };\n  });\n\n  const regularSetIds = sets.map((set) => set.id);\n\n  if (category === 'search') {\n    return {\n      ...global,\n      stickers: {\n        ...global.stickers,\n        setsById: {\n          ...global.stickers.setsById,\n          ...buildCollectionByKey(updatedSets, 'id'),\n        },\n      },\n    };\n  }\n\n  return {\n    ...global,\n    stickers: {\n      ...global.stickers,\n      setsById: {\n        ...global.stickers.setsById,\n        ...buildCollectionByKey(updatedSets, 'id'),\n      },\n      [category]: {\n        ...global.stickers[category],\n        hash,\n        setIds: [\n          ...(global.stickers[category].setIds || []),\n          ...regularSetIds,\n        ],\n      },\n    },\n  };\n}\n\nexport function updateCustomEmojiSets<T extends GlobalState>(\n  global: T,\n  hash: string,\n  sets: ApiStickerSet[],\n): T {\n  const updatedSets = sets.map((stickerSet) => {\n    const existing = global.stickers.setsById[stickerSet.id];\n    if (!existing) {\n      return stickerSet;\n    }\n\n    return {\n      ...existing,\n      ...stickerSet,\n    };\n  });\n\n  const customEmojis = sets.map((set) => set.stickers).flat().filter(Boolean);\n  const addedSetIds = sets.map((set) => set.id);\n\n  return {\n    ...global,\n    stickers: {\n      ...global.stickers,\n      setsById: {\n        ...global.stickers.setsById,\n        ...buildCollectionByKey(updatedSets, 'id'),\n      },\n    },\n    customEmojis: {\n      ...global.customEmojis,\n      added: {\n        ...global.customEmojis.added,\n        hash,\n        setIds: [\n          ...(global.customEmojis.added.setIds || []),\n          ...addedSetIds,\n        ],\n      },\n      byId: {\n        ...global.customEmojis.byId,\n        ...buildCollectionByKey(customEmojis, 'id'),\n      },\n    },\n  };\n}\n\nexport function updateStickerSet<T extends GlobalState>(\n  global: T, stickerSetId: string, update: Partial<ApiStickerSet>,\n): T {\n  const currentStickerSet = global.stickers.setsById[stickerSetId] || {};\n  const isCustomEmoji = update.isEmoji || currentStickerSet.isEmoji;\n  const addedSets = (isCustomEmoji ? global.customEmojis.added.setIds : global.stickers.added.setIds) || [];\n  let setIds: string[] = addedSets;\n  if (update.installedDate && !update.isArchived && addedSets && !addedSets.includes(stickerSetId)) {\n    setIds = [stickerSetId, ...setIds];\n  }\n\n  if (!update.installedDate && addedSets?.includes(stickerSetId)) {\n    setIds = setIds.filter((id) => id !== stickerSetId);\n  }\n\n  const customEmojiById = isCustomEmoji && update.stickers && buildCollectionByKey(update.stickers, 'id');\n\n  return {\n    ...global,\n    stickers: {\n      ...global.stickers,\n      added: {\n        ...global.stickers.added,\n        ...(!isCustomEmoji && { setIds }),\n      },\n      setsById: {\n        ...global.stickers.setsById,\n        [stickerSetId]: {\n          ...currentStickerSet,\n          ...update,\n        },\n      },\n    },\n    customEmojis: {\n      ...global.customEmojis,\n      byId: {\n        ...global.customEmojis.byId,\n        ...customEmojiById,\n      },\n      added: {\n        ...global.customEmojis.added,\n        ...(isCustomEmoji && { setIds }),\n      },\n    },\n  };\n}\n\nexport function updateGifSearch<T extends GlobalState>(\n  global: T, isNew: boolean, results: ApiVideo[], nextOffset?: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const { results: currentResults } = selectTabState(global, tabId).gifSearch;\n\n  let newResults!: ApiVideo[];\n  if (isNew || !currentResults) {\n    newResults = results;\n  } else {\n    const currentIds = new Set(currentResults.map((gif) => gif.id));\n    newResults = [\n      ...currentResults,\n      ...results.filter((gif) => !currentIds.has(gif.id)),\n    ];\n  }\n\n  return updateTabState(global, {\n    gifSearch: {\n      ...selectTabState(global, tabId).gifSearch,\n      offset: nextOffset,\n      results: newResults,\n    },\n  }, tabId);\n}\n\nexport function replaceAnimatedEmojis<T extends GlobalState>(global: T, stickerSet: ApiStickerSet): T {\n  return {\n    ...global,\n    animatedEmojis: stickerSet,\n  };\n}\n\nexport function updateStickersForEmoji<T extends GlobalState>(\n  global: T, emoji: string, remoteStickers?: ApiSticker[], hash?: string,\n): T {\n  const localStickers = selectStickersForEmoji(global, emoji);\n  const allStickers = [...localStickers, ...(remoteStickers || [])];\n  const uniqueIds = unique(allStickers.map(({ id }) => id));\n  const byId = buildCollectionByKey(allStickers, 'id');\n  const stickers = uniqueIds.map((id) => byId[id]);\n\n  return {\n    ...global,\n    stickers: {\n      ...global.stickers,\n      forEmoji: {\n        emoji,\n        stickers,\n        hash,\n      },\n    },\n  };\n}\n\nexport function updateCustomEmojiForEmoji<T extends GlobalState>(\n  global: T, emoji: string,\n): T {\n  const localStickers = selectCustomEmojiForEmoji(global, emoji);\n  const uniqueIds = unique(localStickers.map(({ id }) => id));\n  const byId = buildCollectionByKey(localStickers, 'id');\n  const stickers = uniqueIds.map((id) => byId[id]);\n\n  return {\n    ...global,\n    customEmojis: {\n      ...global.customEmojis,\n      forEmoji: {\n        emoji,\n        stickers,\n      },\n    },\n  };\n}\n\nexport function updateRecentStatusCustomEmojis<T extends GlobalState>(\n  global: T, hash: string, emojis: ApiSticker[],\n): T {\n  return {\n    ...global,\n    customEmojis: {\n      ...global.customEmojis,\n      statusRecent: {\n        ...global.customEmojis.statusRecent,\n        hash,\n        emojis,\n      },\n    },\n  };\n}\n\nexport function rebuildStickersForEmoji<T extends GlobalState>(global: T): T {\n  if (global.stickers.forEmoji) {\n    const { emoji, stickers, hash } = global.stickers.forEmoji;\n    if (!emoji) {\n      return global;\n    }\n\n    return updateStickersForEmoji(global, emoji, stickers, hash);\n  }\n\n  if (global.customEmojis.forEmoji) {\n    const { emoji } = global.customEmojis.forEmoji;\n    if (!emoji) {\n      return global;\n    }\n\n    return updateCustomEmojiForEmoji(global, emoji);\n  }\n\n  return global;\n}\n","import type {\n  ApiMissingInvitedUser,\n  ApiSavedStarGift,\n  ApiStarGiftCollection,\n  ApiUser,\n  ApiUserCommonChats,\n  ApiUserFullInfo,\n  ApiUserStatus,\n} from '../../api/types';\nimport type { BotAppPermissions } from '../../types';\nimport type { GlobalState, TabArgs, TabState } from '../types';\n\nimport { areDeepEqual } from '../../util/areDeepEqual';\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { omit, omitUndefined, unique } from '../../util/iteratees';\nimport { MEMO_EMPTY_ARRAY } from '../../util/memo';\nimport { getSavedGiftKey } from '../helpers/stars';\nimport { selectActiveGiftsCollectionId } from '../selectors';\nimport { selectTabState } from '../selectors';\nimport { updateTabState } from './tabs';\n\nexport function replaceUsers<T extends GlobalState>(global: T, newById: Record<string, ApiUser>): T {\n  return {\n    ...global,\n    users: {\n      ...global.users,\n      byId: newById,\n    },\n  };\n}\n\nfunction updateContactList<T extends GlobalState>(global: T, updatedUsers: ApiUser[]): T {\n  const { userIds: contactUserIds } = global.contactList || {};\n\n  if (!contactUserIds) return global;\n\n  const contactUserIdsFromUpdate = updatedUsers\n    .filter((user) => user?.isContact)\n    .map((user) => user.id);\n\n  if (contactUserIdsFromUpdate.length === 0) return global;\n\n  return {\n    ...global,\n    contactList: {\n      userIds: unique([\n        ...contactUserIdsFromUpdate,\n        ...contactUserIds,\n      ]),\n    },\n  };\n}\n\nexport function updateUser<T extends GlobalState>(global: T, userId: string, userUpdate: Partial<ApiUser>): T {\n  const { byId } = global.users;\n\n  const updatedUser = getUpdatedUser(global, userId, userUpdate);\n  if (!updatedUser) {\n    return global;\n  }\n\n  global = updateContactList(global, [updatedUser]);\n\n  return replaceUsers(global, {\n    ...byId,\n    [userId]: updatedUser,\n  });\n}\n\nexport function updateUsers<T extends GlobalState>(global: T, newById: Record<string, ApiUser>): T {\n  const updatedById = Object.keys(newById).reduce((acc: Record<string, ApiUser>, id) => {\n    const updatedUser = getUpdatedUser(global, id, newById[id]);\n    if (updatedUser) {\n      acc[id] = updatedUser;\n    }\n\n    return acc;\n  }, {});\n\n  global = replaceUsers(global, {\n    ...global.users.byId,\n    ...updatedById,\n  });\n\n  global = updateContactList(global, Object.values(updatedById));\n\n  return global;\n}\n\n// @optimization Allows to avoid redundant updates which cause a lot of renders\nexport function addUsers<T extends GlobalState>(global: T, newById: Record<string, ApiUser>): T {\n  const { byId } = global.users;\n  let isUpdated = false;\n\n  const addedById = Object.keys(newById).reduce<Record<string, ApiUser>>((acc, id) => {\n    const existingUser = byId[id];\n    const newUser = newById[id];\n\n    if (existingUser && !existingUser.isMin && (newUser.isMin || existingUser.accessHash === newUser.accessHash)) {\n      return acc;\n    }\n\n    const updatedUser = getUpdatedUser(global, id, newUser);\n    if (updatedUser) {\n      acc[id] = updatedUser;\n      if (!isUpdated) {\n        isUpdated = true;\n      }\n    }\n\n    return acc;\n  }, {});\n\n  if (!isUpdated) {\n    return global;\n  }\n\n  global = replaceUsers(global, {\n    ...byId,\n    ...addedById,\n  });\n\n  global = updateContactList(global, Object.values(addedById));\n\n  return global;\n}\n\n// @optimization Don't spread/unspread global for each element, do it in a batch\nfunction getUpdatedUser(global: GlobalState, userId: string, userUpdate: Partial<ApiUser>) {\n  const { byId } = global.users;\n  const user = byId[userId];\n  const omitProps: (keyof ApiUser)[] = [];\n\n  if (userUpdate.isMin && user && !user.isMin) {\n    return undefined; // Do not apply updates from min constructor\n  }\n\n  if (areDeepEqual(user?.usernames, userUpdate.usernames)) {\n    omitProps.push('usernames');\n  }\n\n  const updatedUser = {\n    ...user,\n    ...omit(userUpdate, omitProps),\n  } as ApiUser;\n\n  if (!updatedUser.id || !updatedUser.type) {\n    return undefined;\n  }\n\n  return omitUndefined(updatedUser);\n}\n\nexport function deleteContact<T extends GlobalState>(global: T, userId: string): T {\n  const { byId } = global.users;\n  const { userIds } = global.contactList || {};\n\n  global = {\n    ...global,\n    contactList: {\n      userIds: userIds ? userIds.filter((id) => id !== userId) : MEMO_EMPTY_ARRAY,\n    },\n  };\n\n  global = replaceUsers(global, {\n    ...byId,\n    [userId]: {\n      ...byId[userId],\n      isContact: undefined,\n    },\n  });\n\n  global = {\n    ...global,\n    stories: {\n      ...global.stories,\n      orderedPeerIds: {\n        active: global.stories.orderedPeerIds.active.filter((id) => id !== userId),\n        archived: global.stories.orderedPeerIds.archived.filter((id) => id !== userId),\n      },\n    },\n  };\n\n  return updateUserFullInfo(global, userId, {\n    settings: undefined,\n  });\n}\n\nexport function updateUserSearch<T extends GlobalState>(\n  global: T,\n  searchStatePartial: Partial<TabState['userSearch']>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    userSearch: {\n      ...selectTabState(global, tabId).userSearch,\n      ...searchStatePartial,\n    },\n  }, tabId);\n}\n\nexport function updateUserSearchFetchingStatus<T extends GlobalState>(\n  global: T, newState: boolean,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateUserSearch(global, {\n    fetchingStatus: newState,\n  }, tabId);\n}\n\nexport function updateUserBlockedState<T extends GlobalState>(global: T, userId: string, isBlocked: boolean): T {\n  const { fullInfoById } = global.users;\n  const fullInfo = fullInfoById[userId];\n  if (!fullInfo) {\n    return global;\n  }\n\n  return updateUserFullInfo(global, userId, { isBlocked });\n}\n\nexport function replaceUserStatuses<T extends GlobalState>(global: T, newById: Record<string, ApiUserStatus>): T {\n  return {\n    ...global,\n    users: {\n      ...global.users,\n      statusesById: newById,\n    },\n  };\n}\n\nexport function updateUserFullInfo<T extends GlobalState>(\n  global: T, userId: string, fullInfo: Partial<ApiUserFullInfo>,\n): T {\n  const userFullInfo = global.users.fullInfoById[userId];\n\n  return {\n    ...global,\n    users: {\n      ...global.users,\n      fullInfoById: {\n        ...global.users.fullInfoById,\n        [userId]: {\n          ...userFullInfo,\n          ...fullInfo,\n        },\n      },\n    },\n  };\n}\n\nexport function updateUserCommonChats<T extends GlobalState>(\n  global: T, userId: string, commonChats: ApiUserCommonChats,\n): T {\n  return {\n    ...global,\n    users: {\n      ...global.users,\n      commonChatsById: {\n        ...global.users.commonChatsById,\n        [userId]: commonChats,\n      },\n    },\n  };\n}\n\n// @optimization Allows to avoid redundant updates which cause a lot of renders\nexport function addUserStatuses<T extends GlobalState>(global: T, newById: Record<string, ApiUserStatus>): T {\n  const { statusesById } = global.users;\n\n  global = replaceUserStatuses(global, {\n    ...statusesById,\n    ...newById,\n  });\n\n  return global;\n}\n\nexport function closeNewContactDialog<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    newContact: undefined,\n  }, tabId);\n}\n\nexport function updateMissingInvitedUsers<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  missingUsers: ApiMissingInvitedUser[],\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  if (!missingUsers.length) {\n    return updateTabState(global, {\n      inviteViaLinkModal: undefined,\n    }, tabId);\n  }\n\n  return updateTabState(global, {\n    inviteViaLinkModal: {\n      missingUsers,\n      chatId,\n    },\n  }, tabId);\n}\n\nexport function updateBotAppPermissions<T extends GlobalState>(\n  global: T,\n  botId: string,\n  permissions: BotAppPermissions,\n): T {\n  const { botAppPermissionsById } = global.users;\n\n  return {\n    ...global,\n    users: {\n      ...global.users,\n      botAppPermissionsById: {\n        ...botAppPermissionsById,\n        [botId]: {\n          ...botAppPermissionsById[botId],\n          ...permissions,\n        },\n      },\n    },\n  };\n}\n\nexport function replacePeerSavedGifts<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  gifts: ApiSavedStarGift[],\n  nextOffset?: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const tabState = selectTabState(global, tabId);\n\n  // Some non-unique gifts can be entirely identical and break `key`\n  const keyCounts = new Map<string, number>();\n  gifts.forEach((gift) => {\n    const id = getSavedGiftKey(gift, true);\n    const count = keyCounts.get(id) || 0;\n    if (count > 0) {\n      gift.localTag = count;\n    }\n    keyCounts.set(id, count + 1);\n  });\n\n  const activeCollectionId = selectActiveGiftsCollectionId(global, peerId, tabId);\n\n  return updateTabState(global, {\n    savedGifts: {\n      ...tabState.savedGifts,\n      collectionsByPeerId: {\n        ...tabState.savedGifts.collectionsByPeerId,\n        [peerId]: {\n          ...tabState.savedGifts.collectionsByPeerId[peerId],\n          [activeCollectionId]: {\n            gifts,\n            nextOffset,\n          },\n        },\n      },\n    },\n  }, tabId);\n}\n\nexport function updatePeerStarGiftCollections<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  collections: ApiStarGiftCollection[],\n): T {\n  return {\n    ...global,\n    starGiftCollections: {\n      ...global.starGiftCollections,\n      byPeerId: {\n        ...global.starGiftCollections?.byPeerId,\n        [peerId]: collections,\n      },\n    },\n  };\n}\n","import type { ApiGlobalMessageSearchType, ApiMessage, ApiSearchPostsFlood } from '../../api/types';\nimport type { GlobalSearchContent } from '../../types';\nimport type { GlobalState, TabArgs, TabState } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { areSortedArraysEqual } from '../../util/iteratees';\nimport { getSearchResultKey } from '../../util/keys/searchResultKey';\nimport { selectTabState } from '../selectors';\nimport { updateTabState } from './tabs';\n\nexport function updateGlobalSearch<T extends GlobalState>(\n  global: T,\n  searchStatePartial: Partial<TabState['globalSearch']>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    globalSearch: {\n      ...selectTabState(global, tabId).globalSearch,\n      ...searchStatePartial,\n    },\n  }, tabId);\n}\n\nexport function updateGlobalSearchContent<T extends GlobalState>(\n  global: T,\n  currentContent: GlobalSearchContent | undefined,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateGlobalSearch(global, { currentContent }, tabId);\n}\n\nexport function updateGlobalSearchResults<T extends GlobalState>(\n  global: T,\n  newFoundMessages: ApiMessage[],\n  totalCount: number,\n  type: ApiGlobalMessageSearchType,\n  nextOffsetRate?: number,\n  nextOffsetId?: number,\n  nextOffsetPeerId?: string,\n  searchFlood?: ApiSearchPostsFlood,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const { resultsByType } = selectTabState(global, tabId).globalSearch || {};\n  const newFoundMessagesById = newFoundMessages.reduce((result, message) => {\n    result[getSearchResultKey(message)] = message;\n\n    return result;\n  }, {} as Record<string, ApiMessage>);\n  const foundIdsForType = resultsByType?.[type]?.foundIds;\n\n  if (foundIdsForType !== undefined\n    && Object.keys(newFoundMessagesById).every(\n      (newId) => foundIdsForType.includes(getSearchResultKey(newFoundMessagesById[newId])),\n    )\n  ) {\n    global = updateGlobalSearchFetchingStatus(global, {\n      messages: false,\n      publicPosts: false,\n    }, tabId);\n    return updateGlobalSearch(global, {\n      searchFlood,\n      resultsByType: {\n        ...(selectTabState(global, tabId).globalSearch || {}).resultsByType,\n        [type]: {\n          foundIds: foundIdsForType,\n          totalCount,\n          nextOffsetId,\n          nextOffsetRate,\n          nextOffsetPeerId,\n        },\n      },\n    }, tabId);\n  }\n\n  const prevFoundIds = foundIdsForType || [];\n  const newFoundIds = newFoundMessages\n    .map((message) => getSearchResultKey(message))\n    .filter((id) => !prevFoundIds.includes(id));\n  const foundIds = Array.prototype.concat(prevFoundIds, newFoundIds);\n  const foundOrPrevFoundIds = areSortedArraysEqual(prevFoundIds, foundIds) ? prevFoundIds : foundIds;\n\n  global = updateGlobalSearchFetchingStatus(global, {\n    messages: false,\n    publicPosts: false,\n  }, tabId);\n\n  return updateGlobalSearch(global, {\n    searchFlood,\n    resultsByType: {\n      ...(selectTabState(global, tabId).globalSearch || {}).resultsByType,\n      [type]: {\n        totalCount,\n        nextOffsetId,\n        nextOffsetRate,\n        nextOffsetPeerId,\n        foundIds: foundOrPrevFoundIds,\n      },\n    },\n  }, tabId);\n}\n\nexport function updateGlobalSearchFetchingStatus<T extends GlobalState>(\n  global: T, newState: { chats?: boolean; messages?: boolean; botApps?: boolean; publicPosts?: boolean },\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateGlobalSearch(global, {\n    fetchingStatus: {\n      ...selectTabState(global, tabId).globalSearch.fetchingStatus,\n      ...newState,\n    },\n  }, tabId);\n}\n","import type { ManagementProgress, ManagementState } from '../../types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { selectTabState } from '../selectors';\nimport { updateTabState } from './tabs';\n\nexport function updateManagementProgress<T extends GlobalState>(\n  global: T, progress: ManagementProgress,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    management: {\n      ...selectTabState(global, tabId).management,\n      progress,\n    },\n  }, tabId);\n}\n\nexport function updateManagement<T extends GlobalState>(\n  global: T, chatId: string, update: Partial<ManagementState>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const { management } = selectTabState(global, tabId);\n  return updateTabState(global, {\n    management: {\n      ...management,\n      byChatId: {\n        ...management.byChatId,\n        [chatId]: {\n          ...(management.byChatId[chatId] || {}),\n          ...update,\n        },\n      },\n    },\n  }, tabId);\n}\n","import type { ApiNotifyPeerType, ApiPeerNotifySettings } from '../../api/types';\nimport type {\n  AccountSettings, IThemeSettings,\n  ThemeKey,\n} from '../../types';\nimport type { GlobalState, SharedState } from '../types';\n\nimport { selectSharedSettings } from '../selectors/sharedState';\nimport { updateSharedState } from './sharedState';\nimport { updateUserBlockedState } from './users';\n\nexport function replaceSettings<T extends GlobalState>(global: T, newSettings?: Partial<AccountSettings>): T {\n  return {\n    ...global,\n    settings: {\n      ...global.settings,\n      byKey: {\n        ...global.settings.byKey,\n        ...newSettings,\n      },\n    },\n  };\n}\n\nexport function updateSharedSettings<T extends GlobalState>(\n  global: T, newSettings?: Partial<SharedState['settings']>,\n): T {\n  const settings = selectSharedSettings(global);\n  return updateSharedState(global, {\n    settings: {\n      ...settings,\n      ...newSettings,\n    },\n  });\n}\n\nexport function updateThemeSettings<T extends GlobalState>(\n  global: T, theme: ThemeKey, newSettings?: Partial<IThemeSettings>,\n): T {\n  const settings = global.settings;\n  const current = settings.themes[theme];\n\n  return {\n    ...global,\n    settings: {\n      ...global.settings,\n      themes: {\n        ...settings.themes,\n        [theme]: {\n          ...current,\n          ...newSettings,\n        },\n      },\n    },\n  };\n}\n\nexport function addNotifyExceptions<T extends GlobalState>(\n  global: T, notifyExceptionById: Record<string, ApiPeerNotifySettings>,\n): T {\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      notifyExceptionById: {\n        ...global.chats.notifyExceptionById,\n        ...notifyExceptionById,\n      },\n    },\n  };\n}\n\nexport function replaceNotifyExceptions<T extends GlobalState>(\n  global: T, notifyExceptionById: Record<string, ApiPeerNotifySettings>,\n): T {\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      notifyExceptionById,\n    },\n  };\n}\n\nexport function addNotifyException<T extends GlobalState>(\n  global: T, id: string, notifyException: ApiPeerNotifySettings,\n): T {\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      notifyExceptionById: {\n        ...global.chats.notifyExceptionById,\n        [id]: notifyException,\n      },\n    },\n  };\n}\n\nexport function updateNotifyDefaults<T extends GlobalState>(\n  global: T, peerType: ApiNotifyPeerType, settings: Partial<ApiPeerNotifySettings>,\n): T {\n  return {\n    ...global,\n    settings: {\n      ...global.settings,\n      notifyDefaults: {\n        ...global.settings.notifyDefaults,\n        [peerType]: {\n          ...global.settings.notifyDefaults?.[peerType],\n          ...settings,\n        },\n      },\n    },\n  };\n}\n\nexport function addBlockedUser<T extends GlobalState>(global: T, contactId: string): T {\n  global = updateUserBlockedState(global, contactId, true);\n\n  return {\n    ...global,\n    blocked: {\n      ...global.blocked,\n      ids: [contactId, ...global.blocked.ids],\n      totalCount: global.blocked.totalCount + 1,\n    },\n  };\n}\n\nexport function removeBlockedUser<T extends GlobalState>(global: T, contactId: string): T {\n  global = updateUserBlockedState(global, contactId, false);\n\n  return {\n    ...global,\n    blocked: {\n      ...global.blocked,\n      ids: global.blocked.ids.filter((id) => id !== contactId),\n      totalCount: global.blocked.totalCount - 1,\n    },\n  };\n}\n","import type { GlobalState, SharedState } from '../types';\n\nexport function updateSharedState<T extends GlobalState>(\n  global: T, update: Partial<SharedState>,\n): T {\n  return {\n    ...global,\n    sharedState: {\n      ...global.sharedState,\n      ...update,\n    },\n  };\n}\n","import type { GlobalState } from '../types';\n\nexport function updateTwoFaSettings<T extends GlobalState>(\n  global: T,\n  update: GlobalState['twoFaSettings'],\n): T {\n  return {\n    ...global,\n    twoFaSettings: {\n      ...global.twoFaSettings,\n      ...update,\n    },\n  };\n}\n","import type { GlobalState, SharedState, TabState } from '../types';\n\nimport { INITIAL_GLOBAL_STATE, INITIAL_SHARED_STATE, INITIAL_TAB_STATE } from '../initialState';\n\nexport function updatePasscodeSettings<T extends GlobalState>(\n  global: T,\n  update: GlobalState['passcode'],\n): T {\n  return {\n    ...global,\n    passcode: {\n      ...global.passcode,\n      ...update,\n    },\n  };\n}\n\nexport function clearPasscodeSettings<T extends GlobalState>(global: T): T {\n  return {\n    ...global,\n    passcode: {},\n  };\n}\n\nexport function clearGlobalForLockScreen<T extends GlobalState>(global: T, withTabState = true): T {\n  return {\n    ...INITIAL_GLOBAL_STATE,\n    passcode: global.passcode,\n    settings: INITIAL_GLOBAL_STATE.settings,\n    sharedState: clearSharedStateForLockScreen(global.sharedState),\n    ...(withTabState && {\n      byTabId: Object.values(global.byTabId).reduce((acc, { id: tabId, isMasterTab }) => {\n        acc[tabId] = { ...INITIAL_TAB_STATE, isMasterTab, id: tabId };\n        return acc;\n      }, {} as Record<number, TabState>),\n    }),\n  } as T;\n}\n\nexport function clearSharedStateForLockScreen(sharedState: SharedState): SharedState {\n  const {\n    theme,\n    shouldUseSystemTheme,\n    animationLevel,\n    language,\n  } = sharedState.settings;\n\n  return {\n    ...INITIAL_SHARED_STATE,\n    settings: {\n      ...INITIAL_SHARED_STATE.settings,\n      theme,\n      shouldUseSystemTheme,\n      animationLevel,\n      language,\n    },\n  };\n}\n","import type {\n  ApiReceiptRegular,\n  ApiReceiptStars,\n  ApiStarsSubscription,\n  ApiStarsTransaction,\n  ApiTypeCurrencyAmount,\n} from '../../api/types';\nimport type {\n  PaymentStep,\n  ShippingOption,\n  StarsSubscriptions,\n  StarsTransactionType,\n} from '../../types';\nimport type {\n  GlobalState, TabArgs, TabState,\n} from '../types';\n\nimport { STARS_CURRENCY_CODE, TON_CURRENCY_CODE } from '../../config';\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { selectStarsPayment, selectTabState } from '../selectors';\nimport { updateTabState } from './tabs';\n\nexport function updatePayment<T extends GlobalState>(\n  global: T, update: Partial<TabState['payment']>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    payment: {\n      ...selectTabState(global, tabId).payment,\n      ...update,\n    },\n  }, tabId);\n}\n\nexport function updateStarsPayment<T extends GlobalState>(\n  global: T, update: Partial<TabState['starsPayment']>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const starPayment = selectStarsPayment(global, tabId);\n  if (!starPayment) {\n    return global;\n  }\n\n  return updateTabState(global, {\n    starsPayment: {\n      ...starPayment,\n      ...update,\n    },\n  }, tabId);\n}\n\nexport function updateShippingOptions<T extends GlobalState>(\n  global: T,\n  shippingOptions: ShippingOption[],\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n\n): T {\n  return updatePayment(global, { shippingOptions }, tabId);\n}\n\nexport function setRequestInfoId<T extends GlobalState>(\n  global: T, id: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updatePayment(global, { requestId: id }, tabId);\n}\n\nexport function setPaymentStep<T extends GlobalState>(\n  global: T, step: PaymentStep,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updatePayment(global, { step }, tabId);\n}\n\nexport function setStripeCardInfo<T extends GlobalState>(\n  global: T, cardInfo: { type: string; id: string },\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updatePayment(global, { stripeCredentials: { ...cardInfo } }, tabId);\n}\n\nexport function setSmartGlocalCardInfo<T extends GlobalState>(\n  global: T,\n  cardInfo: { type: string; token: string },\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updatePayment(global, { smartGlocalCredentials: { ...cardInfo } }, tabId);\n}\n\nexport function setConfirmPaymentUrl<T extends GlobalState>(\n  global: T, url?: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updatePayment(global, { confirmPaymentUrl: url }, tabId);\n}\n\nexport function setReceipt<T extends GlobalState>(\n  global: T,\n  receipt?: ApiReceiptRegular,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  if (!receipt) {\n    return updatePayment(global, { receipt: undefined }, tabId);\n  }\n\n  return updatePayment(global, {\n    receipt,\n  }, tabId);\n}\n\nexport function clearPayment<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    payment: {},\n  }, tabId);\n}\n\nexport function clearStarPayment<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    starsPayment: {},\n  }, tabId);\n}\n\nexport function closeInvoice<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  global = updatePayment(global, {\n    isPaymentModalOpen: undefined,\n    isExtendedMedia: undefined,\n  }, tabId);\n  return global;\n}\n\nexport function updateStarsBalance<T extends GlobalState>(\n  global: T, balance: ApiTypeCurrencyAmount,\n): T {\n  if (balance.currency === STARS_CURRENCY_CODE) {\n    return {\n      ...global,\n      stars: {\n        ...global.stars,\n        balance,\n      },\n    };\n  }\n\n  if (balance.currency === TON_CURRENCY_CODE) {\n    return {\n      ...global,\n      ton: {\n        ...global.ton,\n        balance,\n      },\n    };\n  }\n\n  return global;\n}\n\nexport function appendStarsTransactions<T extends GlobalState>(\n  global: T,\n  type: StarsTransactionType,\n  transactions: ApiStarsTransaction[],\n  nextOffset?: string,\n  isTon?: boolean,\n): T {\n  if (isTon) {\n    const history = global.ton?.history;\n    if (!history) {\n      return global;\n    }\n\n    const newTypeObject = {\n      transactions: (history[type]?.transactions || []).concat(transactions),\n      nextOffset,\n    };\n\n    return {\n      ...global,\n      ton: {\n        ...global.ton,\n        history: {\n          ...history,\n          [type]: newTypeObject,\n        },\n      },\n    };\n  }\n\n  const history = global.stars?.history;\n  if (!history) {\n    return global;\n  }\n\n  const newTypeObject = {\n    transactions: (history[type]?.transactions || []).concat(transactions),\n    nextOffset,\n  };\n\n  return {\n    ...global,\n    stars: {\n      ...global.stars,\n      history: {\n        ...history,\n        [type]: newTypeObject,\n      },\n    },\n  };\n}\n\nexport function appendStarsSubscriptions<T extends GlobalState>(\n  global: T,\n  subscriptions: ApiStarsSubscription[],\n  nextOffset?: string,\n): T {\n  if (!global.stars) {\n    return global;\n  }\n\n  const newObject = {\n    list: (global.stars.subscriptions?.list || []).concat(subscriptions),\n    nextOffset,\n  } satisfies StarsSubscriptions;\n\n  return {\n    ...global,\n    stars: {\n      ...global.stars,\n      subscriptions: newObject,\n    },\n  };\n}\n\nexport function updateStarsSubscriptionLoading<T extends GlobalState>(\n  global: T, isLoading: boolean,\n): T {\n  const subscriptions = global.stars?.subscriptions;\n  if (!subscriptions) {\n    return global;\n  }\n\n  return {\n    ...global,\n    stars: {\n      ...global.stars,\n      subscriptions: {\n        ...subscriptions,\n        isLoading,\n      },\n    },\n  };\n}\n\nexport function openStarsTransactionModal<T extends GlobalState>(\n  global: T, transaction: ApiStarsTransaction, ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    starsTransactionModal: {\n      transaction,\n    },\n  }, tabId);\n}\n\nexport function openStarsTransactionFromReceipt<T extends GlobalState>(\n  global: T, receipt: ApiReceiptStars, ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const transaction: ApiStarsTransaction = {\n    id: receipt.transactionId,\n    peer: {\n      type: 'peer',\n      id: receipt.botId,\n    },\n    amount: {\n      currency: STARS_CURRENCY_CODE,\n      amount: receipt.totalAmount,\n      nanos: 0,\n    },\n    date: receipt.date,\n    title: receipt.title,\n    description: receipt.description,\n    photo: receipt.photo,\n  };\n\n  return openStarsTransactionModal(global, transaction, tabId);\n}\n","import type {\n  ApiChannelMonetizationStatistics,\n  ApiChannelStatistics, ApiGroupStatistics, ApiPostStatistics, StatisticsGraph,\n} from '../../api/types';\nimport type { GlobalState, TabArgs, TabState } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { selectTabState } from '../selectors';\nimport { updateTabState } from './tabs';\n\nexport function updateStatistics<T extends GlobalState>(\n  global: T, chatId: string, statistics: ApiChannelStatistics | ApiGroupStatistics,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    statistics: {\n      byChatId: {\n        ...selectTabState(global, tabId).statistics.byChatId,\n        [chatId]: statistics,\n      },\n    },\n  }, tabId);\n}\n\nexport function updateMessageStatistics<T extends GlobalState>(\n  global: T, statistics: ApiPostStatistics,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    statistics: {\n      ...selectTabState(global, tabId).statistics,\n      currentMessage: statistics,\n      currentStory: undefined,\n    },\n  }, tabId);\n}\n\nexport function updateStoryStatistics<T extends GlobalState>(\n  global: T, statistics: ApiPostStatistics,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    statistics: {\n      ...selectTabState(global, tabId).statistics,\n      currentStory: statistics,\n      currentMessage: undefined,\n    },\n  }, tabId);\n}\n\nexport function updateStatisticsGraph<T extends GlobalState>(\n  global: T, chatId: string, name: string, update: StatisticsGraph,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const { statistics } = selectTabState(global, tabId);\n  return updateTabState(global, {\n    statistics: {\n      ...statistics,\n      byChatId: {\n        ...statistics.byChatId,\n        [chatId]: {\n          ...(statistics.byChatId[chatId] || {}),\n          [name]: update,\n        },\n      },\n    },\n  }, tabId);\n}\n\nexport function updateChannelMonetizationStatistics<T extends GlobalState>(\n  global: T, statistics: ApiChannelMonetizationStatistics,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    statistics: {\n      ...selectTabState(global, tabId).statistics,\n      monetization: statistics,\n    },\n  }, tabId);\n}\n\nexport function updateVerifyMonetizationModal<T extends GlobalState>(\n  global: T, update: Partial<TabState['monetizationVerificationModal']>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const tabState = selectTabState(global, tabId);\n  if (!tabState.monetizationVerificationModal) {\n    return global;\n  }\n\n  return updateTabState(global, {\n    monetizationVerificationModal: {\n      ...tabState.monetizationVerificationModal,\n      ...update,\n    },\n  }, tabId);\n}\n","import type {\n  ApiChat, ApiChatFullInfo, ApiPeerPhotos, ApiPhoto, ApiUser, ApiUserFullInfo,\n} from '../../api/types';\nimport type { GlobalState } from '../types';\n\nimport { isUserId } from '../../util/entities/ids';\nimport { omit, uniqueByField } from '../../util/iteratees';\nimport { isChatChannel } from '../helpers';\nimport {\n  selectChatFullInfo,\n  selectPeer,\n  selectPeerPhotos,\n  selectUserFullInfo,\n} from '../selectors';\nimport { updateChat, updateChatFullInfo } from './chats';\nimport { updateUser, updateUserFullInfo } from './users';\n\n// `type` has different types in ApiChat and ApiUser\ntype ApiPeerSharedFields = Omit<CommonProperties<ApiChat, ApiUser>, 'type'>;\ntype ApiPeerFullInfoSharedFields = CommonProperties<ApiChatFullInfo, ApiUserFullInfo>;\n\nexport function updatePeer<T extends GlobalState>(\n  global: T, peerId: string, peerUpdate: Partial<ApiPeerSharedFields>,\n) {\n  if (isUserId(peerId)) {\n    return updateUser(global, peerId, peerUpdate);\n  }\n\n  return updateChat(global, peerId, peerUpdate);\n}\n\nexport function updatePeerFullInfo<T extends GlobalState>(\n  global: T, peerId: string, peerFullInfoUpdate: Partial<ApiPeerFullInfoSharedFields>,\n) {\n  if (isUserId(peerId)) {\n    return updateUserFullInfo(global, peerId, peerFullInfoUpdate);\n  }\n\n  return updateChatFullInfo(global, peerId, peerFullInfoUpdate);\n}\n\nexport function updatePeerPhotosIsLoading<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  isLoading: boolean,\n) {\n  const profilePhotos = selectPeerPhotos(global, peerId);\n  if (!profilePhotos) {\n    return global;\n  }\n\n  return replacePeerPhotos(global, peerId, {\n    ...profilePhotos,\n    isLoading,\n  });\n}\n\nexport function replacePeerPhotos<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  value?: ApiPeerPhotos,\n) {\n  if (!value) {\n    return {\n      ...global,\n      peers: {\n        ...global.peers,\n        profilePhotosById: omit(global.peers.profilePhotosById, [peerId]),\n      },\n    };\n  }\n\n  return {\n    ...global,\n    peers: {\n      ...global.peers,\n      profilePhotosById: {\n        ...global.peers.profilePhotosById,\n        [peerId]: value,\n      },\n    },\n  };\n}\n\nexport function updatePeerPhotos<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  update: {\n    newPhotos: ApiPhoto[];\n    count: number;\n    nextOffset?: number;\n    fullInfo: ApiChatFullInfo | ApiUserFullInfo;\n    shouldInvalidateCache?: boolean;\n  },\n) {\n  const profilePhotos = selectPeerPhotos(global, peerId);\n\n  const {\n    newPhotos, count, nextOffset, fullInfo, shouldInvalidateCache,\n  } = update;\n  const currentPhotos = profilePhotos;\n  const profilePhoto = fullInfo.profilePhoto;\n  const fallbackPhoto = 'fallbackPhoto' in fullInfo ? fullInfo.fallbackPhoto : undefined;\n  const personalPhoto = 'personalPhoto' in fullInfo ? fullInfo.personalPhoto : undefined;\n\n  if (!currentPhotos || shouldInvalidateCache) {\n    // In some channels, last service message with photo change is deleted, so we need to patch it in\n    if (profilePhoto && profilePhoto.id !== newPhotos[0]?.id) {\n      newPhotos.unshift(profilePhoto);\n    }\n\n    if (personalPhoto && personalPhoto.id !== newPhotos[0]?.id) {\n      newPhotos.unshift(personalPhoto);\n    }\n\n    if (fallbackPhoto) {\n      newPhotos.push(fallbackPhoto);\n    }\n\n    return replacePeerPhotos(global, peerId, {\n      fallbackPhoto,\n      personalPhoto,\n      photos: newPhotos,\n      count,\n      nextOffset,\n      isLoading: false,\n    });\n  }\n\n  const hasFallbackPhoto = currentPhotos.photos.at(-1).id === fallbackPhoto?.id;\n  const currentPhotoArray = hasFallbackPhoto ? currentPhotos.photos.slice(0, -1) : currentPhotos.photos;\n\n  const photos = uniqueByField([...currentPhotoArray, ...newPhotos, fallbackPhoto].filter(Boolean), 'id');\n  return replacePeerPhotos(global, peerId, {\n    fallbackPhoto,\n    personalPhoto,\n    photos,\n    count,\n    nextOffset,\n    isLoading: false,\n  });\n}\n\nexport function deletePeerPhoto<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  photoId: string,\n  isFromActionMessage?: boolean,\n) {\n  const peer = selectPeer(global, peerId);\n  const profilePhotos = selectPeerPhotos(global, peerId);\n  if (!peer || !profilePhotos) {\n    return global;\n  }\n  const isChannel = 'title' in peer && isChatChannel(peer);\n\n  const userFullInfo = selectUserFullInfo(global, peerId);\n  const chatFullInfo = selectChatFullInfo(global, peerId);\n\n  const isAvatar = peer.avatarPhotoId === photoId && (!isChannel || isFromActionMessage);\n  const nextAvatarPhoto = isAvatar ? profilePhotos.photos[1] : undefined;\n\n  if (userFullInfo) {\n    const newFallbackPhoto = userFullInfo.fallbackPhoto?.id === photoId ? undefined : userFullInfo.fallbackPhoto;\n    const newPersonalPhoto = userFullInfo.personalPhoto?.id === photoId ? undefined : userFullInfo.personalPhoto;\n    const newProfilePhoto = userFullInfo.profilePhoto?.id === photoId ? nextAvatarPhoto : userFullInfo.profilePhoto;\n    global = updateUserFullInfo(global, peerId, {\n      fallbackPhoto: newFallbackPhoto,\n      personalPhoto: newPersonalPhoto,\n      profilePhoto: newProfilePhoto,\n    });\n  }\n\n  if (chatFullInfo) {\n    const newProfilePhoto = chatFullInfo.profilePhoto?.id === photoId ? nextAvatarPhoto : chatFullInfo.profilePhoto;\n    global = updateChatFullInfo(global, peerId, {\n      profilePhoto: newProfilePhoto,\n    });\n  }\n\n  const avatarPhotoId = isAvatar ? nextAvatarPhoto?.id : peer.avatarPhotoId;\n  const shouldKeepInPhotos = isAvatar && 'title' in peer && isChatChannel(peer);\n  const photos = shouldKeepInPhotos\n    ? profilePhotos.photos.filter((photo) => photo.id !== photoId) : profilePhotos.photos.slice();\n\n  global = updatePeer(global, peerId, {\n    avatarPhotoId,\n  });\n\n  global = replacePeerPhotos(global, peerId, avatarPhotoId ? {\n    ...profilePhotos,\n    photos,\n    count: profilePhotos.count - 1,\n  } : undefined);\n\n  return global;\n}\n","import type {\n  ApiPeerStories,\n  ApiReaction,\n  ApiStealthMode,\n  ApiStory,\n  ApiStoryDeleted,\n  ApiStorySkipped,\n  ApiStoryViews,\n  ApiTypeStory,\n  ApiTypeStoryView,\n} from '../../api/types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport { isUserId } from '../../util/entities/ids';\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { compareFields, unique } from '../../util/iteratees';\nimport { getServerTime } from '../../util/serverTime';\nimport { updateReactionCount } from '../helpers';\nimport {\n  selectIsChatWithSelf,\n  selectPeer, selectPeerStories, selectPeerStory, selectTabState, selectUser,\n} from '../selectors';\nimport { updatePeer } from './peers';\nimport { updateTabState } from './tabs';\n\nexport function addStories<T extends GlobalState>(global: T, newStoriesByPeerId: Record<string, ApiPeerStories>): T {\n  const updatedByPeerId = Object.entries(newStoriesByPeerId).reduce((acc, [peerId, newPeerStories]) => {\n    if (!acc[peerId]) {\n      acc[peerId] = newPeerStories;\n    } else {\n      acc[peerId].byId = { ...acc[peerId].byId, ...newPeerStories.byId };\n      acc[peerId].orderedIds = unique(newPeerStories.orderedIds.concat(acc[peerId].orderedIds));\n      acc[peerId].profileIds = unique(newPeerStories.profileIds.concat(acc[peerId].profileIds)).sort((a, b) => b - a);\n      acc[peerId].lastUpdatedAt = newPeerStories.lastUpdatedAt;\n      acc[peerId].lastReadId = newPeerStories.lastReadId;\n    }\n\n    return acc;\n  }, global.stories.byPeerId);\n\n  global = {\n    ...global,\n    stories: {\n      ...global.stories,\n      byPeerId: updatedByPeerId,\n    },\n  };\n\n  return updateOrderedStoriesPeerIds(global, Object.keys(newStoriesByPeerId));\n}\n\nexport function addStoriesForPeer<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  newStories: Record<number, ApiTypeStory>,\n  newPinnedIds?: number[],\n  addToArchive?: boolean,\n  albumId?: number,\n): T {\n  const {\n    byId, orderedIds, profileIds, archiveIds, pinnedIds, idsByAlbumId,\n  } = global.stories.byPeerId[peerId] || {};\n  const deletedIds = Object.keys(newStories).filter((id) => 'isDeleted' in newStories[Number(id)]).map(Number);\n  const updatedById = { ...byId, ...newStories };\n  let updatedOrderedIds = [...(orderedIds || [])];\n  let updatedArchiveIds = [...(archiveIds || [])];\n  const updatedProfileIds = unique(\n    [...(profileIds || [])].concat(Object.values(newStories).reduce((ids, story) => {\n      if (('isInProfile' in story && story.isInProfile)) {\n        ids.push(story.id);\n      }\n\n      return ids;\n    }, [] as number[])),\n  ).sort((a, b) => b - a).filter((storyId) => !deletedIds.includes(storyId));\n\n  updatedOrderedIds = unique(Object.entries(newStories).reduce((acc, [storyId, story]) => {\n    if ('expireDate' in story && story.expireDate && story.expireDate > getServerTime()) {\n      acc.push(Number(storyId));\n    }\n\n    return acc;\n  }, updatedOrderedIds)).filter((storyId) => !deletedIds.includes(storyId));\n\n  if (addToArchive && selectIsChatWithSelf(global, peerId)) {\n    updatedArchiveIds = unique(updatedArchiveIds.concat(Object.keys(newStories).map(Number)))\n      .sort((a, b) => b - a)\n      .filter((storyId) => !deletedIds.includes(storyId));\n  }\n\n  const updatedIdsByAlbumId = { ...(idsByAlbumId || {}) };\n  if (albumId !== undefined) {\n    const newAlbumStoryIds = Object.keys(newStories).map(Number)\n      .filter((storyId) => !deletedIds.includes(storyId));\n\n    const existingAlbumData = updatedIdsByAlbumId[albumId];\n    const existingIds = existingAlbumData?.ids || [];\n\n    updatedIdsByAlbumId[albumId] = {\n      ...updatedIdsByAlbumId[albumId],\n      ids: unique([...existingIds, ...newAlbumStoryIds]).sort((a, b) => b - a),\n    };\n  }\n\n  global = {\n    ...global,\n    stories: {\n      ...global.stories,\n      byPeerId: {\n        ...global.stories.byPeerId,\n        [peerId]: {\n          ...global.stories.byPeerId[peerId],\n          byId: updatedById,\n          orderedIds: updatedOrderedIds,\n          profileIds: updatedProfileIds,\n          pinnedIds: pinnedIds || newPinnedIds,\n          ...(addToArchive && { archiveIds: updatedArchiveIds }),\n          ...(albumId !== undefined && { idsByAlbumId: updatedIdsByAlbumId }),\n        },\n      },\n    },\n  };\n\n  if (selectIsChatWithSelf(global, peerId)\n    || selectUser(global, peerId)?.isContact\n    || peerId === global.appConfig.storyChangelogUserId) {\n    global = updatePeerLastUpdatedAt(global, peerId);\n    global = updateOrderedStoriesPeerIds(global, [peerId]);\n  }\n\n  return global;\n}\n\nexport function updateStoriesForPeer<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  peerStories: ApiPeerStories,\n): T {\n  return {\n    ...global,\n    stories: {\n      ...global.stories,\n      byPeerId: {\n        ...global.stories.byPeerId,\n        [peerId]: peerStories,\n      },\n    },\n  };\n}\n\nexport function updatePeerStoriesFullyLoaded<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  isFullyLoaded: boolean,\n  isArchive?: boolean,\n  albumId?: number,\n): T {\n  const { byPeerId } = global.stories;\n  const peerStories = byPeerId[peerId];\n\n  if (albumId !== undefined && peerStories?.idsByAlbumId?.[albumId]) {\n    return {\n      ...global,\n      stories: {\n        ...global.stories,\n        byPeerId: {\n          ...byPeerId,\n          [peerId]: {\n            ...peerStories,\n            idsByAlbumId: {\n              ...peerStories.idsByAlbumId,\n              [albumId]: {\n                ...peerStories.idsByAlbumId[albumId],\n                isFullyLoaded,\n              },\n            },\n          },\n        },\n      },\n    };\n  }\n\n  return {\n    ...global,\n    stories: {\n      ...global.stories,\n      byPeerId: {\n        ...global.stories.byPeerId,\n        [peerId]: {\n          ...global.stories.byPeerId[peerId],\n          [isArchive ? 'isArchiveFullyLoaded' : 'isFullyLoaded']: isFullyLoaded,\n        },\n      },\n    },\n  };\n}\n\nexport function updateLastReadStoryForPeer<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  lastReadId: number,\n): T {\n  const { orderedIds } = selectPeerStories(global, peerId) || {};\n  if (!orderedIds) {\n    return global;\n  }\n\n  if (lastReadId >= orderedIds[orderedIds.length - 1]) {\n    global = updatePeer(global, peerId, {\n      hasUnreadStories: false,\n    });\n  }\n\n  return {\n    ...global,\n    stories: {\n      ...global.stories,\n      byPeerId: {\n        ...global.stories.byPeerId,\n        [peerId]: {\n          ...global.stories.byPeerId[peerId],\n          lastReadId,\n        },\n      },\n    },\n  };\n}\n\nexport function updateLastViewedStoryForPeer<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  lastViewedId: number,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const { orderedIds } = selectPeerStories(global, peerId) || {};\n  if (!orderedIds || !orderedIds.includes(lastViewedId)) {\n    return global;\n  }\n\n  const { storyViewer } = selectTabState(global, tabId);\n\n  return updateTabState(global, {\n    storyViewer: {\n      ...storyViewer,\n      lastViewedByPeerId: {\n        ...storyViewer.lastViewedByPeerId,\n        [peerId]: lastViewedId,\n      },\n    },\n  }, tabId);\n}\n\nexport function updatePeersWithStories<T extends GlobalState>(\n  global: T,\n  storiesByPeerId: Record<string, ApiPeerStories>,\n): T {\n  Object.entries(storiesByPeerId).forEach(([peerId, { lastReadId, orderedIds }]) => {\n    const peer = selectPeer(global, peerId);\n    if (!peer) return;\n\n    global = updatePeer(global, peerId, {\n      hasStories: true,\n      hasUnreadStories: !lastReadId\n        || Boolean(lastReadId && lastReadId < (peer.maxStoryId || orderedIds[orderedIds.length - 1])),\n    });\n  });\n\n  return global;\n}\n\nexport function updateStoryViews<T extends GlobalState>(\n  global: T,\n  storyId: number,\n  views: ApiTypeStoryView[],\n  nextOffset?: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const tabState = selectTabState(global, tabId);\n  const { viewModal } = tabState.storyViewer;\n  const newViews = viewModal?.storyId === storyId && viewModal.views ? [\n    ...viewModal.views,\n    ...views,\n  ] : views;\n\n  global = updateStoryViewsLoading(global, false, tabId);\n\n  return updateTabState(global, {\n    storyViewer: {\n      ...tabState.storyViewer,\n      viewModal: {\n        ...viewModal,\n        storyId,\n        views: newViews,\n        nextOffset,\n        isLoading: false,\n      },\n    },\n  }, tabId);\n}\n\nexport function updateStoryViewsLoading<T extends GlobalState>(\n  global: T,\n  isLoading: boolean,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const tabState = selectTabState(global, tabId);\n  const { viewModal } = tabState.storyViewer;\n  if (!viewModal) return global;\n\n  return updateTabState(global, {\n    storyViewer: {\n      ...tabState.storyViewer,\n      viewModal: {\n        ...viewModal,\n        isLoading,\n      },\n    },\n  }, tabId);\n}\n\nexport function removePeerStory<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  storyId: number,\n): T {\n  const {\n    orderedIds, profileIds, lastReadId, byId,\n  } = selectPeerStories(global, peerId) || { orderedIds: [] as number[], profileIds: [] as number[] };\n\n  const newOrderedIds = orderedIds.filter((id) => id !== storyId);\n  const newProfileIds = profileIds.filter((id) => id !== storyId);\n  const lastStoryId = newOrderedIds.length ? orderedIds[orderedIds.length - 1] : undefined;\n\n  const previousStoryId = orderedIds[orderedIds.indexOf(storyId) - 1];\n  const newLastReadId = lastReadId === storyId ? previousStoryId : lastReadId;\n\n  const newById = {\n    ...byId,\n    [storyId]: { id: storyId, peerId, isDeleted: true } as ApiStoryDeleted,\n  };\n  const lastUpdatedAt = lastStoryId ? (newById[lastStoryId] as ApiStory | undefined)?.date : undefined;\n  const hasStories = Boolean(newOrderedIds.length);\n\n  global = updatePeer(global, peerId, {\n    hasStories,\n    hasUnreadStories: Boolean(hasStories && lastReadId && lastStoryId && lastReadId < lastStoryId),\n  });\n\n  global = updateStoriesForPeer(global, peerId, {\n    byId: newById,\n    orderedIds: newOrderedIds,\n    profileIds: newProfileIds,\n    lastUpdatedAt,\n    lastReadId: newLastReadId,\n  });\n\n  Object.values(global.byTabId).forEach((tab) => {\n    if (tab.storyViewer.lastViewedByPeerId && tab.storyViewer.lastViewedByPeerId[peerId] === storyId) {\n      global = updateLastViewedStoryForPeer(global, peerId, previousStoryId, tab.id);\n    }\n  });\n\n  if (!hasStories) {\n    global = {\n      ...global,\n      stories: {\n        ...global.stories,\n        orderedPeerIds: {\n          active: global.stories.orderedPeerIds.active.filter((id) => id !== peerId),\n          archived: global.stories.orderedPeerIds.archived.filter((id) => id !== peerId),\n        },\n      },\n    };\n  }\n\n  return global;\n}\n\nexport function updateSentStoryReaction<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  storyId: number,\n  reaction: ApiReaction | undefined,\n): T {\n  const story = selectPeerStory(global, peerId, storyId);\n  if (!story || !('content' in story)) return global;\n\n  const { views } = story;\n  const reactionsCount = views?.reactionsCount || 0;\n  const hasReaction = views?.reactions?.some((r) => r.chosenOrder !== undefined);\n  const reactions = updateReactionCount(views?.reactions || [], [reaction].filter(Boolean));\n\n  const countDiff = !reaction ? -1 : hasReaction ? 0 : 1;\n  const newReactionsCount = reactionsCount + countDiff;\n\n  global = updatePeerStory(global, peerId, storyId, {\n    sentReaction: reaction,\n    views: {\n      ...views,\n      reactionsCount: newReactionsCount,\n      reactions,\n    },\n  });\n\n  return global;\n}\n\nexport function updatePeerStory<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  storyId: number,\n  storyUpdate: Partial<ApiStory>,\n): T {\n  const peerStories = selectPeerStories(global, peerId) || {\n    byId: {}, orderedIds: [], profileIds: [], archiveIds: [],\n  };\n\n  return {\n    ...global,\n    stories: {\n      ...global.stories,\n      byPeerId: {\n        ...global.stories.byPeerId,\n        [peerId]: {\n          ...peerStories,\n          byId: {\n            ...peerStories.byId,\n            [storyId]: {\n              ...peerStories.byId[storyId],\n              ...storyUpdate,\n            },\n          },\n        },\n      },\n    },\n  };\n}\n\nexport function updatePeerStoryViews<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  storyId: number,\n  viewsUpdate: Partial<ApiStoryViews>,\n): T {\n  const story = selectPeerStory(global, peerId, storyId);\n  if (!story || !('content' in story)) return global;\n\n  const { views } = story;\n\n  return updatePeerStory(global, peerId, storyId, {\n    views: {\n      ...views,\n      ...viewsUpdate,\n    },\n  });\n}\n\nexport function updatePeerProfileStory<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  storyId: number,\n  isInProfile?: boolean,\n): T {\n  const peerStories = selectPeerStories(global, peerId) || {\n    byId: {}, orderedIds: [], profileIds: [], archiveIds: [],\n  };\n\n  const newProfileIds = isInProfile\n    ? unique(peerStories.profileIds.concat(storyId)).sort((a, b) => b - a)\n    : peerStories.profileIds.filter((id) => storyId !== id);\n\n  return {\n    ...global,\n    stories: {\n      ...global.stories,\n      byPeerId: {\n        ...global.stories.byPeerId,\n        [peerId]: {\n          ...peerStories,\n          profileIds: newProfileIds,\n        },\n      },\n    },\n  };\n}\n\nexport function updatePeerStoriesHidden<T extends GlobalState>(global: T, peerId: string, areHidden: boolean) {\n  const peer = selectPeer(global, peerId);\n  if (!peer) return global;\n\n  const currentState = peer.areStoriesHidden;\n  if (currentState === areHidden) return global; // `updateOrderedStoriesPeerIds` is computationally expensive\n\n  global = updatePeer(global, peerId, {\n    areStoriesHidden: areHidden,\n  });\n\n  return updateOrderedStoriesPeerIds(global, [peerId]);\n}\n\nfunction updateOrderedStoriesPeerIds<T extends GlobalState>(global: T, updatePeerIds: string[]): T {\n  const { currentUserId, stories: { byPeerId, orderedPeerIds } } = global;\n\n  const allPeerIds = orderedPeerIds.active.concat(orderedPeerIds.archived).concat(updatePeerIds);\n  const newOrderedPeerIds = allPeerIds.reduce<{ active: string[]; archived: string[] }>((acc, peerId) => {\n    if (!byPeerId[peerId]?.orderedIds?.length) return acc;\n    const peer = selectPeer(global, peerId);\n\n    if (peer?.areStoriesHidden) {\n      acc.archived.push(peerId);\n    } else {\n      acc.active.push(peerId);\n    }\n\n    return acc;\n  }, { active: [], archived: [] });\n\n  function compare(peerIdA: string, peerIdB: string) {\n    const peerA = selectPeer(global, peerIdA)!;\n    const peerB = selectPeer(global, peerIdB)!;\n\n    const diffCurrentUser = compareFields(currentUserId === peerIdA, currentUserId === peerIdB);\n    if (diffCurrentUser) return diffCurrentUser;\n\n    const { lastUpdatedAt: luaA = 0, orderedIds: orderedA, lastReadId: lriA = 0 } = byPeerId[peerIdA] || {};\n    const hasUnreadA = lriA < orderedA?.[orderedA.length - 1];\n    const { lastUpdatedAt: luaB = 0, orderedIds: orderedB, lastReadId: lriB = 0 } = byPeerId[peerIdB] || {};\n    const hasUnreadB = lriB < orderedB?.[orderedB.length - 1];\n\n    const diffUnread = compareFields(hasUnreadA, hasUnreadB);\n    if (diffUnread) return diffUnread;\n\n    const diffPremium = compareFields('isPremium' in peerA, 'isPremium' in peerB);\n    if (diffPremium) return diffPremium;\n\n    const diffType = compareFields(isUserId(peerIdA), isUserId(peerIdB));\n    if (diffType) return diffType;\n\n    return compareFields(luaA, luaB);\n  }\n\n  newOrderedPeerIds.archived = unique(newOrderedPeerIds.archived)\n    .filter((peerId) => byPeerId[peerId]?.orderedIds?.length)\n    .sort(compare);\n  newOrderedPeerIds.active = unique(newOrderedPeerIds.active)\n    .filter((peerId) => byPeerId[peerId]?.orderedIds?.length)\n    .sort(compare);\n\n  return {\n    ...global,\n    stories: {\n      ...global.stories,\n      orderedPeerIds: newOrderedPeerIds,\n    },\n  };\n}\n\nfunction updatePeerLastUpdatedAt<T extends GlobalState>(global: T, peerId: string): T {\n  const peerStories = global.stories.byPeerId[peerId];\n  const lastUpdatedAt = peerStories.orderedIds.reduce<number | undefined>((acc, storyId) => {\n    const { date } = peerStories.byId[storyId] as ApiStorySkipped || {};\n    if (date && (!acc || acc < date)) {\n      acc = date;\n    }\n\n    return acc;\n  }, undefined);\n\n  return {\n    ...global,\n    stories: {\n      ...global.stories,\n      byPeerId: {\n        ...global.stories.byPeerId,\n        [peerId]: {\n          ...peerStories,\n          lastUpdatedAt,\n        },\n      },\n    },\n  };\n}\n\nexport function updateStealthMode<T extends GlobalState>(\n  global: T,\n  stealthMode: ApiStealthMode,\n): T {\n  return {\n    ...global,\n    stories: {\n      ...global.stories,\n      stealthMode,\n    },\n  };\n}\n","import type { ApiTopic } from '../../api/types';\nimport type { TopicsInfo } from '../../types';\nimport type { GlobalState } from '../types';\n\nimport { buildCollectionByKey, omit, unique } from '../../util/iteratees';\nimport {\n  selectChat, selectTopic, selectTopics,\n  selectTopicsInfo,\n} from '../selectors';\nimport { updateThread, updateThreadInfo } from './messages';\n\nfunction updateTopicsStore<T extends GlobalState>(\n  global: T, chatId: string, update: Partial<TopicsInfo>,\n) {\n  const info = global.chats.topicsInfoById[chatId] || {};\n\n  global = {\n    ...global,\n    chats: {\n      ...global.chats,\n      topicsInfoById: {\n        ...global.chats.topicsInfoById,\n        [chatId]: {\n          ...info,\n          ...update,\n        },\n      },\n    },\n  };\n\n  return global;\n}\n\nexport function updateListedTopicIds<T extends GlobalState>(\n  global: T, chatId: string, topicIds: number[],\n): T {\n  const listedIds = selectTopicsInfo(global, chatId)?.listedTopicIds || [];\n  return updateTopicsStore(global, chatId, {\n    listedTopicIds: unique([\n      ...listedIds,\n      ...topicIds,\n    ]),\n  });\n}\n\nexport function updateTopics<T extends GlobalState>(\n  global: T, chatId: string, topicsCount: number, topics: ApiTopic[],\n): T {\n  const oldTopics = selectTopics(global, chatId);\n  const newTopics = buildCollectionByKey(topics, 'id');\n\n  global = updateTopicsStore(global, chatId, {\n    topicsById: {\n      ...oldTopics,\n      ...newTopics,\n    },\n    totalCount: topicsCount,\n  });\n\n  topics.forEach((topic) => {\n    global = updateThread(global, chatId, topic.id, {\n      firstMessageId: topic.id,\n    });\n\n    global = updateThreadInfo(global, chatId, topic.id, {\n      lastMessageId: topic.lastMessageId,\n      threadId: topic.id,\n      chatId,\n    });\n  });\n\n  return global;\n}\n\nexport function updateTopic<T extends GlobalState>(\n  global: T, chatId: string, topicId: number, update: Partial<ApiTopic>,\n): T {\n  const chat = selectChat(global, chatId);\n\n  if (!chat) return global;\n\n  const topic = selectTopic(global, chatId, topicId);\n  const oldTopics = selectTopics(global, chatId);\n\n  const updatedTopic = {\n    ...topic,\n    ...update,\n  } as ApiTopic;\n\n  if (!updatedTopic.id) return global;\n\n  global = updateTopicsStore(global, chatId, {\n    topicsById: {\n      ...oldTopics,\n      [topicId]: updatedTopic,\n    },\n  });\n\n  global = updateThread(global, chatId, updatedTopic.id, {\n    firstMessageId: updatedTopic.id,\n  });\n\n  global = updateThreadInfo(global, chatId, updatedTopic.id, {\n    lastMessageId: updatedTopic.lastMessageId,\n    threadId: updatedTopic.id,\n    chatId,\n  });\n\n  return global;\n}\n\nexport function deleteTopic<T extends GlobalState>(\n  global: T, chatId: string, topicId: number,\n) {\n  const topics = selectTopics(global, chatId);\n  if (!topics) return global;\n\n  global = updateTopicsStore(global, chatId, {\n    topicsById: omit(topics, [topicId]),\n  });\n\n  return global;\n}\n\nexport function updateTopicLastMessageId<T extends GlobalState>(\n  global: T, chatId: string, threadId: number, lastMessageId: number,\n) {\n  return updateTopic(global, chatId, threadId, {\n    lastMessageId,\n  });\n}\n\nexport function replacePinnedTopicIds<T extends GlobalState>(\n  global: T, chatId: string, pinnedTopicIds: number[],\n) {\n  return updateTopicsStore(global, chatId, {\n    orderedPinnedTopicIds: pinnedTopicIds,\n  });\n}\n","import type { ElementRef, FC } from '../../lib/teact/teact';\nimport {\n  getIsHeavyAnimating,\n  memo,\n  useEffect,\n  useRef,\n  useState,\n  useUnmountCleanup,\n} from '../../lib/teact/teact';\n\nimport type RLottieInstance from '../../lib/rlottie/RLottie';\n\nimport { requestMeasure } from '../../lib/fasterdom/fasterdom';\nimport { ensureRLottie, getRLottie } from '../../lib/rlottie/RLottie.async';\nimport { IS_TAURI } from '../../util/browser/globalEnvironment';\nimport buildClassName from '../../util/buildClassName';\nimport buildStyle from '../../util/buildStyle';\nimport generateUniqueId from '../../util/generateUniqueId';\nimport { hexToRgb } from '../../util/switchTheme';\n\nimport useColorFilter from '../../hooks/stickers/useColorFilter';\nimport useEffectWithPrevDeps from '../../hooks/useEffectWithPrevDeps';\nimport useFlag from '../../hooks/useFlag';\nimport useHeavyAnimation from '../../hooks/useHeavyAnimation';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport usePriorityPlaybackCheck, { isPriorityPlaybackActive } from '../../hooks/usePriorityPlaybackCheck';\nimport useSharedIntersectionObserver from '../../hooks/useSharedIntersectionObserver';\nimport { useStateRef } from '../../hooks/useStateRef';\nimport useSyncEffect from '../../hooks/useSyncEffect';\nimport useThrottledCallback from '../../hooks/useThrottledCallback';\nimport useUniqueId from '../../hooks/useUniqueId';\nimport useBackgroundMode, { isBackgroundModeActive } from '../../hooks/window/useBackgroundMode';\n\nexport type OwnProps = {\n  ref?: ElementRef<HTMLDivElement>;\n  renderId?: string;\n  className?: string;\n  style?: string;\n  tgsUrl?: string;\n  play?: boolean | string;\n  playSegment?: [number, number];\n  speed?: number;\n  noLoop?: boolean;\n  size: number;\n  quality?: number;\n  color?: string;\n  isLowPriority?: boolean;\n  forceAlways?: boolean;\n  forceOnHeavyAnimation?: boolean;\n  sharedCanvas?: HTMLCanvasElement;\n  sharedCanvasCoords?: { x: number; y: number };\n  onClick?: NoneToVoidFunction;\n  onMouseEnter?: NoneToVoidFunction;\n  onMouseLeave?: NoneToVoidFunction;\n  onLoad?: NoneToVoidFunction;\n  onEnded?: NoneToVoidFunction;\n  onLoop?: NoneToVoidFunction;\n};\n\nconst THROTTLE_MS = 150;\n\nconst AnimatedSticker: FC<OwnProps> = ({\n  ref,\n  renderId,\n  className,\n  style,\n  tgsUrl,\n  play,\n  playSegment,\n  speed,\n  noLoop,\n  size,\n  quality,\n  isLowPriority,\n  color,\n  forceAlways,\n  forceOnHeavyAnimation,\n  sharedCanvas,\n  sharedCanvasCoords,\n  onClick,\n  onMouseEnter,\n  onMouseLeave,\n  onLoad,\n  onEnded,\n  onLoop,\n}) => {\n  let containerRef = useRef<HTMLDivElement>();\n  if (ref) {\n    containerRef = ref;\n  }\n\n  const viewId = useUniqueId();\n\n  const [animation, setAnimation] = useState<RLottieInstance>();\n  const animationRef = useRef<RLottieInstance>();\n  const isFirstRender = useRef(true);\n\n  const shouldUseColorFilter = !sharedCanvas && color;\n  const colorFilter = useColorFilter(shouldUseColorFilter ? color : undefined);\n\n  const playKey = play || (play === false ? false : playSegment);\n  const playRef = useStateRef(play);\n  const playSegmentRef = useStateRef(playSegment);\n\n  const rgbColor = useRef<[number, number, number] | undefined>();\n\n  const shouldForceOnHeavyAnimation = forceAlways || forceOnHeavyAnimation;\n  // Delay initialization until heavy animation ends\n  const [\n    canInitialize, markCanInitialize, unmarkCanInitialize,\n  ] = useFlag(!getIsHeavyAnimating() || shouldForceOnHeavyAnimation);\n  useHeavyAnimation(unmarkCanInitialize, markCanInitialize, shouldForceOnHeavyAnimation);\n  useEffect(() => {\n    if (shouldForceOnHeavyAnimation) markCanInitialize();\n  }, [shouldForceOnHeavyAnimation]);\n\n  useSyncEffect(() => {\n    if (color && !shouldUseColorFilter) {\n      const { r, g, b } = hexToRgb(color);\n      rgbColor.current = [r, g, b];\n    } else {\n      rgbColor.current = undefined;\n    }\n  }, [color, shouldUseColorFilter]);\n\n  const isUnmountedRef = useRef(false);\n  useUnmountCleanup(() => {\n    isUnmountedRef.current = true;\n  });\n\n  const init = useLastCallback(() => {\n    if (\n      animationRef.current\n      || isUnmountedRef.current\n      || !tgsUrl\n      || (sharedCanvas && (!sharedCanvasCoords || !sharedCanvas.offsetWidth || !sharedCanvas.offsetHeight))\n      || (getIsHeavyAnimating() && !shouldForceOnHeavyAnimation)\n    ) {\n      return;\n    }\n\n    const container = containerRef.current || sharedCanvas;\n    if (!container) {\n      return;\n    }\n\n    const newAnimation = getRLottie().init(\n      tgsUrl,\n      container,\n      renderId || generateUniqueId(),\n      {\n        size,\n        noLoop,\n        quality,\n        isLowPriority,\n        coords: sharedCanvasCoords,\n      },\n      viewId,\n      rgbColor.current,\n      onLoad,\n      onEnded,\n      onLoop,\n    );\n\n    if (speed) {\n      newAnimation.setSpeed(speed);\n    }\n\n    setAnimation(newAnimation);\n    animationRef.current = newAnimation;\n  });\n\n  useEffect(() => {\n    if (!canInitialize) return;\n    if (getRLottie()) {\n      init();\n    } else {\n      ensureRLottie().then(init);\n    }\n  }, [init, tgsUrl, sharedCanvas, sharedCanvasCoords, canInitialize]);\n\n  const throttledInit = useThrottledCallback(init, [init], THROTTLE_MS);\n  useSharedIntersectionObserver(sharedCanvas, throttledInit);\n\n  useEffect(() => {\n    animation?.setColor(rgbColor.current);\n  }, [color, animation]);\n\n  useEffect(() => {\n    if (typeof speed === 'number') {\n      animation?.setSpeed(speed);\n    }\n  }, [speed, animation]);\n\n  useUnmountCleanup(() => {\n    animationRef.current?.removeView(viewId);\n  });\n\n  const playAnimation = useLastCallback((shouldRestart = false) => {\n    if (\n      !animation\n      || !(playRef.current || playSegmentRef.current)\n      || isFrozen(forceAlways)\n    ) {\n      return;\n    }\n\n    if (playSegmentRef.current) {\n      animation.playSegment(playSegmentRef.current, shouldRestart, viewId);\n    } else {\n      animation.play(shouldRestart, viewId);\n    }\n  });\n\n  const playAnimationOnRaf = useLastCallback(() => {\n    requestMeasure(playAnimation);\n  });\n\n  const pauseAnimation = useLastCallback(() => {\n    if (animation?.isPlaying()) {\n      animation.pause(viewId);\n    }\n  });\n\n  useEffectWithPrevDeps(([prevNoLoop]) => {\n    if (prevNoLoop !== undefined && noLoop !== prevNoLoop) {\n      animation?.setNoLoop(noLoop);\n    }\n  }, [noLoop, animation]);\n\n  useEffectWithPrevDeps(([prevSharedCanvasCoords]) => {\n    if (prevSharedCanvasCoords !== undefined && sharedCanvasCoords !== prevSharedCanvasCoords) {\n      animation?.setSharedCanvasCoords(viewId, sharedCanvasCoords);\n    }\n  }, [sharedCanvasCoords, viewId, animation]);\n\n  useEffect(() => {\n    if (!animation) {\n      return;\n    }\n\n    if (playKey) {\n      if (!isFrozen(forceAlways, forceOnHeavyAnimation)) {\n        playAnimation(noLoop);\n      }\n    } else {\n      pauseAnimation();\n    }\n  }, [animation, playKey, noLoop, playAnimation, pauseAnimation, forceAlways, forceOnHeavyAnimation]);\n\n  useEffect(() => {\n    if (animation) {\n      if (isFirstRender.current) {\n        isFirstRender.current = false;\n      } else if (tgsUrl) {\n        animation.changeData(tgsUrl);\n        playAnimation();\n      }\n    }\n  }, [playAnimation, animation, tgsUrl]);\n\n  useHeavyAnimation(pauseAnimation, playAnimation, !playKey || shouldForceOnHeavyAnimation);\n  usePriorityPlaybackCheck(pauseAnimation, playAnimation, !playKey || forceAlways);\n  // Pausing frame may not happen in background,\n  // so we need to make sure it happens right after focusing,\n  // then we can play again.\n  useBackgroundMode(pauseAnimation, playAnimationOnRaf, !playKey || forceAlways);\n\n  if (sharedCanvas) {\n    return undefined;\n  }\n\n  return (\n    <div\n      ref={containerRef}\n      className={buildClassName('AnimatedSticker', className)}\n      style={buildStyle(\n        size !== undefined && `width: ${size}px; height: ${size}px;`,\n        onClick && !IS_TAURI && 'cursor: pointer',\n        colorFilter,\n        style,\n      )}\n      onClick={onClick}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={onMouseLeave}\n    />\n  );\n};\n\nexport default memo(AnimatedSticker);\n\nfunction isFrozen(forceAlways = false, forceOnHeavyAnimation = false) {\n  if (forceAlways) return false;\n  return (!forceOnHeavyAnimation && getIsHeavyAnimating()) || isPriorityPlaybackActive() || isBackgroundModeActive();\n}\n","import type { AriaRole } from 'react';\nimport type { ElementRef } from '../../../lib/teact/teact';\nimport type React from '../../../lib/teact/teact';\n\nimport type { IconName } from '../../../types/icons';\n\nimport buildClassName from '../../../util/buildClassName';\n\ntype OwnProps = {\n  name: IconName;\n  className?: string;\n  style?: string;\n  role?: AriaRole;\n  ariaLabel?: string;\n  character?: string;\n  ref?: ElementRef<HTMLElement>;\n  onClick?: (e: React.MouseEvent<HTMLDivElement>) => void;\n};\n\nconst Icon = ({\n  name,\n  ref,\n  className,\n  style,\n  role,\n  ariaLabel,\n  character,\n  onClick,\n}: OwnProps) => {\n  return (\n    <i\n      ref={ref}\n      className={buildClassName(`icon icon-${name}`, className)}\n      style={style}\n      aria-hidden={!ariaLabel}\n      aria-label={ariaLabel}\n      data-char={character}\n      role={role}\n      onClick={onClick}\n    />\n  );\n};\n\nexport default Icon;\n","import {\n  type TeactNode,\n  useRef,\n} from '../../lib/teact/teact';\n\nimport { ApiMessageEntityTypes } from '../../api/types';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport useCollapsibleLines from '../../hooks/element/useCollapsibleLines';\nimport useLastCallback from '../../hooks/useLastCallback';\n\nimport Icon from './icons/Icon';\n\nimport styles from './Blockquote.module.scss';\n\ntype OwnProps = {\n  canBeCollapsible?: boolean;\n  isToggleDisabled?: boolean;\n  children: TeactNode;\n};\n\nconst MAX_LINES = 4;\n\nconst Blockquote = ({ canBeCollapsible, isToggleDisabled, children }: OwnProps) => {\n  const ref = useRef<HTMLQuoteElement>();\n  const {\n    isCollapsed, isCollapsible, setIsCollapsed,\n  } = useCollapsibleLines(ref, MAX_LINES, undefined, !canBeCollapsible);\n\n  const canExpand = !isToggleDisabled && isCollapsed;\n\n  const handleExpand = useLastCallback(() => {\n    setIsCollapsed(false);\n  });\n\n  const handleToggle = useLastCallback(() => {\n    setIsCollapsed((prev) => !prev);\n  });\n\n  return (\n    <span\n      className={buildClassName(styles.root, isCollapsed && styles.collapsed)}\n      onClick={canExpand ? handleExpand : undefined}\n    >\n      <blockquote\n        className={styles.blockquote}\n        ref={ref}\n        data-entity-type={ApiMessageEntityTypes.Blockquote}\n      >\n        <div className={styles.gradientContainer}>\n          {children}\n        </div>\n        {isCollapsible && (\n          <div\n            className={buildClassName(styles.collapseIcon, !isToggleDisabled && styles.clickable)}\n            onClick={!isToggleDisabled ? handleToggle : undefined}\n            aria-hidden\n          >\n            <Icon name={isCollapsed ? 'down' : 'up'} />\n          </div>\n        )}\n      </blockquote>\n    </span>\n  );\n};\n\nexport default Blockquote;\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"KU67Uur0\",\"collapsed\":\"y_uRZXtA\",\"blockquote\":\"m3sD7_cn\",\"gradientContainer\":\"JNVT2DU9\",\"collapseIcon\":\"pyX4NpPB\",\"clickable\":\"RmvXwV0W\"};","const PRETTY_BY_ALIAS: Record<string, string | undefined> = {\n  js: 'JavaScript',\n  javascript: 'JavaScript',\n  ts: 'TypeScript',\n  typescript: 'TypeScript',\n  python: 'Python',\n  py: 'Python',\n  go: 'Go',\n  rust: 'Rust',\n  func: 'FunC',\n  c: 'C',\n  'c++': 'C++',\n  cpp: 'C++',\n  fortran: 'Fortran',\n  f90: 'Fortran',\n  f: 'Fortran',\n  java: 'Java',\n  sql: 'SQL',\n  swift: 'Swift',\n  'objective-c': 'Objective-C',\n  kotlin: 'Kotlin',\n  ruby: 'Ruby',\n  rb: 'Ruby',\n  php: 'PHP',\n  perl: 'Perl',\n  bash: 'Bash',\n  sh: 'Shell',\n  markdown: 'Markdown',\n  'c#': 'C#',\n  cs: 'C#',\n  json: 'JSON',\n  yaml: 'YAML',\n  yml: 'YAML',\n  solidity: 'Solidity',\n  sol: 'Solidity',\n  tl: 'TL',\n};\n\nexport function getPrettyCodeLanguageName(codeLanguage: string) {\n  const prettyLangName = PRETTY_BY_ALIAS[codeLanguage.toLowerCase()];\n  return prettyLangName ?? codeLanguage;\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"overlay\":\"pMUccFN9\",\"copy\":\"auCNtLQ4\",\"wrap\":\"a44ZN3hD\",\"wrapOn\":\"jq1KLfVD\",\"content\":\"L95Dh7wN\",\"hidden\":\"zctwFUQ8\"};","import type { FC } from '../../../lib/teact/teact';\nimport {\n  memo, useCallback, useEffect, useRef, useState,\n} from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport buildClassName from '../../../util/buildClassName';\nimport { copyTextToClipboard } from '../../../util/clipboard';\nimport { areLinesWrapping } from '../helpers/renderText';\n\nimport useOldLang from '../../../hooks/useOldLang';\nimport useWindowSize from '../../../hooks/window/useWindowSize';\n\nimport Icon from '../icons/Icon';\n\nimport styles from './CodeOverlay.module.scss';\n\nexport type OwnProps = {\n  className?: string;\n  text: string;\n  noCopy?: boolean;\n  onWordWrapToggle?: (wrap: boolean) => void;\n};\n\nconst CodeOverlay: FC<OwnProps> = ({\n  text, className, noCopy, onWordWrapToggle,\n}) => {\n  const { showNotification } = getActions();\n  const ref = useRef<HTMLDivElement>();\n  const windowSize = useWindowSize();\n  const lang = useOldLang();\n  const [isWordWrap, setIsWordWrap] = useState(true);\n  const [withWordWrapButton, setWithWordWrapButton] = useState(false);\n\n  const checkWordWrap = useCallback(() => {\n    const isWrap = areLinesWrapping(text, ref.current!.parentElement!);\n    setWithWordWrapButton(isWrap);\n  }, [text]);\n\n  useEffect(() => {\n    if (isWordWrap) {\n      checkWordWrap();\n    }\n  }, [checkWordWrap, isWordWrap, text, windowSize]);\n\n  const handleCopy = useCallback(() => {\n    copyTextToClipboard(text);\n    showNotification({\n      message: lang('TextCopied'),\n    });\n  }, [lang, showNotification, text]);\n\n  const handleWordWrapClick = useCallback(() => {\n    setIsWordWrap(!isWordWrap);\n    onWordWrapToggle?.(!isWordWrap);\n  }, [isWordWrap, onWordWrapToggle]);\n\n  const contentClass = buildClassName(styles.content, !withWordWrapButton && noCopy && styles.hidden);\n  const overlayClass = buildClassName(styles.overlay, className);\n  const wrapClass = buildClassName(styles.wrap, isWordWrap && styles.wrapOn);\n\n  return (\n    <div className={overlayClass} ref={ref}>\n      <div className={contentClass}>\n        {withWordWrapButton && (\n          <div className={wrapClass} onClick={handleWordWrapClick} title=\"Word Wrap\">\n            <Icon name=\"word-wrap\" />\n          </div>\n        )}\n        {!noCopy && (\n          <div className={styles.copy} onClick={handleCopy} title={lang('Copy')}>\n            <Icon name=\"copy\" />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default memo(CodeOverlay);\n","import type { FC } from '../../../lib/teact/teact';\nimport { memo, useCallback, useState } from '../../../lib/teact/teact';\n\nimport { ApiMessageEntityTypes } from '../../../api/types';\n\nimport buildClassName from '../../../util/buildClassName';\nimport { getPrettyCodeLanguageName } from '../../../util/prettyCodeLanguageNames';\n\nimport useAsync from '../../../hooks/useAsync';\n\nimport PeerColorWrapper from '../PeerColorWrapper';\nimport CodeOverlay from './CodeOverlay';\n\nimport './CodeBlock.scss';\n\nexport type OwnProps = {\n  text: string;\n  language?: string;\n  noCopy?: boolean;\n};\n\nconst CodeBlock: FC<OwnProps> = ({ text, language, noCopy }) => {\n  const [isWordWrap, setWordWrap] = useState(true);\n\n  const { result: highlighted } = useAsync(() => {\n    if (!language) return Promise.resolve(undefined);\n    return import('../../../util/highlightCode')\n      .then((lib) => lib.default(text, language));\n  }, [language, text]);\n\n  const handleWordWrapToggle = useCallback((wrap) => {\n    setWordWrap(wrap);\n  }, []);\n\n  const blockClass = buildClassName(\n    'code-block',\n    !isWordWrap && 'no-word-wrap',\n  );\n\n  return (\n    <PeerColorWrapper\n      className=\"CodeBlock\"\n    >\n      {language && (<p className=\"code-title\">{getPrettyCodeLanguageName(language)}</p>)}\n      <pre className={blockClass} data-entity-type={ApiMessageEntityTypes.Pre} data-language={language}>\n        {highlighted ?? text}\n        <CodeOverlay\n          text={text}\n          className=\"code-overlay\"\n          onWordWrapToggle={handleWordWrapToggle}\n          noCopy={noCopy}\n        />\n      </pre>\n    </PeerColorWrapper>\n  );\n};\n\nexport default memo(CodeBlock);\n","import type { TeactNode } from '../../../lib/teact/teact';\nimport type React from '../../../lib/teact/teact';\nimport { memo, useEffect, useRef } from '../../../lib/teact/teact';\n\nimport { ApiMessageEntityTypes } from '../../../api/types';\n\nimport { createClassNameBuilder } from '../../../util/buildClassName';\nimport stopEvent from '../../../util/stopEvent';\n\nimport useFlag from '../../../hooks/useFlag';\nimport useLastCallback from '../../../hooks/useLastCallback';\n\nimport './Spoiler.scss';\n\ntype OwnProps = {\n  children?: TeactNode;\n  containerId?: string;\n};\n\nconst revealByContainerId = new Map<string, VoidFunction[]>();\n\nconst buildClassName = createClassNameBuilder('Spoiler');\n\nconst Spoiler = ({\n  children,\n  containerId,\n}: OwnProps) => {\n  const contentRef = useRef<HTMLDivElement>();\n\n  const [isRevealed, revealSpoiler] = useFlag();\n\n  const handleClick = useLastCallback((e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    if (!containerId) return;\n\n    if (!isRevealed) {\n      stopEvent(e);\n    }\n\n    revealByContainerId.get(containerId)?.forEach((reveal) => reveal());\n  });\n\n  useEffect(() => {\n    if (!containerId) {\n      return undefined;\n    }\n\n    if (revealByContainerId.has(containerId)) {\n      revealByContainerId.get(containerId)!.push(revealSpoiler);\n    } else {\n      revealByContainerId.set(containerId, [revealSpoiler]);\n    }\n\n    return () => {\n      revealByContainerId.delete(containerId);\n    };\n  }, [containerId]);\n\n  return (\n    <span\n      className={buildClassName(\n        '&',\n        !isRevealed && 'concealed',\n        !isRevealed && Boolean(containerId) && 'animated',\n      )}\n      onClick={containerId && !isRevealed ? handleClick : undefined}\n      data-entity-type={ApiMessageEntityTypes.Spoiler}\n    >\n      <span className={buildClassName('content')} ref={contentRef}>\n        {children}\n      </span>\n    </span>\n  );\n};\n\nexport default memo(Spoiler);\n","import type { ElementRef } from '../../../lib/teact/teact';\nimport type React from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport type { ApiFormattedText, ApiMessageEntity } from '../../../api/types';\nimport type { ObserveFn } from '../../../hooks/useIntersectionObserver';\nimport type { TextPart, ThreadId } from '../../../types';\nimport type { TextFilter } from './renderText';\nimport { ApiMessageEntityTypes } from '../../../api/types';\n\nimport buildClassName from '../../../util/buildClassName';\nimport { copyTextToClipboard } from '../../../util/clipboard';\nimport { oldTranslate } from '../../../util/oldLangProvider';\nimport { buildCustomEmojiHtmlFromEntity } from '../../middle/composer/helpers/customEmoji';\nimport renderText from './renderText';\n\nimport MentionLink from '../../middle/message/MentionLink';\nimport Blockquote from '../Blockquote';\nimport CodeBlock from '../code/CodeBlock';\nimport CustomEmoji from '../CustomEmoji';\nimport SafeLink from '../SafeLink';\nimport Spoiler from '../spoiler/Spoiler';\n\ninterface IOrganizedEntity {\n  entity: ApiMessageEntity;\n  organizedIndexes: Set<number>;\n  nestedEntities: IOrganizedEntity[];\n}\ntype RenderTextParams = Parameters<typeof renderText>[2];\n\nconst HQ_EMOJI_THRESHOLD = 64;\n\nexport function renderTextWithEntities({\n  text,\n  entities,\n  highlight,\n  emojiSize,\n  shouldRenderAsHtml,\n  containerId,\n  asPreview,\n  isProtected,\n  observeIntersectionForLoading,\n  observeIntersectionForPlaying,\n  withTranslucentThumbs,\n  sharedCanvasRef,\n  sharedCanvasHqRef,\n  cacheBuster,\n  forcePlayback,\n  noCustomEmojiPlayback,\n  isInSelectMode,\n  chatId,\n  messageId,\n  threadId,\n  maxTimestamp,\n}: {\n  text: string;\n  entities?: ApiMessageEntity[];\n  highlight?: string;\n  emojiSize?: number;\n  shouldRenderAsHtml?: boolean;\n  containerId?: string;\n  asPreview?: boolean;\n  isProtected?: boolean;\n  observeIntersectionForLoading?: ObserveFn;\n  observeIntersectionForPlaying?: ObserveFn;\n  withTranslucentThumbs?: boolean;\n  sharedCanvasRef?: ElementRef<HTMLCanvasElement>;\n  sharedCanvasHqRef?: ElementRef<HTMLCanvasElement>;\n  cacheBuster?: string;\n  forcePlayback?: boolean;\n  noCustomEmojiPlayback?: boolean;\n  isInSelectMode?: boolean;\n  chatId?: string;\n  messageId?: number;\n  threadId?: ThreadId;\n  maxTimestamp?: number;\n}) {\n  if (!entities?.length) {\n    return renderMessagePart({\n      content: text,\n      highlight,\n      emojiSize,\n      shouldRenderAsHtml,\n      asPreview,\n    });\n  }\n\n  const result: TextPart[] = [];\n  let deleteLineBreakAfterPre = false;\n\n  const organizedEntities = organizeEntities(entities);\n\n  // Recursive function to render regular and nested entities\n  function renderEntity(\n    textPartStart: number,\n    textPartEnd: number,\n    organizedEntity: IOrganizedEntity,\n    isLastEntity: boolean,\n  ) {\n    const renderResult: TextPart[] = [];\n    const { entity, nestedEntities } = organizedEntity;\n    const { offset, length, type } = entity;\n\n    // Render text before the entity\n    let textBefore = text.substring(textPartStart, offset);\n    const textBeforeLength = textBefore.length;\n    if (textBefore) {\n      if (deleteLineBreakAfterPre && textBefore.length > 0 && textBefore[0] === '\\n') {\n        textBefore = textBefore.substr(1);\n        deleteLineBreakAfterPre = false;\n      }\n      if (textBefore) {\n        renderResult.push(...renderMessagePart({\n          content: textBefore,\n          highlight,\n          emojiSize,\n          shouldRenderAsHtml,\n          asPreview,\n        }));\n      }\n    }\n\n    const entityStartIndex = textPartStart + textBeforeLength;\n    const entityEndIndex = entityStartIndex + length;\n\n    let entityContent: TextPart = text.substring(offset, offset + length);\n    const nestedEntityContent: TextPart[] = [];\n\n    if (deleteLineBreakAfterPre && entityContent.length > 0 && entityContent[0] === '\\n') {\n      entityContent = entityContent.substr(1);\n      deleteLineBreakAfterPre = false;\n    }\n\n    if (type === ApiMessageEntityTypes.Pre) {\n      deleteLineBreakAfterPre = true;\n    }\n\n    // Render nested entities, if any\n    if (nestedEntities.length) {\n      let nestedIndex = entityStartIndex;\n\n      nestedEntities.forEach((nestedEntity, nestedEntityIndex) => {\n        const {\n          renderResult: nestedResult,\n          entityEndIndex: nestedEntityEndIndex,\n        } = renderEntity(\n          nestedIndex,\n          entityEndIndex,\n          nestedEntity,\n          nestedEntityIndex === nestedEntities.length - 1,\n        );\n\n        nestedEntityContent.push(...nestedResult);\n        nestedIndex = nestedEntityEndIndex;\n      });\n    }\n\n    // Render the entity itself\n    const newEntity = shouldRenderAsHtml\n      ? processEntityAsHtml(entity, entityContent, nestedEntityContent)\n      : processEntity({\n        entity,\n        entityContent,\n        nestedEntityContent,\n        highlight,\n        containerId,\n        asPreview,\n        isProtected,\n        observeIntersectionForLoading,\n        observeIntersectionForPlaying,\n        withTranslucentThumbs,\n        emojiSize,\n        sharedCanvasRef,\n        sharedCanvasHqRef,\n        cacheBuster,\n        forcePlayback,\n        noCustomEmojiPlayback,\n        isInSelectMode,\n        chatId,\n        messageId,\n        threadId,\n        maxTimestamp,\n      });\n\n    if (Array.isArray(newEntity)) {\n      renderResult.push(...newEntity);\n    } else {\n      renderResult.push(newEntity);\n    }\n\n    // Render text after the entity, if it is the last entity in the text,\n    // or the last nested entity inside of another entity\n    if (isLastEntity && entityEndIndex < textPartEnd) {\n      let textAfter = text.substring(entityEndIndex, textPartEnd);\n      if (deleteLineBreakAfterPre && textAfter.length > 0 && textAfter[0] === '\\n') {\n        textAfter = textAfter.substring(1);\n      }\n      if (textAfter) {\n        renderResult.push(...renderMessagePart({\n          content: textAfter,\n          highlight,\n          emojiSize,\n          shouldRenderAsHtml,\n          asPreview,\n        }));\n      }\n    }\n\n    return {\n      renderResult,\n      entityEndIndex,\n    };\n  }\n\n  // Process highest-level entities\n  let index = 0;\n\n  organizedEntities.forEach((entity, arrayIndex) => {\n    const { renderResult, entityEndIndex } = renderEntity(\n      index,\n      text.length,\n      entity,\n      arrayIndex === organizedEntities.length - 1,\n    );\n\n    result.push(...renderResult);\n    index = entityEndIndex;\n  });\n\n  return result;\n}\n\nexport function getTextWithEntitiesAsHtml(formattedText?: ApiFormattedText) {\n  const { text, entities } = formattedText || {};\n  if (!text) {\n    return '';\n  }\n\n  const result = renderTextWithEntities({\n    text,\n    entities,\n    shouldRenderAsHtml: true,\n  }) as string[];\n\n  if (Array.isArray(result)) {\n    return result.join('');\n  }\n\n  return result;\n}\n\nfunction renderMessagePart({\n  content,\n  highlight,\n  focusedQuote,\n  emojiSize,\n  shouldRenderAsHtml,\n  asPreview,\n}: {\n  content: TextPart | TextPart[];\n  highlight?: string;\n  focusedQuote?: string;\n  emojiSize?: number;\n  shouldRenderAsHtml?: boolean;\n  asPreview?: boolean;\n}) {\n  if (Array.isArray(content)) {\n    const result: TextPart[] = [];\n\n    content.forEach((c) => {\n      result.push(...renderMessagePart({\n        content: c,\n        highlight,\n        focusedQuote,\n        emojiSize,\n        shouldRenderAsHtml,\n        asPreview,\n      }));\n    });\n\n    return result;\n  }\n\n  if (shouldRenderAsHtml) {\n    return renderText(content, ['escape_html', 'emoji_html', 'br_html']);\n  }\n\n  const emojiFilter = emojiSize && emojiSize > HQ_EMOJI_THRESHOLD ? 'hq_emoji' : 'emoji';\n\n  const filters: TextFilter[] = [emojiFilter];\n  const params: RenderTextParams = {};\n  if (!asPreview) {\n    filters.push('br');\n  }\n\n  if (highlight) {\n    filters.push('highlight');\n    params.highlight = highlight;\n  }\n\n  return renderText(content, filters, params);\n}\n\nexport function insertTextEntity(entities: ApiMessageEntity[], newEntity: ApiMessageEntity) {\n  const resultEntities: ApiMessageEntity[] = [];\n\n  const newEntityStart = newEntity.offset;\n  const newEntityEnd = newEntity.offset + newEntity.length;\n\n  for (const existingEntity of entities) {\n    const existingEntityStart = existingEntity.offset;\n    const existingEntityEnd = existingEntity.offset + existingEntity.length;\n    // Push as is if edges do not overlap\n    if (existingEntityEnd <= newEntityStart\n      || existingEntityStart > newEntityEnd\n      || (existingEntityStart > newEntityStart\n        && existingEntityEnd < newEntityEnd)\n      || (existingEntityStart === newEntityStart && existingEntityEnd === newEntityEnd)) {\n      resultEntities.push(existingEntity);\n      continue;\n    }\n\n    // If start edge overlaps\n    if (existingEntityStart < newEntityStart && existingEntityEnd > newEntityStart) {\n      // Split entity in two\n      resultEntities.push({\n        ...existingEntity,\n        length: newEntityStart - existingEntityStart,\n      });\n      resultEntities.push({\n        ...existingEntity,\n        offset: newEntityStart,\n        length: existingEntityEnd - newEntityStart,\n      });\n    }\n\n    // If end edge overlaps\n    if (existingEntityStart < newEntityEnd\n      && existingEntityEnd > newEntityEnd) {\n      // Split entity in two\n      resultEntities.push({\n        ...existingEntity,\n        offset: newEntityEnd,\n        length: existingEntityEnd - newEntityStart - newEntity.length,\n      });\n      resultEntities.push({\n        ...existingEntity,\n        length: newEntityEnd - existingEntityStart,\n      });\n    }\n  }\n\n  resultEntities.push(newEntity);\n  // Sort entities by offset, longer entities first\n  return resultEntities.sort((a, b) => a.offset - b.offset || b.length - a.length);\n}\n\n// Organize entities in a tree-like structure to better represent how the text will be displayed\nfunction organizeEntities(entities: ApiMessageEntity[]) {\n  const organizedEntityIndexes = new Set<number>();\n  const organizedEntities: IOrganizedEntity[] = [];\n\n  entities.forEach((entity, index) => {\n    if (organizedEntityIndexes.has(index)) {\n      return;\n    }\n\n    const organizedEntity = organizeEntity(entity, index, entities, organizedEntityIndexes);\n    if (organizedEntity) {\n      organizedEntity.organizedIndexes.forEach((organizedIndex) => {\n        organizedEntityIndexes.add(organizedIndex);\n      });\n\n      organizedEntities.push(organizedEntity);\n    }\n  });\n\n  return organizedEntities;\n}\n\nfunction organizeEntity(\n  entity: ApiMessageEntity,\n  index: number,\n  entities: ApiMessageEntity[],\n  organizedEntityIndexes: Set<number>,\n): IOrganizedEntity | undefined {\n  const { offset, length } = entity;\n  const organizedIndexes = new Set([index]);\n\n  if (organizedEntityIndexes.has(index)) {\n    return undefined;\n  }\n\n  // Determine any nested entities inside current entity\n  const nestedEntities: IOrganizedEntity[] = [];\n  const parsedNestedEntities = entities\n    .filter((e, i) => i > index && e.offset >= offset && e.offset < offset + length)\n    .map((e) => organizeEntity(e, entities.indexOf(e), entities, organizedEntityIndexes))\n    .filter(Boolean);\n\n  parsedNestedEntities.forEach((parsedEntity) => {\n    let isChanged = false;\n\n    parsedEntity.organizedIndexes.forEach((organizedIndex) => {\n      if (!isChanged && !organizedIndexes.has(organizedIndex)) {\n        isChanged = true;\n      }\n\n      organizedIndexes.add(organizedIndex);\n    });\n\n    if (isChanged) {\n      nestedEntities.push(parsedEntity);\n    }\n  });\n\n  return {\n    entity,\n    organizedIndexes,\n    nestedEntities,\n  };\n}\n\nfunction processEntity({\n  entity,\n  entityContent,\n  nestedEntityContent,\n  highlight,\n  containerId,\n  asPreview,\n  isProtected,\n  observeIntersectionForLoading,\n  observeIntersectionForPlaying,\n  withTranslucentThumbs,\n  emojiSize,\n  sharedCanvasRef,\n  sharedCanvasHqRef,\n  cacheBuster,\n  forcePlayback,\n  noCustomEmojiPlayback,\n  isInSelectMode,\n  chatId,\n  messageId,\n  threadId,\n  maxTimestamp,\n}: {\n  entity: ApiMessageEntity;\n  entityContent: TextPart;\n  nestedEntityContent: TextPart[];\n  highlight?: string;\n  focusedQuote?: string;\n  containerId?: string;\n  asPreview?: boolean;\n  isProtected?: boolean;\n  observeIntersectionForLoading?: ObserveFn;\n  observeIntersectionForPlaying?: ObserveFn;\n  withTranslucentThumbs?: boolean;\n  emojiSize?: number;\n  sharedCanvasRef?: ElementRef<HTMLCanvasElement>;\n  sharedCanvasHqRef?: ElementRef<HTMLCanvasElement>;\n  cacheBuster?: string;\n  forcePlayback?: boolean;\n  noCustomEmojiPlayback?: boolean;\n  isInSelectMode?: boolean;\n  chatId?: string;\n  messageId?: number;\n  threadId?: ThreadId;\n  maxTimestamp?: number;\n}) {\n  const entityText = typeof entityContent === 'string' && entityContent;\n  const renderedContent = nestedEntityContent.length ? nestedEntityContent : entityContent;\n\n  function renderNestedMessagePart() {\n    return renderMessagePart({\n      content: renderedContent,\n      highlight,\n      emojiSize,\n      asPreview,\n    });\n  }\n\n  if (!entityText) {\n    return renderNestedMessagePart();\n  }\n\n  if (asPreview) {\n    const text = renderNestedMessagePart();\n    if (entity.type === ApiMessageEntityTypes.Spoiler) {\n      return <Spoiler>{text}</Spoiler>;\n    }\n\n    if (entity.type === ApiMessageEntityTypes.CustomEmoji) {\n      return (\n        <CustomEmoji\n          key={cacheBuster ? `${cacheBuster}-${entity.offset}` : undefined}\n          documentId={entity.documentId}\n          size={emojiSize}\n          isSelectable\n          withSharedAnimation\n          sharedCanvasRef={sharedCanvasRef}\n          sharedCanvasHqRef={sharedCanvasHqRef}\n          observeIntersectionForLoading={observeIntersectionForLoading}\n          observeIntersectionForPlaying={observeIntersectionForPlaying}\n          withTranslucentThumb={withTranslucentThumbs}\n          forceAlways={forcePlayback}\n          noPlay={noCustomEmojiPlayback}\n        />\n      );\n    }\n    return text;\n  }\n\n  switch (entity.type) {\n    case ApiMessageEntityTypes.Bold:\n      return <strong data-entity-type={entity.type}>{renderNestedMessagePart()}</strong>;\n    case ApiMessageEntityTypes.Blockquote:\n      return (\n        <Blockquote canBeCollapsible={entity.canCollapse} isToggleDisabled={isInSelectMode}>\n          {renderNestedMessagePart()}\n        </Blockquote>\n      );\n    case ApiMessageEntityTypes.BotCommand:\n      return (\n        <a\n          onClick={handleBotCommandClick}\n          className=\"text-entity-link\"\n          dir=\"auto\"\n          data-entity-type={entity.type}\n        >\n          {renderNestedMessagePart()}\n        </a>\n      );\n    case ApiMessageEntityTypes.Hashtag: {\n      const [tag, username] = entityContent.split('@');\n      return (\n        <a\n          onClick={() => handleHashtagClick(tag, username)}\n          className=\"text-entity-link\"\n          dir=\"auto\"\n          data-entity-type={entity.type}\n        >\n          {renderNestedMessagePart()}\n        </a>\n      );\n    }\n    case ApiMessageEntityTypes.Cashtag: {\n      const [tag, username] = entityContent.split('@');\n      return (\n        <a\n          onClick={() => handleHashtagClick(tag, username)}\n          className=\"text-entity-link\"\n          dir=\"auto\"\n          data-entity-type={entity.type}\n        >\n          {renderNestedMessagePart()}\n        </a>\n      );\n    }\n    case ApiMessageEntityTypes.Code:\n      return (\n        <code\n          className={buildClassName('text-entity-code', 'clickable')}\n          onClick={handleCodeClick}\n          role=\"textbox\"\n          tabIndex={0}\n          data-entity-type={entity.type}\n        >\n          {renderNestedMessagePart()}\n        </code>\n      );\n    case ApiMessageEntityTypes.Email:\n      return (\n        <a\n          href={`mailto:${entityText}`}\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          className=\"text-entity-link\"\n          dir=\"auto\"\n          data-entity-type={entity.type}\n        >\n          {renderNestedMessagePart()}\n        </a>\n      );\n    case ApiMessageEntityTypes.Italic:\n      return <em data-entity-type={entity.type}>{renderNestedMessagePart()}</em>;\n    case ApiMessageEntityTypes.MentionName:\n      return (\n        <MentionLink userId={entity.userId}>\n          {renderNestedMessagePart()}\n        </MentionLink>\n      );\n    case ApiMessageEntityTypes.Mention:\n      return (\n        <MentionLink username={entityText}>\n          {renderNestedMessagePart()}\n        </MentionLink>\n      );\n    case ApiMessageEntityTypes.Phone:\n      return (\n        <a\n          href={`tel:${entityText}`}\n          className=\"text-entity-link\"\n          dir=\"auto\"\n          data-entity-type={entity.type}\n        >\n          {renderNestedMessagePart()}\n        </a>\n      );\n    case ApiMessageEntityTypes.Pre:\n      return <CodeBlock text={entityText} language={entity.language} noCopy={isProtected} />;\n    case ApiMessageEntityTypes.Strike:\n      return <del data-entity-type={entity.type}>{renderNestedMessagePart()}</del>;\n    case ApiMessageEntityTypes.TextUrl:\n    case ApiMessageEntityTypes.Url:\n      return (\n        <SafeLink\n          url={getLinkUrl(entityText, entity)}\n          text={entityText}\n          chatId={chatId}\n          messageId={messageId}\n          threadId={threadId}\n          entityType={entity.type}\n        >\n          {renderNestedMessagePart()}\n        </SafeLink>\n      );\n    case ApiMessageEntityTypes.Underline:\n      return <ins data-entity-type={entity.type}>{renderNestedMessagePart()}</ins>;\n    case ApiMessageEntityTypes.Timestamp:\n      if (!chatId || !messageId || !maxTimestamp || entity.timestamp > maxTimestamp) {\n        return renderNestedMessagePart();\n      }\n\n      return (\n        <a\n          onClick={() => handleTimecodeClick(chatId, messageId, threadId, entity.timestamp)}\n          className=\"text-entity-link\"\n          dir=\"auto\"\n          data-entity-type={entity.type}\n        >\n          {renderNestedMessagePart()}\n        </a>\n      );\n    case ApiMessageEntityTypes.Spoiler:\n      return <Spoiler containerId={containerId}>{renderNestedMessagePart()}</Spoiler>;\n    case ApiMessageEntityTypes.CustomEmoji:\n      return (\n        <CustomEmoji\n          key={cacheBuster ? `${cacheBuster}-${entity.offset}` : undefined}\n          documentId={entity.documentId}\n          size={emojiSize}\n          isSelectable\n          withSharedAnimation\n          sharedCanvasRef={sharedCanvasRef}\n          sharedCanvasHqRef={sharedCanvasHqRef}\n          observeIntersectionForLoading={observeIntersectionForLoading}\n          observeIntersectionForPlaying={observeIntersectionForPlaying}\n          withTranslucentThumb={withTranslucentThumbs}\n          forceAlways={forcePlayback}\n          noPlay={noCustomEmojiPlayback}\n        />\n      );\n    case ApiMessageEntityTypes.QuoteFocus:\n      return (\n        <span className=\"matching-text-highlight is-quote\">{renderNestedMessagePart()}</span>\n      );\n    default:\n      return renderNestedMessagePart();\n  }\n}\n\nfunction processEntityAsHtml(\n  entity: ApiMessageEntity,\n  entityContent: TextPart,\n  nestedEntityContent: TextPart[],\n) {\n  const rawEntityText = typeof entityContent === 'string' ? entityContent : undefined;\n\n  // Prevent adding newlines when editing\n  const content = entity.type === ApiMessageEntityTypes.Pre ? (entityContent as string).trimEnd() : entityContent;\n\n  const renderedContent = nestedEntityContent.length\n    ? (nestedEntityContent as string[]).join('')\n    : (renderText(content, ['escape_html', 'emoji_html', 'br_html']) as string[]).join('');\n\n  if (!rawEntityText) {\n    return renderedContent;\n  }\n\n  switch (entity.type) {\n    case ApiMessageEntityTypes.Bold:\n      return `<b>${renderedContent}</b>`;\n    case ApiMessageEntityTypes.Italic:\n      return `<i>${renderedContent}</i>`;\n    case ApiMessageEntityTypes.Underline:\n      return `<u>${renderedContent}</u>`;\n    case ApiMessageEntityTypes.Code:\n      return `<code class=\"text-entity-code\">${renderedContent}</code>`;\n    case ApiMessageEntityTypes.Pre:\n      // eslint-disable-next-line @stylistic/max-len\n      return `\\`\\`\\`${renderText(entity.language || '', ['escape_html'])[0] as string}<br/>${renderedContent}<br/>\\`\\`\\`<br/>`;\n    case ApiMessageEntityTypes.Strike:\n      return `<del>${renderedContent}</del>`;\n    case ApiMessageEntityTypes.MentionName:\n      return `<a\n        class=\"text-entity-link\"\n        data-entity-type=\"${ApiMessageEntityTypes.MentionName}\"\n        data-user-id=\"${entity.userId}\"\n        contenteditable=\"false\"\n        dir=\"auto\"\n      >${renderedContent}</a>`;\n    case ApiMessageEntityTypes.Url:\n    case ApiMessageEntityTypes.TextUrl:\n      return `<a\n        class=\"text-entity-link\"\n        href=${getLinkUrl(rawEntityText, entity)}\n        data-entity-type=\"${entity.type}\"\n        dir=\"auto\"\n      >${renderedContent}</a>`;\n    case ApiMessageEntityTypes.Spoiler:\n      return `<span\n        class=\"spoiler\"\n        data-entity-type=\"${ApiMessageEntityTypes.Spoiler}\"\n        >${renderedContent}</span>`;\n    case ApiMessageEntityTypes.CustomEmoji:\n      return buildCustomEmojiHtmlFromEntity(rawEntityText, entity);\n    case ApiMessageEntityTypes.Blockquote:\n      return `<blockquote\n        class=\"blockquote\"\n        data-entity-type=\"${ApiMessageEntityTypes.Blockquote}\"\n        >${renderedContent}</blockquote>`;\n    default:\n      return renderedContent;\n  }\n}\n\nfunction getLinkUrl(entityContent: string, entity: ApiMessageEntity) {\n  const { type } = entity;\n  return type === ApiMessageEntityTypes.TextUrl && entity.url ? entity.url : entityContent;\n}\n\nfunction handleBotCommandClick(e: React.MouseEvent<HTMLAnchorElement>) {\n  getActions().sendBotCommand({ command: e.currentTarget.innerText });\n}\n\nfunction handleHashtagClick(hashtag?: string, username?: string) {\n  if (!hashtag) return;\n  if (username) {\n    getActions().openChatByUsername({\n      username,\n      onChatChanged: {\n        action: 'searchHashtag',\n        payload: { hashtag },\n      },\n    });\n    return;\n  }\n  getActions().searchHashtag({ hashtag });\n}\n\nfunction handleCodeClick(e: React.MouseEvent<HTMLElement>) {\n  copyTextToClipboard(e.currentTarget.innerText);\n  getActions().showNotification({\n    message: oldTranslate('TextCopied'),\n  });\n}\n\nfunction handleTimecodeClick(\n  chatId: string, messageId: number, threadId: ThreadId | undefined, timestamp: number,\n) {\n  getActions().openMediaFromTimestamp({\n    chatId, messageId, threadId, timestamp,\n  });\n}\n","import { memo } from '../../lib/teact/teact';\nimport { withGlobal } from '../../global';\n\nimport type {\n  ApiFormattedText, ApiMessage, ApiPoll, ApiTypeStory,\n  ApiWebPage,\n} from '../../api/types';\nimport type { ObserveFn } from '../../hooks/useIntersectionObserver';\n\nimport {\n  extractMessageText,\n  getMessagePollId,\n  groupStatefulContent,\n  isActionMessage,\n} from '../../global/helpers';\nimport {\n  getMessageSummaryDescription,\n  getMessageSummaryEmoji,\n  getMessageSummaryText,\n  TRUNCATED_SUMMARY_LENGTH,\n} from '../../global/helpers/messageSummary';\nimport { selectPeerStory, selectPollFromMessage, selectWebPageFromMessage } from '../../global/selectors';\nimport trimText from '../../util/trimText';\nimport renderText from './helpers/renderText';\n\nimport useLang from '../../hooks/useLang';\n\nimport ActionMessageText from '../middle/message/ActionMessageText';\nimport MessageText from './MessageText';\n\ntype OwnProps = {\n  message: ApiMessage;\n  translatedText?: ApiFormattedText;\n  noEmoji?: boolean;\n  highlight?: string;\n  truncateLength?: number;\n  withTranslucentThumbs?: boolean;\n  inChatList?: boolean;\n  emojiSize?: number;\n  observeIntersectionForLoading?: ObserveFn;\n  observeIntersectionForPlaying?: ObserveFn;\n};\n\ntype StateProps = {\n  poll?: ApiPoll;\n  story?: ApiTypeStory;\n  webPage?: ApiWebPage;\n};\n\nfunction MessageSummary({\n  message,\n  translatedText,\n  noEmoji,\n  highlight,\n  truncateLength = TRUNCATED_SUMMARY_LENGTH,\n  withTranslucentThumbs,\n  inChatList,\n  emojiSize,\n  poll,\n  story,\n  webPage,\n  observeIntersectionForLoading,\n  observeIntersectionForPlaying,\n}: OwnProps & StateProps) {\n  const lang = useLang();\n  const extractedText = extractMessageText(message, inChatList);\n  const hasPoll = Boolean(getMessagePollId(message));\n  const isAction = isActionMessage(message);\n\n  const statefulContent = groupStatefulContent({ poll, story, webPage });\n\n  if (!extractedText && !hasPoll && !isAction) {\n    const summaryText = translatedText?.text\n      || getMessageSummaryText(lang, message, statefulContent, noEmoji, truncateLength);\n    const trimmedText = trimText(summaryText, truncateLength);\n\n    return (\n      <span>\n        {highlight ? (\n          renderText(trimmedText, ['emoji', 'highlight'], { highlight })\n        ) : (\n          renderText(trimmedText)\n        )}\n      </span>\n    );\n  }\n\n  function renderMessageText() {\n    if (isAction) {\n      return <ActionMessageText message={message} asPreview />;\n    }\n\n    return (\n      <MessageText\n        messageOrStory={message}\n        translatedText={translatedText}\n        highlight={highlight}\n        asPreview\n        observeIntersectionForLoading={observeIntersectionForLoading}\n        observeIntersectionForPlaying={observeIntersectionForPlaying}\n        withTranslucentThumbs={withTranslucentThumbs}\n        truncateLength={truncateLength}\n        inChatList={inChatList}\n        emojiSize={emojiSize}\n      />\n    );\n  }\n\n  const emoji = !noEmoji && getMessageSummaryEmoji(message);\n\n  return (\n    <>\n      {[\n        emoji ? renderText(`${emoji} `) : undefined,\n        getMessageSummaryDescription(lang, message, statefulContent, renderMessageText()),\n      ].flat().filter(Boolean)}\n    </>\n  );\n}\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { message }): Complete<StateProps> => {\n    const poll = selectPollFromMessage(global, message);\n    const webPage = selectWebPageFromMessage(global, message);\n    const storyData = message.content.storyData;\n    const story = storyData && selectPeerStory(global, storyData.peerId, storyData.id);\n\n    return {\n      poll,\n      story,\n      webPage,\n    };\n  },\n)(MessageSummary));\n","import { useRef } from '../lib/teact/teact';\n\nimport type { Signal } from '../util/signals';\n\nimport useForceUpdate from './useForceUpdate';\nimport { useSignalEffect } from './useSignalEffect';\nimport { useStateRef } from './useStateRef';\nimport useSyncEffect from './useSyncEffect';\n\ntype SyncResolver<T> = () => T;\ntype AsyncResolver<T> = (setter: (newValue: T) => void) => void;\ntype Resolver<T> =\n  SyncResolver<T>\n  | AsyncResolver<T>;\n\nfunction useDerivedState<T>(resolver: SyncResolver<T>, dependencies: readonly any[]): T;\nfunction useDerivedState<T>(resolver: AsyncResolver<T>, dependencies: readonly any[], isAsync: true): T;\nfunction useDerivedState<T>(signal: Signal<T>): T;\n\nfunction useDerivedState<T>(resolverOrSignal: Resolver<T> | T, dependencies?: readonly any[], isAsync = false) {\n  const resolver = dependencies ? resolverOrSignal as Resolver<T> : () => ((resolverOrSignal as Signal<T>)());\n  dependencies ??= [resolverOrSignal];\n\n  const valueRef = useRef<T>();\n  const forceUpdate = useForceUpdate();\n  const resolverRef = useStateRef(resolver);\n\n  function runCurrentResolver(isSync = false) {\n    const currentResolver = resolverRef.current;\n    if (isAsync) {\n      (currentResolver as AsyncResolver<T>)((newValue) => {\n        if (valueRef.current !== newValue) {\n          valueRef.current = newValue;\n          forceUpdate();\n        }\n      });\n    } else {\n      const newValue = (currentResolver as SyncResolver<T>)();\n      if (valueRef.current !== newValue) {\n        valueRef.current = newValue;\n\n        if (!isSync) {\n          forceUpdate();\n        }\n      }\n    }\n  }\n\n  useSyncEffect(() => {\n    runCurrentResolver(true);\n    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  }, dependencies);\n\n  useSignalEffect(runCurrentResolver, dependencies);\n\n  return valueRef.current as T;\n}\n\nexport default useDerivedState;\n","const cache = new WeakMap<AnyFunction, Map<string, any>>();\n\nexport default function withCache<T extends AnyFunction>(fn: T) {\n  return (...args: Parameters<T>): ReturnType<T> => {\n    let fnCache = cache.get(fn);\n    const cacheKey = args.map(String).join('_');\n\n    if (fnCache) {\n      const cached = fnCache.get(cacheKey);\n      if (cached) {\n        return cached;\n      }\n    } else {\n      fnCache = new Map();\n      cache.set(fn, fnCache);\n    }\n\n    const newValue = fn(...args);\n\n    fnCache.set(cacheKey, newValue);\n\n    return newValue;\n  };\n}\n","import type {\n  ApiChat,\n  ApiInputMessageReplyInfo,\n  ApiMessage,\n  ApiMessageEntityCustomEmoji,\n  ApiMessageForwardInfo,\n  ApiMessageOutgoingStatus,\n  ApiPeer, ApiRestrictionReason, ApiSponsoredMessage,\n  ApiStickerSetInfo,\n  MediaContainer,\n} from '../../api/types';\nimport type {\n  ChatTranslatedMessages,\n  MessageListType,\n  TabThread,\n  Thread,\n  ThreadId,\n} from '../../types';\nimport type { IAllowedAttachmentOptions } from '../helpers';\nimport type {\n  GlobalState, TabArgs,\n} from '../types';\nimport { ApiMessageEntityTypes, MAIN_THREAD_ID } from '../../api/types';\n\nimport {\n  ANONYMOUS_USER_ID, GENERAL_TOPIC_ID, SERVICE_NOTIFICATIONS_USER_ID,\n  WEB_APP_PLATFORM,\n} from '../../config';\nimport { IS_TRANSLATION_SUPPORTED } from '../../util/browser/windowEnvironment';\nimport { isUserId } from '../../util/entities/ids';\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { findLast } from '../../util/iteratees';\nimport { getMessageKey, isLocalMessageId } from '../../util/keys/messageKey';\nimport { isIpRevealingMedia } from '../../util/media/ipRevealingMedia';\nimport { MEMO_EMPTY_ARRAY } from '../../util/memo';\nimport { getServerTime } from '../../util/serverTime';\nimport { getDocumentExtension } from '../../components/common/helpers/documentInfo';\nimport { API_GENERAL_ID_LIMIT } from '../../limits';\nimport {\n  canSendReaction,\n  getAllowedAttachmentOptions,\n  getCanPostInChat,\n  getHasAdminRight,\n  getIsSavedDialog,\n  getMessageAudio,\n  getMessageDocument,\n  getMessageLink,\n  getMessagePaidMedia,\n  getMessagePhoto,\n  getMessageVideo,\n  getMessageVoice,\n  getSendingState,\n  getWebPagePhoto,\n  getWebPageVideo,\n  hasMessageTtl,\n  isActionMessage,\n  isChatBasicGroup,\n  isChatChannel,\n  isChatGroup,\n  isChatSuperGroup,\n  isCommonBoxChat,\n  isExpiredMessage,\n  isForwardedMessage,\n  isMessageDocumentSticker,\n  isMessageFailed,\n  isMessageLocal,\n  isMessageTranslatable,\n  isOwnMessage,\n  isServiceNotificationMessage,\n  isUserRightBanned,\n} from '../helpers';\nimport { getMessageReplyInfo } from '../helpers/replies';\nimport {\n  selectChat,\n  selectChatFullInfo,\n  selectChatLastMessageId,\n  selectIsChatRestricted,\n  selectIsChatWithBot,\n  selectIsChatWithSelf,\n  selectRequestedChatTranslationLanguage,\n} from './chats';\nimport { selectCurrentLimit } from './limits';\nimport { selectMessageDownloadableMedia } from './media';\nimport { selectPeer, selectPeerPaidMessagesStars } from './peers';\nimport { selectPeerStory } from './stories';\nimport { selectCustomEmoji, selectIsStickerFavorite } from './symbols';\nimport { selectTabState } from './tabs';\nimport { selectTopic } from './topics';\nimport {\n  selectBot, selectUser, selectUserStatus,\n} from './users';\n\nexport function selectCurrentMessageList<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageLists } = selectTabState(global, tabId);\n\n  if (messageLists.length) {\n    return messageLists[messageLists.length - 1];\n  }\n\n  return undefined;\n}\n\nexport function selectCurrentChat<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { chatId } = selectCurrentMessageList(global, tabId) || {};\n\n  return chatId ? selectChat(global, chatId) : undefined;\n}\n\nexport function selectChatMessages<T extends GlobalState>(global: T, chatId: string) {\n  return global.messages.byChatId[chatId]?.byId;\n}\n\nexport function selectChatScheduledMessages<T extends GlobalState>(global: T, chatId: string) {\n  return global.scheduledMessages.byChatId[chatId]?.byId;\n}\n\nexport function selectTabThreadParam<T extends GlobalState, K extends keyof TabThread>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  key: K,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).tabThreads[chatId]?.[threadId]?.[key];\n}\n\nexport function selectThreadParam<T extends GlobalState, K extends keyof Thread>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  key: K,\n) {\n  return selectThread(global, chatId, threadId)?.[key];\n}\n\nexport function selectThread<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n) {\n  const messageInfo = global.messages.byChatId[chatId];\n  if (!messageInfo) {\n    return undefined;\n  }\n\n  const thread = messageInfo.threadsById[threadId];\n  if (!thread) {\n    return undefined;\n  }\n\n  return thread;\n}\n\nexport function selectListedIds<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'listedIds');\n}\n\nexport function selectOutlyingListByMessageId<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId, messageId: number,\n) {\n  const outlyingLists = selectOutlyingLists(global, chatId, threadId);\n  if (!outlyingLists) {\n    return undefined;\n  }\n\n  return outlyingLists.find((list) => {\n    return list[0] <= messageId && list[list.length - 1] >= messageId;\n  });\n}\n\nexport function selectOutlyingLists<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId,\n) {\n  return selectThreadParam(global, chatId, threadId, 'outlyingLists');\n}\n\nexport function selectCurrentMessageIds<T extends GlobalState>(\n  global: T,\n  chatId: string, threadId: ThreadId, messageListType: MessageListType,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  switch (messageListType) {\n    case 'thread':\n      return selectViewportIds(global, chatId, threadId, tabId);\n    case 'pinned':\n      return selectPinnedIds(global, chatId, threadId);\n    case 'scheduled':\n      return selectScheduledIds(global, chatId, threadId);\n  }\n\n  return undefined;\n}\n\nexport function selectViewportIds<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabThreadParam(global, chatId, threadId, 'viewportIds', tabId);\n}\n\nexport function selectPinnedIds<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'pinnedIds');\n}\n\nexport function selectScheduledIds<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'scheduledIds');\n}\n\nexport function selectScrollOffset<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabThreadParam(global, chatId, threadId, 'scrollOffset', tabId);\n}\n\nexport function selectLastScrollOffset<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'lastScrollOffset');\n}\n\nexport function selectEditingId<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'editingId');\n}\n\nexport function selectEditingDraft<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'editingDraft');\n}\n\nexport function selectEditingScheduledId<T extends GlobalState>(global: T, chatId: string) {\n  return selectThreadParam(global, chatId, MAIN_THREAD_ID, 'editingScheduledId');\n}\n\nexport function selectEditingScheduledDraft<T extends GlobalState>(global: T, chatId: string) {\n  return selectThreadParam(global, chatId, MAIN_THREAD_ID, 'editingScheduledDraft');\n}\n\nexport function selectDraft<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'draft');\n}\n\nexport function selectNoWebPage<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'noWebPage');\n}\n\nexport function selectThreadInfo<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'threadInfo');\n}\n\nexport function selectFirstMessageId<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'firstMessageId');\n}\n\nexport function selectReplyStack<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabThreadParam(global, chatId, threadId, 'replyStack', tabId);\n}\n\nexport function selectThreadMessagesCount(global: GlobalState, chatId: string, threadId: ThreadId) {\n  const chat = selectChat(global, chatId);\n  const threadInfo = selectThreadInfo(global, chatId, threadId);\n  if (!chat || !threadInfo || threadInfo.messagesCount === undefined) return undefined;\n  // In forum topics first message is ignored, but not in General\n  if (chat.isForum && threadId !== GENERAL_TOPIC_ID) return threadInfo.messagesCount - 1;\n  return threadInfo.messagesCount;\n}\n\nexport function selectThreadByMessage<T extends GlobalState>(global: T, message: ApiMessage) {\n  const threadId = selectThreadIdFromMessage(global, message);\n  if (!threadId || threadId === MAIN_THREAD_ID) {\n    return undefined;\n  }\n\n  return global.messages.byChatId[message.chatId].threadsById[threadId];\n}\n\nexport function selectIsMessageInCurrentMessageList<T extends GlobalState>(\n  global: T, chatId: string, message: ApiMessage,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const currentMessageList = selectCurrentMessageList(global, tabId);\n  if (!currentMessageList) {\n    return false;\n  }\n\n  const { threadInfo } = selectThreadByMessage(global, message) || {};\n  return (\n    chatId === currentMessageList.chatId\n    && (\n      (currentMessageList.threadId === MAIN_THREAD_ID)\n      || (threadInfo && currentMessageList.threadId === threadInfo.threadId)\n    )\n  );\n}\n\nexport function selectIsViewportNewest<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const viewportIds = selectViewportIds(global, chatId, threadId, tabId);\n  if (!viewportIds || !viewportIds.length) {\n    return true;\n  }\n\n  const isSavedDialog = getIsSavedDialog(chatId, threadId, global.currentUserId);\n\n  let lastMessageId: number;\n\n  if (threadId === MAIN_THREAD_ID) {\n    const id = selectChatLastMessageId(global, chatId);\n    if (!id) {\n      return true;\n    }\n    lastMessageId = id;\n  } else if (isSavedDialog) {\n    const id = selectChatLastMessageId(global, String(threadId), 'saved');\n    if (!id) {\n      return true;\n    }\n    lastMessageId = id;\n  } else {\n    const threadInfo = selectThreadInfo(global, chatId, threadId);\n    if (!threadInfo || !threadInfo.lastMessageId) {\n      if (!threadInfo?.threadId) return undefined;\n      // No messages in thread, except for the thread message itself\n      lastMessageId = Number(threadInfo?.threadId);\n    } else {\n      lastMessageId = threadInfo.lastMessageId;\n    }\n  }\n\n  // Edge case: outgoing `lastMessage` is updated with a delay to optimize animation\n  if (isLocalMessageId(lastMessageId) && !selectChatMessage(global, chatId, lastMessageId)) {\n    return true;\n  }\n\n  return viewportIds[viewportIds.length - 1] >= lastMessageId;\n}\n\nexport function selectChatMessage<T extends GlobalState>(global: T, chatId: string, messageId: number) {\n  const chatMessages = selectChatMessages(global, chatId);\n\n  return chatMessages ? chatMessages[messageId] : undefined;\n}\n\nexport function selectScheduledMessage<T extends GlobalState>(global: T, chatId: string, messageId: number) {\n  const chatMessages = selectChatScheduledMessages(global, chatId);\n\n  return chatMessages ? chatMessages[messageId] : undefined;\n}\n\nexport function selectQuickReplyMessage<T extends GlobalState>(global: T, messageId: number) {\n  return global.quickReplies.messagesById[messageId];\n}\n\nexport function selectEditingMessage<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId, messageListType: MessageListType,\n) {\n  if (messageListType === 'scheduled') {\n    const messageId = selectEditingScheduledId(global, chatId);\n    return messageId ? selectScheduledMessage(global, chatId, messageId) : undefined;\n  } else {\n    const messageId = selectEditingId(global, chatId, threadId);\n    return messageId ? selectChatMessage(global, chatId, messageId) : undefined;\n  }\n}\n\nexport function selectFocusedMessageId<T extends GlobalState>(\n  global: T, chatId: string, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { chatId: focusedChatId, messageId } = selectTabState(global, tabId).focusedMessage || {};\n\n  return focusedChatId === chatId ? messageId : undefined;\n}\n\nexport function selectIsMessageFocused<T extends GlobalState>(\n  global: T, message: ApiMessage, currentThreadId: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const focusedId = selectFocusedMessageId(global, message.chatId, tabId);\n  const threadId = selectTabState(global, tabId).focusedMessage?.threadId;\n\n  if (currentThreadId !== threadId) return false;\n\n  return focusedId ? focusedId === message.id || focusedId === message.previousLocalId : false;\n}\n\nexport function selectIsMessageUnread<T extends GlobalState>(global: T, message: ApiMessage) {\n  const { lastReadOutboxMessageId } = selectChat(global, message.chatId) || {};\n  return isMessageLocal(message) || !lastReadOutboxMessageId || lastReadOutboxMessageId < message.id;\n}\n\nexport function selectOutgoingStatus<T extends GlobalState>(\n  global: T, message: ApiMessage, isScheduledList = false,\n): ApiMessageOutgoingStatus {\n  if (!selectIsMessageUnread(global, message) && !isScheduledList) {\n    return 'read';\n  }\n\n  return getSendingState(message);\n}\n\nexport function selectSender<T extends GlobalState>(global: T, message: ApiMessage): ApiPeer | undefined {\n  const { senderId } = message;\n  const chat = selectChat(global, message.chatId);\n  const currentUser = selectUser(global, global.currentUserId!);\n  if (!senderId) {\n    return message.isOutgoing ? currentUser : chat;\n  }\n\n  if (chat && isChatChannel(chat) && !chat.areProfilesShown) return chat;\n\n  return selectPeer(global, senderId);\n}\n\nexport function getSendersFromSelectedMessages<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  messageIds: number[],\n) {\n  return messageIds.map((id) => {\n    const message = selectChatMessage(global, chatId, id);\n    return message && selectSender(global, message);\n  }).filter(Boolean);\n}\n\nexport function selectSenderFromMessage<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  messageId: number,\n): ApiPeer | undefined {\n  const message = selectChatMessage(global, chatId, messageId);\n\n  return message && selectSender(global, message);\n}\n\nexport function selectSenderFromHeader<T extends GlobalState>(\n  global: T,\n  header: ApiMessageForwardInfo,\n) {\n  const { fromId } = header;\n  if (fromId) {\n    return selectPeer(global, fromId);\n  }\n\n  return undefined;\n}\n\nexport function selectForwardedSender<T extends GlobalState>(\n  global: T, message: ApiMessage,\n): ApiPeer | undefined {\n  const isStoryForward = Boolean(message.content.storyData);\n  if (isStoryForward) {\n    const peerId = message.content.storyData!.peerId;\n    return selectPeer(global, peerId);\n  }\n\n  const { forwardInfo } = message;\n  if (!forwardInfo) {\n    return undefined;\n  }\n\n  if (forwardInfo.isChannelPost && forwardInfo.fromChatId) {\n    return selectChat(global, forwardInfo.fromChatId);\n  }\n\n  if (forwardInfo.hiddenUserName) {\n    return undefined;\n  }\n\n  if (forwardInfo.fromId) {\n    return selectPeer(global, forwardInfo.fromId);\n  }\n\n  if (forwardInfo.savedFromPeerId) {\n    return selectPeer(global, forwardInfo.savedFromPeerId);\n  }\n\n  return undefined;\n}\n\nexport function selectPoll<T extends GlobalState>(global: T, pollId: string) {\n  return global.messages.pollById[pollId];\n}\n\nexport function selectPollFromMessage<T extends GlobalState>(global: T, message: MediaContainer) {\n  if (!message.content.pollId) return undefined;\n  return selectPoll(global, message.content.pollId);\n}\n\nexport function selectWebPage<T extends GlobalState>(global: T, webPageId: string) {\n  return global.messages.webPageById[webPageId];\n}\n\nexport function selectWebPageFromMessage<T extends GlobalState>(global: T, message: MediaContainer) {\n  if (!message.content.webPage) return undefined;\n  return selectWebPage(global, message.content.webPage.id);\n}\n\nexport function selectFullWebPage<T extends GlobalState>(global: T, webPageId: string) {\n  const webPage = selectWebPage(global, webPageId);\n  if (!webPage || webPage.webpageType !== 'full') return undefined;\n  return webPage;\n}\n\nexport function selectFullWebPageFromMessage<T extends GlobalState>(global: T, message: MediaContainer) {\n  if (!message.content.webPage) return undefined;\n  return selectFullWebPage(global, message.content.webPage.id);\n}\n\nexport function selectTopicFromMessage<T extends GlobalState>(global: T, message: ApiMessage) {\n  const { chatId } = message;\n  const chat = selectChat(global, chatId);\n  if (!chat?.isForum) return undefined;\n\n  const threadId = selectThreadIdFromMessage(global, message);\n  return selectTopic(global, chatId, threadId);\n}\n\nconst MAX_MESSAGES_TO_DELETE_OWNER_TOPIC = 10;\nexport function selectCanDeleteOwnerTopic<T extends GlobalState>(global: T, chatId: string, topicId: number) {\n  const topic = selectTopic(global, chatId, topicId);\n  if (topic && !topic.isOwner) return false;\n\n  const thread = selectThread(global, chatId, topicId);\n  if (!thread) return false;\n\n  const { listedIds } = thread;\n  if (!listedIds\n    // Plus one for root message\n    || listedIds.length + 1 >= MAX_MESSAGES_TO_DELETE_OWNER_TOPIC) {\n    return false;\n  }\n\n  const hasNotOutgoingMessages = listedIds.some((messageId) => {\n    const message = selectChatMessage(global, chatId, messageId);\n    return !message || !message.isOutgoing;\n  });\n\n  return !hasNotOutgoingMessages;\n}\n\nexport function selectCanDeleteTopic<T extends GlobalState>(global: T, chatId: string, topicId: number) {\n  const chat = selectChat(global, chatId);\n  if (!chat) return false;\n\n  if (topicId === GENERAL_TOPIC_ID) return false;\n\n  return chat.isCreator\n    || getHasAdminRight(chat, 'deleteMessages')\n    || (chat.isForum\n      && selectCanDeleteOwnerTopic(global, chat.id, topicId));\n}\n\nexport function selectSavedDialogIdFromMessage<T extends GlobalState>(\n  global: T, message: ApiMessage,\n): string | undefined {\n  const {\n    chatId, senderId, forwardInfo, savedPeerId,\n  } = message;\n\n  if (savedPeerId) return savedPeerId;\n\n  if (chatId !== global.currentUserId) {\n    return undefined;\n  }\n\n  if (forwardInfo?.savedFromPeerId) {\n    return forwardInfo.savedFromPeerId;\n  }\n\n  if (forwardInfo?.fromId) {\n    return forwardInfo.fromId;\n  }\n\n  if (forwardInfo?.hiddenUserName) {\n    return ANONYMOUS_USER_ID;\n  }\n\n  return senderId;\n}\n\nexport function selectThreadIdFromMessage<T extends GlobalState>(global: T, message: ApiMessage): ThreadId {\n  const savedDialogId = selectSavedDialogIdFromMessage(global, message);\n  if (savedDialogId) {\n    return savedDialogId;\n  }\n\n  const chat = selectChat(global, message.chatId);\n  const { content } = message;\n  const { replyToMsgId, replyToTopId, isForumTopic } = getMessageReplyInfo(message) || {};\n  if (content.action?.type === 'topicCreate') {\n    return message.id;\n  }\n\n  if (!chat?.isForum) {\n    if (chat && isChatBasicGroup(chat)) return MAIN_THREAD_ID;\n\n    if (chat && isChatSuperGroup(chat)) {\n      return replyToTopId || replyToMsgId || MAIN_THREAD_ID;\n    }\n    return MAIN_THREAD_ID;\n  }\n  if (!isForumTopic) return GENERAL_TOPIC_ID;\n  return replyToTopId || replyToMsgId || GENERAL_TOPIC_ID;\n}\n\nexport function selectCanReplyToMessage<T extends GlobalState>(global: T, message: ApiMessage, threadId: ThreadId) {\n  const chat = selectChat(global, message.chatId);\n  const isRestricted = selectIsChatRestricted(global, message.chatId);\n  if (!chat || isRestricted || chat.isForbidden) return false;\n\n  const isLocal = isMessageLocal(message);\n  const isServiceNotification = isServiceNotificationMessage(message);\n\n  if (isLocal || isServiceNotification) return false;\n\n  const threadInfo = selectThreadInfo(global, message.chatId, threadId);\n  const isMessageThread = Boolean(!threadInfo?.isCommentsInfo && threadInfo?.fromChannelId);\n  const chatFullInfo = selectChatFullInfo(global, chat.id);\n  const topic = selectTopic(global, chat.id, threadId);\n  const canPostInChat = getCanPostInChat(chat, topic, isMessageThread, chatFullInfo);\n  if (!canPostInChat) return false;\n\n  const messageTopic = selectTopicFromMessage(global, message);\n  return !messageTopic || !messageTopic.isClosed || messageTopic.isOwner || getHasAdminRight(chat, 'manageTopics');\n}\n\nexport function selectCanForwardMessage<T extends GlobalState>(global: T, message: ApiMessage) {\n  const isLocal = isMessageLocal(message);\n  const isServiceNotification = isServiceNotificationMessage(message);\n  const isAction = isActionMessage(message);\n  const hasTtl = hasMessageTtl(message);\n  const { content } = message;\n\n  const webPage = selectFullWebPageFromMessage(global, message);\n\n  const story = content.storyData\n    ? selectPeerStory(global, content.storyData.peerId, content.storyData.id)\n    : (webPage?.story\n      ? selectPeerStory(global, webPage.story.peerId, webPage.story.id)\n      : undefined\n    );\n  const isChatProtected = selectIsChatProtected(global, message.chatId);\n  const isStoryForwardForbidden = story && ('isDeleted' in story || ('noForwards' in story && story.noForwards));\n  const canForward = (\n    !isLocal && !isAction && !isChatProtected && !isStoryForwardForbidden\n    && (message.isForwardingAllowed || isServiceNotification) && !hasTtl\n  );\n\n  return canForward;\n}\n\n// This selector is slow and not to be used within lists (e.g. Message component)\nexport function selectAllowedMessageActionsSlow<T extends GlobalState>(\n  global: T, message: ApiMessage, threadId: ThreadId,\n) {\n  const chat = selectChat(global, message.chatId);\n  const isRestricted = selectIsChatRestricted(global, message.chatId);\n  if (!chat || isRestricted) {\n    return {};\n  }\n\n  const chatFullInfo = selectChatFullInfo(global, message.chatId);\n  const isPrivate = isUserId(chat.id);\n  const isChatWithSelf = selectIsChatWithSelf(global, message.chatId);\n  const isBasicGroup = isChatBasicGroup(chat);\n  const isSuperGroup = isChatSuperGroup(chat);\n  const isChannel = isChatChannel(chat);\n  const isBotChat = Boolean(selectBot(global, chat.id));\n  const isLocal = isMessageLocal(message);\n  const isFailed = isMessageFailed(message);\n  const isServiceNotification = isServiceNotificationMessage(message);\n  const isOwn = isOwnMessage(message);\n  const isForwarded = isForwardedMessage(message);\n  const isAction = isActionMessage(message);\n  const hasTtl = hasMessageTtl(message);\n  const { content } = message;\n  const isDocumentSticker = isMessageDocumentSticker(message);\n  const isBoostMessage = message.content.action?.type === 'boostApply';\n  const isMonoforum = chat.isMonoforum;\n\n  // https://github.com/telegramdesktop/tdesktop/blob/6627de646022af1394134974477109cd1439e1bb/Telegram/SourceFiles/data/data_peer_values.cpp#L367C2-L372C3\n  const canPinMessage = (() => {\n    if (isPrivate || chat.isCreator) return true;\n\n    if (isChannel) {\n      return getHasAdminRight(chat, 'editMessages');\n    }\n\n    const hasPinMessageRight = getHasAdminRight(chat, 'pinMessages');\n    const isPinMessageRightBanned = isUserRightBanned(chat, 'pinMessages', chatFullInfo);\n\n    if (isSuperGroup) {\n      const hasUsernameOrGeo = chat.hasUsername || chat.hasGeo;\n      return (hasPinMessageRight || !hasUsernameOrGeo) && !isPinMessageRightBanned;\n    }\n\n    if (isBasicGroup) {\n      return !chat.isForbidden && !chat.isNotJoined && hasPinMessageRight && !isPinMessageRightBanned;\n    }\n\n    return hasPinMessageRight;\n  })();\n\n  // https://github.com/telegramdesktop/tdesktop/blob/335095a332607c41a8d20b47e61f5bbd66366d4b/Telegram/SourceFiles/data/data_peer.cpp#L653\n  const canEditMessagesIndefinitely = (() => {\n    if (content.todo) return true;\n    if (isPrivate) return isChatWithSelf;\n    if (isBasicGroup) return false;\n    if (isSuperGroup) return canPinMessage;\n    if (isChannel) return chat.isCreator || getHasAdminRight(chat, 'editMessages');\n    return false;\n  })();\n\n  const isMessageEditable = (\n    (\n      canEditMessagesIndefinitely\n      || getServerTime() - message.date < (global.config?.editTimeLimit || Infinity)\n    ) && !(\n      content.sticker || content.contact || content.pollId || content.action\n      || (content.video?.isRound) || content.location || content.invoice || content.giveaway || content.giveawayResults\n      || isDocumentSticker\n    )\n    && !isForwarded\n    && !message.viaBotId\n    && !chat.isForbidden\n  );\n\n  const isSavedDialog = getIsSavedDialog(chat.id, threadId, global.currentUserId);\n\n  const canReply = selectCanReplyToMessage(global, message, threadId);\n  const canReplyGlobally = canReply || (!isSavedDialog && !isLocal && !isServiceNotification\n    && (isSuperGroup || isBasicGroup || isChatChannel(chat)));\n\n  let canPin = !isLocal && !isServiceNotification && !isAction && canPinMessage && !isSavedDialog;\n  let canUnpin = false;\n\n  const pinnedMessageIds = selectPinnedIds(global, chat.id, threadId);\n\n  if (canPin) {\n    canUnpin = Boolean(pinnedMessageIds && pinnedMessageIds.includes(message.id));\n    canPin = !canUnpin;\n  }\n\n  const canNotDeleteBoostMessage = isBoostMessage && isOwn\n    && !chat.isCreator && !getHasAdminRight(chat, 'deleteMessages');\n\n  const canDelete = (!isLocal || isFailed) && !isServiceNotification && !canNotDeleteBoostMessage && (\n    isPrivate\n    || isOwn\n    || isBasicGroup\n    || chat.isCreator\n    || getHasAdminRight(chat, 'deleteMessages')\n  );\n\n  const canReport = !isPrivate && !isOwn;\n\n  const canDeleteForAll = canDelete && !chat.isForbidden && (\n    (isPrivate && !isChatWithSelf && !isBotChat)\n    || (isBasicGroup && (\n      isOwn || getHasAdminRight(chat, 'deleteMessages') || chat.isCreator\n    ))\n  );\n\n  const hasMessageEditRight = isOwn || (isChannel && (chat.isCreator || getHasAdminRight(chat, 'editMessages')));\n\n  const canEdit = !isLocal && !isAction && isMessageEditable && hasMessageEditRight;\n\n  const hasSticker = Boolean(message.content.sticker);\n  const hasFavoriteSticker = hasSticker && selectIsStickerFavorite(global, message.content.sticker!);\n  const canFaveSticker = !isAction && hasSticker && !hasFavoriteSticker;\n  const canUnfaveSticker = !isAction && hasFavoriteSticker;\n  const canCopy = !isAction;\n  const canCopyLink = !isLocal && !isAction && (isChannel || isSuperGroup) && !isMonoforum;\n  const canSelect = !isLocal && !isAction;\n\n  const canDownload = selectMessageDownloadableMedia(global, message) && !hasTtl;\n\n  const canSaveGif = message.content.video?.isGif;\n\n  const poll = content.pollId ? selectPoll(global, content.pollId) : undefined;\n  const canRevote = !poll?.summary.closed && !poll?.summary.quiz && poll?.results.results?.some((r) => r.isChosen);\n  const canClosePoll = hasMessageEditRight && poll && !poll.summary.closed && !isForwarded;\n\n  const noOptions = [\n    canReply,\n    canReplyGlobally,\n    canEdit,\n    canPin,\n    canUnpin,\n    canReport,\n    canDelete,\n    canDeleteForAll,\n    canFaveSticker,\n    canUnfaveSticker,\n    canCopy,\n    canCopyLink,\n    canSelect,\n    canDownload,\n    canSaveGif,\n    canRevote,\n    canClosePoll,\n  ].every((ability) => !ability);\n\n  return {\n    noOptions,\n    canReply,\n    canReplyGlobally,\n    canEdit,\n    canPin,\n    canUnpin,\n    canReport,\n    canDelete,\n    canDeleteForAll,\n    canFaveSticker,\n    canUnfaveSticker,\n    canCopy,\n    canCopyLink,\n    canSelect,\n    canDownload,\n    canSaveGif,\n    canRevote,\n    canClosePoll,\n  };\n}\n\nexport function selectCanDeleteMessages<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  messageIds: number[],\n) {\n  const chatMessages = selectChatMessages(global, chatId);\n\n  if (messageIds.length > API_GENERAL_ID_LIMIT) {\n    return {};\n  }\n\n  const messageActions = messageIds\n    .map((id) => chatMessages[id] && selectAllowedMessageActionsSlow(global, chatMessages[id], threadId))\n    .filter(Boolean);\n\n  return {\n    canDelete: messageActions.every((actions) => actions.canDelete),\n    canDeleteForAll: messageActions.every((actions) => actions.canDeleteForAll),\n  };\n}\n\nexport function selectCanDeleteSelectedMessages<T extends GlobalState>(\n  global: T,\n  messageIds?: number[],\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageIds: selectedMessageIds } = selectTabState(global, tabId).selectedMessages || {};\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n  const messageIdList = messageIds?.length ? messageIds : selectedMessageIds;\n  if (!chatId || !threadId || !messageIdList) {\n    return {};\n  }\n\n  return selectCanDeleteMessages(global, chatId, threadId, messageIdList);\n}\n\nexport function selectCanReportSelectedMessages<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageIds: selectedMessageIds } = selectTabState(global, tabId).selectedMessages || {};\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n  const chatMessages = chatId && selectChatMessages(global, chatId);\n  if (!chatMessages || !selectedMessageIds || !threadId) {\n    return false;\n  }\n\n  const messageActions = selectedMessageIds\n    .map((id) => chatMessages[id] && selectAllowedMessageActionsSlow(global, chatMessages[id], threadId))\n    .filter(Boolean);\n\n  return messageActions.every((actions) => actions.canReport);\n}\n\nexport function selectCanDownloadSelectedMessages<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageIds: selectedMessageIds } = selectTabState(global, tabId).selectedMessages || {};\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n  const chatMessages = chatId && selectChatMessages(global, chatId);\n  if (!chatMessages || !selectedMessageIds || !threadId) {\n    return false;\n  }\n\n  const messageActions = selectedMessageIds\n    .map((id) => chatMessages[id] && selectAllowedMessageActionsSlow(global, chatMessages[id], threadId))\n    .filter(Boolean);\n\n  return messageActions.some((actions) => actions.canDownload);\n}\n\nexport function selectActiveDownloads<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).activeDownloads;\n}\n\nexport function selectUploadProgress<T extends GlobalState>(global: T, message: ApiMessage) {\n  return global.fileUploads.byMessageKey[getMessageKey(message)]?.progress;\n}\n\nexport function selectRealLastReadId<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  if (threadId === MAIN_THREAD_ID) {\n    const chat = selectChat(global, chatId);\n    if (!chat) {\n      return undefined;\n    }\n\n    // `lastReadInboxMessageId` is empty for new chats\n    if (!chat.lastReadInboxMessageId) {\n      return undefined;\n    }\n\n    const lastMessageId = selectChatLastMessageId(global, chatId);\n\n    if (!lastMessageId || chat.unreadCount) {\n      return chat.lastReadInboxMessageId;\n    }\n\n    return lastMessageId;\n  } else {\n    const threadInfo = selectThreadInfo(global, chatId, threadId);\n    if (!threadInfo) {\n      return undefined;\n    }\n\n    if (!threadInfo.lastReadInboxMessageId) {\n      return Number(threadInfo.threadId);\n    }\n\n    // Some previously read messages may be deleted\n    return Math.min(threadInfo.lastReadInboxMessageId, threadInfo.lastMessageId || Infinity);\n  }\n}\n\nexport function selectFirstUnreadId<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId,\n) {\n  const chat = selectChat(global, chatId);\n\n  if (threadId === MAIN_THREAD_ID) {\n    if (!chat) {\n      return undefined;\n    }\n  } else {\n    const threadInfo = selectThreadInfo(global, chatId, threadId);\n    if (!threadInfo\n      || (threadInfo.lastMessageId !== undefined && threadInfo.lastMessageId === threadInfo.lastReadInboxMessageId)) {\n      return undefined;\n    }\n  }\n\n  const outlyingLists = selectOutlyingLists(global, chatId, threadId);\n  const listedIds = selectListedIds(global, chatId, threadId);\n  const byId = selectChatMessages(global, chatId);\n  if (!byId || !(outlyingLists?.length || listedIds)) {\n    return undefined;\n  }\n\n  const lastReadId = selectRealLastReadId(global, chatId, threadId);\n  if (!lastReadId && chat && chat.isNotJoined) {\n    return undefined;\n  }\n\n  const lastReadServiceNotificationId = chatId === SERVICE_NOTIFICATIONS_USER_ID\n    ? global.serviceNotifications.reduce((max, notification) => {\n      return !notification.isUnread && notification.id > max ? notification.id : max;\n    }, -1)\n    : -1;\n\n  function findAfterLastReadId(listIds: number[]) {\n    return listIds.find((id) => {\n      return (\n        (!lastReadId || id > lastReadId)\n        && byId[id]\n        && (!byId[id].isOutgoing || byId[id].isFromScheduled)\n        && id > lastReadServiceNotificationId\n      );\n    });\n  }\n\n  if (outlyingLists?.length) {\n    const found = outlyingLists.map((list) => findAfterLastReadId(list)).filter(Boolean)[0];\n    if (found) {\n      return found;\n    }\n  }\n\n  if (listedIds) {\n    const found = findAfterLastReadId(listedIds);\n    if (found) {\n      return found;\n    }\n  }\n\n  return undefined;\n}\n\nexport function selectIsForwardModalOpen<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { isShareMessageModalShown } = selectTabState(global, tabId);\n  return Boolean(isShareMessageModalShown);\n}\n\nexport function selectCommonBoxChatId<T extends GlobalState>(global: T, messageId: number) {\n  const fromLastMessage = Object.values(global.chats.byId).find((chat) => (\n    isCommonBoxChat(chat) && selectChatLastMessageId(global, chat.id) === messageId\n  ));\n  if (fromLastMessage) {\n    return fromLastMessage.id;\n  }\n\n  const { byChatId } = global.messages;\n  return Object.keys(byChatId).find((chatId) => {\n    const chat = selectChat(global, chatId);\n    return chat && isCommonBoxChat(chat) && byChatId[chat.id].byId[messageId];\n  });\n}\n\nexport function selectIsInSelectMode<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { selectedMessages } = selectTabState(global, tabId);\n\n  return Boolean(selectedMessages);\n}\n\nexport function selectIsMessageSelected<T extends GlobalState>(\n  global: T, messageId: number,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageIds } = selectTabState(global, tabId).selectedMessages || {};\n  if (!messageIds) {\n    return false;\n  }\n\n  return messageIds.includes(messageId);\n}\n\nexport function selectForwardedMessageIdsByGroupId<T extends GlobalState>(\n  global: T, chatId: string, groupedId: string,\n) {\n  const chatMessages = selectChatMessages(global, chatId);\n  if (!chatMessages) {\n    return undefined;\n  }\n\n  return Object.values(chatMessages)\n    .filter((message) => message.groupedId === groupedId && message.forwardInfo)\n    .map(({ forwardInfo }) => forwardInfo!.fromMessageId);\n}\n\nexport function selectMessageIdsByGroupId<T extends GlobalState>(global: T, chatId: string, groupedId: string) {\n  const chatMessages = selectChatMessages(global, chatId);\n  if (!chatMessages) {\n    return undefined;\n  }\n\n  return Object.keys(chatMessages)\n    .map(Number)\n    .filter((id) => chatMessages[id].groupedId === groupedId);\n}\n\nexport function selectIsDocumentGroupSelected<T extends GlobalState>(\n  global: T, chatId: string, groupedId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageIds: selectedIds } = selectTabState(global, tabId).selectedMessages || {};\n  if (!selectedIds) {\n    return false;\n  }\n\n  const groupIds = selectMessageIdsByGroupId(global, chatId, groupedId);\n  return groupIds && groupIds.every((id) => selectedIds.includes(id));\n}\n\nexport function selectSelectedMessagesCount<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageIds } = selectTabState(global, tabId).selectedMessages || {};\n\n  return messageIds ? messageIds.length : 0;\n}\n\nexport function selectNewestMessageWithBotKeyboardButtons<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId = MAIN_THREAD_ID,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): ApiMessage | undefined {\n  const chat = selectChat(global, chatId);\n  if (!chat) {\n    return undefined;\n  }\n\n  const chatMessages = selectChatMessages(global, chatId);\n  const viewportIds = selectViewportIds(global, chatId, threadId, tabId);\n  if (!chatMessages || !viewportIds) {\n    return undefined;\n  }\n\n  const messageId = findLast(viewportIds, (id) => {\n    const message = chatMessages[id];\n    return message && selectShouldDisplayReplyKeyboard(global, message);\n  });\n\n  const replyHideMessageId = findLast(viewportIds, (id) => {\n    const message = chatMessages[id];\n    return message && selectShouldHideReplyKeyboard(global, message);\n  });\n\n  if (messageId && replyHideMessageId && replyHideMessageId > messageId) {\n    return undefined;\n  }\n\n  return messageId ? chatMessages[messageId] : undefined;\n}\n\nfunction selectShouldHideReplyKeyboard<T extends GlobalState>(global: T, message: ApiMessage) {\n  const {\n    shouldHideKeyboardButtons,\n    isHideKeyboardSelective,\n    isMentioned,\n  } = message;\n  if (!shouldHideKeyboardButtons) return false;\n\n  const replyToMessageId = getMessageReplyInfo(message)?.replyToMsgId;\n\n  if (isHideKeyboardSelective) {\n    if (isMentioned) return true;\n    if (!replyToMessageId) return false;\n\n    const replyMessage = selectChatMessage(global, message.chatId, replyToMessageId);\n    return Boolean(replyMessage?.senderId === global.currentUserId);\n  }\n  return true;\n}\n\nfunction selectShouldDisplayReplyKeyboard<T extends GlobalState>(global: T, message: ApiMessage) {\n  const {\n    keyboardButtons,\n    shouldHideKeyboardButtons,\n    isKeyboardSelective,\n    isMentioned,\n  } = message;\n  if (!keyboardButtons || shouldHideKeyboardButtons) return false;\n\n  const replyToMessageId = getMessageReplyInfo(message)?.replyToMsgId;\n\n  if (isKeyboardSelective) {\n    if (isMentioned) return true;\n    if (!replyToMessageId) return false;\n\n    const replyMessage = selectChatMessage(global, message.chatId, replyToMessageId);\n    return Boolean(replyMessage?.senderId === global.currentUserId);\n  }\n\n  return true;\n}\n\nexport function selectCanAutoLoadMedia<T extends GlobalState>(\n  global: T, message: ApiMessage | ApiSponsoredMessage,\n) {\n  const chat = selectChat(global, message.chatId);\n  if (!chat) {\n    return undefined;\n  }\n\n  const sender = 'id' in message ? selectSender(global, message) : undefined;\n\n  const webPage = selectWebPageFromMessage(global, message);\n  const isPhoto = Boolean(getMessagePhoto(message) || getWebPagePhoto(webPage));\n  const isVideo = Boolean(getMessageVideo(message) || getWebPageVideo(webPage));\n  const isFile = Boolean(getMessageAudio(message) || getMessageVoice(message) || getMessageDocument(message));\n\n  const {\n    canAutoLoadPhotoFromContacts,\n    canAutoLoadPhotoInPrivateChats,\n    canAutoLoadPhotoInGroups,\n    canAutoLoadPhotoInChannels,\n    canAutoLoadVideoFromContacts,\n    canAutoLoadVideoInPrivateChats,\n    canAutoLoadVideoInGroups,\n    canAutoLoadVideoInChannels,\n    canAutoLoadFileFromContacts,\n    canAutoLoadFileInPrivateChats,\n    canAutoLoadFileInGroups,\n    canAutoLoadFileInChannels,\n  } = global.settings.byKey;\n\n  if (isPhoto) {\n    return canAutoLoadMedia({\n      global,\n      chat,\n      sender,\n      canAutoLoadMediaFromContacts: canAutoLoadPhotoFromContacts,\n      canAutoLoadMediaInPrivateChats: canAutoLoadPhotoInPrivateChats,\n      canAutoLoadMediaInGroups: canAutoLoadPhotoInGroups,\n      canAutoLoadMediaInChannels: canAutoLoadPhotoInChannels,\n    });\n  }\n\n  if (isVideo) {\n    return canAutoLoadMedia({\n      global,\n      chat,\n      sender,\n      canAutoLoadMediaFromContacts: canAutoLoadVideoFromContacts,\n      canAutoLoadMediaInPrivateChats: canAutoLoadVideoInPrivateChats,\n      canAutoLoadMediaInGroups: canAutoLoadVideoInGroups,\n      canAutoLoadMediaInChannels: canAutoLoadVideoInChannels,\n    });\n  }\n\n  if (isFile) {\n    return canAutoLoadMedia({\n      global,\n      chat,\n      sender,\n      canAutoLoadMediaFromContacts: canAutoLoadFileFromContacts,\n      canAutoLoadMediaInPrivateChats: canAutoLoadFileInPrivateChats,\n      canAutoLoadMediaInGroups: canAutoLoadFileInGroups,\n      canAutoLoadMediaInChannels: canAutoLoadFileInChannels,\n    });\n  }\n\n  return true;\n}\n\nfunction canAutoLoadMedia<T extends GlobalState>({\n  global,\n  chat,\n  sender,\n  canAutoLoadMediaFromContacts,\n  canAutoLoadMediaInPrivateChats,\n  canAutoLoadMediaInGroups,\n  canAutoLoadMediaInChannels,\n}: {\n  global: T;\n  chat: ApiChat;\n  canAutoLoadMediaFromContacts: boolean;\n  canAutoLoadMediaInPrivateChats: boolean;\n  canAutoLoadMediaInGroups: boolean;\n  canAutoLoadMediaInChannels: boolean;\n  sender?: ApiPeer;\n}) {\n  const isMediaFromContact = Boolean(sender && (\n    selectIsChatWithSelf(global, sender.id) || selectUser(global, sender.id)?.isContact\n  ));\n\n  return Boolean(\n    (isMediaFromContact && canAutoLoadMediaFromContacts)\n    || (!isMediaFromContact && canAutoLoadMediaInPrivateChats && isUserId(chat.id))\n    || (canAutoLoadMediaInGroups && isChatGroup(chat))\n    || (canAutoLoadMediaInChannels && isChatChannel(chat)),\n  );\n}\n\nexport function selectLastServiceNotification<T extends GlobalState>(global: T) {\n  const { serviceNotifications } = global;\n  const maxId = Math.max(...serviceNotifications.map(({ id }) => id));\n\n  return serviceNotifications.find(({ id, isDeleted }) => !isDeleted && id === maxId);\n}\n\nexport function selectIsMessageProtected<T extends GlobalState>(global: T, message?: ApiMessage) {\n  return Boolean(message && (\n    message.isProtected || selectIsChatProtected(global, message.chatId) || hasMessageTtl(message)\n    || getMessagePaidMedia(message)\n  ));\n}\n\nexport function selectIsChatProtected<T extends GlobalState>(global: T, chatId: string) {\n  return selectChat(global, chatId)?.isProtected || false;\n}\n\nexport function selectHasProtectedMessage<T extends GlobalState>(global: T, chatId: string, messageIds?: number[]) {\n  if (selectChat(global, chatId)?.isProtected) {\n    return true;\n  }\n\n  if (!messageIds) {\n    return false;\n  }\n\n  const messages = selectChatMessages(global, chatId);\n\n  return messageIds.some((messageId) => messages[messageId]?.isProtected);\n}\n\nexport function selectCanForwardMessages<T extends GlobalState>(global: T, chatId: string, messageIds?: number[]) {\n  if (selectChat(global, chatId)?.isProtected) {\n    return false;\n  }\n\n  if (!messageIds) {\n    return false;\n  }\n\n  const messages = selectChatMessages(global, chatId);\n\n  return messageIds\n    .map((id) => messages[id])\n    .every((message) => message && !hasMessageTtl(message)\n      && (message.isForwardingAllowed || isServiceNotificationMessage(message)));\n}\n\nexport function selectHasIpRevealingMedia<T extends GlobalState>(global: T, chatId: string, messageIds: number[]) {\n  const messages = selectChatMessages(global, chatId);\n\n  return messageIds\n    .map((id) => messages[id])\n    .some((message) => {\n      if (!message) return false;\n\n      const document = getMessageDocument(message);\n      if (!document) return false;\n\n      const extension = getDocumentExtension(document);\n      if (!extension) return false;\n\n      return isIpRevealingMedia({ mimeType: document.mimeType, extension });\n    });\n}\n\nexport function selectSponsoredMessage<T extends GlobalState>(global: T, chatId: string) {\n  const message = global.messages.sponsoredByChatId[chatId];\n\n  return message && message.expiresAt >= Math.round(Date.now() / 1000) ? message : undefined;\n}\n\nexport function selectDefaultReaction<T extends GlobalState>(global: T, chatId: string) {\n  if (chatId === SERVICE_NOTIFICATIONS_USER_ID) return undefined;\n\n  const isPrivate = isUserId(chatId);\n  const defaultReaction = global.config?.defaultReaction;\n  if (!defaultReaction) {\n    return undefined;\n  }\n\n  if (isPrivate) {\n    return defaultReaction;\n  }\n\n  const chatReactions = selectChatFullInfo(global, chatId)?.enabledReactions;\n  if (!chatReactions || !canSendReaction(defaultReaction, chatReactions)) {\n    return undefined;\n  }\n\n  return defaultReaction;\n}\n\nexport function selectMaxUserReactions<T extends GlobalState>(global: T): number {\n  return selectCurrentLimit(global, 'maxReactions');\n}\n\n// Slow, not to be used in `withGlobal`\nexport function selectVisibleUsers<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n  if (!chatId || !threadId) {\n    return undefined;\n  }\n\n  const messageIds = selectTabThreadParam(global, chatId, threadId, 'viewportIds', tabId);\n  if (!messageIds) {\n    return undefined;\n  }\n\n  return messageIds.map((messageId) => {\n    const { senderId } = selectChatMessage(global, chatId, messageId) || {};\n    return senderId ? selectUser(global, senderId) : undefined;\n  }).filter(Boolean);\n}\n\nexport function selectShouldSchedule<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectCurrentMessageList(global, tabId)?.type === 'scheduled';\n}\n\nexport function selectCanSchedule<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const chatId = selectCurrentMessageList(global, tabId)?.chatId;\n  const paidMessagesStars = chatId ? selectPeerPaidMessagesStars(global, chatId) : undefined;\n  return !paidMessagesStars;\n}\n\nexport function selectCanScheduleUntilOnline<T extends GlobalState>(global: T, id: string) {\n  const isChatWithSelf = selectIsChatWithSelf(global, id);\n  const chatBot = selectBot(global, id);\n  const paidMessagesStars = selectPeerPaidMessagesStars(global, id);\n  return Boolean(!paidMessagesStars\n    && !isChatWithSelf && !chatBot && isUserId(id) && selectUserStatus(global, id)?.wasOnline);\n}\n\nexport function selectCustomEmojis(message: ApiMessage) {\n  const entities = message.content.text?.entities;\n  return entities?.filter((entity): entity is ApiMessageEntityCustomEmoji => (\n    entity.type === ApiMessageEntityTypes.CustomEmoji\n  ));\n}\n\nexport function selectMessageCustomEmojiSets<T extends GlobalState>(\n  global: T, message: ApiMessage,\n): ApiStickerSetInfo[] | undefined {\n  const customEmojis = selectCustomEmojis(message);\n  if (!customEmojis) return MEMO_EMPTY_ARRAY;\n  const documents = customEmojis.map((entity) => selectCustomEmoji(global, entity.documentId));\n  // If some emoji still loading, do not return empty array\n  if (!documents.every(Boolean)) return undefined;\n  const sets = documents.map((doc) => doc.stickerSetInfo);\n\n  return sets.reduce((acc, set) => {\n    if ('shortName' in set) {\n      if (acc.some((s) => 'shortName' in s && s.shortName === set.shortName)) {\n        return acc;\n      }\n    }\n\n    if ('id' in set) {\n      if (acc.some((s) => 'id' in s && s.id === set.id)) {\n        return acc;\n      }\n    }\n    acc.push(set); // Optimization\n    return acc;\n  }, [] as ApiStickerSetInfo[]);\n}\n\nexport function selectForwardsContainVoiceMessages<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageIds, fromChatId } = selectTabState(global, tabId).forwardMessages;\n  if (!messageIds) return false;\n  const chatMessages = selectChatMessages(global, fromChatId!);\n  return messageIds.some((messageId) => {\n    const message = chatMessages[messageId];\n    return Boolean(message.content.voice) || Boolean(message.content.video?.isRound);\n  });\n}\n\nexport function selectChatTranslations<T extends GlobalState>(\n  global: T, chatId: string,\n): ChatTranslatedMessages {\n  return global.translations.byChatId[chatId];\n}\n\nexport function selectMessageTranslations<T extends GlobalState>(\n  global: T, chatId: string, toLanguageCode: string,\n) {\n  return selectChatTranslations(global, chatId)?.byLangCode[toLanguageCode] || {};\n}\n\nexport function selectRequestedMessageTranslationLanguage<T extends GlobalState>(\n  global: T, chatId: string, messageId: number, ...[tabId = getCurrentTabId()]: TabArgs<T>\n): string | undefined {\n  const requestedInChat = selectTabState(global, tabId).requestedTranslations.byChatId[chatId];\n  return requestedInChat?.toLanguage || requestedInChat?.manualMessages?.[messageId];\n}\nexport function selectReplyCanBeSentToChat<T extends GlobalState>(\n  global: T,\n  toChatId: string,\n  fromChatId: string,\n  replyInfo: ApiInputMessageReplyInfo,\n) {\n  if (!replyInfo.replyToMsgId) return false;\n  const fromRealChatId = replyInfo?.replyToPeerId ?? fromChatId;\n  if (toChatId === fromRealChatId) return true;\n  const chatMessages = selectChatMessages(global, fromRealChatId);\n  const message = chatMessages[replyInfo.replyToMsgId];\n\n  return !isExpiredMessage(message);\n}\nexport function selectForwardsCanBeSentToChat<T extends GlobalState>(\n  global: T,\n  toChatId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageIds, storyId, fromChatId } = selectTabState(global, tabId).forwardMessages;\n  const chat = selectChat(global, toChatId);\n  if ((!messageIds && !storyId) || !chat) return false;\n\n  if (storyId) {\n    return true;\n  }\n\n  const chatFullInfo = selectChatFullInfo(global, toChatId);\n  const chatMessages = selectChatMessages(global, fromChatId!);\n\n  const isSavedMessages = toChatId ? selectIsChatWithSelf(global, toChatId) : undefined;\n  const isChatWithBot = toChatId ? selectIsChatWithBot(global, chat) : undefined;\n  const options = getAllowedAttachmentOptions(chat, chatFullInfo, isChatWithBot, isSavedMessages);\n  return !messageIds!.some((messageId) => heckMessageSendingDenied(chatMessages[messageId], options));\n}\nfunction heckMessageSendingDenied(message: ApiMessage, options: IAllowedAttachmentOptions) {\n  const isVoice = message.content.voice;\n  const isRoundVideo = message.content.video?.isRound;\n  const isPhoto = message.content.photo;\n  const isGif = message.content.video?.isGif;\n  const isVideo = message.content.video && !isRoundVideo && !isGif;\n  const isAudio = message.content.audio;\n  const isDocument = message.content.document;\n  const isSticker = message.content.sticker;\n  const isPlainText = message.content.text\n    && !isVoice && !isRoundVideo && !isSticker && !isDocument && !isAudio && !isVideo && !isPhoto && !isGif;\n\n  return (isVoice && !options.canSendVoices)\n    || (isRoundVideo && !options.canSendRoundVideos)\n    || (isSticker && !options.canSendStickers)\n    || (isDocument && !options.canSendDocuments)\n    || (isAudio && !options.canSendAudios)\n    || (isVideo && !options.canSendVideos)\n    || (isPhoto && !options.canSendPhotos)\n    || (isGif && !options.canSendGifs)\n    || (isPlainText && !options.canSendPlainText);\n}\n\nexport function selectCanTranslateMessage<T extends GlobalState>(\n  global: T, message: ApiMessage, detectedLanguage?: string, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { canTranslate: isTranslationEnabled, doNotTranslate } = global.settings.byKey;\n\n  const canTranslateLanguage = !detectedLanguage || !doNotTranslate.includes(detectedLanguage);\n\n  const isTranslatable = isMessageTranslatable(message);\n\n  // Separate translations are disabled when chat translation enabled\n  const chatRequestedLanguage = selectRequestedChatTranslationLanguage(global, message.chatId, tabId);\n\n  return IS_TRANSLATION_SUPPORTED && isTranslationEnabled && canTranslateLanguage && isTranslatable\n    && !chatRequestedLanguage;\n}\n\nexport function selectTopicLink<T extends GlobalState>(\n  global: T, chatId: string, topicId?: ThreadId,\n) {\n  const chat = selectChat(global, chatId);\n  if (!chat || !chat?.isForum) {\n    return undefined;\n  }\n\n  return getMessageLink(chat, topicId);\n}\n\nexport function selectMessageReplyInfo<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId, additionalReplyInfo?: ApiInputMessageReplyInfo,\n) {\n  const chat = selectChat(global, chatId);\n  if (!chat) return undefined;\n  const isMainThread = threadId === MAIN_THREAD_ID;\n  if (!additionalReplyInfo && isMainThread) return undefined;\n\n  const replyInfo: ApiInputMessageReplyInfo = {\n    type: 'message',\n    ...additionalReplyInfo,\n    replyToMsgId: additionalReplyInfo?.replyToMsgId || Number(threadId),\n    replyToTopId: additionalReplyInfo?.replyToTopId || (!isMainThread ? Number(threadId) : undefined),\n  };\n\n  return replyInfo;\n}\n\nexport function selectReplyMessage<T extends GlobalState>(global: T, message: ApiMessage) {\n  const { replyToMsgId, replyToPeerId } = getMessageReplyInfo(message) || {};\n  const replyMessage = replyToMsgId\n    ? selectChatMessage(global, replyToPeerId || message.chatId, replyToMsgId) : undefined;\n\n  return replyMessage;\n}\n\nexport function selectActiveRestrictionReasons<T extends GlobalState>(\n  global: T, restrictionReasons?: ApiRestrictionReason[],\n): ApiRestrictionReason[] {\n  if (!restrictionReasons) return [];\n\n  const { ignoreRestrictionReasons } = global.appConfig;\n\n  return restrictionReasons.filter((reason) => {\n    const isForCurrentPlatform = reason.platform === 'all' || reason.platform === WEB_APP_PLATFORM;\n    if (!isForCurrentPlatform) return false;\n\n    const shouldIgnore = ignoreRestrictionReasons?.includes(reason.reason);\n    return !shouldIgnore;\n  });\n}\n","import { getActions } from '../global';\n\nimport { PRODUCTION_HOSTNAME, WEB_VERSION_BASE } from '../config';\nimport { clearWebsync } from './websync';\n\ntype AvailableVersions = 'Z' | 'K';\n\nconst SEARCH_ENGINE_REGEX = /(^|\\.)(google|bing|duckduckgo|ya|yandex)\\./i;\n// Handled by the legacy version. Cannot be updated\nconst PERMANENT_VERSION_KEY = 'kz_version';\nconst CLIENT_VERSION: AvailableVersions = 'Z';\n\nfunction setPermanentWebVersion(version: AvailableVersions) {\n  localStorage.setItem(PERMANENT_VERSION_KEY, JSON.stringify(version));\n}\n\nexport function getPermanentWebVersion(): AvailableVersions | undefined {\n  const version = localStorage.getItem(PERMANENT_VERSION_KEY);\n  if (version) {\n    return JSON.parse(version);\n  }\n\n  return undefined;\n}\n\nexport function switchPermanentWebVersion(version: AvailableVersions) {\n  setPermanentWebVersion(version);\n  clearWebsync();\n  getActions().skipLockOnUnload();\n  window.location.assign(`${WEB_VERSION_BASE}${version.toLowerCase()}`);\n}\n\nexport function checkAndAssignPermanentWebVersion() {\n  if (window.location.hostname !== PRODUCTION_HOSTNAME) return;\n\n  const referrer = document.referrer.toLowerCase();\n  if (!referrer) return;\n  try {\n    const isSearchEngine = new URL(referrer).host.match(SEARCH_ENGINE_REGEX);\n    if (!isSearchEngine) return;\n\n    const currentVersion = getPermanentWebVersion();\n    if (currentVersion) {\n      if (currentVersion !== CLIENT_VERSION) {\n        switchPermanentWebVersion(currentVersion);\n      }\n      return;\n    }\n\n    const urlParams = new URLSearchParams(window.location.search);\n    const hasTest = (urlParams.get('test') ?? undefined) !== undefined;\n    const shouldRedirect = Math.random() < 0.5;\n\n    if (hasTest || !shouldRedirect) {\n      setPermanentWebVersion('Z');\n      return;\n    }\n\n    switchPermanentWebVersion('K');\n  } catch (e) {\n    // Ignore\n  }\n}\n","import type { ChangeEvent } from 'react';\nimport type { FC, TeactNode } from '../../lib/teact/teact';\nimport type React from '../../lib/teact/teact';\nimport {\n  memo,\n  useRef,\n  useState,\n} from '../../lib/teact/teact';\n\nimport type { ApiUser } from '../../api/types';\nimport type { IconName } from '../../types/icons';\nimport type { IRadioOption } from './CheckboxGroup';\n\nimport buildClassName from '../../util/buildClassName';\nimport { REM } from '../common/helpers/mediaDimensions';\nimport renderText from '../common/helpers/renderText';\n\nimport useCurrentOrPrev from '../../hooks/useCurrentOrPrev';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useOldLang from '../../hooks/useOldLang';\n\nimport Avatar from '../common/Avatar';\nimport Icon from '../common/icons/Icon';\nimport Button from './Button';\nimport Spinner from './Spinner';\n\nimport './Checkbox.scss';\n\ntype OwnProps = {\n  id?: string;\n  name?: string;\n  value?: string;\n  user?: ApiUser;\n  label?: TeactNode;\n  labelText?: TeactNode;\n  subLabel?: string;\n  checked?: boolean;\n  rightIcon?: IconName;\n  disabled?: boolean;\n  tabIndex?: number;\n  withIcon?: boolean;\n  blocking?: boolean;\n  permissionGroup?: boolean;\n  isLoading?: boolean;\n  withCheckedCallback?: boolean;\n  onlyInput?: boolean;\n  isRound?: boolean;\n  className?: string;\n  nestedCheckbox?: boolean;\n  nestedCheckboxCount?: number | undefined;\n  nestedOptionList?: IRadioOption[];\n  leftElement?: TeactNode;\n  values?: string[];\n  onChange?: (e: ChangeEvent<HTMLInputElement>, nestedOptionList?: IRadioOption[]) => void;\n  onCheck?: (isChecked: boolean) => void;\n  onClickLabel?: (e: React.MouseEvent, value?: string) => void;\n};\nconst AVATAR_SIZE = 1.25 * REM;\n\nconst Checkbox: FC<OwnProps> = ({\n  id,\n  name,\n  value,\n  label,\n  user,\n  labelText,\n  subLabel,\n  checked,\n  tabIndex,\n  disabled,\n  withIcon,\n  blocking,\n  permissionGroup,\n  isLoading,\n  className,\n  rightIcon,\n  onlyInput,\n  isRound,\n  nestedCheckbox,\n  nestedCheckboxCount,\n  nestedOptionList,\n  leftElement,\n  values,\n  onChange,\n  onCheck,\n  onClickLabel,\n}) => {\n  const lang = useOldLang();\n  const labelRef = useRef<HTMLLabelElement>();\n  const [showNested, setShowNested] = useState(false);\n  const renderingUser = useCurrentOrPrev(user, true);\n\n  const handleChange = useLastCallback((event: ChangeEvent<HTMLInputElement>) => {\n    if (disabled) {\n      return;\n    }\n\n    if (onChange) {\n      onChange(event, nestedOptionList);\n    }\n\n    if (onCheck) {\n      onCheck(event.currentTarget.checked);\n    }\n  });\n\n  const toggleNested = useLastCallback(() => {\n    setShowNested(!showNested);\n  });\n\n  function handleClick(event: React.MouseEvent) {\n    if (event.target !== labelRef.current) {\n      onClickLabel?.(event, value);\n    }\n  }\n\n  function handleInputClick(event: React.MouseEvent) {\n    event.stopPropagation();\n  }\n\n  const labelClassName = buildClassName(\n    'Checkbox',\n    disabled && 'disabled',\n    withIcon && 'withIcon',\n    isLoading && 'loading',\n    blocking && 'blocking',\n    nestedCheckbox && 'nested',\n    subLabel && 'withSubLabel',\n    permissionGroup && 'permission-group',\n    Boolean(leftElement) && 'avatar',\n    onlyInput && 'onlyInput',\n    isRound && 'round',\n    Boolean(rightIcon) && 'withNestedList',\n    className,\n  );\n\n  return (\n    <>\n      {/* eslint-disable-next-line jsx-a11y/no-noninteractive-element-interactions */}\n      <label\n        className={labelClassName}\n        dir={lang.isRtl ? 'rtl' : undefined}\n        onClick={onClickLabel ? handleClick : undefined}\n        ref={labelRef}\n      >\n        <input\n          type=\"checkbox\"\n          id={id}\n          name={name}\n          value={value}\n          checked={checked}\n          disabled={disabled}\n          tabIndex={tabIndex}\n          onChange={handleChange}\n          onClick={onClickLabel ? handleInputClick : undefined}\n        />\n        <div className={buildClassName(\n          'Checkbox-main',\n          Boolean(leftElement) && 'Nested-avatar-list',\n        )}\n        >\n          <div className={buildClassName('user-avatar', renderingUser && 'user-avatar-visible')}>\n            {renderingUser && (\n              <Avatar\n                peer={renderingUser}\n                size={AVATAR_SIZE}\n              />\n            )}\n          </div>\n          <span className=\"label\" dir=\"auto\">\n            {leftElement}\n            {typeof label === 'string' ? renderText(label) : label}\n            {Boolean(labelText) && <span className=\"ml-1\">{renderText(labelText)}</span>}\n          </span>\n          {subLabel && <span className=\"subLabel\" dir=\"auto\">{renderText(subLabel)}</span>}\n          {rightIcon && <Icon name={rightIcon} className=\"right-icon\" />}\n        </div>\n        {nestedCheckbox && (\n          <span className=\"nestedButton\" dir=\"auto\">\n            <Button className=\"button\" color=\"translucent\" size=\"smaller\" onClick={toggleNested}>\n              <Icon name=\"group-filled\" className=\"group-icon\" />\n              {nestedCheckboxCount}\n              <Icon name={showNested ? 'up' : 'down'} />\n            </Button>\n          </span>\n        )}\n        {isLoading && <Spinner />}\n      </label>\n      {nestedCheckbox && (\n        <div\n          className={buildClassName('nested-checkbox-group', showNested && 'nested-checkbox-group-open')}\n        >\n          {nestedOptionList?.map((nestedOption) => (\n            <Checkbox\n              key={nestedOption.value}\n              leftElement={leftElement}\n              onChange={handleChange}\n              checked={values?.indexOf(nestedOption.value) !== -1}\n              values={values}\n\n              {...nestedOption}\n            />\n          ))}\n        </div>\n      )}\n    </>\n  );\n};\n\nexport default memo(Checkbox);\n","import type { Scheduler } from './schedulers';\n\nimport { requestMeasure } from '../lib/fasterdom/fasterdom';\n\ninterface AnimationInstance {\n  isCancelled: boolean;\n}\ntype TickFunction = () => boolean | undefined;\n\nlet currentInstance: AnimationInstance | undefined;\n\nexport function animateSingle(tick: TickFunction, schedulerFn: Scheduler, instance?: AnimationInstance) {\n  if (!instance) {\n    if (currentInstance && !currentInstance.isCancelled) {\n      currentInstance.isCancelled = true;\n    }\n\n    instance = { isCancelled: false };\n    currentInstance = instance;\n  }\n\n  if (!instance.isCancelled && tick()) {\n    schedulerFn(() => {\n      animateSingle(tick, schedulerFn, instance);\n    });\n  }\n}\n\nexport function cancelSingleAnimation() {\n  const dumbScheduler = (cb: AnyFunction) => cb;\n  const dumbCb = () => undefined;\n\n  animateSingle(dumbCb, dumbScheduler);\n}\n\nexport function animate(tick: TickFunction, schedulerFn: Scheduler) {\n  schedulerFn(() => {\n    if (tick()) {\n      animate(tick, schedulerFn);\n    }\n  });\n}\n\nexport function animateInstantly(tick: TickFunction, schedulerFn: Scheduler) {\n  if (tick()) {\n    schedulerFn(() => {\n      animateInstantly(tick, schedulerFn);\n    });\n  }\n}\n\ntype TimingFn = (t: number) => number;\n\ntype AnimateNumberProps<T extends number | number[]> = {\n  to: T;\n  from: T;\n  duration: number;\n  onUpdate: (value: T) => void;\n  timing?: TimingFn;\n  onEnd?: (isCanceled?: boolean) => void;\n};\n\nexport const timingFunctions = {\n  linear: (t: number) => t,\n  easeIn: (t: number) => t ** 1.675,\n  easeOut: (t: number) => -1 * t ** 1.675,\n  easeInOut: (t: number) => 0.5 * (Math.sin((t - 0.5) * Math.PI) + 1),\n  easeInQuad: (t: number) => t * t,\n  easeOutQuad: (t: number) => t * (2 - t),\n  easeInOutQuad: (t: number) => (t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t),\n  easeInCubic: (t: number) => t ** 3,\n  easeOutCubic: (t: number) => (--t) * t * t + 1,\n  easeInOutCubic: (t: number) => (t < 0.5 ? 4 * t ** 3 : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1),\n  easeInQuart: (t: number) => t ** 4,\n  easeOutQuart: (t: number) => 1 - (--t) * t ** 3,\n  easeInOutQuart: (t: number) => (t < 0.5 ? 8 * t ** 4 : 1 - 8 * (--t) * t ** 3),\n  easeInQuint: (t: number) => t ** 5,\n  easeOutQuint: (t: number) => 1 + (--t) * t ** 4,\n  easeInOutQuint: (t: number) => (t < 0.5 ? 16 * t ** 5 : 1 + 16 * (--t) * t ** 4),\n};\n\nexport function animateNumber<T extends number | number[]>({\n  timing = timingFunctions.linear,\n  onUpdate,\n  duration,\n  onEnd,\n  from,\n  to,\n}: AnimateNumberProps<T>) {\n  const t0 = Date.now();\n\n  let isCanceled = false;\n\n  animateInstantly(() => {\n    if (isCanceled) return false;\n\n    const t1 = Date.now();\n    const t = Math.min((t1 - t0) / duration, 1);\n\n    const progress = timing(t);\n    if (typeof from === 'number' && typeof to === 'number') {\n      onUpdate((from + ((to - from) * progress)) as T);\n    } else if (Array.isArray(from) && Array.isArray(to)) {\n      const result = from.map((f, i) => f + ((to[i] - f) * progress));\n      onUpdate(result as T);\n    }\n\n    if (t === 1) {\n      onEnd?.();\n    }\n\n    return t < 1;\n  }, requestMeasure);\n\n  return () => {\n    isCanceled = true;\n    onEnd?.(true);\n  };\n}\n\nexport function applyStyles(element: HTMLElement, css: Record<string, string>) {\n  Object.assign(element.style, css);\n}\n","import type {\n  ApiUser, ApiUserCommonChats,\n  ApiUserFullInfo, ApiUserStatus,\n} from '../../api/types';\nimport type { BotAppPermissions } from '../../types';\nimport type { GlobalState } from '../types';\n\nimport { isUserBot } from '../helpers';\n\nexport function selectUser<T extends GlobalState>(global: T, userId: string): ApiUser | undefined {\n  return global.users.byId[userId];\n}\n\nexport function selectUserStatus<T extends GlobalState>(global: T, userId: string): ApiUserStatus | undefined {\n  return global.users.statusesById[userId];\n}\n\nexport function selectUserFullInfo<T extends GlobalState>(global: T, userId: string): ApiUserFullInfo | undefined {\n  return global.users.fullInfoById[userId];\n}\n\nexport function selectUserCommonChats<T extends GlobalState>(\n  global: T, userId: string,\n): ApiUserCommonChats | undefined {\n  return global.users.commonChatsById[userId];\n}\n\nexport function selectIsUserBlocked<T extends GlobalState>(global: T, userId: string) {\n  return selectUserFullInfo(global, userId)?.isBlocked;\n}\n\nexport function selectIsCurrentUserPremium<T extends GlobalState>(global: T) {\n  if (!global.currentUserId) return false;\n\n  return Boolean(global.users.byId[global.currentUserId].isPremium);\n}\n\nexport function selectIsCurrentUserFrozen<T extends GlobalState>(global: T) {\n  return Boolean(global.appConfig.freezeUntilDate);\n}\n\nexport function selectIsPremiumPurchaseBlocked<T extends GlobalState>(global: T) {\n  return global.appConfig.isPremiumPurchaseBlocked ?? true;\n}\n\nexport function selectIsGiveawayGiftsPurchaseAvailable<T extends GlobalState>(global: T) {\n  return global.appConfig.isGiveawayGiftsPurchaseAvailable ?? true;\n}\n\n/**\n * Slow, not to be used in `withGlobal`\n */\nexport function selectUserByPhoneNumber<T extends GlobalState>(global: T, phoneNumber: string) {\n  const phoneNumberCleaned = phoneNumber.replace(/[^0-9]/g, '');\n\n  return Object.values(global.users.byId).find((user) => user?.phoneNumber === phoneNumberCleaned);\n}\n\nexport function selectBot<T extends GlobalState>(global: T, userId: string): ApiUser | undefined {\n  const user = selectUser(global, userId);\n  if (!user || !isUserBot(user)) {\n    return undefined;\n  }\n\n  return user;\n}\n\nexport function selectBotAppPermissions<T extends GlobalState>(\n  global: T, userId: string,\n): BotAppPermissions | undefined {\n  return global.users.botAppPermissionsById[userId];\n}\n","import Teact, { type Props } from './teact';\nexport type { JSX } from 'react';\nexport const Fragment = Teact.Fragment;\n\nfunction create(type: any, props: Props = {}, key?: any) {\n  if (key !== undefined) props.key = key;\n  const children = props.children;\n  if (props.children !== undefined) props.children = undefined;\n  return Teact.createElement(type, props, children);\n}\n\nexport function jsx(type: any, props: Props, key?: any) {\n  return create(type, props, key);\n}\n\n// Not implemented, reusing jsx for now\nexport const jsxs = jsx;\nexport const jsxDEV = jsx;\n","import type { ApiChatType, ApiPhoto } from '../../api/types';\nimport type { WebApp } from '../../types/webapp';\n\nimport { REPLIES_USER_ID, VERIFICATION_CODES_USER_ID } from '../../config';\n\nexport function getBotCoverMediaHash(photo: ApiPhoto) {\n  return `photo${photo.id}?size=x`;\n}\n\nexport function convertToApiChatType(type: string): ApiChatType | undefined {\n  if (type === 'channels') return 'channels';\n  if (type === 'chats' || type === 'groups') return 'chats';\n  if (type === 'users') return 'users';\n  if (type === 'bots') return 'bots';\n  return undefined;\n}\n\nexport function getWebAppKey(webApp: Partial<WebApp>) {\n  if (webApp.requestUrl) return webApp.requestUrl;\n  if (webApp.appName) return `${webApp.botId}?appName=${webApp.appName}`;\n  return webApp.botId!;\n}\n\nexport function isSystemBot(botId: string) {\n  return botId === REPLIES_USER_ID || botId === VERIFICATION_CODES_USER_ID;\n}\n","import type { PerformanceType } from '../types';\nimport type { GlobalState, SharedState, TabState } from './types';\nimport { LeftColumnContent, NewChatMembersProgress, SettingsScreens } from '../types';\n\nimport {\n  ANIMATION_LEVEL_DEFAULT,\n  DARK_THEME_PATTERN_COLOR,\n  DEFAULT_GIFT_PROFILE_FILTER_OPTIONS,\n  DEFAULT_MESSAGE_TEXT_SIZE_PX,\n  DEFAULT_PATTERN_COLOR,\n  DEFAULT_PLAYBACK_RATE,\n  DEFAULT_RESALE_GIFTS_FILTER_OPTIONS,\n  DEFAULT_VOLUME,\n  IOS_DEFAULT_MESSAGE_TEXT_SIZE_PX,\n  MACOS_DEFAULT_MESSAGE_TEXT_SIZE_PX,\n} from '../config';\nimport { IS_IOS, IS_MAC_OS } from '../util/browser/windowEnvironment';\nimport { DEFAULT_APP_CONFIG } from '../limits';\n\nexport const INITIAL_PERFORMANCE_STATE_MAX: PerformanceType = {\n  animatedEmoji: true,\n  autoplayGifs: true,\n  autoplayVideos: true,\n  contextMenuAnimations: true,\n  contextMenuBlur: true,\n  loopAnimatedStickers: true,\n  mediaViewerAnimations: true,\n  messageComposerAnimations: true,\n  messageSendingAnimations: true,\n  pageTransitions: true,\n  reactionEffects: true,\n  rightColumnAnimations: true,\n  stickerEffects: true,\n  storyRibbonAnimations: true,\n  snapEffect: true,\n};\n\nexport const INITIAL_PERFORMANCE_STATE_MED: PerformanceType = {\n  animatedEmoji: true,\n  autoplayGifs: true,\n  autoplayVideos: true,\n  contextMenuAnimations: true,\n  contextMenuBlur: true,\n  loopAnimatedStickers: true,\n  mediaViewerAnimations: true,\n  messageComposerAnimations: true,\n  messageSendingAnimations: true,\n  pageTransitions: true,\n  reactionEffects: true,\n  rightColumnAnimations: false,\n  stickerEffects: true,\n  storyRibbonAnimations: true,\n  snapEffect: false,\n};\n\nexport const INITIAL_PERFORMANCE_STATE_MIN: PerformanceType = {\n  animatedEmoji: false,\n  autoplayGifs: false,\n  autoplayVideos: false,\n  contextMenuAnimations: false,\n  contextMenuBlur: false,\n  loopAnimatedStickers: false,\n  mediaViewerAnimations: false,\n  messageComposerAnimations: false,\n  messageSendingAnimations: false,\n  pageTransitions: false,\n  reactionEffects: false,\n  rightColumnAnimations: false,\n  stickerEffects: false,\n  storyRibbonAnimations: false,\n  snapEffect: false,\n};\n\nexport const INITIAL_SHARED_STATE: SharedState = {\n  settings: {\n    theme: 'light',\n    shouldUseSystemTheme: true,\n    messageTextSize: IS_IOS\n      ? IOS_DEFAULT_MESSAGE_TEXT_SIZE_PX\n      : (IS_MAC_OS ? MACOS_DEFAULT_MESSAGE_TEXT_SIZE_PX : DEFAULT_MESSAGE_TEXT_SIZE_PX),\n    animationLevel: ANIMATION_LEVEL_DEFAULT,\n    messageSendKeyCombo: 'enter',\n    performance: INITIAL_PERFORMANCE_STATE_MAX,\n    shouldSkipWebAppCloseConfirmation: false,\n    language: 'en',\n    timeFormat: '24h',\n    wasTimeFormatSetManually: false,\n    isConnectionStatusMinimized: true,\n    canDisplayChatInTitle: true,\n    shouldAllowHttpTransport: true,\n    shouldWarnAboutFiles: true,\n  },\n  isInitial: true,\n};\n\nexport const INITIAL_GLOBAL_STATE: GlobalState = {\n  cacheVersion: 2,\n  isInited: true,\n  attachMenu: { bots: {} },\n  passcode: {},\n  twoFaSettings: {},\n  isAppUpdateAvailable: false,\n  shouldShowContextMenuHint: true,\n  appConfig: DEFAULT_APP_CONFIG,\n\n  audioPlayer: {\n    lastPlaybackRate: DEFAULT_PLAYBACK_RATE,\n  },\n\n  mediaViewer: {\n    lastPlaybackRate: DEFAULT_PLAYBACK_RATE,\n  },\n\n  authRememberMe: true,\n  countryList: {\n    phoneCodes: [],\n    general: [],\n  },\n\n  blocked: {\n    ids: [],\n    totalCount: 0,\n  },\n\n  users: {\n    byId: {},\n    statusesById: {},\n    fullInfoById: {},\n    previewMediaByBotId: {},\n    commonChatsById: {},\n    botAppPermissionsById: {},\n  },\n\n  peers: {\n    profilePhotosById: {},\n  },\n\n  chats: {\n    listIds: {},\n    isFullyLoaded: {},\n    orderedPinnedIds: {},\n    totalCount: {},\n    lastMessageIds: {},\n    byId: {},\n    fullInfoById: {},\n    similarChannelsById: {},\n    similarBotsById: {},\n    topicsInfoById: {},\n    notifyExceptionById: {},\n    loadingParameters: {\n      active: {},\n      archived: {},\n      saved: {},\n    },\n  },\n\n  messages: {\n    byChatId: {},\n    sponsoredByChatId: {},\n    pollById: {},\n    webPageById: {},\n    playbackByChatId: {},\n  },\n\n  stories: {\n    byPeerId: {},\n    albumsByPeerId: {},\n    orderedPeerIds: {\n      archived: [],\n      active: [],\n    },\n    hasNext: true,\n    hasNextInArchive: true,\n    stealthMode: {},\n  },\n\n  groupCalls: {\n    byId: {},\n  },\n\n  attachmentSettings: {\n    shouldCompress: true,\n    defaultAttachmentCompression: 'compress',\n    shouldSendGrouped: true,\n    isInvertedMedia: undefined,\n    webPageMediaSize: undefined,\n    shouldSendInHighQuality: false,\n  },\n\n  scheduledMessages: {\n    byChatId: {},\n  },\n\n  quickReplies: {\n    byId: {},\n    messagesById: {},\n  },\n\n  chatFolders: {\n    byId: {},\n    invites: {},\n    areTagsEnabled: false,\n  },\n\n  fileUploads: {\n    byMessageKey: {},\n  },\n\n  recentEmojis: ['grinning', 'kissing_heart', 'christmas_tree', 'brain', 'trophy', 'duck', 'cherries'],\n  recentCustomEmojis: ['5377305978079288312'],\n\n  reactions: {\n    defaultTags: [],\n    topReactions: [],\n    recentReactions: [],\n    effectReactions: [],\n    hash: {},\n  },\n  availableEffectById: {},\n\n  stickers: {\n    setsById: {},\n    added: {},\n    recent: {\n      stickers: [],\n    },\n    favorite: {\n      stickers: [],\n    },\n    greeting: {\n      stickers: [],\n    },\n    premium: {\n      stickers: [],\n    },\n    featured: {\n      setIds: [],\n    },\n    effect: {\n      stickers: [],\n      emojis: [],\n    },\n    forEmoji: {},\n  },\n\n  customEmojis: {\n    lastRendered: [],\n    byId: {},\n    added: {},\n    forEmoji: {},\n    statusRecent: {},\n  },\n\n  emojiKeywords: {},\n\n  gifs: {\n    saved: {},\n  },\n\n  topPeers: {},\n\n  topInlineBots: {},\n  topBotApps: {},\n\n  activeSessions: {\n    byHash: {},\n    orderedHashes: [],\n  },\n\n  activeWebSessions: {\n    byHash: {},\n    orderedHashes: [],\n  },\n\n  settings: {\n    byKey: {\n      canAutoLoadPhotoFromContacts: true,\n      canAutoLoadPhotoInPrivateChats: true,\n      canAutoLoadPhotoInGroups: true,\n      canAutoLoadPhotoInChannels: true,\n      canAutoLoadVideoFromContacts: true,\n      canAutoLoadVideoInPrivateChats: true,\n      canAutoLoadVideoInGroups: true,\n      canAutoLoadVideoInChannels: true,\n      canAutoLoadFileFromContacts: false,\n      canAutoLoadFileInPrivateChats: false,\n      canAutoLoadFileInGroups: false,\n      canAutoLoadFileInChannels: false,\n      autoLoadFileMaxSizeMb: 10,\n      hasWebNotifications: true,\n      hasPushNotifications: true,\n      notificationSoundVolume: 5,\n      shouldSuggestStickers: true,\n      shouldSuggestCustomEmoji: true,\n      shouldPaidMessageAutoApprove: false,\n      shouldUpdateStickerSetOrder: true,\n      shouldArchiveAndMuteNewNonContact: false,\n      shouldNewNonContactPeersRequirePremium: false,\n      disallowedGifts: undefined,\n      nonContactPeersPaidStars: 0,\n      shouldHideReadMarks: false,\n      canTranslate: false,\n      canTranslateChats: true,\n      doNotTranslate: [],\n    },\n    privacy: {},\n    botVerificationShownPeerIds: [],\n    themes: {\n      light: {\n        isBlurred: true,\n        patternColor: DEFAULT_PATTERN_COLOR,\n      },\n      dark: {\n        isBlurred: true,\n        patternColor: DARK_THEME_PATTERN_COLOR,\n      },\n    },\n    accountDaysTtl: 365,\n  },\n\n  serviceNotifications: [],\n  trustedBotIds: [],\n\n  transcriptions: {},\n  translations: {\n    byChatId: {},\n  },\n\n  byTabId: {},\n  sharedState: INITIAL_SHARED_STATE,\n\n  archiveSettings: {\n    isMinimized: false,\n    isHidden: false,\n  },\n};\n\nexport const INITIAL_TAB_STATE: TabState = {\n  id: 0,\n  isMasterTab: false,\n  isLeftColumnShown: true,\n  newChatMembersProgress: NewChatMembersProgress.Closed,\n  uiReadyState: 0,\n  shouldInit: true,\n\n  gifSearch: {},\n  stickerSearch: {},\n\n  messageLists: [],\n  activeChatFolder: 0,\n  tabThreads: {},\n\n  inlineBots: {\n    isLoading: false,\n    byUsername: {},\n  },\n\n  webApps: {\n    openedWebApps: {},\n    openedOrderedKeys: [],\n    sessionKeys: [],\n    modalState: 'maximized',\n    isModalOpen: false,\n    isMoreAppsTabActive: false,\n  },\n\n  globalSearch: {},\n\n  userSearch: {},\n\n  leftColumn: {\n    contentKey: LeftColumnContent.ChatList,\n    settingsScreen: SettingsScreens.Main,\n  },\n\n  middleSearch: {\n    byChatThreadKey: {},\n  },\n\n  sharedMediaSearch: {\n    byChatThreadKey: {},\n  },\n\n  chatMediaSearch: {\n    byChatThreadKey: {},\n  },\n\n  management: {\n    byChatId: {},\n  },\n\n  chatInfo: {\n    isOpen: false,\n  },\n\n  savedGifts: {\n    filter: {\n      ...DEFAULT_GIFT_PROFILE_FILTER_OPTIONS,\n    },\n    collectionsByPeerId: {},\n    activeCollectionByPeerId: {},\n  },\n\n  resaleGifts: {\n    gifts: [],\n    count: 0,\n    updateIteration: 0,\n    filter: {\n      ...DEFAULT_RESALE_GIFTS_FILTER_OPTIONS,\n    },\n  },\n\n  storyViewer: {\n    isMuted: true,\n    isRibbonShown: false,\n  },\n\n  mediaViewer: {\n    volume: DEFAULT_VOLUME,\n    playbackRate: DEFAULT_PLAYBACK_RATE,\n    isMuted: false,\n  },\n\n  audioPlayer: {\n    volume: DEFAULT_VOLUME,\n    playbackRate: DEFAULT_PLAYBACK_RATE,\n    isMuted: false,\n  },\n\n  isShareMessageModalShown: false,\n\n  isWebAppsCloseConfirmationModalOpen: false,\n\n  forwardMessages: {},\n\n  replyingMessage: {},\n\n  pollResults: {},\n\n  payment: {},\n  starsPayment: {},\n\n  notifications: [],\n\n  dialogs: [],\n\n  activeReactions: {},\n\n  activeDownloads: {},\n\n  statistics: {\n    byChatId: {},\n  },\n\n  pollModal: {\n    isOpen: false,\n  },\n\n  requestedTranslations: {\n    byChatId: {},\n  },\n\n  isPaymentMessageConfirmDialogOpen: false,\n};\n","import type {\n  ApiChat, ApiChatFullInfo, ApiChatType,\n} from '../../api/types';\nimport type { ChatListType } from '../../types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport {\n  ALL_FOLDER_ID, ARCHIVED_FOLDER_ID, MEMBERS_LOAD_SLICE, SAVED_FOLDER_ID, SERVICE_NOTIFICATIONS_USER_ID,\n} from '../../config';\nimport { IS_TRANSLATION_SUPPORTED } from '../../util/browser/windowEnvironment';\nimport { isUserId } from '../../util/entities/ids';\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport {\n  getHasAdminRight,\n  getPrivateChatUserId,\n  isChatChannel,\n  isChatPublic,\n  isChatSuperGroup,\n  isHistoryClearMessage,\n  isUserBot,\n  isUserOnline,\n} from '../helpers';\nimport { selectActiveRestrictionReasons } from './messages';\nimport { selectTabState } from './tabs';\nimport {\n  selectBot, selectIsCurrentUserPremium, selectUser, selectUserFullInfo,\n} from './users';\n\nexport function selectChat<T extends GlobalState>(global: T, chatId: string): ApiChat | undefined {\n  return global.chats.byId[chatId];\n}\n\nexport function selectChatFullInfo<T extends GlobalState>(global: T, chatId: string): ApiChatFullInfo | undefined {\n  return global.chats.fullInfoById[chatId];\n}\n\nexport function selectPeerFullInfo<T extends GlobalState>(global: T, peerId: string) {\n  if (isUserId(peerId)) return selectUserFullInfo(global, peerId);\n  return selectChatFullInfo(global, peerId);\n}\n\nexport function selectChatListLoadingParameters<T extends GlobalState>(\n  global: T, listType: ChatListType,\n) {\n  return global.chats.loadingParameters[listType];\n}\n\nexport function selectChatUser<T extends GlobalState>(global: T, chat: ApiChat) {\n  const userId = getPrivateChatUserId(chat);\n  if (!userId) {\n    return false;\n  }\n\n  return selectUser(global, userId);\n}\n\nexport function selectIsChatWithSelf<T extends GlobalState>(global: T, chatId: string) {\n  return chatId === global.currentUserId;\n}\n\nexport function selectIsChatWithBot<T extends GlobalState>(global: T, chat: ApiChat) {\n  const user = selectChatUser(global, chat);\n  return user && isUserBot(user);\n}\n\nexport function selectSupportChat<T extends GlobalState>(global: T) {\n  return Object.values(global.chats.byId).find(({ isSupport }: ApiChat) => isSupport);\n}\n\nexport function selectChatOnlineCount<T extends GlobalState>(global: T, chat: ApiChat) {\n  const fullInfo = selectChatFullInfo(global, chat.id);\n  if (isUserId(chat.id) || isChatChannel(chat) || !fullInfo) {\n    return undefined;\n  }\n\n  if (!fullInfo.members || fullInfo.members.length === MEMBERS_LOAD_SLICE) {\n    return fullInfo.onlineCount;\n  }\n\n  return fullInfo.members.reduce((onlineCount, { userId }) => {\n    if (\n      !selectIsChatWithSelf(global, userId)\n      && global.users.byId[userId]\n      && isUserOnline(global.users.byId[userId], global.users.statusesById[userId])\n    ) {\n      return onlineCount + 1;\n    }\n\n    return onlineCount;\n  }, 0);\n}\n\nexport function selectIsTrustedBot<T extends GlobalState>(global: T, botId: string) {\n  return global.trustedBotIds.includes(botId);\n}\n\nexport function selectChatType<T extends GlobalState>(global: T, chatId: string): ApiChatType | undefined {\n  const bot = selectBot(global, chatId);\n  if (bot) {\n    return 'bots';\n  }\n\n  const user = selectUser(global, chatId);\n  if (user) {\n    return 'users';\n  }\n\n  const chat = selectChat(global, chatId);\n  if (!chat) return undefined;\n\n  if (isChatChannel(chat)) {\n    return 'channels';\n  }\n\n  return 'chats';\n}\n\nexport function selectIsChatBotNotStarted<T extends GlobalState>(global: T, chatId: string) {\n  const bot = selectBot(global, chatId);\n  if (!bot) {\n    return false;\n  }\n\n  const lastMessage = selectChatLastMessage(global, chatId);\n  if (lastMessage && isHistoryClearMessage(lastMessage)) {\n    return true;\n  }\n\n  return Boolean(!lastMessage);\n}\n\nexport function selectAreActiveChatsLoaded<T extends GlobalState>(global: T): boolean {\n  return Boolean(global.chats.listIds.active);\n}\n\nexport function selectIsChatListed<T extends GlobalState>(\n  global: T, chatId: string, type?: ChatListType,\n): boolean {\n  const { listIds } = global.chats;\n  if (type) {\n    const targetList = listIds[type];\n    return Boolean(targetList && targetList.includes(chatId));\n  }\n\n  return Object.values(listIds).some((list) => list && list.includes(chatId));\n}\n\nexport function selectChatListType<T extends GlobalState>(\n  global: T, chatId: string,\n): 'active' | 'archived' | undefined {\n  const chat = selectChat(global, chatId);\n  if (!chat || !selectIsChatListed(global, chatId)) {\n    return undefined;\n  }\n\n  return chat.folderId === ARCHIVED_FOLDER_ID ? 'archived' : 'active';\n}\n\nexport function selectChatFolder<T extends GlobalState>(global: T, folderId: number) {\n  return global.chatFolders.byId[folderId];\n}\n\nexport function selectTotalChatCount<T extends GlobalState>(global: T, listType: 'active' | 'archived'): number {\n  const { totalCount } = global.chats;\n  const allChatsCount = totalCount.all;\n  const archivedChatsCount = totalCount.archived || 0;\n\n  if (listType === 'archived') {\n    return archivedChatsCount;\n  }\n\n  return allChatsCount ? allChatsCount - archivedChatsCount : 0;\n}\n\nexport function selectIsChatPinned<T extends GlobalState>(\n  global: T, chatId: string, folderId = ALL_FOLDER_ID,\n): boolean {\n  const { active, archived, saved } = global.chats.orderedPinnedIds;\n\n  if (folderId === ALL_FOLDER_ID) {\n    return Boolean(active?.includes(chatId));\n  }\n\n  if (folderId === ARCHIVED_FOLDER_ID) {\n    return Boolean(archived?.includes(chatId));\n  }\n\n  if (folderId === SAVED_FOLDER_ID) {\n    return Boolean(saved?.includes(chatId));\n  }\n\n  const { byId: chatFoldersById } = global.chatFolders;\n\n  const { pinnedChatIds } = chatFoldersById[folderId] || {};\n  return Boolean(pinnedChatIds?.includes(chatId));\n}\n\n// Slow, not to be used in `withGlobal`\nexport function selectChatByUsername<T extends GlobalState>(global: T, username: string) {\n  const usernameLowered = username.toLowerCase();\n  return Object.values(global.chats.byId).find(\n    (chat) => chat.usernames?.some((c) => c.username.toLowerCase() === usernameLowered),\n  );\n}\n\nexport function selectIsServiceChatReady<T extends GlobalState>(global: T) {\n  return Boolean(selectChat(global, SERVICE_NOTIFICATIONS_USER_ID));\n}\n\nexport function selectSendAs<T extends GlobalState>(global: T, chatId: string) {\n  const chat = selectChat(global, chatId);\n  if (!chat) return undefined;\n\n  const id = selectChatFullInfo(global, chatId)?.sendAsId;\n  if (!id) return undefined;\n\n  return selectUser(global, id) || selectChat(global, id);\n}\n\nexport function selectRequestedDraft<T extends GlobalState>(\n  global: T, chatId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { requestedDraft } = selectTabState(global, tabId);\n  if (requestedDraft?.chatId === chatId && !requestedDraft.files?.length) {\n    return requestedDraft.text;\n  }\n  return undefined;\n}\n\nexport function selectRequestedDraftFiles<T extends GlobalState>(\n  global: T, chatId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { requestedDraft } = selectTabState(global, tabId);\n  if (requestedDraft?.chatId === chatId) {\n    return requestedDraft.files;\n  }\n  return undefined;\n}\n\nexport function filterChatIdsByType<T extends GlobalState>(\n  global: T, chatIds: string[], filter: readonly ApiChatType[],\n) {\n  return chatIds.filter((id) => {\n    const type = selectChatType(global, id);\n    if (!type) {\n      return false;\n    }\n    return filter.includes(type);\n  });\n}\n\nexport function selectCanInviteToChat<T extends GlobalState>(global: T, chatId: string) {\n  const chat = selectChat(global, chatId);\n  if (!chat) return false;\n\n  // https://github.com/TelegramMessenger/Telegram-iOS/blob/5126be83b3b9578fb014eb52ca553da9e7a8b83a/submodules/TelegramCore/Sources/TelegramEngine/Peers/Communities.swift#L6\n  return !chat.migratedTo && Boolean(!isUserId(chatId) && ((isChatChannel(chat) || isChatSuperGroup(chat)) ? (\n    chat.isCreator || getHasAdminRight(chat, 'inviteUsers')\n    || (isChatPublic(chat) && !chat.isJoinRequest)\n  ) : (chat.isCreator || getHasAdminRight(chat, 'inviteUsers'))));\n}\n\nexport function selectCanShareFolder<T extends GlobalState>(global: T, folderId: number) {\n  const folder = selectChatFolder(global, folderId);\n  if (!folder) return false;\n\n  const {\n    bots, groups, channels, contacts, nonContacts, includedChatIds, pinnedChatIds,\n    excludeArchived, excludeMuted, excludeRead, excludedChatIds,\n  } = folder;\n\n  return !bots && !groups && !channels && !contacts && !nonContacts\n    && !excludeArchived && !excludeMuted && !excludeRead && !excludedChatIds?.length\n    && (pinnedChatIds?.length || includedChatIds.length)\n    && folder.includedChatIds.concat(folder.pinnedChatIds || []).some((chatId) => {\n      return selectCanInviteToChat(global, chatId);\n    });\n}\n\nexport function selectShouldDetectChatLanguage<T extends GlobalState>(\n  global: T, chatId: string,\n) {\n  const chat = selectChat(global, chatId);\n  if (!chat) return false;\n\n  if (chat.hasAutoTranslation) return true;\n\n  const { canTranslateChats } = global.settings.byKey;\n\n  const isPremium = selectIsCurrentUserPremium(global);\n  const isSavedMessages = selectIsChatWithSelf(global, chatId);\n\n  return IS_TRANSLATION_SUPPORTED && canTranslateChats && isPremium && !isSavedMessages;\n}\n\nexport function selectCanTranslateChat<T extends GlobalState>(\n  global: T, chatId: string, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const chat = selectChat(global, chatId);\n  if (!chat) return false;\n\n  const requestedTranslation = selectRequestedChatTranslationLanguage(global, chatId, tabId);\n  if (requestedTranslation) return true; // Prevent translation dropping on reevaluation\n\n  const isLanguageDetectable = selectShouldDetectChatLanguage(global, chatId);\n  const detectedLanguage = chat.detectedLanguage;\n\n  const { doNotTranslate } = global.settings.byKey;\n\n  return Boolean(isLanguageDetectable && detectedLanguage && !doNotTranslate.includes(detectedLanguage));\n}\n\nexport function selectRequestedChatTranslationLanguage<T extends GlobalState>(\n  global: T, chatId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { requestedTranslations } = selectTabState(global, tabId);\n\n  return requestedTranslations.byChatId[chatId]?.toLanguage;\n}\n\nexport function selectSimilarChannelIds<T extends GlobalState>(\n  global: T,\n  chatId: string,\n) {\n  return global.chats.similarChannelsById[chatId];\n}\n\nexport function selectSimilarBotsIds<T extends GlobalState>(\n  global: T,\n  chatId: string,\n) {\n  return global.chats.similarBotsById[chatId];\n}\n\nexport function selectChatLastMessageId<T extends GlobalState>(\n  global: T, chatId: string, listType: 'all' | 'saved' = 'all',\n) {\n  return global.chats.lastMessageIds[listType]?.[chatId];\n}\n\nexport function selectChatLastMessage<T extends GlobalState>(\n  global: T, chatId: string, listType: 'all' | 'saved' = 'all',\n) {\n  const id = selectChatLastMessageId(global, chatId, listType);\n  if (!id) return undefined;\n\n  const realChatId = listType === 'saved' ? global.currentUserId! : chatId;\n  return global.messages.byChatId[realChatId]?.byId[id];\n}\n\nexport function selectIsMonoforumAdmin<T extends GlobalState>(\n  global: T, chatId: string,\n) {\n  const chat = selectChat(global, chatId);\n  if (!chat?.isMonoforum) return;\n\n  const channel = selectMonoforumChannel(global, chatId);\n  if (!channel) return;\n\n  return Boolean(chat.isCreator || chat.adminRights || channel.isCreator || channel.adminRights);\n}\n\n/**\n * Only selects monoforum channel for monoforum chats.\n * Returns `undefined` for other chats, including channels that have linked monoforum.\n */\nexport function selectMonoforumChannel<T extends GlobalState>(\n  global: T, chatId: string,\n) {\n  const chat = selectChat(global, chatId);\n  if (!chat) return;\n\n  return chat.isMonoforum ? selectChat(global, chat.linkedMonoforumId!) : undefined;\n}\n\nexport function selectIsChatRestricted<T extends GlobalState>(global: T, chatId: string): boolean {\n  const chat = selectChat(global, chatId);\n  if (!chat) return false;\n\n  const activeRestrictions = selectActiveRestrictionReasons(global, chat.restrictionReasons);\n  return activeRestrictions.length > 0;\n}\n","/// In seconds\nexport const MINUTE = 60;\nexport const HOUR = 3600;\nexport const DAY = 86400;\n\nexport function getMinutes(seconds: number, roundDown?: boolean) {\n  const roundFunc = roundDown ? Math.floor : Math.ceil;\n  return roundFunc(seconds / MINUTE);\n}\n\nexport function getHours(seconds: number, roundDown?: boolean) {\n  const roundFunc = roundDown ? Math.floor : Math.ceil;\n  return roundFunc(seconds / HOUR);\n}\n\nexport function getDays(seconds: number, roundDown?: boolean) {\n  const roundFunc = roundDown ? Math.floor : Math.ceil;\n  return roundFunc(seconds / DAY);\n}\n\nexport function getSeconds(hours: number, minutes: number, seconds: number) {\n  return hours * HOUR + minutes * MINUTE + seconds;\n}\n","import type { PerformanceType } from '../types';\n\nexport function applyPerformanceSettings(performanceType: PerformanceType) {\n  const {\n    pageTransitions,\n    messageSendingAnimations,\n    mediaViewerAnimations,\n    messageComposerAnimations,\n    contextMenuAnimations,\n    contextMenuBlur,\n    rightColumnAnimations,\n  } = performanceType;\n\n  const root = document.body;\n\n  root.classList.toggle('no-page-transitions', !pageTransitions);\n  root.classList.toggle('no-message-sending-animations', !messageSendingAnimations);\n  root.classList.toggle('no-media-viewer-animations', !mediaViewerAnimations);\n  root.classList.toggle('no-message-composer-animations', !messageComposerAnimations);\n  root.classList.toggle('no-context-menu-animations', !contextMenuAnimations);\n  root.classList.toggle('no-menu-blur', !contextMenuBlur);\n  root.classList.toggle('no-right-column-animations', !rightColumnAnimations);\n}\n","import type { MouseEvent as ReactMouseEvent } from 'react';\nimport type { FC, TeactNode } from '../../lib/teact/teact';\nimport type React from '../../lib/teact/teact';\nimport { memo, useMemo, useRef } from '../../lib/teact/teact';\nimport { getActions } from '../../global';\n\nimport type {\n  ApiPeer, ApiPhoto, ApiWebDocument,\n} from '../../api/types';\nimport type { ObserveFn } from '../../hooks/useIntersectionObserver';\nimport type { CustomPeer, StoryViewerOrigin } from '../../types';\nimport { ApiMediaFormat } from '../../api/types';\n\nimport { IS_TEST } from '../../config';\nimport {\n  getChatAvatarHash,\n  getChatTitle,\n  getPeerStoryHtmlId,\n  getUserFullName,\n  getVideoProfilePhotoMediaHash,\n  getWebDocumentHash,\n  isAnonymousForwardsChat,\n  isChatWithRepliesBot,\n  isDeletedUser,\n} from '../../global/helpers';\nimport { isApiPeerChat, isApiPeerUser } from '../../global/helpers/peers';\nimport buildClassName, { createClassNameBuilder } from '../../util/buildClassName';\nimport buildStyle from '../../util/buildStyle';\nimport { isUserId } from '../../util/entities/ids';\nimport { getFirstLetters } from '../../util/textFormat';\nimport { REM } from './helpers/mediaDimensions';\nimport { getPeerColorClass } from './helpers/peerColor';\nimport renderText from './helpers/renderText';\n\nimport { useFastClick } from '../../hooks/useFastClick';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useMedia from '../../hooks/useMedia';\nimport useMediaTransition from '../../hooks/useMediaTransition';\nimport useOldLang from '../../hooks/useOldLang';\n\nimport OptimizedVideo from '../ui/OptimizedVideo';\nimport AvatarStoryCircle from './AvatarStoryCircle';\nimport Icon from './icons/Icon';\n\nimport './Avatar.scss';\n\nconst LOOP_COUNT = 3;\n\nexport const AVATAR_SIZES = {\n  micro: REM,\n  mini: 1.5 * REM,\n  tiny: 2 * REM,\n  small: 2.125 * REM,\n  medium: 2.75 * REM,\n  large: 3.375 * REM,\n  giant: 5.625 * REM,\n  jumbo: 7.5 * REM,\n};\n\nexport type AvatarSize =\n  'micro' | 'mini' | 'tiny' | 'small' | 'medium' | 'large' | 'giant' | 'jumbo' | number;\n\nconst cn = createClassNameBuilder('Avatar');\ncn.media = cn('media');\ncn.icon = cn('icon');\n\ntype OwnProps = {\n  className?: string;\n  style?: string;\n  size?: AvatarSize;\n  peer?: ApiPeer | CustomPeer;\n  photo?: ApiPhoto;\n  webPhoto?: ApiWebDocument;\n  previewUrl?: string;\n  text?: string;\n  isSavedMessages?: boolean;\n  isSavedDialog?: boolean;\n  withVideo?: boolean;\n  withStory?: boolean;\n  forPremiumPromo?: boolean;\n  withStoryGap?: boolean;\n  withStorySolid?: boolean;\n  storyColors?: string[];\n  forceFriendStorySolid?: boolean;\n  forceUnreadStorySolid?: boolean;\n  storyViewerOrigin?: StoryViewerOrigin;\n  storyViewerMode?: 'full' | 'single-peer' | 'disabled';\n  loopIndefinitely?: boolean;\n  noPersonalPhoto?: boolean;\n  asMessageBubble?: boolean;\n  observeIntersection?: ObserveFn;\n  onClick?: (e: ReactMouseEvent<HTMLDivElement, MouseEvent>, hasMedia: boolean) => void;\n  onContextMenu?: (e: React.MouseEvent) => void;\n  onMouseMove?: (e: React.MouseEvent) => void;\n};\n\nconst Avatar: FC<OwnProps> = ({\n  className,\n  style,\n  size = 'large',\n  peer,\n  photo,\n  webPhoto,\n  previewUrl,\n  text,\n  isSavedMessages,\n  isSavedDialog,\n  withVideo,\n  withStory,\n  forPremiumPromo,\n  withStoryGap,\n  withStorySolid,\n  storyColors,\n  forceFriendStorySolid,\n  forceUnreadStorySolid,\n  storyViewerOrigin,\n  storyViewerMode = 'single-peer',\n  loopIndefinitely,\n  noPersonalPhoto,\n  asMessageBubble,\n  onClick,\n  onContextMenu,\n  onMouseMove,\n}) => {\n  const { openStoryViewer } = getActions();\n\n  const ref = useRef<HTMLDivElement>();\n  const videoLoopCountRef = useRef(0);\n  const isCustomPeer = peer && 'isCustomPeer' in peer;\n  const realPeer = peer && !isCustomPeer ? peer : undefined;\n  const user = realPeer && isApiPeerUser(realPeer) ? realPeer : undefined;\n  const chat = realPeer && isApiPeerChat(realPeer) ? realPeer : undefined;\n  const isDeleted = user && isDeletedUser(user);\n  const isReplies = realPeer && isChatWithRepliesBot(realPeer.id);\n  const isAnonymousForwards = realPeer && isAnonymousForwardsChat(realPeer.id);\n  const isForum = chat?.isForum;\n\n  const isStoryClickable = withStory && storyViewerMode !== 'disabled' && realPeer?.hasStories;\n\n  let imageHash: string | undefined;\n  let videoHash: string | undefined;\n\n  const pxSize = typeof size === 'number' ? size : AVATAR_SIZES[size];\n\n  const shouldLoadVideo = withVideo && photo?.isVideo;\n\n  const isBig = pxSize >= AVATAR_SIZES.jumbo;\n  if (!isSavedMessages && !isDeleted) {\n    if ((user && !noPersonalPhoto) || chat) {\n      imageHash = getChatAvatarHash(peer as ApiPeer, isBig ? 'big' : undefined);\n    } else if (photo) {\n      imageHash = `photo${photo.id}?size=m`;\n      if (photo.isVideo && withVideo) {\n        videoHash = getVideoProfilePhotoMediaHash(photo);\n      }\n    } else if (webPhoto) {\n      imageHash = getWebDocumentHash(webPhoto);\n    }\n  }\n\n  const specialIcon = useMemo(() => {\n    if (isCustomPeer) {\n      return peer.avatarIcon;\n    }\n\n    if (isSavedMessages) {\n      return isSavedDialog ? 'my-notes' : 'avatar-saved-messages';\n    }\n\n    if (isDeleted) {\n      return 'avatar-deleted-account';\n    }\n\n    if (isReplies) {\n      return 'reply-filled';\n    }\n\n    if (isAnonymousForwards) {\n      return 'author-hidden';\n    }\n\n    return undefined;\n  }, [isCustomPeer, isSavedMessages, isDeleted, isReplies, isAnonymousForwards, peer, isSavedDialog]);\n\n  const imgBlobUrl = useMedia(imageHash, false, ApiMediaFormat.BlobUrl);\n  const videoBlobUrl = useMedia(videoHash, !shouldLoadVideo, ApiMediaFormat.BlobUrl);\n  const imgUrl = imgBlobUrl || previewUrl;\n  const hasBlobUrl = Boolean(imgUrl || videoBlobUrl);\n  // `videoBlobUrl` can be taken from memory cache, so we need to check `shouldLoadVideo` again\n  const shouldPlayVideo = Boolean(videoBlobUrl && shouldLoadVideo);\n\n  const { ref: mediaRef } = useMediaTransition<HTMLImageElement>({ hasMediaData: hasBlobUrl });\n\n  const handleVideoEnded = useLastCallback((e) => {\n    const video = e.currentTarget;\n    if (!videoBlobUrl) return;\n\n    if (loopIndefinitely) return;\n\n    videoLoopCountRef.current += 1;\n    if (videoLoopCountRef.current >= LOOP_COUNT) {\n      video.style.display = 'none';\n    }\n  });\n\n  const lang = useOldLang();\n\n  let content: TeactNode | undefined;\n  const author = user ? getUserFullName(user) : (chat ? getChatTitle(lang, chat) : text);\n\n  if (specialIcon) {\n    content = (\n      <Icon\n        name={specialIcon}\n        className={cn.icon}\n        role=\"img\"\n        ariaLabel={author}\n      />\n    );\n  } else if (hasBlobUrl) {\n    content = (\n      <>\n        <img\n          ref={mediaRef}\n          src={imgUrl}\n          className={buildClassName(cn.media, 'avatar-media', videoBlobUrl && 'poster')}\n          alt={author}\n          decoding=\"async\"\n          draggable={false}\n        />\n        {shouldPlayVideo && (\n          <OptimizedVideo\n            canPlay\n            src={videoBlobUrl}\n            className={buildClassName(cn.media, 'avatar-media', 'poster')}\n            muted\n            loop={loopIndefinitely}\n            autoPlay\n            disablePictureInPicture\n            playsInline\n            draggable={false}\n            onEnded={handleVideoEnded}\n          />\n        )}\n      </>\n    );\n  } else if (user) {\n    const userFullName = getUserFullName(user);\n    content = userFullName ? getFirstLetters(userFullName, 2) : undefined;\n  } else if (chat) {\n    const title = getChatTitle(lang, chat);\n    content = title && getFirstLetters(title, isUserId(chat.id) ? 2 : 1);\n  } else if (isCustomPeer) {\n    const title = peer.title || lang(peer.titleKey!);\n    content = title && getFirstLetters(title, 1);\n  } else if (text) {\n    content = getFirstLetters(text, 2);\n  }\n\n  const isRoundedRect = (isCustomPeer && peer.isAvatarSquare)\n    || (isForum && !((withStory || withStorySolid) && realPeer?.hasStories));\n  const isPremiumGradient = isCustomPeer && peer.withPremiumGradient;\n  const customColor = isCustomPeer && peer.customPeerAvatarColor;\n\n  const fullClassName = buildClassName(\n    'Avatar',\n    className,\n    getPeerColorClass(peer),\n    !peer && text && 'hidden-user',\n    isSavedMessages && 'saved-messages',\n    isAnonymousForwards && 'anonymous-forwards',\n    isDeleted && 'deleted-account',\n    isReplies && 'replies-bot-account',\n    isPremiumGradient && 'premium-gradient-bg',\n    isRoundedRect && 'forum',\n    asMessageBubble && 'message-bubble',\n    (photo || webPhoto) && 'force-fit',\n    ((withStory && realPeer?.hasStories) || forPremiumPromo) && 'with-story-circle',\n    withStorySolid && realPeer?.hasStories && 'with-story-solid',\n    withStorySolid && forceFriendStorySolid && 'close-friend',\n    withStorySolid && (realPeer?.hasUnreadStories || forceUnreadStorySolid) && 'has-unread-story',\n    (onClick || isStoryClickable) && 'interactive',\n    (!isSavedMessages && !imgUrl) && 'no-photo',\n  );\n\n  const hasMedia = Boolean(isSavedMessages || imgUrl);\n\n  const { handleClick, handleMouseDown } = useFastClick((e: ReactMouseEvent<HTMLDivElement, MouseEvent>) => {\n    if (isStoryClickable) {\n      e.stopPropagation();\n\n      openStoryViewer({\n        peerId: realPeer.id,\n        isSinglePeer: storyViewerMode === 'single-peer',\n        origin: storyViewerOrigin,\n      });\n      return;\n    }\n\n    if (onClick) {\n      onClick(e, hasMedia);\n    }\n  });\n\n  return (\n    <div\n      ref={ref}\n      className={fullClassName}\n      id={realPeer?.id && withStory ? getPeerStoryHtmlId(realPeer.id) : undefined}\n      data-peer-id={realPeer?.id}\n      data-test-sender-id={IS_TEST ? realPeer?.id : undefined}\n      aria-label={typeof content === 'string' ? author : undefined}\n      style={buildStyle(`--_size: ${pxSize}px;`, customColor && `--color-user: ${customColor}`, style)}\n      onClick={handleClick}\n      onContextMenu={onContextMenu}\n      onMouseDown={handleMouseDown}\n      onMouseMove={onMouseMove}\n    >\n      <div className=\"inner\">\n        {typeof content === 'string' ? renderText(content, [isBig ? 'hq_emoji' : 'emoji']) : content}\n      </div>\n      {withStory && realPeer?.hasStories && (\n        <AvatarStoryCircle\n          peerId={realPeer.id}\n          size={pxSize}\n          withExtraGap={withStoryGap}\n          colors={storyColors}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default memo(Avatar);\n","import type { CallbackManager } from './callbacks';\n\nimport { createCallbackManager } from './callbacks';\n\ninterface SignalState<T> {\n  value: T;\n  effects: CallbackManager;\n}\n\nconst SIGNAL_MARK = Symbol('SIGNAL_MARK');\n\nexport type Signal<T = unknown> = ((() => T) & {\n  readonly [SIGNAL_MARK]: symbol;\n  subscribe: (cb: AnyToVoidFunction) => NoneToVoidFunction;\n  once: (cb: AnyToVoidFunction) => NoneToVoidFunction;\n});\n\nexport type SignalSetter<T = unknown> = (newValue: T) => void;\n\nexport function isSignal(obj: unknown): obj is Signal {\n  return typeof obj === 'function' && SIGNAL_MARK in obj;\n}\n\n// A shorthand to unsubscribe effect from all signals\nconst unsubscribesByEffect = new Map<NoneToVoidFunction, Set<NoneToVoidFunction>>();\n\nlet currentEffect: NoneToVoidFunction | undefined;\n\nexport function createSignal<T>(defaultValue?: T) {\n  const state: SignalState<typeof defaultValue> = {\n    value: defaultValue,\n    effects: createCallbackManager(),\n  };\n\n  function subscribe(effect: NoneToVoidFunction) {\n    const unsubscribe = state.effects.addCallback(effect);\n\n    if (!unsubscribesByEffect.has(effect)) {\n      unsubscribesByEffect.set(effect, new Set([unsubscribe]));\n    } else {\n      unsubscribesByEffect.get(effect)!.add(unsubscribe);\n    }\n\n    return () => {\n      unsubscribe();\n\n      const unsubscribes = unsubscribesByEffect.get(effect)!;\n      unsubscribes.delete(unsubscribe);\n      if (!unsubscribes.size) {\n        unsubscribesByEffect.delete(effect);\n      }\n    };\n  }\n\n  function once(effect: NoneToVoidFunction) {\n    const unsub = subscribe(() => {\n      unsub();\n      effect();\n    });\n\n    return unsub;\n  }\n\n  function getter() {\n    if (currentEffect) {\n      subscribe(currentEffect);\n    }\n\n    return state.value;\n  }\n\n  function setter(newValue: T) {\n    if (state.value === newValue) {\n      return;\n    }\n\n    state.value = newValue;\n    state.effects.runCallbacks();\n  }\n\n  const signal = Object.assign(getter as Signal<T>, {\n    [SIGNAL_MARK]: SIGNAL_MARK,\n    subscribe,\n    once,\n  });\n\n  return [signal, setter] as const;\n}\n\nexport function cleanupEffect(effect: NoneToVoidFunction) {\n  unsubscribesByEffect.get(effect)?.forEach((unsubscribe) => {\n    unsubscribe();\n  });\n  unsubscribesByEffect.delete(effect);\n}\n","import type { FC } from '../../lib/teact/teact';\nimport type React from '../../lib/teact/teact';\nimport {\n  useCallback, useMemo, useRef, useState,\n} from '../../lib/teact/teact';\n\nimport Icon from '../common/icons/Icon';\nimport Button from './Button';\nimport Menu from './Menu';\n\nimport './DropdownMenu.scss';\n\ntype OwnProps = {\n  className?: string;\n  bubbleClassName?: string;\n  trigger?: FC<{ onTrigger: () => void; isOpen?: boolean }>;\n  transformOriginX?: number;\n  transformOriginY?: number;\n  positionX?: 'left' | 'right';\n  positionY?: 'top' | 'bottom';\n  footer?: string;\n  forceOpen?: boolean;\n  onOpen?: NoneToVoidFunction;\n  onClose?: NoneToVoidFunction;\n  onHide?: NoneToVoidFunction;\n  onTransitionEnd?: NoneToVoidFunction;\n  onMouseEnterBackdrop?: (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => void;\n  children: React.ReactNode;\n  autoClose?: boolean;\n};\n\nconst DropdownMenu: FC<OwnProps> = ({\n  trigger,\n  className,\n  bubbleClassName,\n  children,\n  transformOriginX,\n  transformOriginY,\n  positionX = 'left',\n  positionY = 'top',\n  footer,\n  forceOpen,\n  onOpen,\n  onClose,\n  onTransitionEnd,\n  onMouseEnterBackdrop,\n  onHide,\n  autoClose = true,\n}) => {\n  const menuRef = useRef<HTMLDivElement>();\n  const [isOpen, setIsOpen] = useState(false);\n\n  const toggleIsOpen = () => {\n    setIsOpen(!isOpen);\n\n    if (isOpen) {\n      onClose?.();\n    } else {\n      onOpen?.();\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent<any>) => {\n    const menu = menuRef.current;\n\n    if (!isOpen || e.keyCode !== 40 || !menu) {\n      return;\n    }\n\n    const focusedElement = document.activeElement;\n    const elementChildren = Array.from(menu.children);\n\n    if (!focusedElement || elementChildren.indexOf(focusedElement) === -1) {\n      (elementChildren[0] as HTMLElement).focus();\n    }\n  };\n\n  const handleClose = useCallback(() => {\n    setIsOpen(false);\n    onClose?.();\n  }, [onClose]);\n\n  const triggerComponent: FC<{ onTrigger: () => void; isOpen?: boolean }> = useMemo(() => {\n    if (trigger) return trigger;\n\n    return ({ onTrigger, isOpen: isMenuOpen }) => (\n      <Button\n        round\n        size=\"smaller\"\n        color=\"translucent\"\n        className={isMenuOpen ? 'active' : ''}\n        onClick={onTrigger}\n        ariaLabel=\"More actions\"\n      >\n        <Icon name=\"more\" />\n      </Button>\n    );\n  }, [trigger]);\n\n  return (\n    <div\n      className={`DropdownMenu ${className || ''}`}\n      onKeyDown={handleKeyDown}\n      onTransitionEnd={onTransitionEnd}\n    >\n      {triggerComponent({ onTrigger: toggleIsOpen, isOpen })}\n\n      <Menu\n        ref={menuRef}\n        isOpen={isOpen || Boolean(forceOpen)}\n        className={className || ''}\n        bubbleClassName={bubbleClassName || ''}\n        transformOriginX={transformOriginX}\n        transformOriginY={transformOriginY}\n        positionX={positionX}\n        positionY={positionY}\n        footer={footer}\n        autoClose={autoClose}\n        onClose={handleClose}\n        onCloseAnimationEnd={onHide}\n        onMouseEnterBackdrop={onMouseEnterBackdrop}\n      >\n        {children}\n      </Menu>\n    </div>\n  );\n};\n\nexport default DropdownMenu;\n","import type { ElementRef } from '../lib/teact/teact';\nimport { useEffect } from '../lib/teact/teact';\n\nimport { hasActiveViewTransition } from './animations/useViewTransition';\n\nconst BACKDROP_CLASSNAME = 'backdrop';\n\n// This effect implements closing menus by clicking outside of them\n// without adding extra elements to the DOM\nexport default function useVirtualBackdrop(\n  isOpen: boolean,\n  containerRef: ElementRef<HTMLElement>,\n  onClose?: () => void | undefined,\n  ignoreRightClick?: boolean,\n  excludedClosestSelector?: string,\n) {\n  useEffect(() => {\n    if (!isOpen || !onClose) {\n      return undefined;\n    }\n\n    const handleEvent = (e: MouseEvent) => {\n      const container = containerRef.current;\n      const target = e.target as HTMLElement | null;\n      if (!container || !target || (ignoreRightClick && e.button === 2) || hasActiveViewTransition()) {\n        return;\n      }\n\n      if ((\n        !container.contains(e.target as Node | null)\n        || target.classList.contains(BACKDROP_CLASSNAME)\n      ) && !(excludedClosestSelector && (\n        target.matches(excludedClosestSelector) || target.closest(excludedClosestSelector)\n      ))) {\n        e.preventDefault();\n        e.stopPropagation();\n        onClose?.();\n      }\n    };\n\n    document.addEventListener('mousedown', handleEvent);\n\n    return () => {\n      document.removeEventListener('mousedown', handleEvent);\n    };\n  }, [excludedClosestSelector, ignoreRightClick, isOpen, containerRef, onClose]);\n}\n","export function areDeepEqual<T>(value1: T, value2: T): boolean {\n  const type1 = typeof value1;\n  const type2 = typeof value2;\n  if (type1 !== type2) {\n    return false;\n  }\n\n  // eslint-disable-next-line no-null/no-null\n  if (type1 !== 'object' || value1 === null || value2 === null) {\n    return value1 === value2;\n  }\n\n  const isArray1 = Array.isArray(value1);\n  const isArray2 = Array.isArray(value2);\n\n  if (isArray1 !== isArray2) {\n    return false;\n  }\n\n  if (isArray1) {\n    const array1 = value1 as any[];\n    const array2 = value2 as any[];\n\n    if (array1.length !== array2.length) {\n      return false;\n    }\n\n    return array1.every((member1, i) => areDeepEqual(member1, array2[i]));\n  }\n\n  const object1 = value1 as AnyLiteral;\n  const object2 = value2 as AnyLiteral;\n  const keys1 = Object.keys(object1);\n\n  return keys1.length === Object.keys(object2).length\n    && keys1.every((key1) => areDeepEqual(object1[key1], object2[key1]));\n}\n","import EMOJI_REGEX from '../../lib/twemojiRegex';\n\n// Non-standard variations of emojis, used on some devices\nconst EMOJI_EXCEPTIONS: [string | RegExp, string][] = [\n  [/\\u{1f3f3}\\u200d\\u{1f308}/gu, '\\u{1f3f3}\\ufe0f\\u200d\\u{1f308}'], // \n  [/\\u{1f3f3}\\u200d\\u26a7\\ufe0f?/gu, '\\u{1f3f3}\\ufe0f\\u200d\\u26a7\\ufe0f'], // \n  [/\\u26d3\\u200d\\u{1f4a5}/gu, '\\u26d3\\ufe0f\\u200d\\u{1f4a5}'], // \n  [/\\u200d([\\u2640\\u2642])(?!\\ufe0f)/gu, '\\u200d$1\\ufe0f'], // Gender variation without 0xFE0F\n];\n\nexport default function fixNonStandardEmoji(text: string) {\n  // Non-standard sequences typically parsed as separate emojis, so no need to fix text without any\n  if (!text.match(EMOJI_REGEX)) return text;\n\n  for (const [regex, replacement] of EMOJI_EXCEPTIONS) {\n    text = text.replace(regex, replacement);\n  }\n\n  return text;\n}\n","import type { FC } from '../../lib/teact/teact';\nimport type React from '../../lib/teact/teact';\n\nimport type { IconName } from '../../types/icons';\n\nimport { IS_TEST } from '../../config';\nimport buildClassName from '../../util/buildClassName';\n\nimport useAppLayout from '../../hooks/useAppLayout';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useOldLang from '../../hooks/useOldLang';\n\nimport Icon from '../common/icons/Icon';\n\nimport './MenuItem.scss';\n\nexport type MenuItemProps = {\n  customIcon?: React.ReactNode;\n  className?: string;\n  children: React.ReactNode;\n  onClick?: (e: React.SyntheticEvent<HTMLDivElement | HTMLAnchorElement>, arg?: number) => void;\n  clickArg?: number;\n  onContextMenu?: (e: React.UIEvent) => void;\n  href?: string;\n  rel?: string;\n  target?: string;\n  download?: string;\n  disabled?: boolean;\n  destructive?: boolean;\n  ariaLabel?: string;\n  withWrap?: boolean;\n  withPreventDefaultOnMouseDown?: boolean;\n} & ({\n  icon: 'A' | 'K';\n  isCharIcon: true;\n} | {\n  icon?: IconName;\n  isCharIcon?: false;\n});\n\nconst MenuItem: FC<MenuItemProps> = (props) => {\n  const {\n    icon,\n    isCharIcon,\n    customIcon,\n    className,\n    children,\n    onClick,\n    href,\n    target,\n    download,\n    disabled,\n    destructive,\n    ariaLabel,\n    withWrap,\n    rel = 'noopener noreferrer',\n    onContextMenu,\n    clickArg,\n    withPreventDefaultOnMouseDown,\n  } = props;\n\n  const lang = useOldLang();\n  const { isTouchScreen } = useAppLayout();\n  const handleClick = useLastCallback((e: React.MouseEvent<HTMLDivElement>) => {\n    if (disabled || !onClick) {\n      e.preventDefault();\n      return;\n    }\n    onClick(e, clickArg);\n  });\n\n  const handleKeyDown = useLastCallback((e: React.KeyboardEvent<HTMLDivElement>) => {\n    if (e.keyCode !== 13 && e.keyCode !== 32) {\n      return;\n    }\n\n    if (disabled || !onClick) {\n      e.preventDefault();\n\n      return;\n    }\n    onClick(e, clickArg);\n  });\n  const handleMouseDown = useLastCallback((e: React.SyntheticEvent<HTMLDivElement | HTMLAnchorElement>) => {\n    if (withPreventDefaultOnMouseDown) {\n      e.preventDefault();\n    }\n  });\n\n  const fullClassName = buildClassName(\n    'MenuItem',\n    className,\n    disabled && 'disabled',\n    destructive && 'destructive',\n    !isTouchScreen && 'compact',\n    withWrap && 'wrap',\n  );\n\n  const content = (\n    <>\n      {!customIcon && icon && (\n        <Icon name={isCharIcon ? 'char' : icon} character={isCharIcon ? icon : undefined} />\n      )}\n      {customIcon}\n      {children}\n    </>\n  );\n\n  if (href && !disabled) {\n    return (\n      <a\n        tabIndex={0}\n        className={fullClassName}\n        href={href}\n        download={download}\n        aria-label={ariaLabel}\n        title={ariaLabel}\n        target={target || (href.startsWith(window.location.origin) || IS_TEST ? '_self' : '_blank')}\n        rel={rel}\n        dir={lang.isRtl ? 'rtl' : undefined}\n        onClick={onClick}\n        onMouseDown={handleMouseDown}\n      >\n        {content}\n      </a>\n    );\n  }\n\n  return (\n    <div\n      role=\"menuitem\"\n      tabIndex={0}\n      className={fullClassName}\n      onClick={handleClick}\n      onKeyDown={handleKeyDown}\n      onMouseDown={handleMouseDown}\n      onContextMenu={onContextMenu}\n      aria-label={ariaLabel}\n      title={ariaLabel}\n      dir={lang.isRtl ? 'rtl' : undefined}\n    >\n      {content}\n    </div>\n  );\n};\n\nexport default MenuItem;\n","const utf16 = {\n  // The utf16-class is necessary to convert from javascripts internal character representation to unicode and back.\n  decode: (input) => {\n    const output = [];\n    let i = 0;\n    const len = input.length;\n    let value;\n    let extra;\n\n    while (i < len) {\n      value = input.charCodeAt(i++);\n      if ((value & 0xf800) === 0xd800) {\n        extra = input.charCodeAt(i++);\n        if ((value & 0xfc00) !== 0xd800 || (extra & 0xfc00) !== 0xdc00) {\n          throw new RangeError('UTF-16(decode): Illegal UTF-16 sequence');\n        }\n        value = ((value & 0x3ff) << 10) + (extra & 0x3ff) + 0x10000;\n      }\n      output.push(value);\n    }\n    return output;\n  },\n  encode: (input) => {\n    const output = [];\n    let i = 0;\n    const len = input.length;\n    let value;\n\n    while (i < len) {\n      value = input[i++];\n      if ((value & 0xf800) === 0xd800) {\n        throw new RangeError('UTF-16(encode): Illegal UTF-16 value');\n      }\n      if (value > 0xffff) {\n        value -= 0x10000;\n        output.push(String.fromCharCode(((value >>> 10) & 0x3ff) | 0xd800));\n        value = 0xdc00 | (value & 0x3ff);\n      }\n      output.push(String.fromCharCode(value));\n    }\n    return output.join('');\n  },\n};\n\n// Default parameters\nconst initial_n = 0x80;\nconst initial_bias = 72;\nconst delimiter = '\\x2D';\nconst base = 36;\nconst damp = 700;\nconst tmin = 1;\nconst tmax = 26;\nconst skew = 38;\nconst maxint = 0x7fffffff;\n\n// decode_digit(cp) returns the numeric value of a basic code\n// point (for use in representing integers) in the range 0 to\n// base-1, or base if cp is does not represent a value.\n\nfunction decode_digit(cp) {\n  return cp - 48 < 10 ? cp - 22 : cp - 65 < 26 ? cp - 65 : cp - 97 < 26 ? cp - 97 : base;\n}\n\n// ** Bias adaptation function **\nfunction adapt(delta, numpoints, firsttime) {\n  let k;\n  delta = firsttime ? Math.floor(delta / damp) : delta >> 1;\n  delta += Math.floor(delta / numpoints);\n\n  for (k = 0; delta > ((base - tmin) * tmax) >> 1; k += base) {\n    delta = Math.floor(delta / (base - tmin));\n  }\n  return Math.floor(k + ((base - tmin + 1) * delta) / (delta + skew));\n}\n\n// Main decode\nfunction decode(input, preserveCase) {\n  // Dont use utf16\n  const output = [];\n  const case_flags = [];\n  const input_length = input.length;\n\n  let n;\n  let out;\n  let i;\n  let bias;\n  let basic;\n  let j;\n  let ic;\n  let oldi;\n  let w;\n  let k;\n  let digit;\n  let t;\n  let len;\n\n  // Initialize the state:\n\n  n = initial_n;\n  i = 0;\n  bias = initial_bias;\n\n  // Handle the basic code points: Let basic be the number of input code\n  // points before the last delimiter, or 0 if there is none, then\n  // copy the first basic code points to the output.\n\n  basic = input.lastIndexOf(delimiter);\n  if (basic < 0) basic = 0;\n\n  for (j = 0; j < basic; ++j) {\n    if (preserveCase) case_flags[output.length] = input.charCodeAt(j) - 65 < 26;\n    if (input.charCodeAt(j) >= 0x80) {\n      throw new RangeError('Illegal input >= 0x80');\n    }\n    output.push(input.charCodeAt(j));\n  }\n\n  // Main decoding loop: Start just after the last delimiter if any\n  // basic code points were copied; start at the beginning otherwise.\n\n  for (ic = basic > 0 ? basic + 1 : 0; ic < input_length;) {\n    // ic is the index of the next character to be consumed,\n\n    // Decode a generalized variable-length integer into delta,\n    // which gets added to i. The overflow checking is easier\n    // if we increase i as we go, then subtract off its starting\n    // value at the end to obtain delta.\n    for (oldi = i, w = 1, k = base; ; k += base) {\n      if (ic >= input_length) {\n        throw RangeError('punycode_bad_input(1)');\n      }\n      digit = decode_digit(input.charCodeAt(ic++));\n\n      if (digit >= base) {\n        throw RangeError('punycode_bad_input(2)');\n      }\n      if (digit > Math.floor((maxint - i) / w)) {\n        throw RangeError('punycode_overflow(1)');\n      }\n      i += digit * w;\n      t = k <= bias ? tmin : k >= bias + tmax ? tmax : k - bias;\n      if (digit < t) {\n        break;\n      }\n      if (w > Math.floor(maxint / (base - t))) {\n        throw RangeError('punycode_overflow(2)');\n      }\n      w *= base - t;\n    }\n\n    out = output.length + 1;\n    bias = adapt(i - oldi, out, oldi === 0);\n\n    // i was supposed to wrap around from out to 0,\n    // incrementing n each time, so we'll fix that now:\n    if (Math.floor(i / out) > maxint - n) {\n      throw RangeError('punycode_overflow(3)');\n    }\n    n += Math.floor(i / out);\n    i %= out;\n\n    // Insert n at position i of the output:\n    // Case of last character determines uppercase flag:\n    if (preserveCase) {\n      case_flags.splice(i, 0, input.charCodeAt(ic - 1) - 65 < 26);\n    }\n\n    output.splice(i, 0, n);\n    i++;\n  }\n  if (preserveCase) {\n    for (i = 0, len = output.length; i < len; i++) {\n      if (case_flags[i]) {\n        output[i] = String.fromCharCode(output[i])\n          .toUpperCase()\n          .charCodeAt(0);\n      }\n    }\n  }\n  return utf16.encode(output);\n}\n\nfunction toUnicode(domain) {\n  const domain_array = domain.split('.');\n  const out = [];\n  for (let i = 0; i < domain_array.length; ++i) {\n    const s = domain_array[i];\n    out.push(s.match(/^xn--/) ? decode(s.slice(4)) : s);\n  }\n  return out.join('.');\n}\n\nexport default toUnicode;\n","import { DEBUG } from '../../config';\nimport convertPunycode from '../../lib/punycode';\n\nconst PROTOCOL_WHITELIST = new Set(['http:', 'https:', 'tg:', 'ton:', 'mailto:', 'tel:']);\nconst FALLBACK_PREFIX = 'https://';\n\nexport function ensureProtocol(url: string) {\n  try {\n    const parsedUrl = new URL(url);\n\n    if (!PROTOCOL_WHITELIST.has(parsedUrl.protocol)) {\n      return `${FALLBACK_PREFIX}${url}`;\n    }\n\n    return url;\n  } catch (err) {\n    return `${FALLBACK_PREFIX}${url}`;\n  }\n}\n\nexport function getUnicodeUrl(url: string) {\n  const href = ensureProtocol(url);\n\n  try {\n    const parsedUrl = new URL(href);\n    const unicodeDomain = convertPunycode(parsedUrl.hostname);\n\n    try {\n      return decodeURI(parsedUrl.toString()).replace(parsedUrl.hostname, unicodeDomain);\n    } catch (err) { // URL contains invalid sequences, keep it as it is\n      return parsedUrl.toString().replace(parsedUrl.hostname, unicodeDomain);\n    }\n  } catch (error) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('SafeLink.getDecodedUrl error ', url, error);\n    }\n  }\n\n  return undefined;\n}\n\nexport function isMixedScriptUrl(url: string): boolean {\n  let domain;\n  try {\n    domain = convertPunycode(new URL(ensureProtocol(url)).hostname);\n  } catch (e) {\n    return true; // If URL is invalid, treat it as mixed script\n  }\n\n  let hasLatin = false;\n  let hasNonLatin = false;\n\n  for (const char of Array.from(domain)) {\n    if (!/\\p{L}/u.test(char)) continue; // Ignore non-letter characters\n\n    if (/\\p{Script=Latin}/u.test(char)) {\n      hasLatin = true;\n    } else {\n      hasNonLatin = true;\n    }\n\n    if (hasLatin && hasNonLatin) return true;\n  }\n\n  return false;\n}\n","import type { ThreadId } from '../../types';\n\nexport function buildChatThreadKey(chatId: string, threadId: ThreadId) {\n  return `${chatId}_${threadId}`;\n}\n","import { getAverageColor, getColorLuma } from './colors';\n\nconst LUMA_THRESHOLD = 240;\n\nexport function scaleImage(image: string | Blob, ratio: number, outputType: string = 'image/png'): Promise<string> {\n  const url = image instanceof Blob ? URL.createObjectURL(image) : image;\n  const img = new Image();\n  return new Promise((resolve) => {\n    img.onload = () => {\n      scale(img, img.width * ratio, img.height * ratio, outputType)\n        .then((blob) => {\n          if (!blob) throw new Error('Image resize failed!');\n          return URL.createObjectURL(blob);\n        })\n        .then(resolve)\n        .finally(() => {\n          if (image instanceof Blob) {\n            URL.revokeObjectURL(url); // Revoke blob url that we created\n          }\n        });\n    };\n    img.src = url;\n  });\n}\n\nexport function resizeImage(\n  image: string | Blob, width: number, height: number, outputType: string = 'image/png',\n): Promise<string> {\n  const url = image instanceof Blob ? URL.createObjectURL(image) : image;\n  const img = new Image();\n  return new Promise((resolve) => {\n    img.onload = () => {\n      scale(img, width, height, outputType)\n        .then((blob) => {\n          if (!blob) throw new Error('Image resize failed!');\n          return URL.createObjectURL(blob);\n        })\n        .then(resolve)\n        .finally(() => {\n          if (image instanceof Blob) {\n            URL.revokeObjectURL(url); // Revoke blob url that we created\n          }\n        });\n    };\n    img.src = url;\n  });\n}\n\nasync function scale(\n  img: HTMLImageElement, width: number, height: number, outputType: string = 'image/png',\n): Promise<Blob | null> {\n  // Safari does not have built-in resize method with quality control\n  if ('createImageBitmap' in window) {\n    try {\n      const bitmap = await window.createImageBitmap(img,\n        { resizeWidth: width, resizeHeight: height, resizeQuality: 'high' });\n      if (bitmap.height !== height || bitmap.width !== width) {\n        throw new Error('Image bitmap resize not supported!'); // FF93 added support for options, but not resize\n      }\n      const averageColor = await getAverageColor(img.src);\n      const fillColor = getColorLuma(averageColor) < LUMA_THRESHOLD ? '#fff' : '#000';\n      return await new Promise((res) => {\n        const canvas = document.createElement('canvas');\n        canvas.width = bitmap.width;\n        canvas.height = bitmap.height;\n        const ctx2D = canvas.getContext('2d')!;\n        ctx2D.fillStyle = fillColor;\n        ctx2D.fillRect(0, 0, canvas.width, canvas.height);\n        const ctx = canvas.getContext('bitmaprenderer');\n        if (ctx) {\n          ctx.transferFromImageBitmap(bitmap);\n        } else {\n          ctx2D.drawImage(bitmap, 0, 0);\n        }\n        canvas.toBlob(res, outputType);\n      });\n    } catch (e) {\n      // Fallback. Firefox below 93 does not recognize `createImageBitmap` with 2 parameters\n      return steppedScale(img, width, height, undefined, outputType);\n    }\n  } else {\n    return steppedScale(img, width, height, undefined, outputType);\n  }\n}\n\nasync function steppedScale(\n  img: HTMLImageElement, width: number, height: number, step: number = 0.5, outputType: string = 'image/png',\n): Promise<Blob | null> {\n  const canvas = document.createElement('canvas');\n  const ctx = canvas.getContext('2d')!;\n  const oc = document.createElement('canvas');\n  const octx = oc.getContext('2d')!;\n\n  canvas.width = width;\n  canvas.height = height;\n\n  if (img.width * step > width) { // For performance avoid unnecessary drawing\n    const mul = 1 / step;\n    let cur = {\n      width: Math.floor(img.width * step),\n      height: Math.floor(img.height * step),\n    };\n\n    oc.width = cur.width;\n    oc.height = cur.height;\n\n    octx.drawImage(img, 0, 0, cur.width, cur.height);\n\n    while (cur.width * step > width) {\n      cur = {\n        width: Math.floor(cur.width * step),\n        height: Math.floor(cur.height * step),\n      };\n      octx.drawImage(oc, 0, 0, cur.width * mul, cur.height * mul, 0, 0, cur.width, cur.height);\n    }\n\n    ctx.drawImage(oc, 0, 0, cur.width, cur.height, 0, 0, canvas.width, canvas.height);\n  } else {\n    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n  }\n\n  const averageColor = await getAverageColor(img.src);\n  const fillColor = getColorLuma(averageColor) < LUMA_THRESHOLD ? '#fff' : '#000';\n  ctx.fillStyle = fillColor;\n  ctx.globalCompositeOperation = 'destination-over';\n  ctx.fillRect(0, 0, canvas.width, canvas.height);\n  return new Promise((resolve) => {\n    canvas.toBlob(resolve, outputType);\n  });\n}\n","// Sometimes event is fired earlier than animation completes\nconst ANIMATION_END_DELAY = 50;\n\nexport function waitForTransitionEnd(\n  node: Node, handler: NoneToVoidFunction, propertyName?: string, fallbackMs?: number,\n) {\n  return waitForEndEvent('transitionend', node, handler, propertyName, fallbackMs);\n}\n\nexport function waitForAnimationEnd(\n  node: Node, handler: NoneToVoidFunction, animationName?: string, fallbackMs?: number,\n) {\n  return waitForEndEvent('animationend', node, handler, animationName, fallbackMs);\n}\n\nfunction waitForEndEvent(\n  eventType: 'transitionend' | 'animationend',\n  node: Node,\n  handler: NoneToVoidFunction,\n  detailedName?: string,\n  fallbackMs?: number,\n) {\n  let isHandled = false;\n\n  function cleanup() {\n    node.removeEventListener(eventType, handleAnimationEnd);\n  }\n\n  function handleAnimationEnd(e: TransitionEvent | AnimationEvent | Event) {\n    if (isHandled || e.target !== e.currentTarget) {\n      return;\n    }\n\n    if (detailedName && (\n      (e instanceof TransitionEvent && e.propertyName === detailedName)\n      || (e instanceof AnimationEvent && e.animationName === detailedName)\n    )) {\n      return;\n    }\n\n    isHandled = true;\n\n    cleanup();\n\n    setTimeout(() => {\n      handler();\n    }, ANIMATION_END_DELAY);\n  }\n\n  node.addEventListener(eventType, handleAnimationEnd);\n\n  if (fallbackMs) {\n    setTimeout(() => {\n      if (isHandled) return;\n\n      cleanup();\n\n      handler();\n    }, fallbackMs);\n  }\n\n  return cleanup;\n}\n","import { useCallback, useRef } from '../lib/teact/teact';\nimport { getActions } from '../global';\n\nimport { IS_TEST } from '../config';\nimport { requestMeasure } from '../lib/fasterdom/fasterdom';\nimport { IS_IOS } from '../util/browser/windowEnvironment';\nimport useEffectOnce from './useEffectOnce';\nimport useLastCallback from './useLastCallback';\nimport useSyncEffect from './useSyncEffect';\n\nconst PATH_BASE = `${window.location.pathname}${window.location.search}`;\n// Carefully selected by swiping and observing visual changes\n// TODO: may be different on other devices such as iPad, maybe take dpi into account?\nconst SAFARI_EDGE_BACK_GESTURE_LIMIT = 300;\nconst SAFARI_EDGE_BACK_GESTURE_DURATION = 350;\n\ntype HistoryRecord = {\n  index: number;\n  // Should this record be replaced by the next record (for example Menu)\n  shouldBeReplaced?: boolean;\n  // Mark this record as replaced by the next record. Only used to check if needed to perform effectBack\n  markReplaced?: VoidFunction;\n  onBack?: VoidFunction;\n  // Set if the element is closed in the UI, but not in the real history\n  isClosed?: boolean;\n};\n\ntype HistoryOperationGo = {\n  type: 'go';\n  delta: number;\n};\n\ntype HistoryOperationState = {\n  type: 'pushState' | 'replaceState';\n  data: any;\n  hash?: string;\n};\n\ntype HistoryOperation = HistoryOperationGo | HistoryOperationState;\n\n// Needed to dismiss any 'trashed' history records from the previous page reloads.\nconst historyUniqueSessionId = Number(new Date());\n// Reflects real history state, but also contains information on which records should be replaced by the next record and\n// which records are deferred to close on the next operation\nlet historyState: HistoryRecord[];\n// Reflects current real history index\nlet historyCursor: number;\n// If we alter real history programmatically, the popstate event will be fired, which we don't need\nlet isAlteringHistory = false;\n// Unfortunately Safari doesn't really like when there's 2+ consequent history operations in one frame, so we need\n// to delay them to the next raf\nlet deferredHistoryOperations: HistoryOperation[] = [];\nlet deferredPopstateOperations: HistoryOperationState[] = [];\nlet isSafariGestureAnimation = false;\n\n// Do not remove: used for history unit tests\nif (IS_TEST) {\n  (window as any).TEST_getHistoryState = () => historyState;\n  (window as any).TEST_getHistoryCursor = () => historyCursor;\n}\n\nfunction handleTouchStart(event: TouchEvent) {\n  const x = event.touches[0].pageX;\n\n  if (x <= SAFARI_EDGE_BACK_GESTURE_LIMIT || x >= window.innerWidth - SAFARI_EDGE_BACK_GESTURE_LIMIT) {\n    isSafariGestureAnimation = true;\n  }\n}\n\nfunction handleTouchEnd() {\n  if (!isSafariGestureAnimation) {\n    return;\n  }\n\n  setTimeout(() => {\n    isSafariGestureAnimation = false;\n  }, SAFARI_EDGE_BACK_GESTURE_DURATION);\n}\n\nif (IS_IOS) {\n  window.addEventListener('touchstart', handleTouchStart);\n  window.addEventListener('touchend', handleTouchEnd);\n  window.addEventListener('popstate', handleTouchEnd);\n}\n\nfunction applyDeferredHistoryOperations() {\n  const goOperations = deferredHistoryOperations.filter((op) => op.type === 'go');\n  const stateOperations = deferredHistoryOperations.filter((op) => op.type !== 'go');\n  const goCount = goOperations.reduce((acc, op) => acc + op.delta, 0);\n\n  deferredHistoryOperations = [];\n\n  if (goCount) {\n    window.history.go(goCount);\n\n    // If we have some `state` operations after the `go` operations, we need to wait until the popstate event\n    // so the order of operations is correctly preserved\n    if (stateOperations.length) {\n      deferredPopstateOperations.push(...stateOperations);\n      return;\n    }\n  }\n\n  processStateOperations(stateOperations);\n}\n\nfunction processStateOperations(stateOperations: HistoryOperationState[]) {\n  stateOperations.forEach((op) => window.history[op.type](op.data, '', op.hash));\n}\n\nfunction deferHistoryOperation(historyOperation: HistoryOperation) {\n  if (!deferredHistoryOperations.length) {\n    requestMeasure(applyDeferredHistoryOperations);\n  }\n\n  deferredHistoryOperations.push(historyOperation);\n}\n\n// Resets history to the `root` state\nfunction resetHistory() {\n  historyCursor = 0;\n  historyState = [{\n    index: 0,\n    onBack: () => window.history.back(),\n  }];\n\n  window.history.replaceState({ index: 0, historyUniqueSessionId }, '', PATH_BASE);\n}\n\nresetHistory();\n\nfunction cleanupClosed(alreadyClosedCount = 1) {\n  let countClosed = alreadyClosedCount;\n  for (let i = historyCursor - 1; i > 0; i--) {\n    if (!historyState[i].isClosed) break;\n    countClosed++;\n  }\n  if (countClosed) {\n    isAlteringHistory = true;\n    deferHistoryOperation({\n      type: 'go',\n      delta: -countClosed,\n    });\n  }\n  return countClosed;\n}\n\nfunction cleanupTrashedState() {\n  // Navigation to previous page reload, state of which was trashed by reload\n  let isAnimationDisabled = false;\n  for (let i = historyState.length - 1; i > 0; i--) {\n    if (historyState[i].isClosed) {\n      continue;\n    }\n    // TODO[history]: probably we should not call this inside the loop\n    if (!isAnimationDisabled && isSafariGestureAnimation) {\n      getActions().disableHistoryAnimations();\n      isAnimationDisabled = true;\n    }\n    historyState[i].onBack?.();\n  }\n\n  resetHistory();\n}\n\nwindow.addEventListener('popstate', ({ state }: PopStateEvent) => {\n  if (isAlteringHistory) {\n    isAlteringHistory = false;\n    if (deferredPopstateOperations.length) {\n      processStateOperations(deferredPopstateOperations);\n      deferredPopstateOperations = [];\n    }\n    return;\n  }\n\n  if (!state) {\n    cleanupTrashedState();\n\n    if (!window.location.hash) {\n      return;\n    }\n    return;\n  }\n\n  const { index, historyUniqueSessionId: previousUniqueSessionId } = state;\n  if (previousUniqueSessionId !== historyUniqueSessionId) {\n    cleanupTrashedState();\n    return;\n  }\n\n  // New real history state matches the old virtual one. Not possible in theory, but in practice we have Safari\n  if (index === historyCursor) {\n    return;\n  }\n\n  if (index < historyCursor) {\n    // Navigating back\n    let alreadyClosedCount = 0;\n    let isAnimationDisabled = false;\n    for (let i = historyCursor; i > index - alreadyClosedCount; i--) {\n      if (historyState[i].isClosed) {\n        alreadyClosedCount++;\n        continue;\n      }\n      // TODO[history]: probably we should not call this inside the loop\n      if (!isAnimationDisabled && isSafariGestureAnimation) {\n        getActions().disableHistoryAnimations();\n        isAnimationDisabled = true;\n      }\n      historyState[i].onBack?.();\n    }\n\n    const countClosed = cleanupClosed(alreadyClosedCount);\n    historyCursor += index - historyCursor - countClosed;\n\n    // Can happen when we have deferred a real back for some element (for example Menu), closed via UI,\n    // pressed back button and caused a pushState.\n    if (historyCursor < 0) {\n      historyCursor = 0;\n    }\n  } else if (index > historyCursor) {\n    // Forward navigation is not yet supported\n    isAlteringHistory = true;\n    deferHistoryOperation({\n      type: 'go',\n      delta: -(index - historyCursor),\n    });\n  }\n});\n\nexport default function useHistoryBack({\n  isActive,\n  shouldBeReplaced,\n  shouldResetUrlHash,\n  hash,\n  onBack,\n}: {\n  isActive?: boolean;\n  shouldBeReplaced?: boolean;\n  hash?: string;\n  shouldResetUrlHash?: boolean;\n  onBack: VoidFunction;\n}) {\n  const lastOnBack = useLastCallback(onBack);\n\n  // Active index of the record\n  const indexRef = useRef<number>();\n  const wasReplaced = useRef(false);\n\n  const isFirstRender = useRef(true);\n\n  const pushState = useCallback((forceReplace = false) => {\n    // Check if the old state should be replaced\n    const shouldReplace = forceReplace || historyState[historyCursor].shouldBeReplaced;\n    indexRef.current = shouldReplace ? historyCursor : ++historyCursor;\n\n    historyCursor = indexRef.current;\n\n    // Mark the previous record as replaced so effectBack doesn't perform back operation on the new record\n    const previousRecord = historyState[indexRef.current];\n    if (previousRecord && !previousRecord.isClosed) {\n      previousRecord.markReplaced?.();\n    }\n\n    historyState[indexRef.current] = {\n      index: indexRef.current,\n      onBack: lastOnBack,\n      shouldBeReplaced,\n      markReplaced: () => {\n        wasReplaced.current = true;\n      },\n    };\n\n    deferHistoryOperation({\n      type: shouldReplace ? 'replaceState' : 'pushState',\n      data: {\n        index: indexRef.current,\n        historyUniqueSessionId,\n      },\n      // Space is a hack to make the browser completely remove the hash\n      hash: hash ? `#${hash}` : (shouldResetUrlHash ? ' ' : undefined),\n    });\n  }, [hash, shouldBeReplaced, shouldResetUrlHash]);\n\n  const processBack = useCallback(() => {\n    // Only process back on open records\n    if (indexRef.current && historyState[indexRef.current] && !wasReplaced.current) {\n      historyState[indexRef.current].isClosed = true;\n      wasReplaced.current = true;\n      if (indexRef.current === historyCursor && !shouldBeReplaced) {\n        historyCursor -= cleanupClosed();\n      }\n    }\n  }, [shouldBeReplaced]);\n\n  // Process back navigation when element is unmounted\n  useEffectOnce(() => {\n    isFirstRender.current = false;\n    return () => {\n      if (!isActive || wasReplaced.current) return;\n      processBack();\n    };\n  });\n\n  useSyncEffect(([prevIsActive]) => {\n    if (prevIsActive === isActive) return;\n    if (isFirstRender.current && !isActive) return;\n\n    if (isActive) {\n      pushState();\n    } else {\n      processBack();\n    }\n  }, [isActive, processBack, pushState]);\n}\n","import { getGlobal } from '../global';\n\nimport { DEBUG } from '../config';\nimport { selectTabState } from '../global/selectors';\nimport { IS_TAURI } from './browser/globalEnvironment';\n\nexport function updateAppBadge(unreadCount: number, isMuted?: boolean) {\n  if (IS_TAURI) {\n    window.tauri?.setNotificationsCount?.(unreadCount, isMuted);\n    return;\n  }\n\n  if (!selectTabState(getGlobal()).isMasterTab) return;\n  if (typeof window.navigator.setAppBadge !== 'function') {\n    return;\n  }\n\n  window.navigator.setAppBadge(unreadCount).catch((err) => {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.error(err);\n    }\n  });\n}\n","import type { ApiMessage, ApiMessageReplyInfo, ApiStoryReplyInfo } from '../../api/types';\n\nexport function getMessageReplyInfo(message: ApiMessage): ApiMessageReplyInfo | undefined {\n  const { replyInfo } = message;\n  if (!replyInfo || replyInfo.type !== 'message') return undefined;\n  return replyInfo;\n}\n\nexport function getStoryReplyInfo(message: ApiMessage): ApiStoryReplyInfo | undefined {\n  const { replyInfo } = message;\n  if (!replyInfo || replyInfo.type !== 'story') return undefined;\n  return replyInfo;\n}\n","import type { ApiPrivacySettings, ApiUsername } from '../../../api/types';\nimport type { ActionReturnType } from '../../types';\nimport {\n  ProfileEditProgress,\n  UPLOADING_WALLPAPER_SLUG,\n} from '../../../types';\n\nimport {\n  APP_CONFIG_REFETCH_INTERVAL,\n  COUNTRIES_WITH_12H_TIME_FORMAT,\n  MUTE_INDEFINITE_TIMESTAMP,\n  UNMUTE_TIMESTAMP,\n} from '../../../config';\nimport { getCurrentTabId } from '../../../util/establishMultitabRole';\nimport { buildCollectionByKey } from '../../../util/iteratees';\nimport { requestPermission, subscribe, unsubscribe } from '../../../util/notifications';\nimport { setTimeFormat } from '../../../util/oldLangProvider';\nimport requestActionTimeout from '../../../util/requestActionTimeout';\nimport { getServerTime } from '../../../util/serverTime';\nimport { callApi } from '../../../api/gramjs';\nimport { buildApiInputPrivacyRules } from '../../helpers';\nimport { addActionHandler, getGlobal, setGlobal } from '../../index';\nimport {\n  addBlockedUser, addNotifyExceptions, deletePeerPhoto,\n  removeBlockedUser, replaceSettings, updateChat,\n  updateNotifyDefaults, updateSharedSettings, updateUser, updateUserFullInfo,\n} from '../../reducers';\nimport { updateTabState } from '../../reducers/tabs';\nimport {\n  selectChat, selectIsCurrentUserFrozen,\n  selectTabState, selectUser,\n} from '../../selectors';\nimport { selectSharedSettings } from '../../selectors/sharedState';\n\naddActionHandler('updateProfile', async (global, actions, payload): Promise<void> => {\n  const {\n    photo, firstName, lastName, bio: about, username,\n    tabId = getCurrentTabId(),\n  } = payload;\n\n  const { currentUserId } = global;\n  if (!currentUserId) {\n    return;\n  }\n\n  global = updateTabState(global, {\n    profileEdit: {\n      progress: ProfileEditProgress.InProgress,\n    },\n  }, tabId);\n  setGlobal(global);\n\n  if (photo) {\n    await callApi('uploadProfilePhoto', photo);\n  }\n\n  if (firstName || lastName || about) {\n    const result = await callApi('updateProfile', { firstName, lastName, about });\n    if (result) {\n      global = getGlobal();\n      const currentUser = currentUserId && selectUser(global, currentUserId);\n\n      if (currentUser) {\n        global = updateUser(\n          global,\n          currentUser.id,\n          {\n            firstName,\n            lastName,\n          },\n        );\n        global = updateUserFullInfo(global, currentUser.id, { bio: about });\n        setGlobal(global);\n      }\n    }\n  }\n\n  if (username !== undefined) {\n    const result = await callApi('updateUsername', username);\n    global = getGlobal();\n    const currentUser = currentUserId && selectUser(global, currentUserId);\n\n    if (result && currentUser) {\n      const shouldUsernameUpdate = currentUser.usernames?.find((u) => u.isEditable);\n      const usernames = shouldUsernameUpdate\n        ? currentUser.usernames?.map((u) => (u.isEditable ? { ...u, username } : u))\n        : [{ username, isEditable: true, isActive: true } as ApiUsername, ...currentUser.usernames || []];\n      global = updateUser(global, currentUserId, { usernames });\n      setGlobal(global);\n    }\n  }\n\n  global = getGlobal();\n  global = updateTabState(global, {\n    profileEdit: {\n      progress: ProfileEditProgress.Complete,\n    },\n  }, tabId);\n  setGlobal(global);\n\n  if (photo) {\n    actions.loadFullUser({ userId: currentUserId, withPhotos: true });\n  }\n});\n\naddActionHandler('updateProfilePhoto', async (global, actions, payload): Promise<void> => {\n  const { photo, isFallback } = payload;\n  const { currentUserId } = global;\n  if (!currentUserId) return;\n  const currentUser = selectUser(global, currentUserId);\n  if (!currentUser) return;\n\n  global = updateUser(global, currentUserId, { avatarPhotoId: undefined });\n  global = updateUserFullInfo(global, currentUserId, { profilePhoto: undefined });\n\n  setGlobal(global);\n\n  const result = await callApi('updateProfilePhoto', photo, isFallback);\n  if (!result) return;\n\n  actions.loadFullUser({ userId: currentUserId, withPhotos: true });\n});\n\naddActionHandler('deleteProfilePhoto', async (global, actions, payload): Promise<void> => {\n  const { photo } = payload;\n  const { currentUserId } = global;\n  if (!currentUserId) return;\n\n  const isDeleted = await callApi('deleteProfilePhotos', [photo]);\n  if (!isDeleted) return;\n\n  global = getGlobal();\n  global = deletePeerPhoto(global, currentUserId, photo.id);\n  setGlobal(global);\n\n  actions.loadFullUser({ userId: currentUserId, withPhotos: true });\n});\n\naddActionHandler('checkUsername', async (global, actions, payload): Promise<void> => {\n  const { username, tabId = getCurrentTabId() } = payload;\n\n  let tabState = selectTabState(global, tabId);\n  // No need to check the username if profile update is already in progress\n  if (tabState.profileEdit && tabState.profileEdit.progress === ProfileEditProgress.InProgress) {\n    return;\n  }\n\n  global = updateTabState(global, {\n    profileEdit: {\n      progress: tabState.profileEdit ? tabState.profileEdit.progress : ProfileEditProgress.Idle,\n      checkedUsername: undefined,\n      isUsernameAvailable: undefined,\n      error: undefined,\n    },\n  }, tabId);\n  setGlobal(global);\n\n  const { result, error } = (await callApi('checkUsername', username));\n\n  global = getGlobal();\n  tabState = selectTabState(global, tabId);\n  global = updateTabState(global, {\n    profileEdit: {\n      ...tabState.profileEdit!,\n      checkedUsername: username,\n      isUsernameAvailable: result === true,\n      error,\n    },\n  }, tabId);\n  setGlobal(global);\n});\n\naddActionHandler('loadWallpapers', async (global): Promise<void> => {\n  const result = await callApi('fetchWallpapers');\n  if (!result) {\n    return;\n  }\n\n  global = getGlobal();\n  global = {\n    ...global,\n    settings: {\n      ...global.settings,\n      loadedWallpapers: result.wallpapers,\n    },\n  };\n  setGlobal(global);\n});\n\naddActionHandler('uploadWallpaper', async (global, actions, payload): Promise<void> => {\n  const file = payload;\n  const previewBlobUrl = URL.createObjectURL(file);\n\n  global = {\n    ...global,\n    settings: {\n      ...global.settings,\n      loadedWallpapers: [\n        {\n          slug: UPLOADING_WALLPAPER_SLUG,\n          document: {\n            mediaType: 'document',\n            fileName: '',\n            size: file.size,\n            mimeType: file.type,\n            previewBlobUrl,\n          },\n        },\n        ...(global.settings.loadedWallpapers || []),\n      ],\n    },\n  };\n  setGlobal(global);\n\n  const result = await callApi('uploadWallpaper', file);\n  if (!result) {\n    return;\n  }\n\n  const { wallpaper } = result;\n\n  global = getGlobal();\n  if (!global.settings.loadedWallpapers) {\n    return;\n  }\n\n  const firstWallpaper = global.settings.loadedWallpapers[0];\n  if (!firstWallpaper || firstWallpaper.slug !== UPLOADING_WALLPAPER_SLUG) {\n    return;\n  }\n\n  const withLocalMedia = {\n    ...wallpaper,\n    document: {\n      ...wallpaper.document,\n      previewBlobUrl,\n    },\n  };\n\n  global = {\n    ...global,\n    settings: {\n      ...global.settings,\n      loadedWallpapers: [\n        withLocalMedia,\n        ...global.settings.loadedWallpapers.slice(1),\n      ],\n    },\n  };\n  setGlobal(global);\n});\n\naddActionHandler('loadBlockedUsers', async (global): Promise<void> => {\n  const result = await callApi('fetchBlockedUsers', {});\n  if (!result) return;\n\n  global = getGlobal();\n\n  global = {\n    ...global,\n    blocked: {\n      ids: result.blockedIds,\n      totalCount: result.totalCount,\n    },\n  };\n\n  setGlobal(global);\n});\n\naddActionHandler('blockUser', async (global, actions, payload): Promise<void> => {\n  const { userId, isOnlyStories } = payload;\n\n  const user = selectUser(global, userId);\n  if (!user) return;\n\n  const result = await callApi('blockUser', {\n    user,\n    isOnlyStories: isOnlyStories || undefined,\n  });\n  if (!result) return;\n\n  global = getGlobal();\n  global = addBlockedUser(global, userId);\n  setGlobal(global);\n});\n\naddActionHandler('unblockUser', async (global, actions, payload): Promise<void> => {\n  const { userId, isOnlyStories } = payload;\n\n  const user = selectUser(global, userId);\n  if (!user) return;\n\n  const result = await callApi('unblockUser', {\n    user,\n    isOnlyStories: isOnlyStories || undefined,\n  });\n  if (!result) return;\n\n  global = getGlobal();\n  global = removeBlockedUser(global, userId);\n  setGlobal(global);\n});\n\naddActionHandler('loadNotificationExceptions', async (global): Promise<void> => {\n  const result = await callApi('fetchNotificationExceptions');\n  if (!result) {\n    return;\n  }\n\n  global = getGlobal();\n  global = addNotifyExceptions(global, result);\n  setGlobal(global);\n});\n\naddActionHandler('loadNotificationSettings', async (global): Promise<void> => {\n  const [signUpNotification, notifyDefaults] = await Promise.all([\n    callApi('fetchContactSignUpSetting'),\n    callApi('fetchNotifyDefaultSettings'),\n  ]);\n\n  if (!notifyDefaults) return;\n\n  global = getGlobal();\n  global = replaceSettings(global, {\n    hasContactJoinedNotifications: signUpNotification,\n  });\n  global = {\n    ...global,\n    settings: {\n      ...global.settings,\n      notifyDefaults,\n    },\n  };\n  setGlobal(global);\n});\n\naddActionHandler('updateNotificationSettings', async (global, actions, payload): Promise<void> => {\n  const { peerType, isMuted, shouldShowPreviews } = payload;\n\n  const result = await callApi('updateNotificationSettings', peerType, { isMuted, shouldShowPreviews });\n  if (!result) {\n    return;\n  }\n\n  global = getGlobal();\n  global = updateNotifyDefaults(global, peerType, {\n    mutedUntil: isMuted ? MUTE_INDEFINITE_TIMESTAMP : UNMUTE_TIMESTAMP,\n    shouldShowPreviews,\n  });\n  setGlobal(global);\n});\n\naddActionHandler('updateWebNotificationSettings', async (global, actions, payload): Promise<void> => {\n  const oldSettings = global.settings.byKey;\n  global = replaceSettings(global, payload);\n  setGlobal(global);\n  const { hasWebNotifications, hasPushNotifications } = global.settings.byKey;\n  if (!oldSettings.hasPushNotifications && hasPushNotifications) {\n    await subscribe();\n  }\n  if (oldSettings.hasPushNotifications && !hasPushNotifications) {\n    await unsubscribe();\n  }\n  if (!oldSettings.hasWebNotifications && hasWebNotifications) {\n    const isGranted = await requestPermission();\n    if (!isGranted) {\n      global = getGlobal();\n      global = replaceSettings(global, { hasWebNotifications: false });\n      setGlobal(global);\n    }\n  }\n});\n\naddActionHandler('updateContactSignUpNotification', async (global, actions, payload): Promise<void> => {\n  const { isSilent } = payload;\n\n  const result = await callApi('updateContactSignUpNotification', isSilent);\n  if (!result) {\n    return;\n  }\n\n  global = getGlobal();\n  global = replaceSettings(global, { hasContactJoinedNotifications: !isSilent });\n  setGlobal(global);\n});\n\naddActionHandler('loadLanguages', async (global): Promise<void> => {\n  const result = await callApi('fetchLanguages');\n  if (!result) {\n    return;\n  }\n\n  global = getGlobal();\n  global = updateSharedSettings(global, { languages: result });\n  setGlobal(global);\n});\n\naddActionHandler('loadPrivacySettings', async (global): Promise<void> => {\n  if (selectIsCurrentUserFrozen(global)) return;\n\n  const result = await Promise.all([\n    callApi('fetchPrivacySettings', 'phoneNumber'),\n    callApi('fetchPrivacySettings', 'addByPhone'),\n    callApi('fetchPrivacySettings', 'lastSeen'),\n    callApi('fetchPrivacySettings', 'profilePhoto'),\n    callApi('fetchPrivacySettings', 'forwards'),\n    callApi('fetchPrivacySettings', 'chatInvite'),\n    callApi('fetchPrivacySettings', 'phoneCall'),\n    callApi('fetchPrivacySettings', 'phoneP2P'),\n    callApi('fetchPrivacySettings', 'voiceMessages'),\n    callApi('fetchPrivacySettings', 'bio'),\n    callApi('fetchPrivacySettings', 'birthday'),\n    callApi('fetchPrivacySettings', 'gifts'),\n    callApi('fetchPrivacySettings', 'noPaidMessages'),\n  ]);\n\n  if (result.some((e) => e === undefined)) {\n    return;\n  }\n\n  const [\n    phoneNumberSettings,\n    addByPhoneSettings,\n    lastSeenSettings,\n    profilePhotoSettings,\n    forwardsSettings,\n    chatInviteSettings,\n    phoneCallSettings,\n    phoneP2PSettings,\n    voiceMessagesSettings,\n    bioSettings,\n    birthdaySettings,\n    giftsSettings,\n    noPaidMessagesSettings,\n  ] = result as {\n    rules: ApiPrivacySettings;\n  }[];\n\n  global = getGlobal();\n  global = {\n    ...global,\n    settings: {\n      ...global.settings,\n      privacy: {\n        ...global.settings.privacy,\n        phoneNumber: phoneNumberSettings.rules,\n        addByPhone: addByPhoneSettings.rules,\n        lastSeen: lastSeenSettings.rules,\n        profilePhoto: profilePhotoSettings.rules,\n        forwards: forwardsSettings.rules,\n        chatInvite: chatInviteSettings.rules,\n        phoneCall: phoneCallSettings.rules,\n        phoneP2P: phoneP2PSettings.rules,\n        voiceMessages: voiceMessagesSettings.rules,\n        bio: bioSettings.rules,\n        birthday: birthdaySettings.rules,\n        gifts: giftsSettings.rules,\n        noPaidMessages: noPaidMessagesSettings.rules,\n      },\n    },\n  };\n  setGlobal(global);\n});\n\naddActionHandler('setPrivacyVisibility', async (global, actions, payload): Promise<void> => {\n  const { privacyKey, visibility, onSuccess } = payload;\n\n  if (!global.settings.privacy[privacyKey]) {\n    const result = await callApi('fetchPrivacySettings', privacyKey);\n    if (!result) {\n      return;\n    }\n\n    global = getGlobal();\n    global = {\n      ...global,\n      settings: {\n        ...global.settings,\n        privacy: {\n          ...global.settings.privacy,\n          [privacyKey]: result.rules,\n        },\n      },\n    };\n    setGlobal(global);\n  }\n\n  const {\n    privacy: { [privacyKey]: settings },\n  } = global.settings;\n\n  if (!settings) {\n    return;\n  }\n\n  const rules = buildApiInputPrivacyRules(global, {\n    visibility,\n    allowedIds: [...settings.allowUserIds, ...settings.allowChatIds],\n    blockedIds: [...settings.blockUserIds, ...settings.blockChatIds],\n    botsPrivacy: settings.botsPrivacy,\n  });\n\n  const result = await callApi('setPrivacySettings', privacyKey, rules);\n  if (!result) {\n    return;\n  }\n\n  onSuccess?.();\n\n  global = getGlobal();\n  global = {\n    ...global,\n    settings: {\n      ...global.settings,\n      privacy: {\n        ...global.settings.privacy,\n        [privacyKey]: result.rules,\n      },\n    },\n  };\n  setGlobal(global);\n});\n\naddActionHandler('setPrivacySettings', async (global, actions, payload): Promise<void> => {\n  const {\n    privacyKey, isAllowList, updatedIds, isPremiumAllowed, botsPrivacy,\n  } = payload;\n  const {\n    privacy: { [privacyKey]: settings },\n  } = global.settings;\n\n  if (!settings) {\n    return;\n  }\n\n  if (privacyKey === 'noPaidMessages') {\n    global = getGlobal();\n    const idsForUpdate = [\n      ...updatedIds.filter((id) => !settings.allowUserIds.includes(id)),\n      ...settings.allowUserIds.filter((id) => !updatedIds.includes(id)),\n    ];\n\n    idsForUpdate.forEach((userId) => {\n      global = updateUserFullInfo(global, userId, {\n        settings: undefined,\n      });\n    });\n    setGlobal(global);\n  }\n\n  const rules = buildApiInputPrivacyRules(global, {\n    visibility: settings.visibility,\n    isUnspecified: settings.isUnspecified,\n    shouldAllowPremium: isPremiumAllowed,\n    allowedIds: isAllowList ? updatedIds : [...settings.allowUserIds, ...settings.allowChatIds],\n    blockedIds: !isAllowList ? updatedIds : [...settings.blockUserIds, ...settings.blockChatIds],\n    botsPrivacy,\n  });\n\n  const result = await callApi('setPrivacySettings', privacyKey, rules);\n  if (!result) {\n    return;\n  }\n\n  global = getGlobal();\n  global = {\n    ...global,\n    settings: {\n      ...global.settings,\n      privacy: {\n        ...global.settings.privacy,\n        [privacyKey]: result.rules,\n      },\n    },\n  };\n  setGlobal(global);\n});\n\naddActionHandler('updateIsOnline', (global, actions, payload): ActionReturnType => {\n  if (global.connectionState !== 'connectionStateReady') return;\n  callApi('updateIsOnline', payload.isOnline);\n});\n\naddActionHandler('loadContentSettings', async (global): Promise<void> => {\n  if (selectIsCurrentUserFrozen(global)) return;\n\n  const result = await callApi('fetchContentSettings');\n  if (!result) return;\n\n  global = getGlobal();\n  global = replaceSettings(global, result);\n  setGlobal(global);\n});\n\naddActionHandler('updateContentSettings', async (global, actions, payload): Promise<void> => {\n  global = replaceSettings(global, { isSensitiveEnabled: payload.isSensitiveEnabled });\n  setGlobal(global);\n\n  const result = await callApi('updateContentSettings', payload.isSensitiveEnabled);\n  if (!result) {\n    global = getGlobal();\n    global = replaceSettings(global, { isSensitiveEnabled: !payload.isSensitiveEnabled });\n    setGlobal(global);\n  }\n});\n\naddActionHandler('loadCountryList', async (global, actions, payload): Promise<void> => {\n  let { langCode } = payload;\n  if (!langCode) langCode = selectSharedSettings(global).language;\n\n  const countryList = await callApi('fetchCountryList', { langCode });\n  if (!countryList) return;\n\n  global = getGlobal();\n  global = {\n    ...global,\n    countryList,\n  };\n  setGlobal(global);\n});\n\naddActionHandler('ensureTimeFormat', async (global, actions): Promise<void> => {\n  if (global.authNearestCountry) {\n    const timeFormat = COUNTRIES_WITH_12H_TIME_FORMAT\n      .has(global.authNearestCountry.toUpperCase()) ? '12h' : '24h';\n    actions.setSharedSettingOption({ timeFormat });\n    setTimeFormat(timeFormat);\n  }\n\n  if (selectSharedSettings(global).wasTimeFormatSetManually) {\n    return;\n  }\n\n  const nearestCountryCode = await callApi('fetchNearestCountry');\n  if (nearestCountryCode) {\n    const timeFormat = COUNTRIES_WITH_12H_TIME_FORMAT.has(nearestCountryCode.toUpperCase()) ? '12h' : '24h';\n    actions.setSharedSettingOption({ timeFormat });\n    setTimeFormat(timeFormat);\n  }\n});\n\naddActionHandler('loadAppConfig', async (global, actions, payload): Promise<void> => {\n  const hash = payload?.hash;\n\n  const appConfig = await callApi('fetchAppConfig', hash);\n  if (!appConfig) return;\n\n  requestActionTimeout({\n    action: 'loadAppConfig',\n    payload: { hash: appConfig.hash },\n  }, APP_CONFIG_REFETCH_INTERVAL);\n\n  global = getGlobal();\n  global = {\n    ...global,\n    appConfig,\n    isAppConfigLoaded: true,\n  };\n  setGlobal(global);\n});\n\naddActionHandler('loadConfig', async (global): Promise<void> => {\n  const config = await callApi('fetchConfig');\n  if (!config) return;\n\n  global = getGlobal();\n  const timeout = config.expiresAt - getServerTime();\n  requestActionTimeout({\n    action: 'loadConfig',\n    payload: undefined,\n  }, timeout * 1000);\n\n  global = {\n    ...global,\n    config,\n  };\n  setGlobal(global);\n});\n\naddActionHandler('loadPeerColors', async (global): Promise<void> => {\n  const generalHash = global.peerColors?.generalHash;\n  const profileHash = global.peerColors?.profileHash;\n  const [generalResult, profileResult] = await Promise.all([\n    callApi('fetchPeerColors', generalHash),\n    callApi('fetchPeerProfileColors', profileHash),\n  ]);\n\n  if (!generalResult && !profileResult) return;\n\n  global = getGlobal();\n\n  const currentPeerColors = global.peerColors! || {};\n\n  global = {\n    ...global,\n    peerColors: {\n      ...currentPeerColors,\n      general: generalResult?.colors || currentPeerColors.general,\n      generalHash: generalResult?.hash || currentPeerColors.generalHash,\n      profile: profileResult?.colors || currentPeerColors.profile,\n      profileHash: profileResult?.hash || currentPeerColors.profileHash,\n    },\n  };\n  setGlobal(global);\n});\n\naddActionHandler('loadTimezones', async (global): Promise<void> => {\n  const hash = global.timezones?.hash;\n  const result = await callApi('fetchTimezones', hash);\n  if (!result) return;\n\n  global = getGlobal();\n  global = {\n    ...global,\n    timezones: {\n      byId: buildCollectionByKey(result.timezones, 'id'),\n      hash: result.hash,\n    },\n  };\n  setGlobal(global);\n});\n\naddActionHandler('loadGlobalPrivacySettings', async (global): Promise<void> => {\n  const globalSettings = await callApi('fetchGlobalPrivacySettings');\n  if (!globalSettings) {\n    return;\n  }\n\n  global = getGlobal();\n  global = replaceSettings(global, { ...globalSettings });\n  setGlobal(global);\n});\n\naddActionHandler('updateGlobalPrivacySettings', async (global, actions, payload): Promise<void> => {\n  const shouldArchiveAndMuteNewNonContact = payload.shouldArchiveAndMuteNewNonContact\n    ?? Boolean(global.settings.byKey.shouldArchiveAndMuteNewNonContact);\n  const shouldHideReadMarks = payload.shouldHideReadMarks ?? Boolean(global.settings.byKey.shouldHideReadMarks);\n  const shouldNewNonContactPeersRequirePremium = payload.shouldNewNonContactPeersRequirePremium\n    ?? Boolean(global.settings.byKey.shouldNewNonContactPeersRequirePremium);\n    // eslint-disable-next-line no-null/no-null\n  const nonContactPeersPaidStars = payload.nonContactPeersPaidStars === null ? undefined\n    : payload.nonContactPeersPaidStars || global.settings.byKey.nonContactPeersPaidStars;\n  const shouldDisplayGiftsButton = payload.shouldDisplayGiftsButton\n    ?? Boolean(global.settings.byKey.shouldDisplayGiftsButton);\n  const disallowedGifts = payload.disallowedGifts\n    ?? global.settings.byKey.disallowedGifts;\n\n  // eslint-disable-next-line no-null/no-null\n  const shouldUpdateUsersSettings = (payload.nonContactPeersPaidStars === null)\n    || payload.nonContactPeersPaidStars;\n\n  global = getGlobal();\n  global = replaceSettings(global, {\n    shouldArchiveAndMuteNewNonContact,\n    shouldHideReadMarks,\n    shouldNewNonContactPeersRequirePremium,\n    nonContactPeersPaidStars,\n    shouldDisplayGiftsButton,\n    disallowedGifts,\n  });\n  setGlobal(global);\n\n  const result = await callApi('updateGlobalPrivacySettings', {\n    shouldArchiveAndMuteNewNonContact,\n    shouldHideReadMarks,\n    shouldNewNonContactPeersRequirePremium,\n    nonContactPeersPaidStars,\n    shouldDisplayGiftsButton,\n    disallowedGifts,\n  });\n\n  global = getGlobal();\n  global = replaceSettings(global, {\n    shouldArchiveAndMuteNewNonContact: !result\n      ? !shouldArchiveAndMuteNewNonContact\n      : result.shouldArchiveAndMuteNewNonContact,\n    shouldHideReadMarks: !result ? !shouldHideReadMarks : result.shouldHideReadMarks,\n    shouldNewNonContactPeersRequirePremium: !result\n      ? !shouldNewNonContactPeersRequirePremium\n      : result.shouldNewNonContactPeersRequirePremium,\n    nonContactPeersPaidStars: !result\n      ? undefined\n      : result.nonContactPeersPaidStars,\n    shouldDisplayGiftsButton: !result ? !shouldDisplayGiftsButton : result.shouldDisplayGiftsButton,\n    disallowedGifts: !result ? disallowedGifts : result.disallowedGifts,\n  });\n\n  if (shouldUpdateUsersSettings) {\n    Object.keys(global.users.fullInfoById).forEach((userId) => {\n      global = updateUserFullInfo(global, userId, {\n        settings: undefined,\n      });\n    });\n  }\n\n  setGlobal(global);\n});\n\naddActionHandler('toggleUsername', async (global, actions, payload): Promise<void> => {\n  const { username, isActive } = payload;\n  const { currentUserId } = global;\n  if (!currentUserId) {\n    return;\n  }\n\n  const currentUser = selectUser(global, currentUserId);\n  if (!currentUser?.usernames) {\n    return;\n  }\n\n  const usernames = currentUser.usernames.map((item) => {\n    if (item.username !== username) {\n      return item;\n    }\n\n    return { ...item, isActive: isActive || undefined };\n  });\n\n  global = updateUser(global, currentUserId, { usernames });\n  setGlobal(global);\n\n  const result = await callApi('toggleUsername', { username, isActive });\n\n  if (!result) {\n    actions.loadFullUser({ userId: currentUserId });\n  }\n});\n\naddActionHandler('toggleChatUsername', async (global, actions, payload): Promise<void> => {\n  const {\n    chatId, username, isActive,\n  } = payload;\n  const chat = selectChat(global, chatId);\n  if (!chat?.usernames) {\n    return;\n  }\n\n  const usernames = chat.usernames.map((item) => {\n    if (item.username !== username) {\n      return item;\n    }\n\n    return { ...item, isActive: isActive || undefined };\n  });\n\n  global = updateChat(global, chatId, { usernames });\n  setGlobal(global);\n\n  const result = await callApi('toggleUsername', {\n    chatId: chat.id,\n    accessHash: chat.accessHash,\n    username,\n    isActive,\n  });\n\n  if (!result) {\n    actions.loadFullChat({ chatId });\n  }\n});\n\naddActionHandler('sortUsernames', async (global, actions, payload): Promise<void> => {\n  const { usernames } = payload;\n  const { currentUserId } = global;\n  if (!currentUserId) {\n    return;\n  }\n\n  const result = await callApi('reorderUsernames', { usernames });\n\n  // After saving the order of usernames, server sends an update with the necessary data,\n  // so there is no need to update the state in this place\n  if (!result) {\n    actions.loadUser({ userId: currentUserId });\n  }\n});\n\naddActionHandler('sortChatUsernames', async (global, actions, payload): Promise<void> => {\n  const { chatId, usernames } = payload;\n  const chat = selectChat(global, chatId);\n  if (!chat) {\n    return;\n  }\n\n  const prevUsernames = [...chat.usernames!];\n  const sortedUsernames = chat.usernames!.reduce((res, currentUsername) => {\n    const idx = usernames.findIndex((username) => username === currentUsername.username);\n    res[idx] = currentUsername;\n\n    return res;\n  }, [] as ApiUsername[]);\n\n  global = updateChat(global, chatId, { usernames: sortedUsernames });\n  setGlobal(global);\n\n  const result = await callApi('reorderUsernames', {\n    chatId: chat.id,\n    accessHash: chat.accessHash,\n    usernames,\n  });\n\n  if (!result) {\n    global = getGlobal();\n    global = updateChat(global, chatId, { usernames: prevUsernames });\n    setGlobal(global);\n  }\n});\n","import type {\n  ApiChat,\n  ApiNotifyPeerType,\n  ApiPeer,\n  ApiPeerNotifySettings,\n} from '../../api/types';\n\nimport { isUserId } from '../../util/entities/ids';\nimport { omitUndefined } from '../../util/iteratees';\nimport { getServerTime } from '../../util/serverTime';\nimport { isChatChannel } from './chats';\n\nexport function getIsChatMuted(\n  chat: ApiChat,\n  notifyDefaults?: Record<ApiNotifyPeerType, ApiPeerNotifySettings>,\n  notifyException?: ApiPeerNotifySettings,\n) {\n  const settings = getChatNotifySettings(chat, notifyDefaults, notifyException);\n  if (!settings?.mutedUntil) return false;\n  return getServerTime() < settings.mutedUntil;\n}\n\nexport function getIsChatSilent(\n  chat: ApiChat,\n  notifyDefaults?: Record<ApiNotifyPeerType, ApiPeerNotifySettings>,\n  notifyException?: ApiPeerNotifySettings,\n) {\n  const settings = getChatNotifySettings(chat, notifyDefaults, notifyException);\n  if (!settings) return false;\n  return !settings.hasSound;\n}\n\nexport function getShouldShowMessagePreview(\n  chat: ApiChat,\n  notifyDefaults?: Record<ApiNotifyPeerType, ApiPeerNotifySettings>,\n  notifyException?: ApiPeerNotifySettings,\n) {\n  const settings = getChatNotifySettings(chat, notifyDefaults, notifyException);\n  return Boolean(settings?.shouldShowPreviews);\n}\n\nexport function getChatNotifySettings(\n  chat: ApiChat,\n  notifyDefaults?: Record<ApiNotifyPeerType, ApiPeerNotifySettings>,\n  notifyException?: ApiPeerNotifySettings,\n): ApiPeerNotifySettings | undefined {\n  const defaults = notifyDefaults?.[getNotificationPeerType(chat)];\n\n  if (!notifyException && !defaults) {\n    return undefined;\n  }\n\n  return {\n    ...defaults,\n    ...(notifyException && omitUndefined(notifyException)),\n  };\n}\n\nexport function getNotificationPeerType(peer: ApiPeer): ApiNotifyPeerType {\n  if (isUserId(peer.id)) {\n    return 'users';\n  }\n\n  const chat = peer as ApiChat;\n  return isChatChannel(chat) ? 'channels' : 'groups';\n}\n","import { SVG_NAMESPACE } from '../config';\nimport { requestMutation } from '../lib/fasterdom/fasterdom';\nimport jsxToHtml from './element/jsxToHtml';\nimport generateUniqueId from './generateUniqueId';\n\nconst DEFINITION_MAP = new Map<string, Element>();\n\nlet defs: SVGElement | undefined;\n\nfunction init() {\n  if (defs) return;\n\n  const container = document.createElementNS(SVG_NAMESPACE, 'svg');\n  container.setAttribute('width', '0');\n  container.setAttribute('height', '0');\n  container.setAttribute('viewBox', '0 0 1 1');\n  container.classList.add('svg-definitions');\n  document.body.appendChild(container);\n\n  defs = document.createElementNS(SVG_NAMESPACE, 'defs');\n  container.appendChild(defs);\n}\n\nfunction appendElement(element: Element) {\n  requestMutation(() => {\n    if (!defs) init();\n    defs!.appendChild(element);\n  });\n}\n\nexport function addSvgDefinition(element: React.JSX.Element, id?: string) {\n  id ??= generateUniqueId();\n  element.props.id = id;\n\n  const htmlElement = jsxToHtml(element)[0];\n  DEFINITION_MAP.set(element.props.id, htmlElement);\n  appendElement(htmlElement);\n  return id;\n}\n\nexport function removeSvgDefinition(id: string) {\n  const element = DEFINITION_MAP.get(id);\n  if (element) {\n    requestMutation(() => {\n      element.remove();\n    });\n    DEFINITION_MAP.delete(id);\n  }\n}\n","import { useRef } from '../lib/teact/teact';\n\n// This is not render-dependent and will never allow previous to match current\nexport default function usePrevious<T>(current: T) {\n  const prevRef = useRef<T>();\n  const lastRef = useRef<T>();\n\n  if (lastRef.current !== current) {\n    prevRef.current = lastRef.current;\n  }\n\n  lastRef.current = current;\n\n  return prevRef.current;\n}\n","import type { ApiSticker, ApiStickerSet, ApiStickerSetInfo } from '../../api/types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport { RESTRICTED_EMOJI_SET_ID, TON_CURRENCY_CODE } from '../../config';\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { convertCurrencyFromBaseUnit } from '../../util/formatCurrency';\nimport { selectTabState } from './tabs';\nimport { selectIsCurrentUserPremium } from './users';\n\n// https://github.com/DrKLO/Telegram/blob/c319639e9a4dff2f22da6762dcebd12d49f5afa1/TMessagesProj/src/main/java/org/telegram/ui/Components/Premium/boosts/cells/msg/GiveawayMessageCell.java#L59\nconst MONTH_EMOTICON: Record<number, string> = {\n  1: `${1}\\u{FE0F}\\u20E3`,\n  3: `${2}\\u{FE0F}\\u20E3`,\n  6: `${3}\\u{FE0F}\\u20E3`,\n  12: `${4}\\u{FE0F}\\u20E3`,\n  24: `${5}\\u{FE0F}\\u20E3`,\n};\n\nconst STAR_EMOTICON: Record<number, string> = {\n  1000: `${2}\\u{FE0F}\\u20E3`,\n  2500: `${3}\\u{FE0F}\\u20E3`,\n  5000: `${4}\\u{FE0F}\\u20E3`,\n};\n\nconst TON_EMOTICON: Record<number, string> = {\n  1: `${1}\\u{FE0F}\\u20E3`,\n  10: `${2}\\u{FE0F}\\u20E3`,\n  50: `${3}\\u{FE0F}\\u20E3`,\n};\n\nexport function selectIsStickerFavorite<T extends GlobalState>(global: T, sticker: ApiSticker) {\n  const { stickers } = global.stickers.favorite;\n  return stickers && stickers.some(({ id }) => id === sticker.id);\n}\n\nexport function selectCurrentStickerSearch<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).stickerSearch;\n}\n\nexport function selectCurrentGifSearch<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).gifSearch;\n}\n\nexport function selectStickerSet<T extends GlobalState>(global: T, id: string | ApiStickerSetInfo) {\n  if (typeof id === 'string') {\n    return global.stickers.setsById[id];\n  }\n\n  if ('id' in id) {\n    return global.stickers.setsById[id.id];\n  }\n\n  if ('isMissing' in id) return undefined;\n\n  return Object.values(global.stickers.setsById).find(({ shortName }) => (\n    shortName.toLowerCase() === id.shortName.toLowerCase()\n  ));\n}\n\nexport function selectStickersForEmoji<T extends GlobalState>(global: T, emoji: string) {\n  const addedSets = global.stickers.added.setIds;\n  let stickersForEmoji: ApiSticker[] = [];\n  // Favorites\n  global.stickers.favorite.stickers.forEach((sticker) => {\n    if (sticker.emoji === emoji) stickersForEmoji.push(sticker);\n  });\n\n  // Added sets\n  addedSets?.forEach((id) => {\n    const packs = global.stickers.setsById[id].packs;\n    if (!packs) {\n      return;\n    }\n\n    stickersForEmoji = stickersForEmoji.concat(packs[emoji] || [], packs[cleanEmoji(emoji)] || []);\n  });\n  return stickersForEmoji;\n}\n\nexport function selectCustomEmojiForEmoji<T extends GlobalState>(global: T, emoji: string) {\n  const isCurrentUserPremium = selectIsCurrentUserPremium(global);\n  const addedCustomSets = global.customEmojis.added.setIds;\n  let customEmojiForEmoji: ApiSticker[] = [];\n\n  // Added sets\n  addedCustomSets?.forEach((id) => {\n    const packs = global.stickers.setsById[id].packs;\n    if (!packs) {\n      return;\n    }\n\n    customEmojiForEmoji = customEmojiForEmoji.concat(packs[emoji] || [], packs[cleanEmoji(emoji)] || []);\n  });\n  return isCurrentUserPremium ? customEmojiForEmoji : customEmojiForEmoji.filter(({ isFree }) => isFree);\n}\n\n// Slow, not to be used in `withGlobal`\nexport function selectCustomEmojiForEmojis<T extends GlobalState>(global: T, emojis: string[]) {\n  const isCurrentUserPremium = selectIsCurrentUserPremium(global);\n  const addedCustomSets = global.customEmojis.added.setIds;\n  let customEmojiForEmoji: ApiSticker[] = [];\n\n  // Added sets\n  addedCustomSets?.forEach((id) => {\n    const packs = global.stickers.setsById[id].packs;\n    if (!packs) {\n      return;\n    }\n    const customEmojis = Object.entries(packs).filter(([emoji]) => (\n      emojis.includes(emoji) || emojis.includes(cleanEmoji(emoji))\n    )).flatMap(([, stickers]) => stickers);\n    customEmojiForEmoji = customEmojiForEmoji.concat(customEmojis);\n  });\n  return isCurrentUserPremium ? customEmojiForEmoji : customEmojiForEmoji.filter(({ isFree }) => isFree);\n}\n\nexport function selectIsSetPremium(stickerSet: Pick<ApiStickerSet, 'stickers' | 'isEmoji'>) {\n  return stickerSet.isEmoji && stickerSet.stickers?.some((sticker) => !sticker.isFree);\n}\n\nfunction cleanEmoji(emoji: string) {\n  // Some emojis ( for example) with a service symbol 'VARIATION SELECTOR-16' are not recognized as animated\n  return emoji.replace('\\ufe0f', '');\n}\n\nexport function selectAnimatedEmoji<T extends GlobalState>(global: T, emoji: string) {\n  const { animatedEmojis } = global;\n  if (!animatedEmojis || !animatedEmojis.stickers) {\n    return undefined;\n  }\n\n  const cleanedEmoji = cleanEmoji(emoji);\n\n  return animatedEmojis.stickers.find((sticker) => sticker.emoji === emoji || sticker.emoji === cleanedEmoji);\n}\n\nexport function selectRestrictedEmoji<T extends GlobalState>(global: T, emoji: string) {\n  const { restrictedEmoji } = global;\n  if (!restrictedEmoji || !restrictedEmoji.stickers) {\n    return undefined;\n  }\n\n  const cleanedEmoji = cleanEmoji(emoji);\n\n  return restrictedEmoji.stickers.find((sticker) => {\n    if (!sticker.emoji) return undefined;\n    const cleanedStickerEmoji = cleanEmoji(sticker.emoji);\n    return cleanedStickerEmoji === cleanedEmoji;\n  });\n}\n\nexport function selectAnimatedEmojiEffect<T extends GlobalState>(global: T, emoji: string) {\n  const { animatedEmojiEffects } = global;\n  if (!animatedEmojiEffects || !animatedEmojiEffects.stickers) {\n    return undefined;\n  }\n\n  const cleanedEmoji = cleanEmoji(emoji);\n\n  return animatedEmojiEffects.stickers.find((sticker) => sticker.emoji === emoji || sticker.emoji === cleanedEmoji);\n}\n\nexport function selectAnimatedEmojiSound<T extends GlobalState>(global: T, emoji: string) {\n  return global?.appConfig.emojiSounds[cleanEmoji(emoji)];\n}\n\nexport function selectIsAlwaysHighPriorityEmoji<T extends GlobalState>(\n  global: T, stickerSet: ApiStickerSetInfo | ApiStickerSet,\n) {\n  if (!('id' in stickerSet)) return false;\n  return stickerSet.id === global.appConfig.defaultEmojiStatusesStickerSetId\n    || stickerSet.id === RESTRICTED_EMOJI_SET_ID;\n}\n\nexport function selectGiftStickerForDuration<T extends GlobalState>(global: T, duration = 1) {\n  const stickers = global.premiumGifts?.stickers;\n  if (!stickers) return undefined;\n  const emoji = MONTH_EMOTICON[duration];\n  return stickers.find((sticker) => sticker.emoji === emoji) || stickers[0];\n}\n\nexport function selectGiftStickerForStars<T extends GlobalState>(global: T, starCount?: number) {\n  const stickers = global.premiumGifts?.stickers;\n\n  if (!stickers || !starCount) return undefined;\n\n  let emoji;\n  if (starCount <= 1000) {\n    emoji = STAR_EMOTICON[1000];\n  } else if (starCount < 2500) {\n    emoji = STAR_EMOTICON[2500];\n  } else {\n    emoji = STAR_EMOTICON[5000];\n  }\n\n  return stickers.find((sticker) => sticker.emoji === emoji) || stickers[0];\n}\n\nexport function selectGiftStickerForTon<T extends GlobalState>(global: T, amount?: number) {\n  const stickers = global.tonGifts?.stickers;\n  if (!stickers || !amount) return undefined;\n  const convertedAmount = convertCurrencyFromBaseUnit(amount, TON_CURRENCY_CODE);\n\n  let emoji;\n  if (convertedAmount < 10) {\n    emoji = TON_EMOTICON[1];\n  } else if (convertedAmount < 50) {\n    emoji = TON_EMOTICON[10];\n  } else {\n    emoji = TON_EMOTICON[50];\n  }\n\n  return stickers.find((sticker) => sticker.emoji === emoji) || stickers[0];\n}\n\nexport function selectCustomEmoji<T extends GlobalState>(global: T, documentId: string) {\n  return global.customEmojis.byId[documentId];\n}\n","import type { GlobalState } from '../types';\n\nexport function selectSharedState<T extends GlobalState>(\n  global: T,\n) {\n  return global.sharedState;\n}\n\nexport function selectSharedSettings<T extends GlobalState>(\n  global: T,\n) {\n  return selectSharedState(global).settings;\n}\n","import type { GlobalState } from '../types';\n\nimport { ACCOUNT_SLOT, getAccountsInfo } from '../../util/multiaccount';\nimport { selectSharedSettings } from './sharedState';\n\nexport function selectNotifySettings<T extends GlobalState>(global: T) {\n  return global.settings.byKey;\n}\n\nexport function selectNotifyDefaults<T extends GlobalState>(global: T) {\n  return global.settings.notifyDefaults;\n}\n\nexport function selectNotifyException<T extends GlobalState>(global: T, chatId: string) {\n  return global.chats.notifyExceptionById?.[chatId];\n}\n\nexport function selectLanguageCode<T extends GlobalState>(global: T) {\n  return selectSharedSettings(global).language.replace('-raw', '');\n}\n\nexport function selectCanSetPasscode<T extends GlobalState>(global: T) {\n  // TODO[passcode]: remove this when multiacc passcode is implemented\n  const accounts = getAccountsInfo();\n  return global.authRememberMe && !ACCOUNT_SLOT && Object.keys(accounts).length === 1;\n}\n\nexport function selectTranslationLanguage<T extends GlobalState>(global: T) {\n  return global.settings.byKey.translationLanguage || selectLanguageCode(global);\n}\n\nexport function selectNewNoncontactPeersRequirePremium<T extends GlobalState>(global: T) {\n  return global.settings.byKey.shouldNewNonContactPeersRequirePremium;\n}\n\nexport function selectNonContactPeersPaidStars<T extends GlobalState>(global: T) {\n  return global.settings.byKey.nonContactPeersPaidStars;\n}\n\nexport function selectShouldHideReadMarks<T extends GlobalState>(global: T) {\n  return global.settings.byKey.shouldHideReadMarks;\n}\n\nexport function selectSettingsKeys<T extends GlobalState>(global: T) {\n  return global.settings.byKey;\n}\n","import { useCallback, useState } from '../lib/teact/teact';\n\nconst useForceUpdate = () => {\n  const [, setTrigger] = useState<boolean>(false);\n\n  return useCallback(() => {\n    setTrigger((trigger) => !trigger);\n  }, []);\n};\n\nexport default useForceUpdate;\n","import type {\n  ApiLimitTypeForPromo, ApiPremiumSection, ApiReactionEmoji,\n} from './api/types';\nimport type {\n  GiftProfileFilterOptions,\n  ResaleGiftsFilterOptions,\n} from './types';\n\nexport const APP_CODE_NAME = 'A';\nexport const APP_NAME = process.env.APP_NAME || `Telegram Web ${APP_CODE_NAME}`;\n\nexport const PRODUCTION_HOSTNAME = 'web.telegram.org';\nexport const PRODUCTION_URL = 'https://web.telegram.org/a';\nexport const WEB_VERSION_BASE = 'https://web.telegram.org/'; // Used to redirect to other versions\nexport const BASE_URL = process.env.BASE_URL;\nexport const ACCOUNT_QUERY = 'account';\n\nexport const IS_MOCKED_CLIENT = process.env.APP_MOCKED_CLIENT === '1';\nexport const IS_TEST = process.env.APP_ENV === 'test';\nexport const IS_PERF = process.env.APP_ENV === 'perf';\nexport const IS_BETA = process.env.APP_ENV === 'staging';\n\nexport const PAID_MESSAGES_PURPOSE = 'paid_messages';\n\nexport const DEBUG = process.env.APP_ENV !== 'production';\nexport const DEBUG_MORE = false;\nexport const DEBUG_LOG_FILENAME = 'tt-log.json';\nexport const STRICTERDOM_ENABLED = DEBUG;\nexport const FORCE_FALLBACK_LANG = false;\n\nexport const BETA_CHANGELOG_URL = 'https://telegra.ph/WebA-Beta-03-20';\n\nexport const DEBUG_ALERT_MSG = 'Shoot!\\nSomething went wrong, please see the error details in Dev Tools Console.';\nexport const DEBUG_GRAMJS = false;\n\nexport const PAGE_TITLE = process.env.APP_TITLE!;\nexport const PAGE_TITLE_TAURI = 'Telegram Air';\nexport const INACTIVE_MARKER = '[Inactive]';\n\nexport const DEBUG_PAYMENT_SMART_GLOCAL = false;\n\nexport const SESSION_LEGACY_USER_KEY = 'user_auth';\nexport const SESSION_ACCOUNT_PREFIX = 'account';\nexport const LEGACY_PASSCODE_CACHE_NAME = 'tt-passcode';\n\nexport const MULTIACCOUNT_MAX_SLOTS = 6;\nexport const GLOBAL_STATE_CACHE_DISABLED = false;\nexport const GLOBAL_STATE_CACHE_PREFIX = 'tt-global-state';\nexport const SHARED_STATE_CACHE_KEY = 'tt-shared-state';\nexport const GLOBAL_STATE_CACHE_USER_LIST_LIMIT = 500;\nexport const GLOBAL_STATE_CACHE_CHAT_LIST_LIMIT = 200;\nexport const GLOBAL_STATE_CACHE_ARCHIVED_CHAT_LIST_LIMIT = 10;\nexport const GLOBAL_STATE_CACHE_CUSTOM_EMOJI_LIMIT = 150;\n\nexport const IS_SCREEN_LOCKED_CACHE_KEY = 'tt-is-screen-locked';\n\nexport const MEDIA_CACHE_DISABLED = false;\nexport const MEDIA_CACHE_NAME = 'tt-media';\nexport const MEDIA_CACHE_NAME_AVATARS = 'tt-media-avatars';\nexport const MEDIA_PROGRESSIVE_CACHE_DISABLED = false;\nexport const MEDIA_PROGRESSIVE_CACHE_NAME = 'tt-media-progressive';\nexport const MEDIA_CACHE_MAX_BYTES = 512 * 1024; // 512 KB\nexport const CUSTOM_BG_CACHE_NAME = 'tt-custom-bg';\nexport const LANG_CACHE_NAME = 'tt-lang-packs-v50';\nexport const ASSET_CACHE_NAME = 'tt-assets';\nexport const AUTODOWNLOAD_FILESIZE_MB_LIMITS = [1, 5, 10, 50, 100, 500];\nexport const DATA_BROADCAST_CHANNEL_PREFIX = 'tt-global';\nexport const ESTABLISH_BROADCAST_CHANNEL_PREFIX = 'tt-establish';\nexport const MULTITAB_LOCALSTORAGE_KEY_PREFIX = 'tt-multitab';\nexport const INTERCLIENT_BROADCAST_CHANNEL = 'tgweb';\nexport const DC_IDS = [1, 2, 3, 4, 5] as const;\n\nexport const DOWNLOAD_WORKERS = 16;\nexport const UPLOAD_WORKERS = 16;\n\nconst isBigScreen = typeof window !== 'undefined' && window.innerHeight >= 900;\n\nexport const MIN_PASSWORD_LENGTH = 1;\n\nexport const MESSAGE_LIST_SLICE = isBigScreen ? 60 : 40;\nexport const MESSAGE_LIST_VIEWPORT_LIMIT = MESSAGE_LIST_SLICE * 2;\n\nexport const ARCHIVE_MINIMIZED_HEIGHT = 36;\nexport const CHAT_HEIGHT_PX = 72;\nexport const TOPIC_HEIGHT_PX = 65;\nexport const PEER_PICKER_ITEM_HEIGHT_PX = 56;\nexport const CHAT_LIST_SLICE = isBigScreen ? 30 : 25;\nexport const CHAT_LIST_LOAD_SLICE = 100;\nexport const SHARED_MEDIA_SLICE = 42;\nexport const CHAT_MEDIA_SLICE = 42;\nexport const MESSAGE_SEARCH_SLICE = 42;\nexport const GLOBAL_SEARCH_SLICE = 20;\nexport const GLOBAL_TOPIC_SEARCH_SLICE = 5;\nexport const MEMBERS_SLICE = 30;\nexport const MEMBERS_LOAD_SLICE = 200;\nexport const PROFILE_SENSITIVE_AREA = 500;\nexport const TOPIC_LIST_SENSITIVE_AREA = 600;\n\n// Public Posts Search defaults\nexport const PUBLIC_POSTS_SEARCH_DEFAULT_STARS_AMOUNT = 10;\nexport const PUBLIC_POSTS_SEARCH_DEFAULT_TOTAL_DAILY = 2;\n\n// Suggested Posts defaults\nexport const TON_CURRENCY_CODE = 'TON';\nexport const VERIFY_AGE_MIN_DEFAULT = 18;\n\nexport const STORY_VIEWS_MIN_SEARCH = 15;\nexport const STORY_MIN_REACTIONS_SORT = 10;\nexport const STORY_VIEWS_MIN_CONTACTS_FILTER = 20;\n\nexport const MEDIA_TIMESTAMP_SAVE_MINIMUM_DURATION = 30; // 30s\n\nexport const GLOBAL_SUGGESTED_CHANNELS_ID = 'global';\n\n// As in Telegram for Android\n// https://github.com/DrKLO/Telegram/blob/51e9947527/TMessagesProj/src/main/java/org/telegram/messenger/MediaDataController.java#L7781\nexport const REACTION_UNREAD_SLICE = 100;\nexport const MENTION_UNREAD_SLICE = 100;\nexport const TOPICS_SLICE = 20;\nexport const TOPICS_SLICE_SECOND_LOAD = 500;\n\nexport const TOP_CHAT_MESSAGES_PRELOAD_LIMIT = 20;\n\nexport const SPONSORED_MESSAGE_CACHE_MS = 300000; // 5 min\n\nexport const DEFAULT_CHARGE_FOR_MESSAGES = 250;\nexport const MINIMUM_CHARGE_FOR_MESSAGES = 1;\nexport const DEFAULT_MAXIMUM_CHARGE_FOR_MESSAGES = 10000;\n\nexport const DEFAULT_VOLUME = 1;\nexport const DEFAULT_PLAYBACK_RATE = 1;\nexport const PLAYBACK_RATE_FOR_AUDIO_MIN_DURATION = 20 * 60; // 20 min\n\nexport const ANIMATION_LEVEL_CUSTOM = -1;\nexport const ANIMATION_LEVEL_MIN = 0;\nexport const ANIMATION_LEVEL_MED = 1;\nexport const ANIMATION_LEVEL_MAX = 2;\nexport const ANIMATION_LEVEL_DEFAULT = ANIMATION_LEVEL_MED;\n\nexport const DEFAULT_MESSAGE_TEXT_SIZE_PX = 16;\nexport const IOS_DEFAULT_MESSAGE_TEXT_SIZE_PX = 17;\nexport const MACOS_DEFAULT_MESSAGE_TEXT_SIZE_PX = 15;\n\nexport const PREVIEW_AVATAR_COUNT = 3;\n\nexport const DRAFT_DEBOUNCE = 10000; // 10s\nexport const SEND_MESSAGE_ACTION_INTERVAL = 3000; // 3s\n// 10000s from https://corefork.telegram.org/api/url-authorization#automatic-authorization\nexport const APP_CONFIG_REFETCH_INTERVAL = 10000 * 1000;\nexport const GENERAL_REFETCH_INTERVAL = 60 * 60 * 1000; // 1h\n\nexport const EDITABLE_INPUT_ID = 'editable-message-text';\nexport const EDITABLE_INPUT_MODAL_ID = 'editable-message-text-modal';\nexport const EDITABLE_STORY_INPUT_ID = 'editable-story-input-text';\n// eslint-disable-next-line @stylistic/max-len\nexport const EDITABLE_INPUT_CSS_SELECTOR = `.messages-layout .Transition_slide-active #${EDITABLE_INPUT_ID}, .messages-layout .Transition > .Transition_slide-to #${EDITABLE_INPUT_ID}`;\nexport const EDITABLE_INPUT_MODAL_CSS_SELECTOR = `#${EDITABLE_INPUT_MODAL_ID}`;\nexport const EDITABLE_STORY_INPUT_CSS_SELECTOR = `#${EDITABLE_STORY_INPUT_ID}`;\n\nexport const CUSTOM_APPENDIX_ATTRIBUTE = 'data-has-custom-appendix';\nexport const MESSAGE_CONTENT_CLASS_NAME = 'message-content';\nexport const MESSAGE_CONTENT_SELECTOR = '.message-content';\nexport const VT_CLASS_NAME = 'active-view-transition';\nexport const VT_TYPE_CLASS_PREFIX = 'active-vt-';\n\nexport const RESIZE_HANDLE_CLASS_NAME = 'resizeHandle';\nexport const RESIZE_HANDLE_SELECTOR = `.${RESIZE_HANDLE_CLASS_NAME}`;\n\nexport const SNAP_EFFECT_CONTAINER_ID = 'snap-effect-container';\nexport const SNAP_EFFECT_ID = 'snap-effect';\n\nexport const STARS_ICON_PLACEHOLDER = '';\nexport const STARS_CURRENCY_CODE = 'XTR';\n\nexport const MIN_SCREEN_WIDTH_FOR_STATIC_RIGHT_COLUMN = 1275; // px\nexport const MIN_SCREEN_WIDTH_FOR_STATIC_LEFT_COLUMN = 925; // px\nexport const MOBILE_SCREEN_MAX_WIDTH = 600; // px\nexport const MOBILE_SCREEN_LANDSCAPE_MAX_WIDTH = 950; // px\nexport const MOBILE_SCREEN_LANDSCAPE_MAX_HEIGHT = 450; // px\n\nexport const MAX_INT_32 = 2 ** 31 - 1;\nexport const TMP_CHAT_ID = '0';\n\nexport const MUTE_INDEFINITE_TIMESTAMP = MAX_INT_32;\nexport const UNMUTE_TIMESTAMP = 0;\n\nexport const ANIMATION_END_DELAY = 100;\nexport const ANIMATION_WAVE_MIN_INTERVAL = 200;\nexport const MESSAGE_APPEARANCE_DELAY = 10;\nexport const PAID_SEND_DELAY = 5000;\n\nexport const SCROLL_MIN_DURATION = 300;\nexport const SCROLL_MAX_DURATION = 600;\nexport const SCROLL_MAX_DISTANCE = 800;\nexport const SCROLL_SHORT_TRANSITION_MAX_DISTANCE = 300; // px\n\n// Average duration of message sending animation\nexport const API_UPDATE_THROTTLE = Math.round((SCROLL_MIN_DURATION + SCROLL_MAX_DURATION) / 2);\nexport const API_THROTTLE_RESET_UPDATES = new Set([\n  'newMessage',\n  'newScheduledMessage',\n  'deleteMessages',\n  'deleteScheduledMessages',\n  'deleteHistory',\n  'deleteParticipantHistory',\n]);\n\nexport const LOCK_SCREEN_ANIMATION_DURATION_MS = 200;\n\nexport const STICKER_SIZE_INLINE_DESKTOP_FACTOR = 13;\nexport const STICKER_SIZE_INLINE_MOBILE_FACTOR = 11;\nexport const STICKER_SIZE_AUTH = 160;\nexport const STICKER_SIZE_AUTH_MOBILE = 120;\nexport const STICKER_SIZE_PICKER = 72;\nexport const EMOJI_SIZE_PICKER = 36;\nexport const COMPOSER_EMOJI_SIZE_PICKER = 32;\nexport const STICKER_SIZE_GENERAL_SETTINGS = 40;\nexport const STICKER_SIZE_PICKER_HEADER = 32;\nexport const STICKER_PICKER_MAX_SHARED_COVERS = 20;\nexport const STICKER_SIZE_SEARCH = 72;\nexport const STICKER_SIZE_MODAL = 72;\nexport const EMOJI_SIZE_MODAL = 36;\nexport const STICKER_SIZE_TWO_FA = 160;\nexport const STICKER_SIZE_PASSCODE = 160;\nexport const STICKER_SIZE_DISCUSSION_GROUPS = 140;\nexport const STICKER_SIZE_FOLDER_SETTINGS = 100;\nexport const STICKER_SIZE_INLINE_BOT_RESULT = 100;\nexport const STICKER_SIZE_JOIN_REQUESTS = 140;\nexport const STICKER_SIZE_INVITES = 140;\nexport const RECENT_STICKERS_LIMIT = 20;\nexport const RECENT_STATUS_LIMIT = 20;\nexport const EMOJI_STATUS_LOOP_LIMIT = 2;\nexport const EMOJI_SIZES = 7;\nexport const TOP_SYMBOL_SET_ID = 'top';\nexport const POPULAR_SYMBOL_SET_ID = 'popular';\nexport const RECENT_SYMBOL_SET_ID = 'recent';\nexport const COLLECTIBLE_STATUS_SET_ID = 'collectibleStatus';\nexport const FAVORITE_SYMBOL_SET_ID = 'favorite';\nexport const EFFECT_STICKERS_SET_ID = 'effectStickers';\nexport const EFFECT_EMOJIS_SET_ID = 'effectEmojis';\nexport const CHAT_STICKER_SET_ID = 'chatStickers';\nexport const DEFAULT_TOPIC_ICON_STICKER_ID = 'topic-default-icon';\nexport const DEFAULT_STATUS_ICON_ID = 'status-default-icon';\nexport const EMOJI_IMG_REGEX = /<img[^>]+alt=\"([^\"]+)\"(?![^>]*data-document-id)[^>]*>/gm;\n\nexport const BASE_EMOJI_KEYWORD_LANG = 'en';\n\nexport const MENU_TRANSITION_DURATION = 200;\nexport const SLIDE_TRANSITION_DURATION = 450;\n\nexport const BIRTHDAY_NUMBERS_SET = 'FestiveFontEmoji';\nexport const RESTRICTED_EMOJI_SET = 'RestrictedEmoji';\n\nexport const SVG_NAMESPACE = 'http://www.w3.org/2000/svg';\nexport const SVG_EXTENSIONS = new Set(['svg', 'svgz']);\n\nexport const VIDEO_WEBM_TYPE = 'video/webm';\nexport const GIF_MIME_TYPE = 'image/gif';\n\nexport const LOTTIE_STICKER_MIME_TYPE = 'application/x-tgsticker';\nexport const VIDEO_STICKER_MIME_TYPE = VIDEO_WEBM_TYPE;\n\nexport const SUPPORTED_PHOTO_CONTENT_TYPES = new Set([\n  'image/png', 'image/jpeg', GIF_MIME_TYPE,\n]);\n\nexport const SUPPORTED_VIDEO_CONTENT_TYPES = new Set([\n  'video/mp4', 'video/quicktime',\n]);\n\nexport const SUPPORTED_AUDIO_CONTENT_TYPES = new Set([\n  'audio/mp3',\n  'audio/ogg',\n  'audio/wav',\n  'audio/mpeg',\n  'audio/flac',\n  'audio/aac',\n  'audio/m4a',\n  'audio/mp4',\n  'audio/x-m4a',\n]);\n\nexport const CONTENT_TYPES_WITH_PREVIEW = new Set([\n  ...SUPPORTED_PHOTO_CONTENT_TYPES,\n  ...SUPPORTED_VIDEO_CONTENT_TYPES,\n]);\n\n// Taken from https://github.com/telegramdesktop/tdesktop/blob/41d9a9fcbd0c809c60ddbd9350791b1436aff7d9/Telegram/SourceFiles/ui/boxes/choose_language_box.cpp#L28\nexport const SUPPORTED_TRANSLATION_LANGUAGES = [\n  // Official\n  'en', 'ar', 'be', 'ca', 'zh', 'nl', 'fr', 'de', 'id',\n  'it', 'ja', 'ko', 'pl', 'pt', 'ru', 'es', 'uk',\n  // Unofficial\n  'af', 'sq', 'am', 'hy', 'az', 'eu', 'bn', 'bs', 'bg',\n  'ceb', 'zh-CN', 'zh-TW', 'co', 'hr', 'cs', 'da', 'eo',\n  'et', 'fi', 'fy', 'gl', 'ka', 'el', 'gu', 'ht', 'ha',\n  'haw', 'he', 'iw', 'hi', 'hmn', 'hu', 'is', 'ig', 'ga',\n  'jv', 'kn', 'kk', 'km', 'rw', 'ku', 'ky', 'lo', 'la',\n  'lv', 'lt', 'lb', 'mk', 'mg', 'ms', 'ml', 'mt', 'mi',\n  'mr', 'mn', 'my', 'ne', 'no', 'ny', 'or', 'ps', 'fa',\n  'pa', 'ro', 'sm', 'gd', 'sr', 'st', 'sn', 'sd', 'si',\n  'sk', 'sl', 'so', 'su', 'sw', 'sv', 'tl', 'tg', 'ta',\n  'tt', 'te', 'th', 'tr', 'tk', 'ur', 'ug', 'uz', 'vi',\n  'cy', 'xh', 'yi', 'yo', 'zu',\n];\n\n// eslint-disable-next-line @stylistic/max-len\nexport const RE_LINK_TEMPLATE = '((ftp|https?):\\\\/\\\\/)?((www\\\\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\\\\.[a-zA-Z][-a-zA-Z0-9]{1,62})\\\\b([-a-zA-Z0-9()@:%_+.,~#?&/=]*)';\nexport const RE_MENTION_TEMPLATE = '(@[\\\\w\\\\d_-]+)';\nexport const RE_TG_LINK = /^tg:(\\/\\/)?/i;\nexport const RE_TME_LINK = /^(https?:\\/\\/)?([-a-zA-Z0-9@:%_+~#=]{1,32}\\.)?t\\.me/i;\nexport const RE_TELEGRAM_LINK = /^(https?:\\/\\/)?telegram\\.org\\//i;\nexport const TME_LINK_PREFIX = 'https://t.me/';\nexport const BOT_FATHER_USERNAME = 'botfather';\nexport const USERNAME_PURCHASE_ERROR = 'USERNAME_PURCHASE_AVAILABLE';\nexport const MESSAGE_ID_REQUIRED_ERROR = 'MESSAGE_ID_REQUIRED';\nexport const PURCHASE_USERNAME = 'auction';\nexport const ACCEPTABLE_USERNAME_ERRORS = new Set([USERNAME_PURCHASE_ERROR, 'USERNAME_INVALID']);\nexport const TME_WEB_DOMAINS = new Set(['t.me', 'web.t.me', 'a.t.me', 'k.t.me', 'z.t.me']);\nexport const WEB_APP_PLATFORM = 'weba';\nexport const LANG_PACK = 'weba';\n\nexport const NSFW_RESTRICTION_REASON = 'sensitive';\n\n// eslint-disable-next-line @stylistic/max-len\nexport const COUNTRIES_WITH_12H_TIME_FORMAT = new Set(['AU', 'BD', 'CA', 'CO', 'EG', 'HN', 'IE', 'IN', 'JO', 'MX', 'MY', 'NI', 'NZ', 'PH', 'PK', 'SA', 'SV', 'US']);\n\nexport const API_CHAT_TYPES = ['bots', 'channels', 'chats', 'users', 'groups'] as const;\n\nexport const HEART_REACTION: ApiReactionEmoji = {\n  type: 'emoji',\n  emoticon: '',\n};\n\n// MTProto constants\nexport const SERVICE_NOTIFICATIONS_USER_ID = '777000';\nexport const REPLIES_USER_ID = '1271266957'; // TODO For Test connection ID must be equal to 708513\nexport const VERIFICATION_CODES_USER_ID = '489000';\nexport const ANONYMOUS_USER_ID = '2666000';\nexport const RESTRICTED_EMOJI_SET_ID = '7173162320003080';\nexport const CHANNEL_ID_BASE = 10 ** 12;\nexport const DEFAULT_GIF_SEARCH_BOT_USERNAME = 'gif';\nexport const ALL_FOLDER_ID = 0;\nexport const ARCHIVED_FOLDER_ID = 1;\nexport const SAVED_FOLDER_ID = -1;\nexport const FOLDER_TITLE_MAX_LENGTH = 12;\nexport const DELETED_COMMENTS_CHANNEL_ID = '-1000000000777';\nexport const MAX_MEDIA_FILES_FOR_ALBUM = 10;\nexport const MAX_ACTIVE_PINNED_CHATS = 5;\nexport const SCHEDULED_WHEN_ONLINE = 0x7FFFFFFE;\nexport const LANG_PACKS = ['android', 'ios', 'tdesktop', 'macos'] as const;\nexport const FEEDBACK_URL = 'https://bugs.telegram.org/?tag_ids=41&sort=time';\nexport const FAQ_URL = 'https://telegram.org/faq';\nexport const PRIVACY_URL = 'https://telegram.org/privacy';\nexport const MINI_APP_TOS_URL = 'https://telegram.org/tos/mini-apps';\nexport const FRAGMENT_ADS_URL = 'https://fragment.com/ads';\nexport const GENERAL_TOPIC_ID = 1;\nexport const FRESH_AUTH_PERIOD = 86400; // 1 day\nexport const GIVEAWAY_BOOST_PER_PREMIUM = 4;\nexport const GIVEAWAY_MAX_ADDITIONAL_CHANNELS = 10;\nexport const GIVEAWAY_MAX_ADDITIONAL_USERS = 10;\nexport const GIVEAWAY_MAX_ADDITIONAL_COUNTRIES = 10;\nexport const FRAGMENT_PHONE_CODE = '888';\nexport const FRAGMENT_PHONE_LENGTH = 11;\nexport const BOT_VERIFICATION_PEERS_LIMIT = 20;\n\nexport const LIGHT_THEME_BG_COLOR = '#99BA92';\nexport const DARK_THEME_BG_COLOR = '#0F0F0F';\nexport const DEFAULT_PATTERN_COLOR = '#4A8E3A8C';\nexport const DARK_THEME_PATTERN_COLOR = '#0A0A0A8C';\nexport const PEER_COLOR_BG_OPACITY = '1a';\nexport const PEER_COLOR_BG_ACTIVE_OPACITY = '2b';\nexport const PEER_COLOR_GRADIENT_STEP = 5; // px\nexport const MAX_UPLOAD_FILEPART_SIZE = 524288;\n\nexport const IGNORE_UNHANDLED_ERRORS = new Set([\n  'USER_CANCELED',\n]);\n\n// Group calls\nexport const GROUP_CALL_VOLUME_MULTIPLIER = 100;\nexport const GROUP_CALL_DEFAULT_VOLUME = 100 * GROUP_CALL_VOLUME_MULTIPLIER;\n\nexport const ONE_TIME_MEDIA_TTL_SECONDS = 2147483647;\n\n// Premium\nexport const PREMIUM_FEATURE_SECTIONS = [\n  'stories',\n  'double_limits',\n  'more_upload',\n  'faster_download',\n  'voice_to_text',\n  'no_ads',\n  'infinite_reactions',\n  'premium_stickers',\n  'animated_emoji',\n  'advanced_chat_management',\n  'profile_badge',\n  'animated_userpics',\n  'emoji_status',\n  'translations',\n  'saved_tags',\n  'last_seen',\n  'message_privacy',\n  'effects',\n  'todo',\n] as const;\n\nexport const PREMIUM_BOTTOM_VIDEOS: ApiPremiumSection[] = [\n  'faster_download',\n  'voice_to_text',\n  'advanced_chat_management',\n  'infinite_reactions',\n  'profile_badge',\n  'animated_userpics',\n  'emoji_status',\n  'translations',\n  'saved_tags',\n  'last_seen',\n  'message_privacy',\n  'effects',\n  'todo',\n];\n\nexport const PREMIUM_LIMITS_ORDER: ApiLimitTypeForPromo[] = [\n  'channels',\n  'dialogFolderPinned',\n  'channelsPublic',\n  'savedGifs',\n  'stickersFaved',\n  'aboutLength',\n  'captionLength',\n  'dialogFilters',\n  'dialogFiltersChats',\n  'moreAccounts',\n  'recommendedChannels',\n];\n\nexport const DEFAULT_GIFT_PROFILE_FILTER_OPTIONS: GiftProfileFilterOptions = {\n  sortType: 'byDate',\n  shouldIncludeUnlimited: true,\n  shouldIncludeLimited: true,\n  shouldIncludeUnique: true,\n  shouldIncludeDisplayed: true,\n  shouldIncludeHidden: true,\n  shouldIncludeUpgradable: true,\n} as const;\n\nexport const DEFAULT_RESALE_GIFTS_FILTER_OPTIONS: ResaleGiftsFilterOptions = {\n  sortType: 'byDate',\n};\n\nexport const ACCOUNT_TTL_OPTIONS = [1, 3, 6, 12, 18, 24];\n","import { useEffect } from '../../lib/teact/teact';\n\nimport useLastCallback from '../useLastCallback';\n\nfunction useInterval(callback: NoneToVoidFunction, delay?: number, noFirst = false) {\n  const savedCallback = useLastCallback(callback);\n\n  useEffect(() => {\n    if (delay === undefined) {\n      return undefined;\n    }\n\n    const id = setInterval(() => savedCallback(), delay);\n    if (!noFirst) savedCallback();\n\n    return () => clearInterval(id);\n  }, [delay, noFirst]);\n}\n\nexport default useInterval;\n","import type { GlobalState, TabArgs, TabState } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\n\nexport function updateTabState<T extends GlobalState>(\n  global: T,\n  tabStatePartial: Partial<TabState>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return {\n    ...global,\n    byTabId: {\n      ...global.byTabId,\n      [tabId]: {\n        ...global.byTabId[tabId],\n        ...tabStatePartial,\n      },\n    },\n  };\n}\n","import { getActions } from '../global';\n\nimport type { CallbackAction } from '../global/types';\n\nconst callbacks = new Map<string, number>();\n\n// TODO Pass callbacks to the master tab. Sync them on master change\nexport default function requestActionTimeout(action: CallbackAction, timeout: number) {\n  const name = action.action;\n  clearTimeout(callbacks.get(name));\n  const timerId = window.setTimeout(() => {\n    // @ts-expect-error -- No idea how to properly type this\n    getActions()[name](action.payload);\n  }, timeout);\n  callbacks.set(name, timerId);\n}\n","import type { DiffObject } from './deepDiff';\n\nimport { isLiteralObject, unique } from './iteratees';\n\nexport function deepMerge<T extends object>(value1: T, value2: DiffObject<T>): T {\n  if (value1 === value2) {\n    return value2 as unknown as T;\n  }\n\n  if (!isLiteralObject(value2)) {\n    return value2;\n  }\n\n  if (!isLiteralObject(value1)) {\n    return reduceDiff(value2) as T;\n  }\n\n  if ('__deleteAllChildren' in value2) {\n    return {} as T;\n  }\n\n  const allKeys = unique(Object.keys(value1).concat(Object.keys(value2)));\n\n  return allKeys.reduce((acc: AnyLiteral, key) => {\n    const oldValue = (value1 as AnyLiteral)[key];\n\n    if (!value2.hasOwnProperty(key)) {\n      acc[key] = oldValue;\n    } else {\n      const newValue = value2[key];\n\n      if (!newValue?.__delete) {\n        acc[key] = deepMerge(oldValue, newValue);\n      }\n    }\n\n    return acc;\n  }, {}) as T;\n}\n\nfunction reduceDiff(diff: AnyLiteral) {\n  if (diff.__deleteAllChildren) {\n    return {};\n  }\n\n  return Object.entries(diff).reduce((acc: AnyLiteral, [key, value]) => {\n    if (!value?.__delete) {\n      acc[key] = isLiteralObject(value) ? reduceDiff(value) : value;\n    }\n\n    return acc;\n  }, {});\n}\n","import type { ElementRef } from '../lib/teact/teact';\nimport { useLayoutEffect, useRef, useSignal } from '../lib/teact/teact';\nimport { addExtraClass, toggleExtraClass } from '../lib/teact/teact-dom';\n\nimport type { Signal } from '../util/signals';\n\nimport { requestMeasure } from '../lib/fasterdom/fasterdom';\nimport useDerivedSignal from './useDerivedSignal';\nimport useDerivedState from './useDerivedState';\nimport useLastCallback from './useLastCallback';\nimport { useStateRef } from './useStateRef';\nimport useSyncEffect from './useSyncEffect';\nimport useSyncEffectWithPrevDeps from './useSyncEffectWithPrevDeps';\n\nconst CLOSE_DURATION = 350;\n\ntype BaseHookParams<RefType extends HTMLElement> = {\n  isOpen: boolean | undefined;\n  ref?: ElementRef<RefType>;\n  noMountTransition?: boolean;\n  noOpenTransition?: boolean;\n  noCloseTransition?: boolean;\n  closeDuration?: number;\n  className?: string | false;\n  prefix?: string;\n  shouldForceOpen?: boolean;\n  onCloseAnimationEnd?: NoneToVoidFunction;\n};\n\nexport type HookParams<RefType extends HTMLElement> = BaseHookParams<RefType> & {\n  withShouldRender?: never;\n};\n\nexport type HookParamsWithShouldRender<RefType extends HTMLElement> = BaseHookParams<RefType> & {\n  withShouldRender: true;\n};\n\nexport type HookResult<RefType extends HTMLElement> = {\n  ref: ElementRef<RefType>;\n  getIsClosing: Signal<boolean>;\n};\n\nexport type HookResultWithShouldRender<RefType extends HTMLElement> = HookResult<RefType> & {\n  shouldRender: boolean;\n};\n\ntype State =\n  'closed'\n  | 'scheduled-open'\n  | 'open'\n  | 'closing';\n\n/**\n * Use for showing and hiding small elements with transitions. For large elements, use {@link useMediaTransition}.\n */\nexport default function useShowTransition<RefType extends HTMLElement = HTMLDivElement>(\n  params: HookParams<RefType>\n): HookResult<RefType>;\nexport default function useShowTransition<RefType extends HTMLElement = HTMLDivElement>(\n  params: HookParamsWithShouldRender<RefType>\n): HookResultWithShouldRender<RefType>;\nexport default function useShowTransition<RefType extends HTMLElement = HTMLDivElement>(\n  params: HookParams<RefType> | HookParamsWithShouldRender<RefType>,\n): HookResult<RefType> | HookResultWithShouldRender<RefType> {\n  const {\n    isOpen,\n    noMountTransition = false,\n    noOpenTransition = false,\n    noCloseTransition = false,\n    closeDuration = CLOSE_DURATION,\n    className = 'fast',\n    prefix = '',\n    shouldForceOpen,\n    onCloseAnimationEnd,\n  } = params;\n\n  const localRef = useRef<RefType>();\n  const ref = params.ref || localRef;\n  const closingTimeoutRef = useRef<number>();\n  const [getState, setState] = useSignal<State | undefined>();\n  const optionsRef = useStateRef({\n    closeDuration, noMountTransition, noOpenTransition, noCloseTransition,\n  });\n  const onCloseEndLast = useLastCallback(onCloseAnimationEnd);\n\n  useSyncEffectWithPrevDeps(([prevIsOpen]) => {\n    const options = optionsRef.current;\n\n    if (shouldForceOpen) {\n      setState('open');\n      return;\n    }\n\n    if (isOpen) {\n      if (closingTimeoutRef.current) {\n        clearTimeout(closingTimeoutRef.current);\n        closingTimeoutRef.current = undefined;\n      }\n\n      if (options.noOpenTransition || (prevIsOpen === undefined && options.noMountTransition)) {\n        setState('open');\n      } else {\n        setState('scheduled-open');\n        requestMeasure(() => {\n          setState('open');\n        });\n      }\n    } else if (prevIsOpen === undefined || options.noCloseTransition) {\n      setState('closed');\n    } else {\n      setState('closing');\n\n      closingTimeoutRef.current = window.setTimeout(() => {\n        setState('closed');\n        onCloseEndLast();\n      }, options.closeDuration);\n    }\n  }, [isOpen, shouldForceOpen]);\n\n  const applyClassNames = useLastCallback(() => {\n    const element = ref.current;\n    if (!element) return;\n\n    if (className !== false) {\n      addExtraClass(element, 'opacity-transition');\n      addExtraClass(element, className);\n    }\n\n    const state = getState();\n    const shouldRender = state !== 'closed';\n    const hasOpenClass = state === 'open';\n    const isClosing = state === 'closing';\n\n    toggleExtraClass(element, `${prefix}shown`, shouldRender);\n    toggleExtraClass(element, `${prefix}not-shown`, !shouldRender);\n    toggleExtraClass(element, `${prefix}open`, hasOpenClass);\n    toggleExtraClass(element, `${prefix}not-open`, !hasOpenClass);\n    toggleExtraClass(element, `${prefix}closing`, isClosing);\n  });\n\n  // Workaround for Chrome causing forced reflow in the middle of mutation phase when unmounting a focused element.\n  // Due to such forced reflow setting initial class names in the first layout effect causes transitions to start.\n  useSyncEffect(() => {\n    ref.onChange = () => {\n      ref.onChange = undefined;\n      applyClassNames();\n    };\n  }, [applyClassNames, ref]);\n\n  useLayoutEffect(applyClassNames, [applyClassNames, getState]);\n\n  const withShouldRender = 'withShouldRender' in params && params.withShouldRender;\n  const shouldRender = useDerivedState(\n    () => (withShouldRender && getState() !== 'closed'),\n    [withShouldRender, getState],\n  );\n\n  const getIsClosing = useDerivedSignal(() => getState() === 'closing', [getState]);\n\n  if (withShouldRender) {\n    return { ref, shouldRender, getIsClosing };\n  }\n\n  return { ref, getIsClosing };\n}\n","import { useEffect } from '../lib/teact/teact';\n\nimport { createCallbackManager } from '../util/callbacks';\nimport useLastCallback from './useLastCallback';\n\nconst startCallbacks = createCallbackManager();\nconst endCallbacks = createCallbackManager();\n\nlet timeout: number | undefined;\nlet isActive = false;\n\nconst usePriorityPlaybackCheck = (\n  onStart?: AnyToVoidFunction,\n  onEnd?: AnyToVoidFunction,\n  isDisabled = false,\n) => {\n  const lastOnStart = useLastCallback(onStart);\n  const lastOnEnd = useLastCallback(onEnd);\n\n  useEffect(() => {\n    if (isDisabled) {\n      return undefined;\n    }\n\n    if (isActive) {\n      lastOnStart();\n    }\n\n    startCallbacks.addCallback(lastOnStart);\n    endCallbacks.addCallback(lastOnEnd);\n\n    return () => {\n      endCallbacks.removeCallback(lastOnEnd);\n      startCallbacks.removeCallback(lastOnStart);\n    };\n  }, [isDisabled, lastOnStart, lastOnEnd]);\n};\n\nexport function isPriorityPlaybackActive() {\n  return isActive;\n}\n\nexport function dispatchPriorityPlaybackEvent() {\n  if (!isActive) {\n    isActive = true;\n    startCallbacks.runCallbacks();\n  }\n\n  if (timeout) {\n    clearTimeout(timeout);\n    timeout = undefined;\n  }\n\n  // Race condition may happen if another `dispatchPriorityPlaybackEvent` is called before `onEnd`\n  function onEnd() {\n    if (timeout) {\n      clearTimeout(timeout);\n      timeout = undefined;\n    }\n\n    isActive = false;\n    endCallbacks.runCallbacks();\n  }\n\n  return onEnd;\n}\n\nexport default usePriorityPlaybackCheck;\n","import type { ApiPeer, ApiPeerColor } from '../../../api/types';\nimport type { CustomPeer } from '../../../types';\n\nimport { getPeerColorCount, getPeerColorKey } from '../../../global/helpers';\n\nexport function getPeerColorClass(peer?: ApiPeer | CustomPeer, noUserColors?: boolean, shouldReset?: boolean) {\n  if (!peer) {\n    if (!shouldReset) return undefined;\n    return noUserColors ? 'peer-color-count-1' : 'peer-color-0';\n  }\n\n  if ('isCustomPeer' in peer) {\n    if (peer.peerColorId === undefined) return undefined;\n    return `peer-color-${peer.peerColorId}`;\n  }\n  return noUserColors ? `peer-color-count-${getPeerColorCount(peer)}` : `peer-color-${getPeerColorKey(peer)}`;\n}\n\nexport function getApiPeerColorClass(color: ApiPeerColor) {\n  return `peer-color-${color.color}`;\n}\n","import type { ApiSavedStarGift } from '../../api/types';\n\nexport function getSavedGiftKey(gift: ApiSavedStarGift, withoutTag?: boolean) {\n  return [\n    gift.date,\n    gift.fromId,\n    gift.gift.id,\n    gift.gift.type === 'starGiftUnique' ? gift.gift.number : undefined,\n    !withoutTag ? gift.localTag : undefined,\n  ].filter(Boolean).join('-');\n}\n","import { useRef, useUnmountCleanup } from '../lib/teact/teact';\n\nimport usePreviousDeprecated from './usePreviousDeprecated';\n\nexport default function useSyncEffect<const T extends readonly any[]>(\n  effect: (args: T | readonly []) => NoneToVoidFunction | void,\n  dependencies: T,\n) {\n  const prevDeps = usePreviousDeprecated<T>(dependencies);\n  const cleanupRef = useRef<NoneToVoidFunction>();\n\n  if (!prevDeps || dependencies.some((d, i) => d !== prevDeps[i])) {\n    cleanupRef.current?.();\n    cleanupRef.current = effect(prevDeps || []) ?? undefined;\n  }\n\n  useUnmountCleanup(() => {\n    cleanupRef.current?.();\n  });\n}\n","// We cache avatars as Data URI for faster initial load\n// and messages media as Blob for smaller size.\n\nexport enum ApiMediaFormat {\n  BlobUrl,\n  Progressive,\n  DownloadUrl,\n  Text,\n}\n\nexport type ApiParsedMedia = string | Blob | ArrayBuffer;\nexport type ApiPreparedMedia = string;\n","import { useEffect } from '../../lib/teact/teact';\n\nimport { SVG_NAMESPACE } from '../../config';\nimport { addSvgDefinition, removeSvgDefinition } from '../../util/svgController';\nimport { hexToRgb } from '../../util/switchTheme';\n\nconst SVG_MAP = new Map<string, SvgColorFilter>();\n\nclass SvgColorFilter {\n  public filterId: string;\n\n  private referenceCount = 0;\n\n  constructor(public color: string) {\n    this.filterId = `color-filter-${color.slice(1)}`;\n\n    const rgbColor = hexToRgb(color);\n    addSvgDefinition(\n      <filter color-interpolation-filters=\"sRGB\" xmlns={SVG_NAMESPACE}>\n        <feColorMatrix\n          type=\"matrix\"\n          values={`0 0 0 0 ${rgbColor.r / 255} 0 0 0 0 ${rgbColor.g / 255} 0 0 0 0 ${rgbColor.b / 255} 0 0 0 1 0`}\n        />\n      </filter>,\n      this.filterId,\n    );\n  }\n\n  public getFilterId() {\n    this.referenceCount += 1;\n    return this.filterId;\n  }\n\n  public removeReference() {\n    this.referenceCount -= 1;\n    if (this.referenceCount === 0) {\n      removeSvgDefinition(this.filterId);\n    }\n  }\n\n  public isUsed() {\n    return this.referenceCount > 0;\n  }\n}\n\nexport default function useColorFilter(color?: string, asValue?: boolean) {\n  useEffect(() => {\n    if (!color) return undefined;\n\n    return () => {\n      const colorFilter = SVG_MAP.get(color);\n      if (colorFilter) {\n        colorFilter.removeReference();\n        if (!colorFilter.isUsed()) {\n          SVG_MAP.delete(colorFilter.color);\n        }\n      }\n    };\n  }, [color]);\n\n  if (!color) return undefined;\n\n  if (SVG_MAP.has(color)) {\n    const svg = SVG_MAP.get(color)!;\n    return prepareStyle(svg.getFilterId(), asValue);\n  }\n\n  const svg = new SvgColorFilter(color);\n  SVG_MAP.set(color, svg);\n\n  return prepareStyle(svg.getFilterId(), asValue);\n}\n\nfunction prepareStyle(filterId: string, asValue?: boolean) {\n  if (asValue) {\n    return `url(#${filterId})`;\n  }\n\n  return `filter: url(#${filterId});`;\n}\n","import { useCallback, useState } from '../lib/teact/teact';\n\nconst useFlag = (initial = false, debugKey?: string): [boolean, NoneToVoidFunction, NoneToVoidFunction] => {\n  const [value, setValue] = useState(initial, debugKey);\n\n  const setTrue = useCallback(() => {\n    setValue(true);\n  }, []);\n\n  const setFalse = useCallback(() => {\n    setValue(false);\n  }, []);\n\n  return [value, setTrue, setFalse];\n};\n\nexport default useFlag;\n","export type Scheduler = typeof requestAnimationFrame | typeof onTickEnd;\n\nexport function debounce<F extends AnyToVoidFunction>(\n  fn: F,\n  ms: number,\n  shouldRunFirst = true,\n  shouldRunLast = true,\n) {\n  let waitingTimeout: number | undefined;\n\n  return (...args: Parameters<F>) => {\n    if (waitingTimeout) {\n      clearTimeout(waitingTimeout);\n      waitingTimeout = undefined;\n    } else if (shouldRunFirst) {\n      fn(...args);\n    }\n\n    waitingTimeout = self.setTimeout(() => {\n      if (shouldRunLast) {\n        fn(...args);\n      }\n\n      waitingTimeout = undefined;\n    }, ms);\n  };\n}\n\nexport function throttle<F extends AnyToVoidFunction>(\n  fn: F,\n  ms: number,\n  shouldRunFirst = true,\n) {\n  let interval: number | undefined;\n  let isPending: boolean;\n  let args: Parameters<F>;\n\n  return (..._args: Parameters<F>) => {\n    isPending = true;\n    args = _args;\n\n    if (!interval) {\n      if (shouldRunFirst) {\n        isPending = false;\n        fn(...args);\n      }\n\n      interval = self.setInterval(() => {\n        if (!isPending) {\n          self.clearInterval(interval);\n          interval = undefined;\n          return;\n        }\n\n        isPending = false;\n        fn(...args);\n      }, ms);\n    }\n  };\n}\n\nexport function throttleWithTickEnd<F extends AnyToVoidFunction>(fn: F) {\n  return throttleWith(onTickEnd, fn);\n}\n\nexport function throttleWith<F extends AnyToVoidFunction>(schedulerFn: Scheduler, fn: F) {\n  let waiting = false;\n  let args: Parameters<F>;\n\n  return (..._args: Parameters<F>) => {\n    args = _args;\n\n    if (!waiting) {\n      waiting = true;\n\n      schedulerFn(() => {\n        waiting = false;\n        fn(...args);\n      });\n    }\n  };\n}\n\nexport const pause = (ms: number) => new Promise<void>((resolve) => {\n  setTimeout(() => resolve(), ms);\n});\n\nexport function rafPromise() {\n  return new Promise<void>((resolve) => {\n    fastRaf(resolve);\n  });\n}\n\nconst FAST_RAF_TIMEOUT_FALLBACK_MS = 35; // < 30 FPS\n\nlet fastRafCallbacks: Set<NoneToVoidFunction> | undefined;\nlet fastRafFallbackCallbacks: Set<NoneToVoidFunction> | undefined;\nlet fastRafFallbackTimeout: number | undefined;\n\n// May result in an immediate execution if called from another RAF callback which was scheduled\n// (and therefore is executed) earlier than RAF callback scheduled by `fastRaf`\nexport function fastRaf(callback: NoneToVoidFunction, withTimeoutFallback = false) {\n  if (!fastRafCallbacks) {\n    fastRafCallbacks = new Set([callback]);\n\n    requestAnimationFrame(() => {\n      const currentCallbacks = fastRafCallbacks!;\n\n      fastRafCallbacks = undefined;\n      fastRafFallbackCallbacks = undefined;\n\n      if (fastRafFallbackTimeout) {\n        clearTimeout(fastRafFallbackTimeout);\n        fastRafFallbackTimeout = undefined;\n      }\n\n      currentCallbacks.forEach((cb) => cb());\n    });\n  } else {\n    fastRafCallbacks.add(callback);\n  }\n\n  if (withTimeoutFallback) {\n    if (!fastRafFallbackCallbacks) {\n      fastRafFallbackCallbacks = new Set([callback]);\n    } else {\n      fastRafFallbackCallbacks.add(callback);\n    }\n\n    if (!fastRafFallbackTimeout) {\n      fastRafFallbackTimeout = window.setTimeout(() => {\n        const currentTimeoutCallbacks = fastRafFallbackCallbacks!;\n\n        if (fastRafCallbacks) {\n          const currentCallbacks = fastRafCallbacks;\n          currentTimeoutCallbacks.forEach((c) => currentCallbacks.delete(c));\n        }\n        fastRafFallbackCallbacks = undefined;\n\n        if (fastRafFallbackTimeout) {\n          clearTimeout(fastRafFallbackTimeout);\n          fastRafFallbackTimeout = undefined;\n        }\n\n        currentTimeoutCallbacks.forEach((cb) => cb());\n      }, FAST_RAF_TIMEOUT_FALLBACK_MS);\n    }\n  }\n}\n\nlet onTickEndCallbacks: NoneToVoidFunction[] | undefined;\n\nexport function onTickEnd(callback: NoneToVoidFunction) {\n  if (!onTickEndCallbacks) {\n    onTickEndCallbacks = [callback];\n\n    Promise.resolve().then(() => {\n      const currentCallbacks = onTickEndCallbacks!;\n      onTickEndCallbacks = undefined;\n      currentCallbacks.forEach((cb) => cb());\n    });\n  } else {\n    onTickEndCallbacks.push(callback);\n  }\n}\n\nconst IDLE_TIMEOUT = 500;\n\nlet onIdleCallbacks: NoneToVoidFunction[] | undefined;\n\nexport function onIdle(callback: NoneToVoidFunction) {\n  if (!self.requestIdleCallback) {\n    onTickEnd(callback);\n    return;\n  }\n\n  if (!onIdleCallbacks) {\n    onIdleCallbacks = [callback];\n\n    requestIdleCallback((deadline) => {\n      const currentCallbacks = onIdleCallbacks!;\n      onIdleCallbacks = undefined;\n\n      while (currentCallbacks.length) {\n        const cb = currentCallbacks.shift()!;\n        cb();\n\n        if (!deadline.timeRemaining()) break;\n      }\n\n      if (currentCallbacks.length) {\n        if (onIdleCallbacks) {\n          // Prepend the remaining callbacks if the next pass is already planned\n          onIdleCallbacks = currentCallbacks.concat(onIdleCallbacks);\n        } else {\n          currentCallbacks.forEach(onIdle);\n        }\n      }\n    }, { timeout: IDLE_TIMEOUT });\n  } else {\n    onIdleCallbacks.push(callback);\n  }\n}\n\nlet beforeUnloadCallbacks: NoneToVoidFunction[] | undefined;\n\nexport function onBeforeUnload(callback: NoneToVoidFunction, isLast = false) {\n  if (!beforeUnloadCallbacks) {\n    beforeUnloadCallbacks = [];\n\n    self.addEventListener('beforeunload', () => {\n      beforeUnloadCallbacks!.forEach((cb) => cb());\n    });\n  }\n\n  if (isLast) {\n    beforeUnloadCallbacks.push(callback);\n  } else {\n    beforeUnloadCallbacks.unshift(callback);\n  }\n\n  return () => {\n    beforeUnloadCallbacks = beforeUnloadCallbacks!.filter((cb) => cb !== callback);\n  };\n}\n","import type { FC, FC_withDebug, Props } from './teact';\n\nimport { DEBUG, DEBUG_MORE } from '../../config';\nimport arePropsShallowEqual, { logUnequalProps } from '../../util/arePropsShallowEqual';\nimport Deferred from '../../util/Deferred';\nimport { handleError } from '../../util/handleError';\nimport { orderBy } from '../../util/iteratees';\nimport { throttleWithTickEnd } from '../../util/schedulers';\nimport React, { DEBUG_resolveComponentName, getIsHeavyAnimating, useUnmountCleanup } from './teact';\n\nimport useForceUpdate from '../../hooks/useForceUpdate';\nimport useUniqueId from '../../hooks/useUniqueId';\n\nexport default React;\n\ninterface Container {\n  mapStateToProps: MapStateToProps<any>;\n  activationFn?: ActivationFn<any>;\n  stuckTo?: any;\n  ownProps: Props;\n  mappedProps?: Props;\n  forceUpdate: VoidFunction;\n  DEBUG_updates: number;\n  DEBUG_componentName: string;\n}\n\ntype GlobalState =\n  AnyLiteral\n  & { DEBUG_randomId?: number };\ntype ActionNames = string;\ntype ActionPayload = any;\n\nexport interface ActionOptions {\n  forceOnHeavyAnimation?: boolean;\n  // Workaround for iOS gesture history navigation\n  forceSyncOnIOs?: boolean;\n  forceOutdated?: boolean;\n}\n\ntype Actions = Record<ActionNames, (payload?: ActionPayload, options?: ActionOptions) => void>;\n\ntype ActionHandler = (\n  global: GlobalState,\n  actions: Actions,\n  payload: any,\n) => GlobalState | void | Promise<void>;\n\ntype MapStateToProps<OwnProps = undefined> = (global: GlobalState, ownProps: OwnProps) => AnyLiteral;\ntype StickToFirstFn = (value: any) => boolean;\ntype ActivationFn<OwnProps = undefined> = (\n  global: GlobalState, ownProps: OwnProps, stickToFirst: StickToFirstFn,\n) => boolean;\n// TODO: Add callback to typify\ntype GlobalCallback = (global: any) => void;\n\nlet currentGlobal = {\n  isInited: false,\n} as GlobalState;\n\nlet DEBUG_currentRandomId: number | undefined;\n\nconst DEBUG_invalidateGlobalOnTickEnd = throttleWithTickEnd(() => {\n  DEBUG_currentRandomId = Math.random();\n});\n\nconst actionHandlers: Record<string, ActionHandler[]> = {};\nconst callbacks: GlobalCallback[] = [updateContainers];\nconst actions = {} as Actions;\nconst containers = new Map<string, Container>();\n\nconst runCallbacksThrottled = throttleWithTickEnd(runCallbacks);\n\nlet forceOnHeavyAnimation = true;\n\nfunction runCallbacks() {\n  if (forceOnHeavyAnimation) {\n    forceOnHeavyAnimation = false;\n  } else if (getIsHeavyAnimating()) {\n    getIsHeavyAnimating.once(runCallbacksThrottled);\n    return;\n  }\n\n  callbacks.forEach((cb) => cb(currentGlobal));\n}\n\nexport function setUntypedGlobal(newGlobal?: GlobalState, options?: ActionOptions) {\n  if (typeof newGlobal === 'object' && newGlobal !== currentGlobal) {\n    if (DEBUG) {\n      if (\n        !options?.forceOutdated\n        && newGlobal.DEBUG_randomId && newGlobal.DEBUG_randomId !== DEBUG_currentRandomId\n      ) {\n        throw new Error('[TeactN.setGlobal] Attempt to set an outdated global');\n      }\n\n      DEBUG_currentRandomId = Math.random();\n    }\n\n    currentGlobal = newGlobal;\n\n    if (options?.forceSyncOnIOs) {\n      forceOnHeavyAnimation = true;\n      runCallbacks();\n    } else {\n      if (options?.forceOnHeavyAnimation) {\n        forceOnHeavyAnimation = true;\n      }\n\n      runCallbacksThrottled();\n    }\n  }\n}\n\nexport function getUntypedGlobal() {\n  if (DEBUG) {\n    currentGlobal = {\n      ...currentGlobal,\n      DEBUG_randomId: DEBUG_currentRandomId,\n    };\n    DEBUG_invalidateGlobalOnTickEnd();\n  }\n\n  return currentGlobal;\n}\n\nexport function getUntypedActions() {\n  return actions;\n}\n\nexport function forceOnHeavyAnimationOnce() {\n  forceOnHeavyAnimation = true;\n}\n\nlet actionQueue: NoneToVoidFunction[] = [];\nlet afterActionQueue: NoneToVoidFunction[] = [];\n\nfunction handleAction(name: string, payload?: ActionPayload, options?: ActionOptions): Promise<void> {\n  const deferred = new Deferred<void>();\n  actionQueue.push(() => {\n    actionHandlers[name]?.forEach((handler) => {\n      const result = handler(DEBUG ? getUntypedGlobal() : currentGlobal, actions, payload);\n      if (!result) {\n        deferred.resolve();\n        return;\n      }\n\n      if (typeof result.then === 'function') {\n        result.then(() => {\n          deferred.resolve();\n        });\n        return;\n      }\n\n      setUntypedGlobal(result as GlobalState, options);\n      deferred.resolve();\n    });\n  });\n\n  // Important: Keep 1 as start requirement to avoid immediate nested action calls\n  // Do not remove element from array before it is executed for the same reason\n  if (actionQueue.length === 1) {\n    try {\n      while (actionQueue.length) {\n        actionQueue[0]();\n        actionQueue.shift();\n      }\n      while (afterActionQueue.length) {\n        afterActionQueue[0]();\n        afterActionQueue.shift();\n      }\n    } finally {\n      actionQueue = [];\n      afterActionQueue = [];\n    }\n  }\n\n  return deferred.promise;\n}\n\n/**\n * Execute a function after all actions in stack are executed\n * Call only from action handlers\n */\nexport function execAfterActions(fn: NoneToVoidFunction) {\n  afterActionQueue.push(fn);\n}\n\nfunction updateContainers() {\n  let DEBUG_startAt: number | undefined;\n  if (DEBUG) {\n    DEBUG_startAt = performance.now();\n  }\n\n  for (const container of containers.values()) {\n    const {\n      mapStateToProps, ownProps, mappedProps, forceUpdate,\n    } = container;\n\n    if (!activateContainer(container, currentGlobal, ownProps)) {\n      continue;\n    }\n\n    let newMappedProps;\n\n    try {\n      newMappedProps = mapStateToProps(currentGlobal, ownProps);\n    } catch (err: any) {\n      handleError(err);\n\n      return;\n    }\n\n    if (DEBUG) {\n      if (Object.values(newMappedProps).some(Number.isNaN)) {\n        // eslint-disable-next-line no-console\n        console.warn(\n          // eslint-disable-next-line @stylistic/max-len\n          `[TeactN] Some of \\`${container.DEBUG_componentName}\\` mappers contain NaN values. This may cause redundant updates because of incorrect equality check.`,\n        );\n      }\n    }\n\n    if (Object.keys(newMappedProps).length && !arePropsShallowEqual(mappedProps!, newMappedProps)) {\n      if (DEBUG_MORE) {\n        logUnequalProps(\n          mappedProps!,\n          newMappedProps,\n          `[TeactN] Will update ${container.DEBUG_componentName} caused by:`,\n        );\n      }\n\n      container.mappedProps = newMappedProps;\n      container.DEBUG_updates++;\n\n      forceUpdate();\n    }\n  }\n\n  if (DEBUG) {\n    const updateTime = performance.now() - DEBUG_startAt!;\n    if (updateTime > 7) {\n      // eslint-disable-next-line no-console\n      console.warn(`[TeactN] Slow containers update: ${Math.round(updateTime)} ms`);\n    }\n  }\n}\n\nexport function addUntypedActionHandler(name: ActionNames, handler: ActionHandler) {\n  if (!actionHandlers[name]) {\n    actionHandlers[name] = [];\n\n    actions[name] = (payload?: ActionPayload, options?: ActionOptions) => {\n      return handleAction(name, payload, options);\n    };\n  }\n\n  actionHandlers[name].push(handler);\n}\n\nexport function addCallback(cb: GlobalCallback) {\n  callbacks.push(cb);\n}\n\nexport function removeCallback(cb: GlobalCallback) {\n  const index = callbacks.indexOf(cb);\n  if (index !== -1) {\n    callbacks.splice(index, 1);\n  }\n}\n\nexport function withUntypedGlobal<OwnProps extends AnyLiteral>(\n  mapStateToProps: MapStateToProps<OwnProps> = () => ({}),\n  activationFn?: ActivationFn<OwnProps>,\n) {\n  return (Component: FC) => {\n    function TeactNContainer(props: OwnProps) {\n      const id = useUniqueId();\n      const forceUpdate = useForceUpdate();\n\n      useUnmountCleanup(() => {\n        containers.delete(id);\n      });\n\n      let container = containers.get(id)!;\n      if (!container) {\n        container = {\n          mapStateToProps,\n          activationFn,\n          ownProps: props,\n          forceUpdate,\n          DEBUG_updates: 0,\n          DEBUG_componentName: Component.name,\n        };\n\n        containers.set(id, container);\n      }\n\n      if (\n        (!container.mappedProps || !arePropsShallowEqual(container.ownProps, props))\n        && activateContainer(container, currentGlobal, props)\n      ) {\n        try {\n          container.mappedProps = mapStateToProps(currentGlobal, props);\n        } catch (err: any) {\n          handleError(err);\n        }\n      }\n\n      container.ownProps = props;\n\n      return <Component {...container.mappedProps} {...props} />;\n    }\n\n    (TeactNContainer as FC_withDebug).DEBUG_contentComponentName = DEBUG_resolveComponentName(Component);\n\n    return TeactNContainer;\n  };\n}\n\nfunction activateContainer(container: Container, global: GlobalState, props: Props) {\n  const { activationFn, stuckTo } = container;\n  if (!activationFn) {\n    return true;\n  }\n\n  return activationFn(global, props, (stickTo: any) => {\n    if (stuckTo) {\n      return stuckTo === stickTo;\n    } else if (stickTo !== undefined) {\n      container.stuckTo = stickTo;\n    }\n\n    return true;\n  });\n}\n\nexport function typify<\n  ProjectGlobalState,\n  ActionPayloads,\n>() {\n  type ProjectActionNames = keyof ActionPayloads;\n\n  // When payload is allowed to be `undefined` we consider it optional\n  type ProjectActions<ReturnType = void> = {\n    [ActionName in ProjectActionNames]:\n    (undefined extends ActionPayloads[ActionName] ? (\n      (payload?: ActionPayloads[ActionName], options?: ActionOptions) => ReturnType\n    ) : (\n      (payload: ActionPayloads[ActionName], options?: ActionOptions) => ReturnType\n    ))\n  };\n\n  type ActionHandlers = {\n    [ActionName in keyof ActionPayloads]: (\n      global: ProjectGlobalState,\n      actions: ProjectActions,\n      payload: ActionPayloads[ActionName],\n    ) => ProjectGlobalState | void | Promise<void>;\n  };\n\n  type WithGlobalFn = <OwnProps extends AnyLiteral>(\n    mapStateToProps: (global: ProjectGlobalState, ownProps: OwnProps) => AnyLiteral,\n    activationFn?: (global: ProjectGlobalState, ownProps: OwnProps, stickToFirst: StickToFirstFn) => boolean,\n  ) => (Component: FC) => FC<OwnProps>;\n\n  return {\n    getGlobal: getUntypedGlobal as <T extends ProjectGlobalState>() => T,\n    setGlobal: setUntypedGlobal as (state: ProjectGlobalState, options?: ActionOptions) => void,\n    getActions: getUntypedActions as () => ProjectActions,\n    getPromiseActions: getUntypedActions as () => ProjectActions<Promise<void>>,\n    addActionHandler: addUntypedActionHandler as <ActionName extends ProjectActionNames>(\n      name: ActionName,\n      handler: ActionHandlers[ActionName],\n    ) => void,\n    withGlobal: withUntypedGlobal as WithGlobalFn,\n    execAfterActions,\n  };\n}\n\nif (DEBUG) {\n  (window as any).getGlobal = getUntypedGlobal;\n  (window as any).setGlobal = setUntypedGlobal;\n  (window as any).getActions = getUntypedActions;\n\n  document.addEventListener('dblclick', () => {\n    // eslint-disable-next-line no-console\n    console.warn(\n      'GLOBAL CONTAINERS',\n      orderBy(\n        Array.from(containers.values())\n          .map(({ DEBUG_componentName, DEBUG_updates }) => ({ DEBUG_componentName, DEBUG_updates })),\n        'DEBUG_updates',\n        'desc',\n      ),\n    );\n  });\n}\n","import useShowTransition, {\n  type HookParams,\n  type HookParamsWithShouldRender,\n  type HookResult,\n  type HookResultWithShouldRender,\n} from './useShowTransition';\n\ntype HookParamsWithMediaData<RefType extends HTMLElement> = Omit<HookParams<RefType>, 'isOpen'> & {\n  hasMediaData: boolean;\n};\ntype HookParamsWithMediaDataAndShouldRender<RefType extends HTMLElement>\n  = Omit<HookParamsWithShouldRender<RefType>, 'isOpen'> & {\n    hasMediaData: boolean;\n  };\n\nexport default function useMediaTransition<RefType extends HTMLElement = HTMLDivElement>(\n  params: HookParamsWithMediaData<RefType>\n): HookResult<RefType>;\nexport default function useMediaTransition<RefType extends HTMLElement = HTMLDivElement>(\n  params: HookParamsWithMediaDataAndShouldRender<RefType>\n): HookResultWithShouldRender<RefType>;\nexport default function useMediaTransition<RefType extends HTMLElement = HTMLDivElement>(\n  params: HookParamsWithMediaData<RefType> | HookParamsWithMediaDataAndShouldRender<RefType>,\n): HookResult<RefType> | HookResultWithShouldRender<RefType> {\n  const result = useShowTransition<RefType>({\n    isOpen: params.hasMediaData,\n    noMountTransition: params.hasMediaData,\n    className: 'slow',\n    ...params,\n  } as HookParams<RefType>);\n\n  return result;\n}\n","import { useState } from '../../lib/teact/teact';\n\nimport { createCallbackManager } from '../../util/callbacks';\nimport useEffectOnce from '../useEffectOnce';\n\nconst callbacks = createCallbackManager();\n\nfunction createListener() {\n  window.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`)\n    .addEventListener('change', callbacks.runCallbacks, { once: true });\n}\n\nexport default function useDevicePixelRatio() {\n  const [dpr, setDpr] = useState(window.devicePixelRatio);\n\n  useEffectOnce(() => {\n    return callbacks.addCallback(() => {\n      setDpr(window.devicePixelRatio);\n    });\n  });\n\n  return dpr;\n}\n\ncreateListener();\n\n// Set up new listener for the next `devicePixelRatio` change\ncallbacks.addCallback(createListener);\n","import {\n  addLocalizationCallback,\n  getTranslationFn,\n  type LangFn,\n} from '../util/localization';\nimport useEffectOnce from './useEffectOnce';\nimport useForceUpdate from './useForceUpdate';\n\nconst useLang = (): LangFn => {\n  const forceUpdate = useForceUpdate();\n\n  useEffectOnce(() => {\n    return addLocalizationCallback(forceUpdate);\n  });\n\n  return getTranslationFn();\n};\n\nexport default useLang;\n","import { useEffect, useMemo, useState } from '../../lib/teact/teact';\n\nimport { throttle } from '../../util/schedulers';\nimport windowSize from '../../util/windowSize';\nimport useDebouncedCallback from '../useDebouncedCallback';\n\nconst THROTTLE = 250;\n\nexport default function useWindowSize() {\n  const { width: initialWidth, height: initialHeight } = windowSize.get();\n  const [width, setWidth] = useState(initialWidth);\n  const [height, setHeight] = useState(initialHeight);\n  const [isResizing, setIsResizing] = useState(false);\n  const setIsResizingDebounced = useDebouncedCallback(setIsResizing, [setIsResizing], THROTTLE, true);\n\n  useEffect(() => {\n    const throttledSetIsResizing = throttle(() => {\n      setIsResizing(true);\n    }, THROTTLE, true);\n\n    const throttledSetSize = throttle(() => {\n      const { width: newWidth, height: newHeight } = windowSize.get();\n      setWidth(newWidth);\n      setHeight(newHeight);\n      setIsResizingDebounced(false);\n    }, THROTTLE, false);\n\n    const handleResize = () => {\n      throttledSetIsResizing();\n      throttledSetSize();\n    };\n\n    window.addEventListener('resize', handleResize);\n\n    return () => {\n      window.removeEventListener('resize', handleResize);\n    };\n  }, [setIsResizingDebounced]);\n\n  return useMemo(() => ({ width, height, isResizing }), [height, isResizing, width]);\n}\n","export default function unloadVideo(video: HTMLVideoElement) {\n  video.pause();\n  // https://github.com/shaka-project/shaka-player/commit/0e3d10e61cb08cc35750e48face4e58f24542fc8\n  video.removeAttribute('src');\n  while (video.firstChild) {\n    video.removeChild(video.firstChild);\n  }\n\n  video.load();\n}\n","import {\n  memo, useEffect, useRef, useState,\n} from '../../../lib/teact/teact';\n\nimport { requestMutation } from '../../../lib/fasterdom/fasterdom';\nimport { getStickerMediaHash } from '../../../global/helpers';\nimport buildClassName from '../../../util/buildClassName';\nimport { preloadImage } from '../../../util/files';\nimport { REM } from '../helpers/mediaDimensions';\n\nimport useDynamicColorListener from '../../../hooks/stickers/useDynamicColorListener';\nimport { useThrottleForHeavyAnimation } from '../../../hooks/useHeavyAnimation';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useMedia from '../../../hooks/useMedia';\nimport useOldLang from '../../../hooks/useOldLang';\nimport useResizeObserver from '../../../hooks/useResizeObserver';\nimport useDevicePixelRatio from '../../../hooks/window/useDevicePixelRatio';\nimport useCustomEmoji from '../hooks/useCustomEmoji';\n\nimport styles from './EmojiIconBackground.module.scss';\n\ntype IconPosition = {\n  inline: number;\n  block: number;\n  opacity: number;\n  scale: number;\n};\n\nconst ICON_POSITIONS: IconPosition[] = [\n  {\n    inline: 22, block: 38, opacity: 0.35, scale: 0.75,\n  },\n  {\n    inline: 32, block: 12, opacity: 0.3, scale: 1,\n  },\n  {\n    inline: 60, block: 22, opacity: 0.25, scale: 0.75,\n  },\n  {\n    inline: 75, block: 44, opacity: 0.25, scale: 1,\n  },\n  {\n    inline: 75, block: 2, opacity: 0.2, scale: 0.625,\n  },\n  {\n    inline: 95, block: 18, opacity: 0.2, scale: 1,\n  },\n  {\n    inline: 115, block: 38, opacity: 0.2, scale: 0.625,\n  },\n  {\n    inline: 125, block: 12, opacity: 0.1, scale: 0.75,\n  },\n];\n\nconst EMOJI_SIZE = REM;\nconst LOTTIE_TINT_OPACITY = 'ff';\nconst NON_LOTTIE_TINT_OPACITY = 'bb';\n\ntype OwnProps = {\n  emojiDocumentId: string;\n  className?: string;\n};\n\nconst EmojiIconBackground = ({\n  emojiDocumentId,\n  className,\n}: OwnProps) => {\n  const canvasRef = useRef<HTMLCanvasElement>();\n  const containerRef = useRef<HTMLDivElement>();\n\n  const [emojiImage, setEmojiImage] = useState<HTMLImageElement | undefined>();\n\n  const dpr = useDevicePixelRatio();\n\n  const lang = useOldLang();\n\n  const { customEmoji } = useCustomEmoji(emojiDocumentId);\n  const previewMediaHash = customEmoji ? getStickerMediaHash(customEmoji, 'preview') : undefined;\n  const previewUrl = useMedia(previewMediaHash);\n\n  const customColor = useDynamicColorListener(containerRef);\n\n  const preloadAfterHeavyAnimation = useThrottleForHeavyAnimation(() => {\n    if (!previewUrl) return;\n    preloadImage(previewUrl).then(setEmojiImage);\n  }, [previewUrl]);\n\n  useEffect(() => {\n    preloadAfterHeavyAnimation();\n  }, [preloadAfterHeavyAnimation]);\n\n  const updateCanvas = useLastCallback(() => {\n    const canvas = canvasRef.current;\n    if (!canvas || !emojiImage || !customColor) return;\n\n    const context = canvas.getContext('2d')!;\n    const { width, height } = canvas;\n\n    context.clearRect(0, 0, width, height);\n\n    ICON_POSITIONS.forEach(({\n      inline, block, opacity, scale,\n    }) => {\n      const x = (lang.isRtl ? inline : width / dpr - inline) * dpr;\n      const y = block * dpr;\n\n      const emojiSize = EMOJI_SIZE * dpr;\n\n      context.save();\n      context.globalAlpha = opacity;\n      context.translate(x, y);\n      context.scale(scale, scale);\n      context.drawImage(emojiImage, -emojiSize / 2, -emojiSize / 2, emojiSize, emojiSize);\n      context.restore();\n    });\n\n    const tintColor = `${customColor}${customEmoji!.isLottie ? LOTTIE_TINT_OPACITY : NON_LOTTIE_TINT_OPACITY}`;\n\n    context.save();\n    context.fillStyle = tintColor;\n    context.globalCompositeOperation = 'source-atop';\n    context.fillRect(0, 0, width, height);\n    context.restore();\n  });\n\n  const updateCanvasAfterHeavyAnimation = useThrottleForHeavyAnimation(updateCanvas, [updateCanvas]);\n\n  useEffect(() => {\n    updateCanvasAfterHeavyAnimation();\n  }, [emojiImage, lang.isRtl, customColor, updateCanvasAfterHeavyAnimation]);\n\n  const updateCanvasSize = useThrottleForHeavyAnimation((parentWidth: number, parentHeight: number) => {\n    requestMutation(() => {\n      const canvas = canvasRef.current;\n      if (!canvas) return;\n\n      canvas.width = parentWidth * dpr;\n      canvas.height = parentHeight * dpr;\n\n      canvas.style.width = `${parentWidth}px`;\n      canvas.style.height = `${parentHeight}px`;\n\n      updateCanvas();\n    });\n  }, [dpr]);\n\n  const handleResize = useThrottleForHeavyAnimation((entry: ResizeObserverEntry) => {\n    const { width, height } = entry.contentRect;\n\n    updateCanvasSize(width, height);\n  }, [updateCanvasSize]);\n\n  useResizeObserver(containerRef, handleResize);\n\n  useEffect(() => {\n    const container = containerRef.current;\n    if (!container) return;\n\n    const { width, height } = container.getBoundingClientRect();\n\n    updateCanvasSize(width, height);\n  }, [updateCanvasSize]);\n\n  return (\n    <div className={buildClassName(styles.root, className)} ref={containerRef}>\n      <canvas ref={canvasRef} />\n    </div>\n  );\n};\n\nexport default memo(EmojiIconBackground);\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"pTWe_CYU\"};","import type {\n  ChangeEvent, FormEvent,\n} from 'react';\nimport type { ElementRef, FC } from '../../lib/teact/teact';\nimport { memo } from '../../lib/teact/teact';\n\nimport { IS_TAURI } from '../../util/browser/globalEnvironment';\nimport buildClassName from '../../util/buildClassName';\n\nimport useOldLang from '../../hooks/useOldLang';\n\ntype OwnProps = {\n  ref?: ElementRef<HTMLInputElement>;\n  id?: string;\n  className?: string;\n  value?: string;\n  label?: string;\n  error?: string;\n  success?: string;\n  disabled?: boolean;\n  readOnly?: boolean;\n  placeholder?: string;\n  autoComplete?: string;\n  maxLength?: number;\n  tabIndex?: number;\n  teactExperimentControlled?: boolean;\n  inputMode?: 'text' | 'none' | 'tel' | 'url' | 'email' | 'numeric' | 'decimal' | 'search';\n  onChange?: (e: ChangeEvent<HTMLInputElement>) => void;\n  onInput?: (e: FormEvent<HTMLInputElement>) => void;\n  onKeyPress?: (e: React.KeyboardEvent<HTMLInputElement>) => void;\n  onKeyDown?: (e: React.KeyboardEvent<HTMLInputElement>) => void;\n  onBlur?: (e: React.FocusEvent<HTMLInputElement>) => void;\n  onPaste?: (e: React.ClipboardEvent<HTMLInputElement>) => void;\n};\n\nconst InputText: FC<OwnProps> = ({\n  ref,\n  id,\n  className,\n  value,\n  label,\n  error,\n  success,\n  disabled,\n  readOnly,\n  placeholder,\n  autoComplete,\n  inputMode,\n  maxLength,\n  tabIndex,\n  teactExperimentControlled,\n  onChange,\n  onInput,\n  onKeyPress,\n  onKeyDown,\n  onBlur,\n  onPaste,\n}) => {\n  const lang = useOldLang();\n  const labelText = error || success || label;\n  const fullClassName = buildClassName(\n    'input-group',\n    value && 'touched',\n    error ? 'error' : success && 'success',\n    disabled && 'disabled',\n    readOnly && 'disabled',\n    labelText && 'with-label',\n    className,\n  );\n\n  return (\n    <div className={fullClassName} dir={lang.isRtl ? 'rtl' : undefined}>\n      <input\n        ref={ref}\n        className=\"form-control\"\n        type=\"text\"\n        id={id}\n        dir=\"auto\"\n        value={value || ''}\n        tabIndex={tabIndex}\n        placeholder={placeholder}\n        maxLength={maxLength}\n        autoComplete={autoComplete}\n        spellCheck={IS_TAURI ? false : undefined}\n        inputMode={inputMode}\n        disabled={disabled}\n        readOnly={readOnly}\n        onChange={onChange}\n        onInput={onInput}\n        onKeyPress={onKeyPress}\n        onKeyDown={onKeyDown}\n        onBlur={onBlur}\n        onPaste={onPaste}\n        aria-label={labelText}\n        teactExperimentControlled={teactExperimentControlled}\n      />\n      {labelText && (\n        <label htmlFor={id}>{labelText}</label>\n      )}\n    </div>\n  );\n};\n\nexport default memo(InputText);\n","import type { ElementRef } from '@teact';\nimport { beginHeavyAnimation, useEffect, useLayoutEffect, useRef } from '@teact';\nimport { addExtraClass, removeExtraClass, setExtraStyles, toggleExtraClass } from '@teact/teact-dom';\nimport { getGlobal } from '../../global';\n\nimport { requestForcedReflow, requestMutation } from '../../lib/fasterdom/fasterdom';\nimport { selectCanAnimateInterface } from '../../global/selectors';\nimport buildClassName from '../../util/buildClassName';\nimport { waitForAnimationEnd, waitForTransitionEnd } from '../../util/cssAnimationEndListeners';\nimport forceReflow from '../../util/forceReflow';\nimport { omit } from '../../util/iteratees';\nimport { allowSwipeControlForTransition } from '../../util/swipeController';\n\nimport useForceUpdate from '../../hooks/useForceUpdate';\nimport usePreviousDeprecated from '../../hooks/usePreviousDeprecated';\nimport useSyncEffectWithPrevDeps from '../../hooks/useSyncEffectWithPrevDeps.ts';\n\nimport './Transition.scss';\n\ntype AnimationName = (\n  'none' | 'slide' | 'slideRtl' | 'slideFade' | 'zoomFade' | 'zoomBounceSemiFade' | 'slideLayers'\n  | 'fade' | 'pushSlide' | 'reveal' | 'slideOptimized' | 'slideOptimizedRtl' | 'semiFade'\n  | 'slideVertical' | 'slideVerticalFade' | 'slideFadeAndroid'\n  );\nexport type ChildrenFn = (isActive: boolean, isFrom: boolean, currentKey: number, activeKey: number) => React.ReactNode;\nexport type TransitionProps = {\n  ref?: ElementRef<HTMLDivElement>;\n  activeKey: number;\n  nextKey?: number;\n  name: AnimationName;\n  direction?: 'auto' | 'inverse' | 1 | -1;\n  renderCount?: number;\n  shouldRestoreHeight?: boolean;\n  shouldCleanup?: boolean;\n  cleanupExceptionKey?: number;\n  cleanupOnlyKey?: number;\n  // Used by async components which are usually remounted during first animation\n  shouldWrap?: boolean;\n  wrapExceptionKey?: number;\n  id?: string;\n  className?: string;\n  slideClassName?: string;\n  withSwipeControl?: boolean;\n  isBlockingAnimation?: boolean;\n  onStart?: NoneToVoidFunction;\n  onStop?: NoneToVoidFunction;\n  onScroll?: NoneToVoidFunction;\n  onMouseDown?: (e: React.MouseEvent<HTMLDivElement>) => void;\n  children: React.ReactNode | ChildrenFn;\n  'data-tauri-drag-region'?: true;\n  contentSelector?: string;\n  restoreHeightKey?: number;\n};\n\nconst FALLBACK_ANIMATION_END = 1000;\nconst CLASSES = {\n  slide: 'Transition_slide',\n  active: 'Transition_slide-active',\n  from: 'Transition_slide-from',\n  to: 'Transition_slide-to',\n  inactive: 'Transition_slide-inactive',\n};\n\nexport const ACTIVE_SLIDE_CLASS_NAME = CLASSES.active;\nexport const TO_SLIDE_CLASS_NAME = CLASSES.to;\n\nconst DISABLEABLE_ANIMATIONS = new Set<AnimationName>([\n  'slide', 'slideRtl', 'slideFade', 'zoomFade', 'zoomBounceSemiFade', 'slideLayers', 'pushSlide', 'reveal',\n  'slideOptimized', 'slideOptimizedRtl', 'slideVertical', 'slideVerticalFade',\n]);\n\nfunction Transition({\n  ref,\n  activeKey,\n  nextKey,\n  name,\n  direction = 'auto',\n  renderCount,\n  shouldRestoreHeight,\n  shouldCleanup,\n  cleanupExceptionKey,\n  cleanupOnlyKey,\n  shouldWrap,\n  wrapExceptionKey,\n  id,\n  className,\n  slideClassName,\n  withSwipeControl,\n  isBlockingAnimation,\n  onStart,\n  onStop,\n  onScroll,\n  onMouseDown,\n  children,\n  'data-tauri-drag-region': dataTauriDragRegion,\n  contentSelector,\n  restoreHeightKey,\n}: TransitionProps) {\n  const currentKeyRef = useRef<number>();\n  // No need for a container to update on change\n  const shouldDisableAnimation = DISABLEABLE_ANIMATIONS.has(name)\n    && !selectCanAnimateInterface(getGlobal());\n\n  let containerRef = useRef<HTMLDivElement>();\n  if (ref) {\n    containerRef = ref;\n  }\n\n  const rendersRef = useRef<Record<number, React.ReactNode | ChildrenFn>>({});\n  const prevActiveKey = usePreviousDeprecated<any>(activeKey);\n  const forceUpdate = useForceUpdate();\n  const isAnimatingRef = useRef(false);\n  const isSwipeJustCancelledRef = useRef(false);\n\n  const hasActiveKeyChanged = prevActiveKey !== undefined && activeKey !== prevActiveKey;\n\n  if (!renderCount && hasActiveKeyChanged) {\n    rendersRef.current = { [prevActiveKey]: rendersRef.current[prevActiveKey] };\n  }\n\n  rendersRef.current[activeKey] = children;\n  if (nextKey) {\n    rendersRef.current[nextKey] = children;\n  }\n\n  // Reset when switching from/to \"optimized\" transitions\n  useSyncEffectWithPrevDeps(([prevName]) => {\n    if (!prevName) return;\n\n    const prevIsSliceOptimized = prevName === 'slideOptimized' || prevName === 'slideOptimizedRtl';\n    const isSlideOptimized = name === 'slideOptimized' || name === 'slideOptimizedRtl';\n    const shouldReset = (prevIsSliceOptimized && !isSlideOptimized) || (!prevIsSliceOptimized && isSlideOptimized);\n    if (!shouldReset) return;\n\n    rendersRef.current = { [activeKey]: children };\n\n    if (prevIsSliceOptimized) {\n      requestMutation(() => {\n        const container = containerRef.current!;\n\n        ['slideOptimized', 'slideOptimizedBackwards', 'slideOptimizedRtl', 'slideOptimizedRtlBackwards']\n          .forEach((cn) => removeExtraClass(container, `Transition-${cn}`));\n      });\n    }\n  }, [name]);\n\n  const isBackwards = (\n    direction === -1\n    || (direction === 'auto' && prevActiveKey > activeKey)\n    || (direction === 'inverse' && prevActiveKey < activeKey)\n  );\n\n  useLayoutEffect(() => {\n    function cleanup() {\n      if (!shouldCleanup) return;\n\n      if (cleanupExceptionKey !== undefined) {\n        rendersRef.current = { [cleanupExceptionKey]: rendersRef.current[cleanupExceptionKey] };\n      } else if (cleanupOnlyKey !== undefined) {\n        rendersRef.current = omit(rendersRef.current, [cleanupOnlyKey]);\n      } else {\n        rendersRef.current = {};\n      }\n\n      forceUpdate();\n    }\n\n    const isSlideOptimized = name === 'slideOptimized' || name === 'slideOptimizedRtl';\n    const container = containerRef.current!;\n    const keys = Object.keys(rendersRef.current).map(Number);\n    const prevActiveIndex = renderCount ? prevActiveKey : keys.indexOf(prevActiveKey);\n    const activeIndex = renderCount ? activeKey : keys.indexOf(activeKey);\n\n    const childNodes = Array.from(container.childNodes);\n    if (!childNodes.length) {\n      return;\n    }\n\n    const childElements = Array.from(container.children) as HTMLElement[];\n    childElements.forEach((el) => {\n      addExtraClass(el, CLASSES.slide);\n\n      if (slideClassName) {\n        slideClassName.split(/\\s+/).forEach((token) => {\n          addExtraClass(el, token);\n        });\n      }\n    });\n\n    if (!hasActiveKeyChanged) {\n      if (isAnimatingRef.current) {\n        return;\n      }\n\n      childElements.forEach((childElement) => {\n        if (childElement === childNodes[activeIndex]) {\n          addExtraClass(childElement, CLASSES.active);\n\n          if (isSlideOptimized) {\n            setExtraStyles(childElement, {\n              transition: 'none',\n              transform: 'translate3d(0, 0, 0)',\n            });\n          }\n        } else if (!isSlideOptimized) {\n          addExtraClass(childElement, CLASSES.inactive);\n        }\n      });\n\n      return;\n    }\n\n    currentKeyRef.current = activeKey;\n\n    if (isSlideOptimized) {\n      if (!childNodes[activeIndex]) {\n        return;\n      }\n\n      performSlideOptimized(\n        shouldDisableAnimation,\n        name,\n        isBackwards,\n        cleanup,\n        activeKey,\n        currentKeyRef,\n        isAnimatingRef,\n        container,\n        childNodes[activeIndex],\n        childNodes[prevActiveIndex],\n        shouldRestoreHeight,\n        isBlockingAnimation,\n        onStart,\n        onStop,\n      );\n\n      return;\n    }\n\n    if (name === 'none' || shouldDisableAnimation || isSwipeJustCancelledRef.current) {\n      if (isSwipeJustCancelledRef.current) {\n        isSwipeJustCancelledRef.current = false;\n      }\n\n      childNodes.forEach((node, i) => {\n        if (node instanceof HTMLElement) {\n          removeExtraClass(node, CLASSES.from);\n          removeExtraClass(node, CLASSES.to);\n          toggleExtraClass(node, CLASSES.active, i === activeIndex);\n          toggleExtraClass(node, CLASSES.inactive, i !== activeIndex);\n        }\n      });\n\n      cleanup();\n\n      return;\n    }\n\n    childNodes.forEach((node, i) => {\n      if (node instanceof HTMLElement) {\n        removeExtraClass(node, CLASSES.active);\n        toggleExtraClass(node, CLASSES.from, i === prevActiveIndex);\n        toggleExtraClass(node, CLASSES.to, i === activeIndex);\n        toggleExtraClass(node, CLASSES.inactive, i !== prevActiveIndex && i !== activeIndex);\n      }\n    });\n\n    isAnimatingRef.current = true;\n    const endHeavyAnimation = beginHeavyAnimation(undefined, isBlockingAnimation);\n    onStart?.();\n\n    toggleExtraClass(container, `Transition-${name}`, !isBackwards);\n    toggleExtraClass(container, `Transition-${name}Backwards`, isBackwards);\n\n    function onAnimationEnd() {\n      const activeElement = container.querySelector<HTMLDivElement>(`.${CLASSES.active}`);\n      const { clientHeight } = activeElement || {};\n\n      requestMutation(() => {\n        if (activeKey !== currentKeyRef.current) {\n          endHeavyAnimation();\n          return;\n        }\n\n        removeExtraClass(container, `Transition-${name}`);\n        removeExtraClass(container, `Transition-${name}Backwards`);\n\n        childNodes.forEach((node, i) => {\n          if (node instanceof HTMLElement) {\n            removeExtraClass(node, CLASSES.from);\n            removeExtraClass(node, CLASSES.to);\n            toggleExtraClass(node, CLASSES.active, i === activeIndex);\n            toggleExtraClass(node, CLASSES.inactive, i !== activeIndex);\n          }\n        });\n\n        if (shouldRestoreHeight) {\n          if (activeElement) {\n            setExtraStyles(activeElement, { height: 'auto' });\n            setExtraStyles(container, { height: `${clientHeight}px` });\n          }\n        }\n\n        onStop?.();\n        endHeavyAnimation();\n        isAnimatingRef.current = false;\n\n        cleanup();\n      });\n    }\n\n    const watchedNode = (name === 'reveal' || name === 'slideFadeAndroid') && isBackwards\n      ? childNodes[prevActiveIndex]\n      : childNodes[activeIndex];\n\n    if (watchedNode) {\n      if (withSwipeControl && childNodes[prevActiveIndex]) {\n        const giveUpAnimationEnd = waitForAnimationEnd(watchedNode, onAnimationEnd);\n\n        allowSwipeControlForTransition(\n          childNodes[prevActiveIndex] as HTMLElement,\n          childNodes[activeIndex] as HTMLElement,\n          () => {\n            giveUpAnimationEnd();\n            isSwipeJustCancelledRef.current = true;\n            onStop?.();\n            endHeavyAnimation();\n            isAnimatingRef.current = false;\n          },\n        );\n      } else {\n        waitForAnimationEnd(watchedNode, onAnimationEnd, undefined, FALLBACK_ANIMATION_END);\n      }\n    } else {\n      onAnimationEnd();\n    }\n  }, [\n    activeKey,\n    nextKey,\n    prevActiveKey,\n    hasActiveKeyChanged,\n    isBackwards,\n    name,\n    onStart,\n    onStop,\n    renderCount,\n    shouldRestoreHeight,\n    shouldCleanup,\n    slideClassName,\n    cleanupExceptionKey,\n    shouldDisableAnimation,\n    forceUpdate,\n    withSwipeControl,\n    isBlockingAnimation,\n    cleanupOnlyKey,\n  ]);\n\n  useEffect(() => {\n    if (!shouldRestoreHeight) {\n      return;\n    }\n\n    const container = containerRef.current!;\n    const activeElement = container.querySelector<HTMLDivElement>(`:scope > .${CLASSES.active}`)\n      || container.querySelector<HTMLDivElement>(`:scope > .${CLASSES.from}`);\n    if (!activeElement) {\n      return;\n    }\n\n    const contentElement = contentSelector\n      ? activeElement.querySelector<HTMLDivElement>(contentSelector) : activeElement;\n\n    const { clientHeight, clientWidth } = contentElement || activeElement || {};\n    if (!clientHeight || !clientWidth) {\n      return;\n    }\n\n    requestMutation(() => {\n      setExtraStyles(activeElement, { height: 'auto' });\n      setExtraStyles(container, {\n        height: `${clientHeight}px`,\n        flexBasis: `${clientHeight}px`,\n      });\n    });\n  }, [shouldRestoreHeight, children, restoreHeightKey, contentSelector]);\n\n  const asFastList = !renderCount;\n  const renders = rendersRef.current;\n  const renderKeys = Object.keys(renderCount ? new Array(renderCount).fill(undefined) : renders).map(Number);\n  const contents = renderKeys.map((key) => {\n    const render = renders[key];\n    if (!render) {\n      return undefined;\n    }\n\n    const rendered = typeof render === 'function'\n      ? render(key === activeKey, key === prevActiveKey, key, activeKey)\n      : render;\n\n    return (shouldWrap && key !== wrapExceptionKey) || asFastList\n      ? <div key={key} teactOrderKey={key}>{rendered}</div>\n      : rendered;\n  });\n\n  return (\n    <div\n      ref={containerRef}\n      id={id}\n      className={buildClassName('Transition', className)}\n      teactFastList={asFastList}\n      data-tauri-drag-region={dataTauriDragRegion}\n      onScroll={onScroll}\n      onMouseDown={onMouseDown}\n    >\n      {contents}\n    </div>\n  );\n}\n\nexport default Transition;\n\nfunction performSlideOptimized(\n  shouldDisableAnimation: boolean,\n  name: 'slideOptimized' | 'slideOptimizedRtl',\n  isBackwards: boolean,\n  cleanup: NoneToVoidFunction,\n  activeKey: number,\n  currentKeyRef: { current: number | undefined },\n  isAnimatingRef: { current: boolean | undefined },\n  container: HTMLElement,\n  toSlide: ChildNode,\n  fromSlide?: ChildNode,\n  shouldRestoreHeight?: boolean,\n  isBlockingAnimation?: boolean,\n  onStart?: NoneToVoidFunction,\n  onStop?: NoneToVoidFunction,\n) {\n  if (shouldDisableAnimation) {\n    toggleExtraClass(container, `Transition-${name}`, !isBackwards);\n    toggleExtraClass(container, `Transition-${name}Backwards`, isBackwards);\n\n    if (fromSlide instanceof HTMLElement) {\n      removeExtraClass(fromSlide, CLASSES.active);\n      setExtraStyles(fromSlide, {\n        transition: 'none',\n        transform: '',\n      });\n    }\n\n    if (toSlide instanceof HTMLElement) {\n      addExtraClass(toSlide, CLASSES.active);\n      setExtraStyles(toSlide, {\n        transition: 'none',\n        transform: 'translate3d(0, 0, 0)',\n      });\n    }\n\n    cleanup();\n\n    return;\n  }\n\n  if (name === 'slideOptimizedRtl') {\n    isBackwards = !isBackwards;\n  }\n\n  isAnimatingRef.current = true;\n  const endHeavyAnimation = beginHeavyAnimation(undefined, isBlockingAnimation);\n  onStart?.();\n\n  toggleExtraClass(container, `Transition-${name}`, !isBackwards);\n  toggleExtraClass(container, `Transition-${name}Backwards`, isBackwards);\n\n  if (fromSlide instanceof HTMLElement) {\n    setExtraStyles(fromSlide, {\n      transition: 'none',\n      transform: 'translate3d(0, 0, 0)',\n    });\n  }\n\n  if (toSlide instanceof HTMLElement) {\n    setExtraStyles(toSlide, {\n      transition: 'none',\n      transform: `translate3d(${isBackwards ? '-' : ''}100%, 0, 0)`,\n    });\n  }\n\n  requestForcedReflow(() => {\n    if (toSlide instanceof HTMLElement) {\n      forceReflow(toSlide);\n    }\n\n    return () => {\n      if (fromSlide instanceof HTMLElement) {\n        removeExtraClass(fromSlide, CLASSES.active);\n        setExtraStyles(fromSlide, {\n          transition: '',\n          transform: `translate3d(${isBackwards ? '' : '-'}100%, 0, 0)`,\n        });\n      }\n\n      if (toSlide instanceof HTMLElement) {\n        addExtraClass(toSlide, CLASSES.active);\n        setExtraStyles(toSlide, {\n          transition: '',\n          transform: 'translate3d(0, 0, 0)',\n        });\n      }\n    };\n  });\n\n  waitForTransitionEnd(toSlide, () => {\n    const clientHeight = toSlide instanceof HTMLElement ? toSlide.clientHeight : undefined;\n\n    requestMutation(() => {\n      if (activeKey !== currentKeyRef.current) {\n        endHeavyAnimation();\n        return;\n      }\n\n      if (fromSlide instanceof HTMLElement) {\n        setExtraStyles(fromSlide, {\n          transition: 'none',\n          transform: '',\n        });\n      }\n\n      if (shouldRestoreHeight && clientHeight && toSlide instanceof HTMLElement) {\n        setExtraStyles(toSlide, { height: 'auto' });\n        setExtraStyles(container, { height: `${clientHeight}px` });\n      }\n\n      onStop?.();\n      endHeavyAnimation();\n      isAnimatingRef.current = false;\n\n      cleanup();\n    });\n  });\n}\n","import { useRef } from '../lib/teact/teact';\n\n// Allows to use state value as \"silent\" dependency in hooks (not causing updates).\n// Also useful for state values that update frequently (such as controlled input value).\nexport function useStateRef<T>(value: T) {\n  const ref = useRef<T>(value);\n  ref.current = value;\n  return ref;\n}\n","// Used before applying CSS transition\nexport default function forceReflow(element: HTMLElement) {\n  // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n  element.offsetWidth;\n}\n","import { DEBUG } from '../config';\n\nconst safePlay = (mediaEl: HTMLMediaElement) => {\n  mediaEl.play().catch((err) => {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn(err, mediaEl);\n    }\n  });\n};\n\nexport const getIsVideoPlaying = (video: HTMLVideoElement) => {\n  return video.currentTime > 0 && !video.paused && !video.ended && video.readyState > 2;\n};\n\nexport default safePlay;\n","import { getIsHeavyAnimating, onFullyIdle } from '../lib/teact/teact';\nimport { addCallback, removeCallback } from '../lib/teact/teactn';\n\nimport type {\n  ApiAvailableReaction,\n  ApiMessage,\n} from '../api/types';\nimport type { MessageList, ThreadId } from '../types';\nimport type { ActionReturnType, GlobalState, SharedState } from './types';\nimport { MAIN_THREAD_ID } from '../api/types';\n\nimport {\n  ALL_FOLDER_ID, ANIMATION_LEVEL_DEFAULT,\n  ARCHIVED_FOLDER_ID,\n  DEBUG,\n  GLOBAL_STATE_CACHE_ARCHIVED_CHAT_LIST_LIMIT,\n  GLOBAL_STATE_CACHE_CHAT_LIST_LIMIT,\n  GLOBAL_STATE_CACHE_CUSTOM_EMOJI_LIMIT,\n  GLOBAL_STATE_CACHE_DISABLED,\n  GLOBAL_STATE_CACHE_USER_LIST_LIMIT,\n  IS_SCREEN_LOCKED_CACHE_KEY,\n  SAVED_FOLDER_ID,\n  SHARED_STATE_CACHE_KEY,\n} from '../config';\nimport { MAIN_IDB_STORE } from '../util/browser/idb';\nimport { isUserId } from '../util/entities/ids';\nimport { getOrderedIds } from '../util/folderManager';\nimport {\n  compact, pick, pickTruthy, unique,\n} from '../util/iteratees';\nimport { GLOBAL_STATE_CACHE_KEY } from '../util/multiaccount';\nimport { encryptSession } from '../util/passcode';\nimport { onBeforeUnload, throttle } from '../util/schedulers';\nimport { hasStoredSession } from '../util/sessions';\nimport { addActionHandler, getGlobal } from './index';\nimport { INITIAL_GLOBAL_STATE, INITIAL_PERFORMANCE_STATE_MED } from './initialState';\nimport { clearGlobalForLockScreen, clearSharedStateForLockScreen } from './reducers';\nimport {\n  selectChatLastMessageId,\n  selectChatMessages,\n  selectCurrentMessageList,\n  selectFullWebPageFromMessage,\n  selectTopics,\n  selectViewportIds,\n  selectVisibleUsers,\n} from './selectors';\n\nimport { getIsMobile } from '../hooks/useAppLayout';\n\nconst UPDATE_THROTTLE = 5000;\n\nconst updateCacheThrottled = throttle(() => onFullyIdle(() => updateCache()), UPDATE_THROTTLE, false);\nconst updateCacheForced = () => updateCache(true);\n\nlet isCaching = false;\nlet isRemovingCache = false;\nlet unsubscribeFromBeforeUnload: NoneToVoidFunction | undefined;\n\nexport function cacheGlobal(global: GlobalState) {\n  return MAIN_IDB_STORE.set(GLOBAL_STATE_CACHE_KEY, global);\n}\n\nexport function cacheSharedState(state: SharedState) {\n  return MAIN_IDB_STORE.set(SHARED_STATE_CACHE_KEY, state);\n}\n\nexport function loadCachedGlobal() {\n  return MAIN_IDB_STORE.get<GlobalState>(GLOBAL_STATE_CACHE_KEY);\n}\n\nexport function loadCachedSharedState() {\n  return MAIN_IDB_STORE.get<SharedState>(SHARED_STATE_CACHE_KEY);\n}\n\nexport function removeGlobalFromCache() {\n  return MAIN_IDB_STORE.del(GLOBAL_STATE_CACHE_KEY);\n}\n\nexport function removeSharedStateFromCache() {\n  return MAIN_IDB_STORE.del(SHARED_STATE_CACHE_KEY);\n}\n\nfunction cacheIsScreenLocked(global: GlobalState) {\n  if (global?.passcode?.isScreenLocked) localStorage.setItem(IS_SCREEN_LOCKED_CACHE_KEY, 'true');\n}\n\nexport function initCache() {\n  if (GLOBAL_STATE_CACHE_DISABLED) {\n    return;\n  }\n\n  const resetCache = () => {\n    isRemovingCache = true;\n    removeGlobalFromCache().finally(() => {\n      localStorage.removeItem(IS_SCREEN_LOCKED_CACHE_KEY);\n      isRemovingCache = false;\n      if (!isCaching) {\n        return;\n      }\n\n      clearCaching();\n    });\n  };\n\n  addActionHandler('saveSession', (): ActionReturnType => {\n    if (isCaching) {\n      return;\n    }\n\n    setupCaching();\n    updateCacheForced();\n  });\n\n  addActionHandler('reset', resetCache);\n}\n\nexport async function loadCache(initialState: GlobalState): Promise<GlobalState | undefined> {\n  if (GLOBAL_STATE_CACHE_DISABLED) {\n    return undefined;\n  }\n\n  const cache = await readCache(initialState);\n\n  if (cache.passcode.hasPasscode || hasStoredSession()) {\n    setupCaching();\n\n    return cache;\n  } else {\n    clearCaching();\n\n    return undefined;\n  }\n}\n\nexport function setupCaching() {\n  isCaching = true;\n  unsubscribeFromBeforeUnload = onBeforeUnload(updateCacheForced, true);\n  window.addEventListener('blur', updateCacheForced);\n  addCallback(updateCacheThrottled);\n}\n\nexport function clearCaching() {\n  isCaching = false;\n  removeCallback(updateCacheThrottled);\n  window.removeEventListener('blur', updateCacheForced);\n  if (unsubscribeFromBeforeUnload) {\n    unsubscribeFromBeforeUnload();\n  }\n}\n\nasync function readCache(initialState: GlobalState): Promise<GlobalState> {\n  if (DEBUG) {\n    // eslint-disable-next-line no-console\n    console.time('global-state-cache-read');\n  }\n\n  const json = localStorage.getItem(GLOBAL_STATE_CACHE_KEY);\n  const cachedFromLocalStorage = json ? JSON.parse(json) as GlobalState : undefined;\n  if (cachedFromLocalStorage) localStorage.removeItem(GLOBAL_STATE_CACHE_KEY);\n\n  let cached = cachedFromLocalStorage || await loadCachedGlobal();\n  const cachedSharedState = await loadCachedSharedState();\n  const sharedState = cachedSharedState || initialState.sharedState;\n\n  if (cached) {\n    cached = {\n      ...cached,\n      sharedState,\n    };\n  }\n\n  if (DEBUG) {\n    // eslint-disable-next-line no-console\n    console.timeEnd('global-state-cache-read');\n  }\n\n  if (cached) {\n    migrateCache(cached, initialState);\n  }\n\n  const newState: GlobalState = {\n    ...initialState,\n    ...cached,\n    sharedState: {\n      ...sharedState,\n      ...cached?.sharedState, // Allow migration to override shared state\n    },\n  };\n\n  return newState;\n}\n\nexport function migrateCache(cached: GlobalState, initialState: GlobalState) {\n  try {\n    unsafeMigrateCache(cached, initialState);\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.error(err);\n  }\n}\n\nfunction unsafeMigrateCache(cached: GlobalState, initialState: GlobalState) {\n  const untypedCached = cached as any;\n  // Pre-fill settings with defaults\n  cached.settings.byKey = {\n    ...initialState.settings.byKey,\n    ...cached.settings.byKey,\n  };\n\n  cached.chatFolders = {\n    ...initialState.chatFolders,\n    ...cached.chatFolders,\n  };\n\n  if (!cached.chats.similarChannelsById) {\n    cached.chats.similarChannelsById = initialState.chats.similarChannelsById;\n  }\n\n  if (!cached.chats.similarBotsById) {\n    cached.chats.similarBotsById = initialState.chats.similarBotsById;\n  }\n\n  if (!cached.chats.lastMessageIds) {\n    cached.chats.lastMessageIds = initialState.chats.lastMessageIds;\n  }\n\n  // Clear old color storage to optimize cache size\n  if (untypedCached?.appConfig.peerColors) {\n    untypedCached.appConfig.peerColors = undefined;\n    untypedCached.appConfig.darkPeerColors = undefined;\n  }\n\n  if (!cached.fileUploads.byMessageKey) {\n    cached.fileUploads.byMessageKey = {};\n  }\n\n  if (!cached.reactions) {\n    cached.reactions = initialState.reactions;\n  }\n\n  if (!cached.quickReplies) {\n    cached.quickReplies = initialState.quickReplies;\n  }\n\n  if (!cached.users.previewMediaByBotId) {\n    cached.users.previewMediaByBotId = initialState.users.previewMediaByBotId;\n  }\n  if (!cached.chats.loadingParameters) {\n    cached.chats.loadingParameters = initialState.chats.loadingParameters;\n  }\n  if (!cached.topBotApps) {\n    cached.topBotApps = initialState.topBotApps;\n  }\n\n  if (!cached.reactions.defaultTags?.[0]?.type) {\n    cached.reactions = initialState.reactions;\n  }\n\n  if (!cached.users.commonChatsById) {\n    cached.users.commonChatsById = initialState.users.commonChatsById;\n  }\n  if (!cached.users.botAppPermissionsById) {\n    cached.users.botAppPermissionsById = initialState.users.botAppPermissionsById;\n  }\n  if (!cached.chats.topicsInfoById) {\n    cached.chats.topicsInfoById = initialState.chats.topicsInfoById;\n  }\n\n  if (!cached.messages.pollById) {\n    cached.messages.pollById = initialState.messages.pollById;\n  }\n  if (!cached.settings.botVerificationShownPeerIds) {\n    cached.settings.botVerificationShownPeerIds = initialState.settings.botVerificationShownPeerIds;\n  }\n\n  if (!cached.peers) {\n    cached.peers = initialState.peers;\n  }\n\n  if (!cached.settings.accountDaysTtl) {\n    cached.settings.accountDaysTtl = initialState.settings.accountDaysTtl;\n  }\n\n  if (!cached.cacheVersion) {\n    cached.cacheVersion = initialState.cacheVersion;\n    // Reset because of the new action message structure\n    cached.messages = initialState.messages;\n    cached.chats.listIds = initialState.chats.listIds;\n  }\n\n  if (!cached.messages.playbackByChatId) {\n    cached.messages.playbackByChatId = initialState.messages.playbackByChatId;\n  }\n\n  if (cached.cacheVersion < 2) {\n    if (untypedCached.settings.themes.dark) {\n      untypedCached.settings.themes.dark.patternColor = (initialState as any).settings.themes.dark!.patternColor;\n    }\n\n    if (untypedCached.settings.themes.light) {\n      untypedCached.settings.themes.light.patternColor = (initialState as any).settings.themes.light!.patternColor;\n    }\n\n    cached.cacheVersion = 2;\n  }\n\n  if (!cached.chats.notifyExceptionById) {\n    cached.chats.notifyExceptionById = initialState.chats.notifyExceptionById;\n  }\n\n  if (!cached.sharedState) {\n    cached.sharedState = initialState.sharedState;\n    cached.sharedState.settings = {\n      canDisplayChatInTitle: untypedCached.settings.byKey.canDisplayChatInTitle,\n      animationLevel: untypedCached.settings.byKey.animationLevel,\n      messageSendKeyCombo: untypedCached.settings.byKey.messageSendKeyCombo,\n      messageTextSize: untypedCached.settings.byKey.messageTextSize,\n      performance: untypedCached.settings.performance,\n      theme: untypedCached.settings.byKey.theme,\n      timeFormat: untypedCached.settings.byKey.timeFormat,\n      wasTimeFormatSetManually: untypedCached.settings.byKey.wasTimeFormatSetManually,\n      shouldUseSystemTheme: untypedCached.settings.byKey.shouldUseSystemTheme,\n      isConnectionStatusMinimized: untypedCached.settings.byKey.isConnectionStatusMinimized,\n      shouldForceHttpTransport: untypedCached.settings.byKey.shouldForceHttpTransport,\n      language: untypedCached.settings.byKey.language,\n      languages: untypedCached.settings.languages,\n      shouldSkipWebAppCloseConfirmation: untypedCached.settings.byKey.shouldSkipWebAppCloseConfirmation,\n      miniAppsCachedPosition: untypedCached.settings.miniAppsCachedPosition,\n      miniAppsCachedSize: untypedCached.settings.miniAppsCachedSize,\n      shouldAllowHttpTransport: untypedCached.settings.byKey.shouldAllowHttpTransport,\n      shouldCollectDebugLogs: untypedCached.settings.byKey.shouldCollectDebugLogs,\n      shouldDebugExportedSenders: untypedCached.settings.byKey.shouldDebugExportedSenders,\n      shouldWarnAboutFiles: untypedCached.settings.byKey.shouldWarnAboutFiles,\n    };\n  }\n\n  if (!cached.settings.themes) {\n    cached.settings.themes = initialState.settings.themes;\n  }\n\n  if (!cached.messages.webPageById) {\n    cached.messages.webPageById = initialState.messages.webPageById;\n  }\n\n  const cachedSharedSettings = cached.sharedState.settings;\n  if (!cachedSharedSettings.wasAnimationLevelSetManually) {\n    cachedSharedSettings.animationLevel = ANIMATION_LEVEL_DEFAULT;\n    cachedSharedSettings.performance = INITIAL_PERFORMANCE_STATE_MED;\n  }\n\n  if (!cached.appConfig) {\n    cached.appConfig = initialState.appConfig;\n  }\n\n  if (untypedCached.sharedState?.settings?.shouldWarnAboutSvg) {\n    cached.sharedState.settings.shouldWarnAboutFiles = true;\n    untypedCached.sharedState.settings.shouldWarnAboutSvg = undefined;\n  }\n}\n\nfunction updateCache(force?: boolean) {\n  const global = getGlobal();\n  if (isRemovingCache || !isCaching || global.isLoggingOut || (!force && getIsHeavyAnimating())) {\n    return;\n  }\n\n  forceUpdateCache();\n}\n\nexport function forceUpdateCache(noEncrypt = false) {\n  const global = getGlobal();\n  const { hasPasscode, isScreenLocked } = global.passcode;\n\n  if (hasPasscode) {\n    if (!isScreenLocked && !noEncrypt) {\n      const serializedGlobal = serializeGlobal(global);\n      void encryptSession(undefined, serializedGlobal);\n    }\n\n    cacheIsScreenLocked(global);\n    cacheGlobal(clearGlobalForLockScreen(global, false));\n    cacheSharedState(clearSharedStateForLockScreen(global.sharedState));\n    return;\n  }\n\n  cacheIsScreenLocked(global);\n  cacheGlobal(reduceGlobal(global));\n  cacheSharedState(reduceSharedState(global.sharedState));\n}\n\nfunction reduceGlobal<T extends GlobalState>(global: T) {\n  const reducedGlobal: GlobalState = {\n    ...INITIAL_GLOBAL_STATE,\n    ...pick(global, [\n      'appConfig',\n      'config',\n      'authState',\n      'authPhoneNumber',\n      'authRememberMe',\n      'authNearestCountry',\n      'attachMenu',\n      'currentUserId',\n      'contactList',\n      'topPeers',\n      'topInlineBots',\n      'topBotApps',\n      'recentEmojis',\n      'recentCustomEmojis',\n      'push',\n      'serviceNotifications',\n      'attachmentSettings',\n      'leftColumnWidth',\n      'archiveSettings',\n      'mediaViewer',\n      'audioPlayer',\n      'shouldShowContextMenuHint',\n      'trustedBotIds',\n      'recentlyFoundChatIds',\n      'peerColors',\n      'savedReactionTags',\n      'timezones',\n      'availableEffectById',\n    ]),\n    lastIsChatInfoShown: !getIsMobile() ? global.lastIsChatInfoShown : undefined,\n    customEmojis: reduceCustomEmojis(global),\n    users: reduceUsers(global),\n    chats: reduceChats(global),\n    messages: reduceMessages(global),\n    settings: reduceSettings(global),\n    chatFolders: reduceChatFolders(global),\n    groupCalls: reduceGroupCalls(global),\n    reactions: {\n      ...pick(global.reactions, [\n        'defaultTags',\n        'recentReactions',\n        'topReactions',\n        'effectReactions',\n        'hash',\n      ]),\n      availableReactions: reduceAvailableReactions(global.reactions.availableReactions),\n    },\n    passcode: pick(global.passcode, [\n      'isScreenLocked',\n      'hasPasscode',\n      'invalidAttemptsCount',\n      'timeoutUntil',\n    ]),\n  };\n\n  return reducedGlobal;\n}\n\nfunction reduceSharedState(sharedState: SharedState): SharedState {\n  return {\n    ...sharedState,\n    settings: {\n      ...sharedState.settings,\n      languages: undefined,\n    },\n    isInitial: undefined,\n  };\n}\n\nexport function serializeGlobal<T extends GlobalState>(global: T) {\n  return JSON.stringify(reduceGlobal(global));\n}\n\nfunction reduceCustomEmojis<T extends GlobalState>(global: T): GlobalState['customEmojis'] {\n  const { lastRendered, byId } = global.customEmojis;\n  const idsToSave = lastRendered.slice(0, GLOBAL_STATE_CACHE_CUSTOM_EMOJI_LIMIT);\n  const byIdToSave = pick(byId, idsToSave);\n\n  return {\n    byId: byIdToSave,\n    lastRendered: idsToSave,\n    forEmoji: {},\n    added: {},\n    statusRecent: {},\n  };\n}\n\nfunction reduceUsers<T extends GlobalState>(global: T): GlobalState['users'] {\n  const {\n    users: {\n      byId, statusesById, fullInfoById, botAppPermissionsById,\n    }, currentUserId,\n  } = global;\n  const currentChatIds = compact(\n    Object.values(global.byTabId)\n      .map(({ id: tabId }) => selectCurrentMessageList(global, tabId)),\n  ).map(({ chatId }) => chatId).filter((chatId) => isUserId(chatId));\n\n  const visibleUserIds = unique(compact(Object.values(global.byTabId)\n    .flatMap(({ id: tabId }) => selectVisibleUsers(global, tabId)?.map((u) => u.id) || [])));\n\n  const chatStoriesUserIds = currentChatIds\n    .flatMap((chatId) => Object.values(selectChatMessages(global, chatId) || {}))\n    .map((message) => {\n      const webPage = selectFullWebPageFromMessage(global, message);\n      return message.content.storyData?.peerId || webPage?.story?.peerId;\n    })\n    .filter((id): id is string => Boolean(id) && isUserId(id));\n\n  const attachBotIds = Object.keys(global.attachMenu?.bots || {});\n\n  const idsToSave = unique([\n    ...currentUserId ? [currentUserId] : [],\n    ...currentChatIds,\n    ...chatStoriesUserIds,\n    ...visibleUserIds || [],\n    ...attachBotIds,\n    ...global.topPeers.userIds || [],\n    ...global.recentlyFoundChatIds?.filter(isUserId) || [],\n    ...getOrderedIds(ARCHIVED_FOLDER_ID)?.slice(0, GLOBAL_STATE_CACHE_ARCHIVED_CHAT_LIST_LIMIT).filter(isUserId) || [],\n    ...getOrderedIds(ALL_FOLDER_ID)?.filter(isUserId) || [],\n    ...global.contactList?.userIds || [],\n    ...Object.keys(byId),\n  ]).slice(0, GLOBAL_STATE_CACHE_USER_LIST_LIMIT);\n\n  return {\n    ...INITIAL_GLOBAL_STATE.users,\n    byId: pickTruthy(byId, idsToSave),\n    statusesById: pickTruthy(statusesById, idsToSave),\n    fullInfoById: pickTruthy(fullInfoById, idsToSave),\n    botAppPermissionsById,\n  };\n}\n\nfunction reduceChats<T extends GlobalState>(global: T): GlobalState['chats'] {\n  const { chats: { byId }, currentUserId } = global;\n  const currentChatIds = compact(\n    Object.values(global.byTabId)\n      .map(({ id: tabId }): MessageList | undefined => {\n        return selectCurrentMessageList(global, tabId);\n      }),\n  ).map(({ chatId }) => chatId);\n\n  const messagesChatIds = compact(Object.values(global.byTabId).flatMap(({ id: tabId }) => {\n    const messageList = selectCurrentMessageList(global, tabId);\n    if (!messageList) return undefined;\n\n    const messages = selectChatMessages(global, messageList.chatId);\n    const viewportIds = selectViewportIds(global, messageList.chatId, messageList.threadId, tabId);\n    return viewportIds?.map((id) => {\n      const message = messages[id];\n      if (!message) return undefined;\n      const content = message.content;\n      const webPage = selectFullWebPageFromMessage(global, message);\n      const replyPeer = message.replyInfo?.type === 'message' && message.replyInfo.replyToPeerId;\n      return content.storyData?.peerId || webPage?.story?.peerId || replyPeer;\n    });\n  }));\n\n  const unlinkedIdsToSave = [\n    ...currentUserId ? [currentUserId] : [],\n    ...currentChatIds,\n    ...messagesChatIds,\n    ...global.recentlyFoundChatIds || [],\n    ...getOrderedIds(ARCHIVED_FOLDER_ID)?.slice(0, GLOBAL_STATE_CACHE_ARCHIVED_CHAT_LIST_LIMIT) || [],\n    ...getOrderedIds(ALL_FOLDER_ID) || [],\n    ...getOrderedIds(SAVED_FOLDER_ID) || [],\n    ...Object.keys(byId),\n  ];\n\n  let idsToSave: string[] = [];\n\n  for (const id of unlinkedIdsToSave) {\n    const chat = byId[id];\n    if (!chat) continue;\n\n    idsToSave.push(id);\n\n    if (chat.linkedMonoforumId) {\n      idsToSave.push(chat.linkedMonoforumId);\n    }\n  }\n\n  idsToSave = unique(idsToSave).slice(0, GLOBAL_STATE_CACHE_CHAT_LIST_LIMIT);\n\n  return {\n    ...global.chats,\n    similarChannelsById: {},\n    similarBotsById: {},\n    isFullyLoaded: {},\n    notifyExceptionById: pickTruthy(global.chats.notifyExceptionById, unlinkedIdsToSave),\n    loadingParameters: INITIAL_GLOBAL_STATE.chats.loadingParameters,\n    byId: pickTruthy(global.chats.byId, unlinkedIdsToSave),\n    fullInfoById: pickTruthy(global.chats.fullInfoById, unlinkedIdsToSave),\n    lastMessageIds: {\n      all: pickTruthy(global.chats.lastMessageIds.all || {}, unlinkedIdsToSave),\n      saved: global.chats.lastMessageIds.saved,\n    },\n    topicsInfoById: pickTruthy(global.chats.topicsInfoById, currentChatIds),\n  };\n}\n\nfunction reduceMessages<T extends GlobalState>(global: T): GlobalState['messages'] {\n  const { currentUserId } = global;\n  const byChatId: GlobalState['messages']['byChatId'] = {};\n  const currentChatIds = compact(\n    Object.values(global.byTabId)\n      .map(({ id: tabId }) => selectCurrentMessageList(global, tabId)),\n  ).map(({ chatId }) => chatId);\n  const forumPanelChatIds = compact(\n    Object.values(global.byTabId)\n      .map(({ forumPanelChatId }) => forumPanelChatId),\n  );\n  const chatIdsToSave = unique([\n    ...currentChatIds,\n    ...currentUserId ? [currentUserId] : [],\n    ...forumPanelChatIds,\n    ...getOrderedIds(ALL_FOLDER_ID) || [],\n    ...getOrderedIds(ARCHIVED_FOLDER_ID)?.slice(0, GLOBAL_STATE_CACHE_ARCHIVED_CHAT_LIST_LIMIT) || [],\n  ]);\n\n  const openedChatThreadIds = Object.values(global.byTabId).reduce((acc, { id: tabId }) => {\n    const { chatId: tabChatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n    if (!tabChatId || !threadId || threadId === MAIN_THREAD_ID) {\n      return acc;\n    }\n    const current = acc[tabChatId] || new Set();\n    current.add(threadId);\n    acc[tabChatId] = current;\n\n    return acc;\n  }, {} as Record<string, Set<ThreadId>>);\n\n  const pollIdsToSave: string[] = [];\n  const webPageIdsToSave: string[] = [];\n\n  chatIdsToSave.forEach((chatId) => {\n    const current = global.messages.byChatId[chatId];\n    if (!current) {\n      return;\n    }\n\n    const chatLastMessageId = selectChatLastMessageId(global, chatId);\n\n    const openedThreadIds = Array.from(openedChatThreadIds[chatId] || []);\n    const commentThreadIds = Object.values(global.messages.byChatId[chatId].threadsById || {})\n      .map(({ threadInfo }) => (threadInfo?.isCommentsInfo ? threadInfo?.originMessageId : undefined))\n      .filter(Boolean);\n    const threadIds = unique(openedThreadIds.concat(commentThreadIds));\n\n    const threadsToSave = pickTruthy(current.threadsById, [MAIN_THREAD_ID, ...threadIds]);\n\n    const viewportIdsToSave = unique(Object.values(threadsToSave).flatMap((thread) => thread.lastViewportIds || []));\n    const topics = selectTopics(global, chatId);\n    const topicLastMessageIds = topics && forumPanelChatIds.includes(chatId)\n      ? Object.values(topics).map(({ lastMessageId }) => lastMessageId) : [];\n    const savedLastMessageIds = chatId === currentUserId && global.chats.lastMessageIds.saved\n      ? Object.values(global.chats.lastMessageIds.saved) : [];\n    const lastMessageIdsToSave = [chatLastMessageId].concat(topicLastMessageIds).concat(savedLastMessageIds)\n      .filter(Boolean);\n    const byId = pick(current.byId, viewportIdsToSave.concat(lastMessageIdsToSave));\n    const threadsById = Object.keys(threadsToSave).reduce((acc, key) => {\n      const thread = threadsToSave[Number(key)];\n      acc[Number(key)] = {\n        ...thread,\n        listedIds: thread.lastViewportIds,\n        pinnedIds: undefined,\n        typingStatus: undefined,\n      };\n      return acc;\n    }, {} as GlobalState['messages']['byChatId'][string]['threadsById']);\n\n    const cleanedById = Object.values(byId).reduce((acc, message) => {\n      if (!message) return acc;\n\n      let cleanedMessage = omitLocalMedia(message);\n      cleanedMessage = omitLocalPaidReactions(cleanedMessage);\n      acc[message.id] = cleanedMessage;\n\n      if (message.content.pollId) {\n        pollIdsToSave.push(message.content.pollId);\n      }\n\n      if (message.content.webPage) {\n        webPageIdsToSave.push(message.content.webPage.id);\n      }\n\n      return acc;\n    }, {} as Record<number, ApiMessage>);\n\n    byChatId[chatId] = {\n      byId: cleanedById,\n      threadsById,\n    };\n  });\n\n  return {\n    byChatId,\n    pollById: pickTruthy(global.messages.pollById, pollIdsToSave),\n    webPageById: pickTruthy(global.messages.webPageById, webPageIdsToSave),\n    sponsoredByChatId: {},\n    playbackByChatId: {},\n  };\n}\n\nfunction omitLocalPaidReactions(message: ApiMessage): ApiMessage {\n  if (!message.reactions?.results.length) return message;\n  return {\n    ...message,\n    reactions: {\n      ...message.reactions,\n      results: message.reactions.results.map((reaction) => {\n        if (reaction.localAmount) {\n          return {\n            ...reaction,\n            localAmount: undefined,\n          };\n        }\n        return reaction;\n      }),\n    },\n  };\n}\n\nfunction omitLocalMedia(message: ApiMessage): ApiMessage {\n  const {\n    photo, video, document, sticker,\n  } = message.content;\n\n  return {\n    ...message,\n    content: {\n      ...message.content,\n      photo: photo && {\n        ...photo,\n        blobUrl: undefined,\n      },\n      video: video && {\n        ...video,\n        blobUrl: undefined,\n        previewBlobUrl: undefined,\n      },\n      document: document && {\n        ...document,\n        previewBlobUrl: undefined,\n      },\n      sticker: sticker && {\n        ...sticker,\n        isPreloadedGlobally: undefined,\n      },\n    },\n    previousLocalId: undefined,\n  };\n}\n\nfunction reduceSettings<T extends GlobalState>(global: T): GlobalState['settings'] {\n  const {\n    byKey, botVerificationShownPeerIds, notifyDefaults, lastPremiumBandwithNotificationDate, themes, accountDaysTtl,\n  } = global.settings;\n\n  return {\n    byKey,\n    privacy: {},\n    botVerificationShownPeerIds,\n    lastPremiumBandwithNotificationDate,\n    notifyDefaults,\n    themes,\n    accountDaysTtl,\n  };\n}\n\nfunction reduceChatFolders<T extends GlobalState>(global: T): GlobalState['chatFolders'] {\n  return {\n    ...global.chatFolders,\n  };\n}\n\nfunction reduceGroupCalls<T extends GlobalState>(global: T): GlobalState['groupCalls'] {\n  return {\n    ...global.groupCalls,\n    byId: {},\n    activeGroupCallId: undefined,\n  };\n}\n\nfunction reduceAvailableReactions(availableReactions?: ApiAvailableReaction[]): ApiAvailableReaction[] | undefined {\n  return availableReactions\n    ?.map((r) => pick(r, ['reaction', 'staticIcon', 'title', 'isInactive']));\n}\n","import type { FC } from '../../lib/teact/teact';\nimport type React from '../../lib/teact/teact';\nimport { memo, useMemo, useState } from '../../lib/teact/teact';\n\nimport { debounce } from '../../util/schedulers';\n\nimport useLastCallback from '../../hooks/useLastCallback';\n\nimport './RippleEffect.scss';\n\ninterface Ripple {\n  x: number;\n  y: number;\n  size: number;\n}\n\nconst ANIMATION_DURATION_MS = 700;\n\nconst RippleEffect: FC = () => {\n  const [ripples, setRipples] = useState<Ripple[]>([]);\n\n  const cleanUpDebounced = useMemo(() => {\n    return debounce(() => {\n      setRipples([]);\n    }, ANIMATION_DURATION_MS, false);\n  }, []);\n\n  const handleMouseDown = useLastCallback((e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    if (e.button !== 0) {\n      return;\n    }\n\n    const container = e.currentTarget;\n    const position = container.getBoundingClientRect();\n    const rippleSize = container.offsetWidth / 2;\n\n    setRipples([\n      ...ripples,\n      {\n        x: e.clientX - position.x - (rippleSize / 2),\n        y: e.clientY - position.y - (rippleSize / 2),\n        size: rippleSize,\n      },\n    ]);\n\n    cleanUpDebounced();\n  });\n\n  return (\n    <div className=\"ripple-container\" onMouseDown={handleMouseDown}>\n      {ripples.map(({ x, y, size }) => (\n        <div\n          className=\"ripple-wave\"\n          style={`left: ${x}px; top: ${y}px; width: ${size}px; height: ${size}px;`}\n        />\n      ))}\n    </div>\n  );\n};\n\nexport default memo(RippleEffect);\n","import { DEBUG } from '../../config';\n\nexport default function readStrings(data: string): Record<string, string> {\n  const lines = data.split(/;\\r?\\n?/);\n  const result: Record<string, string> = {};\n  for (const line of lines) {\n    if (!line.startsWith('\"')) continue;\n    const [key, value] = parseLine(line) || [];\n    if (!key || !value) {\n      // eslint-disable-next-line no-console\n      console.warn('Bad formatting in line:', line);\n      continue;\n    }\n    if (result[key]) {\n      // eslint-disable-next-line no-console\n      console.warn('Duplicate key:', key);\n    }\n    result[key] = value;\n  }\n  return result;\n}\n\nfunction parseLine(line: string) {\n  let isEscaped = false;\n  let isInsideString = false;\n\n  let separatorIndex;\n  for (let i = 0; i < line.length; i++) {\n    const char = line[i];\n    if (char === '\\\\') {\n      isEscaped = !isEscaped;\n      continue;\n    }\n\n    if (char === '\"' && !isEscaped) {\n      isInsideString = !isInsideString;\n      continue;\n    }\n\n    if (char === '=' && !isInsideString) {\n      separatorIndex = i;\n      break;\n    }\n\n    isEscaped = false;\n  }\n\n  if (separatorIndex === undefined || separatorIndex === line.length - 1) return undefined;\n\n  try {\n    const key = JSON.parse(line.slice(0, separatorIndex));\n    const value = JSON.parse(line.slice(separatorIndex + 1));\n\n    return [key, value];\n  } catch (e) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.error('Error parsing line:', line, e);\n    }\n  }\n\n  return undefined;\n}\n","import type {\n  ApiLanguage, CachedLangData, LangPack, LangPackStringValuePlural,\n} from '../../api/types';\n\nimport readStrings from './readStrings';\n\nconst FALLBACK_LANG_CODE = 'en';\nconst FALLBACK_VERSION = 0;\nconst FALLBACK_TRANSLATE_URL = 'https://translations.telegram.org/en/weba';\n\nexport default async function readFallbackStrings(forLocalScript?: boolean): Promise<CachedLangData> {\n  let fileData;\n  if (forLocalScript) {\n    fileData = (await import('fs')).readFileSync('./src/assets/localization/fallback.strings', 'utf8');\n  } else {\n    const file = await import('../../assets/localization/fallback.strings');\n    fileData = file.default;\n  }\n  const rawStrings = readStrings(fileData);\n\n  const strings: LangPack['strings'] = {};\n\n  Object.entries(rawStrings).forEach(([key, value]) => {\n    const [clearKey, pluralSuffix] = key.split('_');\n\n    if (!pluralSuffix) {\n      strings[clearKey] = value;\n      return;\n    }\n\n    const knownValue = (strings[clearKey] || {}) as LangPackStringValuePlural;\n    knownValue[pluralSuffix as keyof LangPackStringValuePlural] = value;\n    strings[clearKey] = knownValue;\n  });\n\n  const langPack: LangPack = {\n    langCode: FALLBACK_LANG_CODE,\n    version: FALLBACK_VERSION,\n    strings,\n  };\n\n  const stringsCount = Object.keys(strings).length;\n\n  const language: ApiLanguage = {\n    langCode: FALLBACK_LANG_CODE,\n    name: 'English',\n    nativeName: 'English',\n    pluralCode: FALLBACK_LANG_CODE,\n    stringsCount,\n    translatedCount: stringsCount,\n    translationsUrl: FALLBACK_TRANSLATE_URL,\n  };\n\n  return {\n    langPack,\n    language,\n  };\n}\n","/* eslint-disable */\n// This file is generated by dev/generateInitialLangFallback.ts. Do not edit it manually.\n\nimport type { LangPackStringValue } from '../../api/types';\nimport type { LangKey } from '../../types/language';\n\nexport default {\n  \"WrongNumber\": \"Wrong number?\",\n  \"SentAppCode\": \"We've sent the code to the **Telegram** app on your other device.\",\n  \"LoginJustSentSms\": \"We've sent you a code via SMS. Please enter it above.\",\n  \"LoginHeaderPassword\": \"Enter Password\",\n  \"LoginEnterPasswordDescription\": \"You have Two-Step Verification enabled, so your account is protected with an additional password.\",\n  \"StartText\": \"Please confirm your country code\\nand enter your phone number.\",\n  \"LoginPhonePlaceholder\": \"Your phone number\",\n  \"LoginNext\": \"Next\",\n  \"LoginQRLogin\": \"Log in by QR Code\",\n  \"LoginQRTitle\": \"Log in to Telegram by QR Code\",\n  \"LoginQRHelp1\": \"Open Telegram on your phone\",\n  \"LoginQRHelp2\": \"Go to **Settings** > **Devices** > **Link Desktop Device**\",\n  \"LoginQRHelp3\": \"Point your phone at this screen to confirm login\",\n  \"LoginQRCancel\": \"Log in by phone Number\",\n  \"YourName\": \"Your Name\",\n  \"LoginRegisterDesc\": \"Enter your name and add a profile photo.\",\n  \"LoginRegisterFirstNamePlaceholder\": \"First Name\",\n  \"LoginRegisterLastNamePlaceholder\": \"Last Name\",\n  \"LoginSelectCountryTitle\": \"Country\",\n  \"CountryNone\": \"Country not found\",\n  \"PleaseEnterPassword\": \"Enter your new password\",\n  \"ErrorPhoneNumberInvalid\": \"Invalid phone number, please try again.\",\n  \"ErrorCodeInvalid\": \"Invalid code, please try again.\",\n  \"ErrorIncorrectPassword\": \"Invalid password, please try again.\",\n  \"ErrorPasswordFlood\": \"Too many attempts, please try again later.\",\n  \"ErrorPhoneBanned\": \"This phone number is banned.\",\n  \"ErrorFloodTime\": \"Too many attempts, please try again in {time}.\",\n  \"ErrorUnexpected\": \"Unexpected error\",\n  \"ErrorUnexpectedMessage\": \"Unexpected error: {error}\"\n} as Record<LangKey, LangPackStringValue>;\n","import type { TeactNode } from '../../lib/teact/teact';\n\nimport type {\n  ApiLanguage,\n  CachedLangData,\n  LangPack,\n  LangPackStringValue,\n} from '../../api/types';\nimport type { LangKey, LangVariable } from '../../types/language';\nimport {\n  type AdvancedLangFnOptions,\n  type AdvancedLangFnOptionsWithPlural,\n  type AdvancedLangFnParameters,\n  areAdvancedLangFnOptions,\n  isDeletedLangString,\n  isPluralLangString,\n  type LangFn,\n  type LangFnOptions,\n  type LangFnOptionsWithPlural,\n  type LangFnParameters,\n  type LangFormatters,\n  type RegularLangFnParameters,\n} from './types';\n\nimport { DEBUG, FORCE_FALLBACK_LANG, LANG_PACK } from '../../config';\nimport { callApi } from '../../api/gramjs';\nimport renderText from '../../components/common/helpers/renderText';\nimport { IS_INTL_LIST_FORMAT_SUPPORTED } from '../browser/globalEnvironment';\nimport { MAIN_IDB_STORE } from '../browser/idb';\nimport { getBasicListFormat } from '../browser/intlListFormat';\nimport { notifyLangpackUpdate } from '../browser/multitab';\nimport { createCallbackManager } from '../callbacks';\nimport readFallbackStrings from '../data/readFallbackStrings';\nimport { initialEstablishmentPromise, isCurrentTabMaster } from '../establishMultitabRole';\nimport { omit, unique } from '../iteratees';\nimport { replaceInStringsWithTeact } from '../replaceWithTeact';\nimport { fastRaf } from '../schedulers';\n\nimport Deferred from '../Deferred';\nimport LimitedMap from '../primitives/LimitedMap';\n\nimport initialStrings from '../../assets/localization/initialStrings';\n\nconst LANGPACK_STORE_PREFIX = 'langpack-';\nconst FORMATTERS_FALLBACK_LANG = 'en';\n\nconst STRING_CACHE_LIMIT = 400;\nconst TRANSLATION_CACHE = new LimitedMap<string, string>(STRING_CACHE_LIMIT);\n\nlet language: ApiLanguage | undefined;\nlet formatters: LangFormatters | undefined;\n\nlet langPack: LangPack | undefined;\nlet fallbackLangPack: LangPack | undefined;\n\nlet translationFn = createTranslationFn();\n\nconst {\n  addCallback,\n  removeCallback,\n  runCallbacks,\n} = createCallbackManager();\n\nlet areCallbacksScheduled = false;\nfunction scheduleCallbacks() {\n  if (areCallbacksScheduled) return;\n  areCallbacksScheduled = true;\n  fastRaf(() => {\n    runCallbacks();\n    areCallbacksScheduled = false;\n  });\n}\n\nconst localizationReady = new Deferred<void>();\n\nfunction loadCachedLangData(langCode: string) {\n  return MAIN_IDB_STORE.get<CachedLangData>(`${LANGPACK_STORE_PREFIX}${langCode}`);\n}\n\nfunction cacheLangData(data: CachedLangData) {\n  notifyLangpackUpdate(data.language.langCode);\n  return MAIN_IDB_STORE.set(`${LANGPACK_STORE_PREFIX}${data.language.langCode}`, data);\n}\n\nlet fallbackLoadPromise: Promise<CachedLangData> | undefined;\nasync function loadFallbackPack() {\n  if (fallbackLangPack || fallbackLoadPromise) return;\n  fallbackLoadPromise = readFallbackStrings();\n  const fallbackData = await fallbackLoadPromise;\n  fallbackLangPack = fallbackData.langPack;\n\n  TRANSLATION_CACHE.clear();\n\n  if (!language) {\n    updateLanguage(fallbackData.language);\n  } else {\n    translationFn = createTranslationFn();\n    scheduleCallbacks();\n  }\n}\n\nasync function fetchDifference() {\n  if (!langPack || !language) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('[Localization] Trying to fetch difference without loaded data');\n    }\n    return;\n  }\n\n  await initialEstablishmentPromise;\n  if (!isCurrentTabMaster()) return;\n\n  const result = await callApi('fetchLangDifference', {\n    langPack: LANG_PACK,\n    langCode: langPack.langCode,\n    fromVersion: langPack.version,\n  });\n  if (!result) return;\n\n  applyLangPackDifference(result.version, result.strings, result.keysToRemove);\n}\n\nexport function applyLangPackDifference(\n  version: number, strings: Record<string, LangPackStringValue>, keysToRemove: string[],\n) {\n  if (!langPack || !language || version === langPack.version) return;\n\n  const newLangPack = {\n    ...langPack,\n    version,\n    strings: {\n      ...omit(langPack.strings, keysToRemove),\n      ...strings,\n    },\n  };\n  updateLangPack(newLangPack);\n\n  cacheLangData({\n    langPack: newLangPack,\n    language,\n  });\n  scheduleCallbacks();\n}\n\nfunction updateLanguage(newLang: ApiLanguage) {\n  language = newLang;\n\n  createFormatters();\n\n  translationFn = createTranslationFn();\n\n  scheduleCallbacks();\n}\n\nfunction createFormatters() {\n  if (!language) return;\n  const langCode = language.pluralCode;\n  const listFormatFallback = getBasicListFormat();\n\n  function createListFormat(lang: string, type: 'conjunction' | 'disjunction') {\n    return IS_INTL_LIST_FORMAT_SUPPORTED ? new Intl.ListFormat(lang, { type }) : listFormatFallback;\n  }\n\n  try {\n    formatters = {\n      pluralRules: new Intl.PluralRules(langCode),\n      region: new Intl.DisplayNames(langCode, { type: 'region' }),\n      conjunction: createListFormat(langCode, 'conjunction'),\n      disjunction: createListFormat(langCode, 'disjunction'),\n      number: new Intl.NumberFormat(langCode),\n      preciseNumber: new Intl.NumberFormat(langCode, {\n        minimumFractionDigits: 0,\n        maximumFractionDigits: 10,\n      }),\n    };\n  } catch (e) {\n    // eslint-disable-next-line no-console\n    console.warn('Failed to create formatters:', e);\n    formatters = {\n      pluralRules: new Intl.PluralRules(FORMATTERS_FALLBACK_LANG),\n      region: new Intl.DisplayNames(FORMATTERS_FALLBACK_LANG, { type: 'region' }),\n      conjunction: createListFormat(FORMATTERS_FALLBACK_LANG, 'conjunction'),\n      disjunction: createListFormat(FORMATTERS_FALLBACK_LANG, 'disjunction'),\n      number: new Intl.NumberFormat(FORMATTERS_FALLBACK_LANG),\n      preciseNumber: new Intl.NumberFormat(FORMATTERS_FALLBACK_LANG, {\n        minimumFractionDigits: 0,\n        maximumFractionDigits: 10,\n      }),\n    };\n  }\n}\n\nfunction updateLangPack(newLangPack: LangPack) {\n  langPack = newLangPack;\n\n  TRANSLATION_CACHE.clear();\n\n  scheduleCallbacks();\n}\n\nexport async function initLocalization(langCode: string, canLoadFromServer?: boolean) {\n  if (language) return;\n\n  const cachedData = await loadCachedLangData(langCode);\n  if (cachedData) {\n    langPack = cachedData.langPack;\n    language = cachedData.language;\n    createFormatters();\n\n    fetchDifference();\n  } else if (canLoadFromServer) {\n    await loadAndChangeLanguage(langCode);\n  }\n\n  // Always start loading fallback pack in the background. Some languages may not have every string translated.\n  loadFallbackPack();\n\n  translationFn = createTranslationFn();\n  scheduleCallbacks();\n  localizationReady.resolve();\n}\n\nexport async function refreshFromCache(langCode: string) {\n  if (isCurrentTabMaster()) return;\n\n  const cachedData = await loadCachedLangData(langCode);\n  if (cachedData) {\n    updateLangPack(cachedData.langPack);\n    updateLanguage(cachedData.language);\n  }\n}\n\nexport async function loadAndChangeLanguage(langCode: string, shouldCheckCache?: boolean) {\n  if (shouldCheckCache) { // Can be removed when old lang provider is phased out. Cache is checked in `initLocalization`.\n    const cachedData = await loadCachedLangData(langCode);\n    if (cachedData) {\n      return changeLanguage(cachedData.language);\n    }\n  }\n\n  await initialEstablishmentPromise;\n  if (!isCurrentTabMaster()) return undefined;\n\n  const remoteLanguage = await callApi('fetchLanguage', {\n    langPack: LANG_PACK,\n    langCode,\n  });\n\n  if (!remoteLanguage) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('Failed to fetch language', langCode);\n    }\n    return undefined;\n  }\n\n  return changeLanguage(remoteLanguage);\n}\n\nexport function requestLangPackDifference(langCode: string) {\n  if (language?.langCode !== langCode) return;\n  fetchDifference();\n}\n\nexport async function changeLanguage(newLanguage: ApiLanguage) {\n  if (langPack && language?.langCode === newLanguage.langCode) return;\n\n  const cachedData = await loadCachedLangData(newLanguage.langCode);\n  if (cachedData) {\n    updateLangPack(cachedData.langPack);\n    updateLanguage(cachedData.language);\n\n    fetchDifference();\n  } else {\n    await initialEstablishmentPromise;\n    if (!isCurrentTabMaster()) return;\n    const remoteLangPack = await callApi('fetchLangPack', {\n      langPack: LANG_PACK,\n      langCode: newLanguage.langCode,\n    });\n    if (!remoteLangPack) {\n      // eslint-disable-next-line no-console\n      console.warn('Failed to fetch lang pack');\n      return;\n    }\n\n    updateLangPack({\n      langCode: newLanguage.langCode,\n      version: remoteLangPack.version,\n      strings: remoteLangPack.strings,\n    });\n    updateLanguage(newLanguage);\n\n    cacheLangData({\n      langPack: langPack!,\n      language: newLanguage,\n    });\n  }\n\n  document.documentElement.lang = newLanguage.baseLangCode || newLanguage.langCode;\n\n  scheduleCallbacks();\n}\n\nfunction createTranslationFn(): LangFn {\n  const fn: LangFn = ((\n    key: LangKey,\n    variables: Record<string, unknown> | undefined,\n    options: LangFnOptions | AdvancedLangFnOptions | undefined,\n  ) => {\n    if (options && areAdvancedLangFnOptions(options)) {\n      return processTranslationAdvanced(key, variables as Record<string, TeactNode>, options);\n    }\n    return processTranslation(key, variables as Record<string, string | number>, options);\n  }) as LangFn;\n  fn.rawCode = language?.langCode || FORMATTERS_FALLBACK_LANG;\n  fn.isRtl = language?.isRtl;\n  fn.code = language?.pluralCode || FORMATTERS_FALLBACK_LANG;\n  fn.with = ({ key, variables, options }: LangFnParameters) => {\n    if (options && areAdvancedLangFnOptions(options)) {\n      return processTranslationAdvanced(key, variables as Record<string, TeactNode | undefined>, options);\n    }\n    return processTranslation(key, variables as Record<string, LangVariable>, options);\n  };\n  fn.withRegular = ({ key, variables, options }: RegularLangFnParameters) => {\n    return processTranslation(key, variables, options);\n  };\n  fn.withAdvanced = ({ key, variables, options }: AdvancedLangFnParameters) => {\n    return processTranslationAdvanced(key, variables, options);\n  };\n  fn.region = (code: string) => formatters?.region.of(code);\n  fn.conjunction = (list: string[]) => formatters?.conjunction.format(list) || list.join(', ');\n  fn.disjunction = (list: string[]) => formatters?.disjunction.format(list) || list.join(', ');\n  fn.number = (value: number) => formatters?.number.format(value) || String(value);\n  fn.preciseNumber = (value: number) => formatters?.preciseNumber.format(value) || String(value);\n  fn.internalFormatters = formatters!;\n  fn.languageInfo = language!;\n  return fn;\n}\n\nexport function getTranslationFn(): LangFn {\n  return translationFn;\n}\n\nfunction getString(langKey: LangKey, count: number) {\n  let langPackStringValue = !FORCE_FALLBACK_LANG ? langPack?.strings[langKey] : undefined;\n\n  if (!langPackStringValue && !fallbackLangPack) {\n    loadFallbackPack();\n  }\n\n  langPackStringValue ||= fallbackLangPack?.strings[langKey];\n  langPackStringValue ||= initialStrings[langKey];\n\n  if (!langPackStringValue || isDeletedLangString(langPackStringValue)) return undefined;\n\n  const pluralSuffix = formatters?.pluralRules.select(count) || 'other';\n\n  const string = isPluralLangString(langPackStringValue)\n    ? (langPackStringValue[pluralSuffix] || langPackStringValue.other)\n    : langPackStringValue;\n\n  return string;\n}\n\nfunction processTranslation(\n  langKey: LangKey,\n  variables?: Record<string, LangVariable | RegularLangFnParameters>,\n  options?: LangFnOptions | LangFnOptionsWithPlural,\n): string {\n  const cacheKey = `${langKey}-${JSON.stringify(variables)}-${JSON.stringify(options)}`;\n  if (TRANSLATION_CACHE.has(cacheKey)) {\n    return TRANSLATION_CACHE.get(cacheKey)!;\n  }\n\n  const pluralValue = options && 'pluralValue' in options ? Number(options.pluralValue) : 0;\n  const string = getString(langKey, pluralValue);\n\n  if (!string) return langKey;\n\n  const variableEntries = variables ? Object.entries(variables) : [];\n  const finalString = variableEntries.reduce((result, [key, value]) => {\n    if (value === undefined) return result;\n    if (typeof value === 'object') { // Allow recursive variables in basic `lang.with`\n      value = processTranslation(value.key, value.variables, value.options);\n    }\n\n    const valueAsString = Number.isFinite(value) ? formatters!.number.format(value as number) : String(value);\n    return result.replaceAll(`{${key}}`, valueAsString);\n  }, string);\n\n  TRANSLATION_CACHE.set(cacheKey, finalString);\n\n  return finalString;\n}\n\nfunction processTranslationAdvanced(\n  langKey: LangKey,\n  variables?: Record<string, TeactNode | undefined>,\n  options?: AdvancedLangFnOptions | AdvancedLangFnOptionsWithPlural,\n): TeactNode {\n  const pluralValue = options && 'pluralValue' in options ? Number(options.pluralValue) : 0;\n  const string = getString(langKey, pluralValue);\n  if (!string) return langKey;\n\n  const variableEntries = variables ? Object.entries(variables) : [];\n\n  let tempResult: TeactNode = [string];\n  if (options?.specialReplacement) {\n    const specialReplacements = Object.entries(options.specialReplacement);\n    tempResult = specialReplacements.reduce((acc, [key, value]) => {\n      return replaceInStringsWithTeact(acc, key, value);\n    }, tempResult);\n  }\n\n  const withRenderText = options?.withMarkdown || options?.renderTextFilters;\n\n  if (withRenderText) {\n    const filters = options?.withMarkdown\n      ? unique((options.renderTextFilters || []).concat(['simple_markdown', 'emoji']))\n      : options.renderTextFilters;\n\n    return tempResult.flatMap((curr: TeactNode) => {\n      if (typeof curr !== 'string') {\n        return curr;\n      }\n\n      return renderText(curr, filters, {\n        markdownPostProcessor: (part: string) => {\n          return variableEntries.reduce((result, [key, value]): TeactNode[] => {\n            if (value === undefined) return result;\n\n            const preparedValue = Number.isFinite(value) ? formatters!.number.format(value as number) : value;\n            return replaceInStringsWithTeact(result, `{${key}}`, renderText(preparedValue));\n          }, [part] as TeactNode[]);\n        },\n      });\n    });\n  }\n\n  return variableEntries.reduce((result, [key, value]): TeactNode[] => {\n    if (value === undefined) return result;\n\n    const preparedValue = Number.isFinite(value) ? formatters!.number.format(value as number) : value;\n    return replaceInStringsWithTeact(result, `{${key}}`, renderText(preparedValue));\n  }, tempResult);\n}\n\nexport const localizationReadyPromise = localizationReady.promise;\n\nexport {\n  addCallback as addLocalizationCallback,\n  removeCallback as removeLocalizationCallback,\n};\n\nexport type {\n  LangFn,\n  LangFnParameters,\n  RegularLangFnParameters,\n  AdvancedLangFnParameters,\n};\n","type Part = {\n  type: 'literal' | 'element';\n  value: string;\n};\n\nexport function getBasicListFormat() {\n  return {\n    format: (items: string[]) => items.join(', '),\n    formatToParts: (items: string[]): Part[] => {\n      const result: Part[] = [];\n\n      items.forEach((item, i) => {\n        if (i > 0) {\n          result.push({ type: 'literal', value: ', ' });\n        }\n        result.push({ type: 'element', value: item });\n      });\n\n      return result;\n    },\n  };\n}\n","export const clamp = (num: number, min: number, max: number) => (Math.min(max, Math.max(min, num)));\nexport const isBetween = (num: number, min: number, max: number) => (num >= min && num <= max);\nexport const round = (num: number, decimals: number = 0) => Math.round(num * 10 ** decimals) / 10 ** decimals;\nexport const ceil = (num: number, decimals: number = 0) => Math.ceil(num * 10 ** decimals) / 10 ** decimals;\nexport const floor = (num: number, decimals: number = 0) => Math.floor(num * 10 ** decimals) / 10 ** decimals;\nexport const lerp = (start: number, end: number, interpolationRatio: number) => {\n  return (1 - interpolationRatio) * start + interpolationRatio * end;\n};\n\n// Fractional values cause blurry text & canvas. Round to even to keep whole numbers while centering\nexport function roundToNearestEven(value: number) {\n  return Math.round(value / 2) * 2;\n}\n","import type { IDimensions } from '../types';\n\nimport { requestMutation } from '../lib/fasterdom/fasterdom';\nimport { IS_IOS } from './browser/windowEnvironment';\nimport { throttle } from './schedulers';\n\nconst WINDOW_ORIENTATION_CHANGE_THROTTLE_MS = 100;\nconst WINDOW_RESIZE_THROTTLE_MS = 250;\n\nlet initialHeight = window.innerHeight;\nlet currentWindowSize = updateSizes();\n\nconst handleResize = throttle(() => {\n  currentWindowSize = updateSizes();\n}, WINDOW_RESIZE_THROTTLE_MS, true);\n\nconst handleOrientationChange = throttle(() => {\n  initialHeight = window.innerHeight;\n  handleResize();\n}, WINDOW_ORIENTATION_CHANGE_THROTTLE_MS, false);\n\nwindow.addEventListener('orientationchange', handleOrientationChange);\nif (IS_IOS) {\n  window.visualViewport!.addEventListener('resize', handleResize);\n} else {\n  window.addEventListener('resize', handleResize);\n}\n\nexport function updateSizes(): IDimensions {\n  let height: number;\n  if (IS_IOS) {\n    height = window.visualViewport!.height + window.visualViewport!.pageTop;\n  } else {\n    height = window.innerHeight;\n  }\n\n  requestMutation(() => {\n    const vh = height * 0.01;\n    document.documentElement.style.setProperty('--vh', `${vh}px`);\n  });\n\n  return {\n    width: window.innerWidth,\n    height: window.innerHeight,\n  };\n}\n\nconst windowSize = {\n  get: () => currentWindowSize,\n  getIsKeyboardVisible: () => initialHeight > currentWindowSize.height,\n};\n\nexport default windowSize;\n","import { useEffect } from '../lib/teact/teact';\n\nimport {\n  MIN_SCREEN_WIDTH_FOR_STATIC_LEFT_COLUMN,\n  MOBILE_SCREEN_LANDSCAPE_MAX_HEIGHT,\n  MOBILE_SCREEN_LANDSCAPE_MAX_WIDTH,\n  MOBILE_SCREEN_MAX_WIDTH,\n} from '../config';\nimport { IS_IOS } from '../util/browser/windowEnvironment';\nimport { createCallbackManager } from '../util/callbacks';\nimport { updateSizes } from '../util/windowSize';\nimport useForceUpdate from './useForceUpdate';\n\ntype MediaQueryCacheKey = 'mobile' | 'tablet' | 'landscape' | 'touch';\n\nconst mediaQueryCache = new Map<MediaQueryCacheKey, MediaQueryList>();\nconst callbacks = createCallbackManager();\n\nlet isMobile: boolean;\nlet isTablet: boolean;\nlet isLandscape: boolean;\nlet isTouchScreen: boolean;\n\nexport function getIsMobile() {\n  return isMobile;\n}\n\nexport function getIsTablet() {\n  return isTablet;\n}\n\nexport function getIsWebAppsFullscreenSupported() {\n  return !getIsMobile();\n}\n\nfunction handleMediaQueryChange() {\n  isMobile = mediaQueryCache.get('mobile')?.matches || false;\n  isTablet = !isMobile && (mediaQueryCache.get('tablet')?.matches || false);\n  isLandscape = mediaQueryCache.get('landscape')?.matches || false;\n  isTouchScreen = mediaQueryCache.get('touch')?.matches || false;\n  updateSizes();\n  callbacks.runCallbacks();\n}\n\nfunction initMediaQueryCache() {\n  const mobileQuery = window.matchMedia(`(max-width: ${MOBILE_SCREEN_MAX_WIDTH}px), \\\n  (max-width: ${MOBILE_SCREEN_LANDSCAPE_MAX_WIDTH}px and max-height: ${MOBILE_SCREEN_LANDSCAPE_MAX_HEIGHT}px)`);\n  mediaQueryCache.set('mobile', mobileQuery);\n  mobileQuery.addEventListener('change', handleMediaQueryChange);\n\n  const tabletQuery = window.matchMedia(`(max-width: ${MIN_SCREEN_WIDTH_FOR_STATIC_LEFT_COLUMN}px)`);\n  mediaQueryCache.set('tablet', tabletQuery);\n  tabletQuery.addEventListener('change', handleMediaQueryChange);\n\n  const landscapeQuery = window.matchMedia(\n    IS_IOS\n      ? '(orientation: landscape)'\n      // Source: https://web.archive.org/web/20160509220835/http://blog.abouthalf.com/development/orientation-media-query-challenges-in-android-browsers/\n      // Feature is marked as deprecated now, but it is still supported\n      // https://developer.mozilla.org/en-US/docs/Web/CSS/@media/device-aspect-ratio#browser_compatibility\n      : 'screen and (min-device-aspect-ratio: 1/1) and (orientation: landscape)',\n  );\n  mediaQueryCache.set('landscape', landscapeQuery);\n  landscapeQuery.addEventListener('change', handleMediaQueryChange);\n\n  const isTouchScreenQuery = window.matchMedia('(pointer: coarse)');\n  mediaQueryCache.set('touch', isTouchScreenQuery);\n  isTouchScreenQuery.addEventListener('change', handleMediaQueryChange);\n}\n\ninitMediaQueryCache();\nhandleMediaQueryChange();\n\nexport default function useAppLayout() {\n  const forceUpdate = useForceUpdate();\n\n  useEffect(() => callbacks.addCallback(forceUpdate), [forceUpdate]);\n\n  return {\n    isMobile,\n    isTablet,\n    isLandscape,\n    isDesktop: !isMobile && !isTablet,\n    isTouchScreen,\n  };\n}\n","import type { ApiPeer, ApiSavedGifts, ApiStarGiftCollection } from '../../api/types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport { SERVICE_NOTIFICATIONS_USER_ID } from '../../config';\nimport { isUserId } from '../../util/entities/ids';\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { isChatAdmin, isDeletedUser } from '../helpers';\nimport { selectChat, selectChatFullInfo } from './chats';\nimport { type ProfileCollectionKey } from './payments';\nimport { selectTabState } from './tabs';\nimport { selectBot, selectUser, selectUserFullInfo } from './users';\n\nexport function selectPeer<T extends GlobalState>(global: T, peerId: string): ApiPeer | undefined {\n  return selectUser(global, peerId) || selectChat(global, peerId);\n}\n\nexport function selectPeerPhotos<T extends GlobalState>(global: T, peerId: string) {\n  return global.peers.profilePhotosById[peerId];\n}\n\nexport function selectCanGift<T extends GlobalState>(global: T, peerId: string) {\n  const bot = selectBot(global, peerId);\n  const user = selectUser(global, peerId);\n\n  if (user) {\n    return !bot && peerId !== SERVICE_NOTIFICATIONS_USER_ID && !isDeletedUser(user);\n  }\n\n  return selectChatFullInfo(global, peerId)?.areStarGiftsAvailable;\n}\n\nexport function selectPeerCollectionSavedGifts<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  collectionId: ProfileCollectionKey,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): ApiSavedGifts | undefined {\n  const tabState = selectTabState(global, tabId);\n  return tabState.savedGifts.collectionsByPeerId[peerId]?.[collectionId];\n}\n\nexport function selectPeerSavedGifts<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): ApiSavedGifts | undefined {\n  return selectPeerCollectionSavedGifts(global, peerId, 'all', tabId);\n}\n\nexport function selectPeerStarGiftCollections<T extends GlobalState>(\n  global: T,\n  peerId: string,\n): ApiStarGiftCollection[] | undefined {\n  return global.starGiftCollections?.byPeerId[peerId];\n}\n\nexport function selectPeerPaidMessagesStars<T extends GlobalState>(\n  global: T,\n  peerId: string,\n) {\n  const isChatWithUser = isUserId(peerId);\n  if (isChatWithUser) {\n    const userFullInfo = isChatWithUser ? selectUserFullInfo(global, peerId) : undefined;\n    return userFullInfo?.paidMessagesStars;\n  }\n\n  const chat = selectChat(global, peerId);\n  if (!chat) return undefined;\n  if (isChatAdmin(chat)) return undefined;\n  return chat.paidMessagesStars;\n}\n\nexport function selectPeerHasProfileBackground<T extends GlobalState>(global: T, peerId: string) {\n  const peer = selectPeer(global, peerId);\n  return Boolean(peer?.profileColor || peer?.emojiStatus?.type === 'collectible');\n}\n","import type { ThreadId } from '../types';\n\nimport { RE_TG_LINK, RE_TME_LINK } from '../config';\nimport { IS_BAD_URL_PARSER } from './browser/globalEnvironment';\nimport { ensureProtocol } from './browser/url';\nimport { parseTimestampDuration } from './dates/timestamp';\nimport { toChannelId } from './entities/ids';\nimport { isUsernameValid } from './entities/username';\n\nexport type DeepLinkMethod = 'resolve' | 'login' | 'passport' | 'settings' | 'join' | 'addstickers' | 'addemoji' |\n  'setlanguage' | 'addtheme' | 'confirmphone' | 'socks' | 'proxy' | 'privatepost' | 'bg' | 'share' | 'msg' | 'msg_url' |\n  'invoice' | 'addlist' | 'boost' | 'giftcode' | 'message' | 'premium_offer' | 'premium_multigift' | 'stars_topup'\n  | 'nft' | 'stars' | 'ton';\n\ninterface PublicMessageLink {\n  type: 'publicMessageLink';\n  username: string;\n  messageId: number;\n  isSingle: boolean;\n  threadId?: ThreadId;\n  commentId?: number;\n  timestamp?: number;\n}\n\nexport interface PrivateMessageLink {\n  type: 'privateMessageLink';\n  channelId: string;\n  messageId: number;\n  isSingle: boolean;\n  threadId?: ThreadId;\n  commentId?: number;\n  timestamp?: number;\n}\n\ninterface ShareLink {\n  type: 'shareLink';\n  url: string;\n  text?: string;\n}\n\ninterface ChatFolderLink {\n  type: 'chatFolderLink';\n  slug: string;\n}\n\ninterface LoginCodeLink {\n  type: 'loginCodeLink';\n  code: string;\n}\n\ninterface TelegramPassportLink {\n  type: 'telegramPassportLink';\n  botId: number;\n  scope: string;\n  publicKey: string;\n  nonce: string;\n  callbackUrl?: string;\n  payload?: string;\n}\n\ninterface PublicUsernameOrBotLink {\n  type: 'publicUsernameOrBotLink';\n  username: string;\n  start?: string;\n  ref?: string;\n  startApp?: string;\n  mode?: string;\n  appName?: string;\n  startAttach?: string;\n  attach?: string;\n  text?: string;\n  choose?: string;\n  isDirect?: boolean;\n}\n\ninterface PrivateChannelLink {\n  type: 'privateChannelLink';\n  channelId: string;\n}\n\ninterface ChatBoostLink {\n  type: 'chatBoostLink';\n  username?: string;\n  id?: string;\n}\n\ninterface BusinessChatLink {\n  type: 'businessChatLink';\n  slug: string;\n}\n\ninterface PremiumReferrerLink {\n  type: 'premiumReferrerLink';\n  referrer: string;\n}\n\ninterface PremiumMultigiftLink {\n  type: 'premiumMultigiftLink';\n  referrer: string;\n}\n\ninterface GiftUniqueLink {\n  type: 'giftUniqueLink';\n  slug: string;\n}\n\ninterface StarsModalLink {\n  type: 'stars';\n}\n\ninterface TonModalLink {\n  type: 'ton';\n}\n\ninterface SettingsScreenLink {\n  type: 'settings';\n  screen?: 'devices' | 'folders' | 'language' | 'privacy' | 'editProfile' | 'theme';\n}\n\ntype DeepLink =\n  TelegramPassportLink |\n  LoginCodeLink |\n  PublicMessageLink |\n  PrivateMessageLink |\n  ShareLink |\n  ChatFolderLink |\n  PublicUsernameOrBotLink |\n  PrivateChannelLink |\n  BusinessChatLink |\n  PremiumReferrerLink |\n  PremiumMultigiftLink |\n  ChatBoostLink |\n  GiftUniqueLink |\n  StarsModalLink |\n  TonModalLink |\n  SettingsScreenLink;\n\ntype BuilderParams<T extends DeepLink> = Record<keyof Omit<T, 'type'>, string | undefined>;\ntype BuilderReturnType<T extends DeepLink> = T | undefined;\ntype DeepLinkType = DeepLink['type'] | 'unknown';\n\ntype PrivateMessageLinkBuilderParams = Omit<BuilderParams<PrivateMessageLink>, 'isSingle'> & {\n  single?: string;\n};\n\ntype PublicMessageLinkBuilderParams = Omit<BuilderParams<PublicMessageLink>, 'isSingle'> & {\n  single?: string;\n};\n\ntype PublicUsernameOrBotLinkBuilderParams = Omit<BuilderParams<PublicUsernameOrBotLink>, 'isDirect'> & {\n  direct?: string;\n};\n\nconst ELIGIBLE_HOSTNAMES = new Set(['t.me', 'telegram.me', 'telegram.dog']);\n\nexport function isDeepLink(link: string): boolean {\n  return Boolean(link.match(RE_TME_LINK) || link.match(RE_TG_LINK));\n}\n\nexport function tryParseDeepLink(link: string): DeepLink | undefined {\n  if (!isDeepLink(link)) {\n    return undefined;\n  }\n  try {\n    return parseDeepLink(link);\n  } catch (err) {\n    return undefined;\n  }\n}\n\nexport function getUsernameFromDeepLink(url: string) {\n  const deepLink = tryParseDeepLink(url);\n  if (deepLink?.type === 'publicUsernameOrBotLink') {\n    return deepLink.username;\n  }\n  return undefined;\n}\n\nfunction parseDeepLink(url: string) {\n  const correctUrl = ensureProtocol(url);\n  if (!correctUrl) {\n    return undefined;\n  }\n  if (correctUrl.startsWith('https:') || correctUrl.startsWith('http:')) {\n    const urlParsed = new URL(correctUrl);\n    return parseHttpLink(urlParsed);\n  }\n  if (correctUrl.startsWith('tg:')) {\n    const urlToParse = IS_BAD_URL_PARSER ? correctUrl.replace(/^tg:\\/\\//, 'https://') : correctUrl;\n    const urlParsed = new URL(urlToParse);\n    return parseTgLink(urlParsed);\n  }\n  return undefined;\n}\n\nfunction parseTgLink(url: URL) {\n  const { hostname } = url;\n  const queryParams = getQueryParams(url);\n  const pathParams = getPathParams(url);\n  const method = hostname as DeepLinkMethod;\n\n  const deepLinkType = getTgDeepLinkType(queryParams, pathParams, method);\n  switch (deepLinkType) {\n    case 'publicMessageLink': {\n      const {\n        domain, post, single, thread, comment, t,\n      } = queryParams;\n      return buildPublicMessageLink({\n        username: domain,\n        messageId: post,\n        single,\n        threadId: thread,\n        commentId: comment,\n        timestamp: t,\n      });\n    }\n    case 'privateMessageLink': {\n      const {\n        channel, post, single, thread, comment, t,\n      } = queryParams;\n      return buildPrivateMessageLink({\n        channelId: channel,\n        messageId: post,\n        single,\n        threadId: thread,\n        commentId: comment,\n        timestamp: t,\n      });\n    }\n    case 'shareLink':\n      return buildShareLink({ text: queryParams.text, url: queryParams.url });\n    case 'chatFolderLink':\n      return buildChatFolderLink({ slug: queryParams.slug });\n    case 'loginCodeLink':\n      return buildLoginCodeLink({ code: queryParams.code });\n    case 'telegramPassportLink':\n      return buildTelegramPassportLink({\n        botId: queryParams.bot_id,\n        scope: queryParams.scope,\n        publicKey: queryParams.public_key,\n        nonce: queryParams.nonce,\n        callbackUrl: queryParams.callback_url,\n        payload: queryParams.payload,\n      });\n    case 'publicUsernameOrBotLink':\n      return buildPublicUsernameOrBotLink({\n        username: queryParams.domain,\n        start: queryParams.start,\n        text: queryParams.text,\n        appName: queryParams.appname,\n        startApp: queryParams.startapp,\n        mode: queryParams.mode,\n        startAttach: queryParams.startattach,\n        attach: queryParams.attach,\n        choose: queryParams.choose,\n        ref: queryParams.ref,\n        direct: queryParams.direct,\n      });\n    case 'privateChannelLink': {\n      return buildPrivateChannelLink({ channelId: queryParams.channel });\n    }\n    case 'businessChatLink':\n      return buildBusinessChatLink({ slug: queryParams.slug });\n    case 'premiumReferrerLink':\n      return buildPremiumReferrerLink({ referrer: queryParams.ref });\n    case 'premiumMultigiftLink':\n      return buildPremiumMultigiftLink({ referrer: queryParams.ref });\n    case 'chatBoostLink':\n      return buildChatBoostLink({ username: queryParams.domain, id: queryParams.channel });\n    case 'giftUniqueLink':\n      return buildGiftUniqueLink({ slug: queryParams.slug });\n    case 'stars':\n      return { type: 'stars' } satisfies StarsModalLink;\n    case 'ton':\n      return { type: 'ton' } satisfies TonModalLink;\n    case 'settings':\n      return buildSettingsScreenLink({ screen: pathParams.length === 1 ? pathParams[0] : undefined });\n    default:\n      break;\n  }\n  return undefined;\n}\n\nfunction parseHttpLink(url: URL) {\n  if (!ELIGIBLE_HOSTNAMES.has(url.hostname)) {\n    return undefined;\n  }\n  const queryParams = getQueryParams(url);\n  const pathParams = getPathParams(url);\n\n  const deepLinkType = getHttpDeepLinkType(queryParams, pathParams);\n  switch (deepLinkType) {\n    case 'publicMessageLink': {\n      const {\n        single, comment, t,\n      } = queryParams;\n      const {\n        username,\n        thread,\n        messageId,\n      } = pathParams.length === 2 ? {\n        username: pathParams[0],\n        thread: queryParams.thread,\n        messageId: pathParams[1],\n      } : {\n        username: pathParams[0],\n        thread: pathParams[1],\n        messageId: pathParams[2],\n      };\n      return buildPublicMessageLink({\n        username,\n        messageId,\n        single,\n        threadId: thread,\n        commentId: comment,\n        timestamp: t,\n      });\n    }\n    case 'privateMessageLink': {\n      const {\n        single, comment, t,\n      } = queryParams;\n      const {\n        channelId,\n        thread,\n        messageId,\n      } = pathParams.length === 3 ? {\n        channelId: pathParams[1],\n        thread: queryParams.thread,\n        messageId: pathParams[2],\n      } : {\n        channelId: pathParams[1],\n        thread: pathParams[2],\n        messageId: pathParams[3],\n      };\n      return buildPrivateMessageLink({\n        channelId,\n        messageId,\n        single,\n        threadId: thread,\n        commentId: comment,\n        timestamp: t,\n      });\n    }\n    case 'shareLink': {\n      return buildShareLink({ text: queryParams.text, url: queryParams.url });\n    }\n    case 'chatFolderLink':\n      return buildChatFolderLink({ slug: pathParams[1] });\n    case 'loginCodeLink':\n      return buildLoginCodeLink({ code: pathParams[1] });\n    case 'publicUsernameOrBotLink':\n      return buildPublicUsernameOrBotLink({\n        username: pathParams[0],\n        start: queryParams.start,\n        text: queryParams.text,\n        startApp: queryParams.startapp,\n        mode: queryParams.mode,\n        appName: undefined,\n        startAttach: queryParams.startattach,\n        attach: queryParams.attach,\n        choose: queryParams.choose,\n        ref: queryParams.ref,\n        direct: queryParams.direct,\n      });\n    case 'privateChannelLink': {\n      return buildPrivateChannelLink({ channelId: pathParams[1] });\n    }\n    case 'businessChatLink':\n      return buildBusinessChatLink({ slug: pathParams[1] });\n    case 'chatBoostLink': {\n      if (pathParams[0] === 'boost') {\n        return buildChatBoostLink({ username: pathParams[1], id: queryParams.c });\n      }\n      const isPrivateChannel = pathParams[0] === 'c';\n      return buildChatBoostLink({\n        username: !isPrivateChannel ? pathParams[0] : undefined,\n        id: isPrivateChannel ? pathParams[1] : undefined,\n      });\n    }\n    case 'giftUniqueLink': {\n      const slug = pathParams.slice(1).join('/');\n      return buildGiftUniqueLink({\n        slug,\n      });\n    }\n    default:\n      break;\n  }\n  return undefined;\n}\n\nfunction getHttpDeepLinkType(\n  queryParams: Record<string, string>,\n  pathParams: string[],\n): DeepLinkType {\n  const len = pathParams.length;\n  const method = pathParams[0];\n  if (len === 1) {\n    if (method === 'share') return 'shareLink';\n    if (method === 'boost' || queryParams.boost !== undefined) return 'chatBoostLink';\n\n    if (isUsernameValid(method)) {\n      return 'publicUsernameOrBotLink';\n    }\n  } else if (len === 2) {\n    if (method === 'addlist') return 'chatFolderLink';\n    if (method === 'login') return 'loginCodeLink';\n    if (method === 'm') return 'businessChatLink';\n    if (method === 'boost') return 'chatBoostLink';\n    if (method === 'nft') return 'giftUniqueLink';\n    if (method === 'c') {\n      if (queryParams.boost !== undefined) return 'chatBoostLink';\n      return 'privateChannelLink';\n    }\n\n    if (isUsernameValid(pathParams[0]) && isNumber(pathParams[1])) {\n      return 'publicMessageLink';\n    }\n  } else if (len === 3) {\n    if (method === 'c' && pathParams.slice(1).every(isNumber)) {\n      return 'privateMessageLink';\n    }\n    if (isUsernameValid(pathParams[0]) && pathParams.slice(1).every(isNumber)) {\n      return 'publicMessageLink';\n    }\n    if (method === 'nft') return 'giftUniqueLink';\n  } else if (len === 4) {\n    if (method === 'c' && pathParams.slice(1).every(isNumber)) {\n      return 'privateMessageLink';\n    }\n  }\n  return 'unknown';\n}\n\nfunction getTgDeepLinkType(\n  queryParams: Record<string, string>,\n  pathParams: string[],\n  method: DeepLinkMethod,\n): DeepLinkType {\n  switch (method) {\n    case 'resolve': {\n      const {\n\n        domain, post, bot_id, scope, public_key, nonce,\n      } = queryParams;\n      if (domain === 'telegrampassport' && bot_id && scope && public_key && nonce) {\n        return 'telegramPassportLink';\n      }\n      if (domain && post) {\n        return 'publicMessageLink';\n      }\n      if (isUsernameValid(domain)) {\n        return 'publicUsernameOrBotLink';\n      }\n      break;\n    }\n    case 'privatepost': {\n      const { channel, post } = queryParams;\n      if (channel) {\n        if (post) return 'privateMessageLink';\n        return 'privateChannelLink';\n      }\n      break;\n    }\n    case 'msg_url':\n      return 'shareLink';\n    case 'addlist':\n      return 'chatFolderLink';\n    case 'login':\n      return 'loginCodeLink';\n    case 'passport':\n      return 'telegramPassportLink';\n    case 'message':\n      return 'businessChatLink';\n    case 'premium_offer':\n      return 'premiumReferrerLink';\n    case 'premium_multigift':\n      return 'premiumMultigiftLink';\n    case 'boost':\n      return 'chatBoostLink';\n    case 'nft':\n      return 'giftUniqueLink';\n    case 'stars':\n      return 'stars';\n    case 'ton':\n      return 'ton';\n    case 'settings': {\n      return 'settings';\n    }\n    default:\n      break;\n  }\n  return 'unknown';\n}\n\nfunction buildShareLink(params: BuilderParams<ShareLink>): BuilderReturnType<ShareLink> {\n  const { url, text } = params;\n  if (!url) {\n    return undefined;\n  }\n  return {\n    type: 'shareLink',\n    url,\n    text,\n  };\n}\n\nfunction buildPublicMessageLink(params: PublicMessageLinkBuilderParams): BuilderReturnType<PublicMessageLink> {\n  const {\n    messageId, threadId, commentId, username, single, timestamp,\n  } = params;\n  if (!username || !isUsernameValid(username)) {\n    return undefined;\n  }\n  if (!messageId || !isNumber(messageId)) {\n    return undefined;\n  }\n  if (threadId && !isNumber(threadId)) {\n    return undefined;\n  }\n  if (commentId && !isNumber(commentId)) {\n    return undefined;\n  }\n  return {\n    type: 'publicMessageLink',\n    username,\n    messageId: Number(messageId),\n    isSingle: single === '',\n    threadId: threadId ? Number(threadId) : undefined,\n    commentId: commentId ? Number(commentId) : undefined,\n    timestamp: timestamp ? parseTimestampDuration(timestamp) : undefined,\n  };\n}\n\nfunction buildPrivateMessageLink(params: PrivateMessageLinkBuilderParams): BuilderReturnType<PrivateMessageLink> {\n  const {\n    messageId, threadId, commentId, channelId, single, timestamp,\n  } = params;\n  if (!channelId || !isNumber(channelId)) {\n    return undefined;\n  }\n  if (!messageId || !isNumber(messageId)) {\n    return undefined;\n  }\n  if (threadId && !isNumber(threadId)) {\n    return undefined;\n  }\n  if (commentId && !isNumber(commentId)) {\n    return undefined;\n  }\n  return {\n    type: 'privateMessageLink',\n    channelId: toChannelId(channelId),\n    messageId: Number(messageId),\n    isSingle: single === '',\n    threadId: threadId ? Number(threadId) : undefined,\n    commentId: commentId ? Number(commentId) : undefined,\n    timestamp: timestamp ? parseTimestampDuration(timestamp) : undefined,\n  };\n}\n\nfunction buildChatFolderLink(params: BuilderParams<ChatFolderLink>): BuilderReturnType<ChatFolderLink> {\n  const {\n    slug,\n  } = params;\n  if (!slug) {\n    return undefined;\n  }\n  return {\n    type: 'chatFolderLink',\n    slug,\n  };\n}\n\nfunction buildLoginCodeLink(params: BuilderParams<LoginCodeLink>): BuilderReturnType<LoginCodeLink> {\n  const {\n    code,\n  } = params;\n  if (!code) {\n    return undefined;\n  }\n  return {\n    type: 'loginCodeLink',\n    code,\n  };\n}\n\nfunction buildTelegramPassportLink(\n  params: BuilderParams<TelegramPassportLink>,\n): BuilderReturnType<TelegramPassportLink> {\n  const {\n    botId,\n    scope,\n    publicKey,\n    nonce,\n    callbackUrl,\n    payload,\n  } = params;\n  if (!botId || !isNumber(botId) || !scope || !publicKey || !nonce) {\n    return undefined;\n  }\n  return {\n    type: 'telegramPassportLink',\n    botId: Number(botId),\n    scope,\n    publicKey,\n    nonce,\n    callbackUrl,\n    payload,\n  };\n}\n\nfunction buildPublicUsernameOrBotLink(\n  params: PublicUsernameOrBotLinkBuilderParams,\n): BuilderReturnType<PublicUsernameOrBotLink> {\n  const {\n    username,\n    start,\n    text,\n    startApp,\n    mode,\n    startAttach,\n    attach,\n    appName,\n    choose,\n    ref,\n    direct,\n  } = params;\n  if (!username) {\n    return undefined;\n  }\n  if (!isUsernameValid(username)) {\n    return undefined;\n  }\n  return {\n    type: 'publicUsernameOrBotLink',\n    username,\n    start,\n    startApp,\n    mode,\n    appName,\n    startAttach,\n    attach,\n    text,\n    choose,\n    ref,\n    isDirect: direct === '',\n  };\n}\n\nfunction buildPrivateChannelLink(params: BuilderParams<PrivateChannelLink>): BuilderReturnType<PrivateChannelLink> {\n  const {\n    channelId,\n  } = params;\n  if (!channelId) {\n    return undefined;\n  }\n\n  return {\n    type: 'privateChannelLink',\n    channelId: toChannelId(channelId),\n  };\n}\n\nfunction buildChatBoostLink(params: BuilderParams<ChatBoostLink>): BuilderReturnType<ChatBoostLink> {\n  const {\n    username,\n    id,\n  } = params;\n\n  if (!username && !id) {\n    return undefined;\n  }\n\n  return {\n    type: 'chatBoostLink',\n    username,\n    id: id ? toChannelId(id) : undefined,\n  };\n}\n\nfunction buildBusinessChatLink(params: BuilderParams<BusinessChatLink>): BuilderReturnType<BusinessChatLink> {\n  const {\n    slug,\n  } = params;\n\n  if (!slug) {\n    return undefined;\n  }\n\n  return {\n    type: 'businessChatLink',\n    slug,\n  };\n}\n\nfunction buildGiftUniqueLink(params: BuilderParams<GiftUniqueLink>): BuilderReturnType<GiftUniqueLink> {\n  const {\n    slug,\n  } = params;\n\n  if (!slug) {\n    return undefined;\n  }\n\n  return {\n    type: 'giftUniqueLink',\n    slug,\n  };\n}\n\nfunction buildSettingsScreen(screenParam: string) {\n  switch (screenParam) {\n    case 'devices':\n      return 'devices';\n    case 'folders':\n      return 'folders';\n    case 'language':\n      return 'language';\n    case 'privacy':\n      return 'privacy';\n    case 'edit_profile':\n      return 'editProfile';\n    case 'theme':\n      return 'theme';\n    default:\n      break;\n  }\n  return undefined;\n}\n\nfunction buildSettingsScreenLink(params: BuilderParams<SettingsScreenLink>): BuilderReturnType<SettingsScreenLink> {\n  const {\n    screen,\n  } = params;\n\n  return {\n    type: 'settings',\n    screen: screen ? buildSettingsScreen(screen) : undefined,\n  };\n}\n\nfunction buildPremiumReferrerLink(params: BuilderParams<PremiumReferrerLink>): BuilderReturnType<PremiumReferrerLink> {\n  const {\n    referrer,\n  } = params;\n\n  if (!referrer) {\n    return undefined;\n  }\n\n  return {\n    type: 'premiumReferrerLink',\n    referrer,\n  };\n}\n\nfunction buildPremiumMultigiftLink(\n  params: BuilderParams<PremiumMultigiftLink>,\n): BuilderReturnType<PremiumMultigiftLink> {\n  const {\n    referrer,\n  } = params;\n\n  if (!referrer) {\n    return undefined;\n  }\n\n  return {\n    type: 'premiumMultigiftLink',\n    referrer,\n  };\n}\n\nfunction isNumber(s: string) {\n  return /^-?\\d+$/.test(s);\n}\n\nfunction getPathParams(url: URL) {\n  const parts = url.pathname.split('/').filter(Boolean);\n  if (parts[0] === 's') {\n    parts.shift();\n  }\n  return parts.map(decodeURI);\n}\n\nfunction getQueryParams(url: URL) {\n  return Object.fromEntries(url.searchParams);\n}\n","/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\r\n\r\n\r\nfunction __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nfunction __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\ntypeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\n\nexport { __classPrivateFieldGet, __classPrivateFieldSet };\n","export function createCallbackManager<T extends AnyToVoidFunction = AnyToVoidFunction>() {\n  const callbacks = new Set<T>();\n\n  function addCallback(cb: T) {\n    callbacks.add(cb);\n\n    return () => {\n      removeCallback(cb);\n    };\n  }\n\n  function removeCallback(cb: T) {\n    callbacks.delete(cb);\n  }\n\n  function runCallbacks(...args: Parameters<T>) {\n    callbacks.forEach((callback) => {\n      callback(...args);\n    });\n  }\n\n  function hasCallbacks() {\n    return Boolean(callbacks.size);\n  }\n\n  return {\n    runCallbacks,\n    addCallback,\n    removeCallback,\n    hasCallbacks,\n  };\n}\n\nexport type CallbackManager<T extends AnyToVoidFunction = AnyToVoidFunction>\n  = ReturnType<typeof createCallbackManager<T>>;\n","import type { ElementRef } from '../lib/teact/teact';\nimport { getIsHeavyAnimating, useEffect } from '../lib/teact/teact';\n\nimport type { CallbackManager } from '../util/callbacks';\n\nimport { requestMeasure } from '../lib/fasterdom/fasterdom';\nimport { createCallbackManager } from '../util/callbacks';\nimport useLastCallback from './useLastCallback';\n\nconst elementObserverMap = new Map<HTMLElement, [IntersectionObserver, CallbackManager]>();\n\nexport default function useSharedIntersectionObserver(\n  refOrElement: ElementRef<HTMLElement> | HTMLElement | undefined,\n  onIntersectionChange: (entry: IntersectionObserverEntry) => void,\n  isDisabled = false,\n) {\n  const onIntersectionChangeLast = useLastCallback(onIntersectionChange);\n\n  useEffect(() => {\n    const el = refOrElement && 'current' in refOrElement ? refOrElement.current : refOrElement;\n    if (!el || isDisabled) {\n      return undefined;\n    }\n\n    const entriesAccumulator = new Map<Element, IntersectionObserverEntry>();\n\n    function flush() {\n      for (const entry of entriesAccumulator.values()) {\n        // Ignore updates when element is not properly mounted (`display: none`)\n        if (!(entry.target as HTMLElement).offsetParent) {\n          continue;\n        }\n\n        onIntersectionChangeLast(entry);\n      }\n\n      entriesAccumulator.clear();\n    }\n\n    const callback: IntersectionObserverCallback = ([entry]) => {\n      entriesAccumulator.set(entry.target, entry);\n\n      if (!getIsHeavyAnimating()) {\n        flush();\n      } else {\n        getIsHeavyAnimating.once(() => {\n          requestMeasure(flush);\n        });\n      }\n    };\n\n    let [observer, callbackManager] = elementObserverMap.get(el) || [undefined, undefined];\n    if (!observer) {\n      callbackManager = createCallbackManager();\n      observer = new IntersectionObserver(callbackManager.runCallbacks);\n      elementObserverMap.set(el, [observer, callbackManager]);\n      observer.observe(el);\n    }\n    callbackManager!.addCallback(callback);\n\n    return () => {\n      callbackManager!.removeCallback(callback);\n      if (!callbackManager!.hasCallbacks()) {\n        observer.unobserve(el);\n        observer.disconnect();\n        elementObserverMap.delete(el);\n      }\n    };\n  }, [isDisabled, refOrElement]);\n}\n","import { getActions, getGlobal } from '../global';\n\nimport { selectCustomEmoji } from '../global/selectors';\nimport { addCustomEmojiInputRenderCallback } from '../util/emoji/customEmojiManager';\nimport { throttle } from '../util/schedulers';\n\nlet LOAD_QUEUE = new Set<string>();\nconst RENDER_HISTORY = new Set<string>();\nconst THROTTLE = 200;\nconst LIMIT_PER_REQUEST = 100;\n\nconst loadFromQueue = throttle(() => {\n  const queue = [...LOAD_QUEUE];\n\n  const queueToLoad = queue.slice(0, LIMIT_PER_REQUEST);\n  const otherQueue = queue.slice(LIMIT_PER_REQUEST);\n\n  getActions().loadCustomEmojis({\n    ids: queueToLoad,\n  });\n\n  LOAD_QUEUE = new Set(otherQueue);\n\n  // Schedule next load\n  if (LOAD_QUEUE.size) {\n    loadFromQueue();\n  }\n}, THROTTLE, false);\n\nconst updateLastRendered = throttle(() => {\n  getActions().updateLastRenderedCustomEmojis({\n    ids: [...RENDER_HISTORY].reverse(),\n  });\n\n  RENDER_HISTORY.clear();\n}, THROTTLE, false);\n\nfunction notifyCustomEmojiRender(emojiId: string) {\n  RENDER_HISTORY.add(emojiId);\n  updateLastRendered();\n}\n\naddCustomEmojiInputRenderCallback(notifyCustomEmojiRender);\n\nexport default function useEnsureCustomEmoji(id?: string) {\n  if (!id) return;\n  notifyCustomEmojiRender(id);\n\n  if (selectCustomEmoji(getGlobal(), id)) {\n    return;\n  }\n\n  LOAD_QUEUE.add(id);\n  loadFromQueue();\n}\n","import { useEffect, useState } from '../../../lib/teact/teact';\nimport { getGlobal } from '../../../global';\n\nimport type { ApiSticker } from '../../../api/types';\nimport type { GlobalState } from '../../../global/types';\n\nimport { selectCanPlayAnimatedEmojis, selectCustomEmoji } from '../../../global/selectors';\nimport { addCustomEmojiCallback, removeCustomEmojiCallback } from '../../../util/emoji/customEmojiManager';\n\nimport useEnsureCustomEmoji from '../../../hooks/useEnsureCustomEmoji';\nimport useLastCallback from '../../../hooks/useLastCallback';\n\nexport default function useCustomEmoji(documentId?: string) {\n  const [customEmoji, setCustomEmoji] = useState<ApiSticker | undefined>(\n    documentId ? selectCustomEmoji(getGlobal(), documentId) : undefined,\n  );\n  const [canPlay, setCanPlay] = useState(selectCanPlayAnimatedEmojis(getGlobal()));\n\n  useEnsureCustomEmoji(documentId);\n\n  const handleGlobalChange = useLastCallback((customEmojis?: GlobalState['customEmojis']) => {\n    if (!documentId) return;\n\n    const newGlobal = getGlobal();\n    setCustomEmoji((customEmojis ?? newGlobal.customEmojis).byId[documentId]);\n    setCanPlay(selectCanPlayAnimatedEmojis(newGlobal));\n  });\n\n  useEffect(handleGlobalChange, [documentId, handleGlobalChange]);\n\n  useEffect(() => {\n    if (!documentId) return undefined;\n\n    addCustomEmojiCallback(handleGlobalChange, documentId);\n\n    return () => {\n      removeCustomEmojiCallback(handleGlobalChange);\n    };\n  }, [documentId]);\n\n  return { customEmoji, canPlay };\n}\n","import type { ActionReturnType } from '../../types';\nimport { ManagementProgress } from '../../../types';\n\nimport {\n  CUSTOM_BG_CACHE_NAME,\n  LANG_CACHE_NAME,\n  LOCK_SCREEN_ANIMATION_DURATION_MS,\n  MEDIA_CACHE_NAME,\n  MEDIA_CACHE_NAME_AVATARS,\n  MEDIA_PROGRESSIVE_CACHE_NAME,\n} from '../../../config';\nimport { updateAppBadge } from '../../../util/appBadge';\nimport { PASSCODE_IDB_STORE } from '../../../util/browser/idb';\nimport {\n  IS_WEBM_SUPPORTED, MAX_BUFFER_SIZE, PLATFORM_ENV,\n} from '../../../util/browser/windowEnvironment';\nimport * as cacheApi from '../../../util/cacheApi';\nimport { getCurrentTabId } from '../../../util/establishMultitabRole';\nimport { ACCOUNT_SLOT, getAccountsInfo } from '../../../util/multiaccount';\nimport { unsubscribe } from '../../../util/notifications';\nimport { clearEncryptedSession, encryptSession, forgetPasscode } from '../../../util/passcode';\nimport { parseInitialLocationHash, resetInitialLocationHash, resetLocationHash } from '../../../util/routing';\nimport { pause } from '../../../util/schedulers';\nimport {\n  clearStoredSession,\n  loadStoredSession,\n  storeSession,\n} from '../../../util/sessions';\nimport { forceWebsync } from '../../../util/websync';\nimport {\n  callApi, callApiLocal, initApi, setShouldEnableDebugLog,\n} from '../../../api/gramjs';\nimport { removeGlobalFromCache, removeSharedStateFromCache, serializeGlobal } from '../../cache';\nimport {\n  addActionHandler, getGlobal, setGlobal,\n} from '../../index';\nimport {\n  clearGlobalForLockScreen, updateManagementProgress, updatePasscodeSettings,\n} from '../../reducers';\nimport { selectSharedSettings } from '../../selectors/sharedState';\nimport { destroySharedStatePort } from '../../shared/sharedStateConnector';\n\naddActionHandler('initApi', (global, actions): ActionReturnType => {\n  const initialLocationHash = parseInitialLocationHash();\n  const {\n    shouldAllowHttpTransport,\n    shouldForceHttpTransport,\n    shouldDebugExportedSenders,\n    shouldCollectDebugLogs,\n    language,\n  } = selectSharedSettings(global);\n\n  const hasTestParam = window.location.search.includes('test') || initialLocationHash?.tgWebAuthTest === '1';\n\n  const isTestServer = global.config?.isTestServer;\n  const accountsInfo = getAccountsInfo();\n  const accountIds = Object.values(accountsInfo)\n    .filter((info) => info.isTest === isTestServer)\n    .map(({ userId }) => userId)\n    .filter(Boolean);\n\n  void initApi(actions.apiUpdate, {\n    userAgent: navigator.userAgent,\n    platform: PLATFORM_ENV,\n    sessionData: loadStoredSession(),\n    isWebmSupported: IS_WEBM_SUPPORTED,\n    maxBufferSize: MAX_BUFFER_SIZE,\n    webAuthToken: initialLocationHash?.tgWebAuthToken,\n    dcId: initialLocationHash?.tgWebAuthDcId ? Number(initialLocationHash?.tgWebAuthDcId) : undefined,\n    mockScenario: initialLocationHash?.mockScenario,\n    shouldAllowHttpTransport,\n    shouldForceHttpTransport,\n    shouldDebugExportedSenders,\n    langCode: language,\n    isTestServerRequested: hasTestParam,\n    accountIds,\n  });\n\n  void setShouldEnableDebugLog(Boolean(shouldCollectDebugLogs));\n});\n\naddActionHandler('setAuthPhoneNumber', (global, actions, payload): ActionReturnType => {\n  const { phoneNumber } = payload;\n\n  void callApi('provideAuthPhoneNumber', phoneNumber.replace(/[^\\d]/g, ''));\n\n  return {\n    ...global,\n    authIsLoading: true,\n    authErrorKey: undefined,\n  };\n});\n\naddActionHandler('setAuthCode', (global, actions, payload): ActionReturnType => {\n  const { code } = payload;\n\n  void callApi('provideAuthCode', code);\n\n  return {\n    ...global,\n    authIsLoading: true,\n    authErrorKey: undefined,\n  };\n});\n\naddActionHandler('setAuthPassword', (global, actions, payload): ActionReturnType => {\n  const { password } = payload;\n\n  void callApi('provideAuthPassword', password);\n\n  return {\n    ...global,\n    authIsLoading: true,\n    authErrorKey: undefined,\n  };\n});\n\naddActionHandler('uploadProfilePhoto', async (global, actions, payload): Promise<void> => {\n  const {\n    file, isFallback, isVideo, videoTs, bot,\n    tabId = getCurrentTabId(),\n  } = payload;\n\n  global = updateManagementProgress(global, ManagementProgress.InProgress, tabId);\n  setGlobal(global);\n\n  const result = await callApi('uploadProfilePhoto', file, isFallback, isVideo, videoTs, bot);\n  if (!result) return;\n\n  global = getGlobal();\n  global = updateManagementProgress(global, ManagementProgress.Complete, tabId);\n  setGlobal(global);\n\n  actions.loadFullUser({ userId: global.currentUserId! });\n});\n\naddActionHandler('signUp', (global, actions, payload): ActionReturnType => {\n  const { firstName, lastName } = payload;\n\n  void callApi('provideAuthRegistration', { firstName, lastName });\n\n  return {\n    ...global,\n    authIsLoading: true,\n    authErrorKey: undefined,\n  };\n});\n\naddActionHandler('returnToAuthPhoneNumber', (global): ActionReturnType => {\n  void callApi('restartAuth');\n\n  return {\n    ...global,\n    authErrorKey: undefined,\n  };\n});\n\naddActionHandler('goToAuthQrCode', (global): ActionReturnType => {\n  void callApi('restartAuthWithQr');\n\n  return {\n    ...global,\n    authIsLoadingQrCode: true,\n    authErrorKey: undefined,\n  };\n});\n\naddActionHandler('saveSession', (global, actions, payload): ActionReturnType => {\n  if (global.passcode.isScreenLocked) {\n    return;\n  }\n\n  const { sessionData } = payload;\n  if (sessionData) {\n    storeSession(sessionData);\n  } else {\n    clearStoredSession();\n  }\n});\n\naddActionHandler('signOut', async (global, actions, payload): Promise<void> => {\n  if ('hangUp' in actions) actions.hangUp({ tabId: getCurrentTabId() });\n  if ('leaveGroupCall' in actions) actions.leaveGroupCall({ tabId: getCurrentTabId() });\n\n  try {\n    resetInitialLocationHash();\n    resetLocationHash();\n    await unsubscribe();\n    await Promise.race([callApi('destroy'), pause(3000)]);\n    await forceWebsync(false);\n  } catch (err) {\n    // Do nothing\n  }\n\n  actions.reset();\n\n  if (payload?.forceInitApi) {\n    actions.initApi();\n  }\n});\n\naddActionHandler('requestChannelDifference', (global, actions, payload): ActionReturnType => {\n  const { chatId } = payload;\n\n  void callApi('requestChannelDifference', chatId);\n});\n\naddActionHandler('reset', (global, actions): ActionReturnType => {\n  clearStoredSession(ACCOUNT_SLOT);\n  clearEncryptedSession();\n\n  void cacheApi.clear(MEDIA_CACHE_NAME);\n  void cacheApi.clear(MEDIA_CACHE_NAME_AVATARS);\n  void cacheApi.clear(MEDIA_PROGRESSIVE_CACHE_NAME);\n  void cacheApi.clear(CUSTOM_BG_CACHE_NAME);\n\n  removeGlobalFromCache();\n  destroySharedStatePort();\n\n  // Check if there are any accounts left\n  const accounts = getAccountsInfo();\n  if (!Object.values(accounts).length) {\n    PASSCODE_IDB_STORE.clear();\n    removeSharedStateFromCache();\n  }\n\n  const langCachePrefix = LANG_CACHE_NAME.replace(/\\d+$/, '');\n  const langCacheVersion = Number((LANG_CACHE_NAME.match(/\\d+$/) || ['0'])[0]);\n  for (let i = 0; i < langCacheVersion; i++) {\n    void cacheApi.clear(`${langCachePrefix}${i === 0 ? '' : i}`);\n  }\n\n  updateAppBadge(0);\n\n  actions.initShared({ force: true });\n  Object.values(global.byTabId).forEach(({ id: otherTabId, isMasterTab }) => {\n    actions.init({ tabId: otherTabId, isMasterTab });\n  });\n});\n\naddActionHandler('disconnect', (): ActionReturnType => {\n  void callApiLocal('disconnect');\n});\n\naddActionHandler('destroyConnection', (): ActionReturnType => {\n  void callApiLocal('destroy', true, true);\n});\n\naddActionHandler('loadNearestCountry', async (global): Promise<void> => {\n  if (global.connectionState !== 'connectionStateReady') {\n    return;\n  }\n\n  const authNearestCountry = await callApi('fetchNearestCountry');\n\n  global = getGlobal();\n  global = {\n    ...global,\n    authNearestCountry,\n  };\n  setGlobal(global);\n});\n\naddActionHandler('setDeviceToken', (global, actions, payload): ActionReturnType => {\n  const { token } = payload;\n  return {\n    ...global,\n    push: {\n      deviceToken: token,\n      subscribedAt: Date.now(),\n    },\n  };\n});\n\naddActionHandler('deleteDeviceToken', (global): ActionReturnType => {\n  return {\n    ...global,\n    push: undefined,\n  };\n});\n\naddActionHandler('lockScreen', async (global): Promise<void> => {\n  const sessionJson = JSON.stringify({ ...loadStoredSession(), userId: global.currentUserId });\n  const globalJson = serializeGlobal(global);\n\n  await encryptSession(sessionJson, globalJson);\n  forgetPasscode();\n  clearStoredSession();\n  updateAppBadge(0);\n\n  global = getGlobal();\n  global = updatePasscodeSettings(\n    global,\n    {\n      isScreenLocked: true,\n      invalidAttemptsCount: 0,\n      timeoutUntil: undefined,\n    },\n  );\n  setGlobal(global);\n\n  setTimeout(() => {\n    global = getGlobal();\n    global = clearGlobalForLockScreen(global);\n    setGlobal(global);\n  }, LOCK_SCREEN_ANIMATION_DURATION_MS);\n\n  try {\n    await unsubscribe();\n    await callApi('destroy', true);\n  } catch (err) {\n    // Do nothing\n  }\n});\n","import type { LangFn } from './types';\n\nimport { STARS_ICON_PLACEHOLDER } from '../../config';\nimport { convertTonFromNanos } from '../../util/formatCurrency';\nimport buildClassName from '../buildClassName';\n\nimport Icon from '../../components/common/icons/Icon';\nimport StarIcon from '../../components/common/icons/StarIcon';\n\nexport function formatStarsAsText(lang: LangFn, amount: number) {\n  return lang('StarsAmountText', { amount }, { pluralValue: amount });\n}\n\nexport function formatTonAsText(lang: LangFn, amount: number, shouldConvertFromNanos?: boolean) {\n  const formattedAmount = shouldConvertFromNanos ? convertTonFromNanos(Number(amount)) : amount;\n  return lang('TonAmountText', { amount: lang.preciseNumber(formattedAmount) }, { pluralValue: formattedAmount });\n}\n\nexport function formatTonAsIcon(\n  lang: LangFn,\n  amount: number | string,\n  options?: {\n    className?: string; containerClassName?: string; shouldConvertFromNanos?: boolean;\n  }) {\n  const { className, containerClassName, shouldConvertFromNanos } = options || {};\n  const formattedAmount = shouldConvertFromNanos ? convertTonFromNanos(Number(amount)) : amount;\n  const icon = <Icon name=\"toncoin\" className={buildClassName('ton-amount-icon', className)} />;\n\n  if (containerClassName) {\n    return (\n      <span className={containerClassName}>\n        {lang('TonAmount', { amount: formattedAmount }, {\n          withNodes: true,\n          specialReplacement: {\n            '': icon,\n          },\n        })}\n      </span>\n    );\n  }\n\n  return lang('TonAmount', { amount: formattedAmount }, {\n    withNodes: true,\n    specialReplacement: {\n      '': icon,\n    },\n  });\n}\n\nexport function formatStarsAsIcon(lang: LangFn, amount: number | string, options?: {\n  asFont?: boolean; className?: string; containerClassName?: string; }) {\n  const { asFont, className, containerClassName } = options || {};\n  const icon = asFont\n    ? <Icon name=\"star\" className={buildClassName('star-amount-icon', className)} />\n    : <StarIcon type=\"gold\" className={buildClassName('star-amount-icon', className)} size=\"adaptive\" />;\n\n  if (containerClassName) {\n    return (\n      <span className={containerClassName}>\n        {lang('StarsAmount', { amount }, {\n          withNodes: true,\n          specialReplacement: {\n            [STARS_ICON_PLACEHOLDER]: icon,\n          },\n        })}\n      </span>\n    );\n  }\n\n  return lang('StarsAmount', { amount }, {\n    withNodes: true,\n    specialReplacement: {\n      [STARS_ICON_PLACEHOLDER]: icon,\n    },\n  });\n}\n","/* eslint-disable prefer-const */\n\nimport { preloadImage } from './files';\n\nconst LUMA_THRESHOLD = 128;\n\n/**\n * HEX > RGB\n * input: 'xxxxxx' (ex. 'ed15fa') case-insensitive\n * output: [r, g, b] ([0-255, 0-255, 0-255])\n */\nexport function hex2rgb(param: string): [number, number, number] {\n  return [\n    parseInt(param.substring(0, 2), 16),\n    parseInt(param.substring(2, 4), 16),\n    parseInt(param.substring(4, 6), 16),\n  ];\n}\n\n/**\n * RGB > HEX\n * input: [r, g, b] ([0-255, 0-255, 0-255])\n * output: 'xxxxxx' (ex. 'ff0000')\n */\nexport function rgb2hex(param: [number, number, number]) {\n  const p0 = param[0].toString(16);\n  const p1 = param[1].toString(16);\n  const p2 = param[2].toString(16);\n  return (p0.length === 1 ? '0' + p0 : p0) + (p1.length === 1 ? '0' + p1 : p1) + (p2.length === 1 ? '0' + p2 : p2);\n}\n\n/**\n * Converts an RGB color value to HSV. Conversion formula\n * adapted from http://en.wikipedia.org/wiki/HSV_color_space.\n * Assumes r, g, and b are contained in the set [0, 255] and\n * returns h, s, and v in the set [0, 1].\n *\n * @param   Number  r       The red color value\n * @param   Number  g       The green color value\n * @param   Number  b       The blue color value\n * @return  Array           The HSV representation\n */\nexport function rgb2hsb([r, g, b]: [number, number, number]): [number, number, number] {\n  r /= 255;\n  g /= 255;\n  b /= 255;\n\n  let max = Math.max(r, g, b), min = Math.min(r, g, b);\n  let h!: number, s: number, v: number = max;\n\n  let d = max - min;\n  s = max === 0 ? 0 : d / max;\n\n  if (max === min) {\n    h = 0; // achromatic\n  } else {\n    switch (max) {\n      case r:\n        h = (g - b) / d + (g < b ? 6 : 0);\n        break;\n      case g:\n        h = (b - r) / d + 2;\n        break;\n      case b:\n        h = (r - g) / d + 4;\n        break;\n    }\n\n    h /= 6;\n  }\n\n  return [h, s, v];\n}\n\n/**\n * Converts an HSV color value to RGB. Conversion formula\n * adapted from http://en.wikipedia.org/wiki/HSV_color_space.\n * Assumes h, s, and v are contained in the set [0, 1] and\n * returns r, g, and b in the set [0, 255].\n *\n * @param   Number  h       The hue\n * @param   Number  s       The saturation\n * @param   Number  v       The value\n * @return  Array           The RGB representation\n */\nexport function hsb2rgb([h, s, v]: [number, number, number]): [number, number, number] {\n  let r!: number, g!: number, b!: number;\n\n  let i = Math.floor(h * 6);\n  let f = h * 6 - i;\n  let p = v * (1 - s);\n  let q = v * (1 - f * s);\n  let t = v * (1 - (1 - f) * s);\n\n  switch (i % 6) {\n    case 0:\n      r = v;\n      g = t;\n      b = p;\n      break;\n    case 1:\n      r = q;\n      g = v;\n      b = p;\n      break;\n    case 2:\n      r = p;\n      g = v;\n      b = t;\n      break;\n    case 3:\n      r = p;\n      g = q;\n      b = v;\n      break;\n    case 4:\n      r = t;\n      g = p;\n      b = v;\n      break;\n    case 5:\n      r = v;\n      g = p;\n      b = q;\n      break;\n  }\n\n  return [\n    Math.round(r * 255),\n    Math.round(g * 255),\n    Math.round(b * 255),\n  ];\n}\n\nexport async function getAverageColor(url: string): Promise<[number, number, number]> {\n  // Only visit every 5 pixels\n  const blockSize = 5;\n  const defaultRGB: [number, number, number] = [0, 0, 0];\n  let data;\n  let width;\n  let height;\n  let i = -4;\n  let length;\n  let rgb: [number, number, number] = [0, 0, 0];\n  let count = 0;\n\n  const canvas = document.createElement('canvas');\n  const context = canvas.getContext && canvas.getContext('2d');\n  if (!context) {\n    return defaultRGB;\n  }\n\n  const image = await preloadImage(url);\n  height = image.naturalHeight || image.offsetHeight || image.height;\n  width = image.naturalWidth || image.offsetWidth || image.width;\n  canvas.height = height;\n  canvas.width = width;\n\n  context.drawImage(image, 0, 0);\n\n  try {\n    data = context.getImageData(0, 0, width, height);\n  } catch (e) {\n    return defaultRGB;\n  }\n\n  length = data.data.length;\n\n  while ((i += blockSize * 4) < length) {\n    if (data.data[i + 3] === 0) continue; // Ignore fully transparent pixels\n    ++count;\n    rgb[0] += data.data[i];\n    rgb[1] += data.data[i + 1];\n    rgb[2] += data.data[i + 2];\n  }\n\n  rgb[0] = Math.floor(rgb[0] / count);\n  rgb[1] = Math.floor(rgb[1] / count);\n  rgb[2] = Math.floor(rgb[2] / count);\n\n  return rgb;\n}\n\nexport function getColorLuma(rgbColor: [number, number, number]) {\n  const [r, g, b] = rgbColor;\n  const luma = 0.2126 * r + 0.7152 * g + 0.0722 * b;\n  return luma;\n}\n// https://stackoverflow.com/a/64090995\nexport function hsl2rgb([h, s, l]: [number, number, number]): [number, number, number] {\n  let a = s * Math.min(l, 1 - l);\n  let f = (n: number, k = (n + h / 30) % 12) => l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);\n  return [f(0), f(8), f(4)];\n}\n\n// Function was adapted from https://github.com/telegramdesktop/tdesktop/blob/35ff621b5b52f7e3553fb0f990ea13ade7101b8e/Telegram/SourceFiles/data/data_wall_paper.cpp#L518\nexport function getPatternColor(rgbColor: [number, number, number]) {\n  let [hue, saturation, value] = rgb2hsb(rgbColor);\n\n  saturation = Math.min(1, saturation + 0.05 + 0.1 * (1 - saturation));\n  value = value > 0.5\n    ? Math.max(0, value * 0.65)\n    : Math.max(0, Math.min(1, 1 - value * 0.65));\n\n  const rgb = hsl2rgb([hue * 360, saturation, value]);\n  const hex = rgb2hex(rgb.map((c) => Math.floor(c * 255)) as [number, number, number]);\n  return `#${hex}66`;\n}\n\nexport const convertToRGBA = (color: number): string => {\n  const alpha = (color >> 24) & 0xff;\n  const red = (color >> 16) & 0xff;\n  const green = (color >> 8) & 0xff;\n  const blue = color & 0xff;\n\n  const alphaFloat = alpha / 255;\n  return `rgba(${red}, ${green}, ${blue}, ${alphaFloat})`;\n};\n\nexport const numberToHexColor = (color: number): string => {\n  return `#${color.toString(16).padStart(6, '0')}`;\n};\n\nexport const getTextColor = (color: number): string => {\n  const r = (color >> 16) & 0xff;\n  const g = (color >> 8) & 0xff;\n  const b = color & 0xff;\n  const luma = getColorLuma([r, g, b]);\n  return luma > LUMA_THRESHOLD ? 'black' : 'white';\n};\n","import { onFullyIdle } from '../lib/teact/teact';\nimport { addCallback } from '../lib/teact/teactn';\nimport { addActionHandler, getGlobal } from '../global';\n\nimport type {\n  ApiChat, ApiChatFolder, ApiNotifyPeerType, ApiPeerNotifySettings, ApiUser,\n} from '../api/types';\nimport type { GlobalState } from '../global/types';\nimport type { CallbackManager } from './callbacks';\n\nimport {\n  ALL_FOLDER_ID, ARCHIVED_FOLDER_ID, DEBUG, SAVED_FOLDER_ID, SERVICE_NOTIFICATIONS_USER_ID,\n} from '../config';\nimport { getIsChatMuted } from '../global/helpers/notifications';\nimport {\n  selectChatLastMessage,\n  selectIsChatRestricted,\n  selectNotifyDefaults,\n  selectTabState,\n  selectTopics,\n} from '../global/selectors';\nimport arePropsShallowEqual from './arePropsShallowEqual';\nimport { createCallbackManager } from './callbacks';\nimport { areSortedArraysEqual, unique } from './iteratees';\nimport { throttle } from './schedulers';\n\ninterface FolderSummary {\n  id: number;\n  listIds?: Set<string>;\n  orderedPinnedIds?: string[];\n  contacts?: true;\n  nonContacts?: true;\n  groups?: true;\n  channels?: true;\n  bots?: true;\n  excludeMuted?: true;\n  excludeRead?: true;\n  excludeArchived?: true;\n  excludedChatIds?: Set<string>;\n  includedChatIds?: Set<string>;\n  pinnedChatIds?: Set<string>;\n}\n\ninterface ChatSummary {\n  id: string;\n  type: ApiChat['type'];\n  isListedInAll: boolean;\n  isListedInSaved: boolean;\n  isArchived: boolean;\n  isMuted: boolean;\n  isUnread: boolean;\n  unreadCount?: number;\n  unreadMentionsCount?: number;\n  orderInAll: number;\n  orderInSaved: number;\n  isUserBot?: boolean;\n  isUserContact?: boolean;\n}\n\nconst UPDATE_THROTTLE = 500;\nconst DEBUG_DURATION_LIMIT = 6;\n\nconst initials = buildInitials();\n\nlet prevGlobal: {\n  allFolderListIds?: GlobalState['chats']['listIds']['active'];\n  allFolderPinnedIds?: GlobalState['chats']['orderedPinnedIds']['active'];\n  archivedFolderListIds?: GlobalState['chats']['listIds']['archived'];\n  archivedFolderPinnedIds?: GlobalState['chats']['orderedPinnedIds']['archived'];\n  savedFolderListIds?: GlobalState['chats']['listIds']['saved'];\n  savedFolderPinnedIds?: GlobalState['chats']['orderedPinnedIds']['saved'];\n  isAllFolderFullyLoaded?: boolean;\n  isArchivedFolderFullyLoaded?: boolean;\n  isSavedFolderFullyLoaded?: boolean;\n  lastAllMessageIds?: GlobalState['chats']['lastMessageIds']['all'];\n  lastSavedMessageIds?: GlobalState['chats']['lastMessageIds']['saved'];\n  topicsInfoById: GlobalState['chats']['topicsInfoById'];\n  chatsById: Record<string, ApiChat>;\n  foldersById: Record<string, ApiChatFolder>;\n  usersById: Record<string, ApiUser>;\n  notifyDefaults?: Record<ApiNotifyPeerType, ApiPeerNotifySettings>;\n  notifyExceptions?: Record<number, ApiPeerNotifySettings>;\n} = initials.prevGlobal;\n\nlet prepared: {\n  folderSummariesById: Record<string, FolderSummary>;\n  chatSummariesById: Map<string, ChatSummary>;\n  folderIdsByChatId: Record<string, number[]>;\n  chatIdsByFolderId: Record<number, Set<string> | undefined>;\n  isOrderedListJustPatched: Record<number, boolean | undefined>;\n} = initials.prepared;\n\nlet results: {\n  orderedIdsByFolderId: Record<string, string[] | undefined>;\n  pinnedCountByFolderId: Record<string, number | undefined>; // Also watched by `callbacks.orderedIdsByFolderId`\n  chatsCountByFolderId: Record<string, number | undefined>;\n  unreadCountersByFolderId: Record<string, {\n    chatsCount: number;\n    notificationsCount: number;\n  } | undefined>;\n  unreadChatIdsByFolderId: Record<string, string[] | undefined>;\n} = initials.results;\n\nlet callbacks: {\n  orderedIdsByFolderId: Record<number, CallbackManager>;\n  chatsCountByFolderId: CallbackManager;\n  unreadCountersByFolderId: CallbackManager;\n  unreadChatIdsByFolderId: CallbackManager;\n} = initials.callbacks;\n\nif (DEBUG) {\n  (window as any).DEBUG_getFolderManager = () => ({\n    prepared,\n    results,\n  });\n}\n\nconst updateFolderManagerThrottled = throttle(() => {\n  onFullyIdle(() => {\n    updateFolderManager(getGlobal());\n  });\n}, UPDATE_THROTTLE);\n\nlet inited = false;\n\n/* Getters */\n\nexport function init() {\n  inited = true;\n\n  addCallback(updateFolderManagerThrottled);\n  addActionHandler('reset', reset);\n\n  const global = getGlobal();\n  if (!selectTabState(global).isMasterTab) {\n    updateFolders(global, true, true, true, true);\n  }\n  updateFolderManager(global);\n}\n\nexport function getOrderedIds(folderId: number) {\n  if (!inited) init();\n\n  return results.orderedIdsByFolderId[folderId];\n}\n\nexport function getPinnedChatsCount(folderId: number) {\n  if (!inited) init();\n\n  return results.pinnedCountByFolderId[folderId] || 0;\n}\n\nexport function getChatsCount() {\n  if (!inited) init();\n\n  return results.chatsCountByFolderId;\n}\n\nexport function getUnreadCounters() {\n  if (!inited) init();\n\n  return results.unreadCountersByFolderId;\n}\n\nexport function getUnreadChatsByFolderId() {\n  if (!inited) init();\n\n  return results.unreadChatIdsByFolderId;\n}\n\nexport function getAllNotificationsCount() {\n  return getUnreadCounters()[ALL_FOLDER_ID]?.notificationsCount || 0;\n}\n\nexport function getOrderKey(chatId: string, isForSaved?: boolean) {\n  const summary = prepared.chatSummariesById.get(chatId)!;\n  return isForSaved ? summary.orderInSaved : summary.orderInAll;\n}\n\nexport function getChatFolderIds(chatId: string) {\n  return prepared.folderIdsByChatId[chatId];\n}\n\n/* Callback managers */\n\nexport function addOrderedIdsCallback(folderId: number, callback: (orderedIds: string[]) => void) {\n  if (!callbacks.orderedIdsByFolderId[folderId]) {\n    callbacks.orderedIdsByFolderId[folderId] = createCallbackManager();\n  }\n\n  return callbacks.orderedIdsByFolderId[folderId].addCallback(callback);\n}\n\nexport function addChatsCountCallback(callback: (chatsCount: typeof results.chatsCountByFolderId) => void) {\n  return callbacks.chatsCountByFolderId.addCallback(callback);\n}\n\nexport function addUnreadChatsByFolderIdCallback(\n  callback: (unreadChats: typeof results.unreadChatIdsByFolderId) => void,\n) {\n  return callbacks.unreadChatIdsByFolderId.addCallback(callback);\n}\n\nexport function addUnreadCountersCallback(callback: (unreadCounters: typeof results.unreadCountersByFolderId) => void) {\n  return callbacks.unreadCountersByFolderId.addCallback(callback);\n}\n\n/* Global update handlers */\n\nfunction updateFolderManager(global: GlobalState) {\n  let DEBUG_startedAt: number;\n  if (DEBUG) {\n    DEBUG_startedAt = performance.now();\n  }\n\n  const isAllFolderChanged = Boolean(\n    global.chats.listIds.active\n    && isMainFolderChanged(ALL_FOLDER_ID, global.chats.listIds.active, global.chats.orderedPinnedIds.active),\n  );\n  const isArchivedFolderChanged = Boolean(\n    global.chats.listIds.archived\n    && isMainFolderChanged(ARCHIVED_FOLDER_ID, global.chats.listIds.archived, global.chats.orderedPinnedIds.archived),\n  );\n  const isSavedFolderChanged = Boolean(\n    global.chats.listIds.saved\n    && isMainFolderChanged(SAVED_FOLDER_ID, global.chats.listIds.saved, global.chats.orderedPinnedIds.saved),\n  );\n  const isAllFullyLoadedChanged = global.chats.isFullyLoaded.active !== prevGlobal.isAllFolderFullyLoaded;\n  const isArchivedFullyLoadedChanged = global.chats.isFullyLoaded.archived !== prevGlobal.isArchivedFolderFullyLoaded;\n  const isSavedFolderFullyLoadedChanged = global.chats.isFullyLoaded.saved !== prevGlobal.isSavedFolderFullyLoaded;\n\n  const areFoldersChanged = global.chatFolders.byId !== prevGlobal.foldersById;\n  const areChatsChanged = global.chats.byId !== prevGlobal.chatsById;\n  const areSavedLastMessageIdsChanged = global.chats.lastMessageIds.saved !== prevGlobal.lastSavedMessageIds;\n  const areAllLastMessageIdsChanged = global.chats.lastMessageIds.all !== prevGlobal.lastAllMessageIds;\n  const areTopicsChanged = global.chats.topicsInfoById !== prevGlobal.topicsInfoById;\n  const areUsersChanged = global.users.byId !== prevGlobal.usersById;\n  const areNotifyDefaultsChanged = selectNotifyDefaults(global) !== prevGlobal.notifyDefaults;\n  const areNotifyExceptionsChanged = global.chats.notifyExceptionById !== prevGlobal.notifyExceptions;\n\n  let affectedFolderIds: number[] = [];\n\n  if (isAllFullyLoadedChanged || isArchivedFullyLoadedChanged || isSavedFolderFullyLoadedChanged) {\n    affectedFolderIds = affectedFolderIds.concat(\n      updateFullyLoaded(global, isArchivedFullyLoadedChanged, isSavedFolderFullyLoadedChanged),\n    );\n  }\n\n  if (!(\n    isAllFolderChanged || isArchivedFolderChanged || isSavedFolderChanged || areFoldersChanged\n    || areChatsChanged || areUsersChanged || areTopicsChanged || areNotifyDefaultsChanged || areNotifyExceptionsChanged\n    || areSavedLastMessageIdsChanged || areAllLastMessageIdsChanged\n  )\n  ) {\n    if (affectedFolderIds.length) {\n      updateResults(affectedFolderIds);\n    }\n\n    return;\n  }\n\n  const prevAllFolderListIds = prevGlobal.allFolderListIds;\n  const prevArchivedFolderListIds = prevGlobal.archivedFolderListIds;\n  const prevSavedFolderListIds = prevGlobal.savedFolderListIds;\n\n  updateFolders(global, isAllFolderChanged, isArchivedFolderChanged, isSavedFolderChanged, areFoldersChanged);\n\n  affectedFolderIds = affectedFolderIds.concat(updateChats(\n    global,\n    areFoldersChanged || isAllFolderChanged || isArchivedFolderChanged || isSavedFolderChanged,\n    areNotifyDefaultsChanged,\n    areNotifyExceptionsChanged,\n    prevAllFolderListIds,\n    prevArchivedFolderListIds,\n    prevSavedFolderListIds,\n  ));\n\n  updateResults(unique(affectedFolderIds));\n\n  if (DEBUG) {\n    const duration = performance.now() - DEBUG_startedAt!;\n    if (duration > DEBUG_DURATION_LIMIT) {\n      // eslint-disable-next-line no-console\n      console.warn(`Slow \\`updateFolderManager\\`: ${Math.round(duration)} ms`);\n    }\n  }\n}\n\nfunction isMainFolderChanged(folderId: number, newListIds?: string[], newPinnedIds?: string[]) {\n  const currentListIds = folderId === ALL_FOLDER_ID\n    ? prevGlobal.allFolderListIds\n    : folderId === SAVED_FOLDER_ID\n      ? prevGlobal.savedFolderListIds : prevGlobal.archivedFolderListIds;\n  const currentPinnedIds = folderId === ALL_FOLDER_ID\n    ? prevGlobal.allFolderPinnedIds\n    : folderId === SAVED_FOLDER_ID\n      ? prevGlobal.savedFolderPinnedIds : prevGlobal.archivedFolderPinnedIds;\n\n  return currentListIds !== newListIds || currentPinnedIds !== newPinnedIds;\n}\n\nfunction updateFullyLoaded(\n  global: GlobalState,\n  isArchivedFullyLoadedChanged = false,\n  isSavedFolderFullyLoadedChanged = false,\n) {\n  let affectedFolderIds = [];\n\n  if (isArchivedFullyLoadedChanged) {\n    affectedFolderIds.push(ARCHIVED_FOLDER_ID);\n  }\n\n  if (isSavedFolderFullyLoadedChanged) {\n    affectedFolderIds.push(SAVED_FOLDER_ID);\n  }\n\n  const isAllFolderFullyLoaded = global.chats.isFullyLoaded.active;\n  const isArchivedFolderFullyLoaded = global.chats.isFullyLoaded.archived;\n  const isSavedFolderFullyLoaded = global.chats.isFullyLoaded.saved;\n\n  if (isAllFolderFullyLoaded && isArchivedFolderFullyLoaded) {\n    const emptyFolderIds = Object.keys(prepared.folderSummariesById)\n      .filter((folderId) => !results.orderedIdsByFolderId[folderId])\n      .map(Number);\n\n    affectedFolderIds = affectedFolderIds.concat(emptyFolderIds);\n  }\n\n  prevGlobal.isAllFolderFullyLoaded = isAllFolderFullyLoaded;\n  prevGlobal.isArchivedFolderFullyLoaded = isArchivedFolderFullyLoaded;\n  prevGlobal.isSavedFolderFullyLoaded = isSavedFolderFullyLoaded;\n\n  return affectedFolderIds;\n}\n\nfunction updateFolders(\n  global: GlobalState,\n  isAllFolderChanged: boolean,\n  isArchivedFolderChanged: boolean,\n  isSavedFolderChanged: boolean,\n  areFoldersChanged: boolean,\n) {\n  const changedFolders = [];\n\n  if (isAllFolderChanged) {\n    const newListIds = global.chats.listIds.active!;\n    const newPinnedIds = global.chats.orderedPinnedIds.active;\n\n    prepared.folderSummariesById[ALL_FOLDER_ID] = buildFolderSummaryFromMainList(\n      ALL_FOLDER_ID, newListIds, newPinnedIds,\n    );\n\n    prevGlobal.allFolderListIds = newListIds;\n    prevGlobal.allFolderPinnedIds = newPinnedIds;\n\n    changedFolders.push(ALL_FOLDER_ID);\n  }\n\n  if (isArchivedFolderChanged) {\n    const newListIds = global.chats.listIds.archived!;\n    const newPinnedIds = global.chats.orderedPinnedIds.archived;\n\n    prepared.folderSummariesById[ARCHIVED_FOLDER_ID] = buildFolderSummaryFromMainList(\n      ARCHIVED_FOLDER_ID, newListIds, newPinnedIds,\n    );\n\n    prevGlobal.archivedFolderListIds = newListIds;\n    prevGlobal.archivedFolderPinnedIds = newPinnedIds;\n\n    changedFolders.push(ARCHIVED_FOLDER_ID);\n  }\n\n  if (isSavedFolderChanged) {\n    const newListIds = global.chats.listIds.saved!;\n    const newPinnedIds = global.chats.orderedPinnedIds.saved;\n\n    prepared.folderSummariesById[SAVED_FOLDER_ID] = buildFolderSummaryFromMainList(\n      SAVED_FOLDER_ID, newListIds, newPinnedIds,\n    );\n\n    prevGlobal.savedFolderListIds = newListIds;\n    prevGlobal.savedFolderPinnedIds = newPinnedIds;\n\n    changedFolders.push(SAVED_FOLDER_ID);\n  }\n\n  if (areFoldersChanged) {\n    const newFoldersById = global.chatFolders.byId;\n\n    Object.values(newFoldersById).forEach((folder) => {\n      if (folder === prevGlobal.foldersById[folder.id]) {\n        return;\n      }\n\n      prepared.folderSummariesById[folder.id] = buildFolderSummary(folder);\n\n      changedFolders.push(folder.id);\n    });\n\n    prevGlobal.foldersById = newFoldersById;\n  }\n\n  return changedFolders;\n}\n\nfunction buildFolderSummaryFromMainList(\n  folderId: number, listIds: string[], orderedPinnedIds?: string[],\n): FolderSummary {\n  return {\n    id: folderId,\n    listIds: new Set(listIds),\n    orderedPinnedIds,\n    pinnedChatIds: new Set(orderedPinnedIds),\n  };\n}\n\nfunction buildFolderSummary(folder: ApiChatFolder): FolderSummary {\n  return {\n    ...folder,\n    orderedPinnedIds: folder.pinnedChatIds,\n    excludedChatIds: folder.excludedChatIds ? new Set(folder.excludedChatIds) : undefined,\n    includedChatIds: folder.excludedChatIds ? new Set(folder.includedChatIds) : undefined,\n    pinnedChatIds: folder.excludedChatIds ? new Set(folder.pinnedChatIds) : undefined,\n  };\n}\n\nfunction updateChats(\n  global: GlobalState,\n  areFoldersChanged: boolean,\n  areNotifyDefaultsChanged: boolean,\n  areNotifyExceptionsChanged: boolean,\n  prevAllFolderListIds?: string[],\n  prevArchivedFolderListIds?: string[],\n  prevSavedFolderListIds?: string[],\n) {\n  const newChatsById = global.chats.byId;\n  const newUsersById = global.users.byId;\n  const newAllLastMessageIds = global.chats.lastMessageIds.all;\n  const newSavedLastMessageIds = global.chats.lastMessageIds.saved;\n  const newNotifyDefaults = selectNotifyDefaults(global);\n  const newNotifyExceptions = global.chats.notifyExceptionById;\n  const folderSummaries = Object.values(prepared.folderSummariesById);\n  const affectedFolderIds = new Set<number>();\n\n  const newAllFolderListIds = global.chats.listIds.active;\n  const newArchivedFolderListIds = global.chats.listIds.archived;\n  const newSavedFolderListIds = global.chats.listIds.saved;\n\n  const newGeneralIds = [...newAllFolderListIds || [], ...newArchivedFolderListIds || []];\n  const newAllIds = [...newGeneralIds, ...newSavedFolderListIds || []];\n  let allIds = newAllIds;\n  if (newAllFolderListIds !== prevAllFolderListIds || newArchivedFolderListIds !== prevArchivedFolderListIds\n    || newSavedFolderListIds !== prevSavedFolderListIds) {\n    allIds = unique(allIds.concat(\n      prevAllFolderListIds || [], prevArchivedFolderListIds || [], prevSavedFolderListIds || [],\n    ));\n  }\n\n  allIds.forEach((chatId) => {\n    const chat = newChatsById[chatId];\n\n    if (\n      !areFoldersChanged\n      && !areNotifyDefaultsChanged\n      && !areNotifyExceptionsChanged\n      && chat === prevGlobal.chatsById[chatId]\n      && newUsersById[chatId] === prevGlobal.usersById[chatId]\n      && newAllLastMessageIds?.[chatId] === prevGlobal.lastAllMessageIds?.[chatId]\n      && newSavedLastMessageIds?.[chatId] === prevGlobal.lastSavedMessageIds?.[chatId]\n    ) {\n      return;\n    }\n\n    let newFolderIds: number[];\n    if (chat) {\n      const currentSummary = prepared.chatSummariesById.get(chatId);\n      const isRemovedFromAll = !newGeneralIds.includes(chatId);\n      const isRemovedFromSaved = !newSavedFolderListIds?.includes(chatId);\n      const newSummary = buildChatSummary(\n        global,\n        chat,\n        newNotifyDefaults,\n        newNotifyExceptions,\n        newUsersById[chatId],\n        isRemovedFromAll,\n        isRemovedFromSaved,\n      );\n\n      if (!areFoldersChanged && currentSummary && arePropsShallowEqual(newSummary, currentSummary)) {\n        return;\n      }\n\n      prepared.chatSummariesById.set(chatId, newSummary);\n\n      newFolderIds = buildChatFolderIds(newSummary, folderSummaries);\n      newFolderIds.forEach((folderId) => {\n        affectedFolderIds.add(folderId);\n      });\n    } else {\n      prepared.chatSummariesById.delete(chatId);\n      newFolderIds = [];\n    }\n\n    const currentFolderIds = prepared.folderIdsByChatId[chatId] || [];\n    if (areSortedArraysEqual(newFolderIds, currentFolderIds)) {\n      return;\n    }\n\n    const deletedFolderIds = updateListsForChat(chatId, currentFolderIds, newFolderIds);\n    deletedFolderIds.forEach((folderId) => {\n      affectedFolderIds.add(folderId);\n    });\n  });\n\n  prevGlobal.chatsById = newChatsById;\n  prevGlobal.usersById = newUsersById;\n  prevGlobal.lastAllMessageIds = newAllLastMessageIds;\n  prevGlobal.lastSavedMessageIds = newSavedLastMessageIds;\n  prevGlobal.notifyDefaults = newNotifyDefaults;\n  prevGlobal.notifyExceptions = newNotifyExceptions;\n\n  return Array.from(affectedFolderIds);\n}\n\nfunction buildChatSummary<T extends GlobalState>(\n  global: T,\n  chat: ApiChat,\n  notifyDefaults?: Record<ApiNotifyPeerType, ApiPeerNotifySettings>,\n  notifyExceptions?: Record<string, ApiPeerNotifySettings>,\n  user?: ApiUser,\n  isRemovedFromAll?: boolean,\n  isRemovedFromSaved?: boolean,\n): ChatSummary {\n  const {\n    id, type, isNotJoined, migratedTo, folderId,\n    unreadCount: chatUnreadCount, unreadMentionsCount: chatUnreadMentionsCount, hasUnreadMark,\n    isForum,\n  } = chat;\n  const isRestricted = selectIsChatRestricted(global, id);\n  const topics = selectTopics(global, chat.id);\n\n  const { unreadCount, unreadMentionsCount } = isForum\n    ? Object.values(topics || {}).reduce((acc, topic) => {\n      acc.unreadCount += topic.unreadCount;\n      acc.unreadMentionsCount += topic.unreadMentionsCount;\n\n      return acc;\n    }, { unreadCount: 0, unreadMentionsCount: 0 })\n    : { unreadCount: chatUnreadCount, unreadMentionsCount: chatUnreadMentionsCount };\n\n  const userInfo = type === 'chatTypePrivate' && user;\n  const lastMessage = selectChatLastMessage(global, chat.id);\n  const shouldHideServiceChat = chat.id === SERVICE_NOTIFICATIONS_USER_ID && (\n    !lastMessage || lastMessage.content.action?.type === 'historyClear'\n  );\n\n  const orderInAll = Math.max(chat.creationDate || 0, chat.draftDate || 0, lastMessage?.date || 0);\n\n  const lastMessageInSaved = selectChatLastMessage(global, chat.id, 'saved');\n  const orderInSaved = lastMessageInSaved?.date || 0;\n\n  return {\n    id,\n    type,\n    isListedInAll: Boolean(!isRestricted && !isNotJoined && !migratedTo && !shouldHideServiceChat && !isRemovedFromAll),\n    isListedInSaved: !isRemovedFromSaved,\n    isArchived: folderId === ARCHIVED_FOLDER_ID,\n    isMuted: getIsChatMuted(chat, notifyDefaults, notifyExceptions?.[chat.id]),\n    isUnread: Boolean(unreadCount || unreadMentionsCount || hasUnreadMark),\n    unreadCount,\n    unreadMentionsCount,\n    isUserBot: userInfo ? userInfo.type === 'userTypeBot' : undefined,\n    isUserContact: userInfo ? userInfo.isContact : undefined,\n    orderInAll,\n    orderInSaved,\n  };\n}\n\nfunction buildChatFolderIds(chatSummary: ChatSummary, folderSummaries: FolderSummary[]) {\n  return folderSummaries.reduce<number[]>((acc, folderSummary) => {\n    if (isChatInFolder(chatSummary, folderSummary)) {\n      acc.push(folderSummary.id);\n    }\n\n    return acc;\n  }, []).sort();\n}\n\nfunction isChatInFolder(\n  chatSummary: ChatSummary,\n  folderSummary: FolderSummary,\n) {\n  const isListed = folderSummary.id === SAVED_FOLDER_ID ? chatSummary.isListedInSaved : chatSummary.isListedInAll;\n  if (!isListed) {\n    return false;\n  }\n\n  const { id: chatId, type } = chatSummary;\n\n  if (folderSummary.listIds) {\n    if (\n      (chatSummary.isArchived && folderSummary.id === ALL_FOLDER_ID)\n      || (!chatSummary.isArchived && folderSummary.id === ARCHIVED_FOLDER_ID)\n    ) {\n      return false;\n    }\n\n    return folderSummary.listIds.has(chatId);\n  }\n\n  if (folderSummary.excludedChatIds?.has(chatId)) {\n    return false;\n  }\n\n  if (folderSummary.includedChatIds?.has(chatId)) {\n    return true;\n  }\n\n  if (folderSummary.pinnedChatIds?.has(chatId)) {\n    return true;\n  }\n\n  if (folderSummary.excludeArchived && chatSummary.isArchived) {\n    return false;\n  }\n\n  if (folderSummary.excludeRead && !chatSummary.isUnread) {\n    return false;\n  }\n\n  if (folderSummary.excludeMuted && chatSummary.isMuted && !chatSummary.unreadMentionsCount) {\n    return false;\n  }\n\n  if (type === 'chatTypePrivate') {\n    if (chatSummary.isUserBot) {\n      if (folderSummary.bots) {\n        return true;\n      }\n    } else {\n      if (folderSummary.contacts && chatSummary.isUserContact) {\n        return true;\n      }\n\n      if (folderSummary.nonContacts && !chatSummary.isUserContact) {\n        return true;\n      }\n    }\n  } else if (type === 'chatTypeChannel') {\n    return Boolean(folderSummary.channels);\n  } else if (type === 'chatTypeBasicGroup' || type === 'chatTypeSuperGroup') {\n    return Boolean(folderSummary.groups);\n  }\n\n  return false;\n}\n\nfunction updateListsForChat(chatId: string, currentFolderIds: number[], newFolderIds: number[]) {\n  const currentFolderIdsSet = new Set(currentFolderIds);\n  const newFolderIdsSet = new Set(newFolderIds);\n  const deletedFolderIds: number[] = [];\n\n  unique([...currentFolderIds, ...newFolderIds]).forEach((folderId) => {\n    let currentFolderOrderedIds = results.orderedIdsByFolderId[folderId];\n\n    if (currentFolderIdsSet.has(folderId) && !newFolderIdsSet.has(folderId)) {\n      prepared.chatIdsByFolderId[folderId]!.delete(chatId);\n\n      deletedFolderIds.push(folderId);\n\n      if (currentFolderOrderedIds) {\n        currentFolderOrderedIds = currentFolderOrderedIds.filter((id) => id !== chatId);\n        prepared.isOrderedListJustPatched[folderId] = true;\n      }\n    } else if (!currentFolderIdsSet.has(folderId) && newFolderIdsSet.has(folderId)) {\n      if (!prepared.chatIdsByFolderId[folderId]) {\n        prepared.chatIdsByFolderId[folderId] = new Set();\n      }\n\n      prepared.chatIdsByFolderId[folderId].add(chatId);\n\n      if (currentFolderOrderedIds) {\n        currentFolderOrderedIds.push(chatId);\n        prepared.isOrderedListJustPatched[folderId] = true;\n      }\n    }\n\n    results.orderedIdsByFolderId[folderId] = currentFolderOrderedIds;\n  });\n\n  prepared.folderIdsByChatId[chatId] = newFolderIds;\n\n  return deletedFolderIds;\n}\n\nfunction updateResults(affectedFolderIds: number[]) {\n  let wasUnreadCountersChanged = false;\n  let wasChatsCountChanged = false;\n  let wasUnreadChatsChanged = false;\n\n  Array.from(affectedFolderIds).forEach((folderId) => {\n    const { pinnedCount: newPinnedCount, orderedIds: newOrderedIds } = buildFolderOrderedIds(folderId);\n    // When signed out\n    if (!newOrderedIds) {\n      return;\n    }\n\n    const currentOrderedIds = results.orderedIdsByFolderId[folderId];\n    const currentPinnedCount = results.pinnedCountByFolderId[folderId];\n    const areOrderedIdsChanged = (\n      !currentOrderedIds\n      || currentPinnedCount === undefined || currentPinnedCount !== newPinnedCount\n      || prepared.isOrderedListJustPatched[folderId]\n      || !areSortedArraysEqual(newOrderedIds, currentOrderedIds)\n    );\n    if (areOrderedIdsChanged) {\n      prepared.isOrderedListJustPatched[folderId] = false;\n      results.orderedIdsByFolderId[folderId] = newOrderedIds;\n      results.pinnedCountByFolderId[folderId] = newPinnedCount;\n      callbacks.orderedIdsByFolderId[folderId]?.runCallbacks(newOrderedIds);\n    }\n\n    const currentChatsCount = results.chatsCountByFolderId[folderId];\n    const newChatsCount = newOrderedIds.length;\n    if (!wasChatsCountChanged) {\n      wasChatsCountChanged = currentChatsCount !== newChatsCount;\n    }\n    results.chatsCountByFolderId[folderId] = newChatsCount;\n\n    const currentUnreadCounters = results.unreadCountersByFolderId[folderId];\n    const newUnreadCounters = buildFolderUnreadCounters(folderId);\n    if (!wasUnreadCountersChanged) {\n      wasUnreadCountersChanged = (\n        !currentUnreadCounters || !arePropsShallowEqual(newUnreadCounters, currentUnreadCounters)\n      );\n    }\n    results.unreadCountersByFolderId[folderId] = newUnreadCounters;\n\n    const currentUnreadChats = results.unreadChatIdsByFolderId[folderId];\n    const newUnreadChats = buildFolderByUnreadChats(folderId);\n    if (!wasUnreadChatsChanged) {\n      wasUnreadChatsChanged = (\n        !currentUnreadChats || !areSortedArraysEqual(newUnreadChats, currentUnreadChats)\n      );\n    }\n    results.unreadChatIdsByFolderId[folderId] = newUnreadChats;\n  });\n\n  if (wasChatsCountChanged) {\n    // We need to update the entire object as it will be returned from a hook\n    const newValue = { ...results.chatsCountByFolderId };\n    results.chatsCountByFolderId = newValue;\n    callbacks.chatsCountByFolderId.runCallbacks(newValue);\n  }\n\n  if (wasUnreadCountersChanged) {\n    // We need to update the entire object as it will be returned from a hook\n    const newValue = { ...results.unreadCountersByFolderId };\n    results.unreadCountersByFolderId = newValue;\n    callbacks.unreadCountersByFolderId.runCallbacks(newValue);\n  }\n\n  if (wasUnreadChatsChanged) {\n    callbacks.unreadChatIdsByFolderId.runCallbacks(results.unreadChatIdsByFolderId);\n  }\n}\n\nfunction buildFolderOrderedIds(folderId: number) {\n  const folderSummary = prepared.folderSummariesById[folderId];\n  if (!folderSummary) {\n    return {};\n  }\n\n  const { orderedPinnedIds, pinnedChatIds } = folderSummary;\n  const {\n    chatIdsByFolderId: { [folderId]: chatIds },\n  } = prepared;\n  const {\n    orderedIdsByFolderId: { [folderId]: prevOrderedIds },\n  } = results;\n\n  const isSavedFolder = folderId === SAVED_FOLDER_ID;\n\n  const sortedPinnedIds = chatIds ? orderedPinnedIds?.filter((id) => chatIds.has(id)) : orderedPinnedIds;\n  const allListIds = prevOrderedIds || (chatIds && Array.from(chatIds)) || [];\n  const notPinnedIds = pinnedChatIds ? allListIds.filter((id) => !pinnedChatIds.has(id)) : allListIds;\n  const sortedNotPinnedIds = notPinnedIds.sort((chatId1: string, chatId2: string) => {\n    return getOrderKey(chatId2, isSavedFolder) - getOrderKey(chatId1, isSavedFolder);\n  });\n\n  return {\n    pinnedCount: sortedPinnedIds?.length || 0,\n    orderedIds: [\n      ...(sortedPinnedIds || []),\n      ...sortedNotPinnedIds,\n    ],\n  };\n}\n\nfunction buildFolderUnreadCounters(folderId: number) {\n  const {\n    chatSummariesById,\n  } = prepared;\n  const {\n    orderedIdsByFolderId: { [folderId]: orderedIds },\n  } = results;\n\n  return orderedIds!.reduce((newUnreadCounters, chatId) => {\n    const chatSummary = chatSummariesById.get(chatId);\n    if (!chatSummary) {\n      return newUnreadCounters;\n    }\n\n    if (chatSummary.isUnread) {\n      newUnreadCounters.chatsCount++;\n\n      if (chatSummary.unreadMentionsCount) {\n        newUnreadCounters.notificationsCount += chatSummary.unreadMentionsCount;\n      }\n\n      if (!chatSummary.isMuted) {\n        if (chatSummary.unreadCount) {\n          newUnreadCounters.notificationsCount += chatSummary.unreadCount;\n        } else if (!chatSummary.unreadMentionsCount) {\n          newUnreadCounters.notificationsCount += 1; // Manually marked unread\n        }\n      }\n    }\n\n    return newUnreadCounters;\n  }, {\n    chatsCount: 0,\n    notificationsCount: 0,\n  });\n}\n\nfunction buildFolderByUnreadChats(folderId: number) {\n  const { chatSummariesById } = prepared;\n  const { orderedIdsByFolderId: { [folderId]: orderedIds } } = results;\n\n  return orderedIds!.filter((chatId) => {\n    const chatSummary = chatSummariesById.get(chatId);\n    return chatSummary?.isUnread;\n  });\n}\n\nfunction buildInitials() {\n  return {\n    prevGlobal: {\n      foldersById: {},\n      chatsById: {},\n      usersById: {},\n      topicsInfoById: {},\n    },\n\n    prepared: {\n      folderSummariesById: {},\n      chatSummariesById: new Map(),\n      folderIdsByChatId: {},\n      chatIdsByFolderId: {},\n      isOrderedListJustPatched: {},\n    },\n\n    results: {\n      orderedIdsByFolderId: {},\n      pinnedCountByFolderId: {},\n      chatsCountByFolderId: {},\n      unreadCountersByFolderId: {},\n      unreadChatIdsByFolderId: {},\n    },\n\n    callbacks: {\n      orderedIdsByFolderId: {},\n      chatsCountByFolderId: createCallbackManager(),\n      unreadCountersByFolderId: createCallbackManager(),\n      unreadChatIdsByFolderId: createCallbackManager(),\n    },\n  };\n}\n\nfunction reset() {\n  const newInitials = buildInitials();\n\n  prevGlobal = newInitials.prevGlobal;\n  prepared = newInitials.prepared;\n  results = newInitials.results;\n  callbacks = newInitials.callbacks;\n}\n","import { DEBUG_MORE } from '../config';\nimport { handleError } from './handleError';\n\nconst SAFE_EXEC_ENABLED = !DEBUG_MORE;\n\ntype SafeExecOptions = {\n  rescue?: (err: Error) => void;\n  always?: NoneToVoidFunction;\n  shouldIgnoreError?: boolean;\n};\n\nexport default function safeExec<T extends AnyFunction>(cb: T, options?: SafeExecOptions): ReturnType<T> | undefined {\n  if (!SAFE_EXEC_ENABLED) {\n    return cb();\n  }\n\n  const { rescue, always, shouldIgnoreError } = options ?? {};\n\n  try {\n    return cb();\n  } catch (err: any) {\n    rescue?.(err);\n    if (!shouldIgnoreError) {\n      handleError(err);\n    }\n    return undefined;\n  } finally {\n    always?.();\n  }\n}\n","import { IS_IOS, IS_WINDOWS } from './browser/windowEnvironment';\nimport { Lethargy } from './lethargy';\nimport { clamp, round } from './math';\nimport { debounce } from './schedulers';\nimport windowSize from './windowSize';\n\nexport enum SwipeDirection {\n  Up,\n  Down,\n  Left,\n  Right,\n}\n\nexport interface MoveOffsets {\n  dragOffsetX: number;\n  dragOffsetY: number;\n}\n\ninterface CaptureOptions {\n  onCapture?: (e: MouseEvent | TouchEvent | WheelEvent) => void;\n  onRelease?: (e: MouseEvent | TouchEvent | WheelEvent) => void;\n  onDrag?: (\n    e: MouseEvent | TouchEvent | WheelEvent,\n    captureEvent: MouseEvent | TouchEvent | WheelEvent,\n    offsets: MoveOffsets,\n    cancelDrag?: (x: boolean, y: boolean) => void,\n  ) => void;\n  onSwipe?: (e: Event, direction: SwipeDirection, offsets: MoveOffsets) => boolean;\n  onZoom?: (e: TouchEvent | WheelEvent, params: {\n    // Absolute zoom level\n    zoom?: number;\n    // Relative zoom factor\n    zoomFactor?: number;\n\n    // center coordinate of the initial pinch\n    initialCenterX: number;\n    initialCenterY: number;\n\n    // offset of the pinch center (current from initial)\n    dragOffsetX: number;\n    dragOffsetY: number;\n\n    // center coordinate of the current pinch\n    currentCenterX: number;\n    currentCenterY: number;\n  }) => void;\n  onClick?: (e: MouseEvent | TouchEvent) => void;\n  onDoubleClick?: (e: MouseEvent | RealTouchEvent | WheelEvent, params: { centerX: number; centerY: number }) => void;\n  excludedClosestSelector?: string;\n  includedClosestSelector?: string;\n  selectorToPreventScroll?: string;\n  withNativeDrag?: boolean;\n  maxZoom?: number;\n  minZoom?: number;\n  doubleTapZoom?: number;\n  initialZoom?: number;\n  isNotPassive?: boolean;\n  withCursor?: boolean;\n  swipeThreshold?: number;\n  withWheelDrag?: boolean;\n}\n\n// https://stackoverflow.com/questions/11287877/how-can-i-get-e-offsetx-on-mobile-ipad\n// Android does not have this value, and iOS has it but as read-only\nexport interface RealTouchEvent extends TouchEvent {\n  pageX?: number;\n  pageY?: number;\n}\n\ntype TSwipeAxis =\n  'x'\n  | 'y'\n  | undefined;\n\nexport const IOS_SCREEN_EDGE_THRESHOLD = 20;\nexport const SWIPE_DIRECTION_THRESHOLD = 10;\nexport const SWIPE_DIRECTION_TOLERANCE = 1.5;\n\nconst MOVE_THRESHOLD = 15;\nconst SWIPE_THRESHOLD_DEFAULT = 20;\nconst RELEASE_WHEEL_ZOOM_DELAY = 150;\nconst RELEASE_WHEEL_DRAG_DELAY = 150;\n\nfunction getDistance(a: Touch, b?: Touch) {\n  if (!b) return 0;\n  return Math.hypot((b.pageX - a.pageX), (b.pageY - a.pageY));\n}\n\nfunction getTouchCenter(a: Touch, b: Touch) {\n  return {\n    x: (a.pageX + b.pageX) / 2,\n    y: (a.pageY + b.pageY) / 2,\n  };\n}\n\nlet lastClickTime = 0;\nconst lethargy = new Lethargy({\n  stability: 5,\n  sensitivity: 25,\n  tolerance: IS_WINDOWS ? 1 : 0.6, // Windows `scrollDelta` does not die down to 0\n  delay: 150,\n});\n\nexport function captureEvents(element: HTMLElement, options: CaptureOptions) {\n  let captureEvent: MouseEvent | RealTouchEvent | WheelEvent | undefined;\n  let hasMoved = false;\n  let hasSwiped = false;\n  let isZooming = false;\n  let initialDistance = 0;\n  let wheelZoom = options.initialZoom ?? 1;\n  let initialDragOffset = {\n    x: 0,\n    y: 0,\n  };\n  let isDragCanceled = {\n    x: false,\n    y: false,\n  };\n  const currentWindowSize = windowSize.get();\n  let initialTouchCenter = {\n    x: currentWindowSize.width / 2,\n    y: currentWindowSize.height / 2,\n  };\n  let initialSwipeAxis: TSwipeAxis | undefined;\n  const minZoom = options.minZoom ?? 1;\n  const maxZoom = options.maxZoom ?? 4;\n\n  let isNearEdge = false;\n\n  function onCapture(e: MouseEvent | RealTouchEvent) {\n    const target = e.target as HTMLElement;\n    const {\n      excludedClosestSelector,\n      includedClosestSelector,\n      withNativeDrag,\n      withCursor,\n      onDrag,\n    } = options;\n\n    if (element !== target && !element.contains(target)) {\n      return;\n    }\n\n    if (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA') {\n      return;\n    }\n\n    if (\n      (excludedClosestSelector && (target.matches(excludedClosestSelector) || target.closest(excludedClosestSelector)))\n      || (\n        includedClosestSelector && !(target.matches(includedClosestSelector) || target.closest(includedClosestSelector))\n      )\n    ) {\n      return;\n    }\n\n    captureEvent = e;\n\n    if (e.type === 'mousedown') {\n      if (!withNativeDrag && onDrag) {\n        e.preventDefault();\n      }\n\n      document.addEventListener('mousemove', onMove);\n      document.addEventListener('mouseup', onRelease);\n    } else if (e.type === 'touchstart') {\n      if (IS_IOS) {\n        const x = (e as RealTouchEvent).touches[0].pageX;\n        isNearEdge = x <= IOS_SCREEN_EDGE_THRESHOLD || x >= windowSize.get().width - IOS_SCREEN_EDGE_THRESHOLD;\n      }\n\n      // We need to always listen on `touchstart` target:\n      // https://stackoverflow.com/questions/33298828/touch-move-event-dont-fire-after-touch-start-target-is-removed\n      target.addEventListener('touchmove', onMove, { passive: true });\n      target.addEventListener('touchend', onRelease, { passive: true });\n      target.addEventListener('touchcancel', onRelease, { passive: true });\n\n      if ('touches' in e) {\n        if (e.pageX === undefined) {\n          e.pageX = e.touches[0].pageX;\n        }\n\n        if (e.pageY === undefined) {\n          e.pageY = e.touches[0].pageY;\n        }\n\n        if (e.touches.length === 2) {\n          initialDistance = getDistance(e.touches[0], e.touches[1]);\n          initialTouchCenter = getTouchCenter(e.touches[0], e.touches[1]);\n        }\n      }\n    }\n\n    if (withCursor) {\n      document.body.classList.add('cursor-grabbing');\n    }\n\n    options.onCapture?.(e);\n  }\n\n  function onRelease(e?: MouseEvent | TouchEvent) {\n    if (captureEvent) {\n      if (options.withCursor) {\n        document.body.classList.remove('cursor-grabbing');\n      }\n\n      document.removeEventListener('mouseup', onRelease);\n      document.removeEventListener('mousemove', onMove);\n      (captureEvent.target as HTMLElement).removeEventListener('touchcancel', onRelease);\n      (captureEvent.target as HTMLElement).removeEventListener('touchend', onRelease);\n      (captureEvent.target as HTMLElement).removeEventListener('touchmove', onMove);\n\n      if (IS_IOS && options.selectorToPreventScroll) {\n        Array.from(document.querySelectorAll<HTMLElement>(options.selectorToPreventScroll))\n          .forEach((scrollable) => {\n            scrollable.style.overflow = '';\n          });\n      }\n\n      if (e) {\n        if (hasMoved) {\n          if (options.onRelease) {\n            options.onRelease(e);\n          }\n        } else if (e.type === 'mouseup') {\n          if (options.onDoubleClick && Date.now() - lastClickTime < 300) {\n            options.onDoubleClick(e, {\n              centerX: captureEvent.pageX!,\n              centerY: captureEvent.pageY!,\n            });\n          } else if (options.onClick && (!('button' in e) || e.button === 0)) {\n            options.onClick(e);\n          }\n          lastClickTime = Date.now();\n        }\n      }\n    }\n\n    hasMoved = false;\n    hasSwiped = false;\n    isZooming = false;\n    initialDistance = 0;\n    wheelZoom = clamp(wheelZoom, minZoom, maxZoom);\n    initialSwipeAxis = undefined;\n    initialDragOffset = {\n      x: 0,\n      y: 0,\n    };\n    isDragCanceled = {\n      x: false,\n      y: false,\n    };\n    const newWindowSize = windowSize.get();\n    initialTouchCenter = {\n      x: newWindowSize.width / 2,\n      y: newWindowSize.height / 2,\n    };\n    captureEvent = undefined;\n    isNearEdge = false;\n  }\n\n  function onMove(e: MouseEvent | RealTouchEvent) {\n    if (captureEvent) {\n      if (e.type === 'touchmove' && ('touches' in e)) {\n        if (e.pageX === undefined) {\n          e.pageX = e.touches[0].pageX;\n        }\n\n        if (e.pageY === undefined) {\n          e.pageY = e.touches[0].pageY;\n        }\n\n        if (options.onZoom && initialDistance > 0 && e.touches.length === 2) {\n          const endDistance = getDistance(e.touches[0], e.touches[1]);\n          const touchCenter = getTouchCenter(e.touches[0], e.touches[1]);\n          const dragOffsetX = touchCenter.x - initialTouchCenter.x;\n          const dragOffsetY = touchCenter.y - initialTouchCenter.y;\n          const zoomFactor = endDistance / initialDistance;\n          options.onZoom(e, {\n            zoomFactor,\n            initialCenterX: initialTouchCenter.x,\n            initialCenterY: initialTouchCenter.y,\n            dragOffsetX,\n            dragOffsetY,\n            currentCenterX: touchCenter.x,\n            currentCenterY: touchCenter.y,\n          });\n          if (zoomFactor !== 1) hasMoved = true;\n        }\n      }\n\n      const dragOffsetX = e.pageX! - captureEvent.pageX!;\n      const dragOffsetY = e.pageY! - captureEvent.pageY!;\n\n      if (Math.abs(dragOffsetX) >= MOVE_THRESHOLD || Math.abs(dragOffsetY) >= MOVE_THRESHOLD) {\n        hasMoved = true;\n      }\n\n      let shouldPreventScroll = false;\n\n      if (options.onDrag) {\n        options.onDrag(e, captureEvent, {\n          dragOffsetX,\n          dragOffsetY,\n        });\n        shouldPreventScroll = true;\n      }\n\n      if (options.onSwipe && !hasSwiped) {\n        hasSwiped = onSwipe(e, dragOffsetX, dragOffsetY);\n        shouldPreventScroll = hasSwiped;\n      }\n\n      if (IS_IOS && shouldPreventScroll && options.selectorToPreventScroll) {\n        Array.from(document.querySelectorAll<HTMLElement>(options.selectorToPreventScroll))\n          .forEach((scrollable) => {\n            scrollable.style.overflow = 'hidden';\n          });\n      }\n    }\n  }\n\n  function onSwipe(e: MouseEvent | RealTouchEvent, dragOffsetX: number, dragOffsetY: number) {\n    if (IS_IOS && isNearEdge) {\n      return false;\n    }\n\n    const xAbs = Math.abs(dragOffsetX);\n    const yAbs = Math.abs(dragOffsetY);\n    const threshold = options.swipeThreshold ?? SWIPE_THRESHOLD_DEFAULT;\n\n    let axis: TSwipeAxis | undefined;\n    if (xAbs > yAbs && xAbs >= threshold) {\n      axis = 'x';\n    } else if (yAbs > xAbs && yAbs >= threshold) {\n      axis = 'y';\n    }\n\n    if (!axis) {\n      return false;\n    }\n\n    if (!initialSwipeAxis) {\n      initialSwipeAxis = axis;\n    } else if (initialSwipeAxis !== axis) {\n      // Prevent horizontal swipe after vertical to prioritize scroll\n      return false;\n    }\n\n    return processSwipe(e, axis, dragOffsetX, dragOffsetY, options.onSwipe!);\n  }\n\n  const releaseWheelDrag = debounce(onRelease, RELEASE_WHEEL_DRAG_DELAY, false);\n  const releaseWheelZoom = debounce(onRelease, RELEASE_WHEEL_ZOOM_DELAY, false);\n\n  function onWheelCapture(e: WheelEvent) {\n    if (hasMoved) return;\n    onCapture(e);\n    hasMoved = true;\n    initialTouchCenter = { x: e.x, y: e.y };\n  }\n\n  function onWheelZoom(e: WheelEvent) {\n    if (!options.onZoom) return;\n    onWheelCapture(e);\n    const dragOffsetX = e.x - initialTouchCenter.x;\n    const dragOffsetY = e.y - initialTouchCenter.y;\n    const delta = clamp(e.deltaY, -25, 25);\n    wheelZoom -= delta * 0.01;\n    wheelZoom = clamp(wheelZoom, minZoom * 0.5, maxZoom * 3);\n    isZooming = true;\n    options.onZoom(e, {\n      zoom: round(wheelZoom, 2),\n      initialCenterX: initialTouchCenter.x,\n      initialCenterY: initialTouchCenter.y,\n      dragOffsetX,\n      dragOffsetY,\n      currentCenterX: e.x,\n      currentCenterY: e.y,\n    });\n    releaseWheelZoom(e);\n  }\n\n  function onWheelDrag(e: WheelEvent) {\n    if (!options.onDrag) return;\n    onWheelCapture(e);\n    // Ignore wheel inertia if drag is canceled in this direction\n    if (!isDragCanceled.x || Math.sign(initialDragOffset.x) === Math.sign(e.deltaX)) {\n      initialDragOffset.x -= e.deltaX;\n    }\n    if (!isDragCanceled.y || Math.sign(initialDragOffset.y) === Math.sign(e.deltaY)) {\n      initialDragOffset.y -= e.deltaY;\n    }\n    const { x, y } = initialDragOffset;\n    options.onDrag(e, captureEvent!, {\n      dragOffsetX: x,\n      dragOffsetY: y,\n    }, (dx, dy) => {\n      isDragCanceled = { x: dx, y: dy };\n    });\n    releaseWheelDrag(e);\n  }\n\n  function onWheel(e: WheelEvent) {\n    if (!options.onZoom && !options.onDrag) return;\n    if (options.excludedClosestSelector && (\n      (e.target as HTMLElement).matches(options.excludedClosestSelector)\n      || (e.target as HTMLElement).closest(options.excludedClosestSelector)\n    )) {\n      return;\n    }\n    e.preventDefault();\n    e.stopPropagation();\n    const { doubleTapZoom = 3 } = options;\n    if (options.onDoubleClick && Object.is(e.deltaX, -0) && Object.is(e.deltaY, -0) && e.ctrlKey) {\n      onWheelCapture(e);\n      wheelZoom = wheelZoom > 1 ? 1 : doubleTapZoom;\n      options.onDoubleClick(e, { centerX: e.pageX, centerY: e.pageY });\n      hasMoved = false;\n      return;\n    }\n    const metaKeyPressed = e.metaKey || e.ctrlKey || e.shiftKey;\n    if (metaKeyPressed) {\n      onWheelZoom(e);\n    }\n    if (!metaKeyPressed && !isZooming) {\n      // Check if this event produced by user scroll and not by inertia\n      const isUserEvent = lethargy.check(e);\n      if (wheelZoom !== 1 || isUserEvent) {\n        onWheelDrag(e);\n      }\n    }\n  }\n\n  if (options.withWheelDrag) {\n    element.addEventListener('wheel', onWheel);\n  }\n\n  element.addEventListener('mousedown', onCapture);\n  document.body.addEventListener('touchstart', onCapture, { passive: !options.isNotPassive });\n\n  return () => {\n    onRelease();\n    document.body.removeEventListener('touchstart', onCapture);\n    element.removeEventListener('mousedown', onCapture);\n    element.removeEventListener('wheel', onWheel);\n  };\n}\n\nfunction processSwipe(\n  e: Event,\n  currentSwipeAxis: TSwipeAxis,\n  dragOffsetX: number,\n  dragOffsetY: number,\n  onSwipe: (e: Event, direction: SwipeDirection, offsets: MoveOffsets) => boolean,\n) {\n  const offsets = { dragOffsetX, dragOffsetY };\n\n  if (currentSwipeAxis === 'x') {\n    if (dragOffsetX < 0) {\n      return onSwipe(e, SwipeDirection.Left, offsets);\n    } else {\n      return onSwipe(e, SwipeDirection.Right, offsets);\n    }\n  } else if (currentSwipeAxis === 'y') {\n    if (dragOffsetY < 0) {\n      return onSwipe(e, SwipeDirection.Up, offsets);\n    } else {\n      return onSwipe(e, SwipeDirection.Down, offsets);\n    }\n  }\n\n  return false;\n}\n","/**\n * Lethargy help distinguish between scroll events initiated by the user, and those by inertial scrolling.\n * Lethargy does not have external dependencies.\n *\n * @param stability - Specifies the length of the rolling average.\n * In effect, the larger the value, the smoother the curve will be.\n * This attempts to prevent anomalies from firing 'real' events. Valid values are all positive integers,\n * but in most cases, you would need to stay between 5 and around 30.\n *\n * @param sensitivity - Specifies the minimum value for wheelDelta for it to register as a valid scroll event.\n * Because the tail of the curve have low wheelDelta values,\n * this will stop them from registering as valid scroll events.\n * The unofficial standard wheelDelta is 120, so valid values are positive integers below 120.\n *\n * @param tolerance - Prevent small fluctuations from affecting results.\n * Valid values are decimals from 0, but should ideally be between 0.05 and 0.3.\n *\n * Based on https://github.com/d4nyll/lethargy\n */\n\nexport type LethargyConfig = {\n  stability?: number;\n  sensitivity?: number;\n  tolerance?: number;\n  delay?: number;\n};\n\nexport class Lethargy {\n  stability: number;\n\n  sensitivity: number;\n\n  tolerance: number;\n\n  delay: number;\n\n  lastUpDeltas: Array<number>;\n\n  lastDownDeltas: Array<number>;\n\n  deltasTimestamp: Array<number>;\n\n  constructor({\n    stability = 8,\n    sensitivity = 100,\n    tolerance = 1.1,\n    delay = 150,\n  }: LethargyConfig = {}) {\n    this.stability = stability;\n    this.sensitivity = sensitivity;\n    this.tolerance = tolerance;\n    this.delay = delay;\n    this.lastUpDeltas = new Array(this.stability * 2).fill(0);\n    this.lastDownDeltas = new Array(this.stability * 2).fill(0);\n    this.deltasTimestamp = new Array(this.stability * 2).fill(0);\n  }\n\n  check(e: any) {\n    let lastDelta;\n    e = e.originalEvent || e;\n    if (e.wheelDelta !== undefined) {\n      lastDelta = e.wheelDelta;\n    } else if (e.deltaY !== undefined) {\n      lastDelta = e.deltaY * -40;\n    } else if (e.detail !== undefined || e.detail === 0) {\n      lastDelta = e.detail * -40;\n    }\n    this.deltasTimestamp.push(Date.now());\n    this.deltasTimestamp.shift();\n    if (lastDelta > 0) {\n      this.lastUpDeltas.push(lastDelta);\n      this.lastUpDeltas.shift();\n      return this.isInertia(1);\n    } else {\n      this.lastDownDeltas.push(lastDelta);\n      this.lastDownDeltas.shift();\n      return this.isInertia(-1);\n    }\n  }\n\n  isInertia(direction: number) {\n    const lastDeltas = direction === -1 ? this.lastDownDeltas : this.lastUpDeltas;\n    if (lastDeltas[0] === undefined) return direction;\n    if (\n      this.deltasTimestamp[this.stability * 2 - 2] + this.delay > Date.now()\n      && lastDeltas[0] === lastDeltas[this.stability * 2 - 1]\n    ) {\n      return false;\n    }\n    const lastDeltasOld = lastDeltas.slice(0, this.stability);\n    const lastDeltasNew = lastDeltas.slice(this.stability, this.stability * 2);\n    const oldSum = lastDeltasOld.reduce((t, s) => t + s);\n    const newSum = lastDeltasNew.reduce((t, s) => t + s);\n    const oldAverage = oldSum / lastDeltasOld.length;\n    const newAverage = newSum / lastDeltasNew.length;\n    return Math.abs(oldAverage) <= Math.abs(newAverage * this.tolerance)\n      && this.sensitivity < Math.abs(newAverage);\n  }\n}\n","import { useRef, useState } from '../lib/teact/teact';\n\nimport buildClassName from '../util/buildClassName';\n\nconst CLOSE_DURATION = 350;\n\nconst useShowTransitionDeprecated = (\n  isOpen = false,\n  onCloseTransitionEnd?: () => void,\n  noFirstOpenTransition = false,\n  className: string | false = 'fast',\n  noCloseTransition = false,\n  closeDuration = CLOSE_DURATION,\n  noOpenTransition = false,\n) => {\n  const [isClosed, setIsClosed] = useState(!isOpen);\n  const closeTimeoutRef = useRef<number>();\n  // SS class should be added in a separate tick to turn on CSS transition.\n  const [hasOpenClassName, setHasOpenClassName] = useState(isOpen && noFirstOpenTransition);\n\n  if (isOpen) {\n    setIsClosed(false);\n    setHasOpenClassName(true);\n\n    if (closeTimeoutRef.current) {\n      window.clearTimeout(closeTimeoutRef.current);\n\n      closeTimeoutRef.current = undefined;\n    }\n  } else {\n    setHasOpenClassName(false);\n\n    if (!isClosed && !closeTimeoutRef.current) {\n      const exec = () => {\n        setIsClosed(true);\n\n        if (onCloseTransitionEnd) {\n          onCloseTransitionEnd();\n        }\n\n        closeTimeoutRef.current = undefined;\n      };\n\n      if (noCloseTransition) {\n        exec();\n      } else {\n        closeTimeoutRef.current = window.setTimeout(exec, closeDuration);\n      }\n    }\n  }\n\n  // `noCloseTransition`, when set to true, should remove the open class immediately\n  const shouldHaveOpenClassName = (hasOpenClassName && !(noCloseTransition && !isOpen)) || (noOpenTransition && isOpen);\n  const isClosing = Boolean(closeTimeoutRef.current);\n  const shouldRender = isOpen || isClosing;\n  const transitionClassNames = buildClassName(\n    className && 'opacity-transition',\n    className,\n    shouldHaveOpenClassName && 'open',\n    !shouldHaveOpenClassName && 'not-open',\n    shouldRender && 'shown',\n    !shouldRender && 'not-shown',\n    isClosing && 'closing',\n  );\n\n  return {\n    shouldRender,\n    transitionClassNames,\n    hasShownClass: shouldRender,\n    hasOpenClass: shouldHaveOpenClassName,\n    isClosing,\n  };\n};\n\nexport default useShowTransitionDeprecated;\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"W4ndaFuS\",\"contentBox\":\"qIESjPFU\",\"textContent\":\"cgQoy2xy\",\"hasFullContent\":\"x0D811xX\",\"inlineWrapper\":\"CrZTrncJ\",\"singleLine\":\"j1bGIpWD\",\"strong\":\"d5ep97lr\",\"messageLink\":\"Soqky8rY\",\"noEllipsis\":\"m6kJl7zG\",\"contextContainer\":\"Rz1leKMF\",\"fluidMultiline\":\"oL3NoM4Y\",\"fluidBackground\":\"faqkTF52\",\"info\":\"Jcta1qBG\",\"stickerWrapper\":\"F8w9vDlr\",\"channelPhoto\":\"wnjg6GZj\",\"suggestedAvatar\":\"ClHX4zX1\",\"suggestedText\":\"jT6o01vL\",\"actionButton\":\"LB5i9s3a\",\"title\":\"Cp_BJqe5\",\"subtitle\":\"VCJyqpS8\",\"starGift\":\"lcncBNHa\",\"uniqueGift\":\"jxcv_A2w\",\"uniqueBackgroundWrapper\":\"lsTgPDw1\",\"uniqueBackground\":\"uzTnIOE7\",\"uniqueValue\":\"pae10ItJ\",\"suggestedPostContainer\":\"eNm2vJJr\",\"suggestedPostTitle\":\"mp_JlS2o\",\"suggestedPostInfo\":\"S5yKhYOF\",\"suggestedPostBalanceTooLowBox\":\"lYK4izyG\",\"suggestedPostRejectedContentBox\":\"b_UHz9Pn\",\"suggestedPostContentBox\":\"HiG8V3U2\",\"hoverable\":\"Ohq5zfvI\",\"suggestedPostBalanceTooLowTitle\":\"v8H6hMhz\",\"suggestedPostApprovalTitle\":\"sx65zyR6\",\"suggestedPostApprovalSection\":\"jmVfnkV0\",\"suggestedPostRejectedComment\":\"hrUNI578\",\"suggestedPostRejectedTitle\":\"xm2OfRXs\",\"rejectedIcon\":\"PnwAfQgJ\"};","import { addExtraClass } from '../../lib/teact/teact-dom';\n\nimport { requestMutation } from '../../lib/fasterdom/fasterdom';\nimport { removeVS16s } from '../../lib/twemojiRegex';\nimport withCache from '../withCache';\n\n// Due to the fact that emoji from Apple do not contain some characters, it is necessary to remove them from emoji-data\n// https://github.com/iamcal/emoji-data/issues/136\nconst EXCLUDE_EMOJIS = ['female_sign', 'male_sign', 'medical_symbol'];\n\nconst ISO_FLAGS_OFFSET = 127397;\n\nexport type EmojiRawData = typeof import('emoji-data-ios/emoji-data.json');\nexport type EmojiModule = { default: EmojiRawData };\n\nexport type EmojiData = {\n  categories: Array<EmojiCategory>;\n  emojis: Record<string, Emoji>;\n};\n\nfunction unifiedToNative(unified: string) {\n  const unicodes = unified.split('-');\n  const codePoints = unicodes.map((i) => parseInt(i, 16));\n\n  return String.fromCodePoint(...codePoints);\n}\n\nexport const LOADED_EMOJIS = new Set<string>();\n\nexport function handleEmojiLoad(event: React.SyntheticEvent<HTMLImageElement>) {\n  const emoji = event.currentTarget;\n\n  LOADED_EMOJIS.add(event.currentTarget.dataset.path!);\n\n  requestMutation(() => {\n    addExtraClass(emoji, 'open');\n  });\n}\n\nexport function nativeToUnified(emoji: string) {\n  let code;\n\n  if (emoji.length === 1) {\n    code = emoji.charCodeAt(0).toString(16).padStart(4, '0');\n  } else {\n    const pairs = [];\n    for (let i = 0; i < emoji.length; i++) {\n      if (emoji.charCodeAt(i) >= 0xd800 && emoji.charCodeAt(i) <= 0xdbff) {\n        if (emoji.charCodeAt(i + 1) >= 0xdc00 && emoji.charCodeAt(i + 1) <= 0xdfff) {\n          pairs.push(\n            (emoji.charCodeAt(i) - 0xd800) * 0x400\n            + (emoji.charCodeAt(i + 1) - 0xdc00) + 0x10000,\n          );\n        }\n      } else if (emoji.charCodeAt(i) < 0xd800 || emoji.charCodeAt(i) > 0xdfff) {\n        pairs.push(emoji.charCodeAt(i));\n      }\n    }\n\n    code = pairs.map((x) => x.toString(16).padStart(4, '0')).join('-');\n  }\n\n  return code;\n}\n\nfunction nativeToUnifiedExtended(emoji: string) {\n  return nativeToUnified(removeVS16s(emoji));\n}\n\nexport const nativeToUnifiedExtendedWithCache = withCache(nativeToUnifiedExtended);\n\nexport function uncompressEmoji(data: EmojiRawData): EmojiData {\n  const emojiData: EmojiData = { categories: [], emojis: {} };\n\n  for (let i = 0; i < data.length; i += 2) {\n    const category = {\n      id: data[i][0],\n      name: data[i][1],\n      emojis: [],\n    } as EmojiCategory;\n\n    for (let j = 0; j < data[i + 1].length; j++) {\n      const emojiRaw = data[i + 1][j];\n      if (!EXCLUDE_EMOJIS.includes(emojiRaw[1][0])) {\n        category.emojis.push(emojiRaw[1][0]);\n        emojiData.emojis[emojiRaw[1][0]] = {\n          id: emojiRaw[1][0],\n          names: emojiRaw[1] as string[],\n          native: unifiedToNative(emojiRaw[0] as string),\n          image: (emojiRaw[0] as string).toLowerCase(),\n        };\n      }\n    }\n\n    emojiData.categories.push(category);\n  }\n\n  return emojiData;\n}\n\nexport function isoToEmoji(iso: string) {\n  // Special case for Fragment numbers\n  if (iso === 'FT') {\n    return '\\uD83C\\uDFF4\\u200D\\u2620\\uFE0F';\n  }\n\n  const code = iso.toUpperCase();\n\n  if (!/^[A-Z]{2}$/.test(code)) return iso;\n  const codePoints = [...code].map((c) => c.codePointAt(0)! + ISO_FLAGS_OFFSET);\n  return String.fromCodePoint(...codePoints);\n}\n","type HandlerName =\n  'onEnter'\n  | 'onBackspace'\n  | 'onDelete'\n  | 'onEsc'\n  | 'onUp'\n  | 'onDown'\n  | 'onLeft'\n  | 'onRight'\n  | 'onTab';\ntype Handler = (e: KeyboardEvent) => void | boolean;\ntype CaptureOptions = Partial<Record<HandlerName, Handler>>;\n\nconst keyToHandlerName: Record<string, HandlerName> = {\n  Enter: 'onEnter',\n  Backspace: 'onBackspace',\n  Delete: 'onDelete',\n  Esc: 'onEsc',\n  Escape: 'onEsc',\n  ArrowUp: 'onUp',\n  ArrowDown: 'onDown',\n  ArrowLeft: 'onLeft',\n  ArrowRight: 'onRight',\n  Tab: 'onTab',\n};\n\nconst handlers: Record<HandlerName, Handler[]> = {\n  onEnter: [],\n  onDelete: [],\n  onBackspace: [],\n  onEsc: [],\n  onUp: [],\n  onDown: [],\n  onLeft: [],\n  onRight: [],\n  onTab: [],\n};\n\nexport default function captureKeyboardListeners(options: CaptureOptions) {\n  if (!hasActiveHandlers()) {\n    document.addEventListener('keydown', handleKeyDown, true);\n  }\n\n  (Object.keys(options) as Array<HandlerName>).forEach((handlerName) => {\n    const handler = options[handlerName];\n    if (!handler) {\n      return;\n    }\n\n    const currentEventHandlers = handlers[handlerName];\n    if (currentEventHandlers) {\n      currentEventHandlers.push(handler);\n    }\n  });\n\n  return () => {\n    releaseKeyboardListener(options);\n  };\n}\n\nfunction hasActiveHandlers() {\n  return Object.values(handlers).some((keyHandlers) => Boolean(keyHandlers.length));\n}\n\nfunction handleKeyDown(e: KeyboardEvent) {\n  const handlerName = keyToHandlerName[e.key];\n  if (!handlerName) {\n    return;\n  }\n\n  const { length } = handlers[handlerName];\n  if (!length) {\n    return;\n  }\n\n  for (let i = length - 1; i >= 0; i--) {\n    const handler = handlers[handlerName][i];\n    if (handler(e) !== false) {\n      e.stopPropagation();\n      break;\n    }\n  }\n}\n\nfunction releaseKeyboardListener(options: CaptureOptions) {\n  (Object.keys(options) as Array<HandlerName>).forEach((handlerName) => {\n    const handler = options[handlerName];\n    const currentEventHandlers = handlers[handlerName];\n    if (currentEventHandlers) {\n      const index = currentEventHandlers.findIndex((cb) => cb === handler);\n      if (index !== -1) {\n        currentEventHandlers.splice(index, 1);\n      }\n    }\n  });\n\n  if (!hasActiveHandlers()) {\n    document.removeEventListener('keydown', handleKeyDown, false);\n  }\n}\n","import { memo } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport Spinner from './Spinner';\n\nimport './Loading.scss';\n\ntype OwnProps = {\n  color?: 'blue' | 'white' | 'black' | 'yellow';\n  backgroundColor?: 'light' | 'dark';\n  className?: string;\n  onClick?: NoneToVoidFunction;\n};\n\nconst Loading = ({\n  color = 'blue', backgroundColor, className, onClick,\n}: OwnProps) => {\n  return (\n    <div className={buildClassName('Loading', onClick && 'interactive', className)} onClick={onClick}>\n      <Spinner color={color} backgroundColor={backgroundColor} />\n    </div>\n  );\n};\n\nexport default memo(Loading);\n","import type React from '../../../lib/teact/teact';\n\nimport { EDITABLE_INPUT_ID } from '../../../config';\nimport { IS_IOS } from '../../../util/browser/windowEnvironment';\n\nexport function preventMessageInputBlur(e: React.MouseEvent<HTMLElement>, withBubbling = false) {\n  if (\n    IS_IOS\n    || !document.activeElement\n    || document.activeElement.id !== EDITABLE_INPUT_ID\n    || (!withBubbling && e.target !== e.currentTarget)\n  ) {\n    return;\n  }\n\n  e.preventDefault();\n}\n\nexport function preventMessageInputBlurWithBubbling(e: React.MouseEvent<HTMLElement>) {\n  preventMessageInputBlur(e, true);\n}\n","import { getActions } from '../global';\n\nimport type { ApiChatType, ApiFormattedText, LinkContext } from '../api/types';\nimport type { DeepLinkMethod } from './deepLinkParser';\nimport { LeftColumnContent, SettingsScreens } from '../types';\n\nimport { API_CHAT_TYPES, RE_TG_LINK, TON_CURRENCY_CODE } from '../config';\nimport { IS_BAD_URL_PARSER } from './browser/globalEnvironment';\nimport { tryParseDeepLink } from './deepLinkParser';\n\nexport const processDeepLink = (url: string, linkContext?: LinkContext): boolean => {\n  const actions = getActions();\n\n  const parsedLink = tryParseDeepLink(url);\n  if (parsedLink) {\n    switch (parsedLink.type) {\n      case 'privateMessageLink':\n        actions.openPrivateChannel({\n          id: parsedLink.channelId,\n          threadId: parsedLink.threadId,\n          messageId: parsedLink.messageId,\n          commentId: parsedLink.commentId,\n          timestamp: parsedLink.timestamp,\n          linkContext,\n        });\n        return true;\n      case 'publicMessageLink': {\n        actions.openChatByUsername({\n          username: parsedLink.username,\n          threadId: parsedLink.threadId,\n          messageId: parsedLink.messageId,\n          commentId: parsedLink.commentId,\n          timestamp: parsedLink.timestamp,\n          linkContext,\n        });\n        return true;\n      }\n      case 'publicUsernameOrBotLink': {\n        const choose = parseChooseParameter(parsedLink.choose);\n\n        actions.openChatByUsername({\n          username: parsedLink.username,\n          startParam: parsedLink.start,\n          ref: parsedLink.ref,\n          text: parsedLink.text,\n          startApp: parsedLink.startApp,\n          mode: parsedLink.mode,\n          startAttach: parsedLink.startAttach,\n          attach: parsedLink.attach,\n          choose,\n          originalParts: [parsedLink.username, parsedLink.appName],\n          isDirect: parsedLink.isDirect,\n        });\n        return true;\n      }\n      case 'privateChannelLink': {\n        actions.openPrivateChannel({\n          id: parsedLink.channelId,\n        });\n        return true;\n      }\n      case 'businessChatLink':\n        actions.resolveBusinessChatLink({\n          slug: parsedLink.slug,\n        });\n        return true;\n      case 'premiumReferrerLink':\n        actions.openPremiumModal();\n        return true;\n      case 'premiumMultigiftLink':\n        actions.openGiftRecipientPicker();\n        return true;\n      case 'chatBoostLink':\n        actions.processBoostParameters({\n          usernameOrId: (parsedLink.username || parsedLink.id)!,\n          isPrivate: Boolean(parsedLink.id),\n        });\n        return true;\n      case 'giftUniqueLink':\n        actions.openUniqueGiftBySlug({ slug: parsedLink.slug });\n        return true;\n      case 'settings':\n        if (!parsedLink.screen) {\n          actions.openLeftColumnContent({ contentKey: LeftColumnContent.Settings });\n          return true;\n        }\n        switch (parsedLink.screen) {\n          case 'editProfile':\n            actions.openSettingsScreen({ screen: SettingsScreens.EditProfile });\n            break;\n          case 'language':\n            actions.openSettingsScreen({ screen: SettingsScreens.Language });\n            break;\n          case 'devices':\n            actions.openSettingsScreen({ screen: SettingsScreens.ActiveSessions });\n            break;\n          case 'privacy':\n            actions.openSettingsScreen({ screen: SettingsScreens.Privacy });\n            break;\n          case 'folders':\n            actions.openSettingsScreen({ screen: SettingsScreens.Folders });\n            break;\n          case 'theme':\n            actions.openSettingsScreen({ screen: SettingsScreens.General });\n            break;\n        }\n        return true;\n      case 'stars':\n        actions.openStarsBalanceModal({});\n        break;\n      case 'ton':\n        actions.openStarsBalanceModal({ currency: TON_CURRENCY_CODE });\n        break;\n      default:\n        break;\n    }\n  }\n\n  if (!url.match(RE_TG_LINK)) {\n    return false;\n  }\n\n  const urlToParse = IS_BAD_URL_PARSER ? url.replace(/^tg:\\/\\//, 'https://') : url;\n\n  const {\n    protocol, searchParams, hostname,\n  } = new URL(urlToParse);\n\n  if (protocol !== 'tg:') return false;\n\n  const method = hostname as DeepLinkMethod;\n  const params = Object.fromEntries(searchParams);\n\n  const {\n    checkChatInvite,\n    openChatByUsername,\n    openChatByPhoneNumber,\n    openStickerSet,\n    joinVoiceChatByLink,\n    openInvoice,\n    openChatWithDraft,\n    checkChatlistInvite,\n    openStoryViewerByUsername,\n    checkGiftCode,\n    openStarsBalanceModal,\n  } = actions;\n\n  switch (method) {\n    case 'resolve': {\n      const {\n        domain, phone, post, comment, voicechat, livestream, start, startattach, attach, thread, topic,\n        appname, startapp, mode, story, text,\n      } = params;\n\n      const threadId = Number(thread) || Number(topic) || undefined;\n\n      if (domain !== 'telegrampassport') {\n        if (appname) {\n          openChatByUsername({\n            username: domain,\n            startApp: startapp,\n            mode,\n            originalParts: [domain, appname],\n            text,\n          });\n        } else if (params.hasOwnProperty('voicechat') || params.hasOwnProperty('livestream')) {\n          joinVoiceChatByLink({\n            username: domain,\n            inviteHash: voicechat || livestream,\n          });\n        } else if (phone) {\n          openChatByPhoneNumber({\n            phoneNumber: phone,\n            startAttach: startattach,\n            attach,\n            text,\n          });\n        } else if (story) {\n          openStoryViewerByUsername({ username: domain, storyId: Number(story) });\n        } else {\n          openChatByUsername({\n            username: domain,\n            messageId: post ? Number(post) : undefined,\n            commentId: comment ? Number(comment) : undefined,\n            startParam: start,\n            mode,\n            startAttach: startattach,\n            attach,\n            threadId,\n          });\n        }\n      }\n      break;\n    }\n    case 'bg': {\n      // const {\n      //   slug, color, rotation, mode, intensity, bg_color: bgColor, gradient,\n      // } = params;\n      break;\n    }\n    case 'join': {\n      const { invite } = params;\n\n      checkChatInvite({ hash: invite });\n      break;\n    }\n    case 'addemoji':\n    case 'addstickers': {\n      const { set } = params;\n\n      openStickerSet({\n        stickerSetInfo: {\n          shortName: set,\n        },\n      });\n      break;\n    }\n    case 'share':\n    case 'msg':\n    case 'msg_url': {\n      const { url: urlParam, text } = params;\n      openChatWithDraft({ text: formatShareText(urlParam, text) });\n      break;\n    }\n    case 'addlist': {\n      checkChatlistInvite({ slug: params.slug });\n      break;\n    }\n\n    case 'login': {\n      // const { code, token } = params;\n      break;\n    }\n\n    case 'invoice': {\n      const { slug } = params;\n      openInvoice({ type: 'slug', slug });\n      break;\n    }\n\n    case 'stars_topup': {\n      const { balance, purpose } = params;\n      const balanceNeeded = Number(balance);\n      if (!balanceNeeded || balanceNeeded < 0) return true;\n\n      openStarsBalanceModal({ topup: { balanceNeeded, purpose } });\n      break;\n    }\n\n    case 'giftcode': {\n      const { slug } = params;\n      checkGiftCode({ slug });\n      break;\n    }\n    default:\n      // Unsupported deeplink\n      return false;\n  }\n  return true;\n};\n\nexport function formatShareText(url?: string, text?: string, title?: string): ApiFormattedText {\n  return {\n    text: [url, title, text].filter(Boolean).join('\\n'),\n  };\n}\n\nfunction parseChooseParameter(choose?: string) {\n  if (!choose) return undefined;\n  const types = choose.toLowerCase().split(' ').flatMap((type) => {\n    if (type === 'groups') {\n      return ['chats', 'groups'];\n    }\n    return [type];\n  });\n  return types.filter((type): type is ApiChatType => API_CHAT_TYPES.includes(type as ApiChatType));\n}\n","import { addCallback, removeCallback } from '../../lib/teact/teactn';\n\nimport type { SharedState } from '../types';\nimport type { ClientBoundMessageEvent } from './sharedState.worker';\n\nimport { APP_NAME } from '../../config';\nimport { deepDiff, type DiffObject } from '../../util/deepDiff';\nimport { deepMerge } from '../../util/deepMerge';\nimport { throttleWithTickEnd } from '../../util/schedulers';\nimport { INITIAL_SHARED_STATE } from '../initialState';\nimport { getGlobal, setGlobal } from '..';\n\ninterface GetFullStateEvent {\n  type: 'reqGetFullState';\n  localState: SharedState;\n}\n\ninterface UpdateStateEvent {\n  type: 'reqUpdateState';\n  update: DiffObject<SharedState>;\n}\n\nexport type WorkerBoundMessageEvent = GetFullStateEvent | UpdateStateEvent;\n\nlet sharedWorker: SharedWorker | undefined;\n\n// Tracks if the client has been synced with the shared state.\nlet synced = false;\nlet lastSharedState: SharedState = INITIAL_SHARED_STATE;\n\nexport function initSharedState(localState: SharedState) {\n  sharedWorker = new SharedWorker(new URL('./sharedState.worker.ts', import.meta.url), { name: APP_NAME });\n\n  sharedWorker.port.addEventListener('message', onMessage);\n  sharedWorker.port.start();\n\n  sendToWorker({ type: 'reqGetFullState', localState });\n\n  addCallback(onGlobalChange);\n}\n\nfunction onGlobalChange() {\n  const global = getGlobal();\n  if (global.sharedState === lastSharedState) return;\n  if (global.sharedState.isInitial) return;\n\n  updateSharedState(global.sharedState);\n}\n\nfunction onMessage(event: MessageEvent<ClientBoundMessageEvent>) {\n  const data = event.data;\n  switch (data.type) {\n    case 'stateUpdate': {\n      const state = deepMerge(lastSharedState, data.update);\n      updateGlobal(state);\n      break;\n    }\n    case 'fullState':\n      synced = true;\n      updateGlobal(data.state);\n      break;\n  }\n}\n\nexport function destroySharedStatePort() {\n  if (!sharedWorker) return;\n  sharedWorker.port.removeEventListener('message', onMessage);\n  sharedWorker.port.close();\n  sharedWorker = undefined;\n  removeCallback(onGlobalChange);\n}\n\nfunction updateSharedState(update: SharedState) {\n  if (!synced) return;\n  const diff = deepDiff(lastSharedState, update);\n  lastSharedState = update;\n  if (typeof diff === 'symbol') return;\n\n  sendToWorker({ type: 'reqUpdateState', update: diff });\n}\n\nconst scheduledEvents = new Set<WorkerBoundMessageEvent>();\n\nconst sendOnTickEnd = throttleWithTickEnd(() => {\n  if (!sharedWorker) {\n    throw new Error('Shared worker not initialized');\n  }\n\n  for (const event of scheduledEvents) {\n    sharedWorker.port.postMessage(event);\n  }\n  scheduledEvents.clear();\n});\n\nfunction sendToWorker(event: WorkerBoundMessageEvent) {\n  if (!sharedWorker) {\n    throw new Error('Shared worker not initialized');\n  }\n\n  scheduledEvents.add(event);\n  sendOnTickEnd();\n}\n\nfunction updateGlobal(update: Partial<SharedState>) {\n  let global = getGlobal();\n  lastSharedState = {\n    ...global.sharedState,\n    ...update,\n  };\n\n  global = {\n    ...global,\n    sharedState: lastSharedState,\n  };\n  setGlobal(global);\n}\n","import type { GlobalState, TabArgs } from '../types';\n\nimport { DEFAULT_GIFT_PROFILE_FILTER_OPTIONS } from '../../config';\nimport arePropsShallowEqual from '../../util/arePropsShallowEqual';\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport {\n  getHasAdminRight, isChatAdmin, isChatChannel,\n} from '../helpers';\nimport { selectChat } from './chats';\nimport { selectTabState } from './tabs';\nimport { selectUser } from './users';\n\nexport type ProfileCollectionKey = number | 'all';\n\nexport function selectPaymentInputInvoice<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).payment.inputInvoice;\n}\n\nexport function selectPaymentForm<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).payment.form;\n}\n\nexport function selectStarsPayment<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).starsPayment;\n}\n\nexport function selectPaymentRequestId<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).payment.requestId;\n}\n\nexport function selectProviderPublishableKey<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).payment.form?.nativeParams.publishableKey;\n}\n\nexport function selectProviderPublicToken<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).payment.form?.nativeParams.publicToken;\n}\n\nexport function selectStripeCredentials<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).payment.stripeCredentials;\n}\n\nexport function selectSmartGlocalCredentials<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).payment.smartGlocalCredentials;\n}\n\nexport function selectCanUseGiftProfileAdminFilter<T extends GlobalState>(\n  global: T, peerId: string,\n) {\n  const chat = selectChat(global, peerId);\n  const isCurrentUser = global.currentUserId === peerId;\n  return isCurrentUser || (chat && isChatChannel(chat) && isChatAdmin(chat) && getHasAdminRight(chat, 'postMessages'));\n}\n\nexport function selectCanUseGiftProfileFilter<T extends GlobalState>(\n  global: T, peerId: string,\n) {\n  const chat = selectChat(global, peerId);\n  const user = selectUser(global, peerId);\n  return Boolean(user) || (chat && isChatChannel(chat));\n}\n\nexport function selectGiftProfileFilter<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectCanUseGiftProfileFilter(global, peerId) ? selectTabState(global, tabId).savedGifts.filter : undefined;\n}\n\nexport function selectIsGiftProfileFilterDefault<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return arePropsShallowEqual(selectTabState(global, tabId).savedGifts.filter, DEFAULT_GIFT_PROFILE_FILTER_OPTIONS);\n}\n\nexport function selectActiveGiftsCollectionId<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): ProfileCollectionKey {\n  return selectTabState(global, tabId).savedGifts.activeCollectionByPeerId?.[peerId] || 'all';\n}\n","import { __classPrivateFieldGet, __classPrivateFieldSet } from './external/tslib/tslib.es6.js';\n\n// Copyright 2019-2024 Tauri Programme within The Commons Conservancy\n// SPDX-License-Identifier: Apache-2.0\n// SPDX-License-Identifier: MIT\nvar _Channel_onmessage, _Channel_nextMessageIndex, _Channel_pendingMessages, _Channel_messageEndIndex, _Resource_rid;\n/**\n * Invoke your custom commands.\n *\n * This package is also accessible with `window.__TAURI__.core` when [`app.withGlobalTauri`](https://v2.tauri.app/reference/config/#withglobaltauri) in `tauri.conf.json` is set to `true`.\n * @module\n */\n/**\n * A key to be used to implement a special function\n * on your types that define how your type should be serialized\n * when passing across the IPC.\n * @example\n * Given a type in Rust that looks like this\n * ```rs\n * #[derive(serde::Serialize, serde::Deserialize)\n * enum UserId {\n *   String(String),\n *   Number(u32),\n * }\n * ```\n * `UserId::String(\"id\")` would be serialized into `{ String: \"id\" }`\n * and so we need to pass the same structure back to Rust\n * ```ts\n * import { SERIALIZE_TO_IPC_FN } from \"@tauri-apps/api/core\"\n *\n * class UserIdString {\n *   id\n *   constructor(id) {\n *     this.id = id\n *   }\n *\n *   [SERIALIZE_TO_IPC_FN]() {\n *     return { String: this.id }\n *   }\n * }\n *\n * class UserIdNumber {\n *   id\n *   constructor(id) {\n *     this.id = id\n *   }\n *\n *   [SERIALIZE_TO_IPC_FN]() {\n *     return { Number: this.id }\n *   }\n * }\n *\n * type UserId = UserIdString | UserIdNumber\n * ```\n *\n */\n// if this value changes, make sure to update it in:\n// 1. ipc.js\n// 2. process-ipc-message-fn.js\nconst SERIALIZE_TO_IPC_FN = '__TAURI_TO_IPC_KEY__';\n/**\n * Stores the callback in a known location, and returns an identifier that can be passed to the backend.\n * The backend uses the identifier to `eval()` the callback.\n *\n * @return An unique identifier associated with the callback function.\n *\n * @since 1.0.0\n */\nfunction transformCallback(\n// TODO: Make this not optional in v3\ncallback, once = false) {\n    return window.__TAURI_INTERNALS__.transformCallback(callback, once);\n}\nclass Channel {\n    constructor(onmessage) {\n        _Channel_onmessage.set(this, void 0);\n        // the index is used as a mechanism to preserve message order\n        _Channel_nextMessageIndex.set(this, 0);\n        _Channel_pendingMessages.set(this, []);\n        _Channel_messageEndIndex.set(this, void 0);\n        __classPrivateFieldSet(this, _Channel_onmessage, onmessage || (() => { }), \"f\");\n        this.id = transformCallback((rawMessage) => {\n            const index = rawMessage.index;\n            if ('end' in rawMessage) {\n                if (index == __classPrivateFieldGet(this, _Channel_nextMessageIndex, \"f\")) {\n                    this.cleanupCallback();\n                }\n                else {\n                    __classPrivateFieldSet(this, _Channel_messageEndIndex, index, \"f\");\n                }\n                return;\n            }\n            const message = rawMessage.message;\n            // Process the message if we're at the right order\n            if (index == __classPrivateFieldGet(this, _Channel_nextMessageIndex, \"f\")) {\n                __classPrivateFieldGet(this, _Channel_onmessage, \"f\").call(this, message);\n                __classPrivateFieldSet(this, _Channel_nextMessageIndex, __classPrivateFieldGet(this, _Channel_nextMessageIndex, \"f\") + 1, \"f\");\n                // process pending messages\n                while (__classPrivateFieldGet(this, _Channel_nextMessageIndex, \"f\") in __classPrivateFieldGet(this, _Channel_pendingMessages, \"f\")) {\n                    const message = __classPrivateFieldGet(this, _Channel_pendingMessages, \"f\")[__classPrivateFieldGet(this, _Channel_nextMessageIndex, \"f\")];\n                    __classPrivateFieldGet(this, _Channel_onmessage, \"f\").call(this, message);\n                    // eslint-disable-next-line @typescript-eslint/no-array-delete\n                    delete __classPrivateFieldGet(this, _Channel_pendingMessages, \"f\")[__classPrivateFieldGet(this, _Channel_nextMessageIndex, \"f\")];\n                    __classPrivateFieldSet(this, _Channel_nextMessageIndex, __classPrivateFieldGet(this, _Channel_nextMessageIndex, \"f\") + 1, \"f\");\n                }\n                if (__classPrivateFieldGet(this, _Channel_nextMessageIndex, \"f\") === __classPrivateFieldGet(this, _Channel_messageEndIndex, \"f\")) {\n                    this.cleanupCallback();\n                }\n            }\n            // Queue the message if we're not\n            else {\n                // eslint-disable-next-line security/detect-object-injection\n                __classPrivateFieldGet(this, _Channel_pendingMessages, \"f\")[index] = message;\n            }\n        });\n    }\n    cleanupCallback() {\n        window.__TAURI_INTERNALS__.unregisterCallback(this.id);\n    }\n    set onmessage(handler) {\n        __classPrivateFieldSet(this, _Channel_onmessage, handler, \"f\");\n    }\n    get onmessage() {\n        return __classPrivateFieldGet(this, _Channel_onmessage, \"f\");\n    }\n    [(_Channel_onmessage = new WeakMap(), _Channel_nextMessageIndex = new WeakMap(), _Channel_pendingMessages = new WeakMap(), _Channel_messageEndIndex = new WeakMap(), SERIALIZE_TO_IPC_FN)]() {\n        return `__CHANNEL__:${this.id}`;\n    }\n    toJSON() {\n        // eslint-disable-next-line security/detect-object-injection\n        return this[SERIALIZE_TO_IPC_FN]();\n    }\n}\nclass PluginListener {\n    constructor(plugin, event, channelId) {\n        this.plugin = plugin;\n        this.event = event;\n        this.channelId = channelId;\n    }\n    async unregister() {\n        return invoke(`plugin:${this.plugin}|remove_listener`, {\n            event: this.event,\n            channelId: this.channelId\n        });\n    }\n}\n/**\n * Adds a listener to a plugin event.\n *\n * @returns The listener object to stop listening to the events.\n *\n * @since 2.0.0\n */\nasync function addPluginListener(plugin, event, cb) {\n    const handler = new Channel(cb);\n    return invoke(`plugin:${plugin}|registerListener`, { event, handler }).then(() => new PluginListener(plugin, event, handler.id));\n}\n/**\n * Get permission state for a plugin.\n *\n * This should be used by plugin authors to wrap their actual implementation.\n */\nasync function checkPermissions(plugin) {\n    return invoke(`plugin:${plugin}|check_permissions`);\n}\n/**\n * Request permissions.\n *\n * This should be used by plugin authors to wrap their actual implementation.\n */\nasync function requestPermissions(plugin) {\n    return invoke(`plugin:${plugin}|request_permissions`);\n}\n/**\n * Sends a message to the backend.\n * @example\n * ```typescript\n * import { invoke } from '@tauri-apps/api/core';\n * await invoke('login', { user: 'tauri', password: 'poiwe3h4r5ip3yrhtew9ty' });\n * ```\n *\n * @param cmd The command name.\n * @param args The optional arguments to pass to the command.\n * @param options The request options.\n * @return A promise resolving or rejecting to the backend response.\n *\n * @since 1.0.0\n */\nasync function invoke(cmd, args = {}, options) {\n    return window.__TAURI_INTERNALS__.invoke(cmd, args, options);\n}\n/**\n * Convert a device file path to an URL that can be loaded by the webview.\n * Note that `asset:` and `http://asset.localhost` must be added to [`app.security.csp`](https://v2.tauri.app/reference/config/#csp-1) in `tauri.conf.json`.\n * Example CSP value: `\"csp\": \"default-src 'self' ipc: http://ipc.localhost; img-src 'self' asset: http://asset.localhost\"` to use the asset protocol on image sources.\n *\n * Additionally, `\"enable\" : \"true\"` must be added to [`app.security.assetProtocol`](https://v2.tauri.app/reference/config/#assetprotocolconfig)\n * in `tauri.conf.json` and its access scope must be defined on the `scope` array on the same `assetProtocol` object.\n *\n * @param  filePath The file path.\n * @param  protocol The protocol to use. Defaults to `asset`. You only need to set this when using a custom protocol.\n * @example\n * ```typescript\n * import { appDataDir, join } from '@tauri-apps/api/path';\n * import { convertFileSrc } from '@tauri-apps/api/core';\n * const appDataDirPath = await appDataDir();\n * const filePath = await join(appDataDirPath, 'assets/video.mp4');\n * const assetUrl = convertFileSrc(filePath);\n *\n * const video = document.getElementById('my-video');\n * const source = document.createElement('source');\n * source.type = 'video/mp4';\n * source.src = assetUrl;\n * video.appendChild(source);\n * video.load();\n * ```\n *\n * @return the URL that can be used as source on the webview.\n *\n * @since 1.0.0\n */\nfunction convertFileSrc(filePath, protocol = 'asset') {\n    return window.__TAURI_INTERNALS__.convertFileSrc(filePath, protocol);\n}\n/**\n * A rust-backed resource stored through `tauri::Manager::resources_table` API.\n *\n * The resource lives in the main process and does not exist\n * in the Javascript world, and thus will not be cleaned up automatiacally\n * except on application exit. If you want to clean it up early, call {@linkcode Resource.close}\n *\n * @example\n * ```typescript\n * import { Resource, invoke } from '@tauri-apps/api/core';\n * export class DatabaseHandle extends Resource {\n *   static async open(path: string): Promise<DatabaseHandle> {\n *     const rid: number = await invoke('open_db', { path });\n *     return new DatabaseHandle(rid);\n *   }\n *\n *   async execute(sql: string): Promise<void> {\n *     await invoke('execute_sql', { rid: this.rid, sql });\n *   }\n * }\n * ```\n */\nclass Resource {\n    get rid() {\n        return __classPrivateFieldGet(this, _Resource_rid, \"f\");\n    }\n    constructor(rid) {\n        _Resource_rid.set(this, void 0);\n        __classPrivateFieldSet(this, _Resource_rid, rid, \"f\");\n    }\n    /**\n     * Destroys and cleans up this resource from memory.\n     * **You should not call any method on this object anymore and should drop any reference to it.**\n     */\n    async close() {\n        return invoke('plugin:resources|close', {\n            rid: this.rid\n        });\n    }\n}\n_Resource_rid = new WeakMap();\nfunction isTauri() {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/no-unsafe-member-access\n    return !!(globalThis || window).isTauri;\n}\n\nexport { Channel, PluginListener, Resource, SERIALIZE_TO_IPC_FN, addPluginListener, checkPermissions, convertFileSrc, invoke, isTauri, requestPermissions, transformCallback };\n","import type { MoveOffsets } from './captureEvents';\n\nimport { requestMeasure, requestMutation } from '../lib/fasterdom/fasterdom';\nimport { IS_IOS } from './browser/windowEnvironment';\nimport { animateNumber, timingFunctions } from './animation';\nimport { captureEvents, SwipeDirection } from './captureEvents';\nimport { waitForAnimationEnd } from './cssAnimationEndListeners';\nimport { clamp } from './math';\n\nconst INERTIA_DURATION = 300;\nconst INERTIA_EASING = timingFunctions.easeOutCubic;\n\nlet isSwipeActive = false;\nlet swipeOffsets: MoveOffsets | undefined;\nlet onDrag: ((offsets: MoveOffsets) => void) | undefined;\nlet onRelease: ((onCancel: NoneToVoidFunction) => void) | undefined;\nlet cancelCurrentReleaseAnimation: NoneToVoidFunction | undefined;\n\nexport function captureControlledSwipe(\n  element: HTMLElement, options: {\n    excludedClosestSelector?: string;\n    selectorToPreventScroll?: string;\n    onSwipeLeftStart?: NoneToVoidFunction;\n    onSwipeRightStart?: NoneToVoidFunction;\n    onCancel: NoneToVoidFunction;\n  },\n) {\n  return captureEvents(element, {\n    excludedClosestSelector: options.excludedClosestSelector,\n    selectorToPreventScroll: options.selectorToPreventScroll,\n    swipeThreshold: 10,\n\n    onSwipe(e, direction, offsets) {\n      if (direction === SwipeDirection.Left) {\n        options.onSwipeLeftStart?.();\n      } else if (direction === SwipeDirection.Right) {\n        options.onSwipeRightStart?.();\n      } else {\n        return false;\n      }\n\n      if (IS_IOS) {\n        isSwipeActive = true;\n        swipeOffsets = offsets;\n      }\n\n      return true;\n    },\n\n    onDrag(e, captureEvent, offsets) {\n      if (!isSwipeActive) return;\n\n      onDrag?.(offsets);\n    },\n\n    onRelease() {\n      if (!isSwipeActive) return;\n\n      isSwipeActive = false;\n\n      onRelease?.(options.onCancel);\n\n      onDrag = undefined;\n      onRelease = undefined;\n    },\n  });\n}\n\nexport function allowSwipeControlForTransition(\n  currentSlide: HTMLElement,\n  nextSlide: HTMLElement,\n  onCancelForTransition: NoneToVoidFunction,\n) {\n  cancelCurrentReleaseAnimation?.();\n\n  if (!isSwipeActive) return;\n\n  const targetPosition = extractAnimationEndPosition(currentSlide);\n  if (!targetPosition) return;\n\n  currentSlide.getAnimations().forEach((a) => a.pause());\n  nextSlide.getAnimations().forEach((a) => a.pause());\n\n  currentSlide.style.animationTimingFunction = 'linear';\n  nextSlide.style.animationTimingFunction = 'linear';\n\n  let currentDirection: 1 | -1 | undefined;\n\n  requestMeasure(() => {\n    const computedStyle = getComputedStyle(currentSlide);\n    const initialPositionPx = extractPositionFromMatrix(computedStyle.transform, targetPosition.axis);\n    const targetPositionPx = targetPosition.units === 'px'\n      ? targetPosition.value\n      : ((targetPosition.value / 100) * (\n        targetPosition.axis === 'X' ? currentSlide.offsetWidth : currentSlide.offsetHeight\n      ));\n    const distance = targetPositionPx - initialPositionPx;\n\n    let progress = 0;\n\n    onDrag = ({ dragOffsetX, dragOffsetY }) => {\n      const dragOffset = targetPosition.axis === 'X'\n        ? dragOffsetX - swipeOffsets!.dragOffsetX\n        : dragOffsetY - swipeOffsets!.dragOffsetY;\n\n      const newProgress = clamp(dragOffset / distance, 0, 1);\n      currentDirection = newProgress > progress ? 1 : -1;\n      progress = newProgress;\n\n      updateAnimationProgress([currentSlide, nextSlide], progress);\n    };\n\n    onRelease = (onCancelForClient: NoneToVoidFunction) => {\n      const isRevertSwipe = currentDirection === -1;\n\n      function cleanup() {\n        currentSlide.getAnimations().forEach((a) => a.cancel());\n        nextSlide.getAnimations().forEach((a) => a.cancel());\n\n        requestMutation(() => {\n          currentSlide.style.animationTimingFunction = '';\n          nextSlide.style.animationTimingFunction = '';\n        });\n      }\n\n      if (!isRevertSwipe) {\n        // For some reason animations are not cleared when CSS class is removed\n        waitForAnimationEnd(currentSlide, cleanup);\n      }\n\n      cancelCurrentReleaseAnimation = animateNumber({\n        from: progress,\n        to: isRevertSwipe ? 0 : 1,\n        duration: INERTIA_DURATION,\n        timing: INERTIA_EASING,\n        onUpdate(releaseProgress) {\n          updateAnimationProgress([currentSlide, nextSlide], releaseProgress);\n        },\n        onEnd(isCanceled = false) {\n          cancelCurrentReleaseAnimation = undefined;\n\n          if (isCanceled || isRevertSwipe) {\n            cleanup();\n            onCancelForTransition();\n            onCancelForClient();\n          }\n        },\n      });\n    };\n  });\n}\n\nfunction updateAnimationProgress(elements: HTMLElement[], progress: number) {\n  elements.map((e) => e.getAnimations()).flat().forEach((animation) => {\n    animation.currentTime = (animation.effect!.getTiming().duration as number) * progress;\n  });\n}\n\nfunction extractAnimationEndPosition(element: HTMLElement) {\n  for (const animation of element.getAnimations()) {\n    if (!(animation.effect instanceof KeyframeEffect)) continue;\n\n    for (const keyframe of animation.effect.getKeyframes()) {\n      if (keyframe.offset !== 1 || !keyframe.transform) continue;\n\n      const position = extractPositionFromTransform(keyframe.transform as string);\n      if (position) {\n        return position;\n      }\n    }\n  }\n\n  return undefined;\n}\n\nfunction extractPositionFromTransform(transformRule: string) {\n  const match = transformRule.match(/([XY])\\((-?\\d+)(%|px)\\)/);\n  if (!match) return undefined;\n\n  return {\n    axis: match[1] as 'X' | 'Y',\n    value: Number(match[2]),\n    units: match[3],\n  };\n}\n\nfunction extractPositionFromMatrix(transform: string, axis: 'X' | 'Y') {\n  const matrix = transform.slice(7, -1).split(',').map(Number);\n  return matrix[axis === 'X' ? 4 : 5];\n}\n","import type { TeactNode } from '../../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../../global';\n\nimport type { ApiPeer } from '../../../api/types';\nimport { ApiMessageEntityTypes } from '../../../api/types';\n\nimport { selectUser } from '../../../global/selectors';\n\nimport useAppLayout from '../../../hooks/useAppLayout';\n\ntype OwnProps = {\n  userId?: string;\n  username?: string;\n  children: TeactNode;\n};\n\ntype StateProps = {\n  userOrChat?: ApiPeer;\n};\n\nconst MentionLink = ({\n  userId,\n  username,\n  userOrChat,\n  children,\n}: OwnProps & StateProps) => {\n  const {\n    openChat,\n    openChatByUsername,\n    closeStoryViewer,\n    setShouldCloseRightColumn,\n  } = getActions();\n\n  const { isMobile } = useAppLayout();\n\n  const handleClick = () => {\n    if (isMobile) {\n      setShouldCloseRightColumn({\n        value: true,\n      });\n    }\n\n    if (userOrChat) {\n      openChat({ id: userOrChat.id });\n    } else if (username) {\n      closeStoryViewer();\n      openChatByUsername({ username: username.substring(1) });\n    }\n  };\n\n  return (\n    <a\n      onClick={handleClick}\n      className=\"text-entity-link\"\n      dir=\"auto\"\n      data-entity-type={userId ? ApiMessageEntityTypes.MentionName : ApiMessageEntityTypes.Mention}\n    >\n      {children}\n    </a>\n  );\n};\n\nexport default withGlobal<OwnProps>(\n  (global, { userId }): Complete<StateProps> => {\n    return {\n      userOrChat: userId ? selectUser(global, userId) : undefined,\n    };\n  },\n)(MentionLink);\n","import type {\n  GlobalState,\n} from '../types';\nimport {\n  type ApiMessage,\n  type MediaContainer,\n  type SizeTarget,\n} from '../../api/types';\n\nimport { NSFW_RESTRICTION_REASON } from '../../config';\nimport {\n  getMessageAudio,\n  getMessageContent,\n  getMessageDocument,\n  getMessageInvoice,\n  getMessageMediaHash,\n  getMessagePhoto,\n  getMessageSingleCustomEmoji,\n  getMessageSingleRegularEmoji,\n  getMessageSticker,\n  getMessageVideo,\n  getMessageVoice,\n  getWebPageAudio,\n  getWebPagePhoto,\n  getWebPageVideo,\n} from '../helpers';\nimport { selectChat } from './chats';\nimport {\n  selectActiveRestrictionReasons,\n  selectReplyMessage,\n  selectWebPageFromMessage,\n} from './messages';\nimport { selectSettingsKeys } from './settings';\nimport { selectAnimatedEmoji, selectCustomEmoji } from './symbols';\n\nexport function selectIsMediaNsfw<T extends GlobalState>(global: T, message: ApiMessage) {\n  const { isSensitiveEnabled } = selectSettingsKeys(global);\n  const chat = selectChat(global, message.chatId);\n  if (isSensitiveEnabled) return false;\n\n  const chatActiveRestrictions = selectActiveRestrictionReasons(global, chat?.restrictionReasons);\n  const messageActiveRestrictions = selectActiveRestrictionReasons(global, message.restrictionReasons);\n\n  return chatActiveRestrictions.some((reason) => reason.reason === NSFW_RESTRICTION_REASON)\n    || messageActiveRestrictions.some((reason) => reason.reason === NSFW_RESTRICTION_REASON);\n}\n\nexport function selectMessageDownloadableMedia<T extends GlobalState>(global: T, message: MediaContainer) {\n  const singleEmoji = getMessageSingleRegularEmoji(message);\n  const animatedEmoji = singleEmoji && selectAnimatedEmoji(global, singleEmoji);\n  const animatedCustomEmojiId = getMessageSingleCustomEmoji(message);\n  const customEmoji = animatedCustomEmojiId && selectCustomEmoji(global, animatedCustomEmojiId);\n\n  const webPage = selectWebPageFromMessage(global, message);\n  return (\n    customEmoji || animatedEmoji\n    || getMessagePhoto(message)\n    || getMessageVideo(message)\n    || getMessageDocument(message)\n    || getMessageSticker(message)\n    || getMessageAudio(message)\n    || getMessageVoice(message)\n    || getWebPagePhoto(webPage)\n    || getWebPageVideo(webPage)\n    || getWebPageAudio(webPage)\n  );\n}\n\nexport function selectMessageMediaThumbnail<T extends GlobalState>(global: T, message: MediaContainer) {\n  const webPage = selectWebPageFromMessage(global, message);\n  const media = getMessagePhoto(message)\n    || getMessageVideo(message)\n    || getMessageDocument(message)\n    || getMessageSticker(message)\n    || getWebPagePhoto(webPage)\n    || getWebPageVideo(webPage)\n    || getMessageInvoice(message)?.extendedMedia;\n\n  if (!media) {\n    return undefined;\n  }\n\n  return media.thumbnail;\n}\n\nexport function selectMessageMediaThumbDataUri<T extends GlobalState>(global: T, message: MediaContainer) {\n  const thumbnail = selectMessageMediaThumbnail(global, message);\n  return thumbnail?.dataUri;\n}\n\nexport function selectMessageMediaHash<T extends GlobalState>(\n  global: T,\n  message: MediaContainer,\n  target: SizeTarget,\n) {\n  const webPage = selectWebPageFromMessage(global, message);\n\n  return getMessageMediaHash(message, { webPage }, target);\n}\n\nexport function selectMessageMediaDuration<T extends GlobalState>(global: T, message: MediaContainer) {\n  const { audio, voice, video } = getMessageContent(message);\n  const webPage = selectWebPageFromMessage(global, message);\n  const media = audio || voice || video || getWebPageVideo(webPage) || getWebPageAudio(webPage);\n  if (!media) {\n    return undefined;\n  }\n\n  return media.duration;\n}\n\nexport function selectTimestampableMedia<T extends GlobalState>(global: T, message: MediaContainer) {\n  const webPage = selectWebPageFromMessage(global, message);\n  const video = getMessageVideo(message) || getWebPageVideo(webPage);\n  return (video && !video.isRound && !video.isGif ? video : undefined)\n    || getMessageAudio(message)\n    || getMessageVoice(message);\n}\n\nexport function selectMessageTimestampableDuration<T extends GlobalState>(\n  global: T, message: ApiMessage, noReplies?: boolean,\n) {\n  const replyMessage = !noReplies ? selectReplyMessage(global, message) : undefined;\n\n  const timestampableMedia = selectTimestampableMedia(global, message);\n  const replyTimestampableMedia = replyMessage && selectTimestampableMedia(global, replyMessage);\n\n  return timestampableMedia?.duration || replyTimestampableMedia?.duration;\n}\n\nexport function selectMessageLastPlaybackTimestamp<T extends GlobalState>(\n  global: T, chatId: string, messageId: number,\n) {\n  return global.messages.playbackByChatId[chatId]?.byId[messageId];\n}\n","import { useEffect, useState } from '../lib/teact/teact';\n\nfunction useAsync<T>(fn: () => Promise<T>, deps: unknown[], defaultValue: T): {\n  isLoading: boolean;\n  error: Error | undefined;\n  result: T;\n};\nfunction useAsync<T>(fn: () => Promise<T>, deps: unknown[]): {\n  isLoading: boolean;\n  error: Error | undefined;\n  result: T | undefined;\n};\nfunction useAsync<T>(fn: () => Promise<T>, deps: unknown[], defaultValue?: T) {\n  const [isLoading, setIsLoading] = useState<boolean>(false);\n  const [error, setError] = useState<Error | undefined>();\n  const [result, setResult] = useState<T | undefined>(defaultValue);\n  useEffect(() => {\n    setIsLoading(true);\n    let wasCancelled = false;\n    fn().then((res) => {\n      if (wasCancelled) return;\n      setIsLoading(false);\n      setResult(res);\n    }, (err) => {\n      if (wasCancelled) return;\n      setIsLoading(false);\n      setError(err);\n    });\n    return () => {\n      wasCancelled = true;\n    };\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  }, deps);\n  return { isLoading, error, result };\n};\n\nexport default useAsync;\n","import type { ApiMessage } from '../../api/types';\n\nexport type SearchResultKey = `${string}_${number}`;\n\nexport function getSearchResultKey(message: ApiMessage): SearchResultKey {\n  const { chatId, id } = message;\n\n  return `${chatId}_${id}`;\n}\n\nexport function parseSearchResultKey(key: SearchResultKey) {\n  const [chatId, messageId] = key.split('_');\n\n  return [chatId, Number(messageId)] as const;\n}\n","import type { FC } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport './Spinner.scss';\n\nconst Spinner: FC<{\n  color?: 'blue' | 'white' | 'black' | 'green' | 'gray' | 'yellow';\n  backgroundColor?: 'light' | 'dark';\n  className?: string;\n}> = ({\n  color = 'blue',\n  backgroundColor,\n  className,\n}) => {\n  return (\n    <div className={buildClassName(\n      'Spinner', className, color, backgroundColor && 'with-background', backgroundColor && `bg-${backgroundColor}`,\n    )}\n    >\n      <div className=\"Spinner__inner\" />\n    </div>\n  );\n};\n\nexport default Spinner;\n","import type {\n  ElementRef } from '../../lib/teact/teact';\nimport {\n  useEffect, useLayoutEffect, useRef, useState,\n} from '../../lib/teact/teact';\n\nimport { requestForcedReflow, requestMeasure, requestMutation } from '../../lib/fasterdom/fasterdom';\nimport calcTextLineHeightAndCount from '../../util/element/calcTextLineHeightAndCount';\nimport useDebouncedCallback from '../useDebouncedCallback';\nimport useLastCallback from '../useLastCallback';\nimport useWindowSize from '../window/useWindowSize';\n\nconst WINDOW_RESIZE_LINE_RECALC_DEBOUNCE = 200;\n\nexport default function useCollapsibleLines<T extends HTMLElement, C extends HTMLElement>(\n  ref: ElementRef<T>,\n  maxLinesBeforeCollapse: number,\n  cutoutRef?: ElementRef<C>,\n  isDisabled?: boolean,\n) {\n  const isFirstRenderRef = useRef(true);\n  const cutoutHeightRef = useRef<number | undefined>();\n  const [isCollapsible, setIsCollapsible] = useState(!isDisabled);\n  const [isCollapsed, setIsCollapsed] = useState(isCollapsible);\n\n  useLayoutEffect(() => {\n    const element = (cutoutRef || ref).current;\n    if (isDisabled || !element || isFirstRenderRef.current) return;\n\n    requestMutation(() => {\n      element.style.maxHeight = isCollapsed ? `${cutoutHeightRef.current}px` : '';\n    });\n  }, [cutoutRef, isCollapsed, isDisabled, ref]);\n\n  const recalculateTextLines = useLastCallback(() => {\n    if (isDisabled || !ref.current) {\n      return;\n    }\n    const element = ref.current;\n\n    const { lineHeight, totalLines } = calcTextLineHeightAndCount(element);\n    if (totalLines > maxLinesBeforeCollapse) {\n      cutoutHeightRef.current = lineHeight * maxLinesBeforeCollapse;\n      setIsCollapsible(true);\n    } else {\n      setIsCollapsible(false);\n      setIsCollapsed(false);\n    }\n  });\n\n  const debouncedRecalcTextLines = useDebouncedCallback(\n    () => requestMeasure(recalculateTextLines),\n    [recalculateTextLines],\n    WINDOW_RESIZE_LINE_RECALC_DEBOUNCE,\n  );\n\n  useLayoutEffect(() => {\n    if (!isDisabled && isFirstRenderRef.current) {\n      requestForcedReflow(() => {\n        recalculateTextLines();\n\n        return () => {\n          isFirstRenderRef.current = false;\n          const element = (cutoutRef || ref).current;\n          if (!element) return;\n          element.style.maxHeight = cutoutHeightRef.current ? `${cutoutHeightRef.current}px` : '';\n        };\n      });\n    }\n  }, [cutoutRef, isDisabled, recalculateTextLines, ref]);\n\n  // Parent resize is triggered on every collapse/expand, so we do recalculation only on window resize to save resources\n  const { width: windowWidth } = useWindowSize();\n  useEffect(() => {\n    if (!isDisabled) {\n      if (isFirstRenderRef.current) return;\n\n      debouncedRecalcTextLines();\n    } else {\n      setIsCollapsible(false);\n      setIsCollapsed(false);\n    }\n  }, [debouncedRecalcTextLines, isDisabled, windowWidth]);\n\n  return {\n    isCollapsed,\n    isCollapsible,\n    setIsCollapsed,\n  };\n}\n","import type { ApiSessionData } from '../api/types';\nimport type { DcId, SharedSessionData } from '../types';\n\nimport {\n  DC_IDS,\n  DEBUG, IS_SCREEN_LOCKED_CACHE_KEY,\n  SESSION_ACCOUNT_PREFIX,\n  SESSION_LEGACY_USER_KEY,\n} from '../config';\nimport { ACCOUNT_SLOT, storeAccountData, writeSlotSession } from './multiaccount';\n\nexport function hasStoredSession() {\n  if (checkSessionLocked()) {\n    return true;\n  }\n\n  const slotData = loadSlotSession(ACCOUNT_SLOT);\n  if (slotData) return Boolean(slotData.dcId);\n\n  if (!ACCOUNT_SLOT) {\n    const legacyAuthJson = localStorage.getItem(SESSION_LEGACY_USER_KEY);\n    if (legacyAuthJson) {\n      try {\n        const userAuth = JSON.parse(legacyAuthJson);\n        return Boolean(userAuth && userAuth.id && userAuth.dcID);\n      } catch (err) {\n        // Do nothing.\n        return false;\n      }\n    }\n  }\n\n  return false;\n}\n\nexport function storeSession(sessionData: ApiSessionData) {\n  const {\n    mainDcId, keys, isTest,\n  } = sessionData;\n\n  const currentSlotData = loadSlotSession(ACCOUNT_SLOT);\n  const newSlotData: SharedSessionData = {\n    ...currentSlotData,\n    dcId: mainDcId,\n    isTest,\n  };\n\n  Object.keys(keys).map(Number).forEach((dcId) => {\n    newSlotData[`dc${dcId as DcId}_auth_key`] = keys[dcId];\n  });\n\n  if (!ACCOUNT_SLOT) {\n    storeLegacySession(sessionData, currentSlotData?.userId);\n  }\n\n  writeSlotSession(ACCOUNT_SLOT, newSlotData);\n}\n\nfunction storeLegacySession(sessionData: ApiSessionData, currentUserId?: string) {\n  const {\n    mainDcId, keys, isTest,\n  } = sessionData;\n\n  localStorage.setItem(SESSION_LEGACY_USER_KEY, JSON.stringify({\n    dcID: mainDcId,\n    id: currentUserId,\n    test: isTest,\n  }));\n  localStorage.setItem('dc', String(mainDcId));\n  Object.keys(keys).map(Number).forEach((dcId) => {\n    localStorage.setItem(`dc${dcId}_auth_key`, JSON.stringify(keys[dcId]));\n  });\n}\n\nexport function clearStoredSession(slot?: number) {\n  if (!slot) {\n    clearStoredLegacySession();\n  }\n\n  localStorage.removeItem(`${SESSION_ACCOUNT_PREFIX}${slot || 1}`);\n}\n\nfunction clearStoredLegacySession() {\n  [\n    SESSION_LEGACY_USER_KEY,\n    'dc',\n    ...DC_IDS.map((dcId) => `dc${dcId}_auth_key`),\n    ...DC_IDS.map((dcId) => `dc${dcId}_hash`),\n    ...DC_IDS.map((dcId) => `dc${dcId}_server_salt`),\n  ].forEach((key) => {\n    localStorage.removeItem(key);\n  });\n}\n\nexport function loadStoredSession(): ApiSessionData | undefined {\n  if (!hasStoredSession()) {\n    return undefined;\n  }\n\n  const slotData = loadSlotSession(ACCOUNT_SLOT);\n\n  if (!slotData) {\n    if (ACCOUNT_SLOT) return undefined;\n    return loadStoredLegacySession();\n  }\n\n  const sessionData: ApiSessionData = {\n    mainDcId: slotData.dcId,\n    keys: DC_IDS.reduce((acc, dcId) => {\n      const key = slotData[`dc${dcId}_auth_key` as const];\n      if (key) {\n        acc[dcId] = key;\n      }\n      return acc;\n    }, {} as Record<number, string>),\n    isTest: slotData.isTest || undefined,\n  };\n\n  return sessionData;\n}\n\nfunction loadStoredLegacySession(): ApiSessionData | undefined {\n  if (!hasStoredSession()) {\n    return undefined;\n  }\n\n  const userAuth = JSON.parse(localStorage.getItem(SESSION_LEGACY_USER_KEY) || 'null');\n  if (!userAuth) {\n    return undefined;\n  }\n  const mainDcId = Number(userAuth.dcID);\n  const isTest = userAuth.test;\n  const keys: Record<number, string> = {};\n\n  DC_IDS.forEach((dcId) => {\n    try {\n      const key = localStorage.getItem(`dc${dcId}_auth_key`);\n      if (key) {\n        keys[dcId] = JSON.parse(key);\n      }\n    } catch (err) {\n      if (DEBUG) {\n        // eslint-disable-next-line no-console\n        console.warn('Failed to load stored session', err);\n      }\n      // Do nothing.\n    }\n  });\n\n  if (!Object.keys(keys).length) return undefined;\n\n  return {\n    mainDcId,\n    keys,\n    isTest,\n  };\n}\n\nexport function loadSlotSession(slot: number | undefined): SharedSessionData | undefined {\n  try {\n    const data = JSON.parse(localStorage.getItem(`${SESSION_ACCOUNT_PREFIX}${slot || 1}`) || '{}') as SharedSessionData;\n    if (!data.dcId) return undefined;\n    return data;\n  } catch (e) {\n    return undefined;\n  }\n}\n\nexport function updateSessionUserId(currentUserId: string) {\n  const slotData = loadSlotSession(ACCOUNT_SLOT);\n  if (!slotData) return;\n  storeAccountData(ACCOUNT_SLOT, { userId: currentUserId });\n}\n\nexport function importTestSession() {\n  const sessionJson = process.env.TEST_SESSION!;\n  try {\n    const sessionData = JSON.parse(sessionJson) as ApiSessionData & { userId: string };\n    storeLegacySession(sessionData, sessionData.userId);\n  } catch (err) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('Failed to load test session', err);\n    }\n  }\n}\n\nexport function checkSessionLocked() {\n  return localStorage.getItem(IS_SCREEN_LOCKED_CACHE_KEY) === 'true';\n}\n","import QrPlane from '../../../assets/tgs/auth/QrPlane.tgs';\nimport BannedDuck from '../../../assets/tgs/BannedDuck.tgs';\nimport CameraFlip from '../../../assets/tgs/calls/CameraFlip.tgs';\nimport HandFilled from '../../../assets/tgs/calls/HandFilled.tgs';\nimport HandOutline from '../../../assets/tgs/calls/HandOutline.tgs';\nimport Speaker from '../../../assets/tgs/calls/Speaker.tgs';\nimport VoiceAllowTalk from '../../../assets/tgs/calls/VoiceAllowTalk.tgs';\nimport VoiceMini from '../../../assets/tgs/calls/VoiceMini.tgs';\nimport VoiceMuted from '../../../assets/tgs/calls/VoiceMuted.tgs';\nimport VoiceOutlined from '../../../assets/tgs/calls/VoiceOutlined.tgs';\nimport Diamond from '../../../assets/tgs/Diamond.tgs';\nimport DuckNothingFound from '../../../assets/tgs/DuckNothingFound.tgs';\nimport Flame from '../../../assets/tgs/general/Flame.tgs';\nimport Fragment from '../../../assets/tgs/general/Fragment.tgs';\nimport Mention from '../../../assets/tgs/general/Mention.tgs';\nimport PartyPopper from '../../../assets/tgs/general/PartyPopper.tgs';\nimport Invite from '../../../assets/tgs/invites/Invite.tgs';\nimport JoinRequest from '../../../assets/tgs/invites/Requests.tgs';\nimport LastSeen from '../../../assets/tgs/LastSeen.tgs';\nimport MonkeyClose from '../../../assets/tgs/monkeys/TwoFactorSetupMonkeyClose.tgs';\nimport MonkeyIdle from '../../../assets/tgs/monkeys/TwoFactorSetupMonkeyIdle.tgs';\nimport MonkeyPeek from '../../../assets/tgs/monkeys/TwoFactorSetupMonkeyPeek.tgs';\nimport MonkeyTracking from '../../../assets/tgs/monkeys/TwoFactorSetupMonkeyTracking.tgs';\nimport ReadTime from '../../../assets/tgs/ReadTime.tgs';\nimport Report from '../../../assets/tgs/Report.tgs';\nimport Search from '../../../assets/tgs/Search.tgs';\nimport SearchingDuck from '../../../assets/tgs/SearchingDuck.tgs';\nimport Congratulations from '../../../assets/tgs/settings/Congratulations.tgs';\nimport DiscussionGroups from '../../../assets/tgs/settings/DiscussionGroupsDucks.tgs';\nimport Experimental from '../../../assets/tgs/settings/Experimental.tgs';\nimport FoldersAll from '../../../assets/tgs/settings/FoldersAll.tgs';\nimport FoldersNew from '../../../assets/tgs/settings/FoldersNew.tgs';\nimport FoldersShare from '../../../assets/tgs/settings/FoldersShare.tgs';\nimport Lock from '../../../assets/tgs/settings/Lock.tgs';\nimport StarReaction from '../../../assets/tgs/stars/StarReaction.tgs';\nimport StarReactionEffect from '../../../assets/tgs/stars/StarReactionEffect.tgs';\nimport Unlock from '../../../assets/tgs/Unlock.tgs';\nimport DuckNothingFoundPreview from '../../../assets/tgs-previews/DuckNothingFound.svg';\nimport SearchPreview from '../../../assets/tgs-previews/Search.svg';\n\nexport const LOCAL_TGS_PREVIEW_URLS = {\n  DuckNothingFound: DuckNothingFoundPreview,\n  Search: SearchPreview,\n};\n\nexport const LOCAL_TGS_URLS = {\n  MonkeyIdle,\n  MonkeyTracking,\n  MonkeyClose,\n  MonkeyPeek,\n  FoldersAll,\n  FoldersNew,\n  FoldersShare,\n  DiscussionGroups,\n  Lock,\n  CameraFlip,\n  HandFilled,\n  HandOutline,\n  Speaker,\n  VoiceAllowTalk,\n  VoiceMini,\n  VoiceMuted,\n  VoiceOutlined,\n  JoinRequest,\n  Invite,\n  QrPlane,\n  Congratulations,\n  Experimental,\n  PartyPopper,\n  Flame,\n  ReadTime,\n  Unlock,\n  LastSeen,\n  Mention,\n  Fragment,\n  StarReactionEffect,\n  StarReaction,\n  Report,\n  SearchingDuck,\n  BannedDuck,\n  Diamond,\n  Search,\n  DuckNothingFound,\n};\n","const SAMPLE_RATE = 48000;\nconst BIT_DEPTH = 16;\n\nexport async function oggToWav(opusData: Blob): Promise<Blob> {\n  const arrayBuffer = await new Response(opusData).arrayBuffer();\n\n  return new Promise((resolve) => {\n    const typedArray = new Uint8Array(arrayBuffer);\n\n    let decoderWorker: Worker | undefined = new Worker(\n      new URL('opus-recorder/dist/decoderWorker.min.js', import.meta.url),\n    );\n    let wavWorker: Worker | undefined = new Worker(new URL('opus-recorder/dist/waveWorker.min.js', import.meta.url));\n\n    decoderWorker.onmessage = (e) => {\n      // eslint-disable-next-line no-null/no-null\n      if (e.data === null) {\n        // `null` means decoder is finished\n        wavWorker!.postMessage({ command: 'done' });\n      } else {\n        // `e.data` contains decoded buffers as float32 values\n        wavWorker!.postMessage(\n          {\n            command: 'encode',\n            buffers: e.data,\n          },\n          e.data.map(({ buffer }: Float32Array) => buffer),\n        );\n      }\n    };\n\n    wavWorker.onmessage = (e) => {\n      if (e.data.message === 'page') {\n        resolve(new Blob([e.data.page], { type: 'audio/wav' }));\n\n        decoderWorker!.terminate();\n        decoderWorker = undefined;\n        wavWorker!.terminate();\n        wavWorker = undefined;\n      }\n    };\n\n    wavWorker.postMessage({\n      command: 'init',\n      wavBitDepth: BIT_DEPTH,\n      wavSampleRate: SAMPLE_RATE,\n    });\n\n    decoderWorker.postMessage({\n      command: 'init',\n      decoderSampleRate: SAMPLE_RATE,\n      outputBufferSampleRate: SAMPLE_RATE,\n    });\n\n    decoderWorker.postMessage({\n      command: 'decode',\n      pages: typedArray,\n    }, [typedArray.buffer]);\n  });\n}\n","import type {\n  ApiOnProgress,\n  ApiParsedMedia,\n  ApiPreparedMedia,\n} from '../api/types';\nimport {\n  ApiMediaFormat,\n} from '../api/types';\n\nimport {\n  DEBUG, MEDIA_CACHE_DISABLED, MEDIA_CACHE_NAME,\n  MEDIA_CACHE_NAME_AVATARS,\n} from '../config';\nimport { callApi, cancelApiProgress } from '../api/gramjs';\nimport {\n  IS_OPUS_SUPPORTED, IS_PROGRESSIVE_SUPPORTED,\n} from './browser/windowEnvironment';\nimport * as cacheApi from './cacheApi';\nimport { fetchBlob } from './files';\nimport { ACCOUNT_SLOT } from './multiaccount';\nimport { oggToWav } from './oggToWav';\n\nconst asCacheApiType = {\n  [ApiMediaFormat.BlobUrl]: cacheApi.Type.Blob,\n  [ApiMediaFormat.Text]: cacheApi.Type.Text,\n  [ApiMediaFormat.DownloadUrl]: undefined,\n  [ApiMediaFormat.Progressive]: undefined,\n};\n\nconst PROGRESSIVE_URL_PREFIX = './progressive/';\nconst DOWNLOAD_URL_PREFIX = './download/';\nconst MAX_MEDIA_RETRIES = 5;\n\nconst memoryCache = new Map<string, ApiPreparedMedia>();\nconst fetchPromises = new Map<string, Promise<ApiPreparedMedia | undefined>>();\nconst progressCallbacks = new Map<string, Map<string, ApiOnProgress>>();\nconst cancellableCallbacks = new Map<string, ApiOnProgress>();\n\nexport function fetch<T extends ApiMediaFormat>(\n  url: string,\n  mediaFormat: T,\n  isHtmlAllowed = false,\n  onProgress?: ApiOnProgress,\n  callbackUniqueId?: string,\n): Promise<ApiPreparedMedia> {\n  if (mediaFormat === ApiMediaFormat.Progressive) {\n    return (\n      IS_PROGRESSIVE_SUPPORTED\n        ? Promise.resolve(getProgressiveUrl(url))\n        : fetch(url, ApiMediaFormat.BlobUrl, isHtmlAllowed, onProgress, callbackUniqueId)\n    );\n  }\n\n  if (mediaFormat === ApiMediaFormat.DownloadUrl) {\n    return (\n      IS_PROGRESSIVE_SUPPORTED\n        ? Promise.resolve(getDownloadUrl(url))\n        : fetch(url, ApiMediaFormat.BlobUrl, isHtmlAllowed, onProgress, callbackUniqueId)\n    );\n  }\n\n  if (!fetchPromises.has(url)) {\n    const promise = fetchFromCacheOrRemote(url, mediaFormat, isHtmlAllowed)\n      .catch((err) => {\n        if (DEBUG) {\n          // eslint-disable-next-line no-console\n          console.warn(err);\n        }\n\n        return undefined;\n      })\n      .finally(() => {\n        fetchPromises.delete(url);\n        progressCallbacks.delete(url);\n        cancellableCallbacks.delete(url);\n      });\n\n    fetchPromises.set(url, promise);\n  }\n\n  if (onProgress && callbackUniqueId) {\n    let activeCallbacks = progressCallbacks.get(url);\n    if (!activeCallbacks) {\n      activeCallbacks = new Map<string, ApiOnProgress>();\n      progressCallbacks.set(url, activeCallbacks);\n    }\n    activeCallbacks.set(callbackUniqueId, onProgress);\n  }\n\n  return fetchPromises.get(url) as Promise<ApiPreparedMedia>;\n}\n\nexport function getFromMemory(url: string) {\n  return memoryCache.get(url) as ApiPreparedMedia;\n}\n\nexport function cancelProgress(progressCallback: ApiOnProgress) {\n  progressCallbacks.forEach((map, url) => {\n    map.forEach((callback) => {\n      if (callback === progressCallback) {\n        const parentCallback = cancellableCallbacks.get(url);\n        if (!parentCallback) return;\n\n        cancelApiProgress(parentCallback);\n        cancellableCallbacks.delete(url);\n        progressCallbacks.delete(url);\n      }\n    });\n  });\n}\n\nexport function removeCallback(url: string, callbackUniqueId: string) {\n  const callbacks = progressCallbacks.get(url);\n  if (!callbacks) return;\n  callbacks.delete(callbackUniqueId);\n}\n\nexport function getProgressiveUrl(url: string) {\n  const base = new URL(`${PROGRESSIVE_URL_PREFIX}${url}`, window.location.href);\n  if (ACCOUNT_SLOT) base.searchParams.set('account', ACCOUNT_SLOT.toString());\n  return base.href;\n}\n\nfunction getDownloadUrl(url: string) {\n  const base = new URL(`${DOWNLOAD_URL_PREFIX}${url}`, window.location.href);\n  if (ACCOUNT_SLOT) base.searchParams.set('account', ACCOUNT_SLOT.toString());\n  return base.href;\n}\n\nasync function fetchFromCacheOrRemote(\n  url: string, mediaFormat: ApiMediaFormat, isHtmlAllowed: boolean, retryNumber = 0,\n): Promise<string> {\n  if (!MEDIA_CACHE_DISABLED) {\n    const cacheName = url.startsWith('avatar') ? MEDIA_CACHE_NAME_AVATARS : MEDIA_CACHE_NAME;\n    const cached = await cacheApi.fetch(cacheName, url, asCacheApiType[mediaFormat]!, isHtmlAllowed);\n\n    if (cached) {\n      let media = cached;\n\n      if (cached.type === 'audio/ogg' && !IS_OPUS_SUPPORTED) {\n        media = await oggToWav(media);\n      }\n\n      const prepared = prepareMedia(media);\n\n      memoryCache.set(url, prepared);\n\n      return prepared;\n    }\n  }\n\n  const onProgress = makeOnProgress(url);\n  cancellableCallbacks.set(url, onProgress);\n\n  const remote = await callApi('downloadMedia', { url, mediaFormat, isHtmlAllowed }, onProgress);\n  if (!remote) {\n    if (retryNumber >= MAX_MEDIA_RETRIES) {\n      throw new Error(`Failed to fetch media ${url}`);\n    }\n    await new Promise((resolve) => {\n      setTimeout(resolve, getRetryTimeout(retryNumber));\n    });\n    // eslint-disable-next-line no-console\n    if (DEBUG) console.debug(`Retrying to fetch media ${url}`);\n    return fetchFromCacheOrRemote(url, mediaFormat, isHtmlAllowed, retryNumber + 1);\n  }\n\n  let { mimeType } = remote;\n  let prepared = prepareMedia(remote.dataBlob);\n\n  if (mimeType === 'audio/ogg' && !IS_OPUS_SUPPORTED) {\n    const blob = await fetchBlob(prepared);\n    URL.revokeObjectURL(prepared);\n    const media = await oggToWav(blob);\n    prepared = prepareMedia(media);\n    mimeType = media.type;\n  }\n\n  memoryCache.set(url, prepared);\n\n  return prepared;\n}\n\nfunction makeOnProgress(url: string) {\n  const onProgress: ApiOnProgress = (progress: number) => {\n    progressCallbacks.get(url)?.forEach((callback) => {\n      callback(progress);\n      if (callback.isCanceled) onProgress.isCanceled = true;\n    });\n  };\n\n  return onProgress;\n}\n\nfunction prepareMedia(mediaData: Exclude<ApiParsedMedia, ArrayBuffer>): ApiPreparedMedia {\n  if (mediaData instanceof Blob) {\n    return URL.createObjectURL(mediaData);\n  }\n\n  return mediaData;\n}\n\nif (IS_PROGRESSIVE_SUPPORTED) {\n  navigator.serviceWorker.addEventListener('message', async (e) => {\n    const { type, messageId, params } = e.data as {\n      type: string;\n      messageId: string;\n      params: { url: string; start: number; end: number };\n    };\n\n    if (type !== 'requestPart') {\n      return;\n    }\n\n    async function downloadWithRetry(retryNumber = 0) {\n      const result = await callApi('downloadMedia', { mediaFormat: ApiMediaFormat.Progressive, ...params });\n      if (!result) {\n        if (retryNumber >= MAX_MEDIA_RETRIES) {\n          if (DEBUG) {\n            // eslint-disable-next-line no-console\n            console.warn(`Failed to download media part after ${MAX_MEDIA_RETRIES} retries:`, params.url);\n          }\n          return undefined;\n        }\n        await new Promise((resolve) => {\n          setTimeout(resolve, getRetryTimeout(retryNumber));\n        });\n        if (DEBUG) {\n          // eslint-disable-next-line no-console\n          console.debug(`Retrying to download media part ${params.url}, attempt ${retryNumber + 1}`);\n        }\n        return downloadWithRetry(retryNumber + 1);\n      }\n      return result;\n    }\n\n    const result = await downloadWithRetry();\n    if (!result) {\n      return;\n    }\n\n    const { arrayBuffer, mimeType, fullSize } = result;\n\n    navigator.serviceWorker.controller!.postMessage({\n      type: 'partResponse',\n      messageId,\n      result: {\n        arrayBuffer,\n        mimeType,\n        fullSize,\n      },\n    }, [arrayBuffer!]);\n  });\n}\n\nfunction getRetryTimeout(retryNumber: number) {\n  // 250ms, 500ms, 1s, 2s, 4s\n  return 250 * 2 ** retryNumber;\n}\n","import { getGlobal } from '../../../../global';\n\nimport type { ApiMessageEntityCustomEmoji, ApiSticker } from '../../../../api/types';\nimport { ApiMessageEntityTypes } from '../../../../api/types';\n\nimport { EMOJI_SIZES } from '../../../../config';\nimport { selectCustomEmoji } from '../../../../global/selectors';\nimport buildClassName from '../../../../util/buildClassName';\nimport { getInputCustomEmojiParams } from '../../../../util/emoji/customEmojiManager';\nimport { REM } from '../../../common/helpers/mediaDimensions';\n\nexport const INPUT_CUSTOM_EMOJI_SELECTOR = 'img[data-document-id]';\n\nexport function buildCustomEmojiHtml(emoji: ApiSticker) {\n  const [isPlaceholder, src, uniqueId] = getInputCustomEmojiParams(emoji);\n\n  const className = buildClassName(\n    'custom-emoji', 'emoji', 'emoji-small', isPlaceholder && 'placeholder', emoji.shouldUseTextColor && 'colorable',\n  );\n\n  return `<img\n    class=\"${className}\"\n    draggable=\"false\"\n    alt=\"${emoji.emoji}\"\n    data-document-id=\"${emoji.id}\"\n    ${uniqueId ? `data-unique-id=\"${uniqueId}\"` : ''}\n    data-entity-type=\"${ApiMessageEntityTypes.CustomEmoji}\"\n    src=\"${src}\"\n  />`;\n}\n\nexport function buildCustomEmojiHtmlFromEntity(rawText: string, entity: ApiMessageEntityCustomEmoji) {\n  const customEmoji = selectCustomEmoji(getGlobal(), entity.documentId);\n  const [isPlaceholder, src, uniqueId] = getInputCustomEmojiParams(customEmoji);\n\n  const className = buildClassName(\n    'custom-emoji',\n    'emoji',\n    'emoji-small',\n    isPlaceholder && 'placeholder',\n    customEmoji?.shouldUseTextColor && 'colorable',\n  );\n\n  return `<img\n    class=\"${className}\"\n    draggable=\"false\"\n    alt=\"${rawText}\"\n    data-document-id=\"${entity.documentId}\"\n    ${uniqueId ? `data-unique-id=\"${uniqueId}\"` : ''}\n    data-entity-type=\"${ApiMessageEntityTypes.CustomEmoji}\"\n    src=\"${src}\"\n  />`;\n}\n\nexport function getCustomEmojiSize(maxEmojisInLine?: number): number | undefined {\n  if (!maxEmojisInLine) return undefined;\n\n  // Should be the same as in _message-content.scss\n  if (maxEmojisInLine > EMOJI_SIZES) return 2.25 * REM;\n  if (maxEmojisInLine === 1) return 7 * REM;\n  return Math.min(7.5 - (maxEmojisInLine * 0.75), 5.625) * REM;\n}\n","export default function trimText<T extends string | undefined>(text: T, length?: number) {\n  if (!text || !length || text.length <= length) {\n    return text;\n  }\n\n  return `${text.substring(0, length)}...`;\n}\n","import * as langProvider from '../util/oldLangProvider';\nimport useEffectOnce from './useEffectOnce';\nimport useForceUpdate from './useForceUpdate';\n\nexport type OldLangFn = langProvider.LangFn;\n/**\n * @deprecated\n */\nconst useOldLang = (): OldLangFn => {\n  const forceUpdate = useForceUpdate();\n\n  useEffectOnce(() => {\n    return langProvider.addCallback(forceUpdate);\n  });\n\n  return langProvider.getTranslationFn();\n};\n\nexport default useOldLang;\n","import { onFullyIdle } from '../../lib/teact/teact';\nimport { addCallback } from '../../lib/teact/teactn';\nimport { getActions, getGlobal, setGlobal } from '../../global';\n\nimport type { LocalDb } from '../../api/gramjs/localDb';\nimport type { MethodArgs, Methods } from '../../api/gramjs/methods/types';\nimport type { ApiInitialArgs } from '../../api/types';\nimport type { GlobalState } from '../../global/types';\n\nimport { selectTabState } from '../../global/selectors';\nimport {\n  callApiLocal,\n  cancelApiProgressMaster,\n  handleMethodCallback,\n  handleMethodResponse,\n  initApi,\n  updateFullLocalDb,\n  updateLocalDb,\n} from '../../api/gramjs';\nimport { deepDiff } from '../deepDiff';\nimport { deepMerge } from '../deepMerge';\nimport { getCurrentTabId, signalPasscodeHash, subscribeToTokenDied } from '../establishMultitabRole';\nimport { omit } from '../iteratees';\nimport { DATA_BROADCAST_CHANNEL_NAME, MULTITAB_STORAGE_KEY } from '../multiaccount';\n\ntype BroadcastChannelRefreshLangpack = {\n  type: 'langpackRefresh';\n  langCode: string;\n};\n\ntype BroadcastChannelRequestGlobal = {\n  type: 'requestGlobal';\n  token?: number;\n  appVersion: string;\n};\n\ntype BroadcastChannelGlobalUpdate = {\n  type: 'globalUpdate';\n  global: GlobalState;\n};\n\ntype BroadcastChannelCancelApiProgress = {\n  type: 'cancelApiProgress';\n  token: number;\n  messageId: string;\n};\n\ntype BroadcastChannelCallApi = {\n  type: 'callApi';\n  token: number;\n  messageId: string;\n  name: keyof Methods;\n  args: MethodArgs<keyof Methods>;\n  withCallback?: boolean;\n};\n\ntype BroadcastChannelMessageResponse = {\n  type: 'messageResponse';\n  token: number;\n  messageId: string;\n  response: any;\n};\n\ntype BroadcastChannelLocalDbUpdate = {\n  type: 'localDbUpdate';\n  batchedUpdates: {\n    name: keyof LocalDb;\n    prop: string;\n    value: any;\n  }[];\n};\n\ntype BroadcastChannelLocalDbUpdateFull = {\n  type: 'localDbUpdateFull';\n  localDb: any;\n};\n\ntype BroadcastChannelMessageCallback = {\n  type: 'messageCallback';\n  token: number;\n  messageId: string;\n  callbackArgs: any;\n};\n\ntype BroadcastChannelGlobalDiff = {\n  type: 'globalDiffUpdate';\n  diff: any;\n};\n\ntype BroadcastChannelInitApi = {\n  type: 'initApi';\n  token: number;\n  initialArgs: ApiInitialArgs;\n};\n\nconst MULTITAB_ESTABLISH_TIMEOUT = 800;\n\nexport type TypedBroadcastChannel = {\n  postMessage: (message: BroadcastChannelMessage) => void;\n  addEventListener: (type: 'message', listener: (event: { data: BroadcastChannelMessage }) => void) => void;\n  removeEventListener: (type: 'message', listener: (event: { data: BroadcastChannelMessage }) => void) => void;\n};\n\ntype BroadcastChannelMessage = (\n  BroadcastChannelRequestGlobal | BroadcastChannelGlobalUpdate | BroadcastChannelCallApi |\n  BroadcastChannelMessageResponse | BroadcastChannelRefreshLangpack |\n  BroadcastChannelMessageCallback | BroadcastChannelCancelApiProgress | BroadcastChannelLocalDbUpdate |\n  BroadcastChannelLocalDbUpdateFull | BroadcastChannelGlobalDiff | BroadcastChannelInitApi\n);\n\nlet resolveGlobalPromise: VoidFunction | undefined;\nlet isFirstGlobalResolved = false;\nlet currentGlobal: GlobalState | undefined;\nlet isDisabled = false;\n\nconst channel = new BroadcastChannel(DATA_BROADCAST_CHANNEL_NAME) as TypedBroadcastChannel;\n\nlet isBroadcastDiffScheduled = false;\nlet lastBroadcastDiffGlobal: GlobalState | undefined;\n\nfunction broadcastDiffOnIdle() {\n  if (isBroadcastDiffScheduled) return;\n\n  isBroadcastDiffScheduled = true;\n  lastBroadcastDiffGlobal = currentGlobal;\n\n  onFullyIdle(() => {\n    const diff = deepDiff(lastBroadcastDiffGlobal, currentGlobal);\n\n    if (typeof diff !== 'symbol') {\n      channel.postMessage({\n        type: 'globalDiffUpdate',\n        diff,\n      });\n    }\n\n    isBroadcastDiffScheduled = false;\n  });\n}\n\nexport function unsubcribeFromMultitabBroadcastChannel() {\n  channel.removeEventListener('message', handleMessage);\n  isDisabled = true;\n}\n\nexport function subscribeToMultitabBroadcastChannel() {\n  subscribeToTokenDied((token) => {\n    if (token === getCurrentTabId()) {\n      unsubcribeFromMultitabBroadcastChannel();\n      const global = getGlobal();\n      const newGlobal = {\n        ...global,\n        byTabId: omit(global.byTabId, [token]),\n      };\n\n      const diff = deepDiff(global, newGlobal);\n\n      if (typeof diff !== 'symbol') {\n        channel.postMessage({\n          type: 'globalDiffUpdate',\n          diff,\n        });\n      }\n      return;\n    }\n    let global = getGlobal();\n    global = {\n      ...global,\n      byTabId: omit(global.byTabId, [token]),\n    };\n\n    setGlobal(global);\n  });\n\n  addCallback((global: GlobalState) => {\n    if (!isFirstGlobalResolved || isDisabled) {\n      currentGlobal = global;\n      return;\n    }\n\n    if (currentGlobal === global) {\n      return;\n    }\n\n    if (!currentGlobal) {\n      currentGlobal = global;\n      channel.postMessage({\n        type: 'globalUpdate',\n        global,\n      });\n      return;\n    }\n\n    broadcastDiffOnIdle();\n\n    currentGlobal = global;\n  });\n\n  channel.addEventListener('message', handleMessage);\n}\n\nexport function handleMessage({ data }: { data: BroadcastChannelMessage }) {\n  if (!data) return;\n\n  switch (data.type) {\n    case 'initApi': {\n      const global = getGlobal();\n      if (!selectTabState(global).isMasterTab) return;\n\n      const { initialArgs } = data;\n      initApi(getActions().apiUpdate, initialArgs);\n      break;\n    }\n\n    case 'globalDiffUpdate': {\n      if (!isFirstGlobalResolved) return;\n      const { diff } = data;\n      const oldGlobal = getGlobal();\n      const global = deepMerge(oldGlobal, diff);\n\n      // @ts-ignore\n      global.DEBUG_randomId = oldGlobal.DEBUG_randomId;\n\n      currentGlobal = global;\n      setGlobal(global);\n      break;\n    }\n\n    case 'globalUpdate': {\n      if (isFirstGlobalResolved) return;\n      const oldGlobal = getGlobal();\n      // @ts-ignore\n      data.global.DEBUG_randomId = oldGlobal.DEBUG_randomId;\n      currentGlobal = data.global;\n      // eslint-disable-next-line tt-multitab/set-global-only-variable\n      setGlobal(data.global);\n      if (resolveGlobalPromise) {\n        resolveGlobalPromise();\n        resolveGlobalPromise = undefined;\n        isFirstGlobalResolved = true;\n      }\n      break;\n    }\n\n    case 'requestGlobal': {\n      const { appVersion } = data;\n      if (appVersion !== APP_VERSION) {\n        // If app version on the other tab was updated, reload the current page immediately and don't respond\n        // to the other tab's request because our current global might be incompatible with the new version\n        window.location.reload();\n        return;\n      }\n\n      if (!isFirstGlobalResolved) return;\n      const global = getGlobal();\n\n      if (!selectTabState(global).isMasterTab) return;\n\n      channel.postMessage({\n        type: 'globalUpdate',\n        global,\n      });\n\n      signalPasscodeHash();\n      break;\n    }\n\n    case 'messageCallback': {\n      if (!isFirstGlobalResolved) return;\n      const global = getGlobal();\n      if (selectTabState(global).isMasterTab) return;\n\n      handleMethodCallback(data);\n      break;\n    }\n\n    case 'localDbUpdate': {\n      if (!isFirstGlobalResolved) return;\n      const global = getGlobal();\n      if (selectTabState(global).isMasterTab) return;\n\n      const {\n        batchedUpdates,\n      } = data;\n\n      batchedUpdates.forEach(({\n        name,\n        prop,\n        value,\n      }) => {\n        updateLocalDb(name, prop, value);\n      });\n      break;\n    }\n\n    case 'localDbUpdateFull': {\n      if (!isFirstGlobalResolved) return;\n      const global = getGlobal();\n      if (selectTabState(global).isMasterTab) return;\n\n      const { localDb } = data;\n\n      updateFullLocalDb(localDb);\n      break;\n    }\n\n    case 'messageResponse': {\n      if (!isFirstGlobalResolved) return;\n      const global = getGlobal();\n\n      if (selectTabState(global).isMasterTab) return;\n\n      handleMethodResponse(data);\n      break;\n    }\n\n    case 'cancelApiProgress': {\n      if (!isFirstGlobalResolved) return;\n      const global = getGlobal();\n      if (!selectTabState(global).isMasterTab) return;\n\n      const { messageId } = data;\n\n      cancelApiProgressMaster(messageId);\n      break;\n    }\n\n    case 'callApi': {\n      if (!isFirstGlobalResolved) return;\n      const global = getGlobal();\n      if (!selectTabState(global).isMasterTab) return;\n\n      const {\n        name, messageId, token, args, withCallback,\n      } = data;\n\n      const argsWithCallback = (withCallback ? [...args, (...callbackArgs: any[]) => {\n        channel.postMessage({\n          type: 'messageCallback',\n          token,\n          messageId,\n          callbackArgs,\n        });\n      }] : args) as MethodArgs<keyof Methods>;\n\n      (async () => {\n        const result = await (callApiLocal(name, ...argsWithCallback));\n\n        channel.postMessage({\n          type: 'messageResponse',\n          token,\n          messageId,\n          response: result,\n        });\n      })();\n\n      break;\n    }\n\n    case 'langpackRefresh': {\n      getActions().refreshLangPackFromCache({ langCode: data.langCode });\n      break;\n    }\n  }\n}\n\nexport function requestGlobal(appVersion: string): Promise<void> {\n  channel.postMessage({\n    type: 'requestGlobal',\n    appVersion,\n  });\n\n  const resolveWithoutGlobal = () => {\n    if (resolveGlobalPromise) {\n      resolveGlobalPromise();\n      resolveGlobalPromise = undefined;\n    }\n    isFirstGlobalResolved = true;\n  };\n\n  if (localStorage.getItem(MULTITAB_STORAGE_KEY)) {\n    setTimeout(resolveWithoutGlobal, MULTITAB_ESTABLISH_TIMEOUT);\n  } else {\n    resolveWithoutGlobal();\n    return Promise.resolve();\n  }\n\n  return new Promise((resolve) => {\n    resolveGlobalPromise = resolve;\n  });\n}\n\nexport function notifyLangpackUpdate(langCode: string) {\n  channel.postMessage({\n    type: 'langpackRefresh',\n    langCode,\n  });\n}\n","import type { ApiThemeParameters } from '../api/types';\n\nexport function extractCurrentThemeParams(): ApiThemeParameters {\n  const style = getComputedStyle(document.documentElement);\n\n  const backgroundColor = getPropertyHexColor(style, '--color-background')!;\n  const secondaryTextColor = getPropertyHexColor(style, '--color-text-secondary')!;\n\n  const bgColor = backgroundColor;\n  const textColor = getPropertyHexColor(style, '--color-text')!;\n  const buttonColor = getPropertyHexColor(style, '--color-primary')!;\n  const buttonTextColor = getPropertyHexColor(style, '--color-white')!;\n  const linkColor = getPropertyHexColor(style, '--color-links')!;\n  const hintColor = secondaryTextColor;\n  const secondaryBgColor = getPropertyHexColor(style, '--color-background-secondary')!;\n  const sectionSeparatorColor = getPropertyHexColor(style, '--color-divider')!;\n\n  const headerBgColor = backgroundColor;\n  const accentTextColor = getPropertyHexColor(style, '--color-primary')!;\n  const sectionBgColor = backgroundColor;\n  const sectionHeaderTextColor = secondaryTextColor;\n  const subtitleTextColor = hintColor;\n  const destructiveTextColor = getPropertyHexColor(style, '--color-error')!;\n\n  return {\n    bg_color: bgColor,\n    text_color: textColor,\n    hint_color: hintColor,\n    link_color: linkColor,\n    button_color: buttonColor,\n    button_text_color: buttonTextColor,\n    secondary_bg_color: secondaryBgColor,\n    header_bg_color: headerBgColor,\n    accent_text_color: accentTextColor,\n    section_bg_color: sectionBgColor,\n    section_header_text_color: sectionHeaderTextColor,\n    subtitle_text_color: subtitleTextColor,\n    destructive_text_color: destructiveTextColor,\n    section_separator_color: sectionSeparatorColor,\n  };\n}\n\nexport function validateHexColor(color: string) {\n  return /^#[0-9A-F]{6}$/i.test(color);\n}\n\nexport function getPropertyHexColor(style: CSSStyleDeclaration, property: string) {\n  const value = style.getPropertyValue(property);\n  if (!value) return undefined;\n  return prepareHexColor(value.trim());\n}\n\nexport function prepareHexColor(color: string) {\n  if (validateHexColor(color)) return color;\n  return `#${color.match(/^rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*(\\d+\\.{0,1}\\d*))?\\)$/)!\n    .slice(1)\n    .map((n: string, i: number) => (i === 3 ? Math.round(parseFloat(n) * 255) : parseFloat(n))\n      .toString(16)\n      .padStart(2, '0')\n      .replace('NaN', ''))\n    .join('')}`;\n}\n","import { getGlobal } from '../global';\n\nimport type { ApiOldLangPack, ApiOldLangString } from '../api/types';\nimport type { LangCode, TimeFormat } from '../types';\n\nimport {\n  LANG_CACHE_NAME, LANG_PACKS,\n} from '../config';\nimport { selectSharedSettings } from '../global/selectors/sharedState';\nimport { callApi } from '../api/gramjs';\nimport * as cacheApi from './cacheApi';\nimport { createCallbackManager } from './callbacks';\nimport { loadAndChangeLanguage } from './localization';\nimport { formatInteger } from './textFormat';\n\nexport interface LangFn {\n  (key: string, value?: any, format?: 'i', pluralValue?: number): string;\n\n  isRtl?: boolean;\n  code?: LangCode;\n  langName?: string;\n  timeFormat?: TimeFormat;\n}\n\nconst SUBSTITUTION_REGEX = /%\\d?\\$?[sdf@]/g;\nconst PLURAL_OPTIONS = ['value', 'zeroValue', 'oneValue', 'twoValue', 'fewValue', 'manyValue', 'otherValue'] as const;\n// Some rules edited from https://github.com/eemeli/make-plural/blob/master/packages/plurals/cardinals.js\nconst PLURAL_RULES = {\n  /* eslint-disable @stylistic/max-len */\n  en: (n: number) => (n !== 1 ? 6 : 2),\n  ar: (n: number) => (n === 0 ? 1 : n === 1 ? 2 : n === 2 ? 3 : n % 100 >= 3 && n % 100 <= 10 ? 4 : n % 100 >= 11 ? 5 : 6),\n  be: (n: number) => {\n    const s = String(n).split('.');\n    const t0 = Number(s[0]) === n;\n    const n10 = t0 ? Number(s[0].slice(-1)) : 0;\n    const n100 = t0 ? Number(s[0].slice(-2)) : 0;\n    return n10 === 1 && n100 !== 11\n      ? 2\n      : (n10 >= 2 && n10 <= 4) && (n100 < 12 || n100 > 14)\n        ? 4\n        : (t0 && n10 === 0) || (n10 >= 5 && n10 <= 9) || (n100 >= 11 && n100 <= 14)\n          ? 5\n          : 6;\n  },\n  ca: (n: number) => (n !== 1 ? 6 : 2),\n  cs: (n: number) => {\n    const s = String(n).split('.');\n    const i = Number(s[0]);\n    const v0 = !s[1];\n    return n === 1 && v0 ? 2 : (i >= 2 && i <= 4) && v0 ? 4 : !v0 ? 5 : 6;\n  },\n  de: (n: number) => (n !== 1 ? 6 : 2),\n  es: (n: number) => (n !== 1 ? 6 : 2),\n  fa: (n: number) => (n > 1 ? 6 : 2),\n  fi: (n: number) => (n !== 1 ? 6 : 2),\n  fr: (n: number) => (n > 1 ? 6 : 2),\n  id: () => 0,\n  it: (n: number) => (n !== 1 ? 6 : 2),\n  hr: (n: number) => {\n    const s = String(n).split('.');\n    const i = s[0];\n    const f = s[1] || '';\n    const v0 = !s[1];\n    const i10 = Number(i.slice(-1));\n    const i100 = Number(i.slice(-2));\n    const f10 = Number(f.slice(-1));\n    const f100 = Number(f.slice(-2));\n    return (v0 && i10 === 1 && i100 !== 11) || (f10 === 1 && f100 !== 11) ? 2\n      : (v0 && (i10 >= 2 && i10 <= 4) && (i100 < 12 || i100 > 14)) || ((f10 >= 2 && f10 <= 4) && (f100 < 12 || f100 > 14)) ? 4\n        : 6;\n  },\n  hu: (n: number) => (n > 1 ? 6 : 2),\n  ko: () => 0,\n  ms: () => 0,\n  nb: (n: number) => (n > 1 ? 6 : 2),\n  nl: (n: number) => (n !== 1 ? 6 : 2),\n  pl: (n: number) => (n === 1 ? 2 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 4 : 5),\n  'pt-br': (n: number) => (n > 1 ? 6 : 2),\n  ru: (n: number) => (n % 10 === 1 && n % 100 !== 11 ? 2 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 4 : 5),\n  sk: (n: number) => {\n    const s = String(n).split('.');\n    const i = Number(s[0]);\n    const v0 = !s[1];\n    return n === 1 && v0 ? 2 : (i >= 2 && i <= 4) && v0 ? 4 : !v0 ? 5 : 6;\n  },\n  sr: (n: number) => {\n    const s = String(n).split('.');\n    const i = s[0];\n    const f = s[1] || '';\n    const v0 = !s[1];\n    const i10 = Number(i.slice(-1));\n    const i100 = Number(i.slice(-2));\n    const f10 = Number(f.slice(-1));\n    const f100 = Number(f.slice(-2));\n    return (v0 && i10 === 1 && i100 !== 11) || (f10 === 1 && f100 !== 11) ? 2\n      : (v0 && (i10 >= 2 && i10 <= 4) && (i100 < 12 || i100 > 14)) || ((f10 >= 2 && f10 <= 4) && (f100 < 12 || f100 > 14)) ? 4\n        : 6;\n  },\n  tr: (n: number) => (n > 1 ? 6 : 2),\n  uk: (n: number) => (n % 10 === 1 && n % 100 !== 11 ? 2 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 4 : 5),\n  uz: (n: number) => (n > 1 ? 6 : 2),\n  /* eslint-enable @stylistic/max-len */\n};\n\nconst cache = new Map<string, string>();\n\nlet langPack: ApiOldLangPack | undefined;\nlet fallbackLangPack: ApiOldLangPack | undefined;\n\nconst {\n  addCallback,\n  removeCallback,\n  runCallbacks,\n} = createCallbackManager();\n\nexport { addCallback, removeCallback };\n\nlet currentLangCode: string | undefined;\nlet currentTimeFormat: TimeFormat | undefined;\n\nfunction createLangFn() {\n  return (key: string, value?: any, format?: 'i', pluralValue?: number) => {\n    if (value !== undefined) {\n      const cacheValue = Array.isArray(value) ? JSON.stringify(value) : value;\n      const cached = cache.get(`${key}_${cacheValue}_${format}${pluralValue ? `_${pluralValue}` : ''}`);\n      if (cached) {\n        return cached;\n      }\n    }\n\n    if (!fallbackLangPack) {\n      void importFallbackLangPack();\n    }\n\n    const langString = langPack?.[key] || fallbackLangPack?.[key];\n    if (!langString) {\n      return key;\n    }\n\n    return processTranslation(langString, key, value, format, pluralValue);\n  };\n}\n\nlet translationFn: LangFn = createLangFn();\n\n/**\n * @deprecated Do not translate inside non-reactive contexts. Pass parameters to the component instead\n */\nexport function oldTranslate(...args: Parameters<LangFn>) {\n  return translationFn(...args);\n}\n\nexport function getTranslationFn(): LangFn {\n  return translationFn;\n}\n\n/**\n * @deprecated Migrate to `changeLanguage` in `util/localization.ts` instead\n */\nexport async function oldSetLanguage(langCode: LangCode, callback?: NoneToVoidFunction, withFallback = false) {\n  loadAndChangeLanguage(langCode, true);\n  if (langPack && langCode === currentLangCode) {\n    if (callback) {\n      callback();\n    }\n\n    return;\n  }\n\n  let newLangPack = await cacheApi.fetch(LANG_CACHE_NAME, langCode, cacheApi.Type.Json);\n  if (!newLangPack) {\n    if (withFallback) {\n      await importFallbackLangPack();\n    }\n\n    newLangPack = await fetchRemote(langCode);\n    if (!newLangPack) {\n      return;\n    }\n  }\n\n  cache.clear();\n\n  currentLangCode = langCode;\n  langPack = newLangPack;\n  document.documentElement.lang = langCode;\n\n  const global = getGlobal();\n  const { languages, timeFormat } = selectSharedSettings(global);\n  const langInfo = languages?.find((lang) => lang.langCode === langCode);\n  translationFn = createLangFn();\n  translationFn.isRtl = Boolean(langInfo?.isRtl);\n  translationFn.code = langCode.replace('-raw', '') as LangCode;\n  translationFn.langName = langInfo?.nativeName;\n  translationFn.timeFormat = timeFormat;\n\n  if (callback) {\n    callback();\n  }\n\n  runCallbacks();\n}\n\nexport function setTimeFormat(timeFormat: TimeFormat) {\n  if (timeFormat && timeFormat === currentTimeFormat) {\n    return;\n  }\n\n  currentTimeFormat = timeFormat;\n  translationFn.timeFormat = timeFormat;\n\n  runCallbacks();\n}\n\nasync function importFallbackLangPack() {\n  if (fallbackLangPack) {\n    return;\n  }\n\n  fallbackLangPack = (await import('./fallbackLangPack')).default;\n  runCallbacks();\n}\n\nasync function fetchRemote(langCode: string): Promise<ApiOldLangPack | undefined> {\n  const remote = await callApi('oldFetchLangPack', { sourceLangPacks: LANG_PACKS, langCode });\n  if (remote) {\n    await cacheApi.save(LANG_CACHE_NAME, langCode, remote.langPack);\n    return remote.langPack;\n  }\n\n  return undefined;\n}\n\nfunction getPluralOption(amount: number) {\n  const langCode = currentLangCode || 'en';\n  const optionIndex = PLURAL_RULES[langCode as keyof typeof PLURAL_RULES]\n    ? PLURAL_RULES[langCode as keyof typeof PLURAL_RULES](amount)\n    : 0;\n\n  return PLURAL_OPTIONS[optionIndex];\n}\n\nfunction processTemplate(template: string, value: any) {\n  value = Array.isArray(value) ? value : [value];\n  const translationSlices = template.split(SUBSTITUTION_REGEX);\n  const initialValue = translationSlices.shift();\n\n  return translationSlices.reduce((result, str, index) => {\n    return `${result}${String(value[index] ?? '')}${str}`;\n  }, initialValue || '');\n}\n\nfunction processTranslation(\n  langString: ApiOldLangString | undefined, key: string, value?: any, format?: 'i', pluralValue?: number,\n) {\n  const preferredPluralOption = typeof value === 'number' || pluralValue !== undefined\n    ? getPluralOption(pluralValue ?? value)\n    : 'value';\n  const template = typeof langString === 'string'\n    ? langString\n    : preferredPluralOption === 'value'\n      // Support cached older `langString` interface\n      ? (typeof langString === 'object' ? (langString as any).value : langString)\n      : typeof langString === 'object'\n        ? langString[preferredPluralOption] || langString.otherValue\n        : undefined;\n\n  if (!template?.trim()) {\n    const parts = key.split('.');\n\n    return parts[parts.length - 1];\n  }\n\n  if (value !== undefined) {\n    const formattedValue = format === 'i' ? formatInteger(value) : value;\n    const result = processTemplate(template, formattedValue);\n    const cacheValue = Array.isArray(value) ? JSON.stringify(value) : value;\n    cache.set(`${key}_${cacheValue}_${format}${pluralValue ? `_${pluralValue}` : ''}`, result);\n    return result;\n  }\n\n  return template;\n}\n","import { addCallback } from '../../lib/teact/teactn';\nimport { getGlobal } from '../../global';\n\nimport type { ApiSticker } from '../../api/types';\nimport type { GlobalState } from '../../global/types';\nimport { ApiMediaFormat } from '../../api/types';\n\nimport { requestMutation } from '../../lib/fasterdom/fasterdom';\nimport { getStickerHashById } from '../../global/helpers';\nimport { selectCanPlayAnimatedEmojis, selectCustomEmoji } from '../../global/selectors';\nimport { IS_WEBM_SUPPORTED } from '../browser/windowEnvironment';\nimport { createCallbackManager } from '../callbacks';\nimport generateUniqueId from '../generateUniqueId';\nimport * as mediaLoader from '../mediaLoader';\nimport { throttle } from '../schedulers';\n\nimport blankSrc from '../../assets/blank.png';\nimport placeholderSrc from '../../assets/square.svg';\n\ntype CustomEmojiLoadCallback = (customEmojis: GlobalState['customEmojis']) => void;\ntype CustomEmojiInputRenderCallback = (emojiId: string) => void;\n\nconst DOM_PROCESS_THROTTLE = 500;\n\nconst INPUT_WAITING_CUSTOM_EMOJI_IDS = new Set<string>();\n\nconst handlers = new Map<CustomEmojiLoadCallback, string>();\nconst renderCallbacks = createCallbackManager<CustomEmojiInputRenderCallback>();\n\nlet prevGlobal: GlobalState | undefined;\n\naddCallback((global: GlobalState) => {\n  if (\n    global.customEmojis.byId !== prevGlobal?.customEmojis.byId\n    || selectCanPlayAnimatedEmojis(global) !== selectCanPlayAnimatedEmojis(prevGlobal)\n  ) {\n    for (const entry of handlers) {\n      const [handler, id] = entry;\n      if (selectCustomEmoji(global, id)) {\n        handler(global.customEmojis);\n      }\n    }\n\n    checkInputCustomEmojiLoad(global.customEmojis);\n  }\n\n  prevGlobal = global;\n});\n\nexport function addCustomEmojiCallback(handler: CustomEmojiLoadCallback, emojiId: string) {\n  handlers.set(handler, emojiId);\n}\n\nexport function removeCustomEmojiCallback(handler: CustomEmojiLoadCallback) {\n  handlers.delete(handler);\n}\n\nexport const addCustomEmojiInputRenderCallback = renderCallbacks.addCallback;\nconst callInputRenderHandlers = throttle(renderCallbacks.runCallbacks, DOM_PROCESS_THROTTLE);\n\nfunction processDomForCustomEmoji() {\n  const emojis = document.querySelectorAll<HTMLImageElement>('.custom-emoji.placeholder');\n  emojis.forEach((emoji) => {\n    const customEmoji = selectCustomEmoji(getGlobal(), emoji.dataset.documentId!);\n    if (!customEmoji) {\n      INPUT_WAITING_CUSTOM_EMOJI_IDS.add(emoji.dataset.documentId!);\n      return;\n    }\n    const [isPlaceholder, src, uniqueId] = getInputCustomEmojiParams(customEmoji);\n\n    if (customEmoji.shouldUseTextColor && !emoji.classList.contains('colorable')) {\n      requestMutation(() => {\n        emoji.classList.add('colorable');\n      });\n    }\n\n    if (!isPlaceholder) {\n      requestMutation(() => {\n        emoji.src = src;\n        emoji.classList.remove('placeholder');\n        if (uniqueId) emoji.dataset.uniqueId = uniqueId;\n\n        callInputRenderHandlers(customEmoji.id);\n      });\n    }\n  });\n}\n\nexport const processMessageInputForCustomEmoji = throttle(processDomForCustomEmoji, DOM_PROCESS_THROTTLE);\n\nfunction checkInputCustomEmojiLoad(customEmojis: GlobalState['customEmojis']) {\n  const loaded = Array.from(INPUT_WAITING_CUSTOM_EMOJI_IDS).filter((id) => Boolean(customEmojis.byId[id]));\n  if (loaded.length) {\n    loaded.forEach((id) => INPUT_WAITING_CUSTOM_EMOJI_IDS.delete(id));\n    processMessageInputForCustomEmoji();\n  }\n}\n\nexport function getCustomEmojiMediaDataForInput(emojiId: string, isPreview?: boolean) {\n  const mediaHash = getStickerHashById(emojiId, isPreview);\n  const data = mediaLoader.getFromMemory(mediaHash);\n  if (data) {\n    return data;\n  }\n\n  void fetchAndProcess(mediaHash);\n  return undefined;\n}\n\nfunction fetchAndProcess(mediaHash: string) {\n  return mediaLoader.fetch(mediaHash, ApiMediaFormat.BlobUrl).then(() => {\n    processMessageInputForCustomEmoji();\n  });\n}\n\nexport function getInputCustomEmojiParams(customEmoji?: ApiSticker) {\n  if (!customEmoji) return [true, placeholderSrc, undefined] as const;\n  const shouldUseStaticFallback = !IS_WEBM_SUPPORTED && customEmoji.isVideo;\n  const isUsingSharedCanvas = customEmoji.isLottie || (customEmoji.isVideo && !shouldUseStaticFallback);\n  if (isUsingSharedCanvas) {\n    void fetchAndProcess(`sticker${customEmoji.id}`);\n    return [false, blankSrc, generateUniqueId()] as const;\n  }\n\n  const mediaData = getCustomEmojiMediaDataForInput(customEmoji.id, shouldUseStaticFallback);\n\n  return [!mediaData, mediaData || placeholderSrc, undefined] as const;\n}\n","import type { ApiMessage, ApiSponsoredMessage } from '../../api/types';\n\nexport type MessageKey = `msg${string}-${number}`;\n\nexport function getMessageKey(message: ApiMessage | ApiSponsoredMessage): MessageKey {\n  const {\n    chatId,\n  } = message;\n\n  if ('randomId' in message) {\n    return buildMessageKey(chatId, Number(message.randomId));\n  }\n  return buildMessageKey(chatId, message.previousLocalId || message.id);\n}\n\nexport function getMessageServerKey(message: ApiMessage): MessageKey | undefined {\n  if (isLocalMessageId(message.id)) {\n    return undefined;\n  }\n  const { chatId, id } = message;\n  return buildMessageKey(chatId, id);\n}\n\nexport function buildMessageKey(chatId: string, msgId: number): MessageKey {\n  return `msg${chatId}-${msgId}`;\n}\n\nexport function parseMessageKey(key: MessageKey) {\n  const match = key.match(/^msg(-?\\d+)-(\\d+)/)!;\n\n  return { chatId: match[1], messageId: Number(match[2]) };\n}\n\nexport function isLocalMessageId(id: number) {\n  return !Number.isInteger(id);\n}\n","import { useEffect } from '@teact';\n\nimport { createSignal } from '../../util/signals';\nimport useLastCallback from '../useLastCallback';\n\nconst [getIsInBackgroundLocal, setIsInBackground] = createSignal(!document.hasFocus());\nexport const getIsInBackground = getIsInBackgroundLocal;\n\nfunction handleBlur() {\n  setIsInBackground(true);\n}\n\nfunction handleFocus() {\n  setIsInBackground(false);\n}\n\nwindow.addEventListener('blur', handleBlur);\nwindow.addEventListener('focus', handleFocus);\n\nexport default function useBackgroundMode(\n  onBlur?: AnyToVoidFunction,\n  onFocus?: AnyToVoidFunction,\n  isDisabled = false,\n) {\n  const lastOnBlur = useLastCallback(onBlur);\n  const lastOnFocus = useLastCallback(onFocus);\n\n  useEffect(() => {\n    if (isDisabled) {\n      return undefined;\n    }\n\n    if (getIsInBackground()) {\n      lastOnBlur();\n    }\n\n    return getIsInBackground.subscribe(() => {\n      if (getIsInBackground()) {\n        lastOnBlur();\n      } else {\n        lastOnFocus();\n      }\n    });\n  }, [isDisabled, lastOnBlur, lastOnFocus]);\n}\n\nexport function isBackgroundModeActive() {\n  return getIsInBackground();\n}\n","/* eslint-disable no-console */\n\nexport const DEBUG_LEVELS = ['log', 'error', 'warn', 'info', 'debug'] as const;\nexport type DebugLevel = typeof DEBUG_LEVELS[number];\n// @ts-ignore\nconst ORIGINAL_FUNCTIONS: Record<DebugLevel, (...args: any[]) => void> = DEBUG_LEVELS.reduce((acc, level) => {\n  // @ts-ignore\n  acc[level] = console[level];\n  return acc;\n}, {});\n\ntype DebugEntry = {\n  level: DebugLevel;\n  args: any[];\n  date: Date;\n};\nlet DEBUG_LOGS: DebugEntry[] = [];\n\nexport function logDebugMessage(level: DebugLevel, ...args: any[]) {\n  DEBUG_LOGS.push({\n    level,\n    args,\n    date: new Date(),\n  });\n  ORIGINAL_FUNCTIONS[level](...args);\n}\n\nexport function initDebugConsole() {\n  DEBUG_LOGS = [];\n  DEBUG_LEVELS.forEach((level) => {\n    // @ts-ignore\n    console[level] = (...args: any[]) => {\n      logDebugMessage(level, ...args);\n    };\n  });\n}\n\nexport function disableDebugConsole() {\n  DEBUG_LEVELS.forEach((level) => {\n    // @ts-ignore\n    console[level] = ORIGINAL_FUNCTIONS[level];\n  });\n  DEBUG_LOGS = [];\n}\n\nexport function getDebugLogs() {\n  return JSON.stringify(DEBUG_LOGS, (key, value) => (typeof value === 'bigint'\n    ? value.toString()\n    : value));\n}\n","import type { ChangeEvent, FocusEvent } from 'react';\n\nimport type { Signal } from '../../util/signals';\nimport type {\n  VirtualElement,\n  VirtualElementChildren,\n  VirtualElementComponent,\n  VirtualElementFragment,\n  VirtualElementParent,\n  VirtualElementReal,\n  VirtualElementTag,\n} from './teact';\n\nimport { DEBUG } from '../../config';\nimport { unique } from '../../util/iteratees';\nimport { addEventListener, removeAllDelegatedListeners, removeEventListener } from './dom-events';\nimport {\n  captureImmediateEffects,\n  hasElementChanged,\n  isParentElement,\n  mountComponent,\n  MountState,\n  renderComponent,\n  unmountComponent,\n  VirtualType,\n} from './teact';\n\ninterface VirtualDomHead {\n  children: [VirtualElement] | [];\n}\n\ninterface SelectionState {\n  selectionStart: number | null;\n  selectionEnd: number | null;\n  isCaretAtEnd: boolean;\n}\n\ntype CurrentContext = Record<string, Signal<unknown>>;\n\ntype DOMElement = HTMLElement | SVGElement;\n\nconst SVG_NAMESPACE = 'http://www.w3.org/2000/svg';\nconst HTML_NAMESPACE = 'http://www.w3.org/1999/xhtml';\n\nconst FILTERED_ATTRIBUTES = new Set(['key', 'ref', 'teactFastList', 'teactOrderKey']);\nconst HTML_ATTRIBUTES = new Set(['dir', 'role', 'form']);\nconst CONTROLLABLE_TAGS = ['INPUT', 'TEXTAREA', 'SELECT'];\nconst MAPPED_ATTRIBUTES: Partial<Record<string, string>> = {\n  autoCapitalize: 'autocapitalize',\n  autoComplete: 'autocomplete',\n  autoCorrect: 'autocorrect',\n  autoPlay: 'autoplay',\n  spellCheck: 'spellcheck',\n};\nconst INDEX_KEY_PREFIX = '__indexKey#';\nconst SELECTION_STATE_ATTRIBUTE = '__teactSelectionState';\n\nconst headsByElement = new WeakMap<Element, VirtualDomHead>();\nconst extraClasses = new WeakMap<Element, Set<string>>();\nconst extraStyles = new WeakMap<Element, Record<string, string>>();\n\nlet DEBUG_virtualTreeSize = 1;\n\nfunction render($element: VirtualElement | undefined, parentEl: HTMLElement) {\n  if (!headsByElement.has(parentEl)) {\n    headsByElement.set(parentEl, { children: [] });\n  }\n\n  const runImmediateEffects = captureImmediateEffects();\n  const $head = headsByElement.get(parentEl)!;\n  const $renderedChild = renderWithVirtual(parentEl, $head.children[0], $element, $head, {}, 0);\n  runImmediateEffects?.();\n\n  $head.children = $renderedChild ? [$renderedChild] : [];\n\n  if (process.env.APP_ENV === 'perf') {\n    DEBUG_virtualTreeSize = 0;\n    DEBUG_addToVirtualTreeSize($head);\n\n    return DEBUG_virtualTreeSize;\n  }\n\n  return undefined;\n}\n\nfunction renderWithVirtual<T extends VirtualElement | undefined>(\n  parentEl: DOMElement,\n  $current: VirtualElement | undefined,\n  $new: T,\n  $parent: VirtualElementParent | VirtualDomHead,\n  currentContext: CurrentContext,\n  index: number,\n  options: {\n    skipComponentUpdate?: boolean;\n    nextSibling?: ChildNode;\n    forceMoveToEnd?: boolean;\n    fragment?: DocumentFragment;\n    namespace?: string;\n  } = {},\n): T {\n  const { skipComponentUpdate, fragment } = options;\n  let { nextSibling, namespace } = options;\n\n  const isCurrentComponent = $current?.type === VirtualType.Component;\n  const isNewComponent = $new?.type === VirtualType.Component;\n  const $newAsReal = $new as VirtualElementReal;\n\n  const isCurrentFragment = !isCurrentComponent && $current?.type === VirtualType.Fragment;\n  const isNewFragment = !isNewComponent && $new?.type === VirtualType.Fragment;\n\n  if ($new?.type === VirtualType.Tag) {\n    if ($new.tag === 'svg') namespace = SVG_NAMESPACE;\n    if ($new.props.xmlns) namespace = $new.props.xmlns;\n  }\n\n  if (\n    !skipComponentUpdate\n    && isCurrentComponent && isNewComponent\n    && !hasElementChanged($current, $new!)\n  ) {\n    $new = updateComponent($current, $new as VirtualElementComponent) as typeof $new;\n  }\n\n  // Parent element may have changed, so we need to update the listener closure.\n  if (\n    !skipComponentUpdate\n    && isNewComponent\n    && ($new as VirtualElementComponent).componentInstance.mountState === MountState.Mounted\n  ) {\n    setupComponentUpdateListener(parentEl, $new as VirtualElementComponent, $parent, currentContext, index);\n  }\n\n  if ($current === $new) {\n    return $new;\n  }\n\n  if (DEBUG && $new) {\n    const newTarget = 'target' in $new && $new.target;\n    if (newTarget && (!$current || ('target' in $current && newTarget !== $current.target))) {\n      throw new Error('[Teact] Cached virtual element was moved within tree');\n    }\n  }\n\n  if (!$current && $new) {\n    if (isNewComponent || isNewFragment) {\n      if (isNewComponent) {\n        $new = initComponent(\n          parentEl, $new as VirtualElementComponent, $parent, currentContext, index,\n        ) as unknown as typeof $new;\n        currentContext = ($new as VirtualElementComponent).componentInstance.context ?? currentContext;\n      }\n\n      mountChildren(parentEl, $new as VirtualElementComponent | VirtualElementFragment, currentContext, {\n        nextSibling, fragment, namespace,\n      });\n    } else {\n      const canSetTextContent = !fragment\n        && !nextSibling\n        && $newAsReal.type === VirtualType.Text\n        && $parent.children.length === 1\n        && !parentEl.firstChild;\n\n      if (canSetTextContent) {\n        parentEl.textContent = $newAsReal.value;\n        $newAsReal.target = parentEl.firstChild!;\n      } else {\n        const node = createNode($newAsReal, currentContext, namespace);\n        $newAsReal.target = node;\n        insertBefore(fragment || parentEl, node, nextSibling);\n\n        if ($newAsReal.type === VirtualType.Tag) {\n          setElementRef($newAsReal, node as DOMElement);\n        }\n      }\n    }\n  } else if ($current && !$new) {\n    remount(parentEl, $current, currentContext, undefined);\n  } else if ($current && $new) {\n    if (hasElementChanged($current, $new)) {\n      if (!nextSibling) {\n        nextSibling = getNextSibling($current);\n      }\n\n      if (isNewComponent || isNewFragment) {\n        if (isNewComponent) {\n          $new = initComponent(\n            parentEl, $new as VirtualElementComponent, $parent, currentContext, index,\n          ) as unknown as typeof $new;\n          currentContext = ($new as VirtualElementComponent).componentInstance.context ?? currentContext;\n        }\n\n        remount(parentEl, $current, currentContext, undefined);\n        mountChildren(parentEl, $new as VirtualElementComponent | VirtualElementFragment, currentContext, {\n          nextSibling, fragment, namespace,\n        });\n      } else {\n        const node = createNode($newAsReal, currentContext, namespace);\n        $newAsReal.target = node;\n        remount(parentEl, $current, currentContext, node, nextSibling);\n\n        if ($newAsReal.type === VirtualType.Tag) {\n          setElementRef($newAsReal, node as DOMElement);\n        }\n      }\n    } else {\n      const isComponent = isCurrentComponent && isNewComponent;\n      const isFragment = isCurrentFragment && isNewFragment;\n\n      if (isComponent || isFragment) {\n        renderChildren(\n          $current,\n          $new as VirtualElementComponent | VirtualElementFragment,\n          currentContext,\n          parentEl,\n          nextSibling,\n          options.forceMoveToEnd,\n        );\n      } else {\n        const $currentAsReal = $current as VirtualElementReal;\n        const currentTarget = $currentAsReal.target!;\n\n        $newAsReal.target = currentTarget;\n        $currentAsReal.target = undefined; // Help GC\n\n        const isTag = $current.type === VirtualType.Tag;\n        if (isTag) {\n          const $newAsTag = $new as VirtualElementTag;\n\n          setElementRef($current, undefined);\n          setElementRef($newAsTag, currentTarget as DOMElement);\n\n          if (nextSibling || options.forceMoveToEnd) {\n            insertBefore(parentEl, currentTarget, nextSibling);\n          }\n\n          updateAttributes($current, $newAsTag, currentTarget as DOMElement, namespace);\n          renderChildren(\n            $current, $newAsTag, currentContext, currentTarget as DOMElement, undefined, undefined, namespace,\n          );\n        }\n      }\n    }\n  }\n\n  return $new;\n}\n\nfunction initComponent(\n  parentEl: DOMElement,\n  $element: VirtualElementComponent,\n  $parent: VirtualElementParent | VirtualDomHead,\n  currentContext: CurrentContext,\n  index: number,\n) {\n  const { componentInstance } = $element;\n\n  $element.componentInstance.context = currentContext;\n\n  if (componentInstance.mountState === MountState.Unmounted) {\n    $element = mountComponent(componentInstance);\n    setupComponentUpdateListener(parentEl, $element, $parent, currentContext, index);\n  }\n\n  return $element;\n}\n\nfunction updateComponent($current: VirtualElementComponent, $new: VirtualElementComponent) {\n  $current.componentInstance.props = $new.componentInstance.props;\n\n  return renderComponent($current.componentInstance);\n}\n\nfunction setupComponentUpdateListener(\n  parentEl: DOMElement,\n  $element: VirtualElementComponent,\n  $parent: VirtualElementParent | VirtualDomHead,\n  currentContext: CurrentContext,\n  index: number,\n) {\n  const { componentInstance } = $element;\n\n  componentInstance.onUpdate = () => {\n    $parent.children[index] = renderWithVirtual(\n      parentEl,\n      $parent.children[index],\n      componentInstance.$element,\n      $parent,\n      currentContext,\n      index,\n      { skipComponentUpdate: true },\n    );\n  };\n}\n\nfunction mountChildren(\n  parentEl: DOMElement,\n  $element: VirtualElementComponent | VirtualElementFragment,\n  currentContext: CurrentContext,\n  options: {\n    nextSibling?: ChildNode;\n    fragment?: DocumentFragment;\n    namespace?: string;\n  },\n) {\n  const { children } = $element;\n\n  // Add a placeholder comment node for empty fragments to maintain position\n  if ($element.type === VirtualType.Fragment && children.length === 0) {\n    const fragmentEl = $element;\n    fragmentEl.placeholderTarget = document.createComment('empty-fragment');\n    insertBefore(options.fragment || parentEl, fragmentEl.placeholderTarget, options.nextSibling);\n    return;\n  }\n\n  for (let i = 0, l = children.length; i < l; i++) {\n    const $child = children[i];\n    const $renderedChild = renderWithVirtual(parentEl, undefined, $child, $element, currentContext, i, options);\n    if ($renderedChild !== $child) {\n      children[i] = $renderedChild;\n    }\n  }\n}\n\nfunction unmountChildren(\n  parentEl: DOMElement, $element: VirtualElementComponent | VirtualElementFragment, currentContext: CurrentContext,\n) {\n  for (const $child of $element.children) {\n    renderWithVirtual(parentEl, $child, undefined, $element, currentContext, -1);\n  }\n}\n\nfunction createNode($element: VirtualElementReal, currentContext: CurrentContext, namespace = HTML_NAMESPACE): Node {\n  if ($element.type === VirtualType.Empty) {\n    return document.createTextNode('');\n  }\n\n  if ($element.type === VirtualType.Text) {\n    return document.createTextNode($element.value);\n  }\n\n  const { tag, props, children } = $element;\n  const element = document.createElementNS(namespace, tag) as DOMElement;\n\n  processControlled(tag, props);\n\n  for (const key in props) {\n    if (!props.hasOwnProperty(key)) continue;\n\n    if (props[key] !== undefined) {\n      setAttribute(element, key, props[key], namespace);\n    }\n  }\n\n  processUncontrolledOnMount(element, props);\n\n  for (let i = 0, l = children.length; i < l; i++) {\n    const $child = children[i];\n    const $renderedChild = renderWithVirtual(element, undefined, $child, $element, currentContext, i, { namespace });\n    if ($renderedChild !== $child) {\n      children[i] = $renderedChild;\n    }\n  }\n\n  return element;\n}\n\nfunction remount(\n  parentEl: DOMElement,\n  $current: VirtualElement,\n  currentContext: CurrentContext,\n  node: Node | undefined,\n  componentNextSibling?: ChildNode,\n) {\n  const isComponent = $current.type === VirtualType.Component;\n  const isFragment = !isComponent && $current.type === VirtualType.Fragment;\n\n  if (isComponent || isFragment) {\n    if (isComponent) {\n      unmountComponent($current.componentInstance);\n    }\n\n    unmountChildren(parentEl, $current, currentContext);\n\n    if (node) {\n      insertBefore(parentEl, node, componentNextSibling);\n    }\n  } else {\n    if (node) {\n      parentEl.replaceChild(node, $current.target!);\n    } else {\n      parentEl.removeChild($current.target!);\n    }\n\n    unmountRealTree($current);\n  }\n}\n\nfunction unmountRealTree($element: VirtualElement) {\n  if ($element.type === VirtualType.Component) {\n    unmountComponent($element.componentInstance);\n  } else if ($element.type === VirtualType.Fragment) {\n    // Remove placeholder for empty fragments\n    const fragment = $element;\n    if (fragment.placeholderTarget && fragment.children.length === 0) {\n      fragment.placeholderTarget.parentNode?.removeChild(fragment.placeholderTarget);\n      fragment.placeholderTarget = undefined;\n    }\n  } else {\n    if ($element.type === VirtualType.Tag) {\n      extraClasses.delete($element.target!);\n      setElementRef($element, undefined);\n      removeAllDelegatedListeners($element.target!);\n    }\n\n    $element.target = undefined; // Help GC\n\n    if ($element.type !== VirtualType.Tag) {\n      return;\n    }\n  }\n\n  for (const $child of $element.children) {\n    unmountRealTree($child);\n  }\n}\n\nfunction insertBefore(parentEl: DOMElement | DocumentFragment, node: Node, nextSibling?: ChildNode) {\n  if (nextSibling) {\n    parentEl.insertBefore(node, nextSibling);\n  } else {\n    parentEl.appendChild(node);\n  }\n}\n\nfunction getNextSibling($current: VirtualElement): ChildNode | undefined {\n  if ($current.type === VirtualType.Component || $current.type === VirtualType.Fragment) {\n    if ($current.children.length === 0) {\n      // For empty fragments, use the placeholder node to track position\n      const fragment = $current as VirtualElementFragment;\n      if (fragment.placeholderTarget) {\n        return fragment.placeholderTarget.nextSibling || undefined;\n      }\n      return undefined;\n    }\n\n    const lastChild = $current.children[$current.children.length - 1];\n    return getNextSibling(lastChild);\n  }\n\n  return $current.target!.nextSibling || undefined;\n}\n\nfunction renderChildren(\n  $current: VirtualElementParent,\n  $new: VirtualElementParent,\n  currentContext: CurrentContext,\n  currentEl: DOMElement,\n  nextSibling?: ChildNode,\n  forceMoveToEnd = false,\n  namespace?: string,\n) {\n  if (DEBUG) {\n    DEBUG_checkKeyUniqueness($new.children);\n  }\n\n  if (('props' in $new) && $new.props.teactFastList) {\n    renderFastListChildren($current, $new, currentContext, currentEl);\n    return;\n  }\n\n  // Handle transitions between empty and non-empty fragments\n  if ($current.type === VirtualType.Fragment && $new.type === VirtualType.Fragment) {\n    const currentFragment = $current;\n    const newFragment = $new;\n\n    // If transitioning from empty to non-empty, use the placeholder's position\n    if (currentFragment.children.length === 0 && newFragment.children.length > 0 && currentFragment.placeholderTarget) {\n      nextSibling = currentFragment.placeholderTarget.nextSibling || undefined;\n      // Remove the placeholder as we're adding real content\n      currentFragment.placeholderTarget.parentNode?.removeChild(currentFragment.placeholderTarget);\n      currentFragment.placeholderTarget = undefined;\n    }\n\n    // If transitioning from non-empty to empty, add a placeholder\n    if (currentFragment.children.length > 0 && newFragment.children.length === 0) {\n      const lastCurrentChild = currentFragment.children[currentFragment.children.length - 1];\n      const siblingAfterFragment = getNextSibling(lastCurrentChild);\n      newFragment.placeholderTarget = document.createComment('empty-fragment');\n      insertBefore(currentEl, newFragment.placeholderTarget, siblingAfterFragment);\n    }\n  }\n\n  const currentChildren = $current.children;\n  const newChildren = $new.children;\n\n  const currentChildrenLength = currentChildren.length;\n  const newChildrenLength = newChildren.length;\n  const maxLength = Math.max(currentChildrenLength, newChildrenLength);\n\n  const fragment = newChildrenLength > currentChildrenLength ? document.createDocumentFragment() : undefined;\n  const lastCurrentChild = $current.children[currentChildrenLength - 1];\n  const fragmentNextSibling = fragment && (\n    nextSibling || (lastCurrentChild ? getNextSibling(lastCurrentChild) : undefined)\n  );\n\n  for (let i = 0; i < maxLength; i++) {\n    const $renderedChild = renderWithVirtual(\n      currentEl,\n      currentChildren[i],\n      newChildren[i],\n      $new,\n      currentContext,\n      i,\n      i >= currentChildrenLength ? { fragment, namespace } : { nextSibling, forceMoveToEnd, namespace },\n    );\n\n    if ($renderedChild && $renderedChild !== newChildren[i]) {\n      newChildren[i] = $renderedChild;\n    }\n  }\n\n  if (fragment) {\n    insertBefore(currentEl, fragment, fragmentNextSibling);\n  }\n}\n\n// This function allows to prepend/append a bunch of new DOM nodes to the top/bottom of preserved ones.\n// It also allows to selectively move particular preserved nodes within their DOM list.\nfunction renderFastListChildren(\n  $current: VirtualElementParent, $new: VirtualElementParent, currentContext: CurrentContext, currentEl: DOMElement,\n) {\n  const currentChildren = $current.children;\n  const newChildren = $new.children;\n\n  const newKeys = new Set();\n  for (const $newChild of newChildren) {\n    const key = 'props' in $newChild ? $newChild.props.key : undefined;\n\n    if (DEBUG && isParentElement($newChild)) {\n      // eslint-disable-next-line no-null/no-null\n      if (key === undefined || key === null) {\n        // eslint-disable-next-line no-console\n        console.warn('Missing `key` in `teactFastList`');\n      }\n\n      if ($newChild.type === VirtualType.Fragment) {\n        throw new Error('[Teact] Fragment can not be child of container with `teactFastList`');\n      }\n    }\n\n    newKeys.add(key);\n  }\n\n  // Build a collection of old children that also remain in the new list\n  let currentRemainingIndex = 0;\n  const remainingByKey: Record<string, { $element: VirtualElement; index: number; orderKey?: number }> = {};\n  for (let i = 0, l = currentChildren.length; i < l; i++) {\n    const $currentChild = currentChildren[i];\n\n    let key = 'props' in $currentChild ? $currentChild.props.key : undefined;\n    // eslint-disable-next-line no-null/no-null\n    const isKeyPresent = key !== undefined && key !== null;\n\n    // First we process removed children\n    if (isKeyPresent && !newKeys.has(key)) {\n      renderWithVirtual(currentEl, $currentChild, undefined, $new, currentContext, -1);\n\n      continue;\n    } else if (!isKeyPresent) {\n      const $newChild = newChildren[i];\n      const newChildKey = ($newChild && 'props' in $newChild) ? $newChild.props.key : undefined;\n      // If a non-key element remains at the same index we preserve it with a virtual `key`\n      if ($newChild && !newChildKey) {\n        key = `${INDEX_KEY_PREFIX}${i}`;\n        // Otherwise, we just remove it\n      } else {\n        renderWithVirtual(currentEl, $currentChild, undefined, $new, currentContext, -1);\n\n        continue;\n      }\n    }\n\n    // Then we build up info about remaining children\n    remainingByKey[key] = {\n      $element: $currentChild,\n      index: currentRemainingIndex++,\n      orderKey: 'props' in $currentChild ? $currentChild.props.teactOrderKey : undefined,\n    };\n  }\n\n  let fragmentIndex: number | undefined;\n  let fragmentSize: number | undefined;\n\n  let currentPreservedIndex = 0;\n\n  for (let i = 0, l = newChildren.length; i < l; i++) {\n    const $newChild = newChildren[i];\n    const key = 'props' in $newChild ? $newChild.props.key : `${INDEX_KEY_PREFIX}${i}`;\n    const currentChildInfo = remainingByKey[key];\n\n    if (!currentChildInfo) {\n      if (fragmentSize === undefined) {\n        fragmentIndex = i;\n        fragmentSize = 0;\n      }\n\n      fragmentSize++;\n      continue;\n    }\n\n    // This prepends new children to the top\n    if (fragmentSize) {\n      renderFragment(fragmentIndex!, fragmentSize, currentEl, $new, currentContext);\n      fragmentSize = undefined;\n      fragmentIndex = undefined;\n    }\n\n    // Now we check if a preserved node was moved within preserved list\n    const newOrderKey = 'props' in $newChild ? $newChild.props.teactOrderKey : undefined;\n    // That is indicated by a changed `teactOrderKey` value\n    const shouldMoveNode = (\n      currentChildInfo.index !== currentPreservedIndex && (!newOrderKey || currentChildInfo.orderKey !== newOrderKey)\n    );\n    const isMovingDown = shouldMoveNode && currentPreservedIndex > currentChildInfo.index;\n\n    if (!shouldMoveNode || isMovingDown) {\n      currentPreservedIndex++;\n    }\n\n    const nextSibling = currentEl.childNodes[isMovingDown ? i + 1 : i];\n    const options = shouldMoveNode ? (nextSibling ? { nextSibling } : { forceMoveToEnd: true }) : undefined;\n\n    const $renderedChild = renderWithVirtual(\n      currentEl, currentChildInfo.$element, $newChild, $new, currentContext, i, options,\n    );\n    if ($renderedChild !== $newChild) {\n      newChildren[i] = $renderedChild;\n    }\n  }\n\n  // This appends new children to the bottom\n  if (fragmentSize) {\n    renderFragment(fragmentIndex!, fragmentSize, currentEl, $new, currentContext);\n  }\n}\n\nfunction renderFragment(\n  fragmentIndex: number,\n  fragmentSize: number,\n  parentEl: DOMElement,\n  $parent: VirtualElementParent,\n  currentContext: CurrentContext,\n) {\n  const nextSibling = parentEl.childNodes[fragmentIndex];\n\n  if (fragmentSize === 1) {\n    const $child = $parent.children[fragmentIndex];\n    const $renderedChild = renderWithVirtual(\n      parentEl, undefined, $child, $parent, currentContext, fragmentIndex, { nextSibling },\n    );\n    if ($renderedChild !== $child) {\n      $parent.children[fragmentIndex] = $renderedChild;\n    }\n\n    return;\n  }\n\n  const fragment = document.createDocumentFragment();\n\n  for (let i = fragmentIndex; i < fragmentIndex + fragmentSize; i++) {\n    const $child = $parent.children[i];\n    const $renderedChild = renderWithVirtual(parentEl, undefined, $child, $parent, currentContext, i, { fragment });\n    if ($renderedChild !== $child) {\n      $parent.children[i] = $renderedChild;\n    }\n  }\n\n  insertBefore(parentEl, fragment, nextSibling);\n}\n\nfunction setElementRef($element: VirtualElementTag, element: DOMElement | undefined) {\n  const { ref } = $element.props;\n\n  if (typeof ref === 'object') {\n    ref.current = element;\n    ref.onChange?.();\n  } else if (typeof ref === 'function') {\n    ref(element);\n  }\n}\n\nfunction processControlled(tag: string, props: AnyLiteral) {\n  // TODO Remove after tests\n  if (!props.teactExperimentControlled) {\n    return;\n  }\n\n  const isValueControlled = props.value !== undefined;\n  const isCheckedControlled = props.checked !== undefined;\n  const isControlled = (isValueControlled || isCheckedControlled) && CONTROLLABLE_TAGS.includes(tag.toUpperCase());\n  if (!isControlled) {\n    return;\n  }\n\n  const {\n    value, checked, onInput, onChange, onBlur,\n  } = props;\n\n  props.onChange = undefined;\n  props.onInput = (e: ChangeEvent<HTMLInputElement>) => {\n    onInput?.(e);\n    onChange?.(e);\n\n    if (value !== undefined && value !== e.currentTarget.value) {\n      const { selectionStart, selectionEnd } = e.currentTarget;\n      const isCaretAtEnd = selectionStart === selectionEnd && selectionEnd === e.currentTarget.value.length;\n\n      e.currentTarget.value = value;\n\n      if (typeof selectionStart === 'number' && typeof selectionEnd === 'number') {\n        e.currentTarget.setSelectionRange(selectionStart, selectionEnd);\n\n        const selectionState: SelectionState = { selectionStart, selectionEnd, isCaretAtEnd };\n\n        e.currentTarget.dataset[SELECTION_STATE_ATTRIBUTE] = JSON.stringify(selectionState);\n      }\n    }\n\n    if (checked !== undefined) {\n      e.currentTarget.checked = checked;\n    }\n  };\n  props.onBlur = (e: FocusEvent<HTMLInputElement>) => {\n    delete e.currentTarget.dataset[SELECTION_STATE_ATTRIBUTE];\n\n    onBlur?.(e);\n  };\n}\n\nfunction processUncontrolledOnMount(element: DOMElement, props: AnyLiteral) {\n  if (!CONTROLLABLE_TAGS.includes(element.tagName)) {\n    return;\n  }\n\n  if (props.defaultValue) {\n    setAttribute(element, 'value', props.defaultValue);\n  }\n\n  if (props.defaultChecked) {\n    setAttribute(element, 'checked', props.defaultChecked);\n  }\n}\n\nfunction updateAttributes(\n  $current: VirtualElementTag, $new: VirtualElementTag, element: DOMElement, namespace?: string,\n) {\n  processControlled(element.tagName, $new.props);\n\n  const currentEntries = Object.entries($current.props);\n  const newEntries = Object.entries($new.props);\n\n  for (const [key, currentValue] of currentEntries) {\n    const newValue = $new.props[key];\n\n    if (\n      currentValue !== undefined\n      && (\n        newValue === undefined\n        || (currentValue !== newValue && key.startsWith('on'))\n      )\n    ) {\n      removeAttribute(element, key, currentValue);\n    }\n  }\n\n  for (const [key, newValue] of newEntries) {\n    const currentValue = $current.props[key];\n\n    if (newValue !== undefined && newValue !== currentValue) {\n      setAttribute(element, key, newValue, namespace);\n    }\n  }\n}\n\nfunction setAttribute(element: DOMElement, key: string, value: any, namespace?: string) {\n  if (key === 'className') {\n    updateClassName(element, value, namespace);\n  } else if (key === 'value') {\n    const inputEl = element as HTMLInputElement;\n\n    if (inputEl.value !== value) {\n      inputEl.value = value;\n\n      const selectionStateJson = inputEl.dataset[SELECTION_STATE_ATTRIBUTE];\n      if (selectionStateJson) {\n        const { selectionStart, selectionEnd, isCaretAtEnd } = JSON.parse(selectionStateJson) as SelectionState;\n\n        if (isCaretAtEnd) {\n          const length = inputEl.value.length;\n          inputEl.setSelectionRange(length, length);\n        } else if (typeof selectionStart === 'number' && typeof selectionEnd === 'number') {\n          inputEl.setSelectionRange(selectionStart, selectionEnd);\n        }\n      }\n    }\n  } else if (key === 'style') {\n    updateStyle(element, value);\n  } else if (key === 'dangerouslySetInnerHTML') {\n    element.innerHTML = value.__html;\n  } else if (key.startsWith('on')) {\n    addEventListener(element, key, value, key.endsWith('Capture'));\n  } else if (\n    namespace === SVG_NAMESPACE || key.startsWith('data-') || key.startsWith('aria-') || HTML_ATTRIBUTES.has(key)\n  ) {\n    element.setAttribute(key, value);\n  } else if (!FILTERED_ATTRIBUTES.has(key)) {\n    (element as any)[MAPPED_ATTRIBUTES[key] || key] = value;\n  }\n}\n\nfunction removeAttribute(element: DOMElement, key: string, value: any) {\n  if (key === 'className') {\n    updateClassName(element, '');\n  } else if (key === 'value') {\n    (element as HTMLInputElement).value = '';\n  } else if (key === 'style') {\n    updateStyle(element, '');\n  } else if (key === 'dangerouslySetInnerHTML') {\n    element.innerHTML = '';\n  } else if (key.startsWith('on')) {\n    removeEventListener(element, key, value, key.endsWith('Capture'));\n  } else if (!FILTERED_ATTRIBUTES.has(key)) {\n    element.removeAttribute(key);\n  }\n}\n\nfunction updateClassName(element: DOMElement, value: string, namespace?: string) {\n  if (namespace === SVG_NAMESPACE) {\n    element.setAttribute('class', value);\n    return;\n  }\n\n  const htmlElement = element as HTMLElement;\n  const extra = extraClasses.get(element);\n  if (!extra) {\n    htmlElement.className = value;\n    return;\n  }\n\n  const extraArray = Array.from(extra);\n  if (value) {\n    extraArray.push(value);\n  }\n\n  htmlElement.className = extraArray.join(' ');\n}\n\nfunction updateStyle(element: DOMElement, value: string) {\n  element.style.cssText = value;\n\n  const extraObject = extraStyles.get(element);\n  if (extraObject) {\n    applyExtraStyles(element);\n  }\n}\n\nexport function addExtraClass(element: DOMElement, className: string) {\n  element.classList.add(className);\n\n  const classList = extraClasses.get(element);\n  if (classList) {\n    classList.add(className);\n  } else {\n    extraClasses.set(element, new Set([className]));\n  }\n}\n\nexport function removeExtraClass(element: DOMElement, className: string) {\n  element.classList.remove(className);\n\n  const classList = extraClasses.get(element);\n  if (classList) {\n    classList.delete(className);\n\n    if (!classList.size) {\n      extraClasses.delete(element);\n    }\n  }\n}\n\nexport function toggleExtraClass(element: DOMElement, className: string, force?: boolean) {\n  if (force === true) {\n    addExtraClass(element, className);\n  } else if (force === false) {\n    removeExtraClass(element, className);\n  } else if (extraClasses.get(element)?.has(className)) {\n    removeExtraClass(element, className);\n  } else {\n    addExtraClass(element, className);\n  }\n}\n\nexport function setExtraStyles(element: DOMElement, styles: Partial<CSSStyleDeclaration> & AnyLiteral) {\n  extraStyles.set(element, styles);\n  applyExtraStyles(element);\n}\n\nfunction applyExtraStyles(element: DOMElement) {\n  const standardStyles = Object.entries(extraStyles.get(element)!).reduce<Record<string, string>>(\n    (acc, [prop, value]) => {\n      if (prop.startsWith('--')) {\n        element.style.setProperty(prop, value);\n      } else {\n        acc[prop] = value;\n      }\n\n      return acc;\n    },\n    {},\n  );\n\n  Object.assign(element.style, standardStyles);\n}\n\nfunction DEBUG_addToVirtualTreeSize($current: VirtualElementParent | VirtualDomHead) {\n  DEBUG_virtualTreeSize += $current.children.length;\n\n  $current.children.forEach(($child) => {\n    if (isParentElement($child)) {\n      DEBUG_addToVirtualTreeSize($child);\n    }\n  });\n}\n\nfunction DEBUG_checkKeyUniqueness(children: VirtualElementChildren) {\n  const firstChild = children[0];\n  if (firstChild && 'props' in firstChild && firstChild.props.key !== undefined) {\n    const keys = children.reduce((acc: any[], child) => {\n      if ('props' in child && child.props.key) {\n        acc.push(child.props.key);\n      }\n\n      return acc;\n    }, []);\n\n    if (keys.length !== unique(keys).length) {\n      // eslint-disable-next-line no-console\n      console.warn('[Teact] Duplicated keys:', keys.filter((e, i, a) => a.indexOf(e) !== i), children);\n      throw new Error('[Teact] Children keys are not unique');\n    }\n  }\n}\n\nconst TeactDOM = { render };\nexport default TeactDOM;\n","import type {\n  ApiChat,\n  ApiChatAdminRights,\n  ApiChatBannedRights,\n  ApiChatFolder,\n  ApiChatFullInfo,\n  ApiChatInviteInfo,\n  ApiMessage,\n  ApiPeer,\n  ApiPreparedInlineMessage,\n  ApiTopic,\n} from '../../api/types';\nimport type { OldLangFn } from '../../hooks/useOldLang';\nimport type {\n  CustomPeer, ThreadId,\n} from '../../types';\nimport type { LangFn } from '../../util/localization';\nimport { MAIN_THREAD_ID } from '../../api/types';\n\nimport {\n  ANONYMOUS_USER_ID,\n  ARCHIVED_FOLDER_ID, GENERAL_TOPIC_ID, REPLIES_USER_ID, TME_LINK_PREFIX,\n  VERIFICATION_CODES_USER_ID,\n} from '../../config';\nimport { formatDateToString, formatTime } from '../../util/dates/dateFormat';\nimport { getPeerIdDividend, isUserId } from '../../util/entities/ids';\nimport { getServerTime } from '../../util/serverTime';\nimport { selectIsChatRestricted } from '../selectors';\nimport { getGlobal } from '..';\nimport { isSystemBot } from './bots';\nimport { getMainUsername } from './users';\n\nconst FOREVER_BANNED_DATE = Date.now() / 1000 + 31622400; // 366 days\n\nexport function isChatGroup(chat: ApiChat) {\n  return isChatBasicGroup(chat) || isChatSuperGroup(chat);\n}\n\nexport function isChatBasicGroup(chat: ApiChat) {\n  return chat.type === 'chatTypeBasicGroup';\n}\n\nexport function isChatSuperGroup(chat: ApiChat) {\n  return chat.type === 'chatTypeSuperGroup';\n}\n\nexport function isChatChannel(chat: ApiChat) {\n  return chat.type === 'chatTypeChannel';\n}\n\nexport function isChatMonoforum(chat: ApiChat) {\n  return chat.isMonoforum;\n}\n\nexport function isCommonBoxChat(chat: ApiChat) {\n  return chat.type === 'chatTypePrivate' || chat.type === 'chatTypeBasicGroup';\n}\n\nexport function isChatWithRepliesBot(chatId: string) {\n  return chatId === REPLIES_USER_ID;\n}\n\nexport function isChatWithVerificationCodesBot(chatId: string) {\n  return chatId === VERIFICATION_CODES_USER_ID;\n}\n\nexport function isAnonymousForwardsChat(chatId: string) {\n  return chatId === ANONYMOUS_USER_ID;\n}\n\nexport function getChatTypeString(chat: ApiChat) {\n  switch (chat.type) {\n    case 'chatTypePrivate':\n      return 'PrivateChat';\n    case 'chatTypeBasicGroup':\n    case 'chatTypeSuperGroup':\n      return 'AccDescrGroup';\n    case 'chatTypeChannel':\n      return 'AccDescrChannel';\n    default:\n      return 'Chat';\n  }\n}\n\nexport function getPrivateChatUserId(chat: ApiChat) {\n  if (chat.type !== 'chatTypePrivate' && chat.type !== 'chatTypeSecret') {\n    return undefined;\n  }\n  return chat.id;\n}\n\nexport function getChatTitle(lang: OldLangFn | LangFn, chat: ApiChat, isSelf = false) {\n  if (isSelf) {\n    return lang('SavedMessages');\n  }\n  return chat.title || lang('HiddenName');\n}\n\nexport function getChatLink(chat: ApiChat) {\n  const activeUsername = getMainUsername(chat);\n\n  return activeUsername ? `${TME_LINK_PREFIX}${activeUsername}` : undefined;\n}\n\nexport function getChatAvatarHash(\n  owner: ApiPeer,\n  size: 'normal' | 'big' = 'normal',\n  avatarPhotoId = owner.avatarPhotoId,\n) {\n  if (!avatarPhotoId) {\n    return undefined;\n  }\n\n  switch (size) {\n    case 'big':\n      return `profile${owner.id}?${avatarPhotoId}`;\n    default:\n      return `avatar${owner.id}?${avatarPhotoId}`;\n  }\n}\n\nexport function isChatAdmin(chat: ApiChat) {\n  return Boolean(chat.adminRights || chat.isCreator);\n}\n\nexport function getHasAdminRight(chat: ApiChat, key: keyof ApiChatAdminRights) {\n  return chat.adminRights?.[key] || false;\n}\n\nexport function getCanManageTopic(chat: ApiChat, topic: ApiTopic) {\n  if (topic.id === GENERAL_TOPIC_ID) return chat.isCreator;\n  return chat.isCreator || getHasAdminRight(chat, 'manageTopics') || topic.isOwner;\n}\n\nexport function isUserRightBanned(chat: ApiChat, key: keyof ApiChatBannedRights, chatFullInfo?: ApiChatFullInfo) {\n  const unrestrictedByBoosts = chatFullInfo?.boostsToUnrestrict\n    && (chatFullInfo.boostsApplied || 0) >= chatFullInfo.boostsToUnrestrict;\n  return Boolean(\n    (chat.currentUserBannedRights?.[key])\n    || (chat.defaultBannedRights?.[key] && !unrestrictedByBoosts),\n  );\n}\n\nexport function getCanPostInChat(\n  chat: ApiChat, topic?: ApiTopic, isMessageThread?: boolean, chatFullInfo?: ApiChatFullInfo,\n) {\n  if (topic) {\n    if (chat.isForum) {\n      if (chat.isNotJoined) {\n        return false;\n      }\n\n      if (topic?.isClosed && !topic.isOwner && !getHasAdminRight(chat, 'manageTopics')) {\n        return false;\n      }\n    }\n  }\n\n  const global = getGlobal();\n  const isRestricted = selectIsChatRestricted(global, chat.id);\n  if (isRestricted || chat.isForbidden || chat.migratedTo\n    || (chat.isNotJoined && !isChatMonoforum(chat) && !isMessageThread)\n    || isSystemBot(chat.id) || isAnonymousForwardsChat(chat.id)) {\n    return false;\n  }\n\n  if (chat.isCreator) {\n    return true;\n  }\n\n  if (isUserId(chat.id)) {\n    return true;\n  }\n\n  if (isChatChannel(chat)) {\n    return getHasAdminRight(chat, 'postMessages');\n  }\n\n  return isChatAdmin(chat) || !isUserRightBanned(chat, 'sendMessages', chatFullInfo);\n}\n\nexport interface IAllowedAttachmentOptions {\n  canAttachMedia: boolean;\n  canAttachPolls: boolean;\n  canSendStickers: boolean;\n  canSendGifs: boolean;\n  canAttachEmbedLinks: boolean;\n  canSendPhotos: boolean;\n  canSendVideos: boolean;\n  canSendRoundVideos: boolean;\n  canSendAudios: boolean;\n  canSendVoices: boolean;\n  canSendPlainText: boolean;\n  canSendDocuments: boolean;\n  canAttachToDoLists: boolean;\n}\n\nexport function getAllowedAttachmentOptions(\n  chat?: ApiChat,\n  chatFullInfo?: ApiChatFullInfo,\n  isChatWithBot = false,\n  isSavedMessages = false,\n  isStoryReply = false,\n  paidMessagesStars?: number,\n  isInScheduledList = false,\n): IAllowedAttachmentOptions {\n  if (!chat || (paidMessagesStars && isInScheduledList)) {\n    return {\n      canAttachMedia: false,\n      canAttachPolls: false,\n      canSendStickers: false,\n      canSendGifs: false,\n      canAttachEmbedLinks: false,\n      canSendPhotos: false,\n      canSendVideos: false,\n      canSendRoundVideos: false,\n      canSendAudios: false,\n      canSendVoices: false,\n      canSendPlainText: false,\n      canSendDocuments: false,\n      canAttachToDoLists: false,\n    };\n  }\n\n  const isAdmin = isChatAdmin(chat);\n\n  return {\n    canAttachMedia: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendMedia', chatFullInfo),\n    canAttachPolls: !isStoryReply && !chat.isMonoforum\n      && (isAdmin || !isUserRightBanned(chat, 'sendPolls', chatFullInfo))\n      && (!isUserId(chat.id) || isChatWithBot || isSavedMessages),\n    canAttachToDoLists: !isStoryReply && !chat.isMonoforum && !isChatChannel(chat),\n    canSendStickers: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendStickers', chatFullInfo),\n    canSendGifs: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendGifs', chatFullInfo),\n    canAttachEmbedLinks: !isStoryReply && (isAdmin || !isUserRightBanned(chat, 'embedLinks', chatFullInfo)),\n    canSendPhotos: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendPhotos', chatFullInfo),\n    canSendVideos: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendVideos', chatFullInfo),\n    canSendRoundVideos: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendRoundvideos', chatFullInfo),\n    canSendAudios: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendAudios', chatFullInfo),\n    canSendVoices: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendVoices', chatFullInfo),\n    canSendPlainText: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendPlain', chatFullInfo),\n    canSendDocuments: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendDocs', chatFullInfo),\n  };\n}\n\nexport function getMessageSendingRestrictionReason(\n  lang: OldLangFn,\n  currentUserBannedRights?: ApiChatBannedRights,\n  defaultBannedRights?: ApiChatBannedRights,\n) {\n  if (currentUserBannedRights?.sendMessages) {\n    const { untilDate } = currentUserBannedRights;\n    return untilDate && untilDate < FOREVER_BANNED_DATE\n      ? lang(\n        'Channel.Persmission.Denied.SendMessages.Until',\n        lang(\n          'formatDateAtTime',\n          [formatDateToString(new Date(untilDate * 1000), lang.code), formatTime(lang, untilDate * 1000)],\n        ),\n      )\n      : lang('Channel.Persmission.Denied.SendMessages.Forever');\n  }\n\n  if (defaultBannedRights?.sendMessages) {\n    return lang('Channel.Persmission.Denied.SendMessages.DefaultRestrictedText');\n  }\n\n  return undefined;\n}\n\nexport function getForumComposerPlaceholder(\n  lang: OldLangFn,\n  chat?: ApiChat,\n  threadId: ThreadId = MAIN_THREAD_ID,\n  topics?: Record<number, ApiTopic>,\n  isReplying?: boolean,\n) {\n  if (!chat?.isForum) {\n    return undefined;\n  }\n\n  if (threadId === MAIN_THREAD_ID) {\n    if (isReplying || (topics && !topics[GENERAL_TOPIC_ID]?.isClosed)) return undefined;\n    return lang('lng_forum_replies_only');\n  }\n\n  const topic = topics?.[Number(threadId)];\n  if (!topic) {\n    return undefined;\n  }\n\n  if (topic.isClosed && !topic.isOwner && !getHasAdminRight(chat, 'manageTopics')) {\n    return lang('TopicClosedByAdmin');\n  }\n\n  return undefined;\n}\n\nexport function isChatArchived(chat: ApiChat) {\n  return chat.folderId === ARCHIVED_FOLDER_ID;\n}\n\nexport function getCanDeleteChat(chat: ApiChat) {\n  return isChatBasicGroup(chat) || ((isChatSuperGroup(chat) || isChatChannel(chat)) && chat.isCreator);\n}\n\nexport function getFolderDescriptionText(lang: LangFn, folder: ApiChatFolder, chatsCount?: number) {\n  const {\n    excludedChatIds, includedChatIds,\n    bots, groups, contacts, nonContacts, channels,\n  } = folder;\n\n  const filters = [bots, groups, contacts, nonContacts, channels];\n\n  // If folder has multiple additive filters or uses include/exclude lists,\n  // we display folder chats count\n  if (\n    chatsCount !== undefined && (\n      Object.values(filters).filter(Boolean).length > 1\n      || (excludedChatIds?.length)\n      || (includedChatIds?.length)\n    )) {\n    return lang('ChatsPlural', { count: chatsCount }, { pluralValue: chatsCount });\n  }\n\n  // Otherwise, we return a short description of a single filter\n  if (bots) {\n    return lang('FilterBots');\n  } else if (groups) {\n    return lang('FilterGroups');\n  } else if (channels) {\n    return lang('FilterChannels');\n  } else if (contacts) {\n    return lang('FilterContacts');\n  } else if (nonContacts) {\n    return lang('FilterNonContacts');\n  } else {\n    return undefined;\n  }\n}\n\nexport function isChatPublic(chat: ApiChat) {\n  return chat.hasUsername;\n}\n\nexport function getOrderedTopics(\n  topics: ApiTopic[], pinnedOrder?: number[], shouldSortByLastMessage = false,\n): ApiTopic[] {\n  if (shouldSortByLastMessage) {\n    return topics.sort((a, b) => b.lastMessageId - a.lastMessageId);\n  } else {\n    const pinned = topics.filter((topic) => topic.isPinned);\n    const ordered = topics\n      .filter((topic) => !topic.isPinned && !topic.isHidden)\n      .sort((a, b) => b.lastMessageId - a.lastMessageId);\n    const hidden = topics.filter((topic) => !topic.isPinned && topic.isHidden)\n      .sort((a, b) => b.lastMessageId - a.lastMessageId);\n\n    const pinnedOrdered = pinnedOrder\n      ? pinnedOrder.map((id) => pinned.find((topic) => topic.id === id)).filter(Boolean) : pinned;\n\n    return [...pinnedOrdered, ...ordered, ...hidden];\n  }\n}\n\nexport function getPeerColorKey(peer: ApiPeer | undefined) {\n  if (peer?.color?.color) return peer.color.color;\n\n  return peer ? getPeerIdDividend(peer.id) % 7 : 0;\n}\n\nexport function getPeerColorCount(peer: ApiPeer) {\n  const key = getPeerColorKey(peer);\n  const global = getGlobal();\n  return global.peerColors?.general[key].colors?.length || 1;\n}\n\nexport function getIsSavedDialog(chatId: string, threadId: ThreadId | undefined, currentUserId: string | undefined) {\n  return chatId === currentUserId && threadId !== MAIN_THREAD_ID;\n}\n\nexport function getGroupStatus(lang: OldLangFn, chat: ApiChat) {\n  const chatTypeString = lang(getChatTypeString(chat));\n  const { membersCount } = chat;\n\n  const global = getGlobal();\n  const isRestricted = selectIsChatRestricted(global, chat.id);\n  if (isRestricted) {\n    return chatTypeString === 'Channel' ? 'channel is inaccessible' : 'group is inaccessible';\n  }\n\n  if (!membersCount) {\n    return chatTypeString;\n  }\n\n  return chatTypeString === 'Channel'\n    ? lang('Subscribers', membersCount, 'i')\n    : lang('Members', membersCount, 'i');\n}\n\nexport function getCustomPeerFromInvite(invite: ApiChatInviteInfo): CustomPeer {\n  const {\n    title, color, isVerified, isFake, isScam,\n  } = invite;\n  return {\n    isCustomPeer: true,\n    title,\n    peerColorId: color,\n    isVerified,\n    fakeType: isFake ? 'fake' : isScam ? 'scam' : undefined,\n  };\n}\n\nexport function getMockPreparedMessageFromResult(botId: string, preparedMessage: ApiPreparedInlineMessage) {\n  const { result } = preparedMessage;\n\n  const inlineButtons = result?.sendMessage?.replyMarkup?.inlineButtons;\n\n  return {\n    chatId: botId,\n    content: result.sendMessage.content,\n    date: getServerTime(),\n    id: 0,\n    isOutgoing: true,\n    viaBotId: botId,\n    inlineButtons,\n  } satisfies ApiMessage;\n}\n","import { useEffect } from '../lib/teact/teact';\n\nimport { ApiMediaFormat } from '../api/types';\n\nimport { selectIsSynced } from '../global/selectors';\nimport { IS_PROGRESSIVE_SUPPORTED } from '../util/browser/windowEnvironment';\nimport * as mediaLoader from '../util/mediaLoader';\nimport useSelector from './data/useSelector';\nimport useForceUpdate from './useForceUpdate';\n\nconst useMedia = (\n  mediaHash: string | false | undefined,\n  noLoad = false,\n  mediaFormat = ApiMediaFormat.BlobUrl,\n  delay?: number | false,\n) => {\n  const isStreaming = IS_PROGRESSIVE_SUPPORTED && mediaFormat === ApiMediaFormat.Progressive;\n  const mediaData = mediaHash\n    ? (isStreaming ? mediaLoader.getProgressiveUrl(mediaHash)\n      : mediaLoader.getFromMemory(mediaHash)) : undefined;\n\n  const forceUpdate = useForceUpdate();\n  const isSynced = useSelector(selectIsSynced);\n\n  useEffect(() => {\n    if (!noLoad && mediaHash && !mediaData) {\n      const startedAt = Date.now();\n\n      mediaLoader.fetch(mediaHash, mediaFormat).then(() => {\n        const spentTime = Date.now() - startedAt;\n        if (!delay || spentTime >= delay) {\n          forceUpdate();\n        } else {\n          setTimeout(forceUpdate, delay - spentTime);\n        }\n      });\n    }\n  }, [noLoad, mediaHash, mediaData, mediaFormat, delay, isSynced]);\n\n  return mediaData;\n};\n\nexport default useMedia;\n","import { isTauri } from '@tauri-apps/api/core';\n\ndeclare const globalThis: ServiceWorkerGlobalScope & WorkerGlobalScope & SharedWorkerGlobalScope & Window;\n\nexport const IS_MULTIACCOUNT_SUPPORTED = 'SharedWorker' in globalThis;\nexport const IS_INTL_LIST_FORMAT_SUPPORTED = 'ListFormat' in Intl;\nexport const IS_BAD_URL_PARSER = new URL('tg://host').host !== 'host';\nexport const ARE_WEBCODECS_SUPPORTED = 'VideoDecoder' in globalThis;\n\nexport const IS_TAURI = isTauri();\n// @ts-expect-error no types for electron\nexport const IS_ELECTRON = Boolean(globalThis.electron);\n","import type { GlobalState } from '../../global/types';\n\nimport useDerivedState from '../useDerivedState';\nimport useSelectorSignal from './useSelectorSignal';\n\ntype Selector<T> = (global: GlobalState) => T;\n\nexport default function useSelector<T>(selector: Selector<T>) {\n  const selectorSignal = useSelectorSignal(selector);\n  return useDerivedState(selectorSignal);\n}\n","import type { MouseEvent as ReactMouseEvent } from 'react';\nimport type { ElementRef, FC } from '../../lib/teact/teact';\nimport type React from '../../lib/teact/teact';\nimport { useRef, useState } from '../../lib/teact/teact';\n\nimport type { IconName } from '../../types/icons';\n\nimport { IS_TOUCH_ENV, MouseButton } from '../../util/browser/windowEnvironment';\nimport buildClassName from '../../util/buildClassName';\nimport buildStyle from '../../util/buildStyle';\n\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useOldLang from '../../hooks/useOldLang';\n\nimport Icon from '../common/icons/Icon';\nimport Sparkles from '../common/Sparkles';\nimport RippleEffect from './RippleEffect';\nimport Spinner from './Spinner';\n\nimport './Button.scss';\n\nexport type OwnProps = {\n  ref?: ElementRef<HTMLButtonElement | HTMLAnchorElement>;\n  type?: 'button' | 'submit' | 'reset';\n  children: React.ReactNode;\n  size?: 'default' | 'smaller' | 'tiny';\n  color?: (\n    'primary' | 'secondary' | 'gray' | 'danger' | 'translucent' | 'translucent-white' | 'translucent-black'\n    | 'translucent-bordered' | 'dark' | 'green' | 'adaptive' | 'stars' | 'bluredStarsBadge' | 'transparentBlured'\n  );\n  backgroundImage?: string;\n  id?: string;\n  className?: string;\n  round?: boolean;\n  pill?: boolean;\n  badge?: boolean;\n  fluid?: boolean;\n  isText?: boolean;\n  isLoading?: boolean;\n  ariaLabel?: string;\n  ariaControls?: string;\n  hasPopup?: boolean;\n  href?: string;\n  download?: string;\n  disabled?: boolean;\n  nonInteractive?: boolean;\n  allowDisabledClick?: boolean;\n  noFastClick?: boolean;\n  ripple?: boolean;\n  faded?: boolean;\n  tabIndex?: number;\n  isRtl?: boolean;\n  isShiny?: boolean;\n  isRectangular?: boolean;\n  withPremiumGradient?: boolean;\n  withSparkleEffect?: boolean;\n  noSparkleAnimation?: boolean;\n  noPreventDefault?: boolean;\n  noForcedUpperCase?: boolean;\n  shouldStopPropagation?: boolean;\n  style?: string;\n  iconName?: IconName;\n  iconAlignment?: 'top' | 'bottom' | 'start' | 'end';\n  iconClassName?: string;\n  onClick?: (e: ReactMouseEvent<HTMLButtonElement, MouseEvent>) => void;\n  onContextMenu?: (e: ReactMouseEvent<HTMLButtonElement, MouseEvent>) => void;\n  onMouseDown?: (e: ReactMouseEvent<HTMLButtonElement>) => void;\n  onMouseUp?: (e: ReactMouseEvent<HTMLButtonElement>) => void;\n  onMouseEnter?: (e: ReactMouseEvent<HTMLButtonElement>) => void;\n  onMouseLeave?: NoneToVoidFunction;\n  onFocus?: NoneToVoidFunction;\n  onTransitionEnd?: NoneToVoidFunction;\n};\n\n// Longest animation duration;\nconst CLICKED_TIMEOUT = 400;\n\nconst Button: FC<OwnProps> = ({\n  ref,\n  type = 'button',\n  id,\n  children,\n  size = 'default',\n  color = 'primary',\n  backgroundImage,\n  className,\n  round,\n  pill,\n  badge,\n  fluid,\n  isText,\n  isLoading,\n  isShiny,\n  withPremiumGradient,\n  withSparkleEffect,\n  noSparkleAnimation,\n  ariaLabel,\n  ariaControls,\n  hasPopup,\n  href,\n  download,\n  disabled,\n  nonInteractive,\n  allowDisabledClick,\n  noFastClick = color === 'danger',\n  ripple,\n  faded,\n  tabIndex,\n  isRtl,\n  isRectangular,\n  noPreventDefault,\n  shouldStopPropagation,\n  noForcedUpperCase,\n  style,\n  iconName,\n  iconAlignment = 'start',\n  iconClassName,\n  onClick,\n  onContextMenu,\n  onMouseDown,\n  onMouseUp,\n  onMouseEnter,\n  onMouseLeave,\n  onFocus,\n  onTransitionEnd,\n}) => {\n  let elementRef = useRef<HTMLButtonElement | HTMLAnchorElement>();\n  if (ref) {\n    elementRef = ref;\n  }\n\n  const lang = useOldLang();\n\n  const [isClicked, setIsClicked] = useState(false);\n\n  const isNotInteractive = disabled || nonInteractive;\n\n  const fullClassName = buildClassName(\n    'Button',\n    className,\n    size,\n    color,\n    round && 'round',\n    pill && 'pill',\n    fluid && 'fluid',\n    badge && 'badge',\n    isNotInteractive && 'disabled',\n    nonInteractive && 'non-interactive',\n    allowDisabledClick && 'click-allowed',\n    isText && 'text',\n    isLoading && 'loading',\n    ripple && 'has-ripple',\n    faded && 'faded',\n    isClicked && 'clicked',\n    backgroundImage && 'with-image',\n    isShiny && 'shiny',\n    withPremiumGradient && 'premium',\n    isRectangular && 'rectangular',\n    noForcedUpperCase && 'no-upper-case',\n    iconAlignment && iconName && `content-with-icon-${iconAlignment}`,\n  );\n\n  const handleClick = useLastCallback((e: ReactMouseEvent<HTMLButtonElement, MouseEvent>) => {\n    if ((allowDisabledClick || !isNotInteractive) && onClick) {\n      onClick(e);\n    }\n\n    if (shouldStopPropagation) e.stopPropagation();\n\n    setIsClicked(true);\n    setTimeout(() => {\n      setIsClicked(false);\n    }, CLICKED_TIMEOUT);\n  });\n\n  const handleMouseDown = useLastCallback((e: ReactMouseEvent<HTMLButtonElement>) => {\n    if (!noPreventDefault) e.preventDefault();\n\n    if ((allowDisabledClick || !isNotInteractive) && onMouseDown) {\n      onMouseDown(e);\n    }\n\n    if (!IS_TOUCH_ENV && e.button === MouseButton.Main && !noFastClick) {\n      handleClick(e);\n    }\n  });\n\n  const renderIcon = () => {\n    if (!iconName) return undefined;\n    return <Icon name={iconName} className={iconClassName} />;\n  };\n\n  const renderContent = () => {\n    if (isLoading) {\n      return (\n        <div>\n          <span dir={isRtl ? 'auto' : undefined}>{lang('Cache.ClearProgress')}</span>\n          <Spinner color={isText ? 'blue' : 'white'} />\n        </div>\n      );\n    }\n\n    const icon = renderIcon();\n\n    if (!icon) {\n      return children;\n    }\n\n    return (\n      <div className={`with-icon-${iconAlignment}`}>\n        {icon}\n        {children}\n      </div>\n    );\n  };\n\n  const content = (\n    <>\n      {withSparkleEffect && <Sparkles preset=\"button\" noAnimation={noSparkleAnimation} />}\n      {renderContent()}\n      {!isNotInteractive && ripple && (\n        <RippleEffect />\n      )}\n    </>\n  );\n\n  if (href) {\n    return (\n      <a\n        ref={elementRef as ElementRef<HTMLAnchorElement>}\n        id={id}\n        className={fullClassName}\n        href={href}\n        title={ariaLabel}\n        download={download}\n        tabIndex={tabIndex}\n        dir={isRtl ? 'rtl' : undefined}\n        aria-label={ariaLabel}\n        aria-controls={ariaControls}\n        style={style}\n        onTransitionEnd={onTransitionEnd}\n        target=\"_blank\"\n        rel=\"noreferrer\"\n      >\n        {content}\n      </a>\n    );\n  }\n\n  return (\n    <button\n      ref={elementRef as ElementRef<HTMLButtonElement>}\n      id={id}\n      type={type}\n      className={fullClassName}\n      onClick={IS_TOUCH_ENV || noFastClick ? handleClick : undefined}\n      onContextMenu={onContextMenu}\n      onMouseDown={handleMouseDown}\n      onMouseUp={onMouseUp}\n      onMouseEnter={onMouseEnter && !isNotInteractive ? onMouseEnter : undefined}\n      onMouseLeave={onMouseLeave && !isNotInteractive ? onMouseLeave : undefined}\n      onTransitionEnd={onTransitionEnd}\n      onFocus={onFocus && !isNotInteractive ? onFocus : undefined}\n      aria-label={ariaLabel}\n      aria-controls={ariaControls}\n      aria-haspopup={hasPopup}\n      title={ariaLabel}\n      tabIndex={tabIndex}\n      dir={isRtl ? 'rtl' : undefined}\n      style={buildStyle(style, backgroundImage && `background-image: url(${backgroundImage})`) || undefined}\n    >\n      {content}\n    </button>\n  );\n};\n\nexport default Button;\n","import type { ApiLimitType } from '../../api/types';\nimport type { GlobalState } from '../types';\n\nimport { DEFAULT_LIMITS } from '../../limits';\nimport { selectIsCurrentUserPremium } from './users';\n\nexport function selectCurrentLimit<T extends GlobalState>(global: T, limit: ApiLimitType) {\n  const { appConfig } = global;\n  const { limits } = appConfig;\n\n  const isPremium = selectIsCurrentUserPremium(global);\n\n  // When there are new limits when updating a layer, until we get a new configuration, we must use the default values\n  const value = limits[limit]?.[isPremium ? 1 : 0] ?? DEFAULT_LIMITS[limit][isPremium ? 1 : 0];\n  if (limit === 'dialogFilters') return value + 1; // Server does not count \"All\" as folder, but we need to\n  return value;\n}\n\nexport function selectPremiumLimit<T extends GlobalState>(global: T, limit: ApiLimitType) {\n  const { appConfig } = global;\n  if (!appConfig) return DEFAULT_LIMITS[limit][1];\n\n  const { limits } = appConfig;\n\n  return limits[limit][1];\n}\n","import type { ApiCountryCode } from '../api/types';\n\nconst PATTERN_PLACEHOLDER = 'X';\nconst DEFAULT_PATTERN = 'XXX XXX XXX XXX';\n\nexport function getCountryCodeByIso(phoneCodeList: ApiCountryCode[], iso: string) {\n  return phoneCodeList.find((country) => country.iso2 === iso);\n}\n\nexport function getCountryFromPhoneNumber(phoneCodeList: ApiCountryCode[], input = '') {\n  let phoneNumber = input.replace(/[^\\d+]+/g, '');\n  if (phoneNumber.startsWith('+')) {\n    phoneNumber = phoneNumber.substr(1);\n  }\n\n  const possibleCountries = phoneCodeList\n    .filter((country) => phoneNumber.startsWith(country.countryCode));\n  const codesWithPrefix: { code: string; country: ApiCountryCode }[] = possibleCountries\n    .map((country) => (country.prefixes || ['']).map((prefix) => {\n      return {\n        code: `${country.countryCode}${prefix}`,\n        country,\n      };\n    }))\n    .flat();\n\n  const bestMatches = codesWithPrefix\n    .filter(({ code }) => phoneNumber.startsWith(code))\n    .sort((a, b) => a.code.length - b.code.length);\n\n  return bestMatches[bestMatches.length - 1]?.country;\n}\n\nexport function formatPhoneNumber(input: string, country?: ApiCountryCode) {\n  if (!input) {\n    return '';\n  }\n\n  let phoneNumber = input.replace(/[^\\d]+/g, '');\n  if (country) {\n    phoneNumber = phoneNumber.substr(country.countryCode.length);\n  } else if (input.startsWith('+')) {\n    return input;\n  }\n  const pattern = getBestPattern(phoneNumber, country?.patterns);\n\n  const result: string[] = []; // Result character array\n  let j = 0; // Position inside pattern\n  for (let i = 0; i < phoneNumber.length; i++) {\n    while (pattern[j] !== PATTERN_PLACEHOLDER && j < pattern.length) {\n      result.push(pattern[j]);\n      if (pattern[j] === phoneNumber[i]) { // If pattern contains digits, move input position too\n        i++;\n        if (i === phoneNumber.length) break; // But don't overdo it, or it will insert full pattern unexpectedly\n      }\n      j++;\n    }\n\n    result.push(phoneNumber[i]); // For placeholder characters, setting current input digit\n    j++;\n  }\n\n  return result.join('');\n}\n\nfunction getBestPattern(numberWithoutCode: string, patterns?: string[]) {\n  if (!patterns || patterns.length === 0) return DEFAULT_PATTERN;\n  if (patterns.length === 1) return patterns[0];\n\n  const defaultPattern = patterns.find((pattern) => pattern.startsWith(PATTERN_PLACEHOLDER)) || DEFAULT_PATTERN;\n\n  const bestMatches = patterns.filter((pattern) => {\n    const stripped = pattern.replace(/[^\\dX]+/g, '');\n    if (stripped.startsWith(PATTERN_PLACEHOLDER)) return false; // Don't consider default number format here\n    for (let i = 0; i < numberWithoutCode.length; i++) {\n      if (i > stripped.length - 1 || (stripped[i] !== PATTERN_PLACEHOLDER && stripped[i] !== numberWithoutCode[i])) {\n        return false;\n      }\n    }\n    return true;\n  });\n\n  // Playing it safe: if not sure, use default for that region\n  return bestMatches.length === 1 ? bestMatches[0] : defaultPattern;\n}\n\nexport function formatPhoneNumberWithCode(phoneCodeList: ApiCountryCode[], phoneNumber: string) {\n  if (!phoneNumber) {\n    return '';\n  }\n\n  const numberWithPlus = phoneNumber.startsWith('+') ? phoneNumber : `+${phoneNumber}`;\n  const country = getCountryFromPhoneNumber(phoneCodeList, numberWithPlus);\n  if (!country) {\n    return numberWithPlus;\n  }\n  return `+${country.countryCode} ${formatPhoneNumber(numberWithPlus, country)}`;\n}\n","import type { ElementRef } from '../../../../lib/teact/teact';\nimport { getIsHeavyAnimating, useEffect, useRef } from '../../../../lib/teact/teact';\n\nimport { requestMeasure } from '../../../../lib/fasterdom/fasterdom';\n\nimport useHeavyAnimation from '../../../../hooks/useHeavyAnimation';\nimport useLastCallback from '../../../../hooks/useLastCallback';\nimport usePriorityPlaybackCheck, { isPriorityPlaybackActive } from '../../../../hooks/usePriorityPlaybackCheck';\nimport useBackgroundMode, { isBackgroundModeActive } from '../../../../hooks/window/useBackgroundMode';\n\nexport default function useVideoAutoPause(\n  playerRef: ElementRef<HTMLVideoElement>, canPlay: boolean, isPriority?: boolean,\n) {\n  const canPlayRef = useRef();\n  canPlayRef.current = canPlay;\n\n  const { play, pause } = usePlayPause(playerRef);\n\n  const unfreezePlaying = useLastCallback(() => {\n    if (canPlayRef.current && (isPriority || !isFrozen())) {\n      play();\n    }\n  });\n\n  const unfreezePlayingOnRaf = useLastCallback(() => {\n    requestMeasure(unfreezePlaying);\n  });\n\n  useBackgroundMode(pause, unfreezePlayingOnRaf, !canPlay || isPriority);\n  useHeavyAnimation(pause, unfreezePlaying, !canPlay || isPriority);\n  usePriorityPlaybackCheck(pause, unfreezePlaying, !canPlay || isPriority);\n\n  const handlePlaying = useLastCallback(() => {\n    if (!canPlayRef.current || (!isPriority && isFrozen())) {\n      pause();\n    }\n  });\n\n  useEffect(() => {\n    if (canPlay) {\n      if (isPriority || !isFrozen()) {\n        play();\n      }\n    } else {\n      pause();\n    }\n  }, [canPlay, play, pause, isPriority]);\n\n  return { handlePlaying };\n}\n\nfunction usePlayPause(mediaRef: ElementRef<HTMLMediaElement>) {\n  const shouldPauseRef = useRef(false);\n  const isLoadingPlayRef = useRef(false);\n\n  const play = useLastCallback(() => {\n    shouldPauseRef.current = false;\n    if (mediaRef.current && !isLoadingPlayRef.current && document.body.contains(mediaRef.current)) {\n      isLoadingPlayRef.current = true;\n      mediaRef.current.play().then(() => {\n        isLoadingPlayRef.current = false;\n        if (shouldPauseRef.current) {\n          mediaRef.current?.pause();\n          shouldPauseRef.current = false;\n        }\n      }).catch((e) => {\n        // eslint-disable-next-line no-console\n        console.warn(e);\n      });\n    }\n  });\n\n  const pause = useLastCallback(() => {\n    if (isLoadingPlayRef.current) {\n      shouldPauseRef.current = true;\n    } else {\n      mediaRef.current?.pause();\n    }\n  });\n\n  return { play, pause };\n}\n\nfunction isFrozen() {\n  return getIsHeavyAnimating() || isPriorityPlaybackActive() || isBackgroundModeActive();\n}\n","import type { ElementRef } from '../../lib/teact/teact';\nimport type React from '../../lib/teact/teact';\nimport { memo, useMemo, useRef } from '../../lib/teact/teact';\n\nimport useBuffering from '../../hooks/useBuffering';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useSyncEffect from '../../hooks/useSyncEffect';\nimport useVideoCleanup from '../../hooks/useVideoCleanup';\nimport useVideoAutoPause from '../middle/message/hooks/useVideoAutoPause';\n\ntype VideoProps = React.DetailedHTMLProps<React.VideoHTMLAttributes<HTMLVideoElement>, HTMLVideoElement>;\n\ntype OwnProps =\n  {\n    ref?: ElementRef<HTMLVideoElement>;\n    isPriority?: boolean;\n    canPlay: boolean;\n    children?: React.ReactNode;\n    onReady?: NoneToVoidFunction;\n    onBroken?: NoneToVoidFunction;\n  }\n  & VideoProps;\n\nfunction OptimizedVideo({\n  ref,\n  isPriority,\n  canPlay,\n  children,\n  onReady,\n  onBroken,\n  onTimeUpdate,\n  ...restProps\n}: OwnProps) {\n  const localRef = useRef<HTMLVideoElement>();\n  if (!ref) {\n    ref = localRef;\n  }\n\n  const { handlePlaying: handlePlayingForAutoPause } = useVideoAutoPause(ref, canPlay, isPriority);\n\n  const isReadyRef = useRef(false);\n  const handleReady = useLastCallback(() => {\n    if (!isReadyRef.current) {\n      onReady?.();\n      isReadyRef.current = true;\n    }\n  });\n\n  // This is only needed for browsers not allowing autoplay\n  const { isBuffered, bufferingHandlers } = useBuffering(true, onTimeUpdate, onBroken);\n  const { onPlaying: handlePlayingForBuffering, ...otherBufferingHandlers } = bufferingHandlers;\n  useSyncEffect(([prevIsBuffered]) => {\n    if (prevIsBuffered === undefined) {\n      return;\n    }\n\n    handleReady();\n  }, [isBuffered, handleReady]);\n\n  const handlePlaying = useLastCallback((e) => {\n    handlePlayingForAutoPause();\n    handlePlayingForBuffering(e);\n    handleReady();\n    restProps.onPlaying?.(e);\n  });\n\n  const mergedOtherBufferingHandlers = useMemo(() => {\n    const mergedHandlers: Record<string, AnyFunction> = {};\n    Object.keys(otherBufferingHandlers).forEach((keyString) => {\n      const key = keyString as keyof typeof otherBufferingHandlers;\n      mergedHandlers[key] = (event: Event) => {\n        restProps[key as keyof typeof restProps]?.(event);\n        otherBufferingHandlers[key]?.(event);\n      };\n    });\n\n    return mergedHandlers;\n  }, [otherBufferingHandlers, restProps]);\n\n  useVideoCleanup(ref, mergedOtherBufferingHandlers);\n\n  return (\n\n    <video ref={ref} autoPlay {...restProps} {...mergedOtherBufferingHandlers} onPlaying={handlePlaying}>\n      {children}\n    </video>\n  );\n}\n\nexport default memo(OptimizedVideo);\n","import { useRef } from '../lib/teact/teact';\n\nimport useSyncEffect from './useSyncEffect';\n\nconst useLayoutEffectWithPrevDeps = <const T extends readonly any[]>(\n  cb: (args: T | readonly []) => void, dependencies: T,\n) => {\n  const prevDepsRef = useRef<T>();\n\n  return useSyncEffect(() => {\n    const prevDeps = prevDepsRef.current;\n    prevDepsRef.current = dependencies;\n\n    return cb(prevDeps || []);\n    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  }, dependencies);\n};\n\nexport default useLayoutEffectWithPrevDeps;\n","import type { MessageListType, ThreadId } from '../types';\nimport { MAIN_THREAD_ID } from '../api/types';\n\nimport { IS_MOCKED_CLIENT } from '../config';\n\nlet parsedInitialLocationHash: Record<string, string> | undefined;\nlet messageHash: string | undefined;\nlet isAlreadyParsed = false;\nlet initialLocationHash = window.location.hash;\n\nexport function resetInitialLocationHash() {\n  isAlreadyParsed = false;\n  messageHash = undefined;\n  parsedInitialLocationHash = undefined;\n  initialLocationHash = '';\n}\n\nexport function resetLocationHash() {\n  window.location.hash = '';\n}\n\nexport const createLocationHash = (chatId: string, type: MessageListType, threadId: ThreadId): string => {\n  const displayType = type === 'thread' ? undefined : type;\n  const parts = threadId === MAIN_THREAD_ID ? [chatId, displayType] : [chatId, threadId, displayType];\n\n  return parts.filter(Boolean).join('_');\n};\n\nexport function parseLocationHash(currentUserId?: string) {\n  parseInitialLocationHash();\n\n  if (!messageHash) return undefined;\n\n  const parts = messageHash.split('_');\n  let chatId: string | undefined;\n  let type: string | undefined;\n  let threadId: string | undefined;\n  if (parts.length === 1) {\n    chatId = parts[0];\n  } else if (parts.length === 2) {\n    const isType = ['thread', 'pinned', 'scheduled'].includes(parts[1]);\n    chatId = parts[0];\n    type = isType ? parts[1] : 'thread';\n    threadId = !isType ? parts[1] : undefined;\n  } else if (parts.length >= 3) {\n    [chatId, threadId, type] = parts;\n  }\n  if (!chatId?.match(/^-?\\d+$/)) return undefined;\n\n  const isType = ['thread', 'pinned', 'scheduled'].includes(type!);\n\n  const castedThreadId = (chatId === currentUserId ? threadId : Number(threadId)) || MAIN_THREAD_ID;\n\n  return {\n    chatId,\n    type: type && isType ? (type as MessageListType) : 'thread',\n    threadId: castedThreadId,\n  };\n}\n\nexport const createMessageHashUrl = (chatId: string, type: MessageListType, threadId: ThreadId): string => {\n  const url = new URL(window.location.href);\n  url.hash = createLocationHash(chatId, type, threadId);\n  return url.href;\n};\n\nexport function parseInitialLocationHash() {\n  if (parsedInitialLocationHash) return parsedInitialLocationHash;\n\n  if (isAlreadyParsed) return undefined;\n\n  const locationHash = getInitialLocationHash();\n  if (!locationHash) return undefined;\n\n  let parsedHash = locationHash.replace(/^#/, '');\n  if (parsedHash.includes('?')) {\n    [messageHash, parsedHash] = parsedHash.split('?');\n    if (!IS_MOCKED_CLIENT) {\n      window.location.hash = messageHash;\n    }\n  } else if (parsedHash.includes('=')) {\n    if (!IS_MOCKED_CLIENT) {\n      window.location.hash = '';\n    }\n  }\n\n  parsedInitialLocationHash = parsedHash.includes('=') ? parsedHash.split('&').reduce((acc, cur) => {\n    const [key, value] = cur.split('=');\n    acc[key] = value;\n    return acc;\n  }, {} as Record<string, string>) : undefined;\n  isAlreadyParsed = true;\n  if (!parsedInitialLocationHash) {\n    messageHash = parsedHash;\n  }\n\n  return parsedInitialLocationHash;\n}\n\nexport function clearWebTokenAuth() {\n  if (!parsedInitialLocationHash) return;\n\n  delete parsedInitialLocationHash.tgWebAuthToken;\n}\n\nexport function getInitialLocationHash() {\n  return initialLocationHash;\n}\n","import safeExec from '../../util/safeExec';\nimport { fastRaf, throttleWith } from '../../util/schedulers';\nimport { setPhase } from './stricterdom';\n\nlet pendingMeasureTasks: NoneToVoidFunction[] = [];\nlet pendingMutationTasks: NoneToVoidFunction[] = [];\nlet pendingForceReflowTasks: (() => NoneToVoidFunction | void)[] = [];\n\nconst runUpdatePassOnRaf = throttleWithRafFallback(() => {\n  const currentMeasureTasks = pendingMeasureTasks;\n  pendingMeasureTasks = [];\n  currentMeasureTasks.forEach((task) => {\n    safeExec(task);\n  });\n\n  // We use promises to provide correct order for Mutation Observer callback microtasks\n  void Promise.resolve()\n    .then(() => {\n      setPhase('mutate');\n\n      const currentMutationTasks = pendingMutationTasks;\n      pendingMutationTasks = [];\n\n      currentMutationTasks.forEach((task) => {\n        safeExec(task);\n      });\n    })\n    .then(() => {\n      setPhase('measure');\n\n      const pendingForceReflowMutationTasks: NoneToVoidFunction[] = [];\n      // Will include tasks created during the loop\n      for (const task of pendingForceReflowTasks) {\n        safeExec(() => {\n          const mutationTask = task();\n          if (mutationTask) {\n            pendingForceReflowMutationTasks.push(mutationTask);\n          }\n        });\n      }\n      pendingForceReflowTasks = [];\n\n      return pendingForceReflowMutationTasks;\n    })\n    .then((pendingForceReflowMutationTasks) => {\n      setPhase('mutate');\n\n      // Will include tasks created during the loop\n      for (const task of pendingForceReflowMutationTasks) {\n        safeExec(task);\n      }\n    })\n    .then(() => {\n      setPhase('measure');\n    });\n});\n\nexport function requestMeasure(cb: NoneToVoidFunction) {\n  pendingMeasureTasks.push(cb);\n  runUpdatePassOnRaf();\n}\n\nexport function requestMutation(cb: NoneToVoidFunction) {\n  pendingMutationTasks.push(cb);\n  runUpdatePassOnRaf();\n}\n\nexport function requestNextMutation(cb: () => (NoneToVoidFunction | void)) {\n  requestMeasure(() => {\n    requestMutation(cb);\n  });\n}\n\nexport function requestForcedReflow(cb: () => (NoneToVoidFunction | void)) {\n  pendingForceReflowTasks.push(cb);\n  runUpdatePassOnRaf();\n}\n\nfunction throttleWithRafFallback<F extends AnyToVoidFunction>(fn: F) {\n  return throttleWith((throttledFn: NoneToVoidFunction) => {\n    fastRaf(throttledFn, true);\n  }, fn);\n}\n\nexport * from './stricterdom';\n","import {\n  beginHeavyAnimation,\n  useEffect,\n  useRef,\n  useState,\n} from '../../lib/teact/teact';\nimport { getGlobal } from '../../global';\n\nimport type { AnimationLevel } from '../../types';\nimport type { VTTypes } from '../../util/animations/viewTransitionTypes';\n\nimport { VT_CLASS_NAME, VT_TYPE_CLASS_PREFIX } from '../../config';\nimport { requestMutation, requestNextMutation } from '../../lib/fasterdom/fasterdom';\nimport { selectSharedSettings } from '../../global/selectors/sharedState';\nimport { IS_VIEW_TRANSITION_SUPPORTED } from '../../util/browser/windowEnvironment';\nimport Deferred from '../../util/Deferred';\n\ntype TransitionFunction = () => Promise<void> | void;\n\ntype TransitionState = 'idle' | 'capturing-old' | 'capturing-new' | 'animating' | 'skipped';\ninterface ViewTransitionController {\n  transitionState: TransitionState;\n  startViewTransition: (\n    types: VTTypes, domUpdateCallback?: TransitionFunction, minimumAnimationLevel?: AnimationLevel,\n  ) => PromiseLike<void> | void;\n}\n\ntype ViewTransitionParameters = {\n  domUpdateCallback?: TransitionFunction;\n  types?: VTTypes;\n};\n\nconst SKIP_TIMEOUT = 1000;\n\nlet hasActiveTransition = false;\nexport function hasActiveViewTransition(): boolean {\n  return hasActiveTransition;\n}\n\nexport function useViewTransition(): ViewTransitionController {\n  const parameters = useRef<ViewTransitionParameters>();\n  const [transitionState, setTransitionState] = useState<TransitionState>('idle');\n\n  useEffect(() => {\n    if (transitionState !== 'capturing-old') return;\n    const { domUpdateCallback, types } = parameters.current || {};\n\n    const onHeavyAnimationEnd = beginHeavyAnimation();\n    const transition = document.startViewTransition(async () => {\n      setTransitionState('capturing-new');\n      if (domUpdateCallback) {\n        await domUpdateCallback();\n      }\n      const deferred = new Deferred<void>();\n      requestNextMutation(() => {\n        deferred.resolve();\n      });\n      return deferred.promise;\n    });\n\n    types?.getTypes().forEach((type) => {\n      transition.types?.add(type);\n    });\n\n    transition.finished.then(() => {\n      onHeavyAnimationEnd();\n      setTransitionState('idle');\n      requestMutation(() => {\n        cleanUp(types);\n      });\n\n      hasActiveTransition = false;\n    });\n\n    let isReady = false;\n\n    transition.ready.then(() => {\n      isReady = true;\n      setTransitionState('animating');\n    }).catch((e: unknown) => {\n      // eslint-disable-next-line no-console\n      console.error('View transition error', e, types?.getTypes());\n      setTransitionState('skipped');\n      requestMutation(() => {\n        cleanUp(types);\n      });\n\n      hasActiveTransition = false;\n    });\n\n    setTimeout(() => {\n      if (!isReady) { // Skip transition if it's not prepared in time\n        transition.skipTransition();\n      }\n    }, SKIP_TIMEOUT);\n  }, [transitionState]);\n\n  function startViewTransition(\n    types: VTTypes,\n    updateCallback?: TransitionFunction,\n    minimumAnimationLevel: AnimationLevel = 1,\n  ): PromiseLike<void> | void {\n    const global = getGlobal();\n    const { animationLevel } = selectSharedSettings(global);\n    // Fallback: simply run the callback immediately if view transitions aren't supported.\n    if (!IS_VIEW_TRANSITION_SUPPORTED || animationLevel < minimumAnimationLevel) {\n      updateCallback?.();\n      return;\n    }\n\n    if (hasActiveTransition) {\n      // eslint-disable-next-line no-console\n      console.warn('VT skipped because another transition is already active', types.getTypes());\n      updateCallback?.();\n      return;\n    }\n\n    parameters.current = {\n      domUpdateCallback: updateCallback,\n      types,\n    };\n    setTransitionState('capturing-old');\n    requestMutation(() => {\n      document.documentElement.classList.add(VT_CLASS_NAME);\n      types.getTypes().forEach((type) => {\n        document.documentElement.classList.add(`${VT_TYPE_CLASS_PREFIX}${type}`);\n      });\n    });\n\n    hasActiveTransition = true;\n  }\n\n  return {\n    transitionState,\n    startViewTransition,\n  };\n}\n\nfunction cleanUp(types?: VTTypes) {\n  types?.getTypes().forEach((type) => {\n    document.documentElement.classList.remove(`${VT_TYPE_CLASS_PREFIX}${type}`);\n  });\n  document.documentElement.classList.remove(VT_CLASS_NAME);\n}\n","import type { ApiMessage, ApiMessageSearchType } from '../../api/types';\nimport type {\n  ChatMediaSearchParams,\n  ChatMediaSearchSegment,\n  LoadingState,\n  MiddleSearchParams,\n  MiddleSearchResults,\n  SharedMediaType,\n  ThreadId,\n} from '../../types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport {\n  areSortedArraysEqual, areSortedArraysIntersecting, omit, unique,\n} from '../../util/iteratees';\nimport { buildChatThreadKey, isMediaLoadableInViewer } from '../helpers';\nimport { selectTabState } from '../selectors';\nimport { selectChatMediaSearch } from '../selectors/middleSearch';\nimport { updateTabState } from './tabs';\n\ninterface SharedMediaSearchParams {\n  currentType?: SharedMediaType;\n  resultsByType?: Partial<Record<SharedMediaType, {\n    totalCount?: number;\n    nextOffsetId: number;\n    foundIds: number[];\n  }>>;\n}\n\nfunction replaceMiddleSearch<T extends GlobalState>(\n  global: T,\n  chatThreadKey: string,\n  searchParams?: MiddleSearchParams,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const current = selectTabState(global, tabId).middleSearch.byChatThreadKey;\n  if (!searchParams) {\n    return updateTabState(global, {\n      middleSearch: {\n        byChatThreadKey: omit(current, [chatThreadKey]),\n      },\n    }, tabId);\n  }\n\n  const { type = 'chat', ...rest } = searchParams;\n  return updateTabState(global, {\n    middleSearch: {\n      byChatThreadKey: {\n        ...selectTabState(global, tabId).middleSearch.byChatThreadKey,\n        [chatThreadKey]: {\n          type,\n          ...rest,\n        },\n      },\n    },\n  }, tabId);\n}\n\nexport function updateMiddleSearch<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  update: Partial<MiddleSearchParams>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n  const currentSearch = selectTabState(global, tabId).middleSearch.byChatThreadKey[chatThreadKey];\n\n  const updated = {\n    type: 'chat',\n    ...currentSearch,\n    ...update,\n  } satisfies MiddleSearchParams;\n\n  if (!updated.isHashtag) {\n    updated.type = 'chat';\n  }\n\n  if (currentSearch && (currentSearch.type !== updated.type || currentSearch.savedTag !== updated.savedTag)) {\n    updated.results = undefined;\n  }\n\n  return replaceMiddleSearch(global, chatThreadKey, updated, tabId);\n}\n\nexport function resetMiddleSearch<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return replaceMiddleSearch(global, buildChatThreadKey(chatId, threadId), {\n    type: 'chat',\n  }, tabId);\n}\n\nfunction replaceMiddleSearchResults<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  results: MiddleSearchResults,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateMiddleSearch(global, chatId, threadId, {\n    results,\n    fetchingQuery: undefined,\n  }, tabId);\n}\n\nexport function updateMiddleSearchResults<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  update: MiddleSearchResults,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n  const { results } = selectTabState(global, tabId).middleSearch.byChatThreadKey[chatThreadKey] || {};\n  const prevQuery = (results?.query) || '';\n  if (update.query !== prevQuery) {\n    return replaceMiddleSearchResults(global, chatId, threadId, update, tabId);\n  }\n\n  const prevFoundIds = (results?.foundIds) || [];\n  const {\n    query, foundIds: newFoundIds, totalCount, nextOffsetId, nextOffsetPeerId, nextOffsetRate,\n  } = update;\n  const foundIds = unique(Array.prototype.concat(prevFoundIds, newFoundIds));\n  const foundOrPrevFoundIds = areSortedArraysEqual(prevFoundIds, foundIds) ? prevFoundIds : foundIds;\n\n  return replaceMiddleSearchResults(\n    global, chatId, threadId, {\n      query,\n      foundIds: foundOrPrevFoundIds,\n      totalCount,\n      nextOffsetId,\n      nextOffsetRate,\n      nextOffsetPeerId,\n    }, tabId,\n  );\n}\n\nexport function closeMiddleSearch<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return replaceMiddleSearch(global, chatThreadKey, undefined, tabId);\n}\n\nfunction replaceSharedMediaSearch<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  searchParams: SharedMediaSearchParams,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return updateTabState(global, {\n    sharedMediaSearch: {\n      byChatThreadKey: {\n        ...selectTabState(global, tabId).sharedMediaSearch.byChatThreadKey,\n        [chatThreadKey]: searchParams,\n      },\n    },\n  }, tabId);\n}\n\nexport function updateSharedMediaSearchType<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  currentType: SharedMediaType | undefined,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return replaceSharedMediaSearch(global, chatId, threadId, {\n    ...selectTabState(global, tabId).sharedMediaSearch.byChatThreadKey[chatThreadKey],\n    currentType,\n  }, tabId);\n}\n\nexport function replaceSharedMediaSearchResults<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  type: ApiMessageSearchType,\n  foundIds?: number[],\n  totalCount?: number,\n  nextOffsetId?: number,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return replaceSharedMediaSearch(global, chatId, threadId, {\n    ...selectTabState(global, tabId).sharedMediaSearch.byChatThreadKey[chatThreadKey],\n    resultsByType: {\n      ...(selectTabState(global, tabId).sharedMediaSearch.byChatThreadKey[chatThreadKey] || {}).resultsByType,\n      [type]: {\n        foundIds,\n        totalCount,\n        nextOffsetId,\n      },\n    },\n  }, tabId);\n}\n\nexport function updateSharedMediaSearchResults<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  type: SharedMediaType,\n  newFoundIds: number[],\n  totalCount?: number,\n  nextOffsetId?: number,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  const { resultsByType } = selectTabState(global, tabId).sharedMediaSearch.byChatThreadKey[chatThreadKey] || {};\n  const prevFoundIds = resultsByType?.[type] ? resultsByType[type].foundIds : [];\n  const foundIds = orderFoundIdsByDescending(unique(Array.prototype.concat(prevFoundIds, newFoundIds)));\n  const foundOrPrevFoundIds = areSortedArraysEqual(prevFoundIds, foundIds) ? prevFoundIds : foundIds;\n\n  return replaceSharedMediaSearchResults(\n    global,\n    chatId,\n    threadId,\n    type,\n    foundOrPrevFoundIds,\n    totalCount,\n    nextOffsetId,\n    tabId,\n  );\n}\n\nfunction orderFoundIdsByDescending(listedIds: number[]) {\n  return listedIds.sort((a, b) => b - a);\n}\n\nfunction orderFoundIdsByAscending(array: number[]) {\n  return array.sort((a, b) => a - b);\n}\n\nexport function mergeWithChatMediaSearchSegment(\n  foundIds: number[],\n  loadingState: LoadingState,\n  segment?: ChatMediaSearchSegment,\n): ChatMediaSearchSegment {\n  if (!segment) {\n    return {\n      foundIds,\n      loadingState,\n    };\n  }\n  const mergedFoundIds = orderFoundIdsByAscending(unique(Array.prototype.concat(segment.foundIds, foundIds)));\n  if (!areSortedArraysEqual(segment.foundIds, foundIds)) {\n    segment.foundIds = mergedFoundIds;\n  }\n  const mergedLoadingState: LoadingState = {\n    areAllItemsLoadedForwards: loadingState.areAllItemsLoadedForwards\n      || segment.loadingState.areAllItemsLoadedForwards,\n    areAllItemsLoadedBackwards: loadingState.areAllItemsLoadedBackwards\n      || segment.loadingState.areAllItemsLoadedBackwards,\n  };\n  segment.loadingState = mergedLoadingState;\n  return segment;\n}\n\nfunction mergeChatMediaSearchSegments(currentSegment: ChatMediaSearchSegment, segments: ChatMediaSearchSegment[]) {\n  return segments.reduce((acc, segment) => {\n    const hasIntersection = areSortedArraysIntersecting(segment.foundIds, currentSegment.foundIds);\n    if (hasIntersection) {\n      currentSegment = mergeWithChatMediaSearchSegment(\n        currentSegment.foundIds,\n        currentSegment.loadingState,\n        segment,\n      );\n    } else {\n      acc.push(segment);\n    }\n    return acc;\n  }, [] as ChatMediaSearchSegment[]);\n}\n\nexport function updateChatMediaSearchResults<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  currentSegment: ChatMediaSearchSegment,\n  searchParams: ChatMediaSearchParams,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const segments = mergeChatMediaSearchSegments(currentSegment, searchParams.segments);\n\n  return replaceChatMediaSearchResults(\n    global,\n    chatId,\n    threadId,\n    currentSegment,\n    segments,\n    tabId,\n  );\n}\n\nfunction removeIdFromSegment(id: number, segment: ChatMediaSearchSegment): ChatMediaSearchSegment {\n  const foundIds = segment.foundIds.filter((foundId) => foundId !== id);\n\n  return {\n    ...segment,\n    foundIds,\n  };\n}\n\nfunction removeIdsFromChatMediaSearchParams(\n  id: number,\n  searchParams: ChatMediaSearchParams,\n): ChatMediaSearchParams {\n  const currentSegment = removeIdFromSegment(id, searchParams.currentSegment);\n  const segments = searchParams.segments.map((segment) => removeIdFromSegment(id, segment));\n\n  return {\n    ...searchParams,\n    currentSegment,\n    segments,\n  };\n}\n\nexport function removeIdFromSearchResults<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  id: number,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const searchParams = selectChatMediaSearch(global, chatId, threadId, tabId);\n  if (!searchParams) return global;\n\n  const updatedSearchParams = removeIdsFromChatMediaSearchParams(id, searchParams);\n\n  return replaceChatMediaSearch(\n    global,\n    chatId,\n    threadId,\n    updatedSearchParams,\n    tabId,\n  );\n}\n\nfunction resetForwardsLoadingStateInParams(\n  searchParams: ChatMediaSearchParams,\n) {\n  searchParams.currentSegment.loadingState.areAllItemsLoadedForwards = false;\n  searchParams.segments.forEach((segment) => {\n    segment.loadingState.areAllItemsLoadedForwards = false;\n  });\n}\n\nexport function updateChatMediaLoadingState<T extends GlobalState>(\n  global: T,\n  newMessage: ApiMessage,\n  chatId: string,\n  threadId: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  if (!isMediaLoadableInViewer(newMessage)) {\n    return global;\n  }\n  const searchParams = selectChatMediaSearch(global, chatId, threadId, tabId);\n  if (!searchParams) return global;\n  resetForwardsLoadingStateInParams(searchParams);\n\n  return replaceChatMediaSearch(\n    global,\n    chatId,\n    threadId,\n    searchParams,\n    tabId,\n  );\n}\n\nexport function initializeChatMediaSearchResults<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const loadingState: LoadingState = {\n    areAllItemsLoadedForwards: false,\n    areAllItemsLoadedBackwards: false,\n  };\n  const currentSegment: ChatMediaSearchSegment = {\n    foundIds: [],\n    loadingState,\n  };\n  const segments: ChatMediaSearchSegment[] = [];\n\n  const isLoading = false;\n\n  return replaceChatMediaSearch(global, chatId, threadId, {\n    currentSegment,\n    segments,\n    isLoading,\n  }, tabId);\n}\n\nexport function setChatMediaSearchLoading<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  isLoading: boolean,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n  const searchParams = selectTabState(global, tabId).chatMediaSearch.byChatThreadKey[chatThreadKey];\n\n  if (!searchParams) {\n    return global;\n  }\n\n  return replaceChatMediaSearch(global, chatId, threadId, {\n    ...searchParams,\n    isLoading,\n  }, tabId);\n}\n\nexport function replaceChatMediaSearchResults<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  currentSegment: ChatMediaSearchSegment,\n  segments: ChatMediaSearchSegment[],\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return replaceChatMediaSearch(global, chatId, threadId, {\n    ...selectTabState(global, tabId).chatMediaSearch.byChatThreadKey[chatThreadKey],\n    currentSegment,\n    segments,\n  }, tabId);\n}\n\nfunction replaceChatMediaSearch<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  searchParams: ChatMediaSearchParams,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return updateTabState(global, {\n    chatMediaSearch: {\n      byChatThreadKey: {\n        ...selectTabState(global, tabId).chatMediaSearch.byChatThreadKey,\n        [chatThreadKey]: searchParams,\n      },\n    },\n  }, tabId);\n}\n","import type { ApiChat, ApiPeer, ApiUser } from '../../api/types';\nimport type { OldLangFn } from '../../hooks/useOldLang';\nimport type { CustomPeer } from '../../types';\n\nimport { SERVICE_NOTIFICATIONS_USER_ID } from '../../config';\nimport { isUserId } from '../../util/entities/ids';\nimport { getTranslationFn, type LangFn } from '../../util/localization';\nimport { prepareSearchWordsForNeedle } from '../../util/searchWords';\nimport { selectChat, selectPeer, selectUser } from '../selectors';\nimport { getGlobal } from '..';\nimport { getChatTitle } from './chats';\nimport { getUserFirstOrLastName, getUserFullName } from './users';\n\nexport function isApiPeerChat(peer: ApiPeer): peer is ApiChat {\n  return 'title' in peer;\n}\n\nexport function isApiPeerUser(peer: ApiPeer): peer is ApiUser {\n  return !isApiPeerChat(peer);\n}\n\nexport function filterPeersByQuery({\n  ids,\n  query,\n  type = 'peer',\n}: {\n  ids: string[];\n  query: string | undefined;\n  type?: 'chat' | 'user' | 'peer';\n}) {\n  if (!query) {\n    return ids;\n  }\n  const global = getGlobal();\n  const lang = getTranslationFn();\n\n  const searchWords = prepareSearchWordsForNeedle(query);\n\n  const selectorFn = type === 'chat' ? selectChat : type === 'user' ? selectUser : selectPeer;\n\n  return ids.filter((id) => {\n    const peer = selectorFn(global, id);\n    if (!peer) {\n      return false;\n    }\n\n    const localizedTitle = isApiPeerChat(peer)\n      ? getChatTitle(lang, peer)\n      : id === global.currentUserId ? lang('SavedMessages') : undefined;\n    const isFoundInLocalized = localizedTitle ? searchWords(localizedTitle) : undefined;\n\n    const name = getPeerFullTitle(lang, peer);\n\n    return isFoundInLocalized\n      || (name && searchWords(name))\n      || Boolean(peer.usernames?.find(({ username }) => searchWords(username)));\n  });\n}\n\nexport function getPeerTypeKey(peer: ApiPeer) {\n  if (isApiPeerChat(peer)) {\n    if (peer.type === 'chatTypeBasicGroup' || peer.type === 'chatTypeSuperGroup') {\n      return 'ChatList.PeerTypeGroup';\n    }\n\n    if (peer.type === 'chatTypeChannel') {\n      return 'ChatList.PeerTypeChannel';\n    }\n\n    if (peer.type === 'chatTypePrivate') {\n      return 'ChatList.PeerTypeNonContact';\n    }\n\n    return undefined;\n  }\n\n  if (peer.id === SERVICE_NOTIFICATIONS_USER_ID) {\n    return 'ServiceNotifications';\n  }\n\n  if (peer.isSupport) {\n    return 'SupportStatus';\n  }\n\n  if (peer.type && peer.type === 'userTypeBot') {\n    return 'ChatList.PeerTypeBot';\n  }\n\n  if (peer.isContact) {\n    return 'ChatList.PeerTypeContact';\n  }\n\n  return 'ChatList.PeerTypeNonContactUser';\n}\n\nexport function getPeerTitle(lang: OldLangFn | LangFn, peer: ApiPeer | CustomPeer) {\n  if (!peer) return undefined;\n  if ('isCustomPeer' in peer) {\n    // TODO: Remove any after full migration to new lang\n    return peer.titleKey ? lang(peer.titleKey as any) : peer.title;\n  }\n  return isApiPeerUser(peer) ? getUserFirstOrLastName(peer) : getChatTitle(lang, peer);\n}\n\nexport function getPeerFullTitle(lang: OldLangFn | LangFn, peer: ApiPeer | CustomPeer) {\n  if (!peer) return undefined;\n  if ('isCustomPeer' in peer) {\n    // TODO: Remove any after full migration to new lang\n    return peer.titleKey ? lang(peer.titleKey as any) : peer.title;\n  }\n  return isApiPeerUser(peer) ? getUserFullName(peer) : getChatTitle(lang, peer);\n}\n\nexport function getMessageSenderName(lang: LangFn, chatId: string, sender: ApiPeer) {\n  // Hide sender name for private chats\n  if (isUserId(chatId)) return undefined;\n\n  if (isApiPeerChat(sender)) {\n    if (chatId === sender.id) return undefined;\n\n    return sender.title;\n  }\n\n  if (sender.isSelf) {\n    return lang('FromYou');\n  }\n\n  return getPeerTitle(lang, sender);\n}\n","function promisifyRequest(request) {\n    return new Promise((resolve, reject) => {\n        // @ts-ignore - file size hacks\n        request.oncomplete = request.onsuccess = () => resolve(request.result);\n        // @ts-ignore - file size hacks\n        request.onabort = request.onerror = () => reject(request.error);\n    });\n}\nfunction createStore(dbName, storeName) {\n    let dbp;\n    const getDB = () => {\n        if (dbp)\n            return dbp;\n        const request = indexedDB.open(dbName);\n        request.onupgradeneeded = () => request.result.createObjectStore(storeName);\n        dbp = promisifyRequest(request);\n        dbp.then((db) => {\n            // It seems like Safari sometimes likes to just close the connection.\n            // It's supposed to fire this event when that happens. Let's hope it does!\n            db.onclose = () => (dbp = undefined);\n        }, () => { });\n        return dbp;\n    };\n    return (txMode, callback) => getDB().then((db) => callback(db.transaction(storeName, txMode).objectStore(storeName)));\n}\nlet defaultGetStoreFunc;\nfunction defaultGetStore() {\n    if (!defaultGetStoreFunc) {\n        defaultGetStoreFunc = createStore('keyval-store', 'keyval');\n    }\n    return defaultGetStoreFunc;\n}\n/**\n * Get a value by its key.\n *\n * @param key\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction get(key, customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => promisifyRequest(store.get(key)));\n}\n/**\n * Set a value with a key.\n *\n * @param key\n * @param value\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction set(key, value, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        store.put(value, key);\n        return promisifyRequest(store.transaction);\n    });\n}\n/**\n * Set multiple values at once. This is faster than calling set() multiple times.\n * It's also atomic  if one of the pairs can't be added, none will be added.\n *\n * @param entries Array of entries, where each entry is an array of `[key, value]`.\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction setMany(entries, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        entries.forEach((entry) => store.put(entry[1], entry[0]));\n        return promisifyRequest(store.transaction);\n    });\n}\n/**\n * Get multiple values by their keys\n *\n * @param keys\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction getMany(keys, customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => Promise.all(keys.map((key) => promisifyRequest(store.get(key)))));\n}\n/**\n * Update a value. This lets you see the old value and update it as an atomic operation.\n *\n * @param key\n * @param updater A callback that takes the old value and returns a new value.\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction update(key, updater, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => \n    // Need to create the promise manually.\n    // If I try to chain promises, the transaction closes in browsers\n    // that use a promise polyfill (IE10/11).\n    new Promise((resolve, reject) => {\n        store.get(key).onsuccess = function () {\n            try {\n                store.put(updater(this.result), key);\n                resolve(promisifyRequest(store.transaction));\n            }\n            catch (err) {\n                reject(err);\n            }\n        };\n    }));\n}\n/**\n * Delete a particular key from the store.\n *\n * @param key\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction del(key, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        store.delete(key);\n        return promisifyRequest(store.transaction);\n    });\n}\n/**\n * Delete multiple keys at once.\n *\n * @param keys List of keys to delete.\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction delMany(keys, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        keys.forEach((key) => store.delete(key));\n        return promisifyRequest(store.transaction);\n    });\n}\n/**\n * Clear all values in the store.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction clear(customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        store.clear();\n        return promisifyRequest(store.transaction);\n    });\n}\nfunction eachCursor(store, callback) {\n    store.openCursor().onsuccess = function () {\n        if (!this.result)\n            return;\n        callback(this.result);\n        this.result.continue();\n    };\n    return promisifyRequest(store.transaction);\n}\n/**\n * Get all keys in the store.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction keys(customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => {\n        // Fast path for modern browsers\n        if (store.getAllKeys) {\n            return promisifyRequest(store.getAllKeys());\n        }\n        const items = [];\n        return eachCursor(store, (cursor) => items.push(cursor.key)).then(() => items);\n    });\n}\n/**\n * Get all values in the store.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction values(customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => {\n        // Fast path for modern browsers\n        if (store.getAll) {\n            return promisifyRequest(store.getAll());\n        }\n        const items = [];\n        return eachCursor(store, (cursor) => items.push(cursor.value)).then(() => items);\n    });\n}\n/**\n * Get all entries in the store. Each entry is an array of `[key, value]`.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction entries(customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => {\n        // Fast path for modern browsers\n        // (although, hopefully we'll get a simpler path some day)\n        if (store.getAll && store.getAllKeys) {\n            return Promise.all([\n                promisifyRequest(store.getAllKeys()),\n                promisifyRequest(store.getAll()),\n            ]).then(([keys, values]) => keys.map((key, i) => [key, values[i]]));\n        }\n        const items = [];\n        return customStore('readonly', (store) => eachCursor(store, (cursor) => items.push([cursor.key, cursor.value])).then(() => items));\n    });\n}\n\nexport { clear, createStore, del, delMany, entries, get, getMany, keys, promisifyRequest, set, setMany, update, values };\n","import {\n  clear,\n  createStore,\n  del,\n  delMany,\n  entries as getEntries,\n  get,\n  getMany,\n  keys as getKeys,\n  set,\n  setMany,\n  update,\n  values as getValues,\n} from 'idb-keyval';\n\nclass IdbStore {\n  public store: ReturnType<typeof createStore>;\n\n  constructor(name: string) {\n    this.store = createStore(name, 'store');\n  }\n\n  public set(key: string, value: any) {\n    return set(key, value, this.store);\n  }\n\n  public setMany(entries: [string, any][]) {\n    return setMany(entries, this.store);\n  }\n\n  public get<T = unknown>(key: string) {\n    return get<T>(key, this.store);\n  }\n\n  public getMany<T = unknown>(keys: string[]) {\n    return getMany<T>(keys, this.store);\n  }\n\n  public clear() {\n    return clear(this.store);\n  }\n\n  public del(key: string) {\n    return del(key, this.store);\n  }\n\n  public delMany(keys: string[]) {\n    return delMany(keys, this.store);\n  }\n\n  public entries() {\n    return getEntries(this.store);\n  }\n\n  public keys() {\n    return getKeys(this.store);\n  }\n\n  public values<T = unknown>() {\n    return getValues<T>(this.store);\n  }\n\n  public update<T = unknown>(key: string, updater: (oldValue: T | undefined) => T) {\n    return update(key, updater, this.store);\n  }\n}\n\nexport const MAIN_IDB_STORE = new IdbStore('tt-data');\nexport const PASSCODE_IDB_STORE = new IdbStore('tt-passcode');\n","import {\n  type ApiFormattedText,\n  type ApiMessageEntityTimestamp,\n  ApiMessageEntityTypes,\n} from '../../api/types';\n\nimport { getSeconds } from './units';\n\nconst TIMESTAMP_RE = /\\b(?:(\\d{1,2}):)?([0-5]?\\d):([0-5]\\d)\\b/g;\n\nexport function addTimestampEntities<T extends ApiFormattedText>(apiText: T): T {\n  const resultText: Required<ApiFormattedText> & T = {\n    ...apiText,\n    text: apiText.text,\n    entities: apiText.entities?.filter((e) => e.type !== ApiMessageEntityTypes.Timestamp) || [],\n  };\n\n  const text = resultText.text;\n\n  for (const match of text.matchAll(TIMESTAMP_RE)) {\n    const fullMatch = match[0];\n    const hourStr = match[1];\n    const minuteStr = match[2];\n    const secondStr = match[3];\n    const offset = match.index ?? 0;\n    const length = fullMatch.length;\n\n    const minutes = parseInt(minuteStr, 10);\n    const seconds = parseInt(secondStr, 10);\n\n    if (minutes > 59 || seconds > 59) {\n      continue;\n    }\n\n    let totalSeconds: number;\n    if (hourStr !== undefined) {\n      const hours = parseInt(hourStr, 10);\n      totalSeconds = getSeconds(hours, minutes, seconds);\n    } else {\n      totalSeconds = getSeconds(0, minutes, seconds);\n    }\n\n    let overlaps = false;\n    for (const entity of resultText.entities) {\n      if (offset < entity.offset + entity.length && offset + length > entity.offset) {\n        overlaps = true;\n        break;\n      }\n    }\n    if (overlaps) {\n      continue;\n    }\n\n    const newEntity: ApiMessageEntityTimestamp = {\n      type: ApiMessageEntityTypes.Timestamp,\n      offset,\n      length,\n      timestamp: totalSeconds,\n    };\n\n    let inserted = false;\n    for (let i = 0; i < resultText.entities.length; i++) {\n      if (offset < resultText.entities[i].offset) {\n        resultText.entities.splice(i, 0, newEntity);\n        inserted = true;\n        break;\n      }\n    }\n    if (!inserted) {\n      resultText.entities.push(newEntity);\n    }\n  }\n\n  return resultText;\n}\n\nexport function parseTimestampDuration(input: string): number | undefined {\n  input = input.trim();\n\n  if (!input.startsWith('-') && Number.isInteger(Number(input))) {\n    return parseInt(input, 10);\n  }\n\n  if (input.includes(':')) {\n    const parts = input.split(':');\n\n    if (parts.length === 2) {\n      const minutes = parseInt(parts[0], 10);\n      const seconds = parseInt(parts[1], 10);\n\n      if (\n        Number.isNaN(minutes) || Number.isNaN(seconds)\n        || minutes < 0 || seconds < 0 || seconds >= 60\n      ) {\n        return undefined;\n      }\n      return minutes * 60 + seconds;\n    }\n\n    if (parts.length === 3) {\n      const hours = parseInt(parts[0], 10);\n      const minutes = parseInt(parts[1], 10);\n      const seconds = parseInt(parts[2], 10);\n\n      if (\n        Number.isNaN(hours) || Number.isNaN(minutes) || Number.isNaN(seconds)\n        || hours < 0 || minutes < 0 || seconds < 0 || minutes >= 60 || seconds >= 60\n      ) {\n        return undefined;\n      }\n      return hours * 3600 + minutes * 60 + seconds;\n    }\n\n    return undefined;\n  }\n\n  const regex = /^(?:(\\d+)h)?(?:(\\d+)m)?(?:(\\d+)s)?$/i;\n  const match = input.match(regex);\n  if (!match) {\n    return undefined;\n  }\n\n  const hours = match[1] ? parseInt(match[1], 10) : 0;\n  const minutes = match[2] ? parseInt(match[2], 10) : 0;\n  const seconds = match[3] ? parseInt(match[3], 10) : 0;\n\n  if (\n    Number.isNaN(hours) || Number.isNaN(minutes) || Number.isNaN(seconds)\n    || minutes >= 60 || seconds >= 60\n  ) {\n    return undefined;\n  }\n  return hours * 3600 + minutes * 60 + seconds;\n}\n","import { LEGACY_PASSCODE_CACHE_NAME } from '../config';\nimport { PASSCODE_IDB_STORE } from './browser/idb';\nimport * as cacheApi from './cacheApi';\n\nconst IV_LENGTH = 12;\nconst SALT = 'harder better faster stronger';\n\nlet currentPasscodeHash: ArrayBuffer | undefined;\n\nexport class UnrecoverablePasscodeError extends Error {}\n\nexport function getPasscodeHash() {\n  return currentPasscodeHash;\n}\n\nexport function setPasscodeHash(passcodeHash: ArrayBuffer) {\n  currentPasscodeHash = passcodeHash;\n}\n\nexport async function setupPasscode(passcode: string) {\n  currentPasscodeHash = await sha256(passcode);\n}\n\nexport async function encryptSession(sessionJson?: string, globalJson?: string) {\n  if (!currentPasscodeHash) {\n    // eslint-disable-next-line no-console\n    console.error('[api/passcode] Missing current passcode');\n    throw new Error('[api/passcode] Missing current passcode');\n  }\n\n  await Promise.all([\n    (async () => {\n      if (!sessionJson) return;\n\n      const sessionEncrypted = await aesEncrypt(sessionJson, currentPasscodeHash);\n      await store('sessionEncrypted', sessionEncrypted);\n    })(),\n    (async () => {\n      if (!globalJson) return;\n\n      const globalEncrypted = await aesEncrypt(globalJson, currentPasscodeHash);\n      await store('globalEncrypted', globalEncrypted);\n    })(),\n  ]);\n}\n\nexport async function decryptSessionByCurrentHash() {\n  if (!currentPasscodeHash) {\n    // eslint-disable-next-line no-console\n    console.error('[api/passcode] Missing current passcode');\n    throw new Error('[api/passcode] Missing current passcode');\n  }\n\n  const [sessionEncrypted, globalEncrypted] = await Promise.all([\n    load('sessionEncrypted'),\n    load('globalEncrypted'),\n  ]);\n\n  if (!sessionEncrypted || !globalEncrypted) {\n    // eslint-disable-next-line no-console\n    console.error('[api/passcode] Missing required stored fields');\n    throw new Error('[api/passcode] Missing required stored fields');\n  }\n\n  try {\n    const [sessionJson, globalJson] = await Promise.all([\n      aesDecrypt(sessionEncrypted, currentPasscodeHash),\n      aesDecrypt(globalEncrypted, currentPasscodeHash),\n    ]);\n\n    return { sessionJson, globalJson };\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.error('[api/passcode] Error decrypting session', err);\n    throw err;\n  }\n}\n\nexport async function decryptSession(passcode: string) {\n  const passcodeHash = await sha256(passcode);\n\n  const [sessionEncrypted, globalEncrypted] = await Promise.all([\n    load('sessionEncrypted'),\n    load('globalEncrypted'),\n  ]);\n\n  if (!sessionEncrypted || !globalEncrypted) {\n    // eslint-disable-next-line no-console\n    console.error('[api/passcode] Missing required stored fields');\n    throw new UnrecoverablePasscodeError('[api/passcode] Missing required stored fields');\n  }\n\n  try {\n    const [sessionJson, globalJson] = await Promise.all([\n      aesDecrypt(sessionEncrypted, passcodeHash),\n      aesDecrypt(globalEncrypted, passcodeHash),\n    ]);\n\n    currentPasscodeHash = passcodeHash;\n\n    return { sessionJson, globalJson };\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.error('[api/passcode] Error decrypting session', err);\n    throw err;\n  }\n}\n\nexport function forgetPasscode() {\n  currentPasscodeHash = undefined;\n}\n\nexport function clearEncryptedSession() {\n  forgetPasscode();\n  PASSCODE_IDB_STORE.clear();\n  return cacheApi.clear(LEGACY_PASSCODE_CACHE_NAME);\n}\n\nfunction sha256(plaintext: string) {\n  return crypto.subtle.digest('SHA-256', new TextEncoder().encode(`${plaintext}${SALT}`));\n}\n\nfunction store(key: string, value: ArrayBuffer) {\n  const asArray = Array.from(new Uint8Array(value));\n  return PASSCODE_IDB_STORE.set(key, asArray);\n}\n\nexport function hasEncryptedSession() {\n  return PASSCODE_IDB_STORE.get('sessionEncrypted');\n}\n\nasync function load(key: string) {\n  const cached = await PASSCODE_IDB_STORE.get<number[]>(key);\n  if (cached) {\n    const asArrayBuffer = new Uint8Array(cached).buffer;\n    return asArrayBuffer;\n  }\n  // Fallback for old data\n  return cacheApi.fetch(LEGACY_PASSCODE_CACHE_NAME, key, cacheApi.Type.ArrayBuffer);\n}\n\nasync function aesEncrypt(plaintext: string, pwHash: ArrayBuffer) {\n  const iv = crypto.getRandomValues(new Uint8Array(IV_LENGTH));\n  const alg = { name: 'AES-GCM', iv };\n  const key = await crypto.subtle.importKey('raw', pwHash, alg, false, ['encrypt']);\n  const ptUint8 = new TextEncoder().encode(plaintext);\n  const ctBuffer = await crypto.subtle.encrypt(alg, key, ptUint8);\n  const ct = new Uint8Array(ctBuffer);\n  const result = new Uint8Array(IV_LENGTH + ct.length);\n  result.set(iv, 0);\n  result.set(ct, IV_LENGTH);\n  return result.buffer;\n}\n\nasync function aesDecrypt(data: ArrayBuffer, pwHash: ArrayBuffer) {\n  const dataArray = new Uint8Array(data);\n  const iv = dataArray.slice(0, IV_LENGTH);\n  const alg = { name: 'AES-GCM', iv };\n  const key = await crypto.subtle.importKey('raw', pwHash, alg, false, ['decrypt']);\n  const ct = dataArray.slice(IV_LENGTH);\n  const plainBuffer = await crypto.subtle.decrypt(alg, key, ct);\n\n  return new TextDecoder().decode(plainBuffer);\n}\n","import type { ThemeKey } from '../types';\n\nimport { requestMutation } from '../lib/fasterdom/fasterdom';\nimport themeColors from '../styles/themes.json';\nimport { animate } from './animation';\nimport { lerp } from './math';\n\ntype RGBAColor = {\n  r: number;\n  g: number;\n  b: number;\n  a?: number;\n};\n\nlet isInitialized = false;\n\nconst DECIMAL_PLACES = 3;\nconst HEX_COLOR_REGEX = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})?$/i;\nconst DURATION_MS = 200;\nconst ENABLE_ANIMATION_DELAY_MS = 500;\nconst RGB_VARIABLES = new Set([\n  '--color-text',\n  '--color-primary-shade',\n  '--color-text-secondary',\n  '--color-accent-own',\n]);\n\nconst DISABLE_ANIMATION_CSS = `\n.no-animations #root *,\n.no-animations #root *::before,\n.no-animations #root *::after {\n  transition: none !important;\n}`;\n\nconst colors = (Object.keys(themeColors) as Array<keyof typeof themeColors>).map((property) => ({\n  property,\n  colors: [hexToRgb(themeColors[property][0]), hexToRgb(themeColors[property][1])],\n}));\n\nconst injectCss = (css: string) => {\n  const style = document.createElement('style');\n  style.textContent = css;\n  document.head.appendChild(style);\n  return () => {\n    document.head.removeChild(style);\n  };\n};\n\nconst switchTheme = (theme: ThemeKey, withAnimation: boolean) => {\n  const themeClassName = `theme-${theme}`;\n  if (document.documentElement.classList.contains(themeClassName)) {\n    return;\n  }\n  const isDarkTheme = theme === 'dark';\n  const shouldAnimate = isInitialized && withAnimation;\n  const startIndex = isDarkTheme ? 0 : 1;\n  const endIndex = isDarkTheme ? 1 : 0;\n  const startAt = Date.now();\n  const themeColorTag = document.querySelector('meta[name=\"theme-color\"]');\n\n  requestMutation(() => {\n    document.documentElement.classList.remove(`theme-${isDarkTheme ? 'light' : 'dark'}`);\n    let uninjectCss: (() => void) | undefined;\n    if (isInitialized) {\n      uninjectCss = injectCss(DISABLE_ANIMATION_CSS);\n      document.documentElement.classList.add('no-animations');\n    }\n    document.documentElement.classList.add(themeClassName);\n    if (themeColorTag) {\n      themeColorTag.setAttribute('content', isDarkTheme ? '#212121' : '#fff');\n    }\n\n    setTimeout(() => {\n      requestMutation(() => {\n        uninjectCss?.();\n        document.documentElement.classList.remove('no-animations');\n      });\n    }, ENABLE_ANIMATION_DELAY_MS);\n\n    isInitialized = true;\n\n    if (shouldAnimate) {\n      animate(() => {\n        const t = Math.min((Date.now() - startAt) / DURATION_MS, 1);\n\n        applyColorAnimationStep(startIndex, endIndex, transition(t));\n\n        return t < 1;\n      }, requestMutation);\n    } else {\n      applyColorAnimationStep(startIndex, endIndex);\n    }\n  });\n};\n\nfunction transition(t: number) {\n  return 1 - ((1 - t) ** 3.5);\n}\n\nexport function hexToRgb(hex: string): RGBAColor {\n  const result = HEX_COLOR_REGEX.exec(hex)!;\n\n  return {\n    r: parseInt(result[1], 16),\n    g: parseInt(result[2], 16),\n    b: parseInt(result[3], 16),\n    a: result[4] !== undefined ? parseInt(result[4], 16) : undefined,\n  };\n}\n\nexport function lerpRgb(start: RGBAColor, end: RGBAColor, interpolationRatio: number): RGBAColor {\n  const r = Math.round(lerp(start.r, end.r, interpolationRatio));\n  const g = Math.round(lerp(start.g, end.g, interpolationRatio));\n  const b = Math.round(lerp(start.b, end.b, interpolationRatio));\n  const a = start.a !== undefined\n    ? Math.round(lerp(start.a, end.a!, interpolationRatio))\n    : undefined;\n\n  return {\n    r, g, b, a,\n  };\n}\n\nfunction applyColorAnimationStep(startIndex: number, endIndex: number, interpolationRatio: number = 1) {\n  colors.forEach(({ property, colors: propertyColors }) => {\n    const {\n      r, g, b, a,\n    } = lerpRgb(propertyColors[startIndex], propertyColors[endIndex], interpolationRatio);\n\n    const roundedA = a !== undefined ? Math.round((a / 255) * 10 ** DECIMAL_PLACES) / 10 ** DECIMAL_PLACES : undefined;\n\n    document.documentElement.style.setProperty(property, `rgb(${r},${g},${b}${roundedA ? `,${roundedA}` : ''})`);\n\n    if (RGB_VARIABLES.has(property)) {\n      document.documentElement.style.setProperty(`${property}-rgb`, `${r},${g},${b}`);\n    }\n  });\n}\n\nexport default switchTheme;\n","import type { ElementRef } from '../lib/teact/teact';\nimport { useLayoutEffect } from '../lib/teact/teact';\nimport { addExtraClass, removeExtraClass, setExtraStyles } from '../lib/teact/teact-dom';\n\nimport type { IAnchorPosition } from '../types';\n\nimport { requestForcedReflow } from '../lib/fasterdom/fasterdom';\nimport { useStateRef } from './useStateRef';\n\ninterface StaticPositionOptions {\n  anchor?: IAnchorPosition;\n  positionX?: 'left' | 'right';\n  positionY?: 'top' | 'bottom';\n  transformOriginX?: number;\n  transformOriginY?: number;\n  style?: string;\n  bubbleStyle?: string;\n}\n\ninterface DynamicPositionOptions {\n  anchor: IAnchorPosition;\n  getTriggerElement: () => HTMLElement | undefined | null;\n  getRootElement: () => HTMLElement | undefined | null;\n  getMenuElement: () => HTMLElement | undefined | null;\n  getLayout?: () => Layout;\n  withMaxHeight?: boolean;\n}\n\nexport type MenuPositionOptions =\n  StaticPositionOptions\n  | DynamicPositionOptions;\n\nexport interface Layout {\n  extraPaddingX?: number;\n  extraTopPadding?: number;\n  extraMarginTop?: number;\n  menuElMinWidth?: number;\n  deltaX?: number;\n  topShiftY?: number;\n  shouldAvoidNegativePosition?: boolean;\n  withPortal?: boolean;\n  isDense?: boolean; //  Allows you to place the menu as close to the edges of the area as possible\n}\n\nconst MENU_POSITION_VISUAL_COMFORT_SPACE_PX = 16;\nconst MENU_POSITION_BOTTOM_MARGIN = 12;\nconst EMPTY_RECT = {\n  width: 0, left: 0, height: 0, top: 0,\n};\n\nexport default function useMenuPosition(\n  isOpen: boolean,\n  containerRef: ElementRef<HTMLDivElement>,\n  bubbleRef: ElementRef<HTMLDivElement>,\n  options: MenuPositionOptions,\n) {\n  const optionsRef = useStateRef(options);\n\n  useLayoutEffect(() => {\n    if (!isOpen) return;\n\n    const options2 = optionsRef.current;\n\n    if (!('getTriggerElement' in options2)) {\n      applyStaticOptions(containerRef, bubbleRef, options2);\n    } else {\n      requestForcedReflow(() => {\n        const staticOptions = processDynamically(containerRef, bubbleRef, options2);\n\n        return () => {\n          applyStaticOptions(containerRef, bubbleRef, staticOptions);\n        };\n      });\n    }\n  }, [isOpen, containerRef, bubbleRef, optionsRef]);\n}\n\nfunction applyStaticOptions(\n  containerRef: ElementRef<HTMLDivElement>,\n  bubbleRef: ElementRef<HTMLDivElement>,\n  {\n    positionX = 'left',\n    positionY = 'top',\n    transformOriginX,\n    transformOriginY,\n    style,\n    bubbleStyle,\n  }: StaticPositionOptions,\n) {\n  const containerEl = containerRef.current!;\n  const bubbleEl = bubbleRef.current!;\n\n  if (style) {\n    containerEl.style.cssText = style;\n  }\n\n  if (bubbleStyle) {\n    bubbleEl.style.cssText = bubbleStyle;\n  }\n\n  if (positionX) {\n    removeExtraClass(bubbleEl, positionX === 'left' ? 'right' : 'left');\n    addExtraClass(bubbleEl, positionX);\n  }\n\n  if (positionY) {\n    removeExtraClass(bubbleEl, positionY === 'top' ? 'bottom' : 'top');\n    addExtraClass(bubbleEl, positionY);\n  }\n\n  setExtraStyles(bubbleEl, {\n    transformOrigin: [\n      transformOriginX ? `${transformOriginX}px` : positionX,\n      transformOriginY ? `${transformOriginY}px` : positionY,\n    ].join(' '),\n  });\n}\n\nfunction processDynamically(\n  containerRef: ElementRef<HTMLDivElement>,\n  bubbleRef: ElementRef<HTMLDivElement>,\n  {\n    anchor,\n    getRootElement,\n    getMenuElement,\n    getTriggerElement,\n    getLayout,\n    withMaxHeight,\n  }: DynamicPositionOptions,\n) {\n  const triggerEl = getTriggerElement()!;\n\n  let { x, y } = anchor;\n  const anchorX = x;\n  const anchorY = y;\n\n  const menuEl = getMenuElement();\n  const rootEl = getRootElement();\n\n  const {\n    extraPaddingX = 0,\n    extraTopPadding = 0,\n    extraMarginTop = 0,\n    topShiftY = 0,\n    menuElMinWidth = 0,\n    deltaX = 0,\n    shouldAvoidNegativePosition = false,\n    withPortal = false,\n    isDense = false,\n  } = getLayout?.() || {};\n\n  const marginTop = menuEl ? parseInt(getComputedStyle(menuEl).marginTop, 10) + extraMarginTop : undefined;\n  const { offsetWidth: menuElWidth, offsetHeight: menuElHeight } = menuEl || { offsetWidth: 0, offsetHeight: 0 };\n  const menuRect = menuEl ? {\n    width: Math.max(menuElWidth, menuElMinWidth),\n    height: menuElHeight + marginTop!,\n  } : EMPTY_RECT;\n\n  const rootRect = rootEl ? rootEl.getBoundingClientRect() : EMPTY_RECT;\n\n  let positionX: 'left' | 'right';\n  let positionY: 'top' | 'bottom';\n  if (isDense || (x + menuRect.width + extraPaddingX < rootRect.width + rootRect.left)) {\n    x += 3;\n    positionX = 'left';\n  } else if (x - menuRect.width - rootRect.left > 0) {\n    positionX = 'right';\n    x -= 3;\n  } else {\n    positionX = 'left';\n    x = 16;\n  }\n\n  x += deltaX;\n\n  const yWithTopShift = y + topShiftY;\n\n  if (isDense || (yWithTopShift + menuRect.height < rootRect.height + rootRect.top)) {\n    positionY = 'top';\n    y = yWithTopShift;\n  } else {\n    positionY = 'bottom';\n\n    if (y - menuRect.height < rootRect.top + extraTopPadding) {\n      y = rootRect.top + rootRect.height;\n    }\n  }\n\n  const triggerRect = triggerEl.getBoundingClientRect();\n\n  const addedYForPortalPositioning = (withPortal ? triggerRect.top : 0);\n  const addedXForPortalPositioning = (withPortal ? triggerRect.left : 0);\n\n  const leftWithPossibleNegative = Math.min(\n    x - triggerRect.left,\n    rootRect.width - menuRect.width - MENU_POSITION_VISUAL_COMFORT_SPACE_PX,\n  );\n  let left = (positionX === 'left'\n    ? (withPortal || shouldAvoidNegativePosition\n      ? Math.max(MENU_POSITION_VISUAL_COMFORT_SPACE_PX, leftWithPossibleNegative)\n      : leftWithPossibleNegative)\n    : (x - triggerRect.left)) + addedXForPortalPositioning;\n  let top = y - triggerRect.top + addedYForPortalPositioning;\n\n  if (isDense) {\n    left = Math.min(left, rootRect.width - menuRect.width - MENU_POSITION_VISUAL_COMFORT_SPACE_PX);\n    top = Math.min(top, rootRect.height - menuRect.height - MENU_POSITION_VISUAL_COMFORT_SPACE_PX);\n  }\n\n  // Avoid hiding external parts of menus on mobile devices behind the edges of the screen (ReactionSelector for example)\n  const addedXForMenuPositioning = menuElMinWidth ? Math.max(0, (menuElMinWidth - menuElWidth) / 2) : 0;\n  if (left - addedXForMenuPositioning < 0 && shouldAvoidNegativePosition) {\n    left = addedXForMenuPositioning + MENU_POSITION_VISUAL_COMFORT_SPACE_PX;\n  }\n\n  const offsetX = (anchorX + addedXForPortalPositioning - triggerRect.left) - left;\n  const offsetY = (anchorY + addedYForPortalPositioning - triggerRect.top) - top - (marginTop || 0);\n  const transformOriginX = positionX === 'left' ? offsetX : menuRect.width + offsetX;\n  const transformOriginY = positionY === 'bottom' ? menuRect.height + offsetY : offsetY;\n\n  const style = `left: ${left}px; top: ${top}px`;\n\n  let bubbleStyle;\n  if (withMaxHeight) {\n    const menuMaxHeight = rootRect.height - MENU_POSITION_BOTTOM_MARGIN - (marginTop || 0);\n    bubbleStyle = `max-height: ${menuMaxHeight}px;`;\n  }\n\n  return {\n    positionX,\n    positionY,\n    transformOriginX,\n    transformOriginY,\n    style,\n    bubbleStyle,\n  };\n}\n","import type {\n  ElementRef } from '../../lib/teact/teact';\nimport type React from '../../lib/teact/teact';\nimport {\n  beginHeavyAnimation,\n  type FC, memo, useEffect, useRef,\n} from '../../lib/teact/teact';\n\nimport type { MenuPositionOptions } from '../../hooks/useMenuPosition';\n\nimport { IS_BACKDROP_BLUR_SUPPORTED } from '../../util/browser/windowEnvironment';\nimport buildClassName from '../../util/buildClassName';\nimport captureEscKeyListener from '../../util/captureEscKeyListener';\nimport { preventMessageInputBlurWithBubbling } from '../middle/helpers/preventMessageInputBlur';\n\nimport useAppLayout from '../../hooks/useAppLayout';\nimport useEffectWithPrevDeps from '../../hooks/useEffectWithPrevDeps';\nimport useHistoryBack from '../../hooks/useHistoryBack';\nimport useKeyboardListNavigation from '../../hooks/useKeyboardListNavigation';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useMenuPosition from '../../hooks/useMenuPosition';\nimport useShowTransition from '../../hooks/useShowTransition';\nimport useVirtualBackdrop from '../../hooks/useVirtualBackdrop';\n\nimport Portal from './Portal';\n\nimport './Menu.scss';\n\nexport type { MenuPositionOptions } from '../../hooks/useMenuPosition';\n\ntype OwnProps =\n  {\n    ref?: ElementRef<HTMLDivElement>;\n    isOpen: boolean;\n    shouldCloseFast?: boolean;\n    id?: string;\n    className?: string;\n    bubbleClassName?: string;\n    ariaLabelledBy?: string;\n    autoClose?: boolean;\n    footer?: string;\n    noCloseOnBackdrop?: boolean;\n    backdropExcludedSelector?: string;\n    noCompact?: boolean;\n    onKeyDown?: (e: React.KeyboardEvent<any>) => void;\n    onCloseAnimationEnd?: () => void;\n    onClose: () => void;\n    onMouseEnter?: (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => void;\n    onMouseEnterBackdrop?: (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => void;\n    onMouseLeave?: (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => void;\n    withPortal?: boolean;\n    children?: React.ReactNode;\n  }\n  & MenuPositionOptions;\n\nconst ANIMATION_DURATION = 200;\n\nconst Menu: FC<OwnProps> = ({\n  ref: externalRef,\n  shouldCloseFast,\n  isOpen,\n  id,\n  className,\n  bubbleClassName,\n  ariaLabelledBy,\n  children,\n  autoClose = false,\n  footer,\n  noCloseOnBackdrop = false,\n  backdropExcludedSelector,\n  noCompact,\n  onCloseAnimationEnd,\n  onClose,\n  onMouseEnter,\n  onMouseLeave,\n  withPortal,\n  onMouseEnterBackdrop,\n  ...positionOptions\n}) => {\n  const { isTouchScreen } = useAppLayout();\n\n  const containerRef = useRef<HTMLDivElement>();\n\n  const { ref: bubbleRef } = useShowTransition({\n    isOpen,\n    ref: externalRef,\n    onCloseAnimationEnd,\n  });\n\n  useMenuPosition(isOpen, containerRef, bubbleRef, positionOptions);\n\n  useEffect(\n    () => (isOpen ? captureEscKeyListener(onClose) : undefined),\n    [isOpen, onClose],\n  );\n\n  useHistoryBack({\n    isActive: isOpen,\n    onBack: onClose,\n    shouldBeReplaced: true,\n  });\n\n  useEffectWithPrevDeps(([prevIsOpen]) => {\n    if (isOpen || (!isOpen && prevIsOpen === true)) {\n      beginHeavyAnimation(ANIMATION_DURATION);\n    }\n  }, [isOpen]);\n\n  const handleKeyDown = useKeyboardListNavigation(bubbleRef, isOpen, autoClose ? onClose : undefined, undefined, true);\n\n  useVirtualBackdrop(\n    isOpen,\n    containerRef,\n    noCloseOnBackdrop ? undefined : onClose,\n    undefined,\n    backdropExcludedSelector,\n  );\n\n  const bubbleFullClassName = buildClassName(\n    'bubble menu-container custom-scroll',\n    footer && 'with-footer',\n    bubbleClassName,\n    shouldCloseFast && 'close-fast',\n  );\n\n  const handleClick = useLastCallback((e: React.MouseEvent<HTMLDivElement>) => {\n    e.stopPropagation();\n    if (autoClose) {\n      onClose();\n    }\n  });\n\n  const menu = (\n    <div\n      ref={containerRef}\n      id={id}\n      className={buildClassName(\n        'Menu',\n        !noCompact && !isTouchScreen && 'compact',\n        !IS_BACKDROP_BLUR_SUPPORTED && 'no-blur',\n        withPortal && 'in-portal',\n        className,\n      )}\n      aria-labelledby={ariaLabelledBy}\n      role={ariaLabelledBy ? 'menu' : undefined}\n      onKeyDown={isOpen ? handleKeyDown : undefined}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={isOpen ? onMouseLeave : undefined}\n    >\n      {isOpen && (\n        // This only prevents click events triggering on underlying elements\n        <div\n          className=\"backdrop\"\n          onMouseDown={preventMessageInputBlurWithBubbling}\n          onMouseEnter={onMouseEnterBackdrop}\n        />\n      )}\n      <div\n        role=\"presentation\"\n        ref={bubbleRef}\n        className={bubbleFullClassName}\n        onClick={handleClick}\n      >\n        {children}\n        {footer && <div className=\"footer\">{footer}</div>}\n      </div>\n    </div>\n  );\n\n  if (withPortal) {\n    return <Portal>{menu}</Portal>;\n  }\n\n  return menu;\n};\n\nexport default memo(Menu);\n","import type React from '../lib/teact/teact';\nimport { useMemo, useState } from '../lib/teact/teact';\n\nimport { areDeepEqual } from '../util/areDeepEqual';\nimport { isSafariPatchInProgress } from '../util/patchSafariProgressiveAudio';\nimport { debounce } from '../util/schedulers';\nimport useLastCallback from './useLastCallback';\n\ntype BufferingEvent = (e: Event | React.SyntheticEvent<HTMLMediaElement>) => void;\n\nconst MIN_READY_STATE = 3;\n// Avoid flickering when re-mounting previously buffered video\nconst DEBOUNCE = 200;\nconst MIN_ALLOWED_MEDIA_DURATION = 0.1; // Some video emojis have weird duration of 0.04 causing extreme amount of events\n\n/**\n * Time range relative to the duration [0, 1]\n */\nexport type BufferedRange = { start: number; end: number };\n\nconst useBuffering = (noInitiallyBuffered = false, onTimeUpdate?: AnyToVoidFunction, onBroken?: AnyToVoidFunction) => {\n  const [isBuffered, setIsBuffered] = useState(!noInitiallyBuffered);\n  const [isReady, setIsReady] = useState(false);\n  const [bufferedProgress, setBufferedProgress] = useState(0);\n  const [bufferedRanges, setBufferedRanges] = useState<BufferedRange[]>([]);\n\n  const setIsBufferedDebounced = useMemo(() => {\n    return debounce(setIsBuffered, DEBOUNCE, false, true);\n  }, []);\n\n  const handleBuffering = useLastCallback<BufferingEvent>((e) => {\n    const media = e.currentTarget as HTMLMediaElement;\n\n    if (media.duration < MIN_ALLOWED_MEDIA_DURATION) {\n      onBroken?.();\n      return;\n    }\n\n    if (e.type === 'timeupdate') {\n      onTimeUpdate?.(e);\n    }\n\n    if (!isSafariPatchInProgress(media)) {\n      if (media.buffered.length) {\n        const ranges = getTimeRanges(media.buffered, media.duration);\n        const bufferedLength = ranges.reduce((acc, { start, end }) => acc + end - start, 0);\n        setBufferedProgress(bufferedLength / media.duration);\n        setBufferedRanges((currentRanges) => {\n          return areDeepEqual(currentRanges, ranges) ? currentRanges : ranges;\n        });\n      }\n\n      setIsBufferedDebounced(media.readyState >= MIN_READY_STATE || media.currentTime > 0);\n      setIsReady((current) => current || media.readyState > MIN_READY_STATE);\n    }\n  });\n\n  const bufferingHandlers = {\n    onPLay: handleBuffering,\n    onLoadedData: handleBuffering,\n    onPlaying: handleBuffering,\n    onLoadStart: handleBuffering, // Needed for Safari to start\n    onPause: handleBuffering, // Needed for Chrome when seeking\n    onTimeUpdate: handleBuffering, // Needed for audio buffering progress\n    onProgress: handleBuffering, // Needed for video buffering progress\n  };\n\n  return {\n    isReady,\n    isBuffered,\n    bufferedProgress,\n    bufferedRanges,\n    bufferingHandlers,\n    checkBuffering(element: HTMLMediaElement) {\n      setIsBufferedDebounced(element.readyState >= MIN_READY_STATE);\n    },\n  };\n};\n\nfunction getTimeRanges(ranges: TimeRanges, duration: number) {\n  const result: BufferedRange[] = [];\n  for (let i = 0; i < ranges.length; i++) {\n    result.push({\n      start: ranges.start(i) / duration,\n      end: ranges.end(i) / duration,\n    });\n  }\n  return result;\n}\n\nexport default useBuffering;\n","import { resolveEventType } from '../lib/teact/dom-events';\nimport type { ElementRef } from '../lib/teact/teact';\nimport { onFullyIdle, useLayoutEffect } from '../lib/teact/teact';\n\nimport unloadVideo from '../util/browser/unloadVideo';\nimport { useStateRef } from './useStateRef';\n\n// Fix memory leak when unmounting video element\nexport default function useVideoCleanup(\n  videoRef: ElementRef<HTMLVideoElement>, handlers?: Record<string, AnyFunction>,\n) {\n  const handlersRef = useStateRef(handlers);\n\n  useLayoutEffect(() => {\n    const videoEl = videoRef.current;\n    if (!videoEl) return undefined;\n\n    return () => {\n      // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n      const handlers2 = handlersRef.current;\n      if (handlers2) {\n        Object.entries(handlers2).forEach(([key, value]) => {\n          videoEl.removeEventListener(resolveEventType(key, videoEl), value, false);\n        });\n      }\n\n      // It may be slow (specifically on iOS), so we postpone it after unmounting\n      onFullyIdle(() => {\n        unloadVideo(videoEl);\n      });\n    };\n  }, [handlersRef, videoRef]);\n}\n","import { useRef } from '../lib/teact/teact';\n\n/**\n * @deprecated\n */\nfunction usePreviousDeprecated<T>(next: T): T | undefined;\nfunction usePreviousDeprecated<T>(next: T, shouldSkipUndefined: true): Exclude<T, undefined> | undefined;\n\nfunction usePreviousDeprecated<T>(next: T, shouldSkipUndefined?: boolean): Exclude<T, undefined> | undefined;\nfunction usePreviousDeprecated<T>(next: T, shouldSkipUndefined?: boolean) {\n  const ref = useRef<T>();\n  const { current } = ref;\n  if (!shouldSkipUndefined || next !== undefined) {\n    ref.current = next;\n  }\n\n  return current;\n}\n\nexport default usePreviousDeprecated;\n","import type { ApiPeerColors } from '../api/types';\n\nimport { PEER_COLOR_BG_ACTIVE_OPACITY, PEER_COLOR_BG_OPACITY, PEER_COLOR_GRADIENT_STEP } from '../config';\nimport { fastRaf } from './schedulers';\n\nconst GENERAL_VARIABLES = new Map<string, string>();\nconst LIGHT_VARIABLES = new Map<string, string>();\nconst DARK_VARIABLES = new Map<string, string>();\n\nconst style = document.createElement('style');\ndocument.head.appendChild(style);\n\nexport function setVariable(name: string, generalValue: string): void;\nexport function setVariable(name: string, lightValue: string, darkValue?: string): void;\nexport function setVariable(name: string, lightValueOrGeneral: string, darkValue?: string) {\n  if (!darkValue) {\n    GENERAL_VARIABLES.set(name, lightValueOrGeneral);\n    LIGHT_VARIABLES.delete(name);\n    DARK_VARIABLES.delete(name);\n  } else {\n    GENERAL_VARIABLES.delete(name);\n    LIGHT_VARIABLES.set(name, lightValueOrGeneral);\n    DARK_VARIABLES.set(name, darkValue);\n  }\n\n  scheduleVariableUpdate();\n}\n\nlet isUpdateScheduled = false;\nfunction scheduleVariableUpdate() {\n  if (isUpdateScheduled) return;\n  isUpdateScheduled = true;\n  fastRaf(updateVariables);\n}\n\nfunction updateVariables() {\n  const generalVariables = buildVariables(GENERAL_VARIABLES);\n  const lightVariables = buildVariables(LIGHT_VARIABLES);\n  const darkVariables = buildVariables(DARK_VARIABLES);\n\n  style.textContent = `\n    html {\n      ${generalVariables}\n    }\n\n    html.theme-light {\n      ${lightVariables}\n    }\n\n    html.theme-dark {\n      ${darkVariables}\n    }\n  `;\n}\n\nfunction buildVariables(map: Map<string, string>) {\n  return Array.from(map.entries()).map(([name, value]) => `--${name}: ${value};`).join(' ');\n}\n\nexport function updatePeerColors(\n  peerColors: ApiPeerColors['general'],\n) {\n  setPeerColor('0', ['#D45246']);\n  setPeerColor('1', ['#F68136']);\n  setPeerColor('2', ['#6C61DF']);\n  setPeerColor('3', ['#46BA43']);\n  setPeerColor('4', ['#5CAFFA']);\n  setPeerColor('5', ['#408ACF']);\n  setPeerColor('6', ['#D95574']);\n\n  Object.entries(peerColors).forEach(([key, value]) => {\n    if (!value.colors) return;\n    setPeerColor(key, value.colors, value.darkColors);\n  });\n}\n\nfunction setPeerColor(n: string, colors: string[], darkColors?: string[]) {\n  const mainLightColor = colors[0];\n  const mainDarkColor = darkColors?.[0];\n  if (!mainLightColor) return;\n\n  const lightBgColor = `${mainLightColor}${PEER_COLOR_BG_OPACITY}`;\n  const darkBgColor = mainDarkColor ? `${mainDarkColor}${PEER_COLOR_BG_OPACITY}` : undefined;\n\n  const lightBgActiveColor = `${mainLightColor}${PEER_COLOR_BG_ACTIVE_OPACITY}`;\n  const darkBgActiveColor = mainDarkColor ? `${mainDarkColor}${PEER_COLOR_BG_ACTIVE_OPACITY}` : undefined;\n\n  setVariable(`color-peer-${n}`, mainLightColor, mainDarkColor);\n  setVariable(`color-peer-bg-${n}`, lightBgColor, darkBgColor);\n  setVariable(`color-peer-bg-active-${n}`, lightBgActiveColor, darkBgActiveColor);\n\n  if (colors.length > 1) {\n    const lightGradientColors = colors.map((color, i) => (\n      `${color} ${i * PEER_COLOR_GRADIENT_STEP}px, ${color} ${(i + 1) * PEER_COLOR_GRADIENT_STEP}px`\n    ));\n    const darkGradientColors = darkColors?.map((color, i) => (\n      `${color} ${i * PEER_COLOR_GRADIENT_STEP}px, ${color} ${(i + 1) * PEER_COLOR_GRADIENT_STEP}px`\n    ));\n\n    const lightGradient = `repeating-linear-gradient(-45deg, ${lightGradientColors.join(', ')})`;\n    const darkGradient = darkGradientColors\n      ? `repeating-linear-gradient(-45deg, ${darkGradientColors.join(', ')})`\n      : undefined;\n    setVariable(`color-peer-gradient-${n}`, lightGradient, darkGradient);\n  }\n}\n","import { ACCOUNT_SLOT } from './multiaccount';\n\nconst cacheApi = self.caches;\n\nconst SUFFIX = ACCOUNT_SLOT ? `_${ACCOUNT_SLOT}` : '';\n\nlet isSupported: boolean | undefined;\n\nexport async function isCacheApiSupported() {\n  if (!cacheApi) return false;\n\n  isSupported = isSupported ?? await cacheApi.has('test').then(() => true).catch(() => false);\n  return isSupported;\n}\n\nexport enum Type {\n  Text,\n  Blob,\n  Json,\n  ArrayBuffer,\n}\n\nexport async function fetch(\n  cacheName: string, key: string, type: Type, isHtmlAllowed = false,\n) {\n  if (!cacheApi) {\n    return undefined;\n  }\n\n  try {\n    // To avoid the error \"Request scheme 'webdocument' is unsupported\"\n    const request = new Request(key.replace(/:/g, '_'));\n    const cache = await cacheApi.open(`${cacheName}${SUFFIX}`);\n    const response = await cache.match(request);\n    if (!response) {\n      return undefined;\n    }\n\n    const contentType = response.headers.get('Content-Type');\n\n    switch (type) {\n      case Type.Text:\n        return await response.text();\n      case Type.Blob: {\n        // Ignore deprecated data-uri avatars\n        if (key.startsWith('avatar') && contentType && contentType.startsWith('text')) {\n          return undefined;\n        }\n\n        const blob = await response.blob();\n        const shouldRecreate = !blob.type || (!isHtmlAllowed && blob.type.includes('html'));\n        // iOS Safari fails to preserve `type` in cache\n        let resolvedType = blob.type || contentType;\n\n        if (!(shouldRecreate && resolvedType)) {\n          return blob;\n        }\n\n        // Prevent HTML-in-video attacks (for files that were cached before fix)\n        if (!isHtmlAllowed) {\n          resolvedType = resolvedType.replace(/html/gi, '');\n        }\n\n        return new Blob([blob], { type: resolvedType });\n      }\n      case Type.Json:\n        return await response.json();\n      case Type.ArrayBuffer:\n        return await response.arrayBuffer();\n      default:\n        return undefined;\n    }\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.warn(err);\n    return undefined;\n  }\n}\n\nexport async function save(cacheName: string, key: string, data: AnyLiteral | Blob | ArrayBuffer | string) {\n  if (!cacheApi) {\n    return false;\n  }\n\n  try {\n    const cacheData = typeof data === 'string' || data instanceof Blob || data instanceof ArrayBuffer\n      ? data\n      : JSON.stringify(data);\n    // To avoid the error \"Request scheme 'webdocument' is unsupported\"\n    const request = new Request(key.replace(/:/g, '_'));\n    const response = new Response(cacheData);\n    const cache = await cacheApi.open(`${cacheName}${SUFFIX}`);\n    await cache.put(request, response);\n\n    return true;\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.warn(err);\n    return false;\n  }\n}\n\nexport async function remove(cacheName: string, key: string) {\n  try {\n    if (!cacheApi) {\n      return undefined;\n    }\n\n    const cache = await cacheApi.open(`${cacheName}${SUFFIX}`);\n    return await cache.delete(key);\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.warn(err);\n    return undefined;\n  }\n}\n\nexport async function clear(cacheName: string) {\n  try {\n    if (!cacheApi) {\n      return undefined;\n    }\n\n    return await cacheApi.delete(`${cacheName}${SUFFIX}`);\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.warn(err);\n    return undefined;\n  }\n}\n","import {\n  memo, useMemo, useRef,\n} from '../../lib/teact/teact';\n\nimport type { ApiFormattedText, ApiMessage, ApiStory } from '../../api/types';\nimport type { ObserveFn } from '../../hooks/useIntersectionObserver';\nimport type { ThreadId } from '../../types';\nimport { ApiMessageEntityTypes } from '../../api/types';\n\nimport { extractMessageText, stripCustomEmoji } from '../../global/helpers';\nimport trimText from '../../util/trimText';\nimport { insertTextEntity, renderTextWithEntities } from './helpers/renderTextWithEntities';\n\nimport useLang from '../../hooks/useLang';\nimport useSyncEffect from '../../hooks/useSyncEffect';\nimport useUniqueId from '../../hooks/useUniqueId';\n\ninterface OwnProps {\n  messageOrStory: ApiMessage | ApiStory;\n  threadId?: ThreadId;\n  translatedText?: ApiFormattedText;\n  isForAnimation?: boolean;\n  emojiSize?: number;\n  highlight?: string;\n  asPreview?: boolean;\n  truncateLength?: number;\n  isProtected?: boolean;\n  observeIntersectionForLoading?: ObserveFn;\n  observeIntersectionForPlaying?: ObserveFn;\n  withTranslucentThumbs?: boolean;\n  shouldRenderAsHtml?: boolean;\n  inChatList?: boolean;\n  forcePlayback?: boolean;\n  focusedQuote?: string;\n  focusedQuoteOffset?: number;\n  isInSelectMode?: boolean;\n  canBeEmpty?: boolean;\n  maxTimestamp?: number;\n}\n\nconst MIN_CUSTOM_EMOJIS_FOR_SHARED_CANVAS = 3;\n\nfunction MessageText({\n  messageOrStory,\n  translatedText,\n  isForAnimation,\n  emojiSize,\n  highlight,\n  asPreview,\n  truncateLength,\n  isProtected,\n  observeIntersectionForLoading,\n  observeIntersectionForPlaying,\n  withTranslucentThumbs,\n  shouldRenderAsHtml,\n  inChatList,\n  forcePlayback,\n  focusedQuote,\n  focusedQuoteOffset,\n  isInSelectMode,\n  canBeEmpty,\n  maxTimestamp,\n  threadId,\n}: OwnProps) {\n  const sharedCanvasRef = useRef<HTMLCanvasElement>();\n  const sharedCanvasHqRef = useRef<HTMLCanvasElement>();\n\n  const textCacheBusterRef = useRef(0);\n\n  const lang = useLang();\n\n  const formattedText = translatedText || extractMessageText(messageOrStory, inChatList);\n  const adaptedFormattedText = isForAnimation && formattedText ? stripCustomEmoji(formattedText) : formattedText;\n  const { text, entities } = adaptedFormattedText || {};\n\n  const entitiesWithFocusedQuote = useMemo(() => {\n    if (!text || !focusedQuote) return entities;\n\n    const offsetIndex = text.indexOf(focusedQuote, focusedQuoteOffset);\n    const index = offsetIndex >= 0 ? offsetIndex : text.indexOf(focusedQuote); // Fallback to first occurrence\n    const lendth = focusedQuote.length;\n    if (index >= 0) {\n      return insertTextEntity(entities || [], {\n        offset: index,\n        length: lendth,\n        type: ApiMessageEntityTypes.QuoteFocus,\n      });\n    }\n\n    return entities;\n  }, [text, entities, focusedQuote, focusedQuoteOffset]);\n\n  const containerId = useUniqueId();\n\n  useSyncEffect(() => {\n    textCacheBusterRef.current += 1;\n  }, [text, entitiesWithFocusedQuote]);\n\n  const withSharedCanvas = useMemo(() => {\n    const hasSpoilers = entitiesWithFocusedQuote?.some((e) => e.type === ApiMessageEntityTypes.Spoiler);\n    if (hasSpoilers) {\n      return false;\n    }\n\n    const customEmojisCount = entitiesWithFocusedQuote\n      ?.filter((e) => e.type === ApiMessageEntityTypes.CustomEmoji).length || 0;\n    return customEmojisCount >= MIN_CUSTOM_EMOJIS_FOR_SHARED_CANVAS;\n  }, [entitiesWithFocusedQuote]) || 0;\n\n  if (!text && !canBeEmpty) {\n    return <span className=\"content-unsupported\">{lang('MessageUnsupported')}</span>;\n  }\n\n  return (\n    <>\n      {[\n        withSharedCanvas && <canvas ref={sharedCanvasRef} className=\"shared-canvas\" />,\n        withSharedCanvas && <canvas ref={sharedCanvasHqRef} className=\"shared-canvas\" />,\n        renderTextWithEntities({\n          text: trimText(text!, truncateLength),\n          entities: entitiesWithFocusedQuote,\n          highlight,\n          emojiSize,\n          shouldRenderAsHtml,\n          containerId,\n          asPreview,\n          isProtected,\n          observeIntersectionForLoading,\n          observeIntersectionForPlaying,\n          withTranslucentThumbs,\n          sharedCanvasRef,\n          sharedCanvasHqRef,\n          cacheBuster: textCacheBusterRef.current.toString(),\n          forcePlayback,\n          isInSelectMode,\n          maxTimestamp,\n          chatId: 'chatId' in messageOrStory ? messageOrStory.chatId : undefined,\n          messageId: messageOrStory.id,\n          threadId,\n        }),\n      ].flat().filter(Boolean)}\n    </>\n  );\n}\n\nexport default memo(MessageText);\n","// https://gist.github.com/paulirish/5d52fb081b3570c81e3a\n\nexport default {\n  Element: {\n    props: [\n      'clientLeft', 'clientTop', 'clientWidth', 'clientHeight',\n      'scrollWidth', 'scrollHeight', 'scrollLeft', 'scrollTop',\n    ] as const,\n    methods: [\n      'getClientRects', 'getBoundingClientRect',\n      'scrollBy', 'scrollTo', 'scrollIntoView', 'scrollIntoViewIfNeeded',\n    ] as const,\n  },\n  HTMLElement: {\n    props: [\n      'offsetLeft', 'offsetTop', 'offsetWidth', 'offsetHeight', 'offsetParent',\n      'innerText',\n    ] as const,\n    methods: ['focus'] as const,\n  },\n  window: {\n    props: [\n      'scrollX', 'scrollY',\n      'innerHeight', 'innerWidth',\n    ] as const,\n    methods: ['getComputedStyle'] as const,\n  },\n  VisualViewport: {\n    props: [\n      'height', 'width', 'offsetTop', 'offsetLeft',\n    ] as const,\n  },\n  Document: {\n    props: ['scrollingElement'] as const,\n    methods: ['elementFromPoint'] as const,\n  },\n  HTMLInputElement: {\n    methods: ['select'] as const,\n  },\n  MouseEvent: {\n    props: ['layerX', 'layerY', 'offsetX', 'offsetY'] as const,\n  },\n  Range: {\n    methods: ['getClientRects', 'getBoundingClientRect'] as const,\n  },\n};\n","import LAYOUT_CAUSES from './layoutCauses';\n\ntype Entities = keyof typeof LAYOUT_CAUSES;\ntype Phase =\n  'measure'\n  | 'mutate';\ntype ErrorHandler = (error: Error) => any;\n\n// eslint-disable-next-line no-console\nconst DEFAULT_ERROR_HANDLER = console.error;\n\nlet onError: ErrorHandler = DEFAULT_ERROR_HANDLER;\n\nconst nativeMethods = new Map<string, AnyFunction>();\n\nlet phase: Phase = 'measure';\nlet isStrict = false;\nlet observer: MutationObserver | undefined;\n\nexport function setPhase(newPhase: Phase) {\n  phase = newPhase;\n}\n\nexport function getPhase() {\n  return phase;\n}\n\nexport function enableStrict() {\n  if (isStrict) return;\n\n  isStrict = true;\n  setupLayoutDetectors();\n  setupMutationObserver();\n}\n\nexport function disableStrict() {\n  if (!isStrict) return;\n\n  clearMutationObserver();\n  clearLayoutDetectors();\n  isStrict = false;\n}\n\nexport function forceMeasure(cb: () => any) {\n  if (phase !== 'mutate') {\n    throw new Error('The current phase is \\'measure\\'');\n  }\n\n  phase = 'measure';\n  const result = cb();\n  phase = 'mutate';\n\n  return result;\n}\n\nconst forcedMutationAllowedFor = new Set<Node>();\n\nexport function forceMutation(cb: () => any, nodes: Node | Node[]) {\n  if (phase !== 'measure') {\n    throw new Error('The current phase is \\'mutate\\'');\n  }\n\n  if (isStrict) {\n    if (Array.isArray(nodes)) {\n      nodes.forEach((node) => {\n        forcedMutationAllowedFor.add(node);\n      });\n    } else {\n      forcedMutationAllowedFor.add(nodes);\n    }\n  }\n\n  return cb();\n}\n\nexport function suppressStrict(cb: () => any) {\n  if (!isStrict) {\n    return cb();\n  }\n\n  disableStrict();\n  const result = cb();\n  enableStrict();\n  return result;\n}\n\nexport function setHandler(handler?: ErrorHandler) {\n  onError = handler || DEFAULT_ERROR_HANDLER;\n}\n\nfunction setupLayoutDetectors() {\n  Object.entries(LAYOUT_CAUSES).forEach(([name, causes]) => {\n    const entity = window[name as Entities];\n    if (!entity) return;\n    const prototype = typeof entity === 'object' ? entity : entity.prototype;\n\n    if ('props' in causes) {\n      causes.props.forEach((prop) => {\n        const nativeGetter = Object.getOwnPropertyDescriptor(prototype, prop)?.get;\n        if (!nativeGetter) {\n          return;\n        }\n\n        nativeMethods.set(`${name}#${prop}`, nativeGetter);\n\n        Object.defineProperty(prototype, prop, {\n          get() {\n            onMeasure(prop);\n\n            return nativeGetter.call(this);\n          },\n        });\n      });\n    }\n\n    if ('methods' in causes) {\n      causes.methods.forEach((method) => {\n        const nativeMethod = (prototype as any)[method]!;\n        nativeMethods.set(`${name}#${method}`, nativeMethod);\n\n        (prototype as any)[method] = function (...args: any[]) {\n          onMeasure(method);\n\n          return nativeMethod.apply(this, args);\n        };\n      });\n    }\n  });\n}\n\nfunction clearLayoutDetectors() {\n  Object.entries(LAYOUT_CAUSES).forEach(([name, causes]) => {\n    const entity = window[name as Entities];\n    if (!entity) return;\n    const prototype = typeof entity === 'object' ? entity : entity.prototype;\n\n    if ('props' in causes) {\n      causes.props.forEach((prop) => {\n        const nativeGetter = nativeMethods.get(`${name}#${prop}`);\n        if (!nativeGetter) {\n          return;\n        }\n\n        Object.defineProperty(prototype, prop, { get: nativeGetter });\n      });\n    }\n\n    if ('methods' in causes) {\n      causes.methods.forEach((method) => {\n        (prototype as any)[method] = nativeMethods.get(`${name}#${method}`)!;\n      });\n    }\n  });\n\n  nativeMethods.clear();\n}\n\nfunction setupMutationObserver() {\n  observer = new MutationObserver((mutations) => {\n    if (phase !== 'mutate') {\n      mutations.forEach(({ target, type, attributeName }) => {\n        if (!document.contains(target)) {\n          return;\n        }\n\n        if (forcedMutationAllowedFor.has(target)) {\n          return;\n        }\n\n        if (type === 'childList' && target instanceof HTMLElement && target.contentEditable) {\n          return;\n        }\n\n        if (attributeName?.startsWith('data-')) {\n          return;\n        }\n\n        onError(new Error(`Unexpected mutation detected: \\`${type === 'attributes' ? attributeName : type}\\``));\n      });\n    }\n\n    forcedMutationAllowedFor.clear();\n  });\n\n  observer.observe(document.body, {\n    childList: true,\n    attributes: true,\n    subtree: true,\n    characterData: false,\n  });\n}\n\nfunction clearMutationObserver() {\n  observer?.disconnect();\n  observer = undefined;\n}\n\nfunction onMeasure(propName: string) {\n  if (phase !== 'measure') {\n    onError(new Error(`Unexpected measurement detected: \\`${propName}\\``));\n  }\n}\n","import type {\n  ApiDimensions, ApiMediaExtendedPreview, ApiPhoto, ApiSticker, ApiVideo,\n} from '../../../api/types';\n\nimport { STICKER_SIZE_INLINE_DESKTOP_FACTOR, STICKER_SIZE_INLINE_MOBILE_FACTOR } from '../../../config';\nimport { getPhotoInlineDimensions, getVideoDimensions } from '../../../global/helpers';\nimport { IS_TOUCH_ENV } from '../../../util/browser/windowEnvironment';\nimport windowSize from '../../../util/windowSize';\n\nexport const MEDIA_VIEWER_MEDIA_QUERY = '(max-height: 640px)';\nexport const REM = parseInt(getComputedStyle(document.documentElement).fontSize, 10);\nexport const ROUND_VIDEO_DIMENSIONS_PX = 240;\nexport const GIF_MIN_WIDTH = 300;\nexport const AVATAR_FULL_DIMENSIONS = { width: 640, height: 640 };\nexport const VIDEO_AVATAR_FULL_DIMENSIONS = { width: 800, height: 800 };\nexport const LIKE_STICKER_ID = '4986041492570112461';\n\nconst DEFAULT_MEDIA_DIMENSIONS: ApiDimensions = { width: 100, height: 100 };\nconst MOBILE_SCREEN_NO_AVATARS_MESSAGE_EXTRA_WIDTH_REM = 4.5;\nconst MOBILE_SCREEN_MESSAGE_EXTRA_WIDTH_REM = 7;\nconst MESSAGE_MAX_WIDTH_REM = 29;\nconst MESSAGE_OWN_MAX_WIDTH_REM = 30;\n\nlet cachedMaxWidthOwn: number | undefined;\nlet cachedMaxWidth: number | undefined;\nlet cachedMaxWidthNoAvatar: number | undefined;\n\nfunction getMaxMessageWidthRem(fromOwnMessage?: boolean, noAvatars?: boolean, isMobile?: boolean) {\n  const regularMaxWidth = fromOwnMessage ? MESSAGE_OWN_MAX_WIDTH_REM : MESSAGE_MAX_WIDTH_REM;\n  if (!isMobile) {\n    return regularMaxWidth;\n  }\n\n  const { width: windowWidth } = windowSize.get();\n\n  // @optimization Limitation: changing device screen width not supported\n  if (!cachedMaxWidthOwn) {\n    cachedMaxWidthOwn = Math.min(\n      MESSAGE_OWN_MAX_WIDTH_REM,\n      windowWidth / REM - MOBILE_SCREEN_NO_AVATARS_MESSAGE_EXTRA_WIDTH_REM,\n    );\n  }\n  if (!cachedMaxWidth) {\n    cachedMaxWidth = Math.min(\n      MESSAGE_MAX_WIDTH_REM,\n      windowWidth / REM - MOBILE_SCREEN_MESSAGE_EXTRA_WIDTH_REM,\n    );\n  }\n  if (!cachedMaxWidthNoAvatar) {\n    cachedMaxWidthNoAvatar = Math.min(\n      MESSAGE_MAX_WIDTH_REM,\n      windowWidth / REM - MOBILE_SCREEN_NO_AVATARS_MESSAGE_EXTRA_WIDTH_REM,\n    );\n  }\n\n  return fromOwnMessage\n    ? cachedMaxWidthOwn\n    : (noAvatars ? cachedMaxWidthNoAvatar : cachedMaxWidth);\n}\n\nexport function getAvailableWidth(\n  fromOwnMessage?: boolean,\n  isWebPageMedia?: boolean,\n  noAvatars?: boolean,\n  isMobile?: boolean,\n) {\n  const extraPaddingRem = isWebPageMedia ? 1.625 : 0;\n  const availableWidthRem = getMaxMessageWidthRem(fromOwnMessage, noAvatars, isMobile) - extraPaddingRem;\n\n  return availableWidthRem * REM;\n}\n\nfunction getAvailableHeight(isGif?: boolean, aspectRatio?: number) {\n  if (\n    isGif && aspectRatio\n    && aspectRatio >= 0.75 && aspectRatio <= 1.25\n  ) {\n    return 20 * REM;\n  }\n\n  return 27 * REM;\n}\n\nexport function calculateDimensionsForMessageMedia({\n  width,\n  height,\n  fromOwnMessage,\n  isWebPageMedia,\n  isGif,\n  noAvatars,\n  isMobile,\n}: {\n  width: number;\n  height: number;\n  fromOwnMessage?: boolean;\n  asForwarded?: boolean;\n  isWebPageMedia?: boolean;\n  isGif?: boolean;\n  noAvatars?: boolean;\n  isMobile?: boolean;\n}): ApiDimensions {\n  const aspectRatio = height / width;\n  const availableWidth = getAvailableWidth(fromOwnMessage, isWebPageMedia, noAvatars, isMobile);\n  const availableHeight = getAvailableHeight(isGif, aspectRatio);\n  const mediaWidth = isGif ? Math.max(GIF_MIN_WIDTH, width) : width;\n  const mediaHeight = isGif ? height * (mediaWidth / width) : height;\n\n  return calculateDimensions(availableWidth, availableHeight, mediaWidth, mediaHeight);\n}\n\nexport function getMediaViewerAvailableDimensions(withFooter: boolean, isVideo: boolean): ApiDimensions {\n  const mql = window.matchMedia(MEDIA_VIEWER_MEDIA_QUERY);\n  const { width: windowWidth, height: windowHeight } = windowSize.get();\n  let occupiedHeightRem = isVideo && mql.matches ? 10 : 8.25;\n  if (withFooter && !IS_TOUCH_ENV) {\n    occupiedHeightRem = mql.matches ? 10 : 12.5;\n  }\n  return {\n    width: windowWidth,\n    height: windowHeight - occupiedHeightRem * REM,\n  };\n}\n\nexport function calculateInlineImageDimensions(\n  photo: ApiPhoto,\n  fromOwnMessage?: boolean,\n  asForwarded?: boolean,\n  isWebPageMedia?: boolean,\n  noAvatars?: boolean,\n  isMobile?: boolean,\n) {\n  const { width, height } = getPhotoInlineDimensions(photo) || DEFAULT_MEDIA_DIMENSIONS;\n\n  return calculateDimensionsForMessageMedia({\n    width,\n    height,\n    fromOwnMessage,\n    asForwarded,\n    isWebPageMedia,\n    noAvatars,\n    isMobile,\n  });\n}\n\nexport function calculateVideoDimensions(\n  video: ApiVideo,\n  fromOwnMessage?: boolean,\n  asForwarded?: boolean,\n  isWebPageMedia?: boolean,\n  noAvatars?: boolean,\n  isMobile?: boolean,\n) {\n  const { width, height } = getVideoDimensions(video) || DEFAULT_MEDIA_DIMENSIONS;\n\n  return calculateDimensionsForMessageMedia({\n    width,\n    height,\n    fromOwnMessage,\n    asForwarded,\n    isWebPageMedia,\n    isGif: video.isGif,\n    noAvatars,\n    isMobile,\n  });\n}\n\nexport function calculateExtendedPreviewDimensions(\n  preview: ApiMediaExtendedPreview,\n  fromOwnMessage?: boolean,\n  asForwarded?: boolean,\n  isWebPageMedia?: boolean,\n  noAvatars?: boolean,\n  isMobile?: boolean,\n) {\n  const { width = DEFAULT_MEDIA_DIMENSIONS.width, height = DEFAULT_MEDIA_DIMENSIONS.height } = preview;\n\n  return calculateDimensionsForMessageMedia({\n    width,\n    height,\n    fromOwnMessage,\n    asForwarded,\n    isWebPageMedia,\n    noAvatars,\n    isMobile,\n  });\n}\n\nexport function getPictogramDimensions(): ApiDimensions {\n  return {\n    width: 2 * REM,\n    height: 2 * REM,\n  };\n}\n\nexport function getDocumentThumbnailDimensions(smaller?: boolean): ApiDimensions {\n  if (smaller) {\n    return {\n      width: 3 * REM,\n      height: 3 * REM,\n    };\n  }\n\n  return {\n    width: 3.375 * REM,\n    height: 3.375 * REM,\n  };\n}\n\nexport function getStickerDimensions(sticker: ApiSticker, isMobile?: boolean): ApiDimensions {\n  const { width } = sticker;\n  let { height } = sticker;\n\n  // For some reason this sticker has some weird `height` value\n  if (sticker.id === LIKE_STICKER_ID) {\n    height = width;\n  }\n\n  const aspectRatio = (height && width) && height / width;\n  const baseWidth = REM * (\n    isMobile\n      ? STICKER_SIZE_INLINE_MOBILE_FACTOR\n      : STICKER_SIZE_INLINE_DESKTOP_FACTOR\n  );\n  const calculatedHeight = aspectRatio ? baseWidth * aspectRatio : baseWidth;\n\n  if (aspectRatio && calculatedHeight > baseWidth) {\n    return {\n      width: Math.round(baseWidth / aspectRatio),\n      height: baseWidth,\n    };\n  }\n\n  return {\n    width: baseWidth,\n    height: calculatedHeight,\n  };\n}\n\nexport function calculateMediaViewerDimensions(\n  { width, height }: ApiDimensions, withFooter: boolean, isVideo: boolean = false,\n): ApiDimensions {\n  const { width: availableWidth, height: availableHeight } = getMediaViewerAvailableDimensions(withFooter, isVideo);\n\n  return calculateDimensions(availableWidth, availableHeight, width, height);\n}\n\nexport function calculateDimensions(\n  availableWidth: number,\n  availableHeight: number,\n  mediaWidth: number,\n  mediaHeight: number,\n): ApiDimensions {\n  const aspectRatio = mediaHeight / mediaWidth;\n  const calculatedWidth = Math.min(mediaWidth, availableWidth);\n  const calculatedHeight = Math.round(calculatedWidth * aspectRatio);\n\n  if (calculatedHeight > availableHeight) {\n    return {\n      width: Math.round(availableHeight / aspectRatio),\n      height: availableHeight,\n    };\n  }\n\n  return {\n    width: calculatedWidth,\n    height: Math.round(calculatedWidth * aspectRatio),\n  };\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"A72KeAmh\",\"icon\":\"eLEPgwPj\",\"title\":\"ZQJO2BKn\"};","import type { FC } from '../../lib/teact/teact';\nimport { memo } from '../../lib/teact/teact';\n\nimport type { ThreadId } from '../../types';\n\nimport { GENERAL_TOPIC_ID } from '../../config';\nimport buildClassName from '../../util/buildClassName';\nimport { getTopicDefaultIcon } from '../../util/forumColors';\nimport { getFirstLetters } from '../../util/textFormat';\nimport renderText from './helpers/renderText';\n\nimport Icon from './icons/Icon';\n\nimport styles from './TopicDefaultIcon.module.scss';\n\ntype OwnProps = {\n  className?: string;\n  letterClassName?: string;\n  topicId: ThreadId;\n  iconColor?: number;\n  title: string;\n  onClick?: NoneToVoidFunction;\n};\n\nconst TopicDefaultIcon: FC<OwnProps> = ({\n  className,\n  letterClassName,\n  topicId,\n  iconColor,\n  title,\n  onClick,\n}) => {\n  const iconSrc = getTopicDefaultIcon(iconColor);\n\n  if (topicId === GENERAL_TOPIC_ID) {\n    return (\n      <Icon\n        name=\"hashtag\"\n        className={buildClassName(styles.root, className, 'general-forum-icon')}\n        onClick={onClick}\n      />\n    );\n  }\n  return (\n    <div className={buildClassName(styles.root, className)} onClick={onClick}>\n      <img className={styles.icon} src={iconSrc} alt=\"\" draggable={false} />\n      <div className={buildClassName(styles.title, letterClassName, 'topic-icon-letter')}>\n        {renderText(getFirstLetters(title, 1))}\n      </div>\n    </div>\n  );\n};\n\nexport default memo(TopicDefaultIcon);\n","import type {\n  ApiAttachment,\n  ApiAudio,\n  ApiDimensions,\n  ApiDocument,\n  ApiGame,\n  ApiLocation,\n  ApiMediaExtendedPreview,\n  ApiMessage,\n  ApiMessageSearchType,\n  ApiPhoto,\n  ApiSticker,\n  ApiVideo,\n  ApiVoice,\n  ApiWebDocument,\n  ApiWebPage,\n  MediaContainer,\n  SizeTarget,\n  StatefulMediaContent,\n} from '../../api/types';\nimport type { ActiveDownloads } from '../../types';\nimport { ApiMediaFormat } from '../../api/types';\n\nimport {\n  IS_OPFS_SUPPORTED,\n  IS_OPUS_SUPPORTED,\n  IS_PROGRESSIVE_SUPPORTED,\n  IS_SAFARI,\n  MAX_BUFFER_SIZE,\n} from '../../util/browser/windowEnvironment';\nimport { getDocumentHasPreview } from '../../components/common/helpers/documentInfo';\nimport { getAttachmentMediaType, matchLinkInMessageText } from './messages';\n\nexport type MediaWithThumbs = ApiPhoto | ApiVideo | ApiDocument | ApiSticker | ApiMediaExtendedPreview;\nexport type DownloadableMedia = ApiPhoto | ApiVideo | ApiDocument | ApiSticker | ApiAudio | ApiVoice | ApiWebDocument;\n\nexport function getMessageContent(message: MediaContainer) {\n  return message.content;\n}\n\nexport function hasMessageMedia(message: MediaContainer) {\n  return Boolean((\n    getMessagePhoto(message)\n    || getMessageVideo(message)\n    || getMessageDocument(message)\n    || getMessageSticker(message)\n    || getMessageContact(message)\n    || getMessagePollId(message)\n    || getMessageTodo(message)\n    || getMessageAction(message)\n    || getMessageAudio(message)\n    || getMessageVoice(message)\n  ));\n}\n\nexport function canEditMedia(message: MediaContainer) {\n  const {\n    video, ...otherMedia\n  } = message.content;\n\n  return !video?.isRound && !Object.keys(otherMedia).length;\n}\n\nexport function getMessagePhoto(message: MediaContainer) {\n  return message.content.photo;\n}\n\nexport function getMessageActionPhoto(message: MediaContainer) {\n  return message.content.action?.type === 'suggestProfilePhoto' ? message.content.action.photo : undefined;\n}\n\nexport function getMessageVideo(message: MediaContainer) {\n  return message.content.video;\n}\n\nexport function getMessageRoundVideo(message: MediaContainer) {\n  const { video } = message.content;\n\n  return video?.isRound ? video : undefined;\n}\n\nexport function getMessageAction(message: MediaContainer) {\n  return message.content.action;\n}\n\nexport function getMessageAudio(message: MediaContainer) {\n  return message.content.audio;\n}\n\nexport function getMessageVoice(message: MediaContainer) {\n  return message.content.voice;\n}\n\nexport function getMessageSticker(message: MediaContainer) {\n  return message.content.sticker;\n}\n\nexport function getMessageDocument(message: MediaContainer) {\n  return message.content.document;\n}\n\nexport function isDocumentPhoto(document: ApiDocument) {\n  return document.innerMediaType === 'photo';\n}\n\nexport function isDocumentVideo(document: ApiDocument) {\n  return document.innerMediaType === 'video';\n}\n\nexport function isMessageDocumentSticker(message: MediaContainer) {\n  const document = getMessageDocument(message);\n  return document ? document.mimeType === 'image/webp' : undefined;\n}\n\nexport function getMessageContact(message: MediaContainer) {\n  return message.content.contact;\n}\n\nexport function getMessagePollId(message: MediaContainer) {\n  return message.content.pollId;\n}\n\nexport function getMessageTodo(message: MediaContainer) {\n  return message.content.todo;\n}\n\nexport function getMessageInvoice(message: MediaContainer) {\n  return message.content.invoice;\n}\n\nexport function getMessageLocation(message: MediaContainer) {\n  return message.content.location;\n}\n\nexport function getMessageWebPage(message: MediaContainer) {\n  return message.content.webPage;\n}\n\nexport function getMessagePaidMedia(message: MediaContainer) {\n  return message.content.paidMedia;\n}\n\nexport function getMessageDocumentPhoto(message: MediaContainer) {\n  const document = getMessageDocument(message);\n  return document && isDocumentPhoto(document) ? document : undefined;\n}\n\nexport function getWebPagePhoto(webPage?: ApiWebPage) {\n  return webPage?.webpageType === 'full' ? webPage.photo : undefined;\n}\n\nexport function getWebPageVideo(webPage?: ApiWebPage) {\n  return webPage?.webpageType === 'full' ? webPage.video : undefined;\n}\n\nexport function getWebPageAudio(webPage?: ApiWebPage) {\n  return webPage?.webpageType === 'full' ? webPage.audio : undefined;\n}\n\nexport function getWebPageDocument(webPage?: ApiWebPage) {\n  return webPage?.webpageType === 'full' ? webPage.document : undefined;\n}\n\nexport function getMessageDocumentVideo(message: MediaContainer) {\n  const document = getMessageDocument(message);\n  return document && isDocumentVideo(document) ? document : undefined;\n}\n\nexport function getMediaThumbUri(media: MediaWithThumbs) {\n  return media.thumbnail?.dataUri;\n}\n\nexport function getMessageIsSpoiler(message: MediaContainer) {\n  const media = getMessagePhoto(message)\n    || getMessageVideo(message);\n\n  const invoiceMedia = getMessageInvoice(message)?.extendedMedia;\n  return Boolean(invoiceMedia || media?.isSpoiler);\n}\n\nexport function buildStaticMapHash(\n  geo: ApiLocation['geo'],\n  width: number,\n  height: number,\n  zoom: number,\n  scale: number,\n) {\n  const {\n    long, lat, accessHash, accuracyRadius,\n  } = geo;\n\n  // eslint-disable-next-line @stylistic/max-len\n  return `staticMap:${accessHash}?lat=${lat}&long=${long}&w=${width}&h=${height}&zoom=${zoom}&scale=${scale}&accuracyRadius=${accuracyRadius}`;\n}\n\nexport function getPhotoMediaHash(photo: ApiPhoto | ApiDocument, target: SizeTarget, isAction?: boolean) {\n  const base = `photo${photo.id}`;\n  const isVideo = photo.mediaType === 'photo' && photo.isVideo;\n\n  switch (target) {\n    case 'micro':\n    case 'pictogram':\n      return `${base}?size=${isAction ? 'a' : 'm'}`;\n    case 'inline':\n      return !hasMediaLocalBlobUrl(photo) ? `${base}?size=${isAction ? 'b' : 'x'}` : undefined;\n    case 'preview':\n      return `${base}?size=${isAction ? 'b' : 'x'}`;\n    case 'download':\n      return !isVideo ? base : getVideoProfilePhotoMediaHash(photo);\n    case 'full':\n    default:\n      return base;\n  }\n}\n\nexport function getProfilePhotoMediaHash(photo: ApiPhoto) {\n  return `photo${photo.id}?size=c`;\n}\n\nexport function getVideoProfilePhotoMediaHash(photo: ApiPhoto) {\n  if (!photo.isVideo) return undefined;\n  return `photo${photo.id}?size=u`;\n}\n\nexport function getVideoMediaHash(video: ApiVideo | ApiDocument, target: SizeTarget) {\n  const base = `document${video.id}`;\n\n  switch (target) {\n    case 'micro':\n    case 'pictogram':\n      return `${base}?size=m`;\n    case 'inline':\n      return !hasMediaLocalBlobUrl(video) ? appendProgressiveQueryParameters(video, base) : undefined;\n    case 'preview':\n      return `${base}?size=x`;\n    case 'download':\n      return `${base}?download`;\n    case 'full':\n    default:\n      return appendProgressiveQueryParameters(video, base);\n  }\n}\n\nexport function getVideoPreviewMediaHash(video: ApiVideo) {\n  return video.hasVideoPreview ? `document${video.id}?size=v` : undefined;\n}\n\nexport function getDocumentMediaHash(document: ApiDocument, target: SizeTarget) {\n  const base = `document${document.id}`;\n\n  switch (target) {\n    case 'micro':\n    case 'pictogram':\n    case 'inline':\n    case 'preview':\n      if (!getDocumentHasPreview(document) || hasMediaLocalBlobUrl(document)) {\n        return undefined;\n      }\n\n      return `${base}?size=m`;\n    case 'full':\n    case 'download':\n    default:\n      return base;\n  }\n}\n\nexport function getAudioMediaHash(audio: ApiAudio, target: SizeTarget) {\n  const base = `document${audio.id}`;\n\n  switch (target) {\n    case 'micro':\n    case 'pictogram':\n      return getAudioHasCover(audio) ? `${base}?size=m` : undefined;\n    case 'inline':\n      return appendProgressiveQueryParameters(audio, base);\n    case 'download':\n      return `${base}?download`;\n    default:\n      return base;\n  }\n}\n\nexport function getVoiceMediaHash(voice: ApiVoice, target: SizeTarget) {\n  const base = `document${voice.id}`;\n\n  switch (target) {\n    case 'micro':\n    case 'pictogram':\n      return undefined;\n    case 'download':\n      return `${base}?download`;\n    case 'inline':\n    default:\n      return base;\n  }\n}\n\nexport function getWebDocumentHash(webDocument?: ApiWebDocument) {\n  if (!webDocument) return undefined;\n  return `webDocument:${webDocument.url}`;\n}\n\nexport function getStickerMediaHash(sticker: ApiSticker, target: SizeTarget) {\n  const base = `document${sticker.id}`;\n\n  switch (target) {\n    case 'micro':\n    case 'pictogram':\n      if (!sticker.previewPhotoSizes?.some((size) => size.type === 's')) {\n        return getStickerMediaHash(sticker, 'preview');\n      }\n      return `${base}?size=s`;\n    case 'preview':\n      return `${base}?size=m`;\n    case 'download':\n      return `${base}?download`;\n    case 'inline':\n    default:\n      return base;\n  }\n}\n\nexport function getMediaHash(media: DownloadableMedia, target: SizeTarget) {\n  switch (media.mediaType) {\n    case 'photo':\n      return getPhotoMediaHash(media, target);\n    case 'video':\n      return getVideoMediaHash(media, target);\n    case 'document':\n      return getDocumentMediaHash(media, target);\n    case 'audio':\n      return getAudioMediaHash(media, target);\n    case 'voice':\n      return getVoiceMediaHash(media, target);\n    case 'sticker':\n      return getStickerMediaHash(media, target);\n    case 'webDocument':\n      return getWebDocumentHash(media);\n    default:\n      return undefined;\n  }\n}\n\nexport function getGamePreviewPhotoHash(game: ApiGame) {\n  const { photo } = game;\n\n  if (photo) {\n    return `photo${photo.id}?size=x`;\n  }\n\n  return undefined;\n}\n\nexport function getGamePreviewVideoHash(game: ApiGame) {\n  const { document } = game;\n\n  if (document) {\n    return `document${document.id}`;\n  }\n\n  return undefined;\n}\n\nexport function appendProgressiveQueryParameters(media: ApiAudio | ApiVideo | ApiDocument, base: string) {\n  if (IS_PROGRESSIVE_SUPPORTED && IS_SAFARI) {\n    const url = new URL(base, window.location.href);\n    url.searchParams.append('fileSize', media.size.toString());\n    url.searchParams.append('mimeType', media.mimeType);\n    return url.toString();\n  }\n\n  return base;\n}\n\nexport function getAudioHasCover(media: ApiAudio) {\n  return media.thumbnailSizes && media.thumbnailSizes.length > 0;\n}\n\nexport function getMediaFormat(\n  media: DownloadableMedia, target: SizeTarget,\n): ApiMediaFormat {\n  const isDocument = media.mediaType === 'document';\n  const hasInnerVideo = isDocument && media.innerMediaType === 'video';\n  const isVideo = media.mediaType === 'video' || hasInnerVideo;\n  const isAudio = media.mediaType === 'audio';\n  const isVoice = media.mediaType === 'voice';\n\n  const size = getMediaFileSize(media) || 0; // Media types that do not have `size` are smaller than `MAX_BUFFER_SIZE`\n\n  if (target === 'download') {\n    if (IS_PROGRESSIVE_SUPPORTED && size > MAX_BUFFER_SIZE && !IS_OPFS_SUPPORTED) {\n      return ApiMediaFormat.DownloadUrl;\n    }\n    return ApiMediaFormat.BlobUrl;\n  }\n\n  if (isVideo && IS_PROGRESSIVE_SUPPORTED && (\n    target === 'full' || target === 'inline'\n  )) {\n    return ApiMediaFormat.Progressive;\n  }\n\n  if (isAudio || isVoice) {\n    // Safari\n    if (isVoice && !IS_OPUS_SUPPORTED) {\n      return ApiMediaFormat.BlobUrl;\n    }\n\n    return ApiMediaFormat.Progressive;\n  }\n\n  return ApiMediaFormat.BlobUrl;\n}\n\nexport function getMediaFileSize(media: DownloadableMedia) {\n  return 'size' in media ? media.size : undefined;\n}\n\nexport function hasMediaLocalBlobUrl(media: ApiPhoto | ApiVideo | ApiDocument) {\n  if ('blobUrl' in media) {\n    return Boolean(media.blobUrl);\n  }\n\n  if ('previewBlobUrl' in media) {\n    return Boolean(media.previewBlobUrl);\n  }\n\n  return false;\n}\n\nexport function getChatMediaMessageIds(\n  messages: Record<number, ApiMessage>, listedIds: number[], isFromSharedMedia = false,\n) {\n  return getMessageContentIds(messages, listedIds, isFromSharedMedia ? 'media' : 'inlineMedia');\n}\n\nexport function getPhotoFullDimensions(photo: Pick<ApiPhoto, 'sizes' | 'thumbnail'>): ApiDimensions | undefined {\n  return (\n    photo.sizes.find((size) => size.type === 'w')\n    || photo.sizes.find((size) => size.type === 'y')\n    || getPhotoInlineDimensions(photo)\n  );\n}\n\nexport function getPhotoInlineDimensions(photo: Pick<ApiPhoto, 'sizes' | 'thumbnail'>): ApiDimensions | undefined {\n  return (\n    photo.sizes.find((size) => size.type === 'x')\n    || photo.sizes.find((size) => size.type === 'm')\n    || photo.sizes.find((size) => size.type === 's')\n    || photo.thumbnail\n  );\n}\n\nexport function getVideoDimensions(video: ApiVideo): ApiDimensions | undefined {\n  if (video.width && video.height) {\n    return video as ApiDimensions;\n  }\n\n  return undefined;\n}\n\nexport function getMediaTransferState(\n  progress?: number, isLoadNeeded = false, isUploading = false,\n) {\n  const isTransferring = isUploading || isLoadNeeded;\n  const transferProgress = Number(progress);\n\n  return {\n    isUploading, isTransferring, transferProgress,\n  };\n}\n\nexport function getMessageContentIds(\n  messages: Record<number, ApiMessage>, messageIds: number[], contentType: ApiMessageSearchType | 'inlineMedia',\n) {\n  let validator: (message: ApiMessage) => unknown;\n\n  switch (contentType) {\n    case 'media':\n      validator = (message: ApiMessage) => {\n        const video = getMessageVideo(message);\n        return getMessagePhoto(message) || (video && !video.isRound && !video.isGif);\n      };\n      break;\n\n    case 'documents':\n      validator = getMessageDocument;\n      break;\n\n    case 'links':\n      validator = (message: ApiMessage) => getMessageWebPage(message) || matchLinkInMessageText(message);\n      break;\n\n    case 'audio':\n      validator = getMessageAudio;\n      break;\n\n    case 'voice':\n      validator = (message: ApiMessage) => {\n        const video = getMessageVideo(message);\n        return getMessageVoice(message) || (video && video.isRound);\n      };\n      break;\n\n    case 'inlineMedia':\n      validator = (message: ApiMessage) => {\n        const video = getMessageVideo(message);\n        const document = getMessageDocument(message);\n        return (\n          getMessagePhoto(message)\n          || (video && !video.isRound && !video.isGif)\n          || (document && isDocumentPhoto(document))\n          || (document && isDocumentVideo(document))\n        );\n      };\n      break;\n\n    default:\n      return [] as Array<number>;\n  }\n\n  return messageIds.reduce((result, messageId) => {\n    if (messages[messageId] && validator(messages[messageId])) {\n      result.push(messageId);\n    }\n\n    return result;\n  }, [] as Array<number>);\n}\n\nexport function isMediaLoadableInViewer(newMessage: ApiMessage) {\n  if (!newMessage.content) return false;\n  if (newMessage.content.photo) return true;\n  if (newMessage.content.video && !newMessage.content.video.isRound && !newMessage.content.video.isGif) return true;\n  return false;\n}\n\nexport function getMediaFilename(media: DownloadableMedia) {\n  if ('fileName' in media && media.fileName) {\n    return media.fileName;\n  }\n\n  if (media.mediaType === 'sticker') {\n    const extension = media.isLottie ? 'tgs' : media.isVideo ? 'webm' : 'webp';\n    return `${media.id}.${extension}`;\n  }\n\n  if (media.mediaType === 'photo') {\n    return `${media.id}.${media.isVideo ? 'mp4' : 'jpg'}`;\n  }\n\n  if (media.mediaType === 'voice') {\n    return `${media.id}.${IS_OPUS_SUPPORTED ? 'ogg' : 'wav'}`;\n  }\n\n  if ('id' in media && media.id) {\n    return media.id;\n  }\n\n  return `${media.mediaType}-${Math.random().toString(36).slice(4)}`;\n}\n\nexport function getIsDownloading(activeDownloads: ActiveDownloads, media: DownloadableMedia) {\n  const hash = getMediaHash(media, 'download');\n  if (!hash) return false;\n  return Boolean(activeDownloads[hash]);\n}\n\nexport function getMessageMediaHash(\n  message: MediaContainer,\n  statefulMedia: StatefulMediaContent,\n  target: SizeTarget,\n) {\n  const {\n    video, sticker, audio, voice, document,\n  } = message.content;\n  const { webPage } = statefulMedia;\n\n  const messagePhoto = getMessagePhoto(message) || getWebPagePhoto(webPage);\n  const actionPhoto = getMessageActionPhoto(message);\n  const messageVideo = video || getWebPageVideo(webPage);\n  const messageDocument = document || getWebPageDocument(webPage);\n  const messageAudio = audio || getWebPageAudio(webPage);\n\n  if (messageVideo) {\n    return getVideoMediaHash(messageVideo, target);\n  }\n\n  if (messagePhoto || actionPhoto) {\n    return getPhotoMediaHash(messagePhoto || actionPhoto!, target, Boolean(actionPhoto));\n  }\n\n  if (messageDocument) {\n    return getDocumentMediaHash(messageDocument, target);\n  }\n\n  if (sticker) {\n    return getStickerMediaHash(sticker, target);\n  }\n\n  if (messageAudio) {\n    return getAudioMediaHash(messageAudio, target);\n  }\n\n  if (voice) {\n    return getVoiceMediaHash(voice, target);\n  }\n\n  return undefined;\n}\n\nexport function canReplaceMessageMedia(\n  message: MediaContainer, attachment: ApiAttachment,\n) {\n  const isPhotoOrVideo = Boolean(getMessagePhoto(message) || getMessageVideo(message));\n  const isFile = Boolean(getMessageAudio(message)\n    || getMessageVoice(message) || getMessageDocument(message));\n\n  const fileType = getAttachmentMediaType(attachment);\n\n  return (\n    (isPhotoOrVideo && (fileType === 'photo' || fileType === 'video'))\n    || (isFile && (fileType === 'audio' || fileType === 'file'))\n  );\n}\n","import type { ApiFormattedText } from '../../api/types';\nimport { ApiMessageEntityTypes } from '../../api/types';\n\nexport function getStickerHashById(stickerId: string, isPreview?: boolean) {\n  const base = `sticker${stickerId}`;\n  return !isPreview ? base : `${base}?size=m`;\n}\n\nexport function containsCustomEmoji(formattedText: ApiFormattedText) {\n  return formattedText.entities?.some((e) => e.type === ApiMessageEntityTypes.CustomEmoji);\n}\n\nexport function stripCustomEmoji(text: ApiFormattedText): ApiFormattedText {\n  if (!text.entities) return text;\n\n  const entities = text.entities.filter((entity) => entity.type !== ApiMessageEntityTypes.CustomEmoji);\n  return { ...text, entities };\n}\n","import type { ApiPeer, ApiUser, ApiUserStatus } from '../../api/types';\nimport type { OldLangFn } from '../../hooks/useOldLang';\n\nimport { ANONYMOUS_USER_ID, SERVICE_NOTIFICATIONS_USER_ID } from '../../config';\nimport { formatFullDate, formatTime } from '../../util/dates/dateFormat';\nimport { DAY } from '../../util/dates/units';\nimport { orderBy } from '../../util/iteratees';\nimport { formatPhoneNumber } from '../../util/phoneNumber';\nimport { getServerTime, getServerTimeOffset } from '../../util/serverTime';\n\nexport function getUserFirstOrLastName(user?: ApiUser) {\n  if (!user) {\n    return undefined;\n  }\n\n  switch (user.type) {\n    case 'userTypeBot':\n      return user.firstName;\n    case 'userTypeRegular': {\n      return user.firstName || user.lastName;\n    }\n\n    case 'userTypeDeleted':\n    case 'userTypeUnknown': {\n      return 'Deleted';\n    }\n\n    default:\n      return undefined;\n  }\n}\n\nexport function getUserFullName(user?: ApiUser) {\n  if (!user) {\n    return undefined;\n  }\n\n  if (isDeletedUser(user)) {\n    return 'Deleted Account';\n  }\n\n  switch (user.type) {\n    case 'userTypeBot':\n    case 'userTypeRegular': {\n      if (user.firstName && user.lastName) {\n        return `${user.firstName} ${user.lastName}`;\n      }\n\n      if (user.firstName) {\n        return user.firstName;\n      }\n\n      if (user.lastName) {\n        return user.lastName;\n      }\n\n      if (user.phoneNumber) {\n        return `+${formatPhoneNumber(user.phoneNumber)}`;\n      }\n\n      break;\n    }\n  }\n\n  return undefined;\n}\n\nexport function getUserStatus(\n  lang: OldLangFn, user: ApiUser, userStatus: ApiUserStatus | undefined,\n) {\n  if (user.id === SERVICE_NOTIFICATIONS_USER_ID) {\n    return lang('ServiceNotifications');\n  }\n\n  if (user.isSupport) {\n    return lang('SupportStatus');\n  }\n\n  if (user.type && user.type === 'userTypeBot') {\n    if (user.botActiveUsers) {\n      return lang('BotUsers', user.botActiveUsers, 'i');\n    }\n    return lang('Bot');\n  }\n\n  if (!userStatus) {\n    return '';\n  }\n\n  switch (userStatus.type) {\n    case 'userStatusEmpty': {\n      return lang('ALongTimeAgo');\n    }\n\n    case 'userStatusLastMonth': {\n      return lang('WithinAMonth');\n    }\n\n    case 'userStatusLastWeek': {\n      return lang('WithinAWeek');\n    }\n\n    case 'userStatusOffline': {\n      const { wasOnline } = userStatus;\n\n      if (!wasOnline) return lang('LastSeen.Offline');\n\n      const serverTimeOffset = getServerTimeOffset();\n      const now = new Date(Date.now() + serverTimeOffset * 1000);\n      const wasOnlineDate = new Date(wasOnline * 1000);\n\n      if (wasOnlineDate >= now) {\n        return lang('LastSeen.JustNow');\n      }\n\n      const diff = new Date(now.getTime() - wasOnlineDate.getTime());\n\n      // within a minute\n      if (diff.getTime() / 1000 < 60) {\n        return lang('LastSeen.JustNow');\n      }\n\n      // within an hour\n      if (diff.getTime() / 1000 < 60 * 60) {\n        const minutes = Math.floor(diff.getTime() / 1000 / 60);\n        return lang('LastSeen.MinutesAgo', minutes);\n      }\n\n      // today\n      const today = new Date();\n      today.setHours(0, 0, 0, 0);\n      const serverToday = new Date(today.getTime() + serverTimeOffset * 1000);\n      if (wasOnlineDate > serverToday) {\n        // up to 6 hours ago\n        if (diff.getTime() / 1000 < 6 * 60 * 60) {\n          const hours = Math.floor(diff.getTime() / 1000 / 60 / 60);\n          return lang('LastSeen.HoursAgo', hours);\n        }\n\n        // other\n        return lang('LastSeen.TodayAt', formatTime(lang, wasOnlineDate));\n      }\n\n      // yesterday\n      const yesterday = new Date();\n      yesterday.setDate(now.getDate() - 1);\n      yesterday.setHours(0, 0, 0, 0);\n      const serverYesterday = new Date(yesterday.getTime() + serverTimeOffset * 1000);\n      if (wasOnlineDate > serverYesterday) {\n        return lang('LastSeen.YesterdayAt', formatTime(lang, wasOnlineDate));\n      }\n\n      return lang('LastSeen.AtDate', formatFullDate(lang, wasOnlineDate));\n    }\n\n    case 'userStatusOnline': {\n      return lang('Online');\n    }\n\n    case 'userStatusRecently': {\n      return lang('Lately');\n    }\n\n    default:\n      return undefined;\n  }\n}\n\nexport function isUserOnline(user: ApiUser, userStatus?: ApiUserStatus, withSelfOnline = false) {\n  const { id, type } = user;\n\n  if (!userStatus) {\n    return false;\n  }\n\n  if (id === SERVICE_NOTIFICATIONS_USER_ID) {\n    return false;\n  }\n\n  if (user.isSelf && !withSelfOnline) {\n    return false;\n  }\n\n  return userStatus.type === 'userStatusOnline' && type !== 'userTypeBot';\n}\n\nexport function isDeletedUser(user: ApiUser) {\n  return (user.type === 'userTypeDeleted' || user.type === 'userTypeUnknown')\n    && user.id !== SERVICE_NOTIFICATIONS_USER_ID;\n}\n\nexport function isUserBot(user: ApiUser) {\n  return user.type === 'userTypeBot';\n}\n\nexport function getCanAddContact(user: ApiUser) {\n  return !user.isSelf && !user.isContact && !isUserBot(user) && user.id !== ANONYMOUS_USER_ID;\n}\n\nexport function sortUserIds(\n  userIds: string[],\n  usersById: Record<string, ApiUser>,\n  userStatusesById: Record<string, ApiUserStatus>,\n  priorityIds?: string[],\n) {\n  return orderBy(userIds, (id) => {\n    const now = getServerTime();\n\n    if (priorityIds && priorityIds.includes(id)) {\n      // Assuming that online status expiration date can't be as far as two days from now,\n      // this should place prioritized on top of the list.\n      // Then we subtract index of `id` in `priorityIds` to preserve selected order\n      return now + (48 * 60 * 60) - (priorityIds.length - priorityIds.indexOf(id));\n    }\n\n    const user = usersById[id];\n    const userStatus = userStatusesById[id];\n    if (!user || !userStatus) {\n      return 0;\n    }\n\n    if (userStatus.type === 'userStatusOnline') {\n      return userStatus.expires;\n    } else if (userStatus.type === 'userStatusOffline' && userStatus.wasOnline) {\n      return userStatus.wasOnline;\n    }\n\n    switch (userStatus.type) {\n      case 'userStatusRecently':\n        return now - DAY;\n      case 'userStatusLastWeek':\n        return now - DAY * 7;\n      case 'userStatusLastMonth':\n        return now - DAY * 7 * 30;\n      default:\n        return 0;\n    }\n  }, 'desc');\n}\n\nexport function getMainUsername(userOrChat: ApiPeer) {\n  return userOrChat.usernames?.find((u) => u.isActive)?.username;\n}\n\nexport function getPeerStoryHtmlId(userId: string) {\n  return `peer-story${userId}`;\n}\n","export const MEMO_EMPTY_ARRAY = [];\n","import { DEBUG } from '../config';\nimport { createCallbackManager } from './callbacks';\n\nexport enum Bundles {\n  Auth,\n  Main,\n  Extra,\n  Calls,\n  Stars,\n}\n\ninterface ImportedBundles {\n  [Bundles.Auth]: typeof import('../bundles/auth');\n  [Bundles.Main]: typeof import('../bundles/main');\n  [Bundles.Extra]: typeof import('../bundles/extra');\n  [Bundles.Calls]: typeof import('../bundles/calls');\n  [Bundles.Stars]: typeof import('../bundles/stars');\n}\n\ntype BundlePromises = {\n  [K in keyof ImportedBundles]: Promise<ImportedBundles[K]>\n};\n\nexport type BundleModules<B extends keyof ImportedBundles> = keyof ImportedBundles[B];\n\nconst LOAD_PROMISES: Partial<BundlePromises> = {};\nconst MEMORY_CACHE: Partial<ImportedBundles> = {};\n\nconst { addCallback, runCallbacks } = createCallbackManager();\n\nexport async function loadBundle<B extends Bundles>(bundleName: B) {\n  if (!LOAD_PROMISES[bundleName]) {\n    switch (bundleName) {\n      case Bundles.Auth:\n        LOAD_PROMISES[Bundles.Auth] = import(/* webpackChunkName: \"BundleAuth\" */ '../bundles/auth');\n        break;\n      case Bundles.Main:\n        if (DEBUG) {\n          // eslint-disable-next-line no-console\n          console.log('>>> START LOAD MAIN BUNDLE');\n        }\n\n        LOAD_PROMISES[Bundles.Main] = import(/* webpackChunkName: \"BundleMain\" */ '../bundles/main');\n        break;\n      case Bundles.Extra:\n        LOAD_PROMISES[Bundles.Extra] = import(/* webpackChunkName: \"BundleExtra\" */ '../bundles/extra');\n        break;\n      case Bundles.Calls:\n        LOAD_PROMISES[Bundles.Calls] = import(/* webpackChunkName: \"BundleCalls\" */ '../bundles/calls');\n        break;\n      case Bundles.Stars:\n        LOAD_PROMISES[Bundles.Stars] = import(/* webpackChunkName: \"BundleStars\" */ '../bundles/stars');\n        break;\n    }\n\n    (LOAD_PROMISES[bundleName]!).then(runCallbacks);\n  }\n\n  const bundle = (await LOAD_PROMISES[bundleName]) as unknown as ImportedBundles[B];\n\n  if (!MEMORY_CACHE[bundleName]) {\n    MEMORY_CACHE[bundleName] = bundle;\n  }\n\n  return bundle;\n}\n\nexport async function loadModule<B extends Bundles>(bundleName: B) {\n  await loadBundle(bundleName);\n}\n\nexport function getModuleFromMemory<B extends Bundles, M extends BundleModules<B>>(\n  bundleName: B, moduleName: M,\n): ImportedBundles[B][M] | undefined {\n  const bundle = MEMORY_CACHE[bundleName] as ImportedBundles[B];\n\n  if (!bundle) {\n    return undefined;\n  }\n\n  return bundle[moduleName];\n}\n\nexport const addLoadListener = addCallback;\n","let serverTimeOffset = 0;\n\nexport function setServerTimeOffset(_serverTimeOffset: number) {\n  serverTimeOffset = _serverTimeOffset;\n}\n\nexport function getServerTimeOffset() {\n  return serverTimeOffset;\n}\n\nexport function getServerTime() {\n  return Math.floor(Date.now() / 1000) + serverTimeOffset;\n}\n","import { useEffect } from '../lib/teact/teact';\n\nimport type { BundleModules, Bundles } from '../util/moduleLoader';\n\nimport { DEBUG } from '../config';\nimport { addLoadListener, getModuleFromMemory, loadModule } from '../util/moduleLoader';\nimport useForceUpdate from './useForceUpdate';\n\nconst useModuleLoader = <B extends Bundles, M extends BundleModules<B>>(\n  bundleName: B, moduleName: M, noLoad = false, autoUpdate = false,\n) => {\n  const module = getModuleFromMemory(bundleName, moduleName);\n  const forceUpdate = useForceUpdate();\n\n  useEffect(() => {\n    if (!autoUpdate) {\n      return undefined;\n    }\n\n    return addLoadListener(forceUpdate);\n  }, [autoUpdate, forceUpdate]);\n\n  useEffect(() => {\n    if (!noLoad && !module) {\n      if (DEBUG) {\n        // eslint-disable-next-line no-console\n        console.log('Module load triggered', bundleName, moduleName);\n      }\n      loadModule(bundleName).then(forceUpdate);\n    }\n  }, [bundleName, forceUpdate, module, moduleName, noLoad]);\n\n  return module;\n};\n\nexport default useModuleLoader;\n","/*\n * Thanks to Ace Monkey for this mind-blowing patch.\n */\n\nexport function patchSafariProgressiveAudio(audioEl: HTMLAudioElement) {\n  if (audioEl.dataset.patchedForSafari) {\n    return;\n  }\n\n  audioEl.addEventListener('play', () => {\n    const t = audioEl.currentTime;\n\n    audioEl.dataset.patchForSafariInProgress = 'true';\n    function onProgress() {\n      if (!audioEl.buffered.length) {\n        return;\n      }\n      audioEl.currentTime = audioEl.duration - 1;\n      audioEl.addEventListener('progress', () => {\n        delete audioEl.dataset.patchForSafariInProgress;\n        audioEl.currentTime = t;\n        if (audioEl.paused && !audioEl.dataset.preventPlayAfterPatch) {\n          audioEl.play();\n        }\n      }, { once: true });\n\n      audioEl.removeEventListener('progress', onProgress);\n    }\n\n    audioEl.addEventListener('progress', onProgress);\n  }, { once: true });\n\n  audioEl.dataset.patchedForSafari = 'true';\n}\n\nexport function isSafariPatchInProgress(audioEl: HTMLAudioElement) {\n  return Boolean(audioEl.dataset.patchForSafariInProgress);\n}\n","import { useEffect, useRef } from '../lib/teact/teact';\n\nconst useEffectWithPrevDeps = <const T extends readonly any[]>(\n  cb: (args: T | readonly []) => void, dependencies: T, debugKey?: string,\n) => {\n  const prevDepsRef = useRef<T>();\n\n  return useEffect(() => {\n    const prevDeps = prevDepsRef.current;\n    prevDepsRef.current = dependencies;\n\n    return cb(prevDeps || []);\n    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  }, dependencies, debugKey);\n};\n\nexport default useEffectWithPrevDeps;\n","import type { MediaContent } from '../../api/types';\nimport { ApiMessageEntityTypes } from '../../api/types';\n\nimport parseEmojiOnlyString from '../../util/emoji/parseEmojiOnlyString';\n\nexport function getEmojiOnlyCountForMessage(content: MediaContent, groupedId?: string): number | undefined {\n  if (!content.text) return undefined;\n  return (\n    !groupedId\n    && Object.keys(content).length === 1 // Only text is present\n    && !content.text.entities?.some((entity) => entity.type !== ApiMessageEntityTypes.CustomEmoji)\n    && parseEmojiOnlyString(content.text.text)\n  ) || undefined;\n}\n","import type {\n  ApiMessage, ApiPoll, ApiPollResult, ApiQuickReply, ApiSponsoredMessage, ApiThreadInfo,\n  ApiWebPage,\n  ApiWebPageFull,\n} from '../../api/types';\nimport type {\n  FocusDirection,\n  MessageList,\n  MessageListType,\n  ScrollTargetPosition,\n  TabThread,\n  Thread,\n  ThreadId,\n} from '../../types';\nimport type {\n  GlobalState, TabArgs, TabState,\n} from '../types';\nimport { MAIN_THREAD_ID } from '../../api/types';\n\nimport {\n  IS_MOCKED_CLIENT, IS_TEST, MESSAGE_LIST_SLICE, MESSAGE_LIST_VIEWPORT_LIMIT, TMP_CHAT_ID,\n} from '../../config';\nimport { areDeepEqual } from '../../util/areDeepEqual';\nimport { addTimestampEntities } from '../../util/dates/timestamp';\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport {\n  areSortedArraysEqual, excludeSortedArray, omit, omitUndefined, pick, pickTruthy, unique,\n} from '../../util/iteratees';\nimport { isLocalMessageId, type MessageKey } from '../../util/keys/messageKey';\nimport {\n  hasMessageTtl, isMediaLoadableInViewer, mergeIdRanges, orderHistoryIds, orderPinnedIds,\n} from '../helpers';\nimport { getEmojiOnlyCountForMessage } from '../helpers/getEmojiOnlyCountForMessage';\nimport {\n  selectChatMessage,\n  selectChatMessages,\n  selectChatScheduledMessages,\n  selectCurrentMessageIds,\n  selectCurrentMessageList,\n  selectListedIds,\n  selectMessageIdsByGroupId,\n  selectOutlyingLists,\n  selectPinnedIds,\n  selectPoll,\n  selectQuickReplyMessage,\n  selectScheduledIds,\n  selectScheduledMessage,\n  selectTabState,\n  selectThreadIdFromMessage,\n  selectThreadInfo,\n  selectViewportIds,\n  selectWebPage,\n} from '../selectors';\nimport { removeIdFromSearchResults } from './middleSearch';\nimport { updateTabState } from './tabs';\nimport { clearMessageTranslation } from './translations';\n\ntype MessageStoreSections = GlobalState['messages']['byChatId'][string];\n\nexport function updateCurrentMessageList<T extends GlobalState>(\n  global: T,\n  chatId: string | undefined,\n  threadId: ThreadId = MAIN_THREAD_ID,\n  type: MessageListType = 'thread',\n  shouldReplaceHistory?: boolean,\n  shouldReplaceLast?: boolean,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const { messageLists } = selectTabState(global, tabId);\n  let newMessageLists: MessageList[] = messageLists;\n  if (shouldReplaceHistory || (IS_TEST && !IS_MOCKED_CLIENT)) {\n    newMessageLists = chatId ? [{ chatId, threadId, type }] : [];\n  } else if (chatId) {\n    const current = messageLists[messageLists.length - 1];\n    if (current?.chatId === chatId && current.threadId === threadId && current.type === type) {\n      return global;\n    }\n\n    if (current && (current.chatId === TMP_CHAT_ID || shouldReplaceLast)) {\n      newMessageLists = [...messageLists.slice(0, -1), { chatId, threadId, type }];\n    } else {\n      const previous = messageLists[messageLists.length - 2];\n\n      if (previous?.chatId === chatId && previous.threadId === threadId && previous.type === type) {\n        newMessageLists = messageLists.slice(0, -1);\n      } else {\n        newMessageLists = [...messageLists, { chatId, threadId, type }];\n      }\n    }\n  } else {\n    newMessageLists = messageLists.slice(0, -1);\n  }\n\n  return updateTabState(global, {\n    messageLists: newMessageLists,\n  }, tabId);\n}\n\nfunction replaceChatMessages<T extends GlobalState>(global: T, chatId: string, newById: Record<number, ApiMessage>): T {\n  return updateMessageStore(global, chatId, {\n    byId: newById,\n  });\n}\n\nexport function updateTabThread<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId, threadUpdate: Partial<TabThread>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const tabState = selectTabState(global, tabId);\n  const current = tabState.tabThreads[chatId]?.[threadId] || {};\n\n  return updateTabState(global, {\n    tabThreads: {\n      ...tabState.tabThreads,\n      [chatId]: {\n        ...tabState.tabThreads[chatId],\n        [threadId]: {\n          ...current,\n          ...threadUpdate,\n        },\n      },\n    },\n  }, tabId);\n}\n\nexport function updateThread<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId, threadUpdate: Partial<Thread> | undefined,\n): T {\n  if (!threadUpdate) {\n    return updateMessageStore(global, chatId, {\n      threadsById: omit(global.messages.byChatId[chatId]?.threadsById, [threadId]),\n    });\n  }\n\n  const current = global.messages.byChatId[chatId];\n\n  return updateMessageStore(global, chatId, {\n    threadsById: {\n      ...(current?.threadsById),\n      [threadId]: {\n        ...(current?.threadsById[threadId]),\n        ...threadUpdate,\n      },\n    },\n  });\n}\n\nexport function updateMessageStore<T extends GlobalState>(\n  global: T, chatId: string, update: Partial<MessageStoreSections>,\n): T {\n  const current = global.messages.byChatId[chatId] || { byId: {}, threadsById: {} };\n\n  return {\n    ...global,\n    messages: {\n      ...global.messages,\n      byChatId: {\n        ...global.messages.byChatId,\n        [chatId]: {\n          ...current,\n          ...update,\n        },\n      },\n    },\n  };\n}\n\nexport function replaceTabThreadParam<T extends GlobalState, K extends keyof TabThread>(\n  global: T, chatId: string, threadId: ThreadId, paramName: K, newValue: TabThread[K] | undefined,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  if (paramName === 'viewportIds') {\n    global = replaceThreadParam(\n      global, chatId, threadId, 'lastViewportIds', newValue as number[] | undefined,\n    );\n  }\n  return updateTabThread(global, chatId, threadId, { [paramName]: newValue }, tabId);\n}\n\nexport function replaceThreadParam<T extends GlobalState, K extends keyof Thread>(\n  global: T, chatId: string, threadId: ThreadId, paramName: K, newValue: Thread[K] | undefined,\n) {\n  return updateThread(global, chatId, threadId, { [paramName]: newValue });\n}\n\nexport function addMessages<T extends GlobalState>(\n  global: T, messages: ApiMessage[],\n): T {\n  const addedByChatId = messages.reduce((messagesByChatId, message: ApiMessage) => {\n    if (!messagesByChatId[message.chatId]) {\n      messagesByChatId[message.chatId] = {};\n    }\n    messagesByChatId[message.chatId][message.id] = message;\n\n    return messagesByChatId;\n  }, {} as Record<string, Record<number, ApiMessage>>);\n\n  Object.keys(addedByChatId).forEach((chatId) => {\n    global = addChatMessagesById(global, chatId, addedByChatId[chatId]);\n  });\n\n  return global;\n}\n\nexport function replaceMessages<T extends GlobalState>(\n  global: T, messages: ApiMessage[],\n): T {\n  const updatedByChatId = messages.reduce((messagesByChatId, message: ApiMessage) => {\n    if (!messagesByChatId[message.chatId]) {\n      messagesByChatId[message.chatId] = {};\n    }\n    messagesByChatId[message.chatId][message.id] = message;\n\n    return messagesByChatId;\n  }, {} as Record<string, Record<number, ApiMessage>>);\n\n  Object.keys(updatedByChatId).forEach((chatId) => {\n    const currentById = selectChatMessages(global, chatId) || {};\n    const newById = {\n      ...currentById,\n      ...updatedByChatId[chatId],\n    };\n    global = replaceChatMessages(global, chatId, newById);\n  });\n\n  return global;\n}\n\nexport function addChatMessagesById<T extends GlobalState>(\n  global: T, chatId: string, newById: Record<number, ApiMessage>,\n): T {\n  const byId = selectChatMessages(global, chatId);\n\n  if (byId && Object.keys(newById).every((newId) => Boolean(byId[Number(newId)]))) {\n    return global;\n  }\n\n  return replaceChatMessages(global, chatId, {\n    ...newById,\n    ...byId,\n  });\n}\n\nexport function updateChatMessage<T extends GlobalState>(\n  global: T, chatId: string, messageId: number, messageUpdate: Partial<ApiMessage>, withDeepCheck = false,\n): T {\n  const byId = selectChatMessages(global, chatId) || {};\n  const message = byId[messageId];\n\n  if (withDeepCheck && message) {\n    const updateKeys = Object.keys(messageUpdate) as (keyof ApiMessage)[];\n    if (areDeepEqual(pick(message, updateKeys), messageUpdate)) {\n      return global;\n    }\n  }\n\n  if (message && messageUpdate.isMediaUnread === false && hasMessageTtl(message)) {\n    if (message.content.voice) {\n      messageUpdate.content = {\n        action: {\n          mediaType: 'action',\n          type: 'expired',\n          isVoice: true,\n        },\n      };\n    } else if (message.content.video?.isRound) {\n      messageUpdate.content = {\n        action: {\n          mediaType: 'action',\n          type: 'expired',\n          isRoundVideo: true,\n        },\n      };\n    }\n  }\n\n  let text = message?.content?.text;\n  if (messageUpdate.content) {\n    const emojiOnlyCount = getEmojiOnlyCountForMessage(\n      messageUpdate.content, message?.groupedId || messageUpdate.groupedId,\n    );\n    text = messageUpdate.content.text ? addTimestampEntities(messageUpdate.content.text) : text;\n    if (text) text.emojiOnlyCount = emojiOnlyCount;\n  }\n\n  const updatedMessage = omitUndefined({\n    ...message,\n    ...messageUpdate,\n    text,\n  });\n\n  if (!updatedMessage.id) {\n    return global;\n  }\n\n  return replaceChatMessages(global, chatId, {\n    ...byId,\n    [messageId]: updatedMessage,\n  });\n}\n\nexport function updateScheduledMessage<T extends GlobalState>(\n  global: T, chatId: string, messageId: number, messageUpdate: Partial<ApiMessage>,\n): T {\n  const message = selectScheduledMessage(global, chatId, messageId)!;\n\n  let text = message?.content?.text;\n  if (messageUpdate.content) {\n    const emojiOnlyCount = getEmojiOnlyCountForMessage(\n      messageUpdate.content, message?.groupedId || messageUpdate.groupedId,\n    );\n    text = messageUpdate.content.text ? addTimestampEntities(messageUpdate.content.text) : text;\n    if (text) text.emojiOnlyCount = emojiOnlyCount;\n  }\n\n  const updatedMessage = {\n    ...message,\n    ...messageUpdate,\n    text,\n  };\n\n  if (!updatedMessage.id) {\n    return global;\n  }\n\n  return updateScheduledMessages(global, chatId, {\n    [messageId]: updatedMessage,\n  });\n}\n\nexport function updateQuickReplyMessage<T extends GlobalState>(\n  global: T, messageId: number, messageUpdate: Partial<ApiMessage>,\n): T {\n  const message = selectQuickReplyMessage(global, messageId);\n  const updatedMessage = {\n    ...message,\n    ...messageUpdate,\n  };\n\n  if (!updatedMessage.id) {\n    return global;\n  }\n\n  return updateQuickReplyMessages(global, {\n    [messageId]: updatedMessage,\n  });\n}\n\nexport function deleteQuickReplyMessages<T extends GlobalState>(\n  global: T, messageIds: number[],\n): T {\n  const byId = global.quickReplies.messagesById;\n  const newById = omit(byId, messageIds);\n  return {\n    ...global,\n    quickReplies: {\n      ...global.quickReplies,\n      messagesById: newById,\n    },\n  };\n}\n\nexport function deleteChatMessages<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  messageIds: number[],\n): T {\n  const byId = selectChatMessages(global, chatId);\n  if (!byId) {\n    return global;\n  }\n\n  orderHistoryIds(messageIds);\n  const updatedThreads = new Map<ThreadId, number[]>();\n  updatedThreads.set(MAIN_THREAD_ID, messageIds);\n\n  const mediaIdsToRemove: number[] = [];\n  messageIds.forEach((messageId) => {\n    const message = byId[messageId];\n    if (!message) return;\n    if (isMediaLoadableInViewer(message)) {\n      mediaIdsToRemove.push(messageId);\n    }\n    const threadId = selectThreadIdFromMessage(global, message);\n    if (!threadId || threadId === MAIN_THREAD_ID) {\n      return;\n    }\n    const threadMessages = updatedThreads.get(threadId) || [];\n    threadMessages.push(messageId);\n    updatedThreads.set(threadId, threadMessages);\n    global = clearMessageTranslation(global, chatId, messageId);\n  });\n\n  const deletedForwardedPosts = Object.values(pickTruthy(byId, messageIds)).filter(\n    ({ forwardInfo }) => forwardInfo?.isLinkedChannelPost,\n  );\n\n  updatedThreads.forEach((threadMessageIds, threadId) => {\n    const threadInfo = selectThreadInfo(global, chatId, threadId);\n\n    let listedIds = selectListedIds(global, chatId, threadId);\n    let pinnedIds = selectPinnedIds(global, chatId, threadId);\n    let outlyingLists = selectOutlyingLists(global, chatId, threadId);\n    let newMessageCount = threadInfo?.messagesCount;\n\n    if (listedIds) {\n      listedIds = excludeSortedArray(listedIds, threadMessageIds);\n    }\n\n    if (outlyingLists) {\n      outlyingLists = outlyingLists.map((list) => excludeSortedArray(list, threadMessageIds));\n    }\n\n    if (pinnedIds) {\n      pinnedIds = excludeSortedArray(pinnedIds, orderPinnedIds(threadMessageIds));\n    }\n\n    const nonLocalMessageCount = threadMessageIds.filter((id) => !isLocalMessageId(id)).length;\n    if (newMessageCount !== undefined) {\n      newMessageCount -= nonLocalMessageCount;\n    }\n\n    Object.values(global.byTabId).forEach(({ id: tabId }) => {\n      const tabState = selectTabState(global, tabId);\n      const activeDownloadsInChat = Object.entries(tabState.activeDownloads).filter(\n        ([, { originChatId, originMessageId }]) => originChatId === chatId && originMessageId,\n      );\n\n      activeDownloadsInChat.forEach(([mediaHash, context]) => {\n        if (messageIds.includes(context.originMessageId!)) {\n          global = cancelMessageMediaDownload(global, [mediaHash], tabId);\n        }\n      });\n\n      mediaIdsToRemove.forEach((mediaId) => {\n        global = removeIdFromSearchResults(global, chatId, threadId, mediaId, tabId);\n      });\n\n      const viewportIds = selectViewportIds(global, chatId, threadId, tabId);\n      if (!viewportIds) return;\n\n      const newViewportIds = excludeSortedArray(viewportIds, messageIds);\n      global = replaceTabThreadParam(\n        global,\n        chatId,\n        threadId,\n        'viewportIds',\n        newViewportIds.length === 0 ? undefined : newViewportIds,\n        tabId,\n      );\n    });\n\n    global = replaceThreadParam(global, chatId, threadId, 'listedIds', listedIds);\n    global = replaceThreadParam(global, chatId, threadId, 'outlyingLists', outlyingLists);\n    global = replaceThreadParam(global, chatId, threadId, 'pinnedIds', pinnedIds);\n\n    if (threadInfo && newMessageCount !== undefined) {\n      global = updateThreadInfo(global, chatId, threadId, {\n        messagesCount: newMessageCount,\n      });\n    }\n  });\n\n  if (deletedForwardedPosts.length) {\n    Object.values(global.byTabId).forEach(({ id: tabId }) => {\n      const currentMessageList = selectCurrentMessageList(global, tabId);\n      const canDeleteCurrentThread = currentMessageList && currentMessageList.chatId === chatId\n        && currentMessageList.type === 'thread';\n      const currentThreadId = currentMessageList?.threadId;\n\n      deletedForwardedPosts.forEach((message) => {\n        const { fromChatId, fromMessageId } = message.forwardInfo!;\n        const originalPost = selectChatMessage(global, fromChatId!, fromMessageId!);\n\n        if (canDeleteCurrentThread && currentThreadId === message.id) {\n          global = updateCurrentMessageList(global, chatId, undefined, undefined, undefined, undefined, tabId);\n        }\n        if (originalPost) {\n          global = updateThread(global, fromChatId!, fromMessageId!, undefined);\n        }\n      });\n    });\n  }\n\n  const newById = omit(byId, messageIds);\n  global = replaceChatMessages(global, chatId, newById);\n\n  return global;\n}\n\nexport function deleteChatScheduledMessages<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  messageIds: number[],\n): T {\n  const byId = selectChatScheduledMessages(global, chatId);\n  if (!byId) {\n    return global;\n  }\n  const newById = omit(byId, messageIds);\n\n  let scheduledIds = selectScheduledIds(global, chatId, MAIN_THREAD_ID);\n  if (scheduledIds) {\n    messageIds.forEach((messageId) => {\n      if (scheduledIds!.includes(messageId)) {\n        scheduledIds = scheduledIds!.filter((id) => id !== messageId);\n      }\n    });\n    global = replaceThreadParam(global, chatId, MAIN_THREAD_ID, 'scheduledIds', scheduledIds);\n\n    Object.entries(global.messages.byChatId[chatId].threadsById).forEach(([threadId, thread]) => {\n      if (thread.scheduledIds) {\n        const newScheduledIds = thread.scheduledIds.filter((id) => !messageIds.includes(id));\n        global = replaceThreadParam(global, chatId, Number(threadId), 'scheduledIds', newScheduledIds);\n      }\n    });\n  }\n\n  global = {\n    ...global,\n    scheduledMessages: {\n      byChatId: {\n        ...global.scheduledMessages.byChatId,\n        [chatId]: {\n          byId: newById,\n        },\n      },\n    },\n  };\n\n  return global;\n}\n\nexport function updateListedIds<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  idsUpdate: number[],\n): T {\n  const listedIds = selectListedIds(global, chatId, threadId);\n  const newIds = listedIds?.length\n    ? idsUpdate.filter((id) => !listedIds.includes(id))\n    : idsUpdate;\n\n  if (listedIds && !newIds.length) {\n    return global;\n  }\n\n  return replaceThreadParam(global, chatId, threadId, 'listedIds', orderHistoryIds([\n    ...(listedIds || []),\n    ...newIds,\n  ]));\n}\n\nexport function removeOutlyingList<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  list: number[],\n): T {\n  const outlyingLists = selectOutlyingLists(global, chatId, threadId);\n  if (!outlyingLists) {\n    return global;\n  }\n\n  const newOutlyingLists = outlyingLists.filter((l) => l !== list);\n\n  return replaceThreadParam(global, chatId, threadId, 'outlyingLists', newOutlyingLists);\n}\n\nexport function updateOutlyingLists<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  idsUpdate: number[],\n): T {\n  if (!idsUpdate.length) return global;\n\n  const outlyingLists = selectOutlyingLists(global, chatId, threadId);\n\n  const newOutlyingLists = mergeIdRanges(outlyingLists || [], idsUpdate);\n\n  return replaceThreadParam(global, chatId, threadId, 'outlyingLists', newOutlyingLists);\n}\n\nexport function addViewportId<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  newId: number,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const viewportIds = selectViewportIds(global, chatId, threadId, tabId) || [];\n  if (viewportIds.includes(newId)) {\n    return global;\n  }\n\n  const newIds = orderHistoryIds([\n    ...(\n      viewportIds.length < MESSAGE_LIST_VIEWPORT_LIMIT\n        ? viewportIds\n        : viewportIds.slice(-(MESSAGE_LIST_SLICE / 2))\n    ),\n    newId,\n  ]);\n\n  return replaceTabThreadParam(global, chatId, threadId, 'viewportIds', newIds, tabId);\n}\n\nexport function safeReplaceViewportIds<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  newViewportIds: number[],\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const currentIds = selectViewportIds(global, chatId, threadId, tabId) || [];\n  const newIds = orderHistoryIds(newViewportIds);\n\n  return replaceTabThreadParam(\n    global,\n    chatId,\n    threadId,\n    'viewportIds',\n    areSortedArraysEqual(currentIds, newIds) ? currentIds : newIds,\n    tabId,\n  );\n}\n\nexport function safeReplacePinnedIds<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  newPinnedIds: number[],\n): T {\n  const currentIds = selectPinnedIds(global, chatId, threadId) || [];\n  const newIds = orderPinnedIds(newPinnedIds);\n\n  return replaceThreadParam(\n    global,\n    chatId,\n    threadId,\n    'pinnedIds',\n    areSortedArraysEqual(currentIds, newIds) ? currentIds : newIds,\n  );\n}\n\nexport function updateThreadInfo<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId, update: Partial<ApiThreadInfo> | undefined,\n  doNotUpdateLinked?: boolean,\n): T {\n  const newThreadInfo = {\n    ...(selectThreadInfo(global, chatId, threadId) as ApiThreadInfo),\n    ...update,\n  } as ApiThreadInfo;\n\n  if (!doNotUpdateLinked && !newThreadInfo.isCommentsInfo) {\n    const linkedUpdate = pick(newThreadInfo, ['messagesCount', 'lastMessageId', 'lastReadInboxMessageId']);\n    if (newThreadInfo.fromChannelId && newThreadInfo.fromMessageId) {\n      global = updateThreadInfo(\n        global, newThreadInfo.fromChannelId, newThreadInfo.fromMessageId, linkedUpdate, true,\n      );\n    }\n  }\n\n  return replaceThreadParam(global, chatId, threadId, 'threadInfo', newThreadInfo);\n}\n\nexport function updateThreadInfos<T extends GlobalState>(\n  global: T, updates: Partial<ApiThreadInfo>[],\n): T {\n  updates.forEach((update) => {\n    global = updateThreadInfo(\n      global,\n      update.isCommentsInfo ? update.originChannelId! : update.chatId!,\n      update.isCommentsInfo ? update.originMessageId! : update.threadId!,\n      update,\n    );\n  });\n\n  return global;\n}\n\nexport function updateScheduledMessages<T extends GlobalState>(\n  global: T, chatId: string, newById: Record<number, ApiMessage>,\n): T {\n  const current = global.scheduledMessages.byChatId[chatId] || { byId: {}, hash: 0 };\n\n  return {\n    ...global,\n    scheduledMessages: {\n      byChatId: {\n        ...global.scheduledMessages.byChatId,\n        [chatId]: {\n          ...current,\n          byId: {\n            ...current.byId,\n            ...newById,\n          },\n        },\n      },\n    },\n  };\n}\n\nexport function updateQuickReplyMessages<T extends GlobalState>(\n  global: T, update: Record<number, ApiMessage>,\n): T {\n  return {\n    ...global,\n    quickReplies: {\n      ...global.quickReplies,\n      messagesById: {\n        ...global.quickReplies.messagesById,\n        ...update,\n      },\n    },\n  };\n}\n\nexport function updateFocusedMessage<T extends GlobalState>(\n  {\n    global,\n    chatId,\n    messageId,\n    threadId = MAIN_THREAD_ID,\n    noHighlight = false,\n    isResizingContainer = false,\n    quote,\n    quoteOffset,\n    scrollTargetPosition,\n  }: {\n    global: T;\n    chatId?: string;\n    messageId?: number;\n    threadId?: ThreadId;\n    noHighlight?: boolean;\n    isResizingContainer?: boolean;\n    quote?: string;\n    quoteOffset?: number;\n    scrollTargetPosition?: ScrollTargetPosition;\n  },\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    focusedMessage: {\n      ...selectTabState(global, tabId).focusedMessage,\n      chatId,\n      threadId,\n      messageId,\n      noHighlight,\n      isResizingContainer,\n      quote,\n      quoteOffset,\n      scrollTargetPosition,\n    },\n  }, tabId);\n}\n\nexport function updateSponsoredMessage<T extends GlobalState>(\n  global: T, chatId: string, message: ApiSponsoredMessage,\n): T {\n  return {\n    ...global,\n    messages: {\n      ...global.messages,\n      sponsoredByChatId: {\n        ...global.messages.sponsoredByChatId,\n        [chatId]: message,\n      },\n    },\n  };\n}\n\nexport function deleteSponsoredMessage<T extends GlobalState>(\n  global: T, chatId: string,\n): T {\n  const byChatId = global.messages.sponsoredByChatId;\n  if (!byChatId[chatId]) {\n    return global;\n  }\n\n  return {\n    ...global,\n    messages: {\n      ...global.messages,\n      sponsoredByChatId: omit(byChatId, [chatId]),\n    },\n  };\n}\n\nexport function updateFocusDirection<T extends GlobalState>(\n  global: T, direction?: FocusDirection,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    focusedMessage: {\n      ...selectTabState(global, tabId).focusedMessage,\n      direction,\n    },\n  }, tabId);\n}\n\nexport function enterMessageSelectMode<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  messageId?: number | number[],\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const messageIds = messageId ? Array.prototype.concat([], messageId) : [];\n\n  return updateTabState(global, {\n    selectedMessages: {\n      chatId,\n      messageIds,\n    },\n  }, tabId);\n}\n\nexport function toggleMessageSelection<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  messageListType: MessageListType,\n  messageId: number,\n  groupedId?: string,\n  childMessageIds?: number[],\n  withShift = false,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const { selectedMessages: oldSelectedMessages } = selectTabState(global, tabId);\n  if (groupedId) {\n    childMessageIds = selectMessageIdsByGroupId(global, chatId, groupedId);\n  }\n  const selectedMessageIds = childMessageIds || [messageId];\n  if (!oldSelectedMessages) {\n    return enterMessageSelectMode(global, chatId, selectedMessageIds, tabId);\n  }\n\n  const { messageIds } = oldSelectedMessages;\n\n  let newMessageIds;\n  const newSelectedMessageIds = selectedMessageIds.filter((id) => !messageIds.includes(id));\n  if (newSelectedMessageIds && !newSelectedMessageIds.length) {\n    newMessageIds = messageIds.filter((id) => !selectedMessageIds.includes(id));\n  } else if (withShift && messageIds.length) {\n    const viewportIds = selectCurrentMessageIds(global, chatId, threadId, messageListType, tabId)!;\n    const prevIndex = viewportIds.indexOf(messageIds[messageIds.length - 1]);\n    const currentIndex = viewportIds.indexOf(messageId);\n    const from = Math.min(prevIndex, currentIndex);\n    const to = Math.max(prevIndex, currentIndex);\n    const slice = viewportIds.slice(from, to + 1);\n    newMessageIds = unique([...messageIds, ...slice]);\n  } else {\n    newMessageIds = [...messageIds, ...newSelectedMessageIds];\n  }\n\n  if (!newMessageIds.length) {\n    return exitMessageSelectMode(global, tabId);\n  }\n\n  return updateTabState(global, {\n    selectedMessages: {\n      ...oldSelectedMessages,\n      messageIds: newMessageIds,\n    },\n  }, tabId);\n}\n\nexport function exitMessageSelectMode<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    selectedMessages: undefined,\n  }, tabId);\n}\n\nexport function updateThreadUnreadFromForwardedMessage<T extends GlobalState>(\n  global: T,\n  originMessage: ApiMessage,\n  chatId: string,\n  lastMessageId: number,\n  isDeleting?: boolean,\n): T {\n  const { channelPostId, fromChatId } = originMessage.forwardInfo || {};\n  if (channelPostId && fromChatId) {\n    const threadInfoOld = selectThreadInfo(global, chatId, channelPostId);\n    if (threadInfoOld) {\n      global = replaceThreadParam(global, chatId, channelPostId, 'threadInfo', {\n        ...threadInfoOld,\n        lastMessageId,\n        messagesCount: (threadInfoOld.messagesCount || 0) + (isDeleting ? -1 : 1),\n      });\n    }\n  }\n  return global;\n}\n\nexport function addActiveMediaDownload<T extends GlobalState>(\n  global: T,\n  mediaHash: string,\n  metadata: TabState['activeDownloads'][string],\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const tabState = selectTabState(global, tabId);\n\n  global = updateTabState(global, {\n    activeDownloads: {\n      ...tabState.activeDownloads,\n      [mediaHash]: metadata,\n    },\n  }, tabId);\n\n  return global;\n}\n\nexport function cancelMessageMediaDownload<T extends GlobalState>(\n  global: T,\n  mediaHashes: string[],\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const tabState = selectTabState(global, tabId);\n\n  const newActiveDownloads = omit(tabState.activeDownloads, mediaHashes);\n\n  global = updateTabState(global, {\n    activeDownloads: newActiveDownloads,\n  }, tabId);\n\n  return global;\n}\n\nexport function updateUploadByMessageKey<T extends GlobalState>(\n  global: T,\n  messageKey: MessageKey,\n  progress: number | undefined,\n) {\n  return {\n    ...global,\n    fileUploads: {\n      byMessageKey: progress !== undefined\n        ? {\n          ...global.fileUploads.byMessageKey,\n          [messageKey]: { progress },\n        }\n        : omit(global.fileUploads.byMessageKey, [messageKey]),\n    },\n  };\n}\n\nexport function updateQuickReplies<T extends GlobalState>(\n  global: T,\n  quickRepliesUpdate: Record<number, ApiQuickReply>,\n) {\n  return {\n    ...global,\n    quickReplies: {\n      ...global.quickReplies,\n      byId: {\n        ...global.quickReplies.byId,\n        ...quickRepliesUpdate,\n      },\n    },\n  };\n}\n\nexport function deleteQuickReply<T extends GlobalState>(\n  global: T,\n  quickReplyId: number,\n) {\n  return {\n    ...global,\n    quickReplies: {\n      ...global.quickReplies,\n      byId: omit(global.quickReplies.byId, [quickReplyId]),\n    },\n  };\n}\n\nexport function updateFullWebPage<T extends GlobalState>(\n  global: T,\n  webPageId: string,\n  update: Partial<ApiWebPageFull>,\n) {\n  const webpage = selectWebPage(global, webPageId);\n  const updatedWebpage = webpage?.webpageType === 'full'\n    ? { ...webpage, ...update }\n    : { webpageType: 'full', mediaType: 'webpage', ...update };\n\n  if (!updatedWebpage.id) {\n    return global;\n  }\n\n  return replaceWebPage(global, webPageId, updatedWebpage as ApiWebPageFull);\n}\n\nexport function replaceWebPage<T extends GlobalState>(\n  global: T,\n  webPageId: string,\n  webPage: ApiWebPage,\n) {\n  return {\n    ...global,\n    messages: {\n      ...global.messages,\n      webPageById: {\n        ...global.messages.webPageById,\n        [webPageId]: webPage,\n      },\n    },\n  };\n}\n\nexport function updatePoll<T extends GlobalState>(\n  global: T,\n  pollId: string,\n  pollUpdate: Partial<ApiPoll>,\n) {\n  const poll = selectPoll(global, pollId);\n\n  const oldResults = poll?.results;\n  let newResults = oldResults || pollUpdate.results;\n  if (poll && pollUpdate.results?.results) {\n    if (!poll.results || !pollUpdate.results.isMin) {\n      newResults = pollUpdate.results;\n    } else if (oldResults.results) {\n      // Update voters counts, but keep local `isChosen` values\n      newResults = {\n        ...pollUpdate.results,\n        results: pollUpdate.results.results.map((result) => ({\n          ...result,\n          isChosen: oldResults.results!.find((r) => r.option === result.option)?.isChosen,\n        })),\n        isMin: undefined,\n      };\n    }\n  }\n\n  const updatedPoll = {\n    ...poll,\n    ...pollUpdate,\n    results: newResults,\n  } satisfies ApiPoll;\n  if (!updatedPoll.id) {\n    return global;\n  }\n\n  return {\n    ...global,\n    messages: {\n      ...global.messages,\n      pollById: {\n        ...global.messages.pollById,\n        [pollId]: updatedPoll,\n      },\n    },\n  };\n}\n\nexport function updatePollVote<T extends GlobalState>(\n  global: T,\n  pollId: string,\n  peerId: string,\n  options: string[],\n) {\n  const poll = selectPoll(global, pollId);\n  if (!poll) {\n    return global;\n  }\n\n  const { recentVoterIds, totalVoters, results } = poll.results;\n  const newRecentVoterIds = recentVoterIds ? [...recentVoterIds] : [];\n  const newTotalVoters = totalVoters ? totalVoters + 1 : 1;\n  const newResults = results ? [...results] : [];\n\n  newRecentVoterIds.push(peerId);\n\n  options.forEach((option) => {\n    const targetOptionIndex = newResults.findIndex((result) => result.option === option);\n    const targetOption = newResults[targetOptionIndex];\n    const updatedOption: ApiPollResult = targetOption ? { ...targetOption } : { option, votersCount: 0 };\n\n    updatedOption.votersCount += 1;\n    if (peerId === global.currentUserId) {\n      updatedOption.isChosen = true;\n    }\n\n    if (targetOptionIndex) {\n      newResults[targetOptionIndex] = updatedOption;\n    } else {\n      newResults.push(updatedOption);\n    }\n  });\n\n  return updatePoll(global, pollId, {\n    results: {\n      ...poll.results,\n      recentVoterIds: newRecentVoterIds,\n      totalVoters: newTotalVoters,\n      results: newResults,\n    },\n  });\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"thumb\":\"gYSfUe37\",\"thumb-opaque\":\"vbcXDDxa\",\"thumbOpaque\":\"vbcXDDxa\",\"no-transition\":\"AvU_FtMd\",\"noTransition\":\"AvU_FtMd\",\"media\":\"RrEzFxte\"};","import type { ElementRef, FC } from '../../lib/teact/teact';\nimport { memo, useMemo, useRef } from '../../lib/teact/teact';\nimport { getGlobal } from '../../global';\n\nimport type { ApiSticker } from '../../api/types';\nimport type { ObserveFn } from '../../hooks/useIntersectionObserver';\n\nimport { getStickerMediaHash } from '../../global/helpers';\nimport { selectIsAlwaysHighPriorityEmoji } from '../../global/selectors';\nimport { IS_ANDROID, IS_IOS, IS_WEBM_SUPPORTED } from '../../util/browser/windowEnvironment';\nimport buildClassName from '../../util/buildClassName';\nimport * as mediaLoader from '../../util/mediaLoader';\n\nimport useThumbnail from '../../hooks/media/useThumbnail';\nimport useColorFilter from '../../hooks/stickers/useColorFilter';\nimport useCoordsInSharedCanvas from '../../hooks/useCoordsInSharedCanvas';\nimport useFlag from '../../hooks/useFlag';\nimport { useIsIntersecting } from '../../hooks/useIntersectionObserver';\nimport useMedia from '../../hooks/useMedia';\nimport useMediaTransition from '../../hooks/useMediaTransition';\nimport useMountAfterHeavyAnimation from '../../hooks/useMountAfterHeavyAnimation';\nimport useUniqueId from '../../hooks/useUniqueId';\nimport useDevicePixelRatio from '../../hooks/window/useDevicePixelRatio';\n\nimport OptimizedVideo from '../ui/OptimizedVideo';\nimport AnimatedSticker from './AnimatedSticker';\n\nimport styles from './StickerView.module.scss';\n\ntype OwnProps = {\n  containerRef: ElementRef<HTMLDivElement>;\n  sticker: ApiSticker;\n  thumbClassName?: string;\n  fullMediaHash?: string;\n  fullMediaClassName?: string;\n  isSmall?: boolean;\n  size?: number;\n  customColor?: string;\n  loopLimit?: number;\n  shouldLoop?: boolean;\n  shouldPreloadPreview?: boolean;\n  forceAlways?: boolean;\n  forceOnHeavyAnimation?: boolean;\n  observeIntersectionForLoading?: ObserveFn;\n  observeIntersectionForPlaying?: ObserveFn;\n  noLoad?: boolean;\n  noPlay?: boolean;\n  noVideoOnMobile?: boolean;\n  withSharedAnimation?: boolean;\n  sharedCanvasRef?: ElementRef<HTMLCanvasElement>;\n  withTranslucentThumb?: boolean; // With shared canvas thumbs are opaque by default to provide better transition effect\n  onVideoEnded?: AnyToVoidFunction;\n  onAnimatedStickerLoop?: AnyToVoidFunction;\n};\n\nconst SHARED_PREFIX = 'shared';\nconst STICKER_SIZE = 24;\n\nconst StickerView: FC<OwnProps> = ({\n  containerRef,\n  sticker,\n  thumbClassName,\n  fullMediaHash,\n  fullMediaClassName,\n  isSmall,\n  size = STICKER_SIZE,\n  customColor,\n  loopLimit,\n  shouldLoop = false,\n  shouldPreloadPreview,\n  forceAlways,\n  forceOnHeavyAnimation,\n  observeIntersectionForLoading,\n  observeIntersectionForPlaying,\n  noLoad,\n  noPlay,\n  noVideoOnMobile,\n  withSharedAnimation,\n  withTranslucentThumb,\n  sharedCanvasRef,\n  onVideoEnded,\n  onAnimatedStickerLoop,\n}) => {\n  const {\n    id, isLottie, stickerSetInfo, emoji,\n  } = sticker;\n  const [isVideoBroken, markVideoBroken] = useFlag();\n  const isUnsupportedVideo = sticker.isVideo && (\n    !IS_WEBM_SUPPORTED\n    || (noVideoOnMobile && (IS_IOS || IS_ANDROID))\n  );\n  const isVideo = sticker.isVideo;\n  const isStatic = !isLottie && !isVideo;\n  const previewMediaHash = getStickerMediaHash(sticker, 'preview');\n\n  const dpr = useDevicePixelRatio();\n\n  const filterStyle = useColorFilter(customColor);\n\n  const isIntersectingForLoading = useIsIntersecting(containerRef, observeIntersectionForLoading);\n  const shouldLoad = isIntersectingForLoading && !noLoad;\n  const isIntersectingForPlaying = (\n    useIsIntersecting(containerRef, observeIntersectionForPlaying)\n    && isIntersectingForLoading\n  );\n  const shouldPlay = isIntersectingForPlaying && !noPlay;\n  const hasIntersectedForPlayingRef = useRef(isIntersectingForPlaying);\n  if (!hasIntersectedForPlayingRef.current && isIntersectingForPlaying) {\n    hasIntersectedForPlayingRef.current = true;\n  }\n\n  const cachedPreview = mediaLoader.getFromMemory(previewMediaHash);\n  const isReadyToMountFullMedia = useMountAfterHeavyAnimation(hasIntersectedForPlayingRef.current);\n  const shouldForcePreview = isUnsupportedVideo || (isStatic ? isSmall : noPlay);\n  const shouldLoadPreview = !customColor && !cachedPreview && (!isReadyToMountFullMedia || shouldForcePreview);\n  const previewMediaData = useMedia(previewMediaHash, !shouldLoadPreview);\n  const withPreview = shouldLoadPreview || cachedPreview;\n\n  const shouldSkipLoadingFullMedia = Boolean(shouldForcePreview || (\n    fullMediaHash === previewMediaHash && (cachedPreview || previewMediaData)\n  ));\n  const fullMediaData = useMedia(fullMediaHash || `sticker${id}`, !shouldLoad || shouldSkipLoadingFullMedia);\n  const shouldRenderFullMedia = isReadyToMountFullMedia && Boolean(fullMediaData) && !isVideoBroken;\n  const [isPlayerReady, markPlayerReady] = useFlag();\n  const isFullMediaReady = shouldRenderFullMedia && (isStatic || isPlayerReady);\n\n  const thumbDataUri = useThumbnail(sticker.thumbnail);\n  const thumbData = cachedPreview || previewMediaData || thumbDataUri;\n  const isThumbOpaque = sharedCanvasRef && !withTranslucentThumb;\n\n  const noCrossTransition = Boolean(isLottie && withPreview);\n  const { ref: thumbRef } = useMediaTransition<HTMLImageElement>({\n    hasMediaData: Boolean(thumbData && !isFullMediaReady),\n    noCloseTransition: noCrossTransition,\n  });\n  const { ref: fullMediaRef } = useMediaTransition<HTMLElement>({\n    hasMediaData: isFullMediaReady,\n    noOpenTransition: noCrossTransition,\n  });\n\n  const coords = useCoordsInSharedCanvas(containerRef, sharedCanvasRef);\n\n  // Preload preview for Message Input and local message\n  useMedia(previewMediaHash, !shouldLoad || !shouldPreloadPreview);\n\n  const randomIdPrefix = useUniqueId();\n  const renderId = useMemo(() => ([\n    (withSharedAnimation ? SHARED_PREFIX : randomIdPrefix),\n    id,\n    size,\n    (withSharedAnimation ? customColor : undefined),\n    dpr,\n  ].filter(Boolean).join('_')\n  ), [id, size, customColor, dpr, withSharedAnimation, randomIdPrefix]);\n\n  return (\n    <>\n      <img\n        ref={thumbRef}\n        src={thumbData}\n        className={buildClassName(\n          styles.thumb,\n          noCrossTransition && styles.noTransition,\n          isThumbOpaque && styles.thumbOpaque,\n          thumbClassName,\n          'sticker-media',\n        )}\n        style={filterStyle}\n        alt=\"\"\n        draggable={false}\n      />\n      {shouldRenderFullMedia && (isLottie ? (\n        <AnimatedSticker\n          ref={fullMediaRef as ElementRef<HTMLDivElement>}\n          key={renderId}\n          renderId={renderId}\n          size={size}\n          className={buildClassName(\n            styles.media,\n            (noCrossTransition || isThumbOpaque) && styles.noTransition,\n            fullMediaClassName,\n          )}\n          tgsUrl={fullMediaData}\n          play={shouldPlay}\n          noLoop={!shouldLoop}\n          forceOnHeavyAnimation={forceAlways || forceOnHeavyAnimation}\n          forceAlways={forceAlways}\n          isLowPriority={isSmall && !selectIsAlwaysHighPriorityEmoji(getGlobal(), stickerSetInfo)}\n          sharedCanvas={sharedCanvasRef?.current || undefined}\n          sharedCanvasCoords={coords}\n          onLoad={markPlayerReady}\n          onLoop={onAnimatedStickerLoop}\n          onEnded={onAnimatedStickerLoop}\n          color={customColor}\n        />\n      ) : isVideo ? (\n        <OptimizedVideo\n          ref={fullMediaRef as ElementRef<HTMLVideoElement>}\n          canPlay={shouldPlay}\n          className={buildClassName(styles.media, fullMediaClassName, 'sticker-media')}\n          src={fullMediaData}\n          playsInline\n          muted\n          loop={shouldLoop && !loopLimit}\n          isPriority={forceAlways}\n          disablePictureInPicture\n          onReady={markPlayerReady}\n          onBroken={markVideoBroken}\n          onEnded={onVideoEnded}\n          style={filterStyle}\n        />\n      ) : (\n        <img\n          ref={fullMediaRef as ElementRef<HTMLImageElement>}\n          className={buildClassName(styles.media, fullMediaClassName, 'sticker-media')}\n          src={fullMediaData}\n          alt={emoji}\n          style={filterStyle}\n          draggable={false}\n        />\n      ))}\n    </>\n  );\n};\n\nexport default memo(StickerView);\n","import { getIsHeavyAnimating, useEffect, useSignal } from '../lib/teact/teact';\n\nimport useDerivedState from './useDerivedState';\n\nexport default function useMountAfterHeavyAnimation(hasIntersected: boolean) {\n  const [getNoHeavyAnimation, setNoHeavyAnimation] = useSignal(false);\n\n  const $getIsHeavyAnimating = getIsHeavyAnimating;\n\n  // Animation is usually started right after the mount, so we use effect to check for it on the next frame\n  useEffect(() => {\n    if (!$getIsHeavyAnimating()) {\n      setNoHeavyAnimation(true);\n    }\n  }, [$getIsHeavyAnimating, setNoHeavyAnimation]);\n\n  return useDerivedState(() => (getNoHeavyAnimation() && hasIntersected), [getNoHeavyAnimation, hasIntersected]);\n}\n","import useShowTransitionDeprecated from './useShowTransitionDeprecated';\n\nexport default function useMediaTransitionDeprecated(mediaData?: unknown) {\n  const isMediaReady = Boolean(mediaData);\n  const { transitionClassNames } = useShowTransitionDeprecated(isMediaReady, undefined, isMediaReady, 'slow');\n\n  return transitionClassNames;\n}\n","import { useSignal } from '../lib/teact/teact';\n\nimport type { Signal } from '../util/signals';\n\nimport { useSignalEffect } from './useSignalEffect';\nimport { useStateRef } from './useStateRef';\nimport useSyncEffect from './useSyncEffect';\n\ntype SyncResolver<T> = () => T;\ntype AsyncResolver<T> = (setter: (newValue: T) => void) => void;\ntype Resolver<T> =\n  SyncResolver<T>\n  | AsyncResolver<T>;\n\nfunction useDerivedSignal<T>(resolver: SyncResolver<T>, dependencies: readonly any[]): Signal<T>;\nfunction useDerivedSignal<T>(resolver: AsyncResolver<T>, dependencies: readonly any[], isAsync: true): Signal<T>;\nfunction useDerivedSignal<T>(dependency: T): Signal<T>;\n\nfunction useDerivedSignal<T>(resolverOrDependency: Resolver<T> | T, dependencies?: readonly any[], isAsync = false) {\n  const resolver = dependencies ? resolverOrDependency as Resolver<T> : () => (resolverOrDependency as T);\n  dependencies ??= [resolverOrDependency];\n\n  const [getValue, setValue] = useSignal<T>();\n  const resolverRef = useStateRef(resolver);\n\n  function runCurrentResolver() {\n    const currentResolver = resolverRef.current;\n    if (isAsync) {\n      (currentResolver as AsyncResolver<T>)(setValue);\n    } else {\n      setValue((currentResolver as SyncResolver<T>)());\n    }\n  }\n\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  useSyncEffect(runCurrentResolver, dependencies);\n\n  useSignalEffect(runCurrentResolver, dependencies);\n\n  return getValue as Signal<T>;\n}\n\nexport default useDerivedSignal;\n","import type { TeactNode } from '../../lib/teact/teact';\n\nimport type {\n  ApiLanguage,\n  LangPackStringValue,\n  LangPackStringValueDeleted,\n  LangPackStringValuePlural,\n  LangPackStringValueRegular,\n} from '../../api/types';\nimport type { TextFilter } from '../../components/common/helpers/renderText';\nimport type {\n  LangPairPluralWithVariables,\n  LangPairWithVariables,\n  LangVariable,\n  PluralLangKey,\n  PluralLangKeyWithVariables,\n  RegularLangKey,\n  RegularLangKeyWithVariables,\n} from '../../types/language';\n\nexport interface LangFnOptionsRegular {\n  withNodes?: never;\n  withMarkdown?: never;\n  pluralValue?: never;\n}\n\nexport type LangFnOptionsWithPlural = Omit<LangFnOptionsRegular, 'pluralValue'> & {\n  pluralValue: number;\n};\n\nexport type LangFnOptions = LangFnOptionsRegular | LangFnOptionsWithPlural;\n\nexport interface AdvancedLangFnOptionsRegular {\n  withNodes: true;\n  withMarkdown?: boolean;\n  pluralValue?: never;\n  renderTextFilters?: TextFilter[];\n  specialReplacement?: Record<string, TeactNode>;\n}\n\nexport type AdvancedLangFnOptionsWithPlural = Omit<AdvancedLangFnOptionsRegular, 'pluralValue'> & {\n  pluralValue: number;\n};\n\nexport type AdvancedLangFnOptions = AdvancedLangFnOptionsRegular | AdvancedLangFnOptionsWithPlural;\n\ntype LangPairWithNodes = LangPairWithVariables<TeactNode | undefined>;\ntype LangPairPluralWithNodes = LangPairPluralWithVariables<TeactNode | undefined>;\n\ntype RegularLangFnParametersWithoutVariables = {\n  key: RegularLangKey;\n  variables?: undefined;\n  options?: LangFnOptions;\n};\n\ntype RegularLangFnParametersWithVariables<T = LangPairWithVariables> = {\n  [K in keyof T]: {\n    key: K;\n    variables: {\n      [key in keyof T[K]]: LangVariable | RegularLangFnParameters;\n    };\n    options?: LangFnOptions;\n  }\n}[keyof T];\n\ntype RegularLangFnPluralParameters = {\n  key: PluralLangKey;\n  variables?: undefined;\n  options: LangFnOptionsWithPlural;\n};\n\ntype RegularLangFnPluralParametersWithVariables<T = LangPairPluralWithVariables> = {\n  [K in keyof T]: {\n    key: K;\n    variables: {\n      [key in keyof T[K]]: LangVariable | RegularLangFnParameters;\n    };\n    options: LangFnOptionsWithPlural;\n  }\n}[keyof T];\n\nexport type RegularLangFnParameters =\n  | RegularLangFnParametersWithoutVariables\n  | RegularLangFnParametersWithVariables\n  | RegularLangFnPluralParameters\n  | RegularLangFnPluralParametersWithVariables;\n\ntype AdvancedLangFnParametersWithoutVariables = {\n  key: RegularLangKey;\n  variables?: undefined;\n  options: AdvancedLangFnOptions;\n};\n\ntype AdvancedLangFnParametersWithVariables<T = LangPairWithNodes> = {\n  [K in keyof T]: {\n    key: K;\n    variables: T[K];\n    options: AdvancedLangFnOptions;\n  }\n}[keyof T];\n\ntype AdvancedLangFnPluralParameters = {\n  key: PluralLangKey;\n  variables?: undefined;\n  options: AdvancedLangFnOptionsWithPlural;\n};\n\ntype AdvancedLangFnPluralParametersWithVariables<T = LangPairPluralWithNodes> = {\n  [K in keyof T]: {\n    key: K;\n    variables: T[K];\n    options: AdvancedLangFnOptionsWithPlural;\n  }\n}[keyof T];\n\nexport type AdvancedLangFnParameters =\n  | AdvancedLangFnParametersWithoutVariables\n  | AdvancedLangFnParametersWithVariables\n  | AdvancedLangFnPluralParameters\n  | AdvancedLangFnPluralParametersWithVariables;\n\nexport type LangFnParameters = RegularLangFnParameters | AdvancedLangFnParameters;\n\nexport type LangFn = {\n  <K extends RegularLangKey = RegularLangKey>(\n    key: K, variables?: undefined, options?: LangFnOptions,\n  ): string;\n  <K extends PluralLangKey = PluralLangKey>(\n    key: K, variables: undefined, options: LangFnOptionsWithPlural,\n  ): string;\n  <K extends RegularLangKeyWithVariables = RegularLangKeyWithVariables>(\n    key: K, variables: LangPairWithVariables[K], options?: LangFnOptions,\n  ): string;\n  <K extends PluralLangKeyWithVariables = PluralLangKeyWithVariables>(\n    key: K, variables: LangPairPluralWithVariables[K], options: LangFnOptionsWithPlural,\n  ): string;\n\n  <K extends RegularLangKey = RegularLangKey>(\n    key: K, variables?: undefined, options?: AdvancedLangFnOptions,\n  ): TeactNode;\n  <K extends PluralLangKey = PluralLangKey>(\n    key: K, variables: undefined, options: AdvancedLangFnOptionsWithPlural,\n  ): TeactNode;\n  <K extends RegularLangKeyWithVariables = RegularLangKeyWithVariables>(\n    key: K, variables: LangPairWithVariables<TeactNode | undefined>[K], options: AdvancedLangFnOptions,\n  ): TeactNode;\n  <K extends PluralLangKeyWithVariables = PluralLangKeyWithVariables>(\n    key: K, variables: LangPairPluralWithVariables<TeactNode | undefined>[K], options: AdvancedLangFnOptionsWithPlural,\n  ): TeactNode;\n\n  with: (params: LangFnParameters) => TeactNode;\n  withRegular: (params: RegularLangFnParameters) => string;\n  withAdvanced: (params: AdvancedLangFnParameters) => TeactNode;\n  region: (code: string) => string | undefined;\n  conjunction: (list: string[]) => string;\n  disjunction: (list: string[]) => string;\n  number: (value: number) => string;\n  preciseNumber: (value: number) => string;\n  internalFormatters: LangFormatters;\n  isRtl?: boolean;\n  rawCode: string;\n  code: string;\n  languageInfo: ApiLanguage;\n};\n\n// Allow basic polyfill\ntype ListFormat = Pick<Intl.ListFormat, 'format' | 'formatToParts'>;\n\nexport type LangFormatters = {\n  pluralRules: Intl.PluralRules;\n  region: Intl.DisplayNames;\n  conjunction: ListFormat;\n  disjunction: ListFormat;\n  number: Intl.NumberFormat;\n  preciseNumber: Intl.NumberFormat;\n};\n\n/* GUARDS */\n\nexport function isDeletedLangString(string: LangPackStringValue): string is LangPackStringValueDeleted {\n  return typeof string === 'object' && 'isDeleted' in string;\n}\n\nexport function isRegularLangString(string: LangPackStringValue): string is LangPackStringValueRegular {\n  return typeof string === 'string';\n}\n\nexport function isPluralLangString(string: LangPackStringValue): string is LangPackStringValuePlural {\n  return !isRegularLangString(string) && !isDeletedLangString(string);\n}\n\nexport function isLangFnParam(object: unknown): object is LangFnParameters {\n  return Boolean(object) && typeof object === 'object' && 'key' in object! && !('type' in object);\n}\n\nexport function areAdvancedLangFnOptions(\n  params: LangFnOptions | AdvancedLangFnOptions,\n): params is AdvancedLangFnOptions {\n  return 'withNodes' in params && Boolean(params.withNodes);\n}\n","import type React from '../lib/teact/teact';\n\nconst stopEvent = (e: React.UIEvent | Event | React.FormEvent) => {\n  e.stopPropagation();\n  e.preventDefault();\n};\n\nexport default stopEvent;\n","import { throttle } from './schedulers';\n\nconst KEYS_TO_IGNORE = new Set([\n  'TeactMemoWrapper renders',\n  'TeactNContainer renders',\n  'Button renders',\n]);\nconst MIN_RENDERS_TO_SHOW = 5;\nconst MIN_DURATION_TO_SHOW = 2;\nconst BG_GREEN = ' style=\"background: lightgreen\"';\n\nlet counters: Record<string, {\n  value: number;\n  lastUpdateAt: number;\n}> = {};\n\nconst renderCountersThrottled = throttle(renderCounters, 500, false);\n\nlet loggerEl: HTMLDivElement;\n\nexport function debugToOverlay(text: string) {\n  if (!loggerEl) {\n    setupOverlay();\n  }\n\n  const date = new Date();\n  const dateFormatted = `${date.toLocaleTimeString()}.${date.getMilliseconds()}`;\n  const wasAtBottom = loggerEl.scrollTop + 10 >= loggerEl.scrollHeight - loggerEl.offsetHeight;\n\n  loggerEl.innerHTML += `${dateFormatted}: ${text}<br/>`;\n\n  if (wasAtBottom) {\n    loggerEl.scrollTop = loggerEl.scrollHeight;\n  }\n}\n\nexport function incrementOverlayCounter(key: string, value = 1) {\n  const now = Date.now();\n  if (!counters[key]) {\n    counters[key] = { value, lastUpdateAt: now };\n  } else {\n    counters[key].value += value;\n    counters[key].lastUpdateAt = now;\n  }\n\n  renderCountersThrottled();\n}\n\nexport function renderCounters() {\n  if (!loggerEl) {\n    setupOverlay();\n  }\n\n  const halfSecondAgo = Date.now() - 500;\n  const [maxRenders, maxDuration] = Object.entries(counters).reduce((acc, [key, { value }]) => {\n    if (KEYS_TO_IGNORE.has(key)) {\n      return acc;\n    }\n\n    if (key.includes('renders') && value > acc[0]) {\n      acc[0] = value;\n    }\n\n    if (key.includes('duration') && value > acc[1]) {\n      acc[1] = value;\n    }\n\n    return acc;\n  }, [0, 0]);\n\n  loggerEl.innerHTML = Object\n    .entries(counters)\n    .filter(([key, { value }]) => (\n      (!KEYS_TO_IGNORE.has(key)) && (\n        (key.includes('renders') && value > MIN_RENDERS_TO_SHOW)\n        || (key.includes('duration') && value > MIN_DURATION_TO_SHOW)\n      )\n    ))\n    .sort((a, b) => (\n      b[1].lastUpdateAt - a[1].lastUpdateAt\n    ))\n    .map(([key, { value, lastUpdateAt }]) => ([\n      `<div style=\"background: #ff0000${factorToHex(value / (key.includes('renders') ? maxRenders : maxDuration))}\">`,\n      `  <span${lastUpdateAt > halfSecondAgo ? BG_GREEN : ''}>${key}: ${Math.round(value)}</span>`,\n      '</div>',\n    ].join('\\n')))\n    .join('\\n');\n}\n\nfunction setupOverlay() {\n  loggerEl = document.createElement('div');\n  loggerEl.style.cssText = 'position: absolute; left: 0; bottom: 25px; z-index: 9998; width: 260px; height: 200px;'\n    + ' border: 1px solid #555; background: rgba(255, 255, 255, 0.9); overflow: auto; font-size: 10px;';\n  document.body.appendChild(loggerEl);\n\n  const clearEl = document.createElement('a');\n  clearEl.style.cssText = 'position: absolute; left: 222px; bottom: 198px; z-index: 9999; font-size: 20px; '\n    + 'cursor: pointer;';\n  clearEl.innerText = '';\n  clearEl.addEventListener('click', () => {\n    counters = {};\n    renderCountersThrottled();\n  });\n  document.body.appendChild(clearEl);\n}\n\nfunction factorToHex(factor: number) {\n  return Math.round(255 * factor).toString(16).padStart(2, '0');\n}\n","import type { ReactElement } from 'react';\n\nimport { DEBUG, DEBUG_MORE } from '../../config';\nimport { logUnequalProps } from '../../util/arePropsShallowEqual';\nimport { incrementOverlayCounter } from '../../util/debugOverlay';\nimport { orderBy } from '../../util/iteratees';\nimport safeExec from '../../util/safeExec';\nimport { throttleWith } from '../../util/schedulers';\nimport { createSignal, isSignal, type Signal } from '../../util/signals';\nimport { requestMeasure, requestMutation } from '../fasterdom/fasterdom';\nimport { getIsBlockingAnimating } from './heavyAnimation';\n\nexport { getIsHeavyAnimating, beginHeavyAnimation, onFullyIdle } from './heavyAnimation';\n\nexport type Props = AnyLiteral;\nexport type FC<P extends Props = any> = (props: P) => any;\nexport type FC_withDebug =\n  FC\n  & { DEBUG_contentComponentName?: string };\n\nexport enum VirtualType {\n  Empty,\n  Text,\n  Tag,\n  Component,\n  Fragment,\n}\n\ninterface VirtualElementEmpty {\n  type: VirtualType.Empty;\n  target?: Node;\n}\n\ninterface VirtualElementText {\n  type: VirtualType.Text;\n  target?: Node;\n  value: string;\n}\n\nexport interface VirtualElementTag {\n  type: VirtualType.Tag;\n  target?: HTMLElement | SVGElement;\n  tag: string;\n  props: Props;\n  children: VirtualElementChildren;\n}\n\nexport interface VirtualElementComponent {\n  type: VirtualType.Component;\n  componentInstance: ComponentInstance;\n  props: Props;\n  children: VirtualElementChildren;\n}\n\nexport interface VirtualElementFragment {\n  type: VirtualType.Fragment;\n  children: VirtualElementChildren;\n  placeholderTarget?: Comment;\n}\n\nexport type StateHookSetter<T> = (newValue: ((current: T) => T) | T) => void;\n\nexport interface RefObject<T = unknown> {\n  current: T;\n  onChange?: NoneToVoidFunction;\n}\n\nexport type ElementRef<T = HTMLElement> = RefObject<T | undefined>;\n\nexport enum MountState {\n  Mounting,\n  Mounted,\n  Unmounted,\n}\n\ninterface ComponentInstance {\n  id: number;\n  $element: VirtualElementComponent;\n  Component: FC;\n  name: string;\n  props: Props;\n  renderedValue?: any;\n  mountState: MountState;\n  context?: Record<string, Signal<unknown>>;\n  hooks?: {\n    state?: {\n      cursor: number;\n      byCursor: {\n        value: any;\n        nextValue: any;\n        setter: StateHookSetter<any>;\n      }[];\n    };\n    effects?: {\n      cursor: number;\n      byCursor: {\n        dependencies?: readonly unknown[];\n        schedule?: NoneToVoidFunction;\n        cleanup?: NoneToVoidFunction;\n        releaseSignals?: NoneToVoidFunction;\n      }[];\n    };\n    memos?: {\n      cursor: number;\n      byCursor: {\n        value: any;\n        dependencies: readonly unknown[];\n      }[];\n    };\n    refs?: {\n      cursor: number;\n      byCursor: RefObject[];\n    };\n  };\n  prepareForFrame?: () => void;\n  forceUpdate?: () => void;\n  onUpdate?: () => void;\n}\n\nexport type VirtualElement =\n  VirtualElementEmpty\n  | VirtualElementText\n  | VirtualElementTag\n  | VirtualElementComponent\n  | VirtualElementFragment;\nexport type VirtualElementParent =\n  VirtualElementTag\n  | VirtualElementComponent\n  | VirtualElementFragment;\nexport type VirtualElementChildren = VirtualElement[];\nexport type VirtualElementReal = Exclude<VirtualElement, VirtualElementComponent | VirtualElementFragment>;\n\n// Compatibility with JSX types\nexport type TeactNode =\n  ReactElement\n  | string\n  | number\n  | boolean\n  | TeactNode[];\n\ntype Effect = () => (NoneToVoidFunction | void);\ntype EffectCleanup = NoneToVoidFunction;\n\nexport type Context<T> = {\n  defaultValue?: T;\n  contextId: string;\n  Provider: FC<{ value: T; children: TeactNode }>;\n};\n\nconst Fragment = Symbol('Fragment') as unknown as FC<{ children: TeactNode }>;\n\nconst DEBUG_RENDER_THRESHOLD = 7;\nconst DEBUG_EFFECT_THRESHOLD = 7;\nconst DEBUG_SILENT_RENDERS_FOR = new Set(['TeactMemoWrapper', 'TeactNContainer', 'Button', 'ListItem', 'MenuItem']);\n\nlet contextCounter = 0;\n\nlet lastComponentId = 0;\nlet renderingInstance: ComponentInstance;\n\nexport function isParentElement($element: VirtualElement): $element is VirtualElementParent {\n  return (\n    $element.type === VirtualType.Tag\n    || $element.type === VirtualType.Component\n    || $element.type === VirtualType.Fragment\n  );\n}\n\nfunction createElement(\n  source: string | FC | typeof Fragment,\n  props: Props,\n  ...children: any[]\n): VirtualElementParent | VirtualElementChildren {\n  if (source === Fragment) {\n    return buildFragmentElement(children);\n  } else if (typeof source === 'function') {\n    return createComponentInstance(source, props || {}, children);\n  } else {\n    return buildTagElement(source, props || {}, children);\n  }\n}\n\nfunction buildFragmentElement(children: any[]): VirtualElementFragment {\n  return {\n    type: VirtualType.Fragment,\n    children: buildChildren(children, true),\n  };\n}\n\nfunction createComponentInstance(Component: FC, props: Props, children: any[]): VirtualElementComponent {\n  if (children?.length) {\n    props.children = children.length === 1 ? children[0] : children;\n  }\n\n  const componentInstance: ComponentInstance = {\n    id: -1,\n    $element: undefined as unknown as VirtualElementComponent,\n    Component,\n    name: Component.name,\n    props,\n    mountState: MountState.Unmounted,\n  };\n\n  componentInstance.$element = buildComponentElement(componentInstance);\n\n  return componentInstance.$element;\n}\n\nfunction buildComponentElement(\n  componentInstance: ComponentInstance,\n  children?: VirtualElementChildren,\n): VirtualElementComponent {\n  return {\n    type: VirtualType.Component,\n    componentInstance,\n    props: componentInstance.props,\n    children: children ? buildChildren(children, true) : [],\n  };\n}\n\nfunction buildTagElement(tag: string, props: Props, children: any[]): VirtualElementTag {\n  return {\n    type: VirtualType.Tag,\n    tag,\n    props,\n    children: buildChildren(children),\n  };\n}\n\nfunction buildChildren(children: any[], noEmpty = false): VirtualElement[] {\n  const cleanChildren = dropEmptyTail(children, noEmpty);\n  const newChildren = [];\n\n  for (let i = 0, l = cleanChildren.length; i < l; i++) {\n    const child = cleanChildren[i];\n    if (Array.isArray(child)) {\n      newChildren.push(...buildChildren(child, noEmpty));\n    } else {\n      newChildren.push(buildChildElement(child));\n    }\n  }\n\n  return newChildren;\n}\n\n// We only need placeholders in the middle of collection (to ensure other elements order).\nfunction dropEmptyTail(children: any[], noEmpty = false) {\n  let i = children.length - 1;\n\n  for (; i >= 0; i--) {\n    if (!isEmptyPlaceholder(children[i])) {\n      break;\n    }\n  }\n\n  if (i === children.length - 1) {\n    return children;\n  }\n\n  if (i === -1 && noEmpty) {\n    return children.slice(0, 1);\n  }\n\n  return children.slice(0, i + 1);\n}\n\nfunction isEmptyPlaceholder(child: any) {\n  return !child && child !== 0;\n}\n\nfunction buildChildElement(child: any): VirtualElement {\n  if (isEmptyPlaceholder(child)) {\n    return { type: VirtualType.Empty };\n  } else if (isParentElement(child)) {\n    return child;\n  } else {\n    return {\n      type: VirtualType.Text,\n      value: String(child),\n    };\n  }\n}\n\nconst DEBUG_components: AnyLiteral = { TOTAL: { name: 'TOTAL', renders: 0 } };\nconst DEBUG_memos: Record<string, { key: string; calls: number; misses: number; hitRate: number }> = {};\nconst DEBUG_MEMOS_CALLS_THRESHOLD = 20;\n\ndocument.addEventListener('dblclick', () => {\n  // eslint-disable-next-line no-console\n  console.warn('COMPONENTS', orderBy(\n    Object\n      .values(DEBUG_components)\n      .map(({ avgRenderTime, ...state }) => {\n        return { ...state, ...(avgRenderTime !== undefined && { avgRenderTime: Number(avgRenderTime.toFixed(2)) }) };\n      }),\n    'renders',\n    'desc',\n  ));\n\n  // eslint-disable-next-line no-console\n  console.warn('MEMOS', orderBy(\n    Object\n      .values(DEBUG_memos)\n      .filter(({ calls }) => calls >= DEBUG_MEMOS_CALLS_THRESHOLD)\n      .map((state) => ({ ...state, hitRate: Number(state.hitRate.toFixed(2)) })),\n    'hitRate',\n    'asc',\n  ));\n});\n\nlet instancesPendingUpdate = new Set<ComponentInstance>();\nlet idsToExcludeFromUpdate = new Set<number>();\nlet pendingEffects = new Map<string, Effect>();\nlet pendingCleanups = new Map<string, EffectCleanup>();\nlet pendingLayoutEffects = new Map<string, Effect>();\nlet pendingLayoutCleanups = new Map<string, EffectCleanup>();\nlet areImmediateEffectsCaptured = false;\n\n/*\n  Order:\n  - component effect cleanups\n  - component effects\n  - measure tasks\n  - mutation tasks\n  - component updates\n  - component layout effect cleanups\n  - component layout effects\n  - forced layout measure tasks\n  - forced layout mutation tasks\n */\n\nconst runUpdatePassOnRaf = throttleWith(requestMeasure, () => {\n  if (getIsBlockingAnimating()) {\n    getIsBlockingAnimating.once(runUpdatePassOnRaf);\n    return;\n  }\n\n  const runImmediateEffects = captureImmediateEffects();\n\n  idsToExcludeFromUpdate = new Set();\n  const instancesToUpdate = Array\n    .from(instancesPendingUpdate)\n    .sort((a, b) => a.id - b.id);\n  instancesPendingUpdate = new Set();\n\n  const currentCleanups = pendingCleanups;\n  pendingCleanups = new Map();\n  currentCleanups.forEach((cb) => cb());\n\n  const currentEffects = pendingEffects;\n  pendingEffects = new Map();\n  currentEffects.forEach((cb) => cb());\n\n  requestMutation(() => {\n    instancesToUpdate.forEach(prepareComponentForFrame);\n    instancesToUpdate.forEach((instance) => {\n      if (idsToExcludeFromUpdate.has(instance.id)) {\n        return;\n      }\n\n      forceUpdateComponent(instance);\n    });\n\n    runImmediateEffects?.();\n  });\n});\n\nexport function captureImmediateEffects() {\n  if (areImmediateEffectsCaptured) {\n    return undefined;\n  }\n\n  areImmediateEffectsCaptured = true;\n  return runCapturedImmediateEffects;\n}\n\nfunction runCapturedImmediateEffects() {\n  const currentLayoutCleanups = pendingLayoutCleanups;\n  pendingLayoutCleanups = new Map();\n  currentLayoutCleanups.forEach((cb) => cb());\n\n  const currentLayoutEffects = pendingLayoutEffects;\n  pendingLayoutEffects = new Map();\n  currentLayoutEffects.forEach((cb) => cb());\n\n  areImmediateEffectsCaptured = false;\n}\n\nexport function renderComponent(componentInstance: ComponentInstance) {\n  idsToExcludeFromUpdate.add(componentInstance.id);\n\n  const { Component, props } = componentInstance;\n  let newRenderedValue: unknown;\n\n  safeExec(() => {\n    renderingInstance = componentInstance;\n    if (componentInstance.hooks) {\n      if (componentInstance.hooks.state) {\n        componentInstance.hooks.state.cursor = 0;\n      }\n      if (componentInstance.hooks.effects) {\n        componentInstance.hooks.effects.cursor = 0;\n      }\n      if (componentInstance.hooks.memos) {\n        componentInstance.hooks.memos.cursor = 0;\n      }\n      if (componentInstance.hooks.refs) {\n        componentInstance.hooks.refs.cursor = 0;\n      }\n    }\n\n    let DEBUG_startAt: number | undefined;\n    if (DEBUG) {\n      const componentName = DEBUG_resolveComponentName(Component);\n      if (!DEBUG_components[componentName]) {\n        DEBUG_components[componentName] = {\n          name: componentName,\n          renders: 0,\n          avgRenderTime: 0,\n        };\n      }\n\n      if (DEBUG_MORE) {\n        if (!DEBUG_SILENT_RENDERS_FOR.has(componentName)) {\n          // eslint-disable-next-line no-console\n          console.log(`[Teact] Render ${componentName}`);\n        }\n      }\n\n      DEBUG_startAt = performance.now();\n    }\n\n    newRenderedValue = Component(props);\n\n    if (DEBUG) {\n      const duration = performance.now() - DEBUG_startAt!;\n      const componentName = DEBUG_resolveComponentName(Component);\n      if (duration > DEBUG_RENDER_THRESHOLD) {\n        // eslint-disable-next-line no-console\n        console.warn(`[Teact] Slow component render: ${componentName}, ${Math.round(duration)} ms`);\n      }\n\n      const { renders, avgRenderTime } = DEBUG_components[componentName];\n      DEBUG_components[componentName].avgRenderTime = (avgRenderTime * renders + duration) / (renders + 1);\n      DEBUG_components[componentName].renders++;\n      DEBUG_components.TOTAL.renders++;\n\n      if (DEBUG_MORE) {\n        incrementOverlayCounter(`${componentName} renders`);\n        incrementOverlayCounter(`${componentName} duration`, duration);\n      }\n    }\n  }, {\n    rescue: () => {\n      // eslint-disable-next-line no-console\n      console.error(`[Teact] Error while rendering component ${componentInstance.name}`, componentInstance);\n\n      newRenderedValue = componentInstance.renderedValue;\n    },\n  });\n\n  if (componentInstance.mountState === MountState.Mounted && newRenderedValue === componentInstance.renderedValue) {\n    return componentInstance.$element;\n  }\n\n  componentInstance.renderedValue = newRenderedValue;\n  const children = Array.isArray(newRenderedValue) ? newRenderedValue : [newRenderedValue];\n  componentInstance.$element = buildComponentElement(componentInstance, children);\n\n  return componentInstance.$element;\n}\n\nexport function hasElementChanged($old: VirtualElement, $new: VirtualElement) {\n  if (typeof $old !== typeof $new) {\n    return true;\n  } else if ($old.type !== $new.type) {\n    return true;\n  } else if ($old.type === VirtualType.Text && $new.type === VirtualType.Text) {\n    return $old.value !== $new.value;\n  } else if ($old.type === VirtualType.Tag && $new.type === VirtualType.Tag) {\n    return ($old.tag !== $new.tag) || ($old.props.key !== $new.props.key);\n  } else if ($old.type === VirtualType.Component && $new.type === VirtualType.Component) {\n    return (\n      $old.componentInstance.Component !== $new.componentInstance.Component\n    ) || (\n      $old.props.key !== $new.props.key\n    );\n  }\n\n  return false;\n}\n\nexport function mountComponent(componentInstance: ComponentInstance) {\n  componentInstance.id = ++lastComponentId;\n  componentInstance.mountState = MountState.Mounting;\n  renderComponent(componentInstance);\n  componentInstance.mountState = MountState.Mounted;\n  return componentInstance.$element;\n}\n\nexport function unmountComponent(componentInstance: ComponentInstance) {\n  if (componentInstance.mountState === MountState.Unmounted) {\n    return;\n  }\n\n  idsToExcludeFromUpdate.add(componentInstance.id);\n\n  if (componentInstance.hooks?.effects) {\n    for (const effect of componentInstance.hooks.effects.byCursor) {\n      if (effect.cleanup) {\n        safeExec(effect.cleanup);\n      }\n\n      effect.cleanup = undefined;\n      effect.releaseSignals?.();\n    }\n  }\n\n  componentInstance.mountState = MountState.Unmounted;\n\n  helpGc(componentInstance);\n}\n\n// We need to remove all references to DOM objects. We also clean all other references, just in case\nfunction helpGc(componentInstance: ComponentInstance) {\n  const {\n    effects, state, memos, refs,\n  } = componentInstance.hooks || {};\n\n  if (effects) {\n    for (const hook of effects.byCursor) {\n      hook.schedule = undefined;\n      hook.cleanup = undefined;\n      hook.releaseSignals = undefined;\n      hook.dependencies = undefined;\n    }\n  }\n\n  if (state) {\n    for (const hook of state.byCursor) {\n      hook.value = undefined;\n      hook.nextValue = undefined;\n\n      hook.setter = undefined as any;\n    }\n  }\n\n  if (memos) {\n    for (const hook of memos.byCursor) {\n      hook.value = undefined;\n\n      hook.dependencies = undefined as any;\n    }\n  }\n\n  if (refs) {\n    for (const hook of refs.byCursor) {\n      hook.current = undefined;\n      hook.onChange = undefined;\n    }\n  }\n\n  componentInstance.hooks = undefined;\n\n  componentInstance.$element = undefined as any;\n  componentInstance.renderedValue = undefined;\n  componentInstance.onUpdate = undefined;\n}\n\nfunction prepareComponentForFrame(componentInstance: ComponentInstance) {\n  if (componentInstance.mountState === MountState.Unmounted) {\n    return;\n  }\n\n  if (componentInstance.hooks?.state) {\n    for (const hook of componentInstance.hooks.state.byCursor) {\n      hook.value = hook.nextValue;\n    }\n  }\n}\n\nfunction forceUpdateComponent(componentInstance: ComponentInstance) {\n  if (componentInstance.mountState === MountState.Unmounted || !componentInstance.onUpdate) {\n    return;\n  }\n\n  const currentElement = componentInstance.$element;\n\n  renderComponent(componentInstance);\n\n  if (componentInstance.$element !== currentElement) {\n    componentInstance.onUpdate();\n  }\n}\n\nexport function useState<T>(): [T | undefined, StateHookSetter<T | undefined>];\nexport function useState<T>(initial: T, debugKey?: string): [T, StateHookSetter<T>];\nexport function useState<T>(initial?: T, debugKey?: string): [T, StateHookSetter<T>] {\n  if (!renderingInstance.hooks) {\n    renderingInstance.hooks = {};\n  }\n  if (!renderingInstance.hooks.state) {\n    renderingInstance.hooks.state = { cursor: 0, byCursor: [] };\n  }\n\n  const { cursor, byCursor } = renderingInstance.hooks.state;\n  const componentInstance = renderingInstance;\n\n  if (byCursor[cursor] === undefined) {\n    byCursor[cursor] = {\n      value: initial,\n      nextValue: initial,\n      setter: (newValue: ((current: T) => T) | T) => {\n        if (componentInstance.mountState === MountState.Unmounted) {\n          return;\n        }\n\n        if (typeof newValue === 'function') {\n          newValue = (newValue as (current: T) => T)(byCursor[cursor].nextValue);\n        }\n\n        if (byCursor[cursor].nextValue === newValue) {\n          return;\n        }\n\n        byCursor[cursor].nextValue = newValue;\n\n        instancesPendingUpdate.add(componentInstance);\n        runUpdatePassOnRaf();\n\n        if (DEBUG_MORE) {\n          // eslint-disable-next-line no-console\n          console.log(\n            '[Teact.useState]',\n            DEBUG_resolveComponentName(componentInstance.Component),\n            `State update at cursor #${cursor}${debugKey ? ` (${debugKey})` : ''}, next value: `,\n            byCursor[cursor].nextValue,\n          );\n        }\n      },\n    };\n  }\n\n  renderingInstance.hooks.state.cursor++;\n\n  return [\n    byCursor[cursor].value,\n    byCursor[cursor].setter,\n  ];\n}\n\nfunction useEffectBase(\n  isLayout: boolean,\n  effect: Effect,\n  dependencies?: readonly unknown[],\n  debugKey?: string,\n) {\n  if (!renderingInstance.hooks) {\n    renderingInstance.hooks = {};\n  }\n\n  if (!renderingInstance.hooks.effects) {\n    renderingInstance.hooks.effects = { cursor: 0, byCursor: [] };\n  }\n\n  const { cursor, byCursor } = renderingInstance.hooks.effects;\n  const effectConfig = byCursor[cursor];\n  const componentInstance = renderingInstance;\n\n  function schedule() {\n    scheduleEffect(componentInstance, cursor, effect, isLayout);\n  }\n\n  if (dependencies && effectConfig?.dependencies) {\n    if (dependencies.some((dependency, i) => dependency !== effectConfig.dependencies![i])) {\n      if (DEBUG && debugKey) {\n        const causedBy = dependencies.reduce<string[]>((res, newValue, i) => {\n          const prevValue = effectConfig.dependencies![i];\n          if (newValue !== prevValue) {\n            res.push(`${i}: ${String(prevValue)} => ${String(newValue)}`);\n          }\n\n          return res;\n        }, []);\n\n        // eslint-disable-next-line no-console\n        console.log(`[Teact] Effect \"${debugKey}\" caused by dependencies.`, causedBy.join(', '));\n      }\n\n      schedule();\n    }\n  } else {\n    if (debugKey) {\n      // eslint-disable-next-line no-console\n      console.log(`[Teact] Effect \"${debugKey}\" caused by missing dependencies.`);\n    }\n\n    schedule();\n  }\n\n  function setupSignals() {\n    const cleanups = dependencies?.filter(isSignal).map((signal, i) => signal.subscribe(() => {\n      if (debugKey) {\n        // eslint-disable-next-line no-console\n        console.log(`[Teact] Effect \"${debugKey}\" caused by signal #${i} new value:`, signal());\n      }\n\n      byCursor[cursor].schedule!();\n    }));\n\n    if (!cleanups?.length) {\n      return undefined;\n    }\n\n    return () => {\n      for (const cleanup of cleanups) {\n        cleanup();\n      }\n    };\n  }\n\n  if (effectConfig) effectConfig.schedule = undefined; // Help GC\n\n  byCursor[cursor] = {\n    ...effectConfig,\n    dependencies,\n    schedule,\n  };\n\n  if (!effectConfig) {\n    byCursor[cursor].releaseSignals = setupSignals();\n  }\n\n  renderingInstance.hooks.effects.cursor++;\n}\n\nfunction scheduleEffect(\n  componentInstance: ComponentInstance,\n  cursor: number,\n  effect: Effect,\n  isLayout: boolean,\n) {\n  const { byCursor } = componentInstance.hooks!.effects!;\n  const cleanup = byCursor[cursor]?.cleanup;\n  const cleanupsContainer = isLayout ? pendingLayoutCleanups : pendingCleanups;\n  const effectsContainer = isLayout ? pendingLayoutEffects : pendingEffects;\n  const effectId = `${componentInstance.id}_${cursor}`;\n\n  if (cleanup) {\n    const runEffectCleanup = () => safeExec(() => {\n      if (componentInstance.mountState === MountState.Unmounted) {\n        return;\n      }\n\n      let DEBUG_startAt: number | undefined;\n      if (DEBUG) {\n        DEBUG_startAt = performance.now();\n      }\n\n      cleanup();\n\n      if (DEBUG) {\n        const duration = performance.now() - DEBUG_startAt!;\n        const componentName = DEBUG_resolveComponentName(componentInstance.Component);\n        if (duration > DEBUG_EFFECT_THRESHOLD) {\n          // eslint-disable-next-line no-console\n          console.warn(\n            `[Teact] Slow cleanup at effect cursor #${cursor}: ${componentName}, ${Math.round(duration)} ms`,\n          );\n        }\n      }\n    }, {\n      rescue: () => {\n        // eslint-disable-next-line no-console\n        console.error(`[Teact] Error in effect cleanup at cursor #${cursor} in ${componentInstance.name}`,\n          componentInstance);\n      },\n      always: () => {\n        byCursor[cursor].cleanup = undefined;\n      },\n    });\n\n    cleanupsContainer.set(effectId, runEffectCleanup);\n  }\n\n  const runEffect = () => safeExec(() => {\n    if (componentInstance.mountState === MountState.Unmounted) {\n      return;\n    }\n\n    let DEBUG_startAt: number | undefined;\n    if (DEBUG) {\n      DEBUG_startAt = performance.now();\n    }\n\n    const result = effect();\n    if (typeof result === 'function') {\n      byCursor[cursor].cleanup = result;\n    }\n\n    if (DEBUG) {\n      const duration = performance.now() - DEBUG_startAt!;\n      const componentName = DEBUG_resolveComponentName(componentInstance.Component);\n      if (duration > DEBUG_EFFECT_THRESHOLD) {\n        // eslint-disable-next-line no-console\n        console.warn(`[Teact] Slow effect at cursor #${cursor}: ${componentName}, ${Math.round(duration)} ms`);\n      }\n    }\n  }, {\n    rescue: () => {\n      // eslint-disable-next-line no-console\n      console.error(`[Teact] Error in effect at cursor #${cursor} in ${componentInstance.name}`, componentInstance);\n    },\n  });\n\n  effectsContainer.set(effectId, runEffect);\n\n  runUpdatePassOnRaf();\n}\n\nexport function useEffect(effect: Effect, dependencies?: readonly unknown[], debugKey?: string) {\n  return useEffectBase(false, effect, dependencies, debugKey);\n}\n\nexport function useLayoutEffect(effect: Effect, dependencies?: readonly unknown[], debugKey?: string) {\n  return useEffectBase(true, effect, dependencies, debugKey);\n}\n\nexport function useUnmountCleanup(cleanup: NoneToVoidFunction) {\n  if (!renderingInstance.hooks) {\n    renderingInstance.hooks = {};\n  }\n\n  if (!renderingInstance.hooks.effects) {\n    renderingInstance.hooks.effects = { cursor: 0, byCursor: [] };\n  }\n\n  const { cursor, byCursor } = renderingInstance.hooks.effects;\n\n  if (!byCursor[cursor]) {\n    byCursor[cursor] = {\n      cleanup,\n    };\n  }\n\n  renderingInstance.hooks.effects.cursor++;\n}\n\nexport function useMemo<T>(\n  resolver: () => T,\n  dependencies: readonly unknown[],\n  debugKey?: string,\n  debugHitRateKey?: string,\n): T {\n  if (!renderingInstance.hooks) {\n    renderingInstance.hooks = {};\n  }\n  if (!renderingInstance.hooks.memos) {\n    renderingInstance.hooks.memos = { cursor: 0, byCursor: [] };\n  }\n\n  const { cursor, byCursor } = renderingInstance.hooks.memos;\n  let { value } = byCursor[cursor] || {};\n\n  let DEBUG_state: typeof DEBUG_memos[string] | undefined;\n  if (DEBUG && debugHitRateKey) {\n    const instanceKey = `${debugHitRateKey}#${renderingInstance.id}`;\n\n    DEBUG_state = DEBUG_memos[instanceKey];\n    if (!DEBUG_state) {\n      DEBUG_state = {\n        key: instanceKey, calls: 0, misses: 0, hitRate: 0,\n      };\n      DEBUG_memos[instanceKey] = DEBUG_state;\n    }\n\n    DEBUG_state.calls++;\n    DEBUG_state.hitRate = (DEBUG_state.calls - DEBUG_state.misses) / DEBUG_state.calls;\n  }\n\n  if (\n    byCursor[cursor] === undefined\n    || dependencies.length !== byCursor[cursor].dependencies.length\n    || dependencies.some((dependency, i) => dependency !== byCursor[cursor].dependencies[i])\n  ) {\n    if (DEBUG) {\n      if (debugKey) {\n        const msg = `[Teact.useMemo] ${renderingInstance.name} (${debugKey}): Update is caused by:`;\n        if (!byCursor[cursor]) {\n          // eslint-disable-next-line no-console\n          console.log(`${msg} [first render]`);\n        } else {\n          logUnequalProps(byCursor[cursor].dependencies, dependencies, msg, debugKey);\n        }\n      }\n\n      if (DEBUG_state) {\n        DEBUG_state.misses++;\n        DEBUG_state.hitRate = (DEBUG_state.calls - DEBUG_state.misses) / DEBUG_state.calls;\n\n        if (\n          DEBUG_state.calls % 10 === 0\n          && DEBUG_state.calls >= DEBUG_MEMOS_CALLS_THRESHOLD\n          && DEBUG_state.hitRate < 0.25\n        ) {\n          // eslint-disable-next-line no-console\n          console.warn(\n\n            `[Teact] ${DEBUG_state.key}: Hit rate is ${DEBUG_state.hitRate.toFixed(2)} for ${DEBUG_state.calls} calls`,\n          );\n        }\n      }\n    }\n\n    value = resolver();\n  }\n\n  byCursor[cursor] = {\n    value,\n    dependencies,\n  };\n\n  renderingInstance.hooks.memos.cursor++;\n\n  return value;\n}\n\nexport function useCallback<F extends AnyFunction>(newCallback: F, dependencies: unknown[], debugKey?: string): F {\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  return useMemo(() => newCallback, dependencies, debugKey);\n}\n\nexport function useRef<T>(initial: T): RefObject<T>;\nexport function useRef<T>(): RefObject<T | undefined>; // TT way (empty is `undefined`)\nexport function useRef<T>(initial?: T) {\n  if (!renderingInstance.hooks) {\n    renderingInstance.hooks = {};\n  }\n  if (!renderingInstance.hooks.refs) {\n    renderingInstance.hooks.refs = { cursor: 0, byCursor: [] };\n  }\n\n  const { cursor, byCursor } = renderingInstance.hooks.refs;\n  if (!byCursor[cursor]) {\n    byCursor[cursor] = {\n      current: initial,\n    };\n  }\n\n  renderingInstance.hooks.refs.cursor++;\n\n  return byCursor[cursor];\n}\n\nexport function createContext<T>(defaultValue?: T): Context<T> {\n  const contextId = String(contextCounter++);\n\n  function TeactContextProvider(props: { value: T; children: TeactNode }) {\n    const [getValue, setValue] = useSignal(props.value ?? defaultValue);\n    // Create a new object to avoid mutations in the parent context\n    renderingInstance.context = { ...renderingInstance.context };\n\n    renderingInstance.context[contextId] = getValue;\n    setValue(props.value);\n    return props.children;\n  }\n\n  TeactContextProvider.DEBUG_contentComponentName = contextId;\n\n  const context = {\n    defaultValue,\n    contextId,\n    Provider: TeactContextProvider,\n  };\n\n  return context;\n}\n\nexport function useContextSignal<T>(context: Context<T>) {\n  const [getDefaultValue] = useSignal(context.defaultValue);\n\n  return renderingInstance.context?.[context.contextId] as Signal<T> || getDefaultValue;\n}\n\nexport function useSignal<T>(initial?: T) {\n  const signalRef = useRef<ReturnType<typeof createSignal<T>>>();\n  signalRef.current ??= createSignal<T>(initial);\n  return signalRef.current;\n}\n\nexport function memo<T extends FC_withDebug>(Component: T, debugKey?: string) {\n  function TeactMemoWrapper(props: Props) {\n    return useMemo(\n      () => createElement(Component, props),\n      // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n      Object.values(props),\n      debugKey,\n      DEBUG_MORE ? DEBUG_resolveComponentName(renderingInstance.Component) : undefined,\n    );\n  }\n\n  TeactMemoWrapper.DEBUG_contentComponentName = DEBUG_resolveComponentName(Component);\n\n  return TeactMemoWrapper as T;\n}\n\nexport function DEBUG_resolveComponentName(Component: FC_withDebug) {\n  const { name, DEBUG_contentComponentName } = Component;\n\n  if (name === 'TeactNContainer') {\n    return `container>${DEBUG_contentComponentName}`;\n  }\n\n  if (name === 'TeactMemoWrapper') {\n    return `memo>${DEBUG_contentComponentName}`;\n  }\n\n  if (name === 'TeactContextProvider') {\n    return `context>id${DEBUG_contentComponentName}`;\n  }\n\n  return name + (DEBUG_contentComponentName ? `>${DEBUG_contentComponentName}` : '');\n}\n\nexport default {\n  createElement,\n  Fragment,\n};\n\nexport { createElement, Fragment };\n","import {\n  getIsHeavyAnimating,\n  useCallback, useEffect, useMemo, useRef,\n} from '../lib/teact/teact';\n\nimport { createCallbackManager } from '../util/callbacks';\nimport useLastCallback from './useLastCallback';\n\nexport const startCallbacks = createCallbackManager();\nexport const endCallbacks = createCallbackManager();\n\ngetIsHeavyAnimating.subscribe(() => {\n  if (getIsHeavyAnimating()) {\n    startCallbacks.runCallbacks();\n  } else {\n    endCallbacks.runCallbacks();\n  }\n});\n\nexport default function useHeavyAnimation(\n  onStart?: AnyToVoidFunction,\n  onEnd?: AnyToVoidFunction,\n  isDisabled = false,\n) {\n  const lastOnStart = useLastCallback(onStart);\n  const lastOnEnd = useLastCallback(onEnd);\n\n  useEffect(() => {\n    if (isDisabled) {\n      return undefined;\n    }\n\n    if (getIsHeavyAnimating()) {\n      lastOnStart();\n    }\n\n    startCallbacks.addCallback(lastOnStart);\n    endCallbacks.addCallback(lastOnEnd);\n\n    return () => {\n      endCallbacks.removeCallback(lastOnEnd);\n      startCallbacks.removeCallback(lastOnStart);\n    };\n  }, [isDisabled, lastOnEnd, lastOnStart]);\n}\n\n// TODO  `onFullyIdle`?\nexport function useThrottleForHeavyAnimation<T extends AnyToVoidFunction>(afterHeavyAnimation: T, deps: unknown[]) {\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  const fnMemo = useCallback(afterHeavyAnimation, deps);\n\n  const isScheduledRef = useRef(false);\n\n  return useMemo(() => {\n    return (...args: Parameters<T>) => {\n      if (!isScheduledRef.current) {\n        if (!getIsHeavyAnimating()) {\n          fnMemo(...args);\n          return;\n        }\n\n        isScheduledRef.current = true;\n\n        const removeCallback = endCallbacks.addCallback(() => {\n          fnMemo(...args);\n          removeCallback();\n          isScheduledRef.current = false;\n        });\n      }\n    };\n  }, [fnMemo]);\n}\n","import type { ThemeKey } from '../types';\n\nlet systemThemeCache: ThemeKey = (\n  window.matchMedia?.('(prefers-color-scheme: dark)').matches\n) ? 'dark' : 'light';\n\nlet themeChangeCallback: ((newTheme: ThemeKey) => void) | undefined;\n\nexport function getSystemTheme() {\n  return systemThemeCache;\n}\n\nfunction handleSystemThemeChange(e: MediaQueryListEventMap['change']) {\n  systemThemeCache = e.matches ? 'dark' : 'light';\n\n  themeChangeCallback?.(systemThemeCache);\n}\n\nexport function setSystemThemeChangeCallback(callback: (newTheme: ThemeKey) => void) {\n  themeChangeCallback = callback;\n}\n\nwindow.matchMedia('(prefers-color-scheme: dark)')\n  .addEventListener('change', handleSystemThemeChange);\n","import type { ThreadId, WebPageMediaSize } from '../../types';\nimport type {\n  ApiBotInlineMediaResult,\n  ApiBotInlineResult,\n  ApiWebDocument,\n} from './bots';\nimport type { ApiPeerColor } from './chats';\nimport type { ApiMessageAction } from './messageActions';\nimport type { ApiRestrictionReason } from './misc';\nimport type {\n  ApiLabeledPrice,\n} from './payments';\nimport type { ApiStarGiftUnique, ApiTypeCurrencyAmount } from './stars';\nimport type {\n  ApiMessageStoryData, ApiStory, ApiWebPageStickerData, ApiWebPageStoryData,\n} from './stories';\nimport type { ApiInlineQueryPeerType } from './users';\n\nexport interface ApiDimensions {\n  width: number;\n  height: number;\n}\n\nexport interface ApiPhotoSize extends ApiDimensions {\n  type: 's' | 'm' | 'x' | 'y' | 'w';\n}\n\nexport interface ApiVideoSize extends ApiDimensions {\n  type: 'u' | 'v';\n  videoStartTs?: number;\n  size: number;\n}\n\nexport interface ApiThumbnail extends ApiDimensions {\n  dataUri: string;\n}\n\nexport interface ApiPhoto {\n  mediaType: 'photo';\n  id: string;\n  date: number;\n  thumbnail?: ApiThumbnail;\n  isVideo?: boolean;\n  sizes: ApiPhotoSize[];\n  videoSizes?: ApiVideoSize[];\n  blobUrl?: string;\n  isSpoiler?: boolean;\n}\n\nexport interface ApiSticker {\n  mediaType: 'sticker';\n  id: string;\n  stickerSetInfo: ApiStickerSetInfo;\n  emoji?: string;\n  isCustomEmoji?: boolean;\n  isLottie: boolean;\n  isVideo: boolean;\n  width?: number;\n  height?: number;\n  thumbnail?: ApiThumbnail;\n  previewPhotoSizes?: ApiPhotoSize[];\n  isPreloadedGlobally?: boolean;\n  hasEffect?: boolean;\n  isFree?: boolean;\n  shouldUseTextColor?: boolean;\n}\n\nexport interface ApiStickerSet {\n  isArchived?: true;\n  isEmoji?: true;\n  installedDate?: number;\n  id: string;\n  accessHash: string;\n  title: string;\n  hasThumbnail?: boolean;\n  hasStaticThumb?: boolean;\n  hasAnimatedThumb?: boolean;\n  hasVideoThumb?: boolean;\n  thumbCustomEmojiId?: string;\n  count: number;\n  stickers?: ApiSticker[];\n  packs?: Record<string, ApiSticker[]>;\n  covers?: ApiSticker[];\n  shortName: string;\n}\n\ntype ApiStickerSetInfoShortName = {\n  shortName: string;\n};\n\ntype ApiStickerSetInfoId = {\n  id: string;\n  accessHash: string;\n};\n\ntype ApiStickerSetInfoMissing = {\n  isMissing: true;\n};\n\nexport type ApiStickerSetInfo = ApiStickerSetInfoShortName | ApiStickerSetInfoId | ApiStickerSetInfoMissing;\n\nexport interface ApiVideo {\n  mediaType: 'video';\n  id: string;\n  mimeType: string;\n  duration: number;\n  fileName: string;\n  width?: number;\n  height?: number;\n  supportsStreaming?: boolean;\n  isRound?: boolean;\n  isGif?: boolean;\n  hasVideoPreview?: boolean;\n  isSpoiler?: boolean;\n  thumbnail?: ApiThumbnail;\n  previewPhotoSizes?: ApiPhotoSize[];\n  blobUrl?: string;\n  previewBlobUrl?: string;\n  size: number;\n  noSound?: boolean;\n  waveform?: number[];\n  timestamp?: number;\n}\n\nexport interface ApiAudio {\n  mediaType: 'audio';\n  id: string;\n  size: number;\n  mimeType: string;\n  fileName: string;\n  duration: number;\n  performer?: string;\n  title?: string;\n  thumbnailSizes?: ApiPhotoSize[];\n}\n\nexport interface ApiVoice {\n  mediaType: 'voice';\n  id: string;\n  duration: number;\n  waveform?: number[];\n  size: number;\n}\n\nexport interface ApiDocument {\n  mediaType: 'document';\n  id?: string;\n  fileName: string;\n  size: number;\n  timestamp?: number;\n  mimeType: string;\n  thumbnail?: ApiThumbnail;\n  previewPhotoSizes?: ApiPhotoSize[];\n  previewBlobUrl?: string;\n  innerMediaType?: 'photo' | 'video';\n  mediaSize?: ApiDimensions & { fromDocumentAttribute?: boolean; fromPreload?: true };\n}\n\nexport interface ApiContact {\n  mediaType: 'contact';\n  firstName: string;\n  lastName: string;\n  phoneNumber: string;\n  userId: string;\n}\n\nexport type ApiPaidMedia = {\n  mediaType: 'paidMedia';\n  starsAmount: number;\n} & ({\n  isBought?: true;\n  extendedMedia: BoughtPaidMedia[];\n} | {\n  isBought?: undefined;\n  extendedMedia: ApiMediaExtendedPreview[];\n});\n\nexport interface ApiPollAnswer {\n  text: ApiFormattedText;\n  option: string;\n}\n\nexport interface ApiPollResult {\n  isChosen?: true;\n  isCorrect?: true;\n  option: string;\n  votersCount: number;\n}\n\nexport interface ApiPoll {\n  mediaType: 'poll';\n  id: string;\n  summary: {\n    closed?: true;\n    isPublic?: true;\n    multipleChoice?: true;\n    quiz?: true;\n    question: ApiFormattedText;\n    answers: ApiPollAnswer[];\n    closePeriod?: number;\n    closeDate?: number;\n  };\n  results: {\n    isMin?: true;\n    results?: ApiPollResult[];\n    totalVoters?: number;\n    recentVoterIds?: string[];\n    solution?: string;\n    solutionEntities?: ApiMessageEntity[];\n  };\n}\n\nexport interface ApiInvoice {\n  prices: ApiLabeledPrice[];\n  totalAmount: number;\n  currency: string;\n  isTest?: boolean;\n  isRecurring?: boolean;\n  subscriptionPeriod?: number;\n  termsUrl?: string;\n  maxTipAmount?: number;\n  suggestedTipAmounts?: number[];\n  isNameRequested?: boolean;\n  isPhoneRequested?: boolean;\n  isEmailRequested?: boolean;\n  isShippingAddressRequested?: boolean;\n  isFlexible?: boolean;\n  isPhoneSentToProvider?: boolean;\n  isEmailSentToProvider?: boolean;\n}\n\nexport interface ApiMediaInvoice {\n  mediaType: 'invoice';\n  title: string;\n  description: string;\n  photo?: ApiWebDocument;\n  isTest?: boolean;\n  receiptMessageId?: number;\n  currency: string;\n  amount: number;\n  extendedMedia?: ApiMediaExtendedPreview;\n}\n\nexport interface ApiMediaExtendedPreview {\n  mediaType: 'extendedMediaPreview';\n  width?: number;\n  height?: number;\n  thumbnail?: ApiThumbnail;\n  duration?: number;\n}\n\nexport interface ApiPaymentCredentials {\n  id: string;\n  title: string;\n}\n\nexport interface ApiGeoPoint {\n  long: number;\n  lat: number;\n  accessHash: string;\n  accuracyRadius?: number;\n}\n\nexport interface ApiGeo {\n  mediaType: 'geo';\n  geo: ApiGeoPoint;\n}\n\nexport interface ApiVenue {\n  mediaType: 'venue';\n  geo: ApiGeoPoint;\n  title: string;\n  address: string;\n  provider: string;\n  venueId: string;\n  venueType: string;\n}\n\nexport interface ApiGeoLive {\n  mediaType: 'geoLive';\n  geo: ApiGeoPoint;\n  heading?: number;\n  period: number;\n}\n\nexport type ApiLocation = ApiGeo | ApiVenue | ApiGeoLive;\n\nexport type ApiGame = {\n  mediaType: 'game';\n  title: string;\n  description: string;\n  photo?: ApiPhoto;\n  shortName: string;\n  id: string;\n  accessHash: string;\n  document?: ApiDocument;\n};\n\nexport type ApiGiveaway = {\n  mediaType: 'giveaway';\n  quantity: number;\n  months?: number;\n  stars?: number;\n  untilDate: number;\n  isOnlyForNewSubscribers?: true;\n  countries?: string[];\n  channelIds: string[];\n  prizeDescription?: string;\n};\n\nexport type ApiGiveawayResults = {\n  mediaType: 'giveawayResults';\n  months?: number;\n  stars?: number;\n  untilDate: number;\n  isRefunded?: true;\n  isOnlyForNewSubscribers?: true;\n  channelId: string;\n  prizeDescription?: string;\n  winnersCount?: number;\n  winnerIds: string[];\n  additionalPeersCount?: number;\n  launchMessageId: number;\n  unclaimedCount: number;\n};\n\nexport type ApiNewPoll = {\n  summary: ApiPoll['summary'];\n  quiz?: {\n    correctAnswers: string[];\n    solution?: string;\n    solutionEntities?: ApiMessageEntity[];\n  };\n};\n\nexport interface ApiTodoItem {\n  id: number;\n  title: ApiFormattedText;\n}\n\nexport interface ApiTodoList {\n  title: ApiFormattedText;\n  items: ApiTodoItem[];\n  othersCanAppend?: boolean;\n  othersCanComplete?: boolean;\n}\n\nexport interface ApiTodoCompletion {\n  itemId: number;\n  completedBy: string;\n  completedAt: number;\n}\n\nexport interface ApiMediaTodo {\n  mediaType: 'todo';\n  todo: ApiTodoList;\n  completions?: ApiTodoCompletion[];\n}\n\nexport type ApiNewMediaTodo = {\n  todo: ApiTodoList;\n};\n\nexport interface ApiWebPagePending {\n  mediaType: 'webpage';\n  webpageType: 'pending';\n  id: string;\n  url?: string;\n  isSafe?: true;\n}\n\nexport interface ApiWebPageEmpty {\n  mediaType: 'webpage';\n  webpageType: 'empty';\n  id: string;\n  url?: string;\n  isSafe?: true;\n}\n\nexport interface ApiWebPageFull {\n  mediaType: 'webpage';\n  webpageType: 'full';\n  id: string;\n  url: string;\n  displayUrl: string;\n  type?: string;\n  siteName?: string;\n  title?: string;\n  description?: string;\n  photo?: ApiPhoto;\n  audio?: ApiAudio;\n  duration?: number;\n  document?: ApiDocument;\n  video?: ApiVideo;\n  story?: ApiWebPageStoryData;\n  gift?: ApiStarGiftUnique;\n  stickers?: ApiWebPageStickerData;\n  hasLargeMedia?: boolean;\n}\n\nexport type ApiWebPage = ApiWebPagePending | ApiWebPageEmpty | ApiWebPageFull;\n\n/**\n * Wrapper with message-specific fields\n */\nexport interface ApiMessageWebPage {\n  id: string;\n  isSafe?: true;\n  mediaSize?: WebPageMediaSize;\n}\n\nexport type ApiReplyInfo = ApiMessageReplyInfo | ApiStoryReplyInfo;\n\nexport interface ApiMessageReplyInfo {\n  type: 'message';\n  replyToMsgId?: number;\n  replyToPeerId?: string;\n  replyFrom?: ApiMessageForwardInfo;\n  replyMedia?: MediaContent;\n  replyToTopId?: number;\n  isForumTopic?: true;\n  isQuote?: true;\n  quoteText?: ApiFormattedText;\n  quoteOffset?: number;\n}\n\nexport interface ApiStoryReplyInfo {\n  type: 'story';\n  peerId: string;\n  storyId: number;\n}\n\nexport interface ApiInputMessageReplyInfo {\n  type: 'message';\n  replyToMsgId: number;\n  replyToTopId?: number;\n  replyToPeerId?: string;\n  monoforumPeerId?: string;\n  quoteText?: ApiFormattedText;\n  quoteOffset?: number;\n}\n\nexport interface ApiSuggestedPost {\n  isAccepted?: true;\n  isRejected?: true;\n  price?: ApiTypeCurrencyAmount;\n  scheduleDate?: number;\n}\n\nexport interface ApiInputStoryReplyInfo {\n  type: 'story';\n  peerId: string;\n  storyId: number;\n}\n\nexport interface ApiInputSuggestedPostInfo {\n  price?: ApiTypeCurrencyAmount;\n  scheduleDate?: number;\n  isAccepted?: true;\n  isRejected?: true;\n}\n\nexport type ApiInputReplyInfo = ApiInputMessageReplyInfo | ApiInputStoryReplyInfo;\n\nexport interface ApiMessageForwardInfo {\n  date: number;\n  savedDate?: number;\n  isImported?: boolean;\n  isChannelPost: boolean;\n  channelPostId?: number;\n  isLinkedChannelPost?: boolean;\n  fromChatId?: string;\n  fromId?: string;\n  savedFromPeerId?: string;\n  isSavedOutgoing?: boolean;\n  fromMessageId?: number;\n  hiddenUserName?: string;\n  postAuthorTitle?: string;\n}\n\nexport interface ApiStoryForwardInfo {\n  fromPeerId?: string;\n  fromName?: string;\n  storyId?: number;\n  isModified?: boolean;\n}\n\nexport type ApiMessageEntityDefault = {\n  type: Exclude<\n  `${ApiMessageEntityTypes}`,\n  `${ApiMessageEntityTypes.Pre}` | `${ApiMessageEntityTypes.TextUrl}` | `${ApiMessageEntityTypes.MentionName}` |\n  `${ApiMessageEntityTypes.CustomEmoji}` | `${ApiMessageEntityTypes.Blockquote}` | `${ApiMessageEntityTypes.Timestamp}`\n  >;\n  offset: number;\n  length: number;\n};\n\nexport type ApiMessageEntityPre = {\n  type: ApiMessageEntityTypes.Pre;\n  offset: number;\n  length: number;\n  language?: string;\n};\n\nexport type ApiMessageEntityTextUrl = {\n  type: ApiMessageEntityTypes.TextUrl;\n  offset: number;\n  length: number;\n  url: string;\n};\n\nexport type ApiMessageEntityMentionName = {\n  type: ApiMessageEntityTypes.MentionName;\n  offset: number;\n  length: number;\n  userId: string;\n};\n\nexport type ApiMessageEntityBlockquote = {\n  type: ApiMessageEntityTypes.Blockquote;\n  offset: number;\n  length: number;\n  canCollapse?: boolean;\n};\n\nexport type ApiMessageEntityCustomEmoji = {\n  type: ApiMessageEntityTypes.CustomEmoji;\n  offset: number;\n  length: number;\n  documentId: string;\n};\n\n// Local entities\nexport type ApiMessageEntityTimestamp = {\n  type: ApiMessageEntityTypes.Timestamp;\n  offset: number;\n  length: number;\n  timestamp: number;\n};\n\nexport type ApiMessageEntityQuoteFocus = {\n  type: 'quoteFocus';\n  offset: number;\n  length: number;\n};\n\nexport type ApiMessageEntity = ApiMessageEntityDefault | ApiMessageEntityPre | ApiMessageEntityTextUrl |\n  ApiMessageEntityMentionName | ApiMessageEntityCustomEmoji | ApiMessageEntityBlockquote | ApiMessageEntityTimestamp |\n  ApiMessageEntityQuoteFocus;\n\nexport enum ApiMessageEntityTypes {\n  Bold = 'MessageEntityBold',\n  Blockquote = 'MessageEntityBlockquote',\n  BotCommand = 'MessageEntityBotCommand',\n  Cashtag = 'MessageEntityCashtag',\n  Code = 'MessageEntityCode',\n  Email = 'MessageEntityEmail',\n  Hashtag = 'MessageEntityHashtag',\n  Italic = 'MessageEntityItalic',\n  MentionName = 'MessageEntityMentionName',\n  Mention = 'MessageEntityMention',\n  Phone = 'MessageEntityPhone',\n  Pre = 'MessageEntityPre',\n  Strike = 'MessageEntityStrike',\n  TextUrl = 'MessageEntityTextUrl',\n  Url = 'MessageEntityUrl',\n  Underline = 'MessageEntityUnderline',\n  Spoiler = 'MessageEntitySpoiler',\n  CustomEmoji = 'MessageEntityCustomEmoji',\n  Timestamp = 'MessageEntityTimestamp',\n  QuoteFocus = 'MessageEntityQuoteFocus',\n  Unknown = 'MessageEntityUnknown',\n}\n\nexport interface ApiFormattedText {\n  text: string;\n  entities?: ApiMessageEntity[];\n}\n\nexport interface ApiFormattedTextWithEmojiOnlyCount extends ApiFormattedText {\n  emojiOnlyCount?: number;\n}\n\nexport type MediaContent = {\n  text?: ApiFormattedTextWithEmojiOnlyCount;\n  photo?: ApiPhoto;\n  video?: ApiVideo;\n  altVideos?: ApiVideo[];\n  document?: ApiDocument;\n  sticker?: ApiSticker;\n  contact?: ApiContact;\n  pollId?: string;\n  todo?: ApiMediaTodo;\n  action?: ApiMessageAction;\n  webPage?: ApiMessageWebPage;\n  audio?: ApiAudio;\n  voice?: ApiVoice;\n  invoice?: ApiMediaInvoice;\n  location?: ApiLocation;\n  game?: ApiGame;\n  storyData?: ApiMessageStoryData;\n  giveaway?: ApiGiveaway;\n  giveawayResults?: ApiGiveawayResults;\n  paidMedia?: ApiPaidMedia;\n  ttlSeconds?: number;\n};\nexport type MediaContainer = {\n  content: MediaContent;\n};\n\nexport type StatefulMediaContent = {\n  poll?: ApiPoll;\n  story?: ApiStory;\n  webPage?: ApiWebPage;\n};\n\nexport type SizeTarget =\n  'micro'\n  | 'pictogram'\n  | 'inline'\n  | 'preview'\n  | 'full'\n  | 'download';\n\nexport type BoughtPaidMedia = Pick<MediaContent, 'photo' | 'video'>;\n\nexport interface ApiMessage {\n  id: number;\n  chatId: string;\n  content: MediaContent;\n  date: number;\n  isOutgoing: boolean;\n  senderId?: string;\n  replyInfo?: ApiReplyInfo;\n  suggestedPostInfo?: ApiInputSuggestedPostInfo;\n  sendingState?: 'messageSendingStatePending' | 'messageSendingStateFailed';\n  forwardInfo?: ApiMessageForwardInfo;\n  isDeleting?: boolean;\n  previousLocalId?: number;\n  viewsCount?: number;\n  forwardsCount?: number;\n  isEdited?: boolean;\n  editDate?: number;\n  isMentioned?: boolean;\n  isMediaUnread?: boolean;\n  groupedId?: string;\n  isInAlbum?: boolean;\n  hasUnreadMention?: boolean;\n  inlineButtons?: ApiKeyboardButtons;\n  keyboardButtons?: ApiKeyboardButtons;\n  keyboardPlaceholder?: string;\n  isKeyboardSingleUse?: boolean;\n  isKeyboardSelective?: boolean;\n  viaBotId?: string;\n  viaBusinessBotId?: string;\n  postAuthorTitle?: string;\n  isScheduled?: boolean;\n  shouldHideKeyboardButtons?: boolean;\n  isHideKeyboardSelective?: boolean;\n  isFromScheduled?: boolean;\n  isSilent?: boolean;\n  isPinned?: boolean;\n  seenByDates?: Record<string, number>;\n  isProtected?: boolean;\n  isForwardingAllowed?: boolean;\n  transcriptionId?: string;\n  isTranscriptionError?: boolean;\n  reactors?: {\n    nextOffset?: string;\n    count: number;\n    reactions: ApiPeerReaction[];\n  };\n  reactions?: ApiReactions;\n  hasComments?: boolean;\n  readDate?: number;\n  savedPeerId?: string;\n  senderBoosts?: number;\n  factCheck?: ApiFactCheck;\n  effectId?: string;\n  isInvertedMedia?: true;\n  isVideoProcessingPending?: true;\n  areReactionsPossible?: true;\n  reportDeliveryUntilDate?: number;\n  paidMessageStars?: number;\n  restrictionReasons?: ApiRestrictionReason[];\n}\n\nexport interface ApiReactions {\n  canSeeList?: boolean;\n  areTags?: boolean;\n  results: ApiReactionCount[];\n  recentReactions?: ApiPeerReaction[];\n  topReactors?: ApiMessageReactor[];\n}\n\nexport interface ApiPeerReaction {\n  peerId: string;\n  reaction: ApiReaction;\n  isOwn?: boolean;\n  isBig?: boolean;\n  isUnread?: boolean;\n  addedDate: number;\n}\n\nexport interface ApiMessageReactor {\n  isTop?: true;\n  isMy?: true;\n  count: number;\n  isAnonymous?: true;\n  peerId?: string;\n}\n\nexport interface ApiReactionCount {\n  chosenOrder?: number;\n  count: number;\n  reaction: ApiReactionWithPaid;\n  localAmount?: number;\n  localIsPrivate?: boolean;\n  localPeerId?: string;\n  localPreviousChosenOrder?: number;\n}\n\nexport interface ApiAvailableReaction {\n  selectAnimation?: ApiDocument;\n  appearAnimation?: ApiDocument;\n  activateAnimation?: ApiDocument;\n  effectAnimation?: ApiDocument;\n  staticIcon?: ApiDocument;\n  centerIcon?: ApiDocument;\n  aroundAnimation?: ApiDocument;\n  reaction: ApiReactionEmoji;\n  title: string;\n  isInactive?: boolean;\n  isPremium?: boolean;\n}\n\nexport interface ApiAvailableEffect {\n  id: string;\n  emoticon: string;\n  staticIconId?: string;\n  effectAnimationId?: string;\n  effectStickerId: string;\n  isPremium?: boolean;\n}\n\ntype ApiChatReactionsAll = {\n  type: 'all';\n  areCustomAllowed?: true;\n};\n\ntype ApiChatReactionsSome = {\n  type: 'some';\n  allowed: ApiReaction[];\n};\n\nexport type ApiChatReactions = ApiChatReactionsAll | ApiChatReactionsSome;\n\nexport type ApiReactionEmoji = {\n  type: 'emoji';\n  emoticon: string;\n};\n\nexport type ApiReactionCustomEmoji = {\n  type: 'custom';\n  documentId: string;\n};\n\nexport type ApiReactionPaid = {\n  type: 'paid';\n};\n\nexport type ApiReaction = ApiReactionEmoji | ApiReactionCustomEmoji;\nexport type ApiReactionWithPaid = ApiReaction | ApiReactionPaid;\n\nexport type ApiReactionKey = `${string}-${string}` | 'paid' | 'unsupported';\n\nexport type ApiSavedReactionTag = {\n  reaction: ApiReaction;\n  title?: string;\n  count: number;\n};\n\nexport type ApiPaidReactionPrivacyType = ApiPaidReactionPrivacyDefault |\n  ApiPaidReactionPrivacyAnonymous | PaidReactionPrivacyPeer;\n\nexport type ApiPaidReactionPrivacyDefault = {\n  type: 'default';\n};\n\nexport type ApiPaidReactionPrivacyAnonymous = {\n  type: 'anonymous';\n};\n\nexport type PaidReactionPrivacyPeer = {\n  type: 'peer';\n  peerId: string;\n};\n\ninterface ApiBaseThreadInfo {\n  chatId: string;\n  messagesCount: number;\n  lastMessageId?: number;\n  lastReadInboxMessageId?: number;\n  recentReplierIds?: string[];\n}\n\nexport interface ApiCommentsInfo extends ApiBaseThreadInfo {\n  isCommentsInfo: true;\n  threadId?: never;\n  originChannelId: string;\n  originMessageId: number;\n}\n\nexport interface ApiMessageThreadInfo extends ApiBaseThreadInfo {\n  isCommentsInfo: false;\n  threadId: ThreadId;\n  // For linked messages in discussion\n  fromChannelId?: string;\n  fromMessageId?: number;\n}\n\nexport type ApiThreadInfo = ApiCommentsInfo | ApiMessageThreadInfo;\n\nexport type ApiMessageReportResult = {\n  type: 'reported';\n} | {\n  type: 'comment';\n  isOptional?: boolean;\n  option: string;\n} | {\n  type: 'selectOption';\n  title: string;\n  options: {\n    text: string;\n    option: string;\n  }[];\n};\n\nexport type ApiMessageOutgoingStatus = 'read' | 'succeeded' | 'pending' | 'failed';\n\nexport type ApiSponsoredMessage = {\n  chatId: string;\n  randomId: string;\n  isRecommended?: true;\n  expiresAt: number;\n  sponsorInfo?: string;\n  additionalInfo?: string;\n  buttonText?: string;\n  canReport?: true;\n  title: string;\n  url: string;\n  photo?: ApiPhoto;\n  content: MediaContent;\n  peerColor?: ApiPeerColor;\n};\n\n// KeyboardButtons\n\ninterface ApiKeyboardButtonSimple {\n  type: 'unsupported' | 'buy' | 'command' | 'requestPhone' | 'game';\n  text: string;\n}\n\ninterface ApiKeyboardButtonReceipt {\n  type: 'receipt';\n  receiptMessageId: number;\n}\n\ninterface ApiKeyboardButtonUrl {\n  type: 'url';\n  text: string;\n  url: string;\n}\n\ninterface ApiKeyboardButtonSimpleWebView {\n  type: 'simpleWebView';\n  text: string;\n  url: string;\n}\n\ninterface ApiKeyboardButtonWebView {\n  type: 'webView';\n  text: string;\n  url: string;\n}\n\ninterface ApiKeyboardButtonCallback {\n  type: 'callback';\n  text: string;\n  data: string;\n}\n\ninterface ApiKeyboardButtonRequestPoll {\n  type: 'requestPoll';\n  text: string;\n  isQuiz?: boolean;\n}\n\ninterface ApiKeyboardButtonSwitchBotInline {\n  type: 'switchBotInline';\n  text: string;\n  query: string;\n  isSamePeer?: boolean;\n}\n\ninterface ApiKeyboardButtonUserProfile {\n  type: 'userProfile';\n  text: string;\n  userId: string;\n}\n\ninterface ApiKeyboardButtonUrlAuth {\n  type: 'urlAuth';\n  text: string;\n  url: string;\n  buttonId: number;\n}\n\ninterface ApiKeyboardButtonCopy {\n  type: 'copy';\n  text: string;\n  copyText: string;\n}\n\nexport interface ApiKeyboardButtonSuggestedMessage {\n  type: 'suggestedMessage';\n  text: string;\n  buttonType: 'approve' | 'decline' | 'suggestChanges';\n  disabled?: boolean;\n}\n\nexport type ApiKeyboardButton = (\n  ApiKeyboardButtonSimple\n  | ApiKeyboardButtonReceipt\n  | ApiKeyboardButtonUrl\n  | ApiKeyboardButtonCallback\n  | ApiKeyboardButtonRequestPoll\n  | ApiKeyboardButtonSwitchBotInline\n  | ApiKeyboardButtonUserProfile\n  | ApiKeyboardButtonWebView\n  | ApiKeyboardButtonSimpleWebView\n  | ApiKeyboardButtonUrlAuth\n  | ApiKeyboardButtonCopy\n  | ApiKeyboardButtonSuggestedMessage\n);\n\nexport type ApiKeyboardButtons = ApiKeyboardButton[][];\nexport type ApiReplyKeyboard = {\n  keyboardPlaceholder?: string;\n  isKeyboardSingleUse?: boolean;\n  isKeyboardSelective?: boolean;\n} & Partial<Record<'inlineButtons' | 'keyboardButtons', ApiKeyboardButtons>>;\n\nexport type ApiTranscription = {\n  text: string;\n  isPending?: boolean;\n  transcriptionId: string;\n};\n\nexport type ApiMessageSearchType = 'text' | 'media' | 'documents' | 'links' | 'audio' | 'voice' | 'profilePhoto';\nexport type ApiGlobalMessageSearchType = 'text' |\n  'channels' | 'media' | 'documents' | 'links' | 'audio' | 'voice' | 'publicPosts';\nexport type ApiMessageSearchContext = 'all' | 'users' | 'groups' | 'channels';\n\nexport type ApiReportReason = 'spam' | 'violence' | 'pornography' | 'childAbuse'\n  | 'copyright' | 'geoIrrelevant' | 'fake' | 'illegalDrugs' | 'personalDetails' | 'other';\n\nexport type ApiSendMessageAction = {\n  type: 'cancel' | 'typing' | 'recordAudio' | 'chooseSticker' | 'playingGame';\n};\n\nexport type ApiThemeParameters = {\n  bg_color: string;\n  text_color: string;\n  hint_color: string;\n  link_color: string;\n  button_color: string;\n  button_text_color: string;\n  secondary_bg_color: string;\n  header_bg_color: string;\n  accent_text_color: string;\n  section_bg_color: string;\n  section_header_text_color: string;\n  subtitle_text_color: string;\n  destructive_text_color: string;\n  section_separator_color: string;\n};\n\nexport type ApiBotApp = {\n  id: string;\n  accessHash: string;\n  title: string;\n  shortName: string;\n  description: string;\n  photo?: ApiPhoto;\n  document?: ApiDocument;\n};\n\nexport type ApiMessagesBotApp = ApiBotApp & {\n  isInactive?: boolean;\n  shouldRequestWriteAccess?: boolean;\n};\n\nexport type ApiQuickReply = {\n  id: number;\n  shortcut: string;\n  topMessageId: number;\n};\n\nexport type ApiFactCheck = {\n  shouldFetch?: true;\n  hash: string;\n  countryCode?: string;\n  text?: ApiFormattedText;\n};\n\nexport type ApiSponsoredMessageReportResult = {\n  type: 'reported' | 'hidden' | 'premiumRequired';\n} | {\n  type: 'selectOption';\n  title: string;\n  options: {\n    text: string;\n    option: string;\n  }[];\n};\n\nexport type ApiPreparedInlineMessage = {\n  queryId: string;\n  result: ApiBotInlineResult | ApiBotInlineMediaResult;\n  peerTypes: ApiInlineQueryPeerType[];\n  cacheTime: number;\n};\n\nexport type ApiSearchPostsFlood = {\n  query?: string;\n  queryIsFree?: boolean;\n  totalDaily: number;\n  remains: number;\n  waitTill?: number;\n  starsAmount: number;\n};\n\nexport type LinkContext = {\n  type: 'message';\n  threadId?: ThreadId;\n  chatId: string;\n  messageId: number;\n};\n\nexport const MAIN_THREAD_ID = -1;\n\n// `Symbol` can not be transferred from worker\nexport const MESSAGE_DELETED = 'MESSAGE_DELETED';\n","import { getGlobal } from '../global';\n\nimport {\n  APP_CODE_NAME,\n  DEBUG, IS_MOCKED_CLIENT,\n} from '../config';\nimport { IS_TAURI } from './browser/globalEnvironment';\nimport { hasStoredSession } from './sessions';\n\nconst WEBSYNC_URLS = [\n  't.me',\n  'telegram.me',\n].map((domain) => `https://${domain}/_websync_?`);\nconst WEBSYNC_VERSION = `${APP_VERSION} ${APP_CODE_NAME}`;\nconst WEBSYNC_KEY = 'tgme_sync';\nconst WEBSYNC_TIMEOUT = 86400;\n\nconst getTs = () => {\n  return Math.floor(Number(new Date()) / 1000);\n};\n\nconst saveSync = (authed: boolean) => {\n  const ts = getTs();\n  localStorage.setItem(WEBSYNC_KEY, JSON.stringify({\n    canRedirect: authed,\n    ts,\n  }));\n};\n\nlet lastTimeout: NodeJS.Timeout | undefined;\n\nexport const forceWebsync = (authed: boolean) => {\n  if (IS_MOCKED_CLIENT || IS_TAURI) return undefined;\n  const currentTs = getTs();\n\n  const { canRedirect, ts } = JSON.parse(localStorage.getItem(WEBSYNC_KEY) || '{}');\n\n  if (canRedirect !== authed || ts + WEBSYNC_TIMEOUT <= currentTs) {\n    return Promise.all(WEBSYNC_URLS.map((url) => {\n      return new Promise<void>((resolve, reject) => {\n        const script = document.createElement('script');\n\n        const removeElement = () => Boolean(document.body.removeChild(script));\n\n        script.src = url + new URLSearchParams({\n          authed: Number(authed).toString(),\n          version: WEBSYNC_VERSION,\n        }).toString();\n\n        document.body.appendChild(script);\n\n        script.onload = () => {\n          saveSync(authed);\n          removeElement();\n          if (lastTimeout) {\n            clearTimeout(lastTimeout);\n            lastTimeout = undefined;\n          }\n          startWebsync();\n          resolve();\n        };\n\n        script.onerror = () => {\n          removeElement();\n          reject();\n        };\n      });\n    }));\n  } else {\n    return Promise.resolve();\n  }\n};\n\nexport function stopWebsync() {\n  if (DEBUG || IS_TAURI) return;\n\n  if (lastTimeout) clearTimeout(lastTimeout);\n}\n\nexport function startWebsync() {\n  if (DEBUG || IS_TAURI) {\n    return;\n  }\n\n  if (lastTimeout !== undefined) return;\n  const currentTs = getTs();\n\n  const { ts } = JSON.parse(localStorage.getItem(WEBSYNC_KEY) || '{}');\n\n  const timeout = WEBSYNC_TIMEOUT - (currentTs - ts);\n\n  lastTimeout = setTimeout(() => {\n    const { authState } = getGlobal();\n\n    const authed = authState === 'authorizationStateReady' || hasStoredSession();\n    forceWebsync(authed);\n  }, Math.max(0, timeout * 1000));\n}\n\nexport function clearWebsync() {\n  localStorage.removeItem(WEBSYNC_KEY);\n}\n","import type { TeactNode } from '../../lib/teact/teact';\nimport { getActions } from '../../global';\n\nimport type { ThreadId } from '../../types';\nimport { ApiMessageEntityTypes } from '../../api/types';\n\nimport { IS_TAURI } from '../../util/browser/globalEnvironment';\nimport { ensureProtocol, getUnicodeUrl, isMixedScriptUrl } from '../../util/browser/url';\nimport buildClassName from '../../util/buildClassName';\n\nimport useLastCallback from '../../hooks/useLastCallback';\n\ntype OwnProps = {\n  url?: string;\n  text: string;\n  className?: string;\n  children?: TeactNode;\n  isRtl?: boolean;\n  shouldSkipModal?: boolean;\n  chatId?: string;\n  messageId?: number;\n  threadId?: ThreadId;\n  entityType?: ApiMessageEntityTypes.Url | ApiMessageEntityTypes.TextUrl |\n    `${ApiMessageEntityTypes.TextUrl}` | `${ApiMessageEntityTypes.Url}`;\n};\n\nconst SafeLink = ({\n  url,\n  text,\n  className,\n  children,\n  isRtl,\n  shouldSkipModal,\n  chatId,\n  messageId,\n  threadId,\n  entityType = ApiMessageEntityTypes.Url,\n}: OwnProps) => {\n  const { openUrl } = getActions();\n\n  const content = children || text;\n  const isRegularLink = url === text;\n\n  const handleClick = useLastCallback((e: React.MouseEvent<HTMLAnchorElement, MouseEvent>) => {\n    if (!url) return true;\n\n    e.preventDefault();\n\n    const isTrustedLink = isRegularLink && !isMixedScriptUrl(url);\n    openUrl({\n      url,\n      shouldSkipModal: shouldSkipModal || isTrustedLink,\n      ...(chatId && messageId && {\n        linkContext: { type: 'message', chatId, threadId, messageId },\n      }),\n    });\n\n    return false;\n  });\n\n  if (!url) {\n    return undefined;\n  }\n\n  const classNames = buildClassName(\n    className || 'text-entity-link',\n    isRegularLink && 'word-break-all',\n  );\n\n  return (\n    <a\n      href={ensureProtocol(url)}\n      title={getUnicodeUrl(url)}\n      target={IS_TAURI ? '_self' : '_blank'}\n      rel=\"noopener noreferrer\"\n      className={classNames}\n      onClick={handleClick}\n      dir={isRtl ? 'rtl' : 'auto'}\n      data-entity-type={entityType}\n    >\n      {content}\n    </a>\n  );\n};\n\nexport default SafeLink;\n","/**\n * A Map that has a limited size. When the limit is reached, the oldest entry is removed.\n * Ignores last access time, only cares about insertion order.\n */\nexport default class LimitedMap<K, V> {\n  private map: Map<K, V>;\n\n  private insertionQueue: Set<K>;\n\n  constructor(private limit: number) {\n    this.map = new Map();\n    this.insertionQueue = new Set<K>();\n  }\n\n  public get(key: K): V | undefined {\n    return this.map.get(key);\n  }\n\n  public set(key: K, value: V): this {\n    if (this.map.size === this.limit) {\n      const keyToRemove = Array.from(this.insertionQueue).shift();\n      if (keyToRemove) {\n        this.map.delete(keyToRemove);\n        this.insertionQueue.delete(keyToRemove);\n      }\n    }\n\n    this.map.set(key, value);\n    this.insertionQueue.add(key);\n\n    return this;\n  }\n\n  public has(key: K): boolean {\n    return this.map.has(key);\n  }\n\n  public delete(key: K): boolean {\n    const result = this.map.delete(key);\n    if (result) {\n      this.insertionQueue.delete(key);\n    }\n    return result;\n  }\n\n  public clear(): void {\n    this.map.clear();\n    this.insertionQueue.clear();\n  }\n\n  public forEach(callbackfn: (value: V, key: K, map: Map<K, V>) => void, thisArg?: unknown): void {\n    this.map.forEach(callbackfn, thisArg);\n  }\n\n  public get size(): number {\n    return this.map.size;\n  }\n\n  public get [Symbol.toStringTag](): string {\n    return this.map[Symbol.toStringTag];\n  }\n\n  public [Symbol.iterator](): IterableIterator<[K, V]> {\n    return this.map[Symbol.iterator]();\n  }\n\n  public entries(): IterableIterator<[K, V]> {\n    return this.map.entries();\n  }\n\n  public keys(): IterableIterator<K> {\n    return this.map.keys();\n  }\n\n  public values(): IterableIterator<V> {\n    return this.map.values();\n  }\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"fWE9Tkfe\",\"progress\":\"F0JPgXgb\",\"button\":\"B94KQ3c0\",\"symbol\":\"wapdILU7\",\"sparkle\":\"AS3Scly3\",\"noAnimation\":\"caUR_u_a\"};","import { memo } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\nimport buildStyle from '../../util/buildStyle';\n\nimport styles from './Sparkles.module.scss';\n\ntype ButtonParameters = {\n  preset: 'button';\n};\n\ntype ProgressParameters = {\n  preset: 'progress';\n};\n\ntype PresetParameters = ButtonParameters | ProgressParameters;\n\ntype OwnProps = {\n  className?: string;\n  style?: string;\n  noAnimation?: boolean;\n} & PresetParameters;\n\nconst SYMBOL = '';\nconst ANIMATION_DURATION = 5;\n\n// Values are in percents\nconst BUTTON_POSITIONS = [{\n  x: 20,\n  y: 0,\n  size: 100,\n  durationShift: 10,\n}, {\n  x: 15,\n  y: 15,\n  size: 75,\n  durationShift: 70,\n}, {\n  x: 10,\n  y: 35,\n  size: 75,\n  durationShift: 90,\n}, {\n  x: 20,\n  y: 70,\n  size: 125,\n  durationShift: 30,\n}, {\n  x: 40,\n  y: 10,\n  size: 125,\n  durationShift: 0,\n}, {\n  x: 45,\n  y: 60,\n  size: 75,\n  durationShift: 60,\n}, {\n  x: 60,\n  y: -10,\n  size: 100,\n  durationShift: 20,\n}, {\n  x: 55,\n  y: 40,\n  size: 75,\n  durationShift: 60,\n}, {\n  x: 70,\n  y: 65,\n  size: 100,\n  durationShift: 90,\n}, {\n  x: 80,\n  y: 10,\n  size: 75,\n  durationShift: 30,\n}, {\n  x: 80,\n  y: 45,\n  size: 125,\n  durationShift: 0,\n}];\nconst PROGRESS_POSITIONS = generateRandomProgressPositions(100);\n\nconst Sparkles = ({\n  className,\n  style,\n  noAnimation,\n  ...presetSettings\n}: OwnProps) => {\n  if (presetSettings.preset === 'button') {\n    return (\n      <div\n        className={buildClassName(styles.root, styles.button, className, noAnimation && styles.noAnimation)}\n        style={style}\n      >\n        {BUTTON_POSITIONS.map((position) => {\n          const shiftX = Math.cos(Math.atan2(-50 + position.y, -50 + position.x)) * 100;\n          const shiftY = Math.sin(Math.atan2(-50 + position.y, -50 + position.x)) * 100;\n          return (\n            <div\n              className={styles.symbol}\n              style={buildStyle(\n                `top: ${position.y}%`,\n                `left: ${position.x}%`,\n                `--_duration-shift: ${(-position.durationShift / 100) * ANIMATION_DURATION}s`,\n                `--_shift-x: ${shiftX}%`,\n                `--_shift-y: ${shiftY}%`,\n                `scale: ${position.size}%`,\n              )}\n              aria-hidden=\"true\"\n            >\n              {SYMBOL}\n            </div>\n          );\n        })}\n      </div>\n    );\n  }\n\n  if (presetSettings.preset === 'progress') {\n    return (\n      <div className={buildClassName(styles.root, styles.progress, className)} style={style}>\n        {PROGRESS_POSITIONS.map((position) => {\n          return (\n            <div\n              className={styles.symbol}\n              style={buildStyle(\n                `top: ${position.y}%`,\n                `left: ${position.x}%`,\n                `--_shift-x: ${position.velocityX}%`,\n                `--_shift-y: ${position.velocityY}%`,\n                `scale: ${position.scale}%`,\n                `--_duration-shift: ${(-position.durationShift / 100) * ANIMATION_DURATION}s`,\n              )}\n              aria-hidden=\"true\"\n            >\n              {SYMBOL}\n            </div>\n          );\n        })}\n      </div>\n    );\n  }\n\n  return undefined;\n};\n\nfunction generateRandomProgressPositions(count: number) {\n  const positions = [];\n  for (let i = 0; i < count; i++) {\n    positions.push({\n      x: Math.random() * 100,\n      y: Math.random() * 100,\n      velocityX: (Math.random() * 5 + 15) * 100,\n      velocityY: (Math.random() * 10 - 5) * 100,\n      scale: (Math.random() * 0.5 + 0.5) * 100,\n      durationShift: Math.random() * 100,\n    });\n  }\n  return positions;\n}\n\nexport default memo(Sparkles);\n","import { DEBUG } from '../config';\n\nexport const CLIPBOARD_ITEM_SUPPORTED = window.navigator.clipboard && window.ClipboardItem;\n\nconst textCopyEl = document.createElement('textarea');\ntextCopyEl.setAttribute('readonly', '');\ntextCopyEl.tabIndex = -1;\ntextCopyEl.className = 'visually-hidden';\n\nexport const copyTextToClipboard = (str: string): void => {\n  textCopyEl.value = str;\n  document.body.appendChild(textCopyEl);\n  const selection = document.getSelection();\n\n  if (selection) {\n    // Store previous selection\n    const rangeToRestore = selection.rangeCount > 0 && selection.getRangeAt(0);\n    textCopyEl.select();\n    document.execCommand('copy');\n    // Restore the original selection\n    if (rangeToRestore) {\n      selection.removeAllRanges();\n      selection.addRange(rangeToRestore);\n    }\n  }\n\n  document.body.removeChild(textCopyEl);\n};\n\nexport const copyHtmlToClipboard = (html: string, text: string): void => {\n  if (!window.navigator.clipboard?.write) {\n    copyTextToClipboard(text);\n    return;\n  }\n\n  window.navigator.clipboard.write([\n    new ClipboardItem({\n      'text/plain': new Blob([text], { type: 'text/plain' }),\n      'text/html': new Blob([html], { type: 'text/html' }),\n    }),\n  ]);\n};\n\nexport const copyImageToClipboard = (imageUrl?: string) => {\n  if (!imageUrl) return;\n  const canvas = document.createElement('canvas');\n  const ctx = canvas.getContext('2d');\n  const imageEl = new Image();\n  imageEl.onload = (e: Event) => {\n    if (ctx && e.currentTarget) {\n      const img = e.currentTarget as HTMLImageElement;\n      canvas.width = img.width;\n      canvas.height = img.height;\n      ctx.drawImage(img, 0, 0, img.width, img.height);\n      canvas.toBlob(copyBlobToClipboard, 'image/png', 1);\n    }\n  };\n\n  imageEl.src = imageUrl;\n};\n\nexport const copyTextToClipboardFromPromise = async (\n  getTextPromise: Promise<string | undefined>,\n  onSuccess: NoneToVoidFunction,\n  onFailure: NoneToVoidFunction,\n) => {\n  const copyTextToClipboardFallback = async () => {\n    try {\n      const text = await getTextPromise;\n      if (text) {\n        copyTextToClipboard(text);\n      } else {\n        onFailure();\n      }\n      return Boolean(text);\n    } catch {\n      onFailure();\n      return false;\n    }\n  };\n  if (!CLIPBOARD_ITEM_SUPPORTED || !navigator.clipboard.write) {\n    if (await copyTextToClipboardFallback()) onSuccess();\n    return;\n  }\n  try {\n    let hasGetDataError = false;\n    const rejectGetDataError = () => Promise.reject(new Error('GET_DATA_ERROR'));\n\n    const clipboardTextItem = new ClipboardItem({\n      'text/plain': getTextPromise.then((text) => text || rejectGetDataError()).catch(() => {\n        hasGetDataError = true;\n        return '';\n      }),\n    });\n    await navigator.clipboard.write([clipboardTextItem]);\n    if (hasGetDataError) {\n      onFailure();\n      return;\n    }\n  } catch {\n    // Promises in ClipboardItem aren't supported in older Chrome versions\n    if (!await copyTextToClipboardFallback()) return;\n  }\n  onSuccess();\n};\n\nasync function copyBlobToClipboard(pngBlob: Blob | null) {\n  if (!pngBlob || !CLIPBOARD_ITEM_SUPPORTED) {\n    return;\n  }\n\n  try {\n    await window.navigator.clipboard.write?.([\n      new ClipboardItem({\n        [pngBlob.type]: pngBlob,\n      }),\n    ]);\n  } catch (error) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.error(error);\n    }\n  }\n}\n","import type { ElementRef } from '../../lib/teact/teact';\nimport type React from '../../lib/teact/teact';\nimport { memo } from '../../lib/teact/teact';\n\nimport type { ApiPeer, ApiPeerColor } from '../../api/types';\n\nimport buildClassName from '../../util/buildClassName';\nimport { getApiPeerColorClass, getPeerColorClass } from './helpers/peerColor';\n\nimport EmojiIconBackground from './embedded/EmojiIconBackground';\n\nimport styles from './PeerColorWrapper.module.scss';\n\ninterface OwnProps extends React.HTMLAttributes<HTMLDivElement> {\n  ref?: ElementRef<HTMLDivElement>;\n  peer?: ApiPeer;\n  peerColor?: ApiPeerColor;\n  noUserColors?: boolean;\n  shouldReset?: boolean;\n  className?: string;\n  emojiIconClassName?: string;\n  children: React.ReactNode;\n}\n\nfunction PeerColorWrapper({\n  peer, ref, peerColor, noUserColors,\n  shouldReset, className, emojiIconClassName,\n  children, ...otherProps\n}: OwnProps) {\n  const color = peerColor || peer?.color;\n\n  return (\n    <div\n      ref={ref}\n      className={buildClassName(\n        styles.root,\n        peer && getPeerColorClass(peer, noUserColors, shouldReset),\n        peerColor && getApiPeerColorClass(peerColor),\n        className,\n      )}\n\n      {...otherProps}\n    >\n      {color?.backgroundEmojiId && (\n        <EmojiIconBackground\n          className={emojiIconClassName}\n          emojiDocumentId={color.backgroundEmojiId}\n        />\n      )}\n      {children}\n    </div>\n  );\n}\n\nexport default memo(PeerColorWrapper);\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"nRjVJOQv\"};","import type { TeactNode } from '../../lib/teact/teact';\n\nimport type {\n  ApiAttachment,\n  ApiMessage,\n  ApiMessageEntityTextUrl,\n  ApiPeer,\n  ApiStory,\n  ApiTypeStory,\n} from '../../api/types';\nimport type {\n  ApiPoll, ApiWebPage, MediaContainer, StatefulMediaContent,\n} from '../../api/types/messages';\nimport type { ThreadId } from '../../types';\nimport type { LangFn } from '../../util/localization';\nimport type { GlobalState } from '../types';\nimport { ApiMessageEntityTypes, MAIN_THREAD_ID } from '../../api/types';\n\nimport {\n  LOTTIE_STICKER_MIME_TYPE,\n  RE_LINK_TEMPLATE,\n  SERVICE_NOTIFICATIONS_USER_ID,\n  SUPPORTED_AUDIO_CONTENT_TYPES,\n  SUPPORTED_PHOTO_CONTENT_TYPES,\n  SUPPORTED_VIDEO_CONTENT_TYPES,\n  TME_LINK_PREFIX,\n  VERIFICATION_CODES_USER_ID,\n  VIDEO_STICKER_MIME_TYPE,\n} from '../../config';\nimport { areDeepEqual } from '../../util/areDeepEqual';\nimport { getCleanPeerId, isUserId } from '../../util/entities/ids';\nimport { areSortedArraysIntersecting, unique } from '../../util/iteratees';\nimport { isLocalMessageId } from '../../util/keys/messageKey';\nimport { getServerTime } from '../../util/serverTime';\nimport { getGlobal } from '../index';\nimport { selectPollFromMessage, selectWebPageFromMessage } from '../selectors';\nimport { getMainUsername } from './users';\n\nconst RE_LINK = new RegExp(RE_LINK_TEMPLATE, 'i');\n\nexport function getMessageHtmlId(messageId: number, index?: number) {\n  const parts = ['message', messageId.toString().replace('.', '-'), index].filter(Boolean);\n  return parts.join('-');\n}\n\nexport function getMessageOriginalId(message: ApiMessage) {\n  return message.previousLocalId || message.id;\n}\n\nexport function getMessageTranscription(message: ApiMessage) {\n  const { transcriptionId } = message;\n  const global = getGlobal();\n\n  return transcriptionId && global.transcriptions[transcriptionId]?.text;\n}\n\nexport function hasMessageText(message: MediaContainer) {\n  const {\n    action, text, sticker, photo, video, audio, voice, document, pollId, todo,\n    webPage, contact, invoice, location, game, storyData, giveaway, giveawayResults, paidMedia,\n  } = message.content;\n\n  return Boolean(text) || !(\n    sticker || photo || video || audio || voice || document || contact || pollId || todo || webPage\n    || invoice || location || game || storyData || giveaway || giveawayResults\n    || paidMedia || action?.type === 'phoneCall'\n  );\n}\n\nexport function getMessageStatefulContent(global: GlobalState, message: ApiMessage): StatefulMediaContent {\n  const poll = selectPollFromMessage(global, message);\n  const webPage = selectWebPageFromMessage(global, message);\n\n  const { peerId: storyPeerId, id: storyId } = message.content.storyData || {};\n  const story = storyId && storyPeerId ? global.stories.byPeerId[storyPeerId]?.byId[storyId] : undefined;\n\n  return groupStatefulContent({ poll, story, webPage });\n}\n\nexport function groupStatefulContent({\n  poll,\n  story,\n  webPage,\n}: {\n  poll?: ApiPoll;\n  story?: ApiTypeStory;\n  webPage?: ApiWebPage;\n}) {\n  return {\n    poll,\n    story: story && 'content' in story ? story : undefined,\n    webPage,\n  };\n}\n\nexport function getMessageText(message: MediaContainer) {\n  return hasMessageText(message) ? message.content.text : undefined;\n}\n\nexport function getMessageTextWithFallback(lang: LangFn, message: MediaContainer) {\n  return hasMessageText(message) ? message.content.text || { text: lang('MessageUnsupported') } : undefined;\n}\n\nexport function getMessageCustomShape(message: ApiMessage): boolean {\n  const {\n    text, sticker, photo, video, audio, voice,\n    document, pollId, webPage, contact, action,\n    game, invoice, location, storyData,\n  } = message.content;\n\n  if (sticker || (video?.isRound)) {\n    return true;\n  }\n\n  if (!text || photo || video || audio || voice || document || pollId || webPage || contact || action || game\n    || invoice || location || storyData) {\n    return false;\n  }\n\n  const hasOtherFormatting = text?.entities?.some((entity) => entity.type !== ApiMessageEntityTypes.CustomEmoji);\n\n  return Boolean(text.emojiOnlyCount && !hasOtherFormatting);\n}\n\nexport function getMessageSingleRegularEmoji(message: MediaContainer) {\n  const { text } = message.content;\n\n  if (!text || text.entities?.length || text.emojiOnlyCount !== 1) {\n    return undefined;\n  }\n\n  return text.text;\n}\n\nexport function getMessageSingleCustomEmoji(message: MediaContainer): string | undefined {\n  const { text } = message.content;\n\n  const firstEntity = text?.entities?.[0];\n  if (text?.entities?.length !== 1\n    || firstEntity?.type !== ApiMessageEntityTypes.CustomEmoji\n    || firstEntity.offset !== 0\n    || firstEntity.length !== text.text.length) {\n    return undefined;\n  }\n\n  return firstEntity.documentId;\n}\n\nexport function getFirstLinkInMessage(message: ApiMessage) {\n  const { text } = message.content;\n\n  let match: RegExpMatchArray | null | undefined;\n  if (text?.entities) {\n    const firstTextUrl = text.entities.find((entity): entity is ApiMessageEntityTextUrl => (\n      entity.type === ApiMessageEntityTypes.TextUrl\n    ));\n    if (firstTextUrl) {\n      match = firstTextUrl.url.match(RE_LINK);\n    }\n\n    if (!match) {\n      const firstUrl = text.entities.find((entity) => entity.type === ApiMessageEntityTypes.Url);\n      if (firstUrl) {\n        const { offset, length } = firstUrl;\n        match = text.text.substring(offset, offset + length).match(RE_LINK);\n      }\n    }\n  }\n\n  if (!match && text) {\n    match = text.text.match(RE_LINK);\n  }\n\n  if (!match) {\n    return undefined;\n  }\n\n  return {\n    url: match[0],\n    domain: match[3],\n  };\n}\n\nexport function matchLinkInMessageText(message: ApiMessage) {\n  const { text } = message.content;\n  const match = text && text.text.match(RE_LINK);\n\n  if (!match) {\n    return undefined;\n  }\n\n  return {\n    url: match[0],\n    domain: match[3],\n  };\n}\n\nexport function isOwnMessage(message: ApiMessage) {\n  return message.isOutgoing;\n}\n\nexport function isReplyToMessage(message: ApiMessage) {\n  return Boolean(message.replyInfo?.type === 'message');\n}\n\nexport function isForwardedMessage(message: ApiMessage) {\n  return Boolean(message.forwardInfo || message.content.storyData);\n}\n\nexport function isActionMessage(message: ApiMessage) {\n  return Boolean(message.content.action);\n}\n\nexport function isServiceNotificationMessage(message: ApiMessage) {\n  return message.chatId === SERVICE_NOTIFICATIONS_USER_ID && Math.round(message.id) !== message.id;\n}\n\nexport function isAnonymousOwnMessage(message: ApiMessage) {\n  return Boolean(message.senderId) && !isUserId(message.senderId) && isOwnMessage(message);\n}\n\nexport function getSendingState(message: ApiMessage) {\n  if (!message.sendingState) {\n    return 'succeeded';\n  }\n\n  return message.sendingState === 'messageSendingStateFailed' ? 'failed' : 'pending';\n}\n\nexport function isMessageLocal(message: ApiMessage) {\n  return isLocalMessageId(message.id);\n}\n\nexport function isMessageFailed(message: ApiMessage) {\n  return message.sendingState === 'messageSendingStateFailed';\n}\n\nexport function isHistoryClearMessage(message: ApiMessage) {\n  return message.content.action && message.content.action.type === 'historyClear';\n}\n\nexport function isGeoLiveExpired(message: ApiMessage) {\n  const { location } = message.content;\n  if (location?.mediaType !== 'geoLive') return false;\n  return getServerTime() - (message.date || 0) >= location.period;\n}\n\nexport function isMessageTranslatable(message: ApiMessage, allowOutgoing?: boolean) {\n  const { text, game } = message.content;\n\n  const isLocal = isMessageLocal(message);\n  const isServiceNotification = isServiceNotificationMessage(message);\n  const isAction = isActionMessage(message);\n\n  return Boolean(text?.text.length && !text.emojiOnlyCount && !game && (allowOutgoing || !message.isOutgoing)\n    && !isLocal && !isServiceNotification && !isAction && !message.isScheduled);\n}\n\nexport function getMessageSingleInlineButton(message: ApiMessage) {\n  return message.inlineButtons?.length === 1\n    && message.inlineButtons[0].length === 1\n    && message.inlineButtons[0][0];\n}\n\nexport function orderHistoryIds(listedIds: number[]) {\n  return listedIds.sort((a, b) => a - b);\n}\n\nexport function orderPinnedIds(pinnedIds: number[]) {\n  return pinnedIds.sort((a, b) => b - a);\n}\n\nexport function mergeIdRanges(ranges: number[][], idsUpdate: number[]): number[][] {\n  let hasIntersection = false;\n  let newOutlyingLists = ranges.length ? ranges.map((list) => {\n    if (areSortedArraysIntersecting(list, idsUpdate) && !hasIntersection) {\n      hasIntersection = true;\n      return orderHistoryIds(unique(list.concat(idsUpdate)));\n    }\n    return list;\n  }) : [idsUpdate];\n\n  if (!hasIntersection) {\n    newOutlyingLists = newOutlyingLists.concat([idsUpdate]);\n  }\n\n  newOutlyingLists.sort((a, b) => a[0] - b[0]);\n\n  let length = newOutlyingLists.length;\n  for (let i = 0; i < length; i++) {\n    const array = newOutlyingLists[i];\n    const prevArray = newOutlyingLists[i - 1];\n\n    if (prevArray && (prevArray.includes(array[0]) || prevArray.includes(array[0] - 1))) {\n      newOutlyingLists[i - 1] = orderHistoryIds(unique(array.concat(prevArray)));\n      newOutlyingLists.splice(i, 1);\n\n      length--;\n      i--;\n    }\n  }\n\n  return newOutlyingLists;\n}\n\nexport function extractMessageText(message: ApiMessage | ApiStory, inChatList = false) {\n  const contentText = message.content.text;\n  if (!contentText) return undefined;\n\n  const { text } = contentText;\n  let { entities } = contentText;\n\n  if (text && 'chatId' in message) {\n    if (message.chatId === SERVICE_NOTIFICATIONS_USER_ID) {\n      const authCode = text.match(/^\\D*([\\d-]{5,7})\\D/)?.[1];\n      if (authCode) {\n        entities = [\n          ...entities || [],\n          {\n            type: inChatList ? ApiMessageEntityTypes.Spoiler : ApiMessageEntityTypes.Code,\n            offset: text.indexOf(authCode),\n            length: authCode.length,\n          },\n        ];\n        entities.sort((a, b) => (a.offset > b.offset ? 1 : -1));\n      }\n    }\n\n    if (inChatList && message.chatId === VERIFICATION_CODES_USER_ID && entities) {\n      // Wrap code entities in spoiler\n      const hasCodeEntities = entities.some((entity) => entity.type === ApiMessageEntityTypes.Code);\n      if (hasCodeEntities) {\n        const oldEntities = entities;\n        entities = [];\n\n        for (let i = 0; i < oldEntities.length; i++) {\n          const entity = oldEntities[i];\n          if (entity.type === ApiMessageEntityTypes.Code) {\n            entities.push({\n              type: ApiMessageEntityTypes.Spoiler,\n              offset: entity.offset,\n              length: entity.length,\n            });\n          }\n          entities.push(entity);\n        }\n      }\n    }\n  }\n\n  return { text, entities };\n}\n\nexport function isExpiredMessage(message: ApiMessage) {\n  return message.content.action?.type === 'expired';\n}\n\nexport function hasMessageTtl(message: ApiMessage) {\n  return message.content?.ttlSeconds !== undefined;\n}\n\nexport function getAttachmentMediaType(attachment: ApiAttachment) {\n  if (SUPPORTED_AUDIO_CONTENT_TYPES.has(attachment.mimeType)) {\n    return 'audio';\n  }\n\n  if (attachment.shouldSendAsFile) return 'file';\n\n  if (SUPPORTED_PHOTO_CONTENT_TYPES.has(attachment.mimeType)) {\n    return 'photo';\n  }\n\n  if (SUPPORTED_VIDEO_CONTENT_TYPES.has(attachment.mimeType)) {\n    return 'video';\n  }\n\n  return 'file';\n}\n\nexport function isUploadingFileSticker(attachment: ApiAttachment) {\n  return attachment ? (attachment.mimeType === 'image/webp' || attachment.mimeType === LOTTIE_STICKER_MIME_TYPE\n    || attachment.mimeType === VIDEO_STICKER_MIME_TYPE) : undefined;\n}\n\nexport function getMessageLink(peer: ApiPeer, topicId?: ThreadId, messageId?: number) {\n  const chatUsername = getMainUsername(peer);\n\n  const normalizedId = getCleanPeerId(peer.id);\n\n  const chatPart = chatUsername || `c/${normalizedId}`;\n  const topicPart = topicId && topicId !== MAIN_THREAD_ID ? `/${topicId}` : '';\n  const messagePart = messageId ? `/${messageId}` : '';\n  return `${TME_LINK_PREFIX}${chatPart}${topicPart}${messagePart}`;\n}\n\nexport function splitMessagesForForwarding(messages: ApiMessage[], limit: number): ApiMessage[][] {\n  const result: ApiMessage[][] = [];\n  let currentArr: ApiMessage[] = [];\n\n  // Group messages by `groupedId`\n  messages.reduce<ApiMessage[][]>((acc, message) => {\n    const lastGroup = acc[acc.length - 1];\n    if (message.groupedId && lastGroup?.[0]?.groupedId === message.groupedId) {\n      lastGroup.push(message);\n      return acc;\n    }\n\n    acc.push([message]);\n    return acc;\n  }, []).forEach((batch) => {\n    // Fit them into `limit` size\n    if (currentArr.length + batch.length > limit) {\n      result.push(currentArr);\n      currentArr = [];\n    }\n\n    currentArr.push(...batch);\n  });\n\n  if (currentArr.length) {\n    result.push(currentArr);\n  }\n\n  return result;\n}\n\nexport interface SuggestedChangesInfo {\n  isNewText: boolean;\n  isNewPrice: boolean;\n  isNewTime: boolean;\n  isNewMedia: boolean;\n}\n\nexport function getSuggestedChangesInfo(\n  message: ApiMessage,\n  originalMessage?: ApiMessage,\n): SuggestedChangesInfo | undefined {\n  if (!message.suggestedPostInfo || message.replyInfo?.type !== 'message'\n    || !message.replyInfo?.replyToMsgId || !originalMessage) {\n    return undefined;\n  }\n\n  if (!originalMessage.suggestedPostInfo) {\n    return undefined;\n  }\n\n  const original = originalMessage.suggestedPostInfo;\n  const suggested = message.suggestedPostInfo;\n\n  const originalContent = originalMessage.content;\n  const suggestedContent = message.content;\n  const { text: originalText, ...originalMediaContent } = originalContent;\n  const { text: suggestedText, ...suggestedMediaContent } = suggestedContent;\n\n  const isNewText = !areDeepEqual(originalText, suggestedText);\n  const isNewMedia = !areDeepEqual(originalMediaContent, suggestedMediaContent);\n\n  const originalPrice = original.price?.amount;\n  const suggestedPrice = suggested.price?.amount;\n  const isNewPrice = originalPrice !== suggestedPrice;\n\n  const originalTime = original.scheduleDate;\n  const suggestedTime = suggested.scheduleDate;\n  const isNewTime = originalTime !== suggestedTime;\n\n  if (!isNewText && !isNewPrice && !isNewTime && !isNewMedia) {\n    return undefined;\n  }\n\n  return {\n    isNewText,\n    isNewPrice,\n    isNewTime,\n    isNewMedia,\n  };\n}\n\nexport function getSuggestedChangesActionText(\n  lang: LangFn,\n  message: ApiMessage,\n  originalMessage?: ApiMessage,\n  isOutgoing?: boolean,\n  senderLink?: TeactNode,\n): TeactNode | undefined {\n  const changesInfo = getSuggestedChangesInfo(message, originalMessage);\n  if (!changesInfo) {\n    return undefined;\n  }\n\n  const changesParts: string[] = [];\n  if (changesInfo.isNewPrice) changesParts.push(lang('ActionSuggestedChangesPrice'));\n  if (changesInfo.isNewTime) changesParts.push(lang('ActionSuggestedChangesTime'));\n  if (changesInfo.isNewText) changesParts.push(lang('ActionSuggestedChangesText'));\n  if (changesInfo.isNewMedia) changesParts.push(lang('ActionSuggestedChangesMedia'));\n\n  const changesText = lang.conjunction(changesParts);\n\n  const langKey = isOutgoing ? 'ActionSuggestedChangesOutgoing' : 'ActionSuggestedChangesIncoming';\n  return lang(langKey, {\n    changes: changesText,\n    user: senderLink,\n  }, {\n    withNodes: true,\n    withMarkdown: true,\n  });\n}\n","import type { ElementRef } from '../../lib/teact/teact';\nimport { useEffect, useLayoutEffect, useState } from '../../lib/teact/teact';\n\nimport useLastCallback from '../useLastCallback';\nimport useResizeObserver from '../useResizeObserver';\n\nconst UPDATE_DEBOUNCE = 50; // ms\n\n/**\n * @param property animateable property\n */\nexport default function useStyleObserver(\n  ref: ElementRef<HTMLElement>,\n  property: string,\n  debounce = UPDATE_DEBOUNCE,\n  isDisabled?: boolean,\n) {\n  const [value, setValue] = useState<string | undefined>();\n\n  const updateValue = useLastCallback(() => {\n    if (!ref.current || isDisabled) {\n      setValue(undefined);\n      return;\n    }\n\n    const computedValue = getComputedStyle(ref.current).getPropertyValue(property).trim();\n    setValue(computedValue);\n  });\n\n  // Element does not receive `transitionend` event if parent has `display: none`.\n  // We will receive `resize` event when parent is shown again.\n  useResizeObserver(ref, updateValue, isDisabled);\n\n  useLayoutEffect(() => {\n    const el = ref.current;\n    if (!el || isDisabled) {\n      return undefined;\n    }\n\n    el.style.setProperty('transition', `${debounce}ms ${property} linear`, 'important');\n\n    return () => {\n      el.style.removeProperty('transition');\n    };\n  }, [debounce, isDisabled, property, ref]);\n\n  useEffect(() => {\n    const el = ref.current;\n    if (!el) {\n      return undefined;\n    }\n\n    updateValue();\n\n    if (isDisabled) {\n      return undefined;\n    }\n\n    function handleTransitionEnd(e: TransitionEvent) {\n      if (e.propertyName !== property) return;\n      updateValue();\n    }\n\n    el.addEventListener('transitionend', handleTransitionEnd);\n\n    return () => {\n      el.removeEventListener('transitionend', handleTransitionEnd);\n    };\n  }, [isDisabled, property, ref, updateValue]);\n\n  return value;\n}\n","import type { ElementRef } from '../../lib/teact/teact';\nimport { useMemo } from '../../lib/teact/teact';\n\nimport { prepareHexColor } from '../../util/themeStyle';\nimport useStyleObserver from '../element/useStyleObserver';\n\nconst DEBOUNCE = 50; // ms\n\n// Style observer that returns hex color value of the property\nexport default function useDynamicColorListener(\n  ref: ElementRef<HTMLElement>,\n  property = 'color',\n  isDisabled?: boolean,\n) {\n  const value = useStyleObserver(ref, property, DEBOUNCE, isDisabled);\n  const hexColor = useMemo(() => (value ? prepareHexColor(value) : undefined), [value]);\n\n  return hexColor;\n}\n","type Parts = (string | false | undefined)[];\ntype PartsWithGlobals = (string | false | undefined | string[])[];\ntype ClassNameBuilder =\n  ((elementName: string, ...modifiers: PartsWithGlobals) => string)\n  & Record<string, string>;\n\nexport default function buildClassName(...parts: Parts) {\n  return parts.filter(Boolean).join(' ');\n}\n\nexport function createClassNameBuilder(componentName: string) {\n  return ((elementName: string, ...modifiers: PartsWithGlobals) => {\n    const baseName = elementName === '&' ? componentName : `${componentName}__${elementName}`;\n\n    return modifiers.reduce<string[]>((acc, modifier) => {\n      if (modifier) {\n        // A bit hacky way to pass global class names\n        if (Array.isArray(modifier)) {\n          acc.push(...modifier);\n        } else {\n          acc.push(`${baseName}--${modifier}`);\n        }\n      }\n\n      return acc;\n    }, [baseName]).join(' ');\n  }) as ClassNameBuilder;\n}\n","import type { ElementRef, FC } from '../../lib/teact/teact';\nimport { memo, useRef, useState } from '../../lib/teact/teact';\nimport { getGlobal } from '../../global';\n\nimport type { ObserveFn } from '../../hooks/useIntersectionObserver';\nimport { ApiMessageEntityTypes } from '../../api/types';\n\nimport { selectIsAlwaysHighPriorityEmoji } from '../../global/selectors';\nimport buildClassName from '../../util/buildClassName';\nimport safePlay from '../../util/safePlay';\n\nimport useDynamicColorListener from '../../hooks/stickers/useDynamicColorListener';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useCustomEmoji from './hooks/useCustomEmoji';\n\nimport StickerView from './StickerView';\n\nimport styles from './CustomEmoji.module.scss';\n\nimport blankImg from '../../assets/blank.png';\n\ntype OwnProps = {\n  ref?: ElementRef<HTMLDivElement>;\n  documentId: string;\n  className?: string;\n  style?: string;\n  size?: number;\n  isBig?: boolean;\n  noPlay?: boolean;\n  noVideoOnMobile?: boolean;\n  loopLimit?: number;\n  isSelectable?: boolean;\n  withSharedAnimation?: boolean;\n  sharedCanvasRef?: ElementRef<HTMLCanvasElement>;\n  sharedCanvasHqRef?: ElementRef<HTMLCanvasElement>;\n  withTranslucentThumb?: boolean;\n  shouldPreloadPreview?: boolean;\n  forceOnHeavyAnimation?: boolean;\n  forceAlways?: boolean;\n  observeIntersectionForLoading?: ObserveFn;\n  observeIntersectionForPlaying?: ObserveFn;\n  onClick?: NoneToVoidFunction;\n  onAnimationEnd?: NoneToVoidFunction;\n};\n\nconst STICKER_SIZE = 20;\n\nconst CustomEmoji: FC<OwnProps> = ({\n  ref,\n  documentId,\n  className,\n  style,\n  size = STICKER_SIZE,\n  isBig,\n  noPlay,\n  noVideoOnMobile,\n  loopLimit,\n  isSelectable,\n  withSharedAnimation,\n  sharedCanvasRef,\n  sharedCanvasHqRef,\n  withTranslucentThumb,\n  shouldPreloadPreview,\n  forceAlways,\n  forceOnHeavyAnimation,\n  observeIntersectionForLoading,\n  observeIntersectionForPlaying,\n  onClick,\n  onAnimationEnd,\n}) => {\n  let containerRef = useRef<HTMLDivElement>();\n  if (ref) {\n    containerRef = ref;\n  }\n\n  // An alternative to `withGlobal` to avoid adding numerous global containers\n  const { customEmoji, canPlay } = useCustomEmoji(documentId);\n\n  const loopCountRef = useRef(0);\n  const [shouldPlay, setShouldPlay] = useState(true);\n\n  const hasCustomColor = customEmoji?.shouldUseTextColor;\n  const customColor = useDynamicColorListener(containerRef, undefined, !hasCustomColor);\n\n  const handleVideoEnded = useLastCallback((e) => {\n    if (!loopLimit) return;\n\n    loopCountRef.current += 1;\n\n    if (loopCountRef.current >= loopLimit) {\n      setShouldPlay(false);\n      e.currentTarget.currentTime = 0;\n    } else {\n      // Loop manually\n      safePlay(e.currentTarget);\n    }\n  });\n\n  const handleStickerLoop = useLastCallback(() => {\n    if (!loopLimit) return;\n\n    loopCountRef.current += 1;\n\n    if (loopCountRef.current >= loopLimit) {\n      setShouldPlay(false);\n    }\n  });\n\n  const isHq = customEmoji?.stickerSetInfo && selectIsAlwaysHighPriorityEmoji(getGlobal(), customEmoji.stickerSetInfo);\n\n  return (\n    <div\n      ref={containerRef}\n      className={buildClassName(\n        styles.root,\n        className,\n        'custom-emoji',\n        'emoji',\n      )}\n      onClick={onClick}\n      onAnimationEnd={onAnimationEnd}\n      data-entity-type={ApiMessageEntityTypes.CustomEmoji}\n      data-document-id={documentId}\n      data-alt={customEmoji?.emoji}\n      style={style}\n    >\n      {isSelectable && (\n        <img\n          className={styles.highlightCatch}\n          src={blankImg}\n          alt={customEmoji?.emoji}\n          data-entity-type={ApiMessageEntityTypes.CustomEmoji}\n          data-document-id={documentId}\n          draggable={false}\n        />\n      )}\n      {!customEmoji ? (\n        <div className={buildClassName(styles.placeholder)} draggable={false} />\n      ) : (\n        <StickerView\n          containerRef={containerRef}\n          sticker={customEmoji}\n          isSmall={!isBig}\n          size={size}\n          noPlay={noPlay || !(shouldPlay && canPlay)}\n          noVideoOnMobile={noVideoOnMobile}\n          thumbClassName={styles.thumb}\n          fullMediaClassName={styles.media}\n          shouldLoop\n          loopLimit={loopLimit}\n          shouldPreloadPreview={shouldPreloadPreview || noPlay || !canPlay}\n          forceOnHeavyAnimation={forceOnHeavyAnimation}\n          forceAlways={forceAlways}\n          observeIntersectionForLoading={observeIntersectionForLoading}\n          observeIntersectionForPlaying={observeIntersectionForPlaying}\n          withSharedAnimation={withSharedAnimation}\n          sharedCanvasRef={isHq ? sharedCanvasHqRef : sharedCanvasRef}\n          withTranslucentThumb={withTranslucentThumb}\n          onVideoEnded={handleVideoEnded}\n          onAnimatedStickerLoop={handleStickerLoop}\n          customColor={customColor}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default memo(CustomEmoji);\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"CEFe1FhH\",\"placeholder\":\"DKi1177s\",\"thumb\":\"O_TaDxWg\",\"media\":\"wqju02hR\",\"highlight-catch\":\"a8dMNkh3\",\"highlightCatch\":\"a8dMNkh3\"};","import { CONTENT_TYPES_WITH_PREVIEW } from '../config';\nimport { pause } from './schedulers';\n\n// Polyfill for Safari: `File` is not available in web worker\nif (typeof File === 'undefined') {\n  self.File = class extends Blob {\n    name: string;\n\n    constructor(fileBits: BlobPart[], fileName: string, options?: FilePropertyBag) {\n      if (options) {\n        const { type, ...rest } = options;\n        super(fileBits, { type });\n        Object.assign(this, rest);\n      } else {\n        super(fileBits);\n      }\n\n      this.name = fileName;\n    }\n  } as typeof File;\n}\n\nexport function blobToDataUri(blob: Blob): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n\n    reader.onload = (e: ProgressEvent<FileReader>) => {\n      const { result } = e.target || {};\n      if (typeof result === 'string') {\n        resolve(result);\n      }\n\n      reject(new Error('Failed to read blob'));\n    };\n\n    reader.onerror = reject;\n    reader.readAsDataURL(blob);\n  });\n}\n\nexport function blobToFile(blob: Blob, fileName: string) {\n  return new File([blob], fileName, {\n    lastModified: Date.now(),\n    type: blob.type,\n  });\n}\n\nexport function preloadImage(url: string): Promise<HTMLImageElement> {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.onload = () => resolve(img);\n    img.onerror = reject;\n    img.src = url;\n  });\n}\n\nexport function preloadVideo(url: string): Promise<HTMLVideoElement> {\n  return new Promise((resolve, reject) => {\n    const video = document.createElement('video');\n    video.volume = 0;\n    video.onloadedmetadata = () => resolve(video);\n    video.onerror = reject;\n    video.src = url;\n  });\n}\n\nexport async function createPosterForVideo(url: string): Promise<string | undefined> {\n  try {\n    const video = await preloadVideo(url);\n\n    return await Promise.race([\n      pause(2000) as Promise<undefined>,\n      new Promise<string | undefined>((resolve, reject) => {\n        video.onseeked = () => {\n          if (!video.videoWidth || !video.videoHeight) {\n            resolve(undefined);\n          }\n\n          const canvas = document.createElement('canvas');\n          canvas.width = video.videoWidth;\n          canvas.height = video.videoHeight;\n          const ctx = canvas.getContext('2d')!;\n          ctx.drawImage(video, 0, 0);\n\n          canvas.toBlob((blob) => {\n            resolve(blob ? URL.createObjectURL(blob) : undefined);\n          });\n        };\n        video.onerror = reject;\n        video.currentTime = Math.min(video.duration, 1);\n      }),\n    ]);\n  } catch (e) {\n    return undefined;\n  }\n}\n\nexport async function fetchBlob(blobUrl: string) {\n  const response = await fetch(blobUrl);\n  return response.blob();\n}\n\nexport async function fetchFile(blobUrl: string, fileName: string) {\n  const blob = await fetchBlob(blobUrl);\n  return blobToFile(blob, fileName);\n}\n\nexport function imgToCanvas(img: HTMLImageElement) {\n  const canvas = document.createElement('canvas');\n  canvas.width = img.width;\n  canvas.height = img.height;\n\n  const ctx = canvas.getContext('2d')!;\n  ctx.drawImage(img, 0, 0);\n\n  return canvas;\n}\n\nexport function hasPreview(file: File) {\n  return CONTENT_TYPES_WITH_PREVIEW.has(file.type);\n}\n\nexport function validateFiles(files: File[] | FileList | null): File[] | undefined {\n  if (!files?.length) {\n    return undefined;\n  }\n  return Array.from(files).map(fixMovMime).filter((file) => file.size);\n}\n\n// .mov MIME type not reported sometimes https://developer.mozilla.org/en-US/docs/Web/API/File/type#sect1\nfunction fixMovMime(file: File) {\n  const ext = file.name.split('.').pop()!;\n  if (!file.type && ext.toLowerCase() === 'mov') {\n    return new File([file], file.name, { type: 'video/quicktime' });\n  }\n  return file;\n}\n","type CollectionByKey<Member> = Record<number | string, Member>;\n\ntype OrderDirection =\n  'asc'\n  | 'desc';\n\ntype OrderCallback<T> = (member: T) => unknown;\n\nexport function buildCollectionByKey<T extends AnyLiteral>(collection: T[], key: keyof T) {\n  return collection.reduce((byKey: CollectionByKey<T>, member: T) => {\n    byKey[member[key]] = member;\n\n    return byKey;\n  }, {});\n}\n\nexport function buildCollectionByCallback<T extends AnyLiteral, K extends number | string, R>(\n  collection: T[],\n  callback: (member: T) => [K, R],\n) {\n  return collection.reduce((byKey: Record<K, R>, member: T) => {\n    const [key, value] = callback(member);\n    byKey[key] = value;\n\n    return byKey;\n  }, {} as Record<K, R>);\n}\n\nexport function mapValues<R, M>(\n  byKey: CollectionByKey<M>,\n  callback: (member: M, key: string, index: number, originalByKey: CollectionByKey<M>) => R,\n): CollectionByKey<R> {\n  return Object.keys(byKey).reduce((newByKey: CollectionByKey<R>, key, index) => {\n    newByKey[key] = callback(byKey[key], key, index, byKey);\n    return newByKey;\n  }, {});\n}\n\nexport function pick<T, K extends keyof T>(object: T, keys: K[]) {\n  return keys.reduce((result, key) => {\n    result[key] = object[key];\n    return result;\n  }, {} as Pick<T, K>);\n}\n\nexport function pickTruthy<T, K extends keyof T>(object: T, keys: K[]) {\n  return keys.reduce((result, key) => {\n    if (object[key]) {\n      result[key] = object[key];\n    }\n\n    return result;\n  }, {} as Pick<T, K>);\n}\n\nexport function omit<T extends object, K extends keyof T>(object: T, keys: K[]): Omit<T, K> {\n  const stringKeys = new Set(keys.map(String));\n  const savedKeys = Object.keys(object)\n    .filter((key) => !stringKeys.has(key)) as Array<Exclude<keyof T, K>>;\n\n  return pick(object, savedKeys);\n}\n\nexport function omitUndefined<T extends object>(object: T): T {\n  return Object.keys(object).reduce((result, stringKey) => {\n    const key = stringKey as keyof T;\n    if (object[key] !== undefined) {\n      result[key] = object[key];\n    }\n    return result;\n  }, {} as T);\n}\n\nexport function orderBy<T>(\n  collection: T[],\n  orderRule: (keyof T) | OrderCallback<T> | ((keyof T) | OrderCallback<T>)[],\n  mode: OrderDirection | [OrderDirection, OrderDirection] = 'asc',\n): T[] {\n  function compareValues(a: T, b: T, currentOrderRule: (keyof T) | OrderCallback<T>, isAsc: boolean) {\n    const aValue = (typeof currentOrderRule === 'function' ? currentOrderRule(a) : a[currentOrderRule]) || 0;\n    const bValue = (typeof currentOrderRule === 'function' ? currentOrderRule(b) : b[currentOrderRule]) || 0;\n\n    // @ts-expect-error Rely on the JS to handle the comparison\n    return isAsc ? aValue - bValue : bValue - aValue;\n  }\n\n  if (Array.isArray(orderRule)) {\n    const [mode1, mode2] = Array.isArray(mode) ? mode : [mode, mode];\n    const [orderRule1, orderRule2] = orderRule;\n    const isAsc1 = mode1 === 'asc';\n    const isAsc2 = mode2 === 'asc';\n\n    return collection.sort((a, b) => {\n      return compareValues(a, b, orderRule1, isAsc1) || compareValues(a, b, orderRule2, isAsc2);\n    });\n  }\n\n  const isAsc = mode === 'asc';\n  return collection.sort((a, b) => {\n    return compareValues(a, b, orderRule, isAsc);\n  });\n}\n\nexport function unique<T>(array: T[]): T[] {\n  return Array.from(new Set(array));\n}\n\nexport function uniqueByField<T>(array: T[], field: keyof T): T[] {\n  return [...new Map(array.map((item) => [item[field], item])).values()];\n}\n\nexport function compact<T>(array: T[]) {\n  return array.filter(Boolean);\n}\n\nexport function areSortedArraysEqual(array1: any[], array2: any[]) {\n  if (array1.length !== array2.length) {\n    return false;\n  }\n\n  return array1.every((item, i) => item === array2[i]);\n}\n\nexport function areSortedArraysIntersecting(array1: any[], array2: any[]) {\n  return array1[0] <= array2[array2.length - 1] && array1[array1.length - 1] >= array2[0];\n}\nexport function isInsideSortedArrayRange(value: any, array: any[]) {\n  return array[0] <= value && value <= array[array.length - 1];\n}\n\nexport function findIntersectionWithSet<T>(array: T[], set: Set<T>): T[] {\n  return array.filter((a) => set.has(a));\n}\n/**\n * Exlude elements from base array. Both arrays should be sorted in same order\n * @param base\n * @param toExclude\n * @returns New array without excluded elements\n */\nexport function excludeSortedArray<T>(base: T[], toExclude: T[]) {\n  if (!base?.length) return base;\n\n  const result: T[] = [];\n\n  let excludeIndex = 0;\n\n  for (let i = 0; i < base.length; i++) {\n    if (toExclude[excludeIndex] === base[i]) {\n      excludeIndex += 1;\n    } else {\n      result.push(base[i]);\n    }\n  }\n\n  return result;\n}\n\nexport function split<T>(array: T[], chunkSize: number) {\n  const result: T[][] = [];\n  for (let i = 0; i < array.length; i += chunkSize) {\n    result.push(array.slice(i, i + chunkSize));\n  }\n\n  return result;\n}\n\nexport function partition<T>(\n  array: T[], filter: (value: T, index: number, array: T[]) => boolean | undefined,\n): [T[], T[]] {\n  const pass: T[] = [];\n  const fail: T[] = [];\n\n  array.forEach((e, idx, arr) => (filter(e, idx, arr) ? pass : fail).push(e));\n\n  return [pass, fail];\n}\n\nexport function cloneDeep<T>(value: T): T {\n  if (!isObject(value)) {\n    return value;\n  }\n\n  if (Array.isArray(value)) {\n    return value.map(cloneDeep) as typeof value;\n  }\n\n  return Object.keys(value).reduce((acc, key) => {\n    acc[key as keyof T] = cloneDeep(value[key as keyof T]);\n    return acc;\n  }, {} as T);\n}\n\nexport function isLiteralObject(value: any): value is AnyLiteral {\n  return isObject(value) && !Array.isArray(value);\n}\n\nfunction isObject(value: any): value is object {\n  // eslint-disable-next-line no-null/no-null\n  return typeof value === 'object' && value !== null;\n}\n\nexport function findLast<T>(array: Array<T>, predicate: (value: T, index: number, obj: T[]) => boolean): T | undefined {\n  let cursor = array.length;\n\n  while (cursor--) {\n    if (predicate(array[cursor], cursor, array)) {\n      return array[cursor];\n    }\n  }\n\n  return undefined;\n}\n\nexport function compareFields<T>(a: T, b: T) {\n  return Number(b) - Number(a);\n}\n","import type { ThreadId, TopicsInfo } from '../../types';\nimport type { GlobalState } from '../types';\n\nexport function selectTopicsInfo<T extends GlobalState>(global: T, chatId: string): TopicsInfo | undefined {\n  return global.chats.topicsInfoById[chatId];\n}\n\nexport function selectTopics<T extends GlobalState>(global: T, chatId: string) {\n  return selectTopicsInfo(global, chatId)?.topicsById;\n}\n\nexport function selectTopic<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectTopicsInfo(global, chatId)?.topicsById?.[threadId];\n}\n","type RLottieClass = typeof import('./RLottie').default;\n\nlet promise: Promise<RLottieClass> | undefined;\nlet RLottie: RLottieClass;\n\n// Time for the main interface to completely load\nconst LOTTIE_LOAD_DELAY = 3000;\n\nexport async function ensureRLottie() {\n  if (!promise) {\n    promise = import('./RLottie').then((module) => module.default);\n    RLottie = await promise;\n  }\n\n  return promise;\n}\n\nexport function getRLottie() {\n  return RLottie;\n}\n\nsetTimeout(ensureRLottie, LOTTIE_LOAD_DELAY);\n","import {\n  memo, useLayoutEffect, useMemo, useRef,\n} from '../../lib/teact/teact';\nimport { withGlobal } from '../../global';\n\nimport type { ApiTypeStory } from '../../api/types';\nimport type { ThemeKey } from '../../types';\n\nimport { selectPeerStories, selectTheme } from '../../global/selectors';\nimport buildClassName from '../../util/buildClassName';\nimport { REM } from './helpers/mediaDimensions';\n\nimport useDevicePixelRatio from '../../hooks/window/useDevicePixelRatio';\n\ninterface OwnProps {\n  peerId: string;\n  className?: string;\n  size: number;\n  withExtraGap?: boolean;\n  colors?: string[];\n}\n\ninterface StateProps {\n  peerStories?: Record<number, ApiTypeStory>;\n  storyIds?: number[];\n  lastReadId?: number;\n  appTheme: ThemeKey;\n}\n\nconst BLUE = ['#34C578', '#3CA3F3'];\nconst GREEN = ['#C9EB38', '#09C167'];\nconst GRAY = '#C4C9CC';\nconst DARK_GRAY = '#737373';\nconst STROKE_WIDTH = 0.125 * REM;\nconst STROKE_WIDTH_LARGE = 0.25 * REM;\nconst GAP_PERCENT = 2;\nconst SEGMENTS_MAX = 45; // More than this breaks rendering in Safari and Chrome\nconst LARGE_SIZE = 4 * REM;\n\nconst GAP_PERCENT_EXTRA = 10;\nconst EXTRA_GAP_ANGLE = Math.PI / 4;\nconst EXTRA_GAP_SIZE = (GAP_PERCENT_EXTRA / 100) * (2 * Math.PI);\nconst EXTRA_GAP_START = EXTRA_GAP_ANGLE - EXTRA_GAP_SIZE / 2;\nconst EXTRA_GAP_END = EXTRA_GAP_ANGLE + EXTRA_GAP_SIZE / 2;\n\nfunction AvatarStoryCircle({\n  size,\n  className,\n  peerStories,\n  storyIds,\n  lastReadId,\n  withExtraGap,\n  appTheme,\n  colors,\n}: OwnProps & StateProps) {\n  const ref = useRef<HTMLCanvasElement>();\n\n  const dpr = useDevicePixelRatio();\n\n  const isLarge = size > LARGE_SIZE;\n  const strokeWidth = isLarge ? STROKE_WIDTH_LARGE : STROKE_WIDTH;\n  const adaptedSize = size + strokeWidth + (isLarge ? 0.25 * REM : 0); // Add extra gap space for large avatars\n\n  const values = useMemo(() => {\n    return (storyIds || []).reduce((acc, id) => {\n      acc.total += 1;\n      if (lastReadId && id <= lastReadId) {\n        acc.read += 1;\n      }\n\n      return acc;\n    }, { total: 0, read: 0 });\n  }, [lastReadId, storyIds]);\n\n  const isCloseFriend = useMemo(() => {\n    if (!peerStories || !storyIds?.length) {\n      return false;\n    }\n\n    return storyIds.some((id) => {\n      const story = peerStories[id];\n      if (!story || !('isForCloseFriends' in story)) {\n        return false;\n      }\n      const isRead = lastReadId && story.id <= lastReadId;\n      return story.isForCloseFriends && !isRead;\n    });\n  }, [lastReadId, peerStories, storyIds]);\n\n  useLayoutEffect(() => {\n    if (!ref.current) {\n      return;\n    }\n\n    drawGradientCircle({\n      canvas: ref.current,\n      size: adaptedSize,\n      strokeWidth,\n      segmentsCount: values.total,\n      colorStops: colors || (isCloseFriend ? GREEN : BLUE),\n      readSegmentsCount: values.read,\n      withExtraGap,\n      readSegmentColor: appTheme === 'dark' ? DARK_GRAY : GRAY,\n      dpr,\n    });\n  }, [appTheme, isCloseFriend, adaptedSize, values.read, values.total, withExtraGap, dpr, colors, size, strokeWidth]);\n\n  if (!values.total) {\n    return undefined;\n  }\n\n  return (\n    <canvas\n      ref={ref}\n      className={buildClassName('story-circle', className)}\n      style={`max-width: ${adaptedSize}px; max-height: ${adaptedSize}px;`}\n    />\n  );\n}\n\nexport default memo(withGlobal<OwnProps>((global, { peerId }): Complete<StateProps> => {\n  const peerStories = selectPeerStories(global, peerId);\n  const appTheme = selectTheme(global);\n\n  return {\n    peerStories: peerStories?.byId,\n    storyIds: peerStories?.orderedIds,\n    lastReadId: peerStories?.lastReadId,\n    appTheme,\n  };\n})(AvatarStoryCircle));\n\nexport function drawGradientCircle({\n  canvas,\n  size,\n  strokeWidth: strokeWidthPx = STROKE_WIDTH,\n  colorStops,\n  segmentsCount,\n  readSegmentsCount = 0,\n  withExtraGap = false,\n  readSegmentColor,\n  dpr,\n}: {\n  canvas: HTMLCanvasElement;\n  strokeWidth?: number;\n  size: number;\n  colorStops: string[];\n  segmentsCount: number;\n  readSegmentsCount?: number;\n  withExtraGap?: boolean;\n  readSegmentColor: string;\n  dpr: number;\n}) {\n  if (segmentsCount > SEGMENTS_MAX) {\n    readSegmentsCount = Math.round(readSegmentsCount * (SEGMENTS_MAX / segmentsCount));\n\n    segmentsCount = SEGMENTS_MAX;\n  }\n\n  const sizeModifier = dpr;\n  const strokeModifier = dpr;\n\n  const ctx = canvas.getContext('2d');\n  if (!ctx) {\n    return;\n  }\n\n  const canvasSize = size * sizeModifier;\n  const strokeWidth = strokeWidthPx * strokeModifier;\n\n  canvas.width = canvasSize;\n  canvas.height = canvasSize;\n  const centerCoordinate = canvasSize / 2;\n  const radius = (canvasSize - strokeWidth) / 2;\n  const segmentAngle = (2 * Math.PI) / segmentsCount;\n  const gapSize = (GAP_PERCENT / 100) * (2 * Math.PI);\n  const gradient = ctx.createLinearGradient(\n    0,\n    0,\n    Math.ceil(canvasSize * Math.cos(Math.PI / 2)),\n    Math.ceil(canvasSize * Math.sin(Math.PI / 2)),\n  );\n\n  if (colorStops.length === 1) {\n    gradient.addColorStop(0, colorStops[0]);\n    gradient.addColorStop(1, colorStops[0]);\n  } else {\n    colorStops.forEach((colorStop, index) => {\n      gradient.addColorStop(index / (colorStops.length - 1), colorStop);\n    });\n  }\n\n  ctx.lineCap = 'round';\n  ctx.clearRect(0, 0, canvasSize, canvasSize);\n\n  Array.from({ length: segmentsCount }).forEach((_, i) => {\n    const isRead = i < readSegmentsCount;\n    let startAngle = i * segmentAngle - Math.PI / 2 + gapSize / 2;\n    let endAngle = startAngle + segmentAngle - (segmentsCount > 1 ? gapSize : 0);\n\n    ctx.strokeStyle = isRead ? readSegmentColor : gradient;\n    ctx.lineWidth = strokeWidth * (isRead ? 0.5 : 1);\n\n    if (withExtraGap) {\n      if (startAngle >= EXTRA_GAP_START && endAngle <= EXTRA_GAP_END) { // Segment is inside extra gap\n        return;\n      } else if (startAngle < EXTRA_GAP_START && endAngle > EXTRA_GAP_END) { // Extra gap is inside segment\n        ctx.beginPath();\n        ctx.arc(centerCoordinate, centerCoordinate, radius, EXTRA_GAP_END, endAngle);\n        ctx.stroke();\n\n        endAngle = EXTRA_GAP_START;\n      } else if (startAngle < EXTRA_GAP_START && endAngle > EXTRA_GAP_START) { // Segment ends in extra gap\n        endAngle = EXTRA_GAP_START;\n      } else if (startAngle < EXTRA_GAP_END && endAngle > EXTRA_GAP_END) { // Segment starts in extra gap\n        startAngle = EXTRA_GAP_END;\n      }\n    }\n\n    ctx.beginPath();\n    ctx.arc(centerCoordinate, centerCoordinate, radius, startAngle, endAngle);\n    ctx.stroke();\n  });\n}\n","import { addCallback } from '../../../lib/teact/teactn';\n\nimport type { LangCode } from '../../../types';\nimport type { ActionReturnType, GlobalState } from '../../types';\n\nimport { requestMutation } from '../../../lib/fasterdom/fasterdom';\nimport { IS_ELECTRON, IS_MULTIACCOUNT_SUPPORTED, IS_TAURI } from '../../../util/browser/globalEnvironment';\nimport {\n  IS_ANDROID, IS_IOS, IS_LINUX,\n  IS_MAC_OS, IS_SAFARI, IS_TOUCH_ENV, IS_WINDOWS,\n} from '../../../util/browser/windowEnvironment';\nimport { getCurrentTabId } from '../../../util/establishMultitabRole';\nimport { subscribe, unsubscribe } from '../../../util/notifications';\nimport { oldSetLanguage } from '../../../util/oldLangProvider';\nimport { decryptSessionByCurrentHash } from '../../../util/passcode';\nimport { applyPerformanceSettings } from '../../../util/perfomanceSettings';\nimport { hasStoredSession, storeSession } from '../../../util/sessions';\nimport switchTheme from '../../../util/switchTheme';\nimport { getSystemTheme, setSystemThemeChangeCallback } from '../../../util/systemTheme';\nimport { startWebsync, stopWebsync } from '../../../util/websync';\nimport { callApi } from '../../../api/gramjs';\nimport { clearCaching, setupCaching } from '../../cache';\nimport { addActionHandler, getGlobal, setGlobal } from '../../index';\nimport { updateSharedSettings } from '../../reducers';\nimport { updateTabState } from '../../reducers/tabs';\nimport {\n  selectCanAnimateInterface,\n  selectPerformanceSettings,\n  selectSettingsKeys,\n  selectTabState,\n  selectTheme,\n} from '../../selectors';\nimport { selectSharedSettings } from '../../selectors/sharedState';\nimport { destroySharedStatePort, initSharedState } from '../../shared/sharedStateConnector';\n\nconst HISTORY_ANIMATION_DURATION = 450;\n\nsetSystemThemeChangeCallback((theme) => {\n  let global = getGlobal();\n\n  if (!global.isInited || !selectSharedSettings(global).shouldUseSystemTheme) return;\n\n  global = updateSharedSettings(global, { theme });\n  setGlobal(global);\n});\n\naddActionHandler('switchMultitabRole', async (global, actions, payload): Promise<void> => {\n  const { isMasterTab, tabId = getCurrentTabId() } = payload;\n\n  if (isMasterTab === selectTabState(global, tabId).isMasterTab) {\n    callApi('broadcastLocalDbUpdateFull');\n    return;\n  }\n\n  global = updateTabState(global, {\n    isMasterTab,\n  }, tabId);\n  setGlobal(global, { forceSyncOnIOs: true });\n\n  if (!isMasterTab) {\n    void unsubscribe();\n    actions.destroyConnection();\n    stopWebsync();\n    destroySharedStatePort();\n    clearCaching();\n    actions.onSomeTabSwitchedMultitabRole();\n  } else {\n    if (global.passcode.hasPasscode && !global.passcode.isScreenLocked) {\n      const { sessionJson } = await decryptSessionByCurrentHash();\n      const session = JSON.parse(sessionJson);\n      storeSession(session);\n    }\n\n    if (hasStoredSession()) {\n      setupCaching();\n    }\n\n    global = getGlobal();\n    if (!global.passcode.hasPasscode || !global.passcode.isScreenLocked) {\n      if (global.connectionState === 'connectionStateReady') {\n        global = {\n          ...global,\n          connectionState: 'connectionStateConnecting',\n        };\n        setGlobal(global);\n      }\n      actions.initApi();\n    }\n\n    startWebsync();\n    if (IS_MULTIACCOUNT_SUPPORTED) {\n      initSharedState(global.sharedState);\n    }\n  }\n});\n\naddActionHandler('onSomeTabSwitchedMultitabRole', async (global): Promise<void> => {\n  if (global.passcode.hasPasscode && !global.passcode.isScreenLocked) {\n    const { sessionJson } = await decryptSessionByCurrentHash();\n    const session = JSON.parse(sessionJson);\n    storeSession(session);\n  }\n\n  callApi('broadcastLocalDbUpdateFull');\n});\n\naddActionHandler('initShared', (): ActionReturnType => {\n  startWebsync();\n});\n\naddActionHandler('initMain', (global): ActionReturnType => {\n  const { hasWebNotifications, hasPushNotifications } = selectSettingsKeys(global);\n  if (hasWebNotifications && hasPushNotifications) {\n    // Most of the browsers only show the notifications permission prompt after the first user gesture.\n    const events = ['click', 'keypress'];\n    const subscribeAfterUserGesture = () => {\n      void subscribe();\n      events.forEach((event) => {\n        document.removeEventListener(event, subscribeAfterUserGesture);\n      });\n    };\n    events.forEach((event) => {\n      document.addEventListener(event, subscribeAfterUserGesture, { once: true });\n    });\n  }\n});\n\naddCallback((global: GlobalState) => {\n  let isUpdated = false;\n  const tabState = selectTabState(global, getCurrentTabId());\n  if (!tabState?.shouldInit) return;\n\n  global = getGlobal();\n\n  global = updateTabState(global, {\n    shouldInit: false,\n  }, tabState.id);\n\n  const { messageTextSize, language, shouldUseSystemTheme } = selectSharedSettings(global);\n\n  const globalTheme = selectTheme(global);\n  const systemTheme = getSystemTheme();\n  const theme = shouldUseSystemTheme ? systemTheme : globalTheme;\n\n  const performanceType = selectPerformanceSettings(global);\n\n  void oldSetLanguage(language as LangCode, undefined, true);\n\n  requestMutation(() => {\n    document.documentElement.style.setProperty(\n      '--composer-text-size', `${Math.max(messageTextSize, IS_IOS ? 16 : 15)}px`,\n    );\n    document.documentElement.style.setProperty('--message-meta-height', `${Math.floor(messageTextSize * 1.3125)}px`);\n    document.documentElement.style.setProperty('--message-text-size', `${messageTextSize}px`);\n    document.documentElement.setAttribute('data-message-text-size', messageTextSize.toString());\n    document.body.classList.add('initial');\n    document.body.classList.add(IS_TOUCH_ENV ? 'is-touch-env' : 'is-pointer-env');\n    applyPerformanceSettings(performanceType);\n\n    if (IS_IOS) {\n      document.body.classList.add('is-ios');\n    } else if (IS_ANDROID) {\n      document.body.classList.add('is-android');\n    } else if (IS_MAC_OS) {\n      document.body.classList.add('is-macos');\n    } else if (IS_WINDOWS) {\n      document.body.classList.add('is-windows');\n    } else if (IS_LINUX) {\n      document.body.classList.add('is-linux');\n    }\n    if (IS_SAFARI) {\n      document.body.classList.add('is-safari');\n    }\n    if (IS_TAURI) {\n      document.body.classList.add('is-tauri');\n    }\n    if (IS_ELECTRON) { // Legacy, pretend to be Tauri\n      document.body.classList.add('is-tauri');\n    }\n  });\n\n  const canAnimate = selectCanAnimateInterface(global);\n\n  switchTheme(theme, canAnimate);\n  // Make sure global has the latest theme. Will cause `switchTheme` on change\n  global = updateSharedSettings(global, { theme });\n\n  startWebsync();\n\n  isUpdated = true;\n\n  if (isUpdated) setGlobal(global);\n});\n\naddActionHandler('setInstallPrompt', (global, actions, payload): ActionReturnType => {\n  const { canInstall, tabId = getCurrentTabId() } = payload;\n  return updateTabState(global, {\n    canInstall,\n  }, tabId);\n});\n\naddActionHandler('setIsUiReady', (global, actions, payload): ActionReturnType => {\n  const { uiReadyState, tabId = getCurrentTabId() } = payload;\n\n  if (uiReadyState === 2) {\n    requestMutation(() => {\n      document.body.classList.remove('initial');\n    });\n  }\n\n  return updateTabState(global, {\n    uiReadyState,\n  }, tabId);\n});\n\naddActionHandler('setAuthPhoneNumber', (global, actions, payload): ActionReturnType => {\n  const { phoneNumber } = payload;\n\n  return {\n    ...global,\n    authPhoneNumber: phoneNumber,\n  };\n});\n\naddActionHandler('setAuthRememberMe', (global, actions, payload): ActionReturnType => {\n  return {\n    ...global,\n    authRememberMe: Boolean(payload.value),\n  };\n});\n\naddActionHandler('clearAuthErrorKey', (global): ActionReturnType => {\n  return {\n    ...global,\n    authErrorKey: undefined,\n  };\n});\n\naddActionHandler('disableHistoryAnimations', (global, actions, payload): ActionReturnType => {\n  const { tabId = getCurrentTabId() } = payload || {};\n\n  setTimeout(() => {\n    global = getGlobal();\n    global = updateTabState(global, {\n      shouldSkipHistoryAnimations: false,\n    }, tabId);\n    setGlobal(global);\n\n    requestMutation(() => {\n      document.body.classList.remove('no-animate');\n    });\n  }, HISTORY_ANIMATION_DURATION);\n\n  global = updateTabState(global, {\n    shouldSkipHistoryAnimations: true,\n  }, tabId);\n  setGlobal(global, { forceSyncOnIOs: true });\n});\n","import type { TeactNode } from '../lib/teact/teact';\n\nimport type {\n  ApiAttachment,\n  ApiBotInlineMediaResult,\n  ApiBotInlineResult,\n  ApiBotInlineSwitchPm,\n  ApiBotInlineSwitchWebview,\n  ApiChat,\n  ApiChatInviteImporter,\n  ApiContact,\n  ApiDisallowedGiftsSettings,\n  ApiDocument,\n  ApiDraft,\n  ApiExportedInvite,\n  ApiFakeType,\n  ApiFormattedText,\n  ApiInputReplyInfo,\n  ApiInputSuggestedPostInfo,\n  ApiLabeledPrice,\n  ApiMediaFormat,\n  ApiMessage,\n  ApiMessageEntity,\n  ApiNewMediaTodo,\n  ApiNewPoll,\n  ApiPeer,\n  ApiPhoto,\n  ApiReaction,\n  ApiReactionWithPaid,\n  ApiStarGiftAttributeIdBackdrop,\n  ApiStarGiftAttributeIdPattern,\n  ApiStarGiftRegular,\n  ApiStarsSubscription,\n  ApiStarsTransaction,\n  ApiSticker,\n  ApiStickerSet,\n  ApiStory,\n  ApiStorySkipped,\n  ApiThreadInfo,\n  ApiTopic,\n  ApiTypingStatus,\n  ApiVideo,\n  MediaContent,\n  StarGiftAttributeIdModel,\n} from '../api/types';\nimport type { DC_IDS } from '../config';\nimport type { SearchResultKey } from '../util/keys/searchResultKey';\nimport type { IconName } from './icons';\n\nexport type TextPart = TeactNode;\n\nexport type DcId = typeof DC_IDS[number];\n\nexport type SessionUserInfo = {\n  userId?: string;\n  firstName?: string;\n  lastName?: string;\n  phone?: string;\n  avatarUri?: string;\n  color?: number;\n  isPremium?: boolean;\n  emojiStatusId?: string;\n};\n\nexport type SharedSessionData = {\n  date?: number;\n  dcId: number;\n  isTest?: true;\n} & Partial<Record<`dc${DcId}_${'auth_key' | 'server_salt'}`, string>> & SessionUserInfo;\n\nexport type AccountInfo = {\n  isTest?: true;\n} & SessionUserInfo;\n\nexport enum LoadMoreDirection {\n  Backwards,\n  Forwards,\n  Around,\n}\n\nexport enum FocusDirection {\n  Up,\n  Down,\n  Static,\n}\n\nexport type ScrollTargetPosition = ScrollLogicalPosition | 'centerOrTop';\n\nexport interface IAlbum {\n  albumId: string;\n  messages: ApiMessage[];\n  isPaidMedia?: boolean;\n  mainMessage: ApiMessage;\n  captionMessage?: ApiMessage;\n  hasMultipleCaptions: boolean;\n  commentsMessage?: ApiMessage;\n}\n\nexport type ThreadId = string | number;\n\nexport type ThemeKey = 'light' | 'dark';\nexport type AnimationLevel = 0 | 1 | 2;\nexport type PerformanceTypeKey = (\n  'pageTransitions' | 'messageSendingAnimations' | 'mediaViewerAnimations'\n  | 'messageComposerAnimations' | 'contextMenuAnimations' | 'contextMenuBlur' | 'rightColumnAnimations'\n  | 'animatedEmoji' | 'loopAnimatedStickers' | 'reactionEffects' | 'stickerEffects' | 'autoplayGifs' | 'autoplayVideos'\n  | 'storyRibbonAnimations' | 'snapEffect'\n);\nexport type PerformanceType = Record<PerformanceTypeKey, boolean>;\n\nexport interface IThemeSettings {\n  background?: string;\n  backgroundColor?: string;\n  patternColor?: string;\n  isBlurred?: boolean;\n}\n\nexport type LangCode = (\n  'en' | 'ar' | 'be' | 'ca' | 'nl' | 'fr' | 'de' | 'id' | 'it' | 'ko' | 'ms' | 'fa' | 'pl' | 'pt-br' | 'ru' | 'es'\n  | 'tr' | 'uk' | 'uz'\n);\n\nexport type TimeFormat = '24h' | '12h';\n\nexport interface AccountSettings {\n  hasWebNotifications: boolean;\n  hasPushNotifications: boolean;\n  hasContactJoinedNotifications?: boolean;\n  notificationSoundVolume: number;\n  canAutoLoadPhotoFromContacts: boolean;\n  canAutoLoadPhotoInPrivateChats: boolean;\n  canAutoLoadPhotoInGroups: boolean;\n  canAutoLoadPhotoInChannels: boolean;\n  canAutoLoadVideoFromContacts: boolean;\n  canAutoLoadVideoInPrivateChats: boolean;\n  canAutoLoadVideoInGroups: boolean;\n  canAutoLoadVideoInChannels: boolean;\n  canAutoLoadFileFromContacts: boolean;\n  canAutoLoadFileInPrivateChats: boolean;\n  canAutoLoadFileInGroups: boolean;\n  canAutoLoadFileInChannels: boolean;\n  autoLoadFileMaxSizeMb: number;\n  shouldSuggestStickers: boolean;\n  shouldSuggestCustomEmoji: boolean;\n  shouldUpdateStickerSetOrder: boolean;\n  hasPassword?: boolean;\n  isSensitiveEnabled?: boolean;\n  canChangeSensitive?: boolean;\n  shouldArchiveAndMuteNewNonContact?: boolean;\n  shouldNewNonContactPeersRequirePremium?: boolean;\n  nonContactPeersPaidStars?: number;\n  shouldDisplayGiftsButton?: boolean;\n  disallowedGifts?: ApiDisallowedGiftsSettings;\n  shouldHideReadMarks?: boolean;\n  canTranslate: boolean;\n  canTranslateChats: boolean;\n  translationLanguage?: string;\n  doNotTranslate: string[];\n  shouldPaidMessageAutoApprove: boolean;\n}\n\nexport type IAnchorPosition = {\n  x: number;\n  y: number;\n};\n\nexport interface ShippingOption {\n  id: string;\n  title: string;\n  amount: number;\n  prices: ApiLabeledPrice[];\n}\n\nexport enum SettingsScreens {\n  Main,\n  EditProfile,\n  Notifications,\n  DataStorage,\n  Language,\n  ActiveSessions,\n  General,\n  GeneralChatBackground,\n  GeneralChatBackgroundColor,\n  Privacy,\n  PrivacyPhoneNumber,\n  PrivacyAddByPhone,\n  PrivacyLastSeen,\n  PrivacyProfilePhoto,\n  PrivacyBio,\n  PrivacyBirthday,\n  PrivacyGifts,\n  PrivacyPhoneCall,\n  PrivacyPhoneP2P,\n  PrivacyForwarding,\n  PrivacyVoiceMessages,\n  PrivacyMessages,\n  PrivacyGroupChats,\n  PrivacyPhoneNumberAllowedContacts,\n  PrivacyPhoneNumberDeniedContacts,\n  PrivacyLastSeenAllowedContacts,\n  PrivacyLastSeenDeniedContacts,\n  PrivacyProfilePhotoAllowedContacts,\n  PrivacyProfilePhotoDeniedContacts,\n  PrivacyBioAllowedContacts,\n  PrivacyBioDeniedContacts,\n  PrivacyBirthdayAllowedContacts,\n  PrivacyBirthdayDeniedContacts,\n  PrivacyGiftsAllowedContacts,\n  PrivacyGiftsDeniedContacts,\n  PrivacyPhoneCallAllowedContacts,\n  PrivacyPhoneCallDeniedContacts,\n  PrivacyPhoneP2PAllowedContacts,\n  PrivacyPhoneP2PDeniedContacts,\n  PrivacyForwardingAllowedContacts,\n  PrivacyForwardingDeniedContacts,\n  PrivacyVoiceMessagesAllowedContacts,\n  PrivacyVoiceMessagesDeniedContacts,\n  PrivacyGroupChatsAllowedContacts,\n  PrivacyGroupChatsDeniedContacts,\n  PrivacyBlockedUsers,\n  PrivacyNoPaidMessages,\n  Performance,\n  Folders,\n  FoldersCreateFolder,\n  FoldersEditFolder,\n  FoldersEditFolderFromChatList,\n  FoldersEditFolderInvites,\n  FoldersIncludedChats,\n  FoldersIncludedChatsFromChatList,\n  FoldersExcludedChats,\n  FoldersExcludedChatsFromChatList,\n  TwoFaDisabled,\n  TwoFaNewPassword,\n  TwoFaNewPasswordConfirm,\n  TwoFaNewPasswordHint,\n  TwoFaNewPasswordEmail,\n  TwoFaNewPasswordEmailCode,\n  TwoFaEnabled,\n  TwoFaChangePasswordCurrent,\n  TwoFaChangePasswordNew,\n  TwoFaChangePasswordConfirm,\n  TwoFaChangePasswordHint,\n  TwoFaTurnOff,\n  TwoFaRecoveryEmailCurrentPassword,\n  TwoFaRecoveryEmail,\n  TwoFaRecoveryEmailCode,\n  TwoFaCongratulations,\n  ActiveWebsites,\n  PasscodeDisabled,\n  PasscodeNewPasscode,\n  PasscodeNewPasscodeConfirm,\n  PasscodeEnabled,\n  PasscodeChangePasscodeCurrent,\n  PasscodeChangePasscodeNew,\n  PasscodeChangePasscodeConfirm,\n  PasscodeTurnOff,\n  PasscodeCongratulations,\n  Experimental,\n  Stickers,\n  QuickReaction,\n  CustomEmoji,\n  DoNotTranslate,\n  FoldersShare,\n}\n\nexport type StickerSetOrReactionsSetOrRecent = Pick<ApiStickerSet, (\n  'id' | 'accessHash' | 'title' | 'count' | 'stickers' | 'isEmoji' | 'installedDate' | 'isArchived' |\n  'hasThumbnail' | 'hasStaticThumb' | 'hasAnimatedThumb' | 'hasVideoThumb' | 'thumbCustomEmojiId'\n)> & { reactions?: ApiReactionWithPaid[] };\n\nexport enum LeftColumnContent {\n  ChatList,\n  GlobalSearch,\n  Settings,\n  Contacts,\n  Archived,\n  NewChannelStep1,\n  NewChannelStep2,\n  NewGroupStep1,\n  NewGroupStep2,\n}\n\nexport enum GlobalSearchContent {\n  ChatList,\n  ChannelList,\n  BotApps,\n  PublicPosts,\n  Media,\n  Links,\n  Files,\n  Music,\n  Voice,\n}\n\nexport enum RightColumnContent {\n  ChatInfo,\n  Management,\n  Statistics,\n  BoostStatistics,\n  MessageStatistics,\n  StoryStatistics,\n  StickerSearch,\n  GifSearch,\n  PollResults,\n  AddingMembers,\n  CreateTopic,\n  EditTopic,\n  MonetizationStatistics,\n  NewGroup,\n}\n\nexport type MediaViewerMedia = ApiPhoto | ApiVideo | ApiDocument;\n\nexport enum MediaViewerOrigin {\n  Inline,\n  ScheduledInline,\n  SharedMedia,\n  ProfileAvatar,\n  SettingsAvatar,\n  MiddleHeaderAvatar,\n  Album,\n  ScheduledAlbum,\n  SearchResult,\n  ChannelAvatar,\n  SuggestedAvatar,\n  StarsTransaction,\n  PreviewMedia,\n  SponsoredMessage,\n}\n\nexport enum StoryViewerOrigin {\n  StoryRibbon,\n  MiddleHeaderAvatar,\n  ChatList,\n  SearchResult,\n}\n\nexport enum AudioOrigin {\n  Inline,\n  SharedMedia,\n  Search,\n  OneTimeModal,\n}\n\nexport enum ChatCreationProgress {\n  Idle,\n  InProgress,\n  Complete,\n  Error,\n}\n\nexport enum ProfileEditProgress {\n  Idle,\n  InProgress,\n  Complete,\n  Error,\n}\n\nexport enum ManagementProgress {\n  Idle,\n  InProgress,\n  Complete,\n  Error,\n}\n\nexport interface ManagementState {\n  isActive: boolean;\n  nextScreen?: ManagementScreens;\n  checkedUsername?: string;\n  isUsernameAvailable?: boolean;\n  error?: string;\n  invites?: ApiExportedInvite[];\n  revokedInvites?: ApiExportedInvite[];\n  editingInvite?: ApiExportedInvite;\n  inviteInfo?: {\n    invite: ApiExportedInvite;\n    importers?: ApiChatInviteImporter[];\n    requesters?: ApiChatInviteImporter[];\n  };\n}\n\nexport enum NewChatMembersProgress {\n  Closed,\n  InProgress,\n  Loading,\n}\n\nexport type ProfileTabType =\n  | 'members'\n  | 'commonChats'\n  | 'media'\n  | 'previewMedia'\n  | 'documents'\n  | 'links'\n  | 'audio'\n  | 'voice'\n  | 'stories'\n  | 'storiesArchive'\n  | 'similarChannels'\n  | 'similarBots'\n  | 'dialogs'\n  | 'gifts';\nexport type SharedMediaType = 'media' | 'documents' | 'links' | 'audio' | 'voice';\nexport type MiddleSearchType = 'chat' | 'myChats' | 'channels';\nexport type MiddleSearchParams = {\n  requestedQuery?: string;\n  savedTag?: ApiReaction;\n  isHashtag?: boolean;\n  fetchingQuery?: string;\n  type: MiddleSearchType;\n  results?: MiddleSearchResults;\n};\nexport type MiddleSearchResults = {\n  query: string;\n  totalCount?: number;\n  nextOffsetId?: number;\n  nextOffsetPeerId?: string;\n  nextOffsetRate?: number;\n  foundIds?: SearchResultKey[];\n};\n\nexport interface LoadingState {\n  areAllItemsLoadedForwards: boolean;\n  areAllItemsLoadedBackwards: boolean;\n}\n\nexport interface ChatMediaSearchSegment {\n  foundIds: number[];\n  loadingState: LoadingState;\n}\n\nexport interface ChatMediaSearchParams {\n  currentSegment: ChatMediaSearchSegment;\n  segments: ChatMediaSearchSegment[];\n  isLoading: boolean;\n}\n\nexport enum ProfileState {\n  Profile,\n  SharedMedia,\n  MemberList,\n  GiftList,\n  StoryList,\n  SavedDialogs,\n}\n\nexport enum PaymentStep {\n  Checkout,\n  SavedPayments,\n  ConfirmPassword,\n  PaymentInfo,\n  ShippingInfo,\n  Shipping,\n  ConfirmPayment,\n}\n\nexport const UPLOADING_WALLPAPER_SLUG = 'UPLOADING_WALLPAPER_SLUG';\n\nexport enum ManagementScreens {\n  Initial,\n  ChatPrivacyType,\n  Discussion,\n  ChannelSubscribers,\n  GroupType,\n  GroupPermissions,\n  GroupRemovedUsers,\n  ChannelRemovedUsers,\n  GroupUserPermissionsCreate,\n  GroupUserPermissions,\n  ChatAdministrators,\n  GroupRecentActions,\n  ChatAdminRights,\n  ChatNewAdminRights,\n  GroupMembers,\n  GroupAddAdmins,\n  Invites,\n  EditInvite,\n  Reactions,\n  InviteInfo,\n  JoinRequests,\n  NewDiscussionGroup,\n}\n\nexport type ManagementType = 'user' | 'group' | 'channel' | 'bot';\n\nexport type EmojiKeywords = {\n  isLoading?: boolean;\n  version?: number;\n  keywords?: Record<string, string[]>;\n};\n\nexport type InlineBotSettings = {\n  id: string;\n  help?: string;\n  query?: string;\n  offset?: string;\n  canLoadMore?: boolean;\n  results?: (ApiBotInlineResult | ApiBotInlineMediaResult)[];\n  isGallery?: boolean;\n  switchPm?: ApiBotInlineSwitchPm;\n  switchWebview?: ApiBotInlineSwitchWebview;\n  cacheTime: number;\n};\n\nexport type CustomPeerType = 'premium' | 'toBeDistributed' | 'contacts' | 'nonContacts'\n  | 'groups' | 'channels' | 'bots' | 'excludeMuted' | 'excludeArchived' | 'excludeRead' | 'stars';\n\nexport type CustomPeer = {\n  isCustomPeer: true;\n  key?: string | number;\n  subtitleKey?: string;\n  avatarIcon?: IconName;\n  isAvatarSquare?: boolean;\n  peerColorId?: number;\n  isVerified?: boolean;\n  fakeType?: ApiFakeType;\n  emojiStatusId?: string;\n  customPeerAvatarColor?: string;\n  withPremiumGradient?: boolean;\n  isPremium?: boolean;\n} & ({\n  titleKey: string;\n  title?: undefined;\n} | {\n  title: string;\n  titleKey?: undefined;\n});\n\nexport type UniqueCustomPeer<T = CustomPeerType> = CustomPeer & {\n  type: T;\n};\n\nexport type MessageListType =\n  'thread'\n  | 'pinned'\n  | 'scheduled';\n\nexport type ChatListType = 'active' | 'archived' | 'saved';\n\nexport interface MessageList {\n  chatId: string;\n  threadId: ThreadId;\n  type: MessageListType;\n}\n\nexport interface ActiveEmojiInteraction {\n  id: number;\n  x: number;\n  y: number;\n  messageId?: number;\n  startSize?: number;\n  animatedEffect?: string;\n  isReversed?: boolean;\n}\n\nexport type ActiveDownloads = Record<string, {\n  format: ApiMediaFormat;\n  filename: string;\n  size: number;\n  originChatId?: string;\n  originMessageId?: number;\n}>;\n\nexport type IDimensions = {\n  width: number;\n  height: number;\n};\n\nexport type StarsTransactionType = 'all' | 'inbound' | 'outbound';\nexport type StarsTransactionHistory = Record<StarsTransactionType, {\n  transactions: ApiStarsTransaction[];\n  nextOffset?: string;\n} | undefined>;\nexport type StarsSubscriptions = {\n  list: ApiStarsSubscription[];\n  nextOffset?: string;\n  isLoading?: boolean;\n};\n\nexport type ConfettiStyle = 'poppers' | 'top-down';\n\nexport type StarGiftInfo = {\n  peerId: string;\n  gift: ApiStarGiftRegular;\n  shouldHideName?: boolean;\n  message?: ApiFormattedText;\n  shouldUpgrade?: boolean;\n};\n\nexport interface TabThread {\n  scrollOffset?: number;\n  replyStack?: number[];\n  viewportIds?: number[];\n}\n\nexport interface Thread {\n  lastScrollOffset?: number;\n  lastViewportIds?: number[];\n  listedIds?: number[];\n  outlyingLists?: number[][];\n  pinnedIds?: number[];\n  scheduledIds?: number[];\n  editingId?: number;\n  editingScheduledId?: number;\n  editingDraft?: ApiFormattedText;\n  editingScheduledDraft?: ApiFormattedText;\n  draft?: ApiDraft;\n  noWebPage?: boolean;\n  threadInfo?: ApiThreadInfo;\n  firstMessageId?: number;\n  typingStatus?: ApiTypingStatus;\n}\n\nexport interface ServiceNotification {\n  id: number;\n  message: ApiMessage;\n  version?: string;\n  isUnread?: boolean;\n  isDeleted?: boolean;\n}\n\nexport interface TopicsInfo {\n  totalCount: number;\n  topicsById: Record<ThreadId, ApiTopic>;\n  listedTopicIds?: number[];\n  orderedPinnedTopicIds?: number[];\n}\n\nexport type TranslatedMessage = {\n  isPending?: boolean;\n  text?: ApiFormattedText;\n};\n\nexport type ChatTranslatedMessages = {\n  byLangCode: Record<string, Record<number, TranslatedMessage>>;\n};\n\nexport type ChatRequestedTranslations = {\n  toLanguage?: string;\n  manualMessages?: Record<number, string>;\n};\n\nexport type SimilarBotsInfo = {\n  similarBotsIds?: string[];\n  count: number;\n};\n\nexport type ConfettiParams = OptionalCombine<{\n  style?: ConfettiStyle;\n  withStars?: boolean;\n}, {\n    top?: number;\n    left?: number;\n    width?: number;\n    height?: number;\n  }>;\n\nexport interface Size {\n  width: number;\n  height: number;\n}\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport type WebPageMediaSize = 'large' | 'small';\n\nexport type AttachmentCompression = 'compress' | 'original';\n\nexport type StarGiftCategory = number | 'all' | 'limited' | 'stock' | 'resale';\n\nexport type CallSound = (\n  'join' | 'allowTalk' | 'leave' | 'connecting' | 'incoming' | 'end' | 'connect' | 'busy' | 'ringing'\n);\n\nexport type BotAppPermissions = {\n  geolocation?: boolean;\n};\n\nexport type GiftProfileFilterOptions = {\n  sortType: 'byDate' | 'byValue';\n  shouldIncludeUnlimited: boolean;\n  shouldIncludeLimited: boolean;\n  shouldIncludeUpgradable: boolean;\n  shouldIncludeUnique: boolean;\n  shouldIncludeDisplayed: boolean;\n  shouldIncludeHidden: boolean;\n};\nexport type ResaleGiftsSortType = 'byDate' | 'byPrice' | 'byNumber';\nexport type ResaleGiftsFilterOptions = {\n  sortType: ResaleGiftsSortType;\n  modelAttributes?: StarGiftAttributeIdModel[];\n  patternAttributes?: ApiStarGiftAttributeIdPattern[];\n  backdropAttributes?: ApiStarGiftAttributeIdBackdrop[];\n};\n\nexport type SendMessageParams = {\n  chat?: ApiChat;\n  attachments?: ApiAttachment[];\n  lastMessageId?: number;\n  text?: string;\n  entities?: ApiMessageEntity[];\n  replyInfo?: ApiInputReplyInfo;\n  suggestedPostInfo?: ApiInputSuggestedPostInfo;\n  attachment?: ApiAttachment;\n  sticker?: ApiSticker;\n  story?: ApiStory | ApiStorySkipped;\n  gif?: ApiVideo;\n  poll?: ApiNewPoll;\n  todo?: ApiNewMediaTodo;\n  contact?: ApiContact;\n  isSilent?: boolean;\n  scheduledAt?: number;\n  groupedId?: string;\n  noWebPage?: boolean;\n  sendAs?: ApiPeer;\n  shouldGroupMessages?: boolean;\n  shouldUpdateStickerSetOrder?: boolean;\n  wasDrafted?: boolean;\n  isInvertedMedia?: true;\n  effectId?: string;\n  webPageMediaSize?: WebPageMediaSize;\n  webPageUrl?: string;\n  starsAmount?: number;\n  isPending?: true;\n  messageList?: MessageList;\n  isReaction?: true; // Reaction to the story are sent in the form of a message\n  messagePriceInStars?: number;\n  localMessage?: ApiMessage;\n  forwardedLocalMessagesSlice?: ForwardedLocalMessagesSlice;\n  isForwarding?: boolean;\n  forwardParams?: ForwardMessagesParams;\n  isStoryReply?: boolean;\n  suggestedMedia?: MediaContent;\n};\n\nexport type ForwardedLocalMessagesSlice = {\n  messageIds: number[];\n  localMessages: ApiMessage[];\n};\n\nexport type ForwardMessagesParams = {\n  fromChat: ApiChat;\n  toChat: ApiChat;\n  toThreadId?: ThreadId;\n  messages: ApiMessage[];\n  isSilent?: boolean;\n  scheduledAt?: number;\n  sendAs?: ApiPeer;\n  withMyScore?: boolean;\n  noAuthors?: boolean;\n  noCaptions?: boolean;\n  isCurrentUserPremium?: boolean;\n  wasDrafted?: boolean;\n  lastMessageId?: number;\n  forwardedLocalMessagesSlice?: ForwardedLocalMessagesSlice;\n  messagePriceInStars?: number;\n};\n","import blue from '../assets/icons/forumTopic/blue.svg';\nimport green from '../assets/icons/forumTopic/green.svg';\nimport grey from '../assets/icons/forumTopic/grey.svg';\nimport red from '../assets/icons/forumTopic/red.svg';\nimport rose from '../assets/icons/forumTopic/rose.svg';\nimport violet from '../assets/icons/forumTopic/violet.svg';\nimport yellow from '../assets/icons/forumTopic/yellow.svg';\n\n// https://github.com/telegramdesktop/tdesktop/blob/1aece79a471d99a8b63d826b1bce1f36a04d7293/Telegram/SourceFiles/data/data_forum_topic.cpp#L50\nconst TOPIC_MAPPING: Record<number, [string, string]> = {\n  0x6FB9F0: [blue, 'blue'],\n  0xFFD67E: [yellow, 'yellow'],\n  0xCB86DB: [violet, 'violet'],\n  0x8EEE98: [green, 'green'],\n  0xFF93B2: [rose, 'rose'],\n  0xFB6F5F: [red, 'red'],\n};\n\nexport function getTopicColors() {\n  return Object.keys(TOPIC_MAPPING).map((key) => parseInt(key, 10));\n}\n\nexport function getTopicDefaultIcon(iconColor?: number) {\n  return (iconColor && TOPIC_MAPPING[iconColor][0]) || grey;\n}\n\nexport function getTopicColorCssVariable(iconColor?: number) {\n  const color = (iconColor && TOPIC_MAPPING[iconColor][1]) || 'grey';\n  return `--color-topic-${color}`;\n}\n","import type {\n  ApiAvailableReaction,\n  ApiChatReactions,\n  ApiMessage,\n  ApiReactionCount,\n  ApiReactionKey,\n  ApiReactions,\n  ApiReactionWithPaid,\n} from '../../api/types';\nimport type { GlobalState } from '../types';\n\nexport function getMessageRecentReaction(message: Partial<ApiMessage>) {\n  return message.isOutgoing ? message.reactions?.recentReactions?.[0] : undefined;\n}\nexport function checkIfHasUnreadReactions(global: GlobalState, reactions: ApiReactions) {\n  const { currentUserId } = global;\n  return reactions?.recentReactions?.some(\n    ({ isUnread, isOwn, peerId }) => isUnread && !isOwn && currentUserId !== peerId,\n  );\n}\n\nexport function areReactionsEmpty(reactions: ApiReactions) {\n  return !reactions.results.some(({ count, localAmount }) => count || localAmount);\n}\n\nexport function getReactionKey(reaction: ApiReactionWithPaid): ApiReactionKey {\n  switch (reaction.type) {\n    case 'emoji':\n      return `emoji-${reaction.emoticon}`;\n    case 'custom':\n      return `document-${reaction.documentId}`;\n    case 'paid':\n      return 'paid';\n    default: {\n      // Legacy reactions\n      const uniqueValue = (reaction as any).emoticon || (reaction as any).documentId;\n      return `unsupported-${uniqueValue}`;\n    }\n  }\n}\n\nexport function isSameReaction(first?: ApiReactionWithPaid, second?: ApiReactionWithPaid) {\n  if (first === second) {\n    return true;\n  }\n\n  if (!first || !second) {\n    return false;\n  }\n\n  return getReactionKey(first) === getReactionKey(second);\n}\n\nexport function canSendReaction(reaction: ApiReactionWithPaid, chatReactions: ApiChatReactions) {\n  if (chatReactions.type === 'all') {\n    return reaction.type === 'emoji' || chatReactions.areCustomAllowed;\n  }\n\n  if (chatReactions.type === 'some') {\n    return chatReactions.allowed.some((r) => isSameReaction(r, reaction));\n  }\n\n  return false;\n}\n\nexport function sortReactions<T extends ApiAvailableReaction | ApiReactionWithPaid>(\n  reactions: T[],\n  topReactions?: ApiReactionWithPaid[],\n): T[] {\n  return reactions.slice().sort((left, right) => {\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion -- TS Bug?\n    const reactionOne = left ? ('reaction' in left ? left.reaction : left as ApiReactionWithPaid) : undefined;\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion -- TS Bug?\n    const reactionTwo = right ? ('reaction' in right ? right.reaction : right as ApiReactionWithPaid) : undefined;\n\n    if (reactionOne?.type === 'paid') return -1;\n    if (reactionTwo?.type === 'paid') return 1;\n\n    const indexOne = topReactions?.findIndex((reaction) => isSameReaction(reaction, reactionOne)) || 0;\n    const indexTwo = topReactions?.findIndex((reaction) => isSameReaction(reaction, reactionTwo)) || 0;\n    return (\n      (indexOne > -1 ? indexOne : Infinity) - (indexTwo > -1 ? indexTwo : Infinity)\n    );\n  });\n}\n\nexport function getUserReactions(message: ApiMessage): ApiReactionWithPaid[] {\n  return message.reactions?.results?.filter((r): r is Required<ApiReactionCount> => isReactionChosen(r))\n    .sort((a, b) => a.chosenOrder - b.chosenOrder)\n    .map((r) => r.reaction) || [];\n}\n\nexport function isReactionChosen(reaction: ApiReactionCount) {\n  return reaction.chosenOrder !== undefined;\n}\n\nexport function updateReactionCount(reactionCount: ApiReactionCount[], newReactions: ApiReactionWithPaid[]) {\n  const results = reactionCount.map((current) => (\n    isReactionChosen(current) ? {\n      ...current,\n      chosenOrder: undefined,\n      count: current.count - 1,\n    } : current\n  )).filter(({ count }) => count > 0);\n\n  newReactions.forEach((reaction, i) => {\n    const existingIndex = results.findIndex((r) => isSameReaction(r.reaction, reaction));\n    if (existingIndex > -1) {\n      results[existingIndex] = {\n        ...results[existingIndex],\n        chosenOrder: i,\n        count: results[existingIndex].count + 1,\n      };\n    } else {\n      results.push({\n        reaction,\n        chosenOrder: i,\n        count: 1,\n      });\n    }\n  });\n\n  return results;\n}\n\nexport function addPaidReaction(\n  reactionCount: ApiReactionCount[], count: number, isAnonymous?: boolean, peerId?: string,\n): ApiReactionCount[] {\n  const results: ApiReactionCount[] = [];\n  const hasPaid = reactionCount.some((current) => current.reaction.type === 'paid');\n  if (hasPaid) {\n    reactionCount.forEach((current) => {\n      if (current.reaction.type === 'paid') {\n        results.push({\n          ...current,\n          localAmount: (current.localAmount || 0) + count,\n          chosenOrder: -1,\n          localIsPrivate: isAnonymous !== undefined ? isAnonymous : current.localIsPrivate,\n          localPeerId: peerId || current.localPeerId,\n          localPreviousChosenOrder: current.chosenOrder,\n        });\n        return;\n      }\n\n      results.push(current);\n    });\n\n    return results;\n  }\n\n  return [\n    {\n      reaction: { type: 'paid' },\n      count: 0,\n      chosenOrder: -1,\n      localAmount: count,\n      localIsPrivate: isAnonymous,\n      localPeerId: peerId,\n    },\n    ...reactionCount,\n  ];\n}\n","import type { ApiStory, ApiVideo } from '../../api/types';\n\nimport { getPhotoMediaHash, getVideoMediaHash } from './messageMedia';\n\ntype StorySize = 'pictogram' | 'preview' | 'full' | 'download';\nconst STORY_ALT_VIDEO_WIDTH = 480;\n\nexport function getStoryMediaHash(\n  story: ApiStory, size: StorySize, isAlt: true,\n): string | undefined;\nexport function getStoryMediaHash(story: ApiStory): string;\nexport function getStoryMediaHash(story: ApiStory, size: StorySize): string;\nexport function getStoryMediaHash(\n  story: ApiStory, size: StorySize = 'preview', isAlt?: boolean,\n) {\n  const isVideo = Boolean(story.content.video);\n\n  if (isVideo) {\n    if (isAlt && !story.content.altVideos) return undefined;\n    const media = isAlt ? getPreferredAlt(story.content.altVideos!) : story.content.video!;\n    return getVideoMediaHash(media, size);\n  }\n\n  return getPhotoMediaHash(story.content.photo!, size);\n}\n\nfunction getPreferredAlt(alts: ApiVideo[]) {\n  const alt = alts.reduce((prev, curr) => (\n    Math.abs((curr.width || 0) - STORY_ALT_VIDEO_WIDTH) < Math.abs((prev.width || 0) - STORY_ALT_VIDEO_WIDTH)\n      ? curr : prev\n  ));\n  return alt;\n}\n\nexport function getStoryKey(chatId: string, storyId: number) {\n  return `story${chatId}-${storyId}`;\n}\n","import type {\n  ApiInputPrivacyRules,\n  BotsPrivacyType,\n  PrivacyVisibility,\n} from '../../api/types';\nimport type { GlobalState } from '../types';\n\nimport { isUserId } from '../../util/entities/ids';\nimport { partition } from '../../util/iteratees';\nimport { clamp } from '../../util/math';\nimport { getAccountsInfo } from '../../util/multiaccount';\nimport { DEFAULT_LIMITS } from '../../limits';\nimport { getGlobal } from '..';\n\nexport function buildApiInputPrivacyRules(global: GlobalState, {\n  visibility,\n  isUnspecified,\n  allowedIds,\n  blockedIds,\n  shouldAllowPremium,\n  botsPrivacy,\n}: {\n  visibility: PrivacyVisibility;\n  isUnspecified?: boolean;\n  allowedIds: string[];\n  blockedIds: string[];\n  shouldAllowPremium?: true;\n  botsPrivacy: BotsPrivacyType;\n}): ApiInputPrivacyRules {\n  const {\n    users: { byId: usersById },\n    chats: { byId: chatsById },\n  } = global;\n\n  const [allowedUserIds, allowedChatIds] = partition(allowedIds, isUserId);\n  const [blockedUserIds, blockedChatIds] = partition(blockedIds, isUserId);\n\n  const rules: ApiInputPrivacyRules = {\n    visibility,\n    isUnspecified,\n    allowedUsers: allowedUserIds.map((userId) => usersById[userId]).filter(Boolean),\n    allowedChats: allowedChatIds.map((chatId) => chatsById[chatId]).filter(Boolean),\n    blockedUsers: blockedUserIds.map((userId) => usersById[userId]).filter(Boolean),\n    blockedChats: blockedChatIds.map((chatId) => chatsById[chatId]).filter(Boolean),\n    shouldAllowPremium,\n    botsPrivacy,\n  };\n\n  return rules;\n}\n\nexport function getCurrentMaxAccountCount() {\n  const global = getGlobal();\n  const limit = global.appConfig.limits?.moreAccounts || DEFAULT_LIMITS.moreAccounts;\n  const accounts = getAccountsInfo();\n  const premiumCount = Object.values(accounts).filter((account) => account.isPremium).length;\n  // Each premium account increases the base limit by 1, up to the maximum limit.\n  const currentMaxCount = limit[0] + premiumCount;\n  return clamp(currentMaxCount, limit[0], limit[1]);\n}\n\nexport function getCurrentProdAccountCount() {\n  return Object.values(getAccountsInfo()).filter((account) => !account.isTest).length;\n}\n","import type { GlobalState, TabArgs } from '../types';\n\nimport { isUserId } from '../../util/entities/ids';\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport {\n  getCanAddContact,\n  isAnonymousForwardsChat,\n  isChatAdmin, isChatGroup, isUserBot,\n} from '../helpers';\nimport { selectChat, selectIsChatRestricted, selectIsChatWithSelf } from './chats';\nimport { selectCurrentMessageList } from './messages';\nimport { selectTabState } from './tabs';\nimport { selectBot, selectUser } from './users';\n\nexport function selectManagement<T extends GlobalState>(\n  global: T, chatId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).management.byChatId[chatId];\n}\n\nexport function selectCurrentManagement<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n  if (!chatId || !threadId) {\n    return undefined;\n  }\n\n  const currentManagement = selectTabState(global, tabId).management.byChatId[chatId];\n  if (!currentManagement?.isActive) {\n    return undefined;\n  }\n\n  return currentManagement;\n}\n\nexport function selectCurrentManagementType<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n\n  if (!chatId || !threadId) {\n    return undefined;\n  }\n\n  const chatBot = selectBot(global, chatId);\n  if (chatBot) {\n    return 'bot';\n  }\n\n  if (isUserId(chatId)) {\n    return 'user';\n  }\n\n  const chat = selectChat(global, chatId);\n  if (!chat) {\n    return undefined;\n  }\n\n  if (isChatGroup(chat)) {\n    return 'group';\n  }\n\n  return 'channel';\n}\n\nexport function selectCanManage<T extends GlobalState>(\n  global: T,\n  chatId: string,\n) {\n  const chat = selectChat(global, chatId);\n  const isRestricted = selectIsChatRestricted(global, chatId);\n  if (!chat || isRestricted || chat.isMonoforum) return false;\n\n  const isPrivate = isUserId(chat.id);\n  const user = isPrivate ? selectUser(global, chatId) : undefined;\n  const canAddContact = user && getCanAddContact(user);\n\n  const isBot = user && isUserBot(user);\n  return Boolean(\n    !canAddContact\n    && chat\n    && !selectIsChatWithSelf(global, chat.id)\n    && !isAnonymousForwardsChat(chat.id)\n    // chat.isCreator is for Basic Groups\n    && (isUserId(chat.id) || ((isChatAdmin(chat) || chat.isCreator) && !chat.isNotJoined))\n    && !isBot,\n  );\n}\n","import type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { selectChatFullInfo } from './chats';\nimport { selectCurrentMessageList } from './messages';\nimport { selectTabState } from './tabs';\n\nexport function selectStatistics<T extends GlobalState>(\n  global: T, chatId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).statistics.byChatId[chatId];\n}\n\nexport function selectIsStatisticsShown<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  if (!selectTabState(global, tabId).isStatisticsShown) {\n    return false;\n  }\n\n  const { chatId: currentChatId } = selectCurrentMessageList(global, tabId) || {};\n\n  return currentChatId ? selectChatFullInfo(global, currentChatId)?.canViewStatistics : undefined;\n}\n","import type { ApiMessage, ApiPeer, ApiSponsoredMessage } from '../../api/types';\nimport type { CustomPeer, PerformanceTypeKey, ThemeKey } from '../../types';\nimport type { GlobalState, TabArgs } from '../types';\nimport { NewChatMembersProgress, RightColumnContent } from '../../types';\n\nimport { IS_SNAP_EFFECT_SUPPORTED } from '../../util/browser/windowEnvironment';\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { getMessageVideo, getWebPageVideo } from '../helpers/messageMedia';\nimport { selectCurrentManagement } from './management';\nimport { selectWebPageFromMessage } from './messages';\nimport { selectSharedSettings } from './sharedState';\nimport { selectIsStatisticsShown } from './statistics';\nimport { selectTabState } from './tabs';\n\nexport function selectIsMediaViewerOpen<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const {\n    mediaViewer: {\n      chatId,\n      messageId,\n      isAvatarView,\n      standaloneMedia,\n      isSponsoredMessage,\n    },\n  } = selectTabState(global, tabId);\n  return Boolean(standaloneMedia || (chatId && (isAvatarView || messageId || isSponsoredMessage)));\n}\n\nexport function selectRightColumnContentKey<T extends GlobalState>(\n  global: T,\n  isMobile?: boolean,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const tabState = selectTabState(global, tabId);\n\n  return tabState.editTopicPanel ? (\n    RightColumnContent.EditTopic\n  ) : tabState.createTopicPanel ? (\n    RightColumnContent.CreateTopic\n  ) : tabState.pollResults.messageId ? (\n    RightColumnContent.PollResults\n  ) : selectCurrentManagement(global, tabId) ? (\n    RightColumnContent.Management\n  ) : tabState.isStatisticsShown && tabState.statistics.currentMessageId ? (\n    RightColumnContent.MessageStatistics\n  ) : tabState.isStatisticsShown && tabState.statistics.currentStoryId ? (\n    RightColumnContent.StoryStatistics\n  ) : selectIsStatisticsShown(global, tabId) ? (\n    RightColumnContent.Statistics\n  ) : tabState.boostStatistics ? (\n    RightColumnContent.BoostStatistics\n  ) : tabState.monetizationStatistics ? (\n    RightColumnContent.MonetizationStatistics\n  ) : tabState.stickerSearch.query !== undefined ? (\n    RightColumnContent.StickerSearch\n  ) : tabState.gifSearch.query !== undefined ? (\n    RightColumnContent.GifSearch\n  ) : tabState.newChatMembersProgress !== NewChatMembersProgress.Closed ? (\n    RightColumnContent.AddingMembers\n  ) : tabState.chatInfo.isOpen && tabState.messageLists.length ? (\n    RightColumnContent.ChatInfo\n  ) : undefined;\n}\n\nexport function selectIsRightColumnShown<T extends GlobalState>(\n  global: T,\n  isMobile?: boolean,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectRightColumnContentKey(global, isMobile, tabId) !== undefined;\n}\n\nexport function selectTheme<T extends GlobalState>(global: T) {\n  return selectSharedSettings(global).theme;\n}\n\nexport function selectThemeValues<T extends GlobalState>(global: T, themeKey: ThemeKey) {\n  return global.settings.themes[themeKey];\n}\n\nexport function selectIsForumPanelOpen<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const tabState = selectTabState(global, tabId);\n\n  return Boolean(tabState.forumPanelChatId) && (\n    tabState.globalSearch.query === undefined || Boolean(tabState.globalSearch.isClosing)\n  );\n}\n\nexport function selectIsForumPanelClosed<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return !selectIsForumPanelOpen(global, tabId);\n}\n\nexport function selectIsReactionPickerOpen<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { reactionPicker } = selectTabState(global, tabId);\n  return Boolean(reactionPicker?.position);\n}\n\nexport function selectPerformanceSettings<T extends GlobalState>(global: T) {\n  return selectSharedSettings(global).performance;\n}\n\nexport function selectPerformanceSettingsValue<T extends GlobalState>(\n  global: T,\n  key: PerformanceTypeKey,\n) {\n  return selectPerformanceSettings(global)[key];\n}\n\nexport function selectCanAutoPlayMedia<T extends GlobalState>(global: T, message: ApiMessage | ApiSponsoredMessage) {\n  const webPage = selectWebPageFromMessage(global, message);\n  const video = getMessageVideo(message) || getWebPageVideo(webPage);\n  if (!video) {\n    return undefined;\n  }\n\n  const canAutoPlayVideos = selectPerformanceSettingsValue(global, 'autoplayVideos');\n  const canAutoPlayGifs = selectPerformanceSettingsValue(global, 'autoplayGifs');\n\n  const asGif = video.isGif || video.isRound;\n\n  return (canAutoPlayVideos && !asGif) || (canAutoPlayGifs && asGif);\n}\n\nexport function selectShouldLoopStickers<T extends GlobalState>(global: T) {\n  return selectPerformanceSettingsValue(global, 'loopAnimatedStickers');\n}\n\nexport function selectCanPlayAnimatedEmojis<T extends GlobalState>(global: T) {\n  return selectPerformanceSettingsValue(global, 'animatedEmoji');\n}\n\nexport function selectCanAnimateInterface<T extends GlobalState>(global: T) {\n  return selectPerformanceSettingsValue(global, 'pageTransitions');\n}\n\nexport function selectCanAnimateRightColumn<T extends GlobalState>(global: T) {\n  return selectPerformanceSettingsValue(global, 'rightColumnAnimations');\n}\n\nexport function selectCanAnimateSnapEffect<T extends GlobalState>(global: T) {\n  return IS_SNAP_EFFECT_SUPPORTED && selectPerformanceSettingsValue(global, 'snapEffect');\n}\n\nexport function selectIsContextMenuTranslucent<T extends GlobalState>(global: T) {\n  return selectPerformanceSettingsValue(global, 'contextMenuBlur');\n}\n\nexport function selectIsSynced<T extends GlobalState>(global: T) {\n  return global.isSynced;\n}\n\nexport function selectWebApp<T extends GlobalState>(\n  global: T, key: string, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).webApps.openedWebApps[key];\n}\n\nexport function selectActiveWebApp<T extends GlobalState>(\n  global: T, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const activeWebAppKey = selectTabState(global, tabId).webApps.activeWebAppKey;\n  if (!activeWebAppKey) return undefined;\n\n  return selectWebApp(global, activeWebAppKey, tabId);\n}\n\nexport function selectLeftColumnContentKey<T extends GlobalState>(\n  global: T, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).leftColumn.contentKey;\n}\n\nexport function selectSettingsScreen<T extends GlobalState>(\n  global: T, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).leftColumn.settingsScreen;\n}\n\nexport function selectPeerProfileColor<T extends GlobalState>(global: T, peer: ApiPeer | CustomPeer) {\n  const key = 'isCustomPeer' in peer ? peer.peerColorId : peer.profileColor?.color;\n  if (!key) return undefined;\n  return global.peerColors?.profile?.[key];\n}\n","import type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { selectTabState } from './tabs';\n\nexport function selectCurrentGlobalSearchQuery<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).globalSearch.query;\n}\n","import type { ApiDocument } from '../../../api/types';\n\nconst ONE_GIGABYTE = 1024 * 1024 * 1024;\nconst ONE_MEGABYTE = 1024 * 1024;\n\nexport function getFileSizeString(bytes: number) {\n  if (bytes > (ONE_GIGABYTE / 2)) {\n    return `${(bytes / ONE_GIGABYTE).toFixed(1)} GB`;\n  }\n  if (bytes > (ONE_MEGABYTE / 2)) {\n    return `${(bytes / ONE_MEGABYTE).toFixed(1)} MB`;\n  }\n  return `${(bytes / (1024)).toFixed(1)} KB`;\n}\n\nexport function getDocumentExtension(document: ApiDocument) {\n  const { fileName, mimeType } = document;\n\n  return getFileExtension(fileName, mimeType);\n}\n\nexport function getFileExtension(fileName: string, mimeType: string) {\n  if (fileName && fileName.indexOf('.') !== -1) {\n    return fileName.split('.').pop();\n  } else {\n    return mimeType.split('/').pop();\n  }\n}\n\nexport function getColorFromExtension(extension: string) {\n  switch (extension) {\n    case 'apk':\n    case 'xls':\n    case 'xlsx':\n    case 'ods':\n      return 'green';\n    case 'zip':\n    case 'rar':\n    case '7z':\n    case 'tar':\n    case 'gz':\n    case 'bz2':\n    case 'liz':\n    case 'lz4':\n    case 'lz5':\n    case 'xz':\n    case 'zst':\n    case 'wim':\n    case 'ppt':\n    case 'pptx':\n    case 'odp':\n      return 'orange';\n    case 'pdf':\n    case 'xps':\n      return 'red';\n    default:\n      return 'default';\n  }\n}\n\nexport function getDocumentHasPreview(document: ApiDocument) {\n  return Boolean(document.previewBlobUrl || document.thumbnail);\n}\n","export default function calcTextLineHeightAndCount(textContainer: HTMLElement) {\n  const lineHeight = parseInt(getComputedStyle(textContainer).lineHeight, 10);\n\n  const totalLines = textContainer.scrollHeight / lineHeight;\n\n  return {\n    totalLines,\n    lineHeight,\n  };\n}\n","import { type ElementRef, useEffect } from '../lib/teact/teact';\n\nimport type { CallbackManager } from '../util/callbacks';\n\nimport { createCallbackManager } from '../util/callbacks';\nimport { useStateRef } from './useStateRef';\n\nconst elementObserverMap = new Map<HTMLElement, [ResizeObserver, CallbackManager]>();\n\nexport default function useResizeObserver(\n  ref: ElementRef<HTMLElement> | undefined,\n  onResize: (entry: ResizeObserverEntry) => void,\n  isDisabled = false,\n) {\n  const onResizeRef = useStateRef(onResize);\n\n  useEffect(() => {\n    const el = ref?.current;\n    if (!el || isDisabled) {\n      return undefined;\n    }\n\n    const callback: ResizeObserverCallback = ([entry]) => {\n      // Ignore updates when element is not properly mounted (`display: none`)\n      if (entry.contentRect.width === 0 && entry.contentRect.height === 0) {\n        return;\n      }\n\n      onResizeRef.current(entry);\n    };\n\n    let [observer, callbackManager] = elementObserverMap.get(el) || [undefined, undefined];\n    if (!observer) {\n      callbackManager = createCallbackManager();\n      observer = new ResizeObserver(callbackManager.runCallbacks);\n      elementObserverMap.set(el, [observer, callbackManager]);\n      observer.observe(el);\n    }\n    callbackManager!.addCallback(callback);\n\n    return () => {\n      callbackManager!.removeCallback(callback);\n      if (!callbackManager!.hasCallbacks()) {\n        observer.unobserve(el);\n        observer.disconnect();\n        elementObserverMap.delete(el);\n      }\n    };\n  }, [isDisabled, onResizeRef, ref]);\n}\n","import { useEffect, useState } from '../lib/teact/teact';\nimport { getGlobal } from '../global';\n\nimport type { ApiUser } from '../api/types';\n\nimport { SESSION_ACCOUNT_PREFIX } from '../config';\nimport { getChatAvatarHash } from '../global/helpers';\nimport { selectIsSynced } from '../global/selectors';\nimport { preloadImage } from '../util/files';\nimport { resizeImage } from '../util/imageResize';\nimport { ACCOUNT_SLOT, getAccountsInfo, storeAccountData } from '../util/multiaccount';\nimport useSelector from './data/useSelector';\nimport useInterval from './schedulers/useInterval';\nimport useLastCallback from './useLastCallback';\nimport useMedia from './useMedia';\nimport useThrottledCallback from './useThrottledCallback';\n\nconst LOCAL_STORAGE_LISTENING_THROTTLE = 1000;\nconst REFRESH_INTERVAL = 1000 * 60;\nconst PREVIEW_SIZE = 72;\n\nexport default function useMultiaccountInfo(currentUser?: ApiUser) {\n  const isUpdater = Boolean(currentUser) && getGlobal().authRememberMe;\n  const isSynced = useSelector(selectIsSynced);\n\n  const [accountsInfo, setAccountsInfo] = useState(getAccountsInfo());\n\n  const avatarHash = currentUser && getChatAvatarHash(currentUser);\n  const avatarUrl = useMedia(avatarHash, !isUpdater);\n\n  const refresh = useThrottledCallback(() => {\n    setAccountsInfo(getAccountsInfo());\n  }, [], LOCAL_STORAGE_LISTENING_THROTTLE);\n\n  useEffect(() => {\n    if (!isUpdater || !isSynced) return;\n    storeAccountData(ACCOUNT_SLOT, {\n      userId: currentUser.id,\n      firstName: currentUser.firstName,\n      lastName: currentUser.lastName,\n      emojiStatusId: currentUser.emojiStatus?.documentId,\n      color: currentUser.color?.color,\n      isPremium: currentUser.isPremium,\n      phone: currentUser.phoneNumber,\n    });\n\n    refresh();\n  }, [\n    isUpdater, currentUser?.emojiStatus?.documentId, currentUser?.firstName, currentUser?.id, currentUser?.lastName,\n    currentUser?.color?.color, currentUser?.isPremium, currentUser?.phoneNumber, refresh, isSynced,\n  ]);\n\n  const updateAvatar = useLastCallback(async (url: string, abortSignal?: AbortSignal) => {\n    const resizedAvatar = await resizeImage(url, PREVIEW_SIZE, PREVIEW_SIZE);\n    const img = await preloadImage(resizedAvatar);\n    if (abortSignal?.aborted) return;\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d')!;\n    canvas.width = img.width;\n    canvas.height = img.height;\n    ctx.drawImage(img, 0, 0);\n    const dataUrl = canvas.toDataURL('image/png');\n    storeAccountData(ACCOUNT_SLOT, { avatarUri: dataUrl });\n\n    refresh();\n  });\n\n  useEffect(() => {\n    if (!avatarUrl || !isUpdater || !isSynced) return undefined;\n    const controller = new AbortController();\n    updateAvatar(avatarUrl, controller.signal);\n\n    return () => {\n      controller.abort();\n    };\n  }, [avatarUrl, isSynced, isUpdater]);\n\n  // Storage event only thrown when other tabs change the storage\n  useInterval(refresh, REFRESH_INTERVAL);\n  useEffect(() => {\n    function handleStorageChange(e: StorageEvent) {\n      if (!e.key?.startsWith(SESSION_ACCOUNT_PREFIX)) return;\n      refresh();\n    }\n\n    window.addEventListener('storage', handleStorageChange);\n\n    return () => {\n      window.removeEventListener('storage', handleStorageChange);\n    };\n  }, [refresh]);\n\n  return accountsInfo;\n}\n","import type { ThreadId } from '../../types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { buildChatThreadKey } from '../helpers/middleSearch';\nimport { selectCurrentMessageList } from './messages';\nimport { selectTabState } from './tabs';\n\nexport function selectCurrentMiddleSearch<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n  if (!chatId || !threadId) {\n    return undefined;\n  }\n\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return selectTabState(global, tabId).middleSearch.byChatThreadKey[chatThreadKey];\n}\n\nexport function selectCurrentSharedMediaSearch<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n  if (!chatId || !threadId) {\n    return undefined;\n  }\n\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return selectTabState(global, tabId).sharedMediaSearch.byChatThreadKey[chatThreadKey];\n}\n\nexport function selectCurrentChatMediaSearch<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n  if (!chatId || !threadId) {\n    return undefined;\n  }\n\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return selectTabState(global, tabId).chatMediaSearch.byChatThreadKey[chatThreadKey];\n}\n\nexport function selectChatMediaSearch<T extends GlobalState>(\n  global: T, chatId?: string, threadId?: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  if (!chatId || !threadId) {\n    return undefined;\n  }\n\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return selectTabState(global, tabId).chatMediaSearch.byChatThreadKey[chatThreadKey];\n}\n","import type {\n  ElementRef } from '../lib/teact/teact';\nimport {\n  useEffect, useMemo, useState,\n} from '../lib/teact/teact';\n\nimport { round } from '../util/math';\nimport getOffsetToContainer from '../util/visibility/getOffsetToContainer';\nimport useLastCallback from './useLastCallback';\nimport useResizeObserver from './useResizeObserver';\nimport useSharedIntersectionObserver from './useSharedIntersectionObserver';\nimport useThrottledCallback from './useThrottledCallback';\n\nconst THROTTLE_MS = 150;\n\nexport default function useCoordsInSharedCanvas(\n  containerRef: ElementRef<HTMLDivElement>,\n  sharedCanvasRef?: ElementRef<HTMLCanvasElement>,\n) {\n  const [x, setX] = useState<number>();\n  const [y, setY] = useState<number>();\n\n  const recalculate = useLastCallback(() => {\n    const container = containerRef.current;\n    const canvas = sharedCanvasRef?.current;\n    if (!container || !canvas) {\n      return;\n    }\n\n    // Wait until elements are properly mounted\n    if (!canvas.offsetWidth || !canvas.offsetHeight) {\n      return;\n    }\n\n    const target = container.classList.contains('sticker-set-cover') || container.classList.contains('sticker-reaction')\n      ? container\n      : container.querySelector('img')!;\n    if (!target) {\n      return;\n    }\n\n    const { left: targetLeftOffset, top: targetTopOffset } = getOffsetToContainer(target, canvas.parentElement!);\n    const { left: canvasLeftOffset, top: canvasTopOffset } = getOffsetToContainer(canvas, canvas.parentElement!);\n\n    const left = targetLeftOffset - canvasLeftOffset;\n    const top = targetTopOffset - canvasTopOffset;\n\n    // Factor coords are used to support rendering while being rescaled (e.g. message appearance animation)\n    setX(round(left / canvas.clientWidth, 4) || 0);\n    setY(round(top / canvas.clientHeight, 4) || 0);\n  });\n\n  useEffect(recalculate, [recalculate]);\n\n  const throttledRecalculate = useThrottledCallback(recalculate, [recalculate], THROTTLE_MS);\n  useResizeObserver(sharedCanvasRef, throttledRecalculate);\n  useSharedIntersectionObserver(sharedCanvasRef, throttledRecalculate);\n\n  return useMemo(() => (x !== undefined && y !== undefined ? { x, y } : undefined), [x, y]);\n}\n","import { isLiteralObject, unique } from './iteratees';\n\nconst EQUAL = Symbol('EQUAL');\nconst DELETE = { __delete: true };\nconst DELETE_ALL_CHILDREN = { __deleteAllChildren: true };\n\ntype NestedDiff<T> = T extends object\n  ? { [K in keyof T]?: NestedDiff<T[K]> | typeof DELETE_ALL_CHILDREN | typeof DELETE | null } : T;\n\nexport type DiffObject<T> = T extends object\n  ? { [K in keyof T]?: NestedDiff<T[K]> } | typeof DELETE_ALL_CHILDREN\n  : T;\n\nexport function deepDiff<T>(value1: T, value2: T): Partial<T> | typeof EQUAL | typeof DELETE_ALL_CHILDREN {\n  if (value1 === value2) {\n    return EQUAL;\n  }\n\n  const type1 = typeof value1;\n  const type2 = typeof value2;\n\n  if (type1 !== type2) {\n    return value2;\n  }\n\n  if (Array.isArray(value1) && Array.isArray(value2) && areSortedArraysDeepEqual(value1, value2)) {\n    return EQUAL;\n  }\n\n  if (!isLiteralObject(value1) || !isLiteralObject(value2)) {\n    return value2;\n  }\n\n  const object1 = value1 as AnyLiteral;\n  const object2 = value2 as AnyLiteral;\n  const keys1 = Object.keys(object1);\n  const keys2 = Object.keys(object2);\n\n  if (!keys2.length) {\n    return !keys1.length ? EQUAL : DELETE_ALL_CHILDREN;\n  }\n\n  const allKeys = unique(keys1.concat(keys2));\n\n  const diff = allKeys.reduce((acc: any, key) => {\n    const subValue1 = object1[key];\n    const subValue2 = object2[key];\n\n    if (!object2.hasOwnProperty(key)) {\n      acc[key] = DELETE;\n      return acc;\n    }\n\n    if (!object1.hasOwnProperty(key)) {\n      acc[key] = subValue2;\n      return acc;\n    }\n\n    const subDiff = deepDiff(subValue1, subValue2);\n    if (subDiff !== EQUAL) {\n      acc[key] = subDiff;\n    }\n\n    return acc;\n  }, {});\n\n  if (Object.keys(diff).length === 0) {\n    return EQUAL;\n  }\n\n  return diff;\n}\n\nfunction areSortedArraysDeepEqual<T extends Array<any>>(array1: T, array2: T) {\n  if (array1.length !== array2.length) {\n    return false;\n  }\n\n  return array1.every((item, i) => deepDiff(item, array2[i]) === EQUAL);\n}\n","import type { ApiFormattedText } from '../../api/types';\nimport type { TranslatedMessage } from '../../types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { omit } from '../../util/iteratees';\nimport { selectMessageTranslations, selectTabState } from '../selectors';\nimport { updateTabState } from './tabs';\n\nexport function updateMessageTranslation<T extends GlobalState>(\n  global: T, chatId: string, messageId: number, toLanguageCode: string, translation: Partial<TranslatedMessage>,\n) {\n  const translatedMessages = selectMessageTranslations(global, chatId, toLanguageCode);\n\n  return {\n    ...global,\n    translations: {\n      ...global.translations,\n      byChatId: {\n        ...global.translations.byChatId,\n        [chatId]: {\n          ...global.translations.byChatId[chatId],\n          byLangCode: {\n            ...global.translations.byChatId[chatId]?.byLangCode,\n            [toLanguageCode]: {\n              ...translatedMessages,\n              [messageId]: {\n                ...translatedMessages[messageId],\n                ...translation,\n              },\n            },\n          },\n        },\n      },\n    },\n  };\n}\n\nexport function clearMessageTranslation<T extends GlobalState>(\n  global: T, chatId: string, messageId: number,\n) {\n  const chatTranslations = global.translations.byChatId[chatId];\n  if (!chatTranslations) return global;\n\n  const { byLangCode } = chatTranslations;\n  const newByLangCode = Object.keys(byLangCode).reduce((acc, langCode) => {\n    const newTranslatedMessages = omit(byLangCode[langCode], [messageId]);\n    if (Object.keys(newTranslatedMessages).length) {\n      acc[langCode] = newTranslatedMessages;\n    }\n\n    return acc;\n  }, {} as Record<string, Record<number, TranslatedMessage>>);\n\n  return {\n    ...global,\n    translations: {\n      ...global.translations,\n      byChatId: {\n        ...global.translations.byChatId,\n        [chatId]: {\n          ...chatTranslations,\n          byLangCode: newByLangCode,\n        },\n      },\n    },\n  };\n}\n\nexport function updateMessageTranslations<T extends GlobalState>(\n  global: T, chatId: string, messageIds: number[], toLanguageCode: string, translations: ApiFormattedText[],\n) {\n  messageIds.forEach((messageId, index) => {\n    global = updateMessageTranslation(global, chatId, messageId, toLanguageCode, {\n      text: translations[index],\n      isPending: false,\n    });\n  });\n\n  return global;\n}\n\nexport function updateRequestedChatTranslation<T extends GlobalState>(\n  global: T, chatId: string, toLanguageCode?: string, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const tabState = selectTabState(global, tabId);\n  global = updateTabState(global, {\n    requestedTranslations: {\n      ...tabState.requestedTranslations,\n      byChatId: {\n        ...tabState.requestedTranslations.byChatId,\n        [chatId]: {\n          toLanguage: toLanguageCode,\n        },\n      },\n    },\n  }, tabId);\n\n  return global;\n}\n\nexport function removeRequestedChatTranslation<T extends GlobalState>(\n  global: T, chatId: string, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const tabState = selectTabState(global, tabId);\n\n  global = updateTabState(global, {\n    requestedTranslations: {\n      ...tabState.requestedTranslations,\n      byChatId: omit(tabState.requestedTranslations.byChatId, [chatId]),\n    },\n  }, tabId);\n\n  return global;\n}\n\nexport function updateRequestedMessageTranslation<T extends GlobalState>(\n  global: T, chatId: string, messageId: number, toLanguageCode: string, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const tabState = selectTabState(global, tabId);\n  global = updateTabState(global, {\n    requestedTranslations: {\n      ...tabState.requestedTranslations,\n      byChatId: {\n        ...tabState.requestedTranslations.byChatId,\n        [chatId]: {\n          ...tabState.requestedTranslations.byChatId[chatId],\n          manualMessages: {\n            ...tabState.requestedTranslations.byChatId[chatId]?.manualMessages,\n            [messageId]: toLanguageCode,\n          },\n        },\n      },\n    },\n  }, tabId);\n\n  return global;\n}\n\nexport function removeRequestedMessageTranslation<T extends GlobalState>(\n  global: T, chatId: string, messageId: number, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const tabState = selectTabState(global, tabId);\n\n  const manualMessages = tabState.requestedTranslations.byChatId[chatId]?.manualMessages;\n  if (!manualMessages) return global;\n\n  const newManualMessages = omit(manualMessages, [messageId]);\n\n  global = updateTabState(global, {\n    requestedTranslations: {\n      ...tabState.requestedTranslations,\n      byChatId: {\n        ...tabState.requestedTranslations.byChatId,\n        [chatId]: {\n          ...tabState.requestedTranslations.byChatId[chatId],\n          manualMessages: newManualMessages,\n        },\n      },\n    },\n  }, tabId);\n\n  return global;\n}\n","type Parts = (string | false | undefined)[];\n\nexport default function buildStyle(...parts: Parts) {\n  return parts.filter(Boolean).join(';');\n}\n","import { IS_TEST, PRODUCTION_HOSTNAME } from '../../config';\nimport { IS_TAURI } from './globalEnvironment';\n\nexport function getPlatform() {\n  const { userAgent, platform } = window.navigator;\n\n  const iosPlatforms = ['iPhone', 'iPad', 'iPod'];\n  if (\n    iosPlatforms.indexOf(platform) !== -1\n    // For new IPads with M1 chip and IPadOS platform returns \"MacIntel\"\n    || (platform === 'MacIntel' && ('maxTouchPoints' in navigator && navigator.maxTouchPoints > 2))\n  ) return 'iOS';\n\n  const macosPlatforms = ['Macintosh', 'MacIntel', 'MacPPC', 'Mac68K'];\n  if (macosPlatforms.indexOf(platform) !== -1) return 'macOS';\n\n  const windowsPlatforms = ['Win32', 'Win64', 'Windows', 'WinCE'];\n  if (windowsPlatforms.indexOf(platform) !== -1) return 'Windows';\n\n  if (/Android/.test(userAgent)) return 'Android';\n\n  if (/Linux/.test(platform)) return 'Linux';\n\n  return undefined;\n}\n\nexport const IS_PRODUCTION_HOST = window.location.host === PRODUCTION_HOSTNAME;\nexport const PLATFORM_ENV = getPlatform();\nexport const IS_MAC_OS = PLATFORM_ENV === 'macOS';\nexport const IS_WINDOWS = PLATFORM_ENV === 'Windows';\nexport const IS_LINUX = PLATFORM_ENV === 'Linux';\nexport const IS_IOS = PLATFORM_ENV === 'iOS';\nexport const IS_ANDROID = PLATFORM_ENV === 'Android';\nexport const IS_MOBILE = IS_IOS || IS_ANDROID;\nexport const IS_SAFARI = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\nexport const IS_YA_BROWSER = navigator.userAgent.includes('YaBrowser');\nexport const IS_FIREFOX = navigator.userAgent.toLowerCase().includes('firefox')\n  || navigator.userAgent.toLowerCase().includes('iceweasel')\n  || navigator.userAgent.toLowerCase().includes('icecat');\n\nexport const MouseButton = {\n  Main: 0,\n  Auxiliary: 1,\n  Secondary: 2,\n  Fourth: 3,\n  Fifth: 4,\n};\n\nexport const IS_PWA = (\n  window.matchMedia('(display-mode: standalone)').matches\n  || (window.navigator as any).standalone\n  || document.referrer.includes('android-app://')\n);\n\nexport const IS_APP = IS_PWA || IS_TAURI;\n\nexport const IS_TOUCH_ENV = window.matchMedia('(pointer: coarse)').matches;\nexport const IS_VOICE_RECORDING_SUPPORTED = Boolean(\n  window.navigator.mediaDevices && 'getUserMedia' in window.navigator.mediaDevices && (\n    window.AudioContext || (window as any).webkitAudioContext\n  ),\n);\nexport const IS_EMOJI_SUPPORTED = PLATFORM_ENV && (IS_MAC_OS || IS_IOS) && isLastEmojiVersionSupported();\n\nexport const IS_SERVICE_WORKER_SUPPORTED = 'serviceWorker' in navigator;\n\n// Remove in mid-late 2025 when Chromium 132 is no longer a problem\n// https://issues.chromium.org/issues/390581541\nconst chromeVersion = navigator.userAgent.match(/Chrom(e|ium)\\/([0-9]+)\\./)?.[2];\nconst hasBrokenServiceWorkerStreaming = chromeVersion && Number(chromeVersion) === 132;\n// TODO Consider failed service worker\nexport const IS_PROGRESSIVE_SUPPORTED = IS_SERVICE_WORKER_SUPPORTED && !hasBrokenServiceWorkerStreaming;\nexport const IS_OPUS_SUPPORTED = Boolean((new Audio()).canPlayType('audio/ogg; codecs=opus'));\nexport const IS_CANVAS_FILTER_SUPPORTED = (\n  !IS_TEST && 'filter' in (document.createElement('canvas').getContext('2d') || {})\n);\nexport const IS_REQUEST_FULLSCREEN_SUPPORTED = 'requestFullscreen' in document.createElement('div');\nexport const ARE_CALLS_SUPPORTED = true;\n\nexport const IS_WAVE_TRANSFORM_SUPPORTED = !IS_MOBILE\n  && !IS_FIREFOX // https://bugzilla.mozilla.org/show_bug.cgi?id=1961378\n  && !IS_SAFARI; // https://bugs.webkit.org/show_bug.cgi?id=245510\nexport const IS_SNAP_EFFECT_SUPPORTED = !IS_MOBILE\n  && !IS_FIREFOX // https://bugzilla.mozilla.org/show_bug.cgi?id=1896504\n  && !IS_SAFARI;\nexport const IS_FLUID_BACKGROUND_SUPPORTED = !IS_FIREFOX;\n\nconst TEST_VIDEO = document.createElement('video');\n\nexport const IS_WEBM_SUPPORTED = Boolean(TEST_VIDEO.canPlayType('video/webm; codecs=\"vp9\"').replace('no', ''));\n\nexport const MASK_IMAGE_DISABLED = true;\nexport const IS_OPFS_SUPPORTED = Boolean(navigator.storage?.getDirectory);\nif (IS_OPFS_SUPPORTED) {\n  // Clear old contents\n  (async () => {\n    try {\n      const directory = await navigator.storage.getDirectory();\n      await directory.removeEntry('downloads', { recursive: true });\n    } catch {\n      // Ignore\n    }\n  })();\n}\n\nexport const IS_OFFSET_PATH_SUPPORTED = CSS.supports('offset-rotate: 0deg');\nexport const IS_BACKDROP_BLUR_SUPPORTED = CSS.supports('backdrop-filter: blur()')\n  || CSS.supports('-webkit-backdrop-filter: blur()');\nexport const IS_INSTALL_PROMPT_SUPPORTED = 'onbeforeinstallprompt' in window;\nexport const IS_OPEN_IN_NEW_TAB_SUPPORTED = !(IS_PWA && IS_MOBILE);\nexport const IS_TRANSLATION_SUPPORTED = !IS_TEST;\nexport const IS_VIEW_TRANSITION_SUPPORTED = CSS.supports('view-transition-class: test');\n\nexport const MESSAGE_LIST_SENSITIVE_AREA = 750;\n\nexport const SCROLLBAR_WIDTH = (() => {\n  const el = document.createElement('div');\n  el.style.cssText = 'overflow:scroll; visibility:hidden; position:absolute;';\n  el.classList.add('custom-scroll');\n  document.body.appendChild(el);\n  const width = el.offsetWidth - el.clientWidth;\n  el.remove();\n\n  document.documentElement.style.setProperty('--scrollbar-width', `${width}px`);\n\n  return width;\n})();\n\nexport const MAX_BUFFER_SIZE = (IS_MOBILE ? 512 : 2000) * 1024 ** 2; // 512 OR 2000 MB\n\nfunction isLastEmojiVersionSupported() {\n  const ALLOWABLE_CALCULATION_ERROR_SIZE = 5;\n  const inlineEl = document.createElement('span');\n  inlineEl.classList.add('emoji-test-element');\n  document.body.appendChild(inlineEl);\n\n  inlineEl.innerText = ''; // Emoji from 16.0 version\n  const newEmojiWidth = inlineEl.offsetWidth;\n  inlineEl.innerText = ''; // Emoji from 1.0 version\n  const legacyEmojiWidth = inlineEl.offsetWidth;\n\n  document.body.removeChild(inlineEl);\n\n  return Math.abs(newEmojiWidth - legacyEmojiWidth) < ALLOWABLE_CALCULATION_ERROR_SIZE;\n}\n\nexport const IS_GEOLOCATION_SUPPORTED = 'geolocation' in navigator;\n\nexport const getGeolocationStatus = async () => {\n  try {\n    const permissionStatus = await navigator.permissions.query({ name: 'geolocation' });\n\n    if (permissionStatus.state === 'granted' || permissionStatus.state === 'prompt') {\n      const geolocation = await new Promise<GeolocationCoordinates>((resolve, reject) => {\n        navigator.geolocation.getCurrentPosition(\n          (position) => resolve(position.coords),\n          (error) => reject(error),\n        );\n      });\n      return { accessRequested: true, accessGranted: true, geolocation };\n    }\n    if (permissionStatus.state === 'denied') {\n      return { accessRequested: true, accessGranted: false };\n    }\n  } catch (error) {\n    return { accessRequested: false, accessGranted: false };\n  }\n\n  return { accessRequested: false, accessGranted: false };\n};\n","import type { FC } from '../../lib/teact/teact';\nimport type React from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport useLastCallback from '../../hooks/useLastCallback';\n\nimport styles from './Link.module.scss';\n\ntype OwnProps = {\n  children: React.ReactNode;\n  className?: string;\n  isRtl?: boolean;\n  isPrimary?: boolean;\n  withMultilineFix?: boolean;\n  onClick?: (e: React.MouseEvent<HTMLAnchorElement>) => void;\n};\n\nconst Link: FC<OwnProps> = ({\n  children, isPrimary, className, isRtl, withMultilineFix, onClick,\n}) => {\n  const handleClick = useLastCallback((e: React.MouseEvent<HTMLAnchorElement>) => {\n    e.preventDefault();\n    onClick!(e);\n  });\n\n  return (\n    <a\n      href=\"#\"\n      className={buildClassName('Link', styles.link, className, isPrimary && styles.isPrimary)}\n      dir={!withMultilineFix ? (isRtl ? 'rtl' : 'auto') : undefined}\n      onClick={onClick ? handleClick : undefined}\n    >\n      {children}\n    </a>\n  );\n};\n\nexport default Link;\n","// extracted by mini-css-extract-plugin\nexport default {\"link\":\"swBnOk1h\",\"isPrimary\":\"Jz1SC8nz\"};","import type { TeactNode } from '../../lib/teact/teact';\n\nimport type { LangFn } from './types';\n\nconst UNIQUE_PLACEHOLDER_PREFIX = '$PLACEHOLDER-';\n\nexport function conjuctionWithNodes(langFn: LangFn, nodes: TeactNode[]) {\n  const placeholders = nodes.map((node, i) => `${UNIQUE_PLACEHOLDER_PREFIX}${i}`);\n  const replaced = langFn.internalFormatters.conjunction.formatToParts(placeholders);\n  const result: TeactNode[] = [];\n  replaced.forEach((part) => {\n    if (part.type === 'literal') {\n      result.push(part.value);\n      return;\n    }\n\n    const index = Number(part.value.slice(UNIQUE_PLACEHOLDER_PREFIX.length));\n    result.push(nodes[index]);\n  });\n\n  return result;\n}\n\nexport function disjunctionWithNodes(langFn: LangFn, nodes: TeactNode[]) {\n  const placeholders = nodes.map((node, i) => `${UNIQUE_PLACEHOLDER_PREFIX}${i}`);\n  const replaced = langFn.internalFormatters.disjunction.formatToParts(placeholders);\n  const result: TeactNode[] = [];\n  replaced.forEach((part) => {\n    if (part.type === 'literal') {\n      result.push(part.value);\n      return;\n    }\n\n    const index = Number(part.value.slice(UNIQUE_PLACEHOLDER_PREFIX.length));\n    result.push(nodes[index]);\n  });\n\n  return result;\n}\n","import { memo, type TeactNode } from '../../../lib/teact/teact';\nimport { getActions, getGlobal, withGlobal } from '../../../global';\n\nimport type { ApiChat, ApiMessage, ApiPeer } from '../../../api/types';\n\nimport {\n  GENERAL_TOPIC_ID,\n  SERVICE_NOTIFICATIONS_USER_ID,\n  STARS_CURRENCY_CODE,\n  TME_LINK_PREFIX,\n  TON_CURRENCY_CODE,\n} from '../../../config';\nimport {\n  getMainUsername,\n  getMessageInvoice, getMessageTextWithFallback, isChatChannel,\n} from '../../../global/helpers';\nimport { getMessageContent } from '../../../global/helpers';\nimport { getPeerTitle } from '../../../global/helpers/peers';\nimport { getMessageReplyInfo } from '../../../global/helpers/replies';\nimport {\n  selectChat,\n  selectChatMessage,\n  selectMonoforumChannel,\n  selectPeer,\n  selectSender,\n  selectThreadIdFromMessage,\n  selectTopic,\n} from '../../../global/selectors';\nimport { ensureProtocol } from '../../../util/browser/url';\nimport { formatDateTimeToString, formatScheduledDateTime, formatShortDuration } from '../../../util/dates/dateFormat';\nimport { formatCurrency } from '../../../util/formatCurrency';\nimport { convertTonFromNanos } from '../../../util/formatCurrency';\nimport { formatStarsAsText, formatTonAsText } from '../../../util/localization/format';\nimport { conjuctionWithNodes } from '../../../util/localization/utils';\nimport { getServerTime } from '../../../util/serverTime';\nimport renderText from '../../common/helpers/renderText';\nimport { renderTextWithEntities } from '../../common/helpers/renderTextWithEntities';\nimport {\n  getCallMessageKey,\n  getPinnedMediaValue,\n  renderMessageLink,\n  renderPeerLink,\n  translateWithYou,\n} from './helpers/messageActions';\n\nimport useLang from '../../../hooks/useLang';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useOldLang from '../../../hooks/useOldLang';\n\nimport CustomEmoji from '../../common/CustomEmoji';\nimport TopicDefaultIcon from '../../common/TopicDefaultIcon';\nimport Link from '../../ui/Link';\n\nimport styles from './ActionMessage.module.scss';\n\ntype OwnProps = {\n  message: ApiMessage;\n  isInsideTopic?: boolean;\n  asPreview?: boolean;\n};\n\ntype StateProps = {\n  currentUserId?: string;\n  sender?: ApiPeer;\n  replyMessage?: ApiMessage;\n  chat?: ApiChat;\n};\n\nconst NBSP = '\\u00A0';\nconst DEFAULT_TOPIC_ICON_ID = '0';\n\nconst UNSUPPORTED_LANG_KEY = 'ActionUnsupported';\n\nconst ActionMessageText = ({\n  message,\n  currentUserId,\n  sender,\n  chat,\n  replyMessage,\n  isInsideTopic,\n  asPreview,\n}: OwnProps & StateProps) => {\n  const {\n    openThread,\n    openTelegramLink,\n    openUrl,\n  } = getActions();\n  const { chatId, isOutgoing } = message;\n  const action = message.content.action!;\n\n  const lang = useLang();\n  const oldLang = useOldLang();\n\n  function renderStrong(text: TeactNode) {\n    if (asPreview) return text;\n    return <span className={styles.strong}>{text}</span>;\n  }\n\n  const renderActionText = useLastCallback(() => {\n    const global = getGlobal();\n\n    const isServiceNotificationsChat = chatId === SERVICE_NOTIFICATIONS_USER_ID;\n    const isSavedMessages = chatId === currentUserId;\n\n    const isChannel = chat && isChatChannel(chat);\n    const senderTitle = sender && getPeerTitle(lang, sender);\n    const chatTitle = chat && getPeerTitle(lang, chat);\n\n    const userFallbackText = lang('ActionFallbackUser');\n    const chatFallbackText = lang('ActionFallbackChat');\n    const channelFallbackText = lang('ActionFallbackChannel');\n\n    const senderLink = renderPeerLink(sender?.id, senderTitle || userFallbackText, asPreview);\n    const chatLink = renderPeerLink(chat?.id, chatTitle || chatFallbackText, asPreview);\n\n    switch (action.type) {\n      case 'pinMessage': {\n        if (replyMessage) {\n          const formattedText = getMessageTextWithFallback(lang, replyMessage);\n          if (formattedText) {\n            const textLink = renderMessageLink(\n              replyMessage,\n              renderTextWithEntities({\n                text: formattedText.text,\n                entities: formattedText.entities,\n                asPreview: true,\n              }),\n              asPreview,\n            );\n\n            return translateWithYou(\n              lang, 'ActionPinnedText', isOutgoing, { text: textLink, from: senderLink },\n            );\n          }\n\n          const mediaValue = getPinnedMediaValue(lang, replyMessage);\n          if (mediaValue) {\n            const messageLink = renderMessageLink(replyMessage, mediaValue, asPreview);\n            return translateWithYou(\n              lang, 'ActionPinnedMedia', isOutgoing, { from: senderLink, media: messageLink },\n            );\n          }\n        }\n\n        return translateWithYou(\n          lang,\n          'ActionPinnedNotFound',\n          isOutgoing,\n          { from: senderLink },\n        );\n      }\n\n      case 'gameScore': {\n        const { score } = action;\n\n        const gameTitle = replyMessage?.content.game?.title;\n        const gameLink = gameTitle && renderMessageLink(replyMessage, renderText(gameTitle), asPreview);\n\n        if (gameLink) {\n          return translateWithYou(\n            lang,\n            'ActionGameScore',\n            isOutgoing,\n            { from: senderLink, count: score, game: gameLink },\n            { pluralValue: score },\n          );\n        }\n\n        return translateWithYou(\n          lang, 'ActionGameScoreNoGame', isOutgoing, { from: senderLink, count: score }, { pluralValue: score },\n        );\n      }\n\n      case 'chatJoinedByLink':\n        return lang('ActionUserJoinedByLink', { from: senderLink }, { withNodes: true });\n\n      case 'chatJoinedByRequest':\n        return translateWithYou(lang, 'ActionJoinedByRequest', isOutgoing, { from: senderLink });\n\n      case 'channelJoined': {\n        const { isViaRequest, inviterId } = action;\n        const inviter = inviterId ? selectPeer(global, inviterId) : undefined;\n        if (inviter && inviterId !== currentUserId) {\n          const inviterLink = renderPeerLink(inviterId, getPeerTitle(lang, inviter) || userFallbackText, asPreview);\n          return lang('ActionAddYou', { from: inviterLink }, { withNodes: true });\n        }\n\n        return lang(isViaRequest ? 'ActionChannelJoinedByRequestChannelYou' : 'ActionChannelJoinedYou');\n      }\n\n      case 'chatEditTitle': {\n        const { title } = action;\n        if (isChannel) return lang('ActionChangedTitleChannel', { title });\n        return translateWithYou(lang, 'ActionChangedTitle', isOutgoing, { title, from: senderLink });\n      }\n\n      case 'chatDeletePhoto':\n        return isChannel ? lang('ActionRemovedPhotoChannel')\n          : translateWithYou(lang, 'ActionRemovedPhoto', isOutgoing, { from: senderLink });\n\n      case 'chatEditPhoto':\n        return isChannel ? lang('ActionChangedPhotoChannel')\n          : translateWithYou(lang, 'ActionChangedPhoto', isOutgoing, { from: senderLink });\n\n      case 'chatCreate': {\n        const { title } = action;\n        return lang('ActionCreatedChat', { title, from: senderLink }, { withNodes: true });\n      }\n\n      case 'channelCreate': {\n        const { title } = action;\n        return isChannel ? lang('ActionCreatedChannel')\n          : translateWithYou(lang, 'ActionCreatedChat', isOutgoing, { title, from: senderLink });\n      }\n\n      case 'chatMigrateTo': {\n        const { channelId } = action;\n        const channel = selectChat(global, channelId)!;\n        const channelLink = renderPeerLink(channelId, getPeerTitle(lang, channel)!, asPreview);\n        return lang('ActionMigratedTo', { chat: channelLink }, { withNodes: true });\n      }\n\n      case 'channelMigrateFrom': {\n        const { chatId: originalChatId, title } = action;\n        const originalChatLink = renderPeerLink(originalChatId, title || chatFallbackText, asPreview);\n        return lang('ActionMigratedFrom', { chat: originalChatLink }, { withNodes: true });\n      }\n\n      case 'topicCreate': {\n        const { title, iconColor, iconEmojiId } = action;\n\n        const topicId = selectThreadIdFromMessage(global, message);\n\n        const topicLink = (\n          <Link\n            className={styles.topicLink}\n\n            onClick={() => openThread({ chatId, threadId: topicId })}\n          >\n            {iconEmojiId ? <CustomEmoji documentId={iconEmojiId} isSelectable />\n              : <TopicDefaultIcon topicId={topicId} title={title} iconColor={iconColor} />}\n            {NBSP}\n            {renderText(title)}\n          </Link>\n        );\n        return lang('ActionTopicCreated', { topic: topicLink }, { withNodes: true });\n      }\n\n      case 'topicEdit': {\n        const {\n          iconEmojiId, isClosed, isHidden, title,\n        } = action;\n\n        const topicId = selectThreadIdFromMessage(global, message);\n        const currentTopic = selectTopic(global, chatId, topicId);\n        const topicLink = (\n          <Link\n            className={styles.topicLink}\n\n            onClick={() => openThread({ chatId, threadId: topicId })}\n          >\n            {iconEmojiId && iconEmojiId !== DEFAULT_TOPIC_ICON_ID\n              ? <CustomEmoji documentId={iconEmojiId} isSelectable />\n              : (\n                <TopicDefaultIcon\n                  topicId={topicId}\n                  title={title || currentTopic?.title || lang('ActionTopicPlaceholder')}\n                  iconColor={currentTopic?.iconColor}\n                />\n              )}\n            {topicId !== GENERAL_TOPIC_ID && NBSP}\n            {renderText(title || currentTopic?.title || lang('ActionTopicPlaceholder'))}\n          </Link>\n        );\n\n        const topicPlaceholderLink = (\n          <Link\n            className={styles.topicLink}\n\n            onClick={() => openThread({ chatId, threadId: topicId })}\n          >\n            {lang('ActionTopicPlaceholder')}\n          </Link>\n        );\n\n        if (isClosed !== undefined) {\n          if (isInsideTopic) {\n            return lang(isClosed ? 'ActionTopicClosedInside' : 'ActionTopicReopenedInside');\n          }\n\n          return lang(\n            isClosed ? 'ActionTopicClosed' : 'ActionTopicReopened',\n            { from: senderLink, topic: topicLink },\n            { withNodes: true },\n          );\n        }\n\n        if (isHidden !== undefined) {\n          if (isInsideTopic) {\n            return lang(isHidden ? 'ActionTopicHiddenInside' : 'ActionTopicUnhiddenInside');\n          }\n          return lang(\n            isHidden ? 'ActionTopicHidden' : 'ActionTopicUnhidden',\n            { topic: topicLink },\n            { withNodes: true },\n          );\n        }\n\n        if (title && iconEmojiId) {\n          return lang(\n            'ActionTopicIconAndRenamed',\n            {\n              from: senderLink,\n              link: topicPlaceholderLink,\n              topic: topicLink,\n            },\n            { withNodes: true },\n          );\n        }\n\n        if (title === undefined) {\n          if (!iconEmojiId || iconEmojiId === DEFAULT_TOPIC_ICON_ID) {\n            return lang(\n              'ActionTopicIconRemoved', { from: senderLink, link: topicPlaceholderLink }, { withNodes: true },\n            );\n          }\n          return lang(\n            'ActionTopicIconChanged',\n            {\n              from: senderLink,\n              link: topicPlaceholderLink,\n              emoji: <CustomEmoji documentId={iconEmojiId} loopLimit={2} />,\n            },\n            { withNodes: true },\n          );\n        }\n\n        return lang('ActionTopicRenamed', { from: senderLink, link: topicPlaceholderLink, title }, { withNodes: true });\n      }\n\n      case 'boostApply':\n        return translateWithYou(\n          lang,\n          'ActionBoostApply',\n          isOutgoing,\n          { from: senderLink, count: action.boosts },\n          { pluralValue: action.boosts },\n        );\n\n      case 'chatAddUser': {\n        const { userIds } = action;\n\n        if (sender?.id === userIds[0]) {\n          return translateWithYou(lang, 'ActionUserJoined', isOutgoing, { from: senderLink });\n        }\n\n        if (userIds.length === 1) {\n          const user = selectPeer(global, userIds[0]);\n          const userTitle = (user && getPeerTitle(lang, user)) || userFallbackText;\n          const userLink = renderPeerLink(user?.id, userTitle, asPreview);\n          return translateWithYou(lang, 'ActionAddUser', isOutgoing, { from: senderLink, user: userLink });\n        }\n\n        const users = userIds.map((userId) => selectPeer(global, userId)).filter(Boolean);\n\n        if (!users.length) {\n          return translateWithYou(lang, 'ActionAddUser', isOutgoing, { from: senderLink, user: userFallbackText });\n        }\n\n        const userLinks = users.map((user) => (\n          renderPeerLink(user.id, getPeerTitle(lang, user) || userFallbackText, asPreview)\n        ));\n\n        return translateWithYou(\n          lang, 'ActionAddUsersMany', isOutgoing, { from: senderLink, users: conjuctionWithNodes(lang, userLinks) },\n        );\n      }\n\n      case 'chatDeleteUser': {\n        const { userId } = action;\n        if (sender?.id === userId) {\n          return translateWithYou(lang, 'ActionUserLeft', isOutgoing, { from: senderLink });\n        }\n\n        const user = selectPeer(global, userId);\n        const userTitle = (user && getPeerTitle(lang, user)) || userFallbackText;\n        const userLink = renderPeerLink(user?.id, userTitle, asPreview);\n        return translateWithYou(lang, 'ActionKickUser', isOutgoing, { from: senderLink, user: userLink });\n      }\n\n      case 'botAllowed': {\n        const {\n          app, domain, isAttachMenu, isFromRequest,\n        } = action;\n        if (isAttachMenu) return lang('ActionAttachMenuBotAllowed');\n        if (isFromRequest) return lang('ActionWebappBotAllowed');\n        if (app) {\n          const senderUsername = sender && getMainUsername(sender);\n          const link = senderUsername && `${TME_LINK_PREFIX + senderUsername}/${app.shortName}`;\n          const appLink = link\n            ? <Link onClick={() => openTelegramLink({ url: link })}>{app.title}</Link>\n            : lang('ActionBotAppPlaceholder');\n          return lang('ActionBotAllowedFromApp', { app: appLink }, { withNodes: true });\n        }\n\n        if (!domain) return lang(UNSUPPORTED_LANG_KEY);\n\n        const url = ensureProtocol(domain);\n\n        const link = <Link onClick={() => openUrl({ url })}>{domain}</Link>;\n        return lang('ActionBotAllowedFromDomain', { domain: link }, { withNodes: true });\n      }\n\n      case 'giveawayLaunch': {\n        const { stars } = action;\n\n        if (stars) {\n          return lang(\n            isChannel ? 'ActionGiveawayStarsStarted' : 'ActionGiveawayStarsStartedGroup',\n            { from: senderLink, amount: renderStrong(formatStarsAsText(lang, stars)) },\n            { withNodes: true },\n          );\n        }\n\n        return lang(\n          isChannel ? 'ActionGiveawayStarted' : 'ActionGiveawayStartedGroup',\n          { from: senderLink },\n          { withNodes: true },\n        );\n      }\n\n      case 'giveawayResults': {\n        const { winnersCount, isStars, unclaimedCount } = action;\n        if (!winnersCount) return lang('ActionGiveawayResultsNone');\n        if (unclaimedCount) {\n          return lang(isStars ? 'ActionGiveawayResultsStarsSome' : 'ActionGiveawayResultsSome');\n        }\n\n        return lang(\n          isStars ? 'ActionGiveawayResultsStars' : 'ActionGiveawayResults',\n          { count: winnersCount },\n          { pluralValue: winnersCount },\n        );\n      }\n\n      case 'giftStars':\n      case 'giftPremium':\n      case 'giftTon': {\n        const {\n          amount, currency, cryptoAmount, cryptoCurrency, type,\n        } = action;\n\n        const price = formatCurrency(lang, amount, currency, { asFontIcon: true });\n        const cryptoPrice = cryptoAmount && type !== 'giftTon'\n          ? formatCurrency(lang, cryptoAmount, cryptoCurrency!) : undefined;\n\n        const cost = cryptoPrice ? lang('ActionGiftCostCrypto', { price, cryptoPrice }, { withNodes: true }) : price;\n\n        if (isServiceNotificationsChat) {\n          return lang('ActionGiftTextCostAnonymous', { cost }, { withNodes: true });\n        }\n        return translateWithYou(\n          lang, 'ActionGiftTextCost', isOutgoing, { from: senderLink, cost: renderStrong(cost) },\n        );\n      }\n\n      case 'prizeStars':\n      case 'giftCode': {\n        return translateWithYou(lang, 'ActionGiftTextUnknown', isOutgoing, undefined);\n      }\n\n      case 'groupCall': {\n        const { duration } = action;\n        const durationText = duration ? formatShortDuration(lang, duration) : undefined;\n        if (durationText) {\n          if (isChannel) {\n            return lang('ActionGroupCallFinishedChannel', { duration: durationText });\n          }\n          return lang(\n            'ActionGroupCallFinishedGroup', { from: senderLink, duration: durationText }, { withNodes: true },\n          );\n        }\n\n        if (isChannel) return lang('ActionGroupCallStartedChannel');\n        return lang('ActionGroupCallStartedGroup', { from: senderLink }, { withNodes: true });\n      }\n\n      case 'groupCallScheduled': {\n        const { scheduleDate } = action;\n        const formattedDate = formatDateTimeToString(scheduleDate * 1000, lang.code, true);\n\n        if (isChannel) return lang('ActionGroupCallScheduledChannel', { date: formattedDate });\n        return lang('ActionGroupCallScheduledGroup', { from: senderLink, date: formattedDate }, { withNodes: true });\n      }\n\n      case 'inviteToGroupCall': {\n        const { userIds } = action;\n\n        if (userIds.length === 1) {\n          const user = selectPeer(global, userIds[0]);\n          const userTitle = (user && getPeerTitle(lang, user)) || userFallbackText;\n          const userLink = renderPeerLink(user?.id, userTitle, asPreview);\n          return translateWithYou(lang, 'ActionVideoInvited', isOutgoing, { from: senderLink, user: userLink });\n        }\n\n        const users = userIds.map((userId) => selectPeer(global, userId)).filter(Boolean);\n\n        if (!users.length) {\n          return translateWithYou(\n            lang, 'ActionVideoInvited', isOutgoing, { from: senderLink, user: userFallbackText },\n          );\n        }\n\n        const userLinks = users.map((user) => (\n          renderPeerLink(user.id, getPeerTitle(lang, user) || userFallbackText, asPreview)\n        ));\n\n        return translateWithYou(\n          lang, 'ActionVideoInvitedMany', isOutgoing, { from: senderLink, users: conjuctionWithNodes(lang, userLinks) },\n        );\n      }\n\n      case 'paymentSent': {\n        const {\n          currency, totalAmount, isRecurringInit, isRecurringUsed,\n        } = action;\n\n        const cost = renderStrong(formatCurrency(lang, totalAmount, currency, { asFontIcon: true }));\n        const invoice = replyMessage && getMessageInvoice(replyMessage);\n        const invoiceTitle = invoice?.title;\n\n        if (isRecurringUsed) {\n          return lang('ActionPaymentUsedRecurring', { amount: cost }, { withNodes: true });\n        }\n\n        if (!invoiceTitle) {\n          if (isRecurringInit) {\n            return lang('ActionPaymentInitRecurring', { amount: cost, user: chatLink }, { withNodes: true });\n          }\n\n          return lang('ActionPaymentDone', { amount: cost, user: chatLink }, { withNodes: true });\n        }\n\n        if (isRecurringInit) {\n          return lang(\n            'ActionPaymentInitRecurringFor',\n            { amount: cost, user: chatLink, invoice: renderMessageLink(replyMessage, invoiceTitle, asPreview) },\n            { withNodes: true },\n          );\n        }\n\n        return lang(\n          'ActionPaymentDoneFor',\n          { amount: cost, user: chatLink, invoice: renderMessageLink(replyMessage, invoiceTitle, asPreview) },\n          { withNodes: true },\n        );\n      }\n\n      case 'paymentRefunded': {\n        const { currency, totalAmount, peerId } = action;\n        const peer = selectPeer(global, peerId);\n        const peerTitle = (peer && getPeerTitle(lang, peer)) || userFallbackText;\n        const peerLink = renderPeerLink(peer?.id, peerTitle, asPreview);\n        const amount = formatCurrency(lang, totalAmount, currency, { asFontIcon: true });\n\n        return lang('ActionPaymentRefunded', { peer: peerLink, amount }, { withNodes: true });\n      }\n\n      case 'starGift': {\n        const {\n          gift, alreadyPaidUpgradeStars, peerId, savedId, fromId,\n        } = action;\n        const isToChannel = Boolean(peerId && savedId);\n\n        const fromPeer = fromId ? selectPeer(global, fromId) : sender;\n        const fromTitle = (fromPeer && getPeerTitle(lang, fromPeer)) || userFallbackText;\n        const fromLink = renderPeerLink(fromPeer?.id, fromTitle, asPreview);\n\n        const starsAmount = gift.stars + (alreadyPaidUpgradeStars || 0);\n        const cost = renderStrong(formatStarsAsText(lang, starsAmount));\n\n        if (isToChannel) {\n          const channelPeer = selectPeer(global, peerId!);\n          const isYou = fromPeer?.id === currentUserId;\n\n          const channelTitle = (channelPeer && getPeerTitle(lang, channelPeer)) || channelFallbackText;\n          const channelLink = renderPeerLink(peerId, channelTitle, asPreview);\n          return translateWithYou(\n            lang, 'ActionStarGiftSentChannel', isYou, { user: fromLink, channel: channelLink, cost },\n          );\n        }\n\n        if (isServiceNotificationsChat) {\n          return lang('ActionStarGiftReceivedAnonymous', { cost }, { withNodes: true });\n        }\n\n        if (isSavedMessages) {\n          return lang('ActionStarGiftSelfBought', { cost }, { withNodes: true });\n        }\n\n        if (isOutgoing) {\n          return lang('ActionStarGiftSent', { cost }, { withNodes: true });\n        }\n\n        return lang('ActionStarGiftReceived', { user: senderLink, cost }, { withNodes: true });\n      }\n\n      case 'starGiftUnique': {\n        const {\n          isTransferred, isUpgrade, savedId, peerId, fromId, resaleAmount, gift, transferStars,\n        } = action;\n\n        const isToChannel = Boolean(peerId && savedId);\n\n        const fromPeer = fromId ? selectPeer(global, fromId) : sender;\n        const fromTitle = (fromPeer && getPeerTitle(lang, fromPeer)) || userFallbackText;\n        const fromLink = renderPeerLink(fromPeer?.id, fromTitle, asPreview);\n\n        if (resaleAmount && !transferStars) {\n          const amountText = resaleAmount.currency === TON_CURRENCY_CODE\n            ? formatTonAsText(lang, convertTonFromNanos(resaleAmount.amount))\n            : formatStarsAsText(lang, resaleAmount.amount);\n\n          return lang(\n            isOutgoing\n              ? 'ApiMessageMessageActionResaleStarGiftUniqueOutgoing'\n              : 'ApiMessageMessageActionResaleStarGiftUniqueIncoming',\n            {\n              gift: lang('GiftUnique', { title: gift.title, number: gift.number }),\n              stars: renderStrong(amountText),\n            },\n            { withNodes: true },\n          );\n        }\n\n        if (isToChannel) {\n          const channelPeer = selectPeer(global, peerId!);\n          const isYou = fromPeer?.id === currentUserId;\n          const isAnonymous = fromPeer?.id === SERVICE_NOTIFICATIONS_USER_ID;\n\n          const channelTitle = (channelPeer && getPeerTitle(lang, channelPeer)) || channelFallbackText;\n          const channelLink = renderPeerLink(peerId, channelTitle, asPreview);\n\n          if (isUpgrade) {\n            return translateWithYou(\n              lang, 'ActionStarGiftUpgradedChannel', isYou, { user: fromLink, channel: channelLink },\n            );\n          }\n\n          if (isTransferred) {\n            if (isAnonymous) {\n              return lang('ActionStarGiftTransferredUnknownChannel', { channel: channelLink }, { withNodes: true });\n            }\n\n            return translateWithYou(\n              lang, 'ActionStarGiftTransferredChannel', isYou, { user: fromLink, channel: channelLink },\n            );\n          }\n        }\n\n        if (isSavedMessages) {\n          if (isUpgrade) return lang('ActionStarGiftUpgradedSelf');\n          if (isTransferred) return lang('ActionStarGiftTransferredSelf');\n        }\n\n        if (isUpgrade) {\n          if (isOutgoing) {\n            return lang('ActionStarGiftUpgradedMine', { user: chatLink }, { withNodes: true });\n          }\n\n          if (isSavedMessages) {\n            return lang('ActionStarGiftUpgradedSelf');\n          }\n\n          return lang('ActionStarGiftUpgradedUser', { user: senderLink }, { withNodes: true });\n        }\n\n        if ((isTransferred || transferStars) && !resaleAmount) {\n          if (sender?.id === SERVICE_NOTIFICATIONS_USER_ID) {\n            return lang('ActionStarGiftTransferredUnknown');\n          }\n\n          if (isSavedMessages) {\n            return lang('ActionStarGiftTransferredSelf');\n          }\n\n          if (isOutgoing) {\n            return lang('ActionStarGiftTransferredMine', { user: chatLink }, { withNodes: true });\n          }\n\n          return lang('ActionStarGiftTransferred', { user: senderLink }, { withNodes: true });\n        }\n\n        if (isOutgoing) {\n          return lang('ActionGiftUniqueSent');\n        }\n\n        return lang('ActionGiftUniqueReceived', { user: senderLink }, { withNodes: true });\n      }\n\n      case 'suggestProfilePhoto': {\n        const actionPeer = (isOutgoing ? chat : sender)!;\n        const actionPeerLink = renderPeerLink(\n          actionPeer.id, getPeerTitle(lang, actionPeer) || userFallbackText, asPreview,\n        );\n\n        return translateWithYou(lang, 'ActionSuggestedPhoto', isOutgoing, { user: actionPeerLink });\n      }\n\n      case 'webViewDataSent':\n        return lang('ActionWebviewDataDone', { text: action.text });\n\n      case 'expired': {\n        const { isRoundVideo, isVoice } = action;\n        if (isVoice) return lang('ActionExpiredVoice');\n        if (isRoundVideo) return lang('ActionExpiredVideo');\n\n        return lang(UNSUPPORTED_LANG_KEY);\n      }\n\n      case 'historyClear':\n        return lang('ActionHistoryCleared');\n\n      case 'screenshotTaken':\n        return translateWithYou(lang, 'ActionScreenshotTaken', isOutgoing, { from: senderLink });\n\n      case 'contactSignUp':\n        return lang('ActionUserRegistered', { from: senderLink }, { withNodes: true });\n\n      case 'customAction':\n        return action.message;\n\n      case 'paidMessagesPrice': {\n        const { stars, isAllowedInChannel } = action;\n        if (stars === 0) {\n          if (isChannel) {\n            return lang(\n              isAllowedInChannel ? 'ActionMessageChannelFree' : 'ActionMessageChannelDisabled',\n              { peer: chatLink },\n              { withNodes: true },\n            );\n          }\n          return translateWithYou(lang, 'ActionPaidMessagePriceFree', isOutgoing, { peer: senderLink });\n        }\n        return translateWithYou(lang, 'ActionPaidMessagePrice', isOutgoing, {\n          peer: senderLink,\n          amount: formatStarsAsText(lang, stars),\n        }, { withMarkdown: true });\n      }\n\n      case 'paidMessagesRefunded': {\n        const { stars } = action;\n        const user = selectPeer(global, chatId);\n        const userTitle = (user && getPeerTitle(lang, user)) || userFallbackText;\n\n        const key = isOutgoing\n          ? 'ApiMessageActionPaidMessagesRefundedOutgoing'\n          : 'ApiMessageActionPaidMessagesRefundedIncoming';\n\n        return lang(key, {\n          stars: formatStarsAsText(lang, stars),\n          user: renderPeerLink(user?.id, userTitle),\n        }, { withNodes: true, withMarkdown: true });\n      }\n\n      case 'suggestedPostSuccess': {\n        const { amount: price } = action;\n        const currency = price?.currency || STARS_CURRENCY_CODE;\n        const amount = price?.amount || 0;\n\n        const channel = chat?.isMonoforum ? selectMonoforumChannel(global, chatId) : chat;\n        const channelTitle = channel && getPeerTitle(lang, channel);\n        const channelLink = renderPeerLink(channel?.id, channelTitle || channelFallbackText, asPreview);\n\n        const formattedAmount = currency === TON_CURRENCY_CODE\n          ? formatTonAsText(lang, convertTonFromNanos(amount))\n          : formatStarsAsText(lang, amount);\n\n        return lang('ActionSuggestedPostSuccess', {\n          channel: channelLink,\n          amount: formattedAmount,\n        }, { withNodes: true });\n      }\n      case 'suggestedPostRefund': {\n        const { payerInitiated } = action;\n\n        const postSender = replyMessage ? selectSender(global, replyMessage) : sender;\n        const postSenderTitle = postSender && getPeerTitle(lang, postSender);\n        const postSenderLink = renderPeerLink(postSender?.id, postSenderTitle || userFallbackText, asPreview);\n\n        const price = replyMessage?.suggestedPostInfo?.price;\n        const currency = price?.currency || STARS_CURRENCY_CODE;\n        const amount = price?.amount || 0;\n\n        const channel = chat?.isMonoforum ? selectMonoforumChannel(global, chatId) : chat;\n        const channelTitle = channel && getPeerTitle(lang, channel);\n        const channelLink = renderPeerLink(channel?.id, channelTitle || channelFallbackText, asPreview);\n\n        const formattedAmount = currency === TON_CURRENCY_CODE\n          ? formatTonAsText(lang, convertTonFromNanos(amount))\n          : formatStarsAsText(lang, amount);\n\n        if (payerInitiated) {\n          return lang('SuggestedPostRefundedByUser', {\n            amount: formattedAmount,\n            user: postSenderLink,\n            channel: channelLink,\n          }, { withNodes: true, withMarkdown: true });\n        }\n\n        return lang('SuggestedPostRefundedByChannel', {\n          amount: formattedAmount,\n          peer: postSenderLink,\n          channel: channelLink,\n        }, { withNodes: true, withMarkdown: true });\n      }\n      case 'suggestedPostApproval': {\n        const { isRejected, isBalanceTooLow, rejectComment } = action;\n\n        if (isRejected) {\n          return translateWithYou(\n            lang,\n            rejectComment ? 'SuggestedPostRejectedWithReason' : 'SuggestedPostRejected',\n            isOutgoing,\n            { peer: senderLink },\n            { withMarkdown: true },\n          );\n        }\n\n        if (isBalanceTooLow) {\n          const replyMessageSender = replyMessage ? selectSender(global, replyMessage) : sender;\n          const replyPeerTitle = replyMessageSender && getPeerTitle(lang, replyMessageSender);\n          const userLink = renderPeerLink(replyMessageSender?.id, replyPeerTitle || userFallbackText, asPreview);\n\n          const currency = replyMessage?.suggestedPostInfo?.price?.currency || STARS_CURRENCY_CODE;\n          const currencyName = currency === TON_CURRENCY_CODE ? lang('CurrencyTon') : lang('CurrencyStars');\n\n          return lang('SuggestedPostBalanceTooLow', {\n            peer: userLink,\n            currency: currencyName,\n          }, { withNodes: true, withMarkdown: true });\n        }\n\n        const channel = chat?.isMonoforum ? selectMonoforumChannel(global, chatId) : chat;\n        const channelTitle = channel && getPeerTitle(lang, channel);\n        const channelLink = renderPeerLink(channel?.id, channelTitle || channelFallbackText, asPreview);\n\n        const { scheduleDate } = action;\n        if (scheduleDate) {\n          const publishDate = formatScheduledDateTime(scheduleDate, lang, oldLang);\n          const isPostPublished = scheduleDate <= getServerTime();\n\n          return translateWithYou(\n            lang,\n            isPostPublished ? 'SuggestedPostPublished' : 'SuggestedPostPublishSchedule',\n            isOutgoing,\n            { peer: channelLink, date: publishDate },\n            { withMarkdown: true },\n          );\n        }\n\n        return lang(UNSUPPORTED_LANG_KEY);\n      }\n      case 'todoCompletions': {\n        const { completedIds, incompletedIds } = action;\n\n        let completedItem;\n        let incompletedItem;\n        const { todo } = replyMessage ? getMessageContent(replyMessage) : {};\n        if (todo) {\n          const todoItems = todo.todo.items;\n          completedItem = todoItems.find((item) => completedIds.includes(item.id));\n          incompletedItem = todoItems.find((item) => incompletedIds.includes(item.id));\n        }\n\n        if (incompletedItem) {\n          const incompletedTaskTitle = incompletedItem.title;\n\n          const incompletedTaskLink = renderMessageLink(\n            replyMessage,\n            renderTextWithEntities({\n              text: incompletedTaskTitle.text,\n              entities: incompletedTaskTitle.entities,\n              asPreview: true,\n            }),\n            asPreview,\n          );\n\n          return translateWithYou(lang, 'MessageActionTodoCompletionsAsNotDone', isOutgoing, {\n            peer: senderLink,\n            task: incompletedTaskLink,\n          });\n        }\n\n        if (completedItem) {\n          const completedTaskTitle = completedItem.title;\n          const completedTaskLink = renderMessageLink(\n            replyMessage,\n            renderTextWithEntities({\n              text: completedTaskTitle.text,\n              entities: completedTaskTitle.entities,\n              asPreview: true,\n            }),\n            asPreview,\n          );\n\n          return translateWithYou(lang, 'MessageActionTodoCompletionsAsDone', isOutgoing, {\n            peer: senderLink,\n            task: completedTaskLink,\n          });\n        }\n\n        if (completedIds) {\n          const completedText = lang('MessageActionTodoTaskCount', {\n            count: completedIds.length,\n          }, { pluralValue: completedIds.length });\n          const completedLink = renderMessageLink(\n            replyMessage,\n            renderTextWithEntities({\n              text: completedText,\n              asPreview: true,\n            }),\n            asPreview,\n            { noEllipsis: true },\n          );\n          return translateWithYou(lang, 'MessageActionTodoCompletionsAsDone', isOutgoing, {\n            peer: senderLink,\n            task: completedLink,\n          });\n        }\n\n        const incompletedText = lang('MessageActionTodoTaskCount', {\n          count: incompletedIds.length,\n        }, { pluralValue: incompletedIds.length });\n        const incompletedLink = renderMessageLink(\n          replyMessage,\n          renderTextWithEntities({\n            text: incompletedText,\n            asPreview: true,\n          }),\n          asPreview,\n          { noEllipsis: true },\n        );\n\n        return translateWithYou(lang, 'MessageActionTodoCompletionsAsNotDone', isOutgoing, {\n          peer: senderLink,\n          task: incompletedLink,\n        });\n      }\n\n      case 'todoAppendTasks': {\n        const { items } = action;\n        const { todo } = replyMessage ? getMessageContent(replyMessage) : {};\n\n        const listTitle = todo?.todo.title.text || '';\n        const listLink = renderMessageLink(\n          replyMessage,\n          renderTextWithEntities({\n            text: listTitle,\n            asPreview: true,\n          }),\n          asPreview,\n        );\n\n        if (items.length === 1) {\n          const taskTitle = items[0].title;\n          const taskLink = renderMessageLink(\n            replyMessage,\n            renderTextWithEntities({\n              text: taskTitle.text,\n              entities: taskTitle.entities,\n              asPreview: true,\n            }),\n            asPreview,\n          );\n\n          return translateWithYou(lang, 'MessageActionAppendTodo', isOutgoing, {\n            peer: senderLink,\n            task: taskLink,\n            list: listLink,\n          });\n        }\n\n        const tasksText = lang('MessageActionTodoTaskCount', {\n          count: items.length,\n        }, { pluralValue: items.length });\n        const tasksLink = renderMessageLink(\n          replyMessage,\n          renderTextWithEntities({\n            text: tasksText,\n            asPreview: true,\n          }),\n          asPreview,\n          { noEllipsis: true },\n        );\n\n        return translateWithYou(lang, 'MessageActionAppendTodoMultiple', isOutgoing, {\n          peer: senderLink,\n          tasks: tasksLink,\n          list: listLink,\n        });\n      }\n\n      case 'phoneCall': // Rendered as a regular message, but considered an action for the summary\n        return lang(getCallMessageKey(action, isOutgoing));\n      default:\n        return lang(UNSUPPORTED_LANG_KEY);\n    }\n  });\n\n  return renderActionText();\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { message }): Complete<StateProps> => {\n    const chat = selectChat(global, message.chatId);\n    const sender = selectSender(global, message);\n\n    const { replyToMsgId, replyToPeerId } = getMessageReplyInfo(message) || {};\n    const replyMessage = replyToMsgId\n      ? selectChatMessage(global, replyToPeerId || message.chatId, replyToMsgId) : undefined;\n\n    return {\n      currentUserId: global.currentUserId,\n      replyMessage,\n      chat,\n      sender,\n    };\n  },\n)(ActionMessageText));\n","import { addCallback } from '../../lib/teact/teactn';\nimport { getGlobal } from '../../global';\n\nimport type { GlobalState } from '../../global/types';\nimport type { Signal, SignalSetter } from '../../util/signals';\n\nimport { createSignal } from '../../util/signals';\nimport useSyncEffect from '../useSyncEffect';\n\n/*\n  This hook is a more performant variation of the standard React `useSelector` hook. It allows to:\n  a) Avoid multiple subscriptions to global updates by leveraging a single selector reference.\n  b) Return a signal instead of forcing a component update right away.\n */\n\ntype Selector<T> = (global: GlobalState) => T;\n\ninterface State<T> {\n  clientsCount: number;\n  getter: Signal<T>;\n  setter: SignalSetter<T>;\n}\n\nconst bySelector = new Map<Selector<unknown>, State<unknown>>();\n\naddCallback((global: GlobalState) => {\n  for (const [selector, { setter }] of bySelector) {\n    setter(selector(global));\n  }\n});\n\nfunction useSelectorSignal<T>(selector: Selector<T>): Signal<T> {\n  let state = bySelector.get(selector) as State<T> | undefined;\n  if (!state) {\n    const [getter, setter] = createSignal(selector(getGlobal()));\n    state = { clientsCount: 0, getter, setter };\n    bySelector.set(selector, state as State<unknown>);\n  }\n\n  useSyncEffect(() => {\n    const state2 = bySelector.get(selector)!;\n\n    state2.clientsCount++;\n\n    return () => {\n      state2.clientsCount--;\n\n      if (!state2.clientsCount) {\n        bySelector.delete(selector);\n      }\n    };\n  }, [selector]);\n\n  return state.getter;\n}\n\nexport default useSelectorSignal;\n","import { type TeactNode } from '../lib/teact/teact';\n\nexport function replaceWithTeact(\n  input: string, searchValue: string | RegExp, replaceValue: TeactNode,\n) {\n  const parts = input.split(searchValue);\n  const [firstElement, ...rest] = parts;\n\n  return rest.reduce((acc: TeactNode[], curr: string): TeactNode[] => (\n    acc.concat(replaceValue, curr)\n  ), [firstElement]).filter(Boolean);\n}\n\nexport function replaceInStringsWithTeact(\n  input: TeactNode[], searchValue: string | RegExp, replaceValue: TeactNode,\n) {\n  return input.flatMap((curr: TeactNode) => {\n    if (typeof curr === 'string') return replaceWithTeact(curr, searchValue, replaceValue);\n    return curr;\n  }, []);\n}\n","import type { ApiError, ApiFieldError } from '../api/types';\n\nimport { DEBUG } from '../config';\n\nconst READABLE_ERROR_MESSAGES: Record<string, string> = {\n  CHAT_RESTRICTED: 'You can\\'t send messages in this chat, you were restricted',\n  CHAT_SEND_POLL_FORBIDDEN: 'You can\\'t create polls in this chat',\n  CHAT_SEND_STICKERS_FORBIDDEN: 'You can\\'t send stickers in this chat',\n  CHAT_SEND_GIFS_FORBIDDEN: 'You can\\'t send gifs in this chat',\n  CHAT_SEND_MEDIA_FORBIDDEN: 'You can\\'t send media in this chat',\n  CHAT_LINK_EXISTS: 'The chat is public, you can\\'t hide the history to new users',\n  // eslint-disable-next-line @stylistic/max-len\n  SLOWMODE_WAIT_X: 'Slowmode is enabled in this chat: you must wait for the specified number of seconds before sending another message to the chat.',\n  USER_BANNED_IN_CHANNEL: 'You\\'re banned from sending messages in supergroups / channels',\n  USER_IS_BLOCKED: 'You were blocked by this user',\n  YOU_BLOCKED_USER: 'You blocked this user',\n  IMAGE_PROCESS_FAILED: 'Failure while processing image',\n  MEDIA_EMPTY: 'The provided media object is invalid',\n  MEDIA_GROUPED_INVALID: 'Failed to replace album media',\n  MEDIA_NEW_INVALID: 'Failed to replace new media',\n  MESSAGE_NOT_MODIFIED: 'Message not modified. The new content is identical to the current one.',\n  MEDIA_INVALID: 'Media invalid',\n  PASSWORD_HASH_INVALID: 'Incorrect password',\n  PHOTO_EXT_INVALID: 'The extension of the photo is invalid',\n  PHOTO_INVALID_DIMENSIONS: 'The photo dimensions are invalid',\n  PHOTO_SAVE_FILE_INVALID: 'Internal issues, try again later',\n  // eslint-disable-next-line @stylistic/max-len\n  MESSAGE_DELETE_FORBIDDEN: 'You can\\'t delete one of the messages you tried to delete, most likely because it is a service message.',\n  MESSAGE_POLL_CLOSED: 'Poll closed',\n  MESSAGE_EDIT_TIME_EXPIRED: 'You can\\'t edit this message anymore.',\n  PINNED_DIALOGS_TOO_MUCH: 'Sorry, you can only pin 5 chats to the top',\n  CHANNEL_PRIVATE: 'This channel is private',\n  MEDIA_CAPTION_TOO_LONG: 'The provided caption is too long',\n  ADDRESS_STREET_LINE1_INVALID: 'The address you provided is not valid',\n  ADDRESS_STREET_LINE2_INVALID: 'The address you provided is not valid',\n  ADDRESS_CITY_INVALID: 'The city you provided is not valid',\n  ADDRESS_COUNTRY_INVALID: 'The country you provided is not valid',\n  ADDRESS_POSTCODE_INVALID: 'The postcode you provided is not valid',\n  ADDRESS_STATE_INVALID: 'The state you provided is not valid',\n  REQ_INFO_NAME_INVALID: 'The name you provided is not valid',\n  REQ_INFO_PHONE_INVALID: 'The phone you provided is not valid',\n  REQ_INFO_EMAIL_INVALID: 'The email you provided is not valid',\n  // TODO Bring back after fixing the weird bug\n  // CHANNEL_INVALID: 'An error occurred. Please try again later',\n  LINK_NOT_MODIFIED: 'This discussion is already linked to the channel',\n  MESSAGE_TOO_LONG: 'Message is too long',\n\n  // Non-API errors\n  // eslint-disable-next-line @stylistic/max-len\n  SERVICE_WORKER_DISABLED: 'Service Worker is disabled. Streaming media may not be supported. Try reloading the page without holding <Shift> key',\n  // eslint-disable-next-line @stylistic/max-len\n  MESSAGE_TOO_LONG_PLEASE_REMOVE_CHARACTERS: 'The provided message is too long. Please remove {EXTRA_CHARS_COUNT} character{PLURAL_S}.',\n  // eslint-disable-next-line @stylistic/max-len\n  FRESH_RESET_AUTHORISATION_FORBIDDEN: 'You cant logout other sessions if less than 24 hours have passed since you logged on the current session',\n\n  BOTS_TOO_MUCH: 'There are too many bots in this chat/channel',\n  BOT_GROUPS_BLOCKED: 'This bot can\\'t be added to groups',\n  USERS_TOO_MUCH: 'The maximum number of users has been exceeded',\n  USER_CHANNELS_TOO_MUCH: 'One of the users you tried to add is already in too many channels/supergroups',\n  USER_KICKED: 'This user was kicked from this supergroup/channel',\n  USER_NOT_MUTUAL_CONTACT: 'The provided user is not a mutual contact',\n  USER_PRIVACY_RESTRICTED: 'The user\\'s privacy settings do not allow you to do this',\n  INVITE_HASH_EMPTY: 'The invite hash is empty',\n  INVITE_HASH_EXPIRED: 'The invite link has expired',\n  INVITE_HASH_INVALID: 'The invite hash is invalid',\n  CHANNELS_TOO_MUCH: 'You have joined too many channels/supergroups',\n  USER_ALREADY_PARTICIPANT: 'You already in the group',\n  SCHEDULE_DATE_INVALID: 'Invalid schedule date provided',\n  WALLPAPER_DIMENSIONS_INVALID: 'The wallpaper dimensions are invalid, please select another file',\n  ADMINS_TOO_MUCH: 'There are too many admins',\n  ADMIN_RANK_EMOJI_NOT_ALLOWED: 'An admin rank cannot contain emojis',\n  ADMIN_RANK_INVALID: 'The specified admin rank is invalid',\n  FRESH_CHANGE_ADMINS_FORBIDDEN: 'You were just elected admin, you can\\'t add or modify other admins yet',\n  INPUT_USER_DEACTIVATED: 'Can\\'t do this action to a deleted account',\n  BOT_PRECHECKOUT_TIMEOUT: 'The request for payment has expired',\n  PROVIDER_ACCOUNT_TIMEOUT: 'Request to the payment provider has expired',\n\n  STARGIFT_CONVERT_TOO_OLD: 'This gift no longer can be converted to Stars',\n  SUBSCRIPTION_ALREADY_ACTIVE: 'You are already subscribed',\n\n  PEERS_LIST_EMPTY: 'No chats are added to the list',\n\n  PAID_MEDIA_FORBIDDEN: 'You can\\'t send paid media in this chat',\n\n  USER_DISALLOWED_STARGIFTS: 'User is not accepting gifts',\n};\n\nif (DEBUG) {\n  READABLE_ERROR_MESSAGES.CHAT_WRITE_FORBIDDEN = 'You can\\'t write in this chat';\n  READABLE_ERROR_MESSAGES.CHAT_ADMIN_REQUIRED = 'You must be an admin in this chat to do this';\n}\n\nexport const SHIPPING_ERRORS: Record<string, ApiFieldError> = {\n  ADDRESS_STREET_LINE1_INVALID: {\n    field: 'streetLine1',\n    message: 'Incorrect street address',\n  },\n  ADDRESS_STREET_LINE2_INVALID: {\n    field: 'streetLine2',\n    message: 'Incorrect street address',\n  },\n  ADDRESS_CITY_INVALID: {\n    field: 'city',\n    message: 'Incorrect city',\n  },\n  ADDRESS_COUNTRY_INVALID: {\n    field: 'countryIso2',\n    message: 'Incorrect country',\n  },\n  ADDRESS_POSTCODE_INVALID: {\n    field: 'postCode',\n    message: 'Incorrect post code',\n  },\n  ADDRESS_STATE_INVALID: {\n    field: 'state',\n    message: 'Incorrect state',\n  },\n  REQ_INFO_NAME_INVALID: {\n    field: 'fullName',\n    message: 'Incorrect name',\n  },\n  REQ_INFO_PHONE_INVALID: {\n    field: 'phone',\n    message: 'Incorrect phone',\n  },\n  REQ_INFO_EMAIL_INVALID: {\n    field: 'email',\n    message: 'Incorrect email',\n  },\n};\n\nconst FINAL_PAYMENT_ERRORS = new Set([\n  'BOT_PRECHECKOUT_FAILED',\n  'PAYMENT_FAILED',\n]);\n\nexport default function getReadableErrorText(error: ApiError) {\n  const { message, isSlowMode, textParams } = error;\n  // Currently, Telegram API doesn't return `SLOWMODE_WAIT_X` error as described in the docs\n  if (isSlowMode) {\n    const extraPartIndex = message.indexOf(' (caused by');\n    return extraPartIndex > 0 ? message.substring(0, extraPartIndex) : message;\n  }\n  let errorMessage = READABLE_ERROR_MESSAGES[message];\n  if (errorMessage && textParams) {\n    errorMessage = Object.keys(textParams).reduce((acc, current) => {\n      return acc.replace(current, textParams[current]);\n    }, errorMessage);\n  }\n  return errorMessage;\n}\n\nexport function getShippingError(error: ApiError): ApiFieldError | undefined {\n  return SHIPPING_ERRORS[error.message];\n}\n\nexport function shouldClosePaymentModal(error: ApiError): boolean {\n  return FINAL_PAYMENT_ERRORS.has(error.message);\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + chunkId + \".\" + {\"21\":\"73b661b5cf858af56805\",\"26\":\"8e95f5fe6995e087720a\",\"46\":\"7b8066180f2e4bb6c960\",\"59\":\"c7249c2aa8adb4d6c516\",\"61\":\"0fb9c9a36b81fe1e9ed2\",\"69\":\"bbe2a6f4b4f7cec0ab48\",\"90\":\"4b8b108b80b4fb739a5d\",\"103\":\"e11921d5b84ca44b9fa1\",\"131\":\"2a8d33524b0a88ea9cff\",\"194\":\"dab2010c9b7f1139930b\",\"213\":\"6bbf87da668a149b6c33\",\"234\":\"b030b432da6a7d0f5d5d\",\"304\":\"f98f6b5b4b8612cabc42\",\"313\":\"4ad4a567e60d266306ce\",\"356\":\"6668c6eb6512589dd835\",\"373\":\"ae5dce1a82255d5145ee\",\"387\":\"eb36694fb23554d46715\",\"400\":\"96a0607fe2728052f000\",\"405\":\"f997b5a7439cc71e5751\",\"409\":\"945141656bd5bd0f1640\",\"433\":\"aaa72cdcc385ff1809ae\",\"453\":\"42b4091cf05167dd0349\",\"482\":\"3da4aa11da09e63a7282\",\"520\":\"e1658f071e2304eebe56\",\"562\":\"4ebed54f131fbe493f98\",\"564\":\"bc71aa5a1af381f43a4b\",\"628\":\"f193d49d6dc4a615777a\",\"633\":\"85caae5a5d70a7756063\",\"676\":\"00ecdcfe711327b5d2d6\",\"683\":\"7c8c922b5f8560d9c225\",\"695\":\"c8c1dfbf660b127b4d45\",\"748\":\"36db6dbb9d6ccc18acf6\",\"768\":\"3edf7892a0f818b38a53\",\"835\":\"965794b7e0d537e0101b\",\"947\":\"836f970781d91c1c4200\",\"970\":\"6b6b7bd457ba5009e432\",\"984\":\"a77d4b84caf2e3ab95de\",\"996\":\"833dd5acb031f0601df0\",\"1022\":\"852ccf98b995d80182b4\",\"1095\":\"a20b805bb1533d875e41\",\"1105\":\"29e92b11805b59086857\",\"1164\":\"c5e76549adc567ed6539\",\"1168\":\"91b176bbe8e6f88e55fe\",\"1215\":\"508f348355c74b510049\",\"1348\":\"c5f4bcaabadf3871d4fe\",\"1387\":\"be0b94c8c5de45dca592\",\"1401\":\"2f07510f0b474c4ad578\",\"1465\":\"91e4be1948458ea7d152\",\"1516\":\"778f10f04e56bb0a0cf1\",\"1567\":\"9a8135f021ac05e23363\",\"1575\":\"32d14e8d6c20dd2e9f0a\",\"1586\":\"a4717734a3dbc0de6ac1\",\"1620\":\"9ac3e22e963d79d726ee\",\"1692\":\"85a1bd7b6ea1947f1b93\",\"1700\":\"0d42d1f1e2f6cdc225b0\",\"1775\":\"cb4548646be49beb6d40\",\"1780\":\"ec01f2b8a47acc37a05d\",\"1877\":\"0d4ff31cefe6e4b035ba\",\"1930\":\"9978c5d26afe18defc5a\",\"2057\":\"c4dfb8e63760e4bb9b0d\",\"2158\":\"d41a26ad9414ecb371a4\",\"2164\":\"843ffecaf8668ae22ad9\",\"2225\":\"eec22073d330e5fae440\",\"2230\":\"388870d201c50557e098\",\"2263\":\"9da2e1bf5941df984bf9\",\"2394\":\"42a20e0727753441fe7c\",\"2448\":\"4c37c820eaa38dd7de1a\",\"2465\":\"8006beefe86aadf4973a\",\"2498\":\"517dd9d10378a2e76b4a\",\"2557\":\"ee50485671b68b4c39f0\",\"2626\":\"fa1611cd62591c48bd35\",\"2651\":\"775af5b51d0d12710856\",\"2670\":\"761755c3609c440e4734\",\"2729\":\"a7ca97e319dc4374622d\",\"2800\":\"c67072a1dd6c84df901d\",\"2801\":\"eb91c444d8cd4db49c81\",\"2856\":\"6acd0145226e20a4229f\",\"2857\":\"fda25d0d47d4cade3f1c\",\"2859\":\"e6fb76c4a7aaafa8e786\",\"2916\":\"76c7a15286732ebdebab\",\"2990\":\"de1421f42f0f3d166e9e\",\"3014\":\"1415839065e99dc45159\",\"3080\":\"f9de5236494b0d92b811\",\"3246\":\"9629553cb6abca89338a\",\"3272\":\"d21aed82ed71c066ab24\",\"3325\":\"2807abbe877ec9652bc4\",\"3363\":\"b278a83347b64666b829\",\"3405\":\"ee3ebaf9cad1eb73226a\",\"3499\":\"c65cb41ef61fa02360af\",\"3524\":\"655b5a2ac1f5ecd63fb6\",\"3564\":\"f887bc8598995717a4bc\",\"3715\":\"4cdfee27972729a642b4\",\"3731\":\"10a2f15dbf3f17974cff\",\"3745\":\"cace52da581f0fcc014b\",\"3747\":\"43cbee1e217f4e463958\",\"3787\":\"9f651e721be3e7aded8d\",\"3813\":\"4ea8ce90ca6e731b17bc\",\"3906\":\"a486545450af35d7a13c\",\"3981\":\"31b475f309855c7ecab3\",\"4008\":\"c0e5feb0207808211d4c\",\"4019\":\"eb1a85b3ad5af4028862\",\"4020\":\"a8b038ec1cec5d779ea7\",\"4102\":\"152516502f782f5c9c92\",\"4128\":\"88c733bf467483d0d648\",\"4134\":\"0a838be3fc6bbc877978\",\"4180\":\"1ff1987ba7fa40858037\",\"4204\":\"f78d3003e2dc3de6d660\",\"4230\":\"bec2e4a29087b4afe291\",\"4326\":\"0a9d50701f3470e1dddf\",\"4336\":\"f6fd461f477348c2256e\",\"4383\":\"ae5649d5956d557254b1\",\"4435\":\"07fe2b460b041986c7f2\",\"4448\":\"cfb99532f00784c483af\",\"4484\":\"21d8331b033e5ef592d5\",\"4550\":\"a0b8d7373b9a52e695bc\",\"4765\":\"6dcd95f71711c9e27614\",\"4785\":\"327adda7b47792462f5e\",\"4810\":\"d8d313410d610d15e995\",\"4917\":\"860947d508ae84a20f15\",\"4940\":\"0707a828b9aa9e62c4f4\",\"5032\":\"2e99730f81f874efb9db\",\"5046\":\"b7ab52bfeda646dc7c36\",\"5060\":\"746daaeb1c132f66eb0c\",\"5073\":\"9e837c35a9fbe68d8eda\",\"5116\":\"e47fa3b2faf1ef1b9934\",\"5148\":\"1848dfd54321b8b7d9b6\",\"5193\":\"d4a837ee1037e2555754\",\"5246\":\"1c3986ff5bd87c167774\",\"5260\":\"0e30083d65fdb9879fd3\",\"5269\":\"c1a61f3f133e459b3c68\",\"5336\":\"905fb5ef123fe47b0a3b\",\"5345\":\"764dffdc1a614239c996\",\"5361\":\"02205a0330ed0a61b1e4\",\"5420\":\"175c5d896f862b8e743c\",\"5429\":\"f39e2ead50d4f40985d9\",\"5434\":\"52a0dae5e5f7c6f286ce\",\"5438\":\"8fd1633dae336481470e\",\"5499\":\"e4118e046128d0a8d698\",\"5525\":\"671f74d3174f2f935540\",\"5628\":\"2266f349ac24f8ef06ea\",\"5719\":\"4ed099bd757581db8c00\",\"5735\":\"dae36b0a107d6d62fba2\",\"5819\":\"fd2cbafab49d11b03033\",\"5962\":\"a17d60a833793b2f72df\",\"6005\":\"1d398376791c56e9b68b\",\"6047\":\"23652f05a477a465f8b3\",\"6058\":\"704c9608ce92440d6efd\",\"6167\":\"6caaee956bf92ca2de4e\",\"6168\":\"c85b4b025bb1af7b1549\",\"6241\":\"7889de480d99c1c7d5e1\",\"6265\":\"1eb424edcbf6c27fc969\",\"6272\":\"b14b1655a5d87be51ce6\",\"6308\":\"48f5e3ec135f06622d7d\",\"6314\":\"3c3075843f64c192ec14\",\"6338\":\"bb6643f5f35ca2a4cea4\",\"6438\":\"1a7e2d3d00aa266b04f1\",\"6441\":\"0d1096f1b342565f61fb\",\"6442\":\"315f969a6e810a86dcd1\",\"6473\":\"6f682c7078f95c418792\",\"6685\":\"3e0f7b7b5f38887b9d22\",\"6686\":\"221a6620493238a492bc\",\"6708\":\"045d85a32e725392c372\",\"6726\":\"2763d15ea03f87e7ff8b\",\"6802\":\"4749ade8f061adbccf89\",\"6827\":\"20aae086c9a2560513fe\",\"6860\":\"d5048bf0d83ca01012eb\",\"6869\":\"5bd2d22e5fdb13079b52\",\"6930\":\"09b4e578ba34edb6be53\",\"6947\":\"567afb78b595ebc762b1\",\"7001\":\"5a827221aa7b07b5473e\",\"7120\":\"4f1065d06ba3080c4782\",\"7244\":\"28f241f69dd68d10e2e9\",\"7276\":\"daa7d749a537de8c3efa\",\"7357\":\"572d82d2052f0ed2b7a7\",\"7405\":\"f4341dc5c9d13779ffe5\",\"7408\":\"de541219e6e014837782\",\"7424\":\"08d0141652f29f541b0b\",\"7426\":\"3cdd29ab51b6e82590b8\",\"7487\":\"477d68ace2ed87197efa\",\"7499\":\"10dd4bfa648eb94f830a\",\"7561\":\"3dd3f5aafb443d4b6fad\",\"7586\":\"4fa8395fdc0ba1b4c150\",\"7594\":\"92624350625bc48dbace\",\"7612\":\"a9a7e1e97dff11adb842\",\"7617\":\"52517f197778d148d98d\",\"7688\":\"ec5d3b9e8da267d72ac9\",\"7738\":\"c274d5f5ac81687b6f4b\",\"7768\":\"2bc097209e84fb307dbb\",\"7854\":\"682e38598b7bb58f0f06\",\"7880\":\"e2210de9917f2920fc94\",\"7901\":\"caef3aaee7d9166a68a7\",\"7939\":\"e2f63b5b273538de65d2\",\"7972\":\"45876c4e69430d7758cd\",\"7978\":\"6a354f0d57a5e812c3eb\",\"8043\":\"4e73cda35b872bca33f1\",\"8062\":\"d457a9fad020f5c4e3ad\",\"8100\":\"4a6037a5e6fe77172d50\",\"8114\":\"9a4462b173f4c8e57b15\",\"8123\":\"8b16959ca878f3968097\",\"8142\":\"86a97aed5175e95b9c53\",\"8150\":\"4b4d0406d85c76c5dcaf\",\"8169\":\"96d8fe237fc684138d24\",\"8201\":\"2585de205b92ae4376ea\",\"8213\":\"a255240350fc5e3e1d3d\",\"8214\":\"ec71167645785ccd8121\",\"8233\":\"d17187d77d7b55f0c5b9\",\"8287\":\"ca57178ed54d9e61396c\",\"8308\":\"27e15e907df7a35c469f\",\"8349\":\"0f706c5f46021dd7a88f\",\"8393\":\"6aa4a4b6a5e0f21aa2ba\",\"8602\":\"299d63db843dd20fdc09\",\"8621\":\"18bde397f66357139738\",\"8764\":\"b84ddb95ef3b84995841\",\"8790\":\"a00c071acfad0461ab4a\",\"8804\":\"cf770918b1520a1b5590\",\"8843\":\"8f1a6aef3721143d518f\",\"8924\":\"3c315801bc8b6d8f9d7b\",\"8925\":\"060fa1d8c8f82840c6a4\",\"8967\":\"99acf133851b2f244fc6\",\"8980\":\"48e10d1537c3069e5261\",\"9004\":\"2dce0728187a55c891dd\",\"9030\":\"de7b7f068fa697201397\",\"9072\":\"0e4b8c5bf7414c74294b\",\"9141\":\"ad20210782feb3cdc339\",\"9183\":\"9cedae775cd33774d085\",\"9238\":\"6625f24efa3edbf784b1\",\"9250\":\"82dbb6c05b14c53bef16\",\"9287\":\"bdc45ba51b7b12ecacd2\",\"9295\":\"d063f7908b06bac42c02\",\"9359\":\"ae2b8f85c7887610de73\",\"9375\":\"861480a3a00c75b6e596\",\"9443\":\"000f37559b5f4c87d746\",\"9451\":\"173e2c2d1d73f2a60e95\",\"9549\":\"4d7d679f0df1fc68b1ba\",\"9623\":\"2c18e148914b7483b780\",\"9677\":\"e1ba9e5de42bc17ac61b\",\"9710\":\"4634b8ac25905921d3a0\",\"9753\":\"62977df7cbfafacef4da\",\"9761\":\"30d72d95bbb2529a044d\",\"9849\":\"7c730044428ae91565ed\",\"9869\":\"89ab3c68dbeb5b28a89c\",\"9998\":\"7153d6a285669dedcef5\"}[chunkId] + \".js\";\n};","// This function allow to reference async chunks\n__webpack_require__.miniCssF = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + ({\"2394\":\"BundleCalls\",\"4765\":\"shared-components\",\"6930\":\"BundleStars\",\"7405\":\"BundleAuth\",\"7768\":\"BundleMain\",\"9451\":\"BundleExtra\"}[chunkId] || chunkId) + \".\" + {\"2394\":\"42a20e0727753441fe7c\",\"2557\":\"ee50485671b68b4c39f0\",\"3014\":\"1415839065e99dc45159\",\"4765\":\"6dcd95f71711c9e27614\",\"4810\":\"d8d313410d610d15e995\",\"6930\":\"09b4e578ba34edb6be53\",\"7405\":\"f4341dc5c9d13779ffe5\",\"7768\":\"2bc097209e84fb307dbb\",\"9451\":\"173e2c2d1d73f2a60e95\"}[chunkId] + \".css\";\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript && document.currentScript.tagName.toUpperCase() === 'SCRIPT')\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && (!scriptUrl || !/^http(s?):/.test(scriptUrl))) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/^blob:/, \"\").replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","if (typeof document === \"undefined\") return;\nvar createStylesheet = (chunkId, fullhref, oldTag, resolve, reject) => {\n\tvar linkTag = document.createElement(\"link\");\n\n\tlinkTag.rel = \"stylesheet\";\n\tlinkTag.type = \"text/css\";\n\tif (__webpack_require__.nc) {\n\t\tlinkTag.nonce = __webpack_require__.nc;\n\t}\n\tvar onLinkComplete = (event) => {\n\t\t// avoid mem leaks.\n\t\tlinkTag.onerror = linkTag.onload = null;\n\t\tif (event.type === 'load') {\n\t\t\tresolve();\n\t\t} else {\n\t\t\tvar errorType = event && event.type;\n\t\t\tvar realHref = event && event.target && event.target.href || fullhref;\n\t\t\tvar err = new Error(\"Loading CSS chunk \" + chunkId + \" failed.\\n(\" + errorType + \": \" + realHref + \")\");\n\t\t\terr.name = \"ChunkLoadError\";\n\t\t\terr.code = \"CSS_CHUNK_LOAD_FAILED\";\n\t\t\terr.type = errorType;\n\t\t\terr.request = realHref;\n\t\t\tif (linkTag.parentNode) linkTag.parentNode.removeChild(linkTag)\n\t\t\treject(err);\n\t\t}\n\t}\n\tlinkTag.onerror = linkTag.onload = onLinkComplete;\n\tlinkTag.href = fullhref;\n\n\n\tif (oldTag) {\n\t\toldTag.parentNode.insertBefore(linkTag, oldTag.nextSibling);\n\t} else {\n\t\tdocument.head.appendChild(linkTag);\n\t}\n\treturn linkTag;\n};\nvar findStylesheet = (href, fullhref) => {\n\tvar existingLinkTags = document.getElementsByTagName(\"link\");\n\tfor(var i = 0; i < existingLinkTags.length; i++) {\n\t\tvar tag = existingLinkTags[i];\n\t\tvar dataHref = tag.getAttribute(\"data-href\") || tag.getAttribute(\"href\");\n\t\tif(tag.rel === \"stylesheet\" && (dataHref === href || dataHref === fullhref)) return tag;\n\t}\n\tvar existingStyleTags = document.getElementsByTagName(\"style\");\n\tfor(var i = 0; i < existingStyleTags.length; i++) {\n\t\tvar tag = existingStyleTags[i];\n\t\tvar dataHref = tag.getAttribute(\"data-href\");\n\t\tif(dataHref === href || dataHref === fullhref) return tag;\n\t}\n};\nvar loadStylesheet = (chunkId) => {\n\treturn new Promise((resolve, reject) => {\n\t\tvar href = __webpack_require__.miniCssF(chunkId);\n\t\tvar fullhref = __webpack_require__.p + href;\n\t\tif(findStylesheet(href, fullhref)) return resolve();\n\t\tcreateStylesheet(chunkId, fullhref, null, resolve, reject);\n\t});\n}\n// object to store loaded CSS chunks\nvar installedCssChunks = {\n\t8792: 0\n};\n\n__webpack_require__.f.miniCss = (chunkId, promises) => {\n\tvar cssChunks = {\"2394\":1,\"2557\":1,\"3014\":1,\"4765\":1,\"4810\":1,\"6930\":1,\"7405\":1,\"7768\":1,\"9451\":1};\n\tif(installedCssChunks[chunkId]) promises.push(installedCssChunks[chunkId]);\n\telse if(installedCssChunks[chunkId] !== 0 && cssChunks[chunkId]) {\n\t\tpromises.push(installedCssChunks[chunkId] = loadStylesheet(chunkId).then(() => {\n\t\t\tinstalledCssChunks[chunkId] = 0;\n\t\t}, (e) => {\n\t\t\tdelete installedCssChunks[chunkId];\n\t\t\tthrow e;\n\t\t}));\n\t}\n};\n\n// no hmr\n\n// no prefetching\n\n// no preloaded","__webpack_require__.b = document.baseURI || self.location.href;\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t8792: 0\n};\n\n__webpack_require__.f.j = (chunkId, promises) => {\n\t\t// JSONP chunk loading for javascript\n\t\tvar installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n\t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n\t\t\t// a Promise means \"currently loading\".\n\t\t\tif(installedChunkData) {\n\t\t\t\tpromises.push(installedChunkData[2]);\n\t\t\t} else {\n\t\t\t\tif(true) { // all chunks have JS\n\t\t\t\t\t// setup Promise in chunk cache\n\t\t\t\t\tvar promise = new Promise((resolve, reject) => (installedChunkData = installedChunks[chunkId] = [resolve, reject]));\n\t\t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n\t\t\t\t\t// start chunk loading\n\t\t\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\tvar loadingEnded = (event) => {\n\t\t\t\t\t\tif(__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\t\t\tif(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\t\t\tif(installedChunkData) {\n\t\t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n\t\t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\t\t\tinstalledChunkData[1](error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t__webpack_require__.l(url, loadingEnded, \"chunk-\" + chunkId, chunkId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n};\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunktelegram_t\"] = self[\"webpackChunktelegram_t\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","import { getActions } from '../global';\n\nimport { DEBUG, DEBUG_MORE, IS_TEST } from '../config';\nimport { IS_ANDROID, IS_IOS, IS_SERVICE_WORKER_SUPPORTED } from './browser/windowEnvironment';\nimport { formatShareText } from './deeplink';\nimport { validateFiles } from './files';\nimport { notifyClientReady, playNotifySoundDebounced } from './notifications';\n\ntype WorkerAction = {\n  type: string;\n  payload: Record<string, any>;\n};\n\nconst IGNORE_WORKER_PATH = '/k/';\n\nfunction handleWorkerMessage(e: MessageEvent) {\n  const action: WorkerAction = e.data;\n  if (DEBUG_MORE) {\n    // eslint-disable-next-line no-console\n    console.log('[SW] Message from worker', action);\n  }\n  if (!action.type) return;\n  const dispatch = getActions();\n  const payload = action.payload;\n  switch (action.type) {\n    case 'focusMessage':\n      dispatch.focusMessage?.(payload as any);\n      break;\n    case 'playNotificationSound':\n      playNotifySoundDebounced(action.payload.id);\n      break;\n    case 'share':\n      dispatch.openChatWithDraft({\n        text: formatShareText(payload.url, payload.text, payload.title),\n        files: validateFiles(payload.files),\n      });\n      break;\n  }\n}\n\nfunction subscribeToWorker() {\n  navigator.serviceWorker.removeEventListener('message', handleWorkerMessage);\n  navigator.serviceWorker.addEventListener('message', handleWorkerMessage);\n  // Notify web worker that client is ready to receive messages\n  notifyClientReady();\n}\n\nif (IS_SERVICE_WORKER_SUPPORTED) {\n  window.addEventListener('load', async () => {\n    try {\n      const controller = navigator.serviceWorker.controller;\n      if (!controller || controller.scriptURL.includes(IGNORE_WORKER_PATH)) {\n        const registrations = await navigator.serviceWorker.getRegistrations();\n        const ourRegistrations = registrations.filter((r) => !r.scope.includes(IGNORE_WORKER_PATH));\n        if (ourRegistrations.length) {\n          if (DEBUG) {\n            // eslint-disable-next-line no-console\n            console.log('[SW] Hard reload detected, re-enabling Service Worker');\n          }\n          await Promise.all(ourRegistrations.map((r) => r.unregister()));\n        }\n      }\n\n      await navigator.serviceWorker.register(new URL('../serviceWorker', import.meta.url));\n\n      if (DEBUG) {\n        // eslint-disable-next-line no-console\n        console.log('[SW] ServiceWorker registered');\n      }\n\n      await navigator.serviceWorker.ready;\n\n      // Wait for registration to be available\n      await navigator.serviceWorker.getRegistration();\n\n      if (navigator.serviceWorker.controller) {\n        if (DEBUG) {\n          // eslint-disable-next-line no-console\n          console.log('[SW] ServiceWorker ready');\n        }\n        subscribeToWorker();\n      } else {\n        if (DEBUG) {\n          // eslint-disable-next-line no-console\n          console.error('[SW] ServiceWorker not available');\n        }\n\n        if (!IS_IOS && !IS_ANDROID && !IS_TEST) {\n          getActions().showDialog?.({ data: { message: 'SERVICE_WORKER_DISABLED', hasErrorKey: true } });\n        }\n      }\n    } catch (err) {\n      if (DEBUG) {\n        // eslint-disable-next-line no-console\n        console.error('[SW] ServiceWorker registration failed: ', err);\n      }\n    }\n  });\n  window.addEventListener('focus', async () => {\n    await navigator.serviceWorker.ready;\n    subscribeToWorker();\n  });\n}\n","import { addCallback } from '../lib/teact/teactn';\n\nimport type { GlobalState } from './types';\n\nimport { getServerTime } from '../util/serverTime';\nimport { removePeerStory } from './reducers';\nimport { selectTabState } from './selectors';\nimport { getGlobal, setGlobal } from '.';\n\nconst STORY_EXPIRATION_INTERVAL = 2 * 60 * 1000; // 2 min\n\nlet intervals: number[] = [];\n\nlet prevGlobal: GlobalState | undefined;\n\naddCallback((global: GlobalState) => {\n  const previousGlobal = prevGlobal;\n  prevGlobal = global;\n\n  const isCurrentMaster = selectTabState(global)?.isMasterTab;\n  const isPreviousMaster = previousGlobal && selectTabState(previousGlobal)?.isMasterTab;\n  if (isCurrentMaster === isPreviousMaster) return;\n\n  if (isCurrentMaster && !isPreviousMaster) {\n    startIntervals();\n  } else {\n    stopIntervals();\n  }\n});\n\nfunction startIntervals() {\n  if (intervals.length) return;\n  intervals.push(window.setInterval(checkStoryExpiration, STORY_EXPIRATION_INTERVAL));\n}\n\nfunction stopIntervals() {\n  intervals.forEach((interval) => clearInterval(interval));\n  intervals = [];\n}\n\nfunction checkStoryExpiration() {\n  let global = getGlobal();\n  if (!global.isInited) return;\n\n  const serverTime = getServerTime();\n\n  Object.values(global.stories.byPeerId).forEach((peerStories) => {\n    const stories = Object.values(peerStories.byId);\n    stories.forEach((story) => {\n      if (story['@type'] !== 'story') return;\n      if (story.expireDate > serverTime) return;\n      if (story.isInProfile) return;\n\n      global = removePeerStory(global, story.peerId, story.id);\n    });\n  });\n\n  setGlobal(global);\n}\n","import type { GlobalState } from '../global/types';\n\nimport { IS_MOCKED_CLIENT } from '../config';\nimport { loadCache, loadCachedSharedState } from '../global/cache';\nimport {\n  getGlobal, setGlobal,\n} from '../global/index';\nimport { INITIAL_GLOBAL_STATE } from '../global/initialState';\nimport { updatePasscodeSettings } from '../global/reducers';\nimport { cloneDeep } from './iteratees';\nimport { clearStoredSession } from './sessions';\n\nexport async function initGlobal(force: boolean = false, prevGlobal?: GlobalState) {\n  prevGlobal = prevGlobal || getGlobal();\n  if (!force && 'byTabId' in prevGlobal) {\n    return;\n  }\n\n  const initial = cloneDeep(INITIAL_GLOBAL_STATE);\n  const cache = await loadCache(initial);\n  let global = cache || initial;\n  if (IS_MOCKED_CLIENT) global.authState = 'authorizationStateReady';\n\n  const { hasPasscode, isScreenLocked } = global.passcode;\n  if (hasPasscode && !isScreenLocked) {\n    global = updatePasscodeSettings(global, {\n      isScreenLocked: true,\n    });\n\n    clearStoredSession();\n  }\n\n  if (force) {\n    global.byTabId = prevGlobal.byTabId;\n  }\n\n  if (!cache) { // Try loading shared state separately\n    const storedSharedState = await loadCachedSharedState();\n    if (storedSharedState) {\n      global.sharedState = storedSharedState;\n    }\n  }\n\n  setGlobal(global);\n}\n","import './intervals';\n\nimport type { ActionReturnType, GlobalState } from './types';\n\nimport { IS_MULTIACCOUNT_SUPPORTED } from '../util/browser/globalEnvironment';\nimport { isCacheApiSupported } from '../util/cacheApi';\nimport { getCurrentTabId, reestablishMasterToSelf } from '../util/establishMultitabRole';\nimport { initGlobal } from '../util/init';\nimport { cloneDeep } from '../util/iteratees';\nimport { isLocalMessageId } from '../util/keys/messageKey';\nimport { Bundles, loadBundle } from '../util/moduleLoader';\nimport { parseLocationHash } from '../util/routing';\nimport { updatePeerColors } from '../util/theme';\nimport { initializeChatMediaSearchResults } from './reducers/middleSearch';\nimport { updateTabState } from './reducers/tabs';\nimport { initSharedState } from './shared/sharedStateConnector';\nimport { initCache } from './cache';\nimport {\n  addActionHandler, getGlobal, setGlobal,\n} from './index';\nimport { INITIAL_TAB_STATE } from './initialState';\nimport { replaceTabThreadParam, replaceThreadParam } from './reducers';\nimport { selectTabState, selectThreadParam } from './selectors';\n\ninitCache();\n\naddActionHandler('initShared', async (prevGlobal, actions, payload): Promise<void> => {\n  const { force } = payload || {};\n  await initGlobal(force, prevGlobal);\n});\n\naddActionHandler('init', (global, actions, payload): ActionReturnType => {\n  const { tabId = getCurrentTabId(), isMasterTab } = payload || {};\n\n  const initialTabState = cloneDeep(INITIAL_TAB_STATE);\n  initialTabState.id = tabId;\n  initialTabState.audioPlayer.playbackRate = global.audioPlayer.lastPlaybackRate;\n  initialTabState.audioPlayer.isPlaybackRateActive = global.audioPlayer.isLastPlaybackRateActive;\n  initialTabState.mediaViewer.playbackRate = global.mediaViewer.lastPlaybackRate;\n  if (global.lastIsChatInfoShown) {\n    initialTabState.chatInfo = {\n      isOpen: true,\n    };\n  }\n\n  global = {\n    ...global,\n    byTabId: {\n      ...global.byTabId,\n      [tabId]: initialTabState,\n    },\n  };\n\n  if (isMasterTab) {\n    initialTabState.isMasterTab = true;\n  }\n\n  if (IS_MULTIACCOUNT_SUPPORTED && initialTabState.isMasterTab) {\n    initSharedState(global.sharedState);\n  }\n\n  Object.keys(global.messages.byChatId).forEach((chatId) => {\n    const threadsById = global.messages.byChatId[chatId].threadsById;\n    Object.keys(threadsById).forEach((thread) => {\n      const threadId = Number(thread);\n      const lastViewportIds = selectThreadParam(global, chatId, threadId, 'lastViewportIds');\n      // Check if migration from previous version is faulty\n      if (!lastViewportIds?.every((id) => isLocalMessageId(id) || global.messages.byChatId[chatId]?.byId[id])) {\n        global = replaceThreadParam(global, chatId, threadId, 'lastViewportIds', undefined);\n        return;\n      }\n      global = initializeChatMediaSearchResults(global, chatId, threadId, tabId);\n      global = replaceTabThreadParam(\n        global,\n        chatId,\n        threadId,\n        'viewportIds',\n        lastViewportIds,\n        tabId,\n      );\n    });\n  });\n\n  // Temporary state fix\n  Object.keys(global.messages.byChatId).forEach((chatId) => {\n    const threadsById = global.messages.byChatId[chatId].threadsById;\n    const fixedThreadsById = Object.keys(threadsById).reduce((acc, key) => {\n      const t = threadsById[Number(key)];\n      acc[Number(key)] = {\n        ...t,\n        listedIds: t.lastViewportIds,\n      };\n      return acc;\n    }, {} as GlobalState['messages']['byChatId'][string]['threadsById']);\n\n    global = {\n      ...global,\n      messages: {\n        ...global.messages,\n        byChatId: {\n          ...global.messages.byChatId,\n          [chatId]: {\n            ...global.messages.byChatId[chatId],\n            threadsById: fixedThreadsById,\n          },\n        },\n      },\n    };\n  });\n\n  const parsedMessageList = parseLocationHash(global.currentUserId);\n\n  if (global.authState !== 'authorizationStateReady'\n    && !global.passcode.hasPasscode && !global.passcode.isScreenLocked) {\n    Object.values(global.byTabId).forEach(({ id: otherTabId }) => {\n      if (otherTabId === tabId) return;\n      global = updateTabState(global, {\n        inactiveReason: 'auth',\n      }, otherTabId);\n    });\n  }\n\n  isCacheApiSupported().then((isSupported) => {\n    global = getGlobal();\n    global.isCacheApiSupported = isSupported;\n    setGlobal(global);\n  });\n\n  if (global.peerColors) {\n    updatePeerColors(global.peerColors.general);\n  }\n\n  return updateTabState(global, {\n    messageLists: parsedMessageList ? [parsedMessageList] : initialTabState.messageLists,\n  }, tabId);\n});\n\naddActionHandler('requestMasterAndCallAction', async (\n  global, actions, payload,\n): Promise<void> => {\n  const { tabId = getCurrentTabId() } = payload;\n\n  if (selectTabState(global, tabId).isMasterTab) {\n    const { action, payload: actionPayload } = payload;\n    // @ts-ignore\n    actions[action](actionPayload);\n    return;\n  }\n\n  if (global.phoneCall || global.groupCalls.activeGroupCallId) {\n    await loadBundle(Bundles.Calls);\n    if ('hangUp' in actions) actions.hangUp({ tabId });\n    if ('leaveGroupCall' in actions) actions.leaveGroupCall({ tabId });\n  } else {\n    reestablishMasterToSelf();\n  }\n\n  global = getGlobal();\n  global = updateTabState(global, {\n    multitabNextAction: payload,\n  }, tabId);\n  setGlobal(global);\n});\n\naddActionHandler('clearMultitabNextAction', (global, actions, payload): ActionReturnType => {\n  const { tabId = getCurrentTabId() } = payload || {};\n\n  return updateTabState(global, {\n    multitabNextAction: undefined,\n  }, tabId);\n});\n","import { IS_IOS } from './browser/windowEnvironment';\nimport { animate } from './animation';\nimport { fastRaf } from './schedulers';\n\nconst TEST_INTERVAL = 5000; // 5 sec\nconst FRAMES_TO_TEST = 10;\nconst REDUCED_FPS = 35;\n\nlet isImproved = false;\n\nexport function betterView() {\n  if (!IS_IOS) return;\n\n  let interval: number | undefined;\n  let lastFocusAt = Date.now();\n\n  function setupInterval() {\n    if (interval || isImproved) return;\n\n    interval = window.setInterval(testAndImprove, TEST_INTERVAL);\n  }\n\n  window.addEventListener('focus', () => {\n    const now = Date.now();\n    if (now - lastFocusAt < 100) return; // iOS triggers two `focus` events for some reason\n    lastFocusAt = now;\n\n    setupInterval();\n    testAndImprove();\n  });\n\n  window.addEventListener('blur', () => {\n    clearInterval(interval);\n    interval = undefined;\n  });\n\n  if (document.hasFocus()) {\n    setupInterval();\n    testAndImprove();\n  }\n}\n\nasync function testAndImprove() {\n  const fps = await testFps();\n  if (fps <= REDUCED_FPS) {\n    improveView();\n  }\n}\n\nfunction testFps() {\n  return new Promise<number>((resolve) => {\n    const frames: number[] = [];\n    let lastFrameAt = performance.now();\n\n    animate(() => {\n      const now = performance.now();\n      frames.push(now - lastFrameAt);\n      lastFrameAt = now;\n\n      if (frames.length === FRAMES_TO_TEST) {\n        const mean = frames.sort()[Math.floor(frames.length / 2)];\n        resolve(Math.round(1000 / mean));\n        return false;\n      }\n\n      return true;\n    }, fastRaf);\n  });\n}\n\nfunction improveView() {\n  isImproved = true;\n\n  const containerEl = document.createElement('div');\n  containerEl.style.cssText = 'position: absolute; top: 0; left: 0; width: 0; height: 100%; overflow: hidden;';\n\n  const boosterEl = document.createElement('div');\n  const height = window.screen.height * 1.5;\n  boosterEl.style.cssText = `width: 0; height: ${height}px; transform: translateX(100%); transition: transform 100ms;`;\n  boosterEl.innerHTML = '&nbsp;';\n\n  containerEl.appendChild(boosterEl);\n  document.body.appendChild(containerEl);\n\n  requestAnimationFrame(() => {\n    boosterEl.addEventListener('transitionend', () => {\n      containerEl.remove();\n    });\n\n    boosterEl.style.transform = '';\n  });\n}\n","import { getActions } from '../../global';\n\nimport { DEBUG } from '../../config';\nimport { MouseButton } from '../browser/windowEnvironment';\n\ntype DownloadFinishedEvent = {\n  success: boolean;\n  url: string;\n};\n\nlet isSetup = false;\nexport default function setupTauriListeners() {\n  if (isSetup) return;\n  isSetup = true;\n\n  // Disable default tauri context menu in production build\n  if (!DEBUG) {\n    document.addEventListener('contextmenu', (event) => {\n      event.preventDefault();\n    });\n  }\n\n  const eventPromise = import('@tauri-apps/api/event');\n  eventPromise.then(({ listen }) => {\n    listen<DownloadFinishedEvent>('download-finished', (event) => {\n      if (event.payload.success) return;\n\n      getActions().showNotification({\n        message: { key: 'NativeDownloadFailed' },\n      });\n    });\n  });\n\n  // Disable Backspace handling as back navigation\n  document.addEventListener('keydown', (event: KeyboardEvent) => {\n    if (event.key === 'Backspace' || event.code === 'Backspace') {\n      const target = event.target as HTMLElement | null;\n      const isInputField = target?.tagName === 'INPUT'\n        || target?.tagName === 'TEXTAREA'\n        || target?.isContentEditable;\n\n      if (!isInputField) {\n        event.preventDefault();\n      }\n    }\n  }, true);\n\n  window.open = (url: string | URL | undefined, target?: string, features?: string) => {\n    if (url) openLink(url);\n    // eslint-disable-next-line no-null/no-null\n    return null;\n  };\n\n  function handleClick(event: MouseEvent) {\n    const target = event.target as HTMLElement | null;\n    const anchor = target?.closest<HTMLAnchorElement>('a[href]');\n\n    if (!anchor) return;\n\n    if (anchor.target === '_blank'\n      || event.ctrlKey\n      || event.metaKey\n      || event.button === MouseButton.Auxiliary\n    ) {\n      event.preventDefault();\n\n      const href = anchor.getAttribute('href')!;\n      openLink(href);\n    }\n  }\n\n  document.addEventListener('click', handleClick);\n  document.addEventListener('auxclick', handleClick);\n}\n\nasync function openLink(url: string | URL) {\n  try {\n    const urlObject = url instanceof URL ? url : new URL(url, window.location.href);\n    if (window.location.origin === urlObject.origin) {\n      await window.tauri.openNewWindow(urlObject.toString());\n    } else {\n      const shellPlugin = await import('@tauri-apps/plugin-shell');\n      await shellPlugin.open(urlObject.toString());\n    }\n  } catch (e) {\n    // eslint-disable-next-line no-console\n    console.error('Failed to open link:', url, e);\n  }\n}\n","import type { FC } from '../../lib/teact/teact';\n\nimport { Bundles } from '../../util/moduleLoader';\n\nimport useModuleLoader from '../../hooks/useModuleLoader';\n\nimport Loading from '../ui/Loading';\n\nconst AuthCodeAsync: FC = () => {\n  const AuthCode = useModuleLoader(Bundles.Auth, 'AuthCode');\n\n  return AuthCode ? <AuthCode /> : <Loading />;\n};\n\nexport default AuthCodeAsync;\n","import type { FC } from '../../lib/teact/teact';\n\nimport { Bundles } from '../../util/moduleLoader';\n\nimport useModuleLoader from '../../hooks/useModuleLoader';\n\nimport Loading from '../ui/Loading';\n\nconst AuthPasswordAsync: FC = () => {\n  const AuthPassword = useModuleLoader(Bundles.Auth, 'AuthPassword');\n\n  return AuthPassword ? <AuthPassword /> : <Loading />;\n};\n\nexport default AuthPasswordAsync;\n","const SITE_FONTS = ['400 1em Roboto', '500 1em Roboto', '500 1em \\'Numbers Rounded\\''];\n\nexport default function preloadFonts() {\n  if ('fonts' in document) {\n    return Promise.all(SITE_FONTS.map((font) => document.fonts.load(font)));\n  }\n\n  return undefined;\n}\n","import { getAccountSlotUrl } from '../../../util/multiaccount';\n\nexport function navigateBack() {\n  const currentUrl = new URL(window.location.href);\n  const referrer = document.referrer ? new URL(document.referrer) : undefined;\n  if (referrer?.origin === currentUrl.origin && referrer.pathname === currentUrl.pathname\n    && referrer.searchParams.get('account') !== currentUrl.searchParams.get('account')) {\n    window.location.assign(referrer); // Return to previous account with it's state\n    return;\n  }\n\n  const url = getAccountSlotUrl(1);\n  window.location.href = url;\n}\n","import type { LangCode } from '../../../types';\n\nexport function getSuggestedLanguage() {\n  let suggestedLanguage = navigator.language.toLowerCase();\n\n  if (suggestedLanguage && suggestedLanguage !== 'pt-br') {\n    suggestedLanguage = suggestedLanguage.substr(0, 2);\n  }\n\n  return suggestedLanguage as LangCode;\n}\n","import { useEffect, useState } from '../lib/teact/teact';\n\nimport type { RegularLangKey } from '../types/language';\n\nimport { LANG_PACK } from '../config';\nimport { callApi } from '../api/gramjs';\nimport useLastCallback from './useLastCallback';\n\nexport default function useLangString(key: RegularLangKey, langCode?: string) {\n  const [value, setValue] = useState<string | undefined>(undefined);\n\n  const fetchLangString = useLastCallback(async () => {\n    if (!langCode) return undefined;\n\n    const result = await callApi('fetchLangStrings', {\n      langCode,\n      langPack: LANG_PACK,\n      keys: [key],\n    });\n    const langString = result?.strings[key];\n    if (!langString || typeof langString !== 'string') return undefined;\n    return langString;\n  });\n\n  useEffect(() => {\n    fetchLangString().then(setValue);\n  }, [key, langCode]);\n\n  return value;\n}\n","import type { FC } from '../../lib/teact/teact';\nimport type React from '../../lib/teact/teact';\nimport {\n  memo, useCallback, useRef, useState,\n} from '../../lib/teact/teact';\nimport { withGlobal } from '../../global';\n\nimport type { ApiCountryCode } from '../../api/types';\n\nimport { ANIMATION_END_DELAY } from '../../config';\nimport { IS_TAURI } from '../../util/browser/globalEnvironment';\nimport { IS_EMOJI_SUPPORTED } from '../../util/browser/windowEnvironment';\nimport buildClassName from '../../util/buildClassName';\nimport { isoToEmoji } from '../../util/emoji/emoji';\nimport { prepareSearchWordsForNeedle } from '../../util/searchWords';\nimport renderText from '../common/helpers/renderText';\n\nimport useLang from '../../hooks/useLang';\nimport useSyncEffect from '../../hooks/useSyncEffect';\n\nimport DropdownMenu from '../ui/DropdownMenu';\nimport MenuItem from '../ui/MenuItem';\nimport Spinner from '../ui/Spinner';\n\nimport './CountryCodeInput.scss';\n\ntype StateProps = {\n  phoneCodeList: ApiCountryCode[];\n};\n\ntype OwnProps = {\n  id: string;\n  value?: ApiCountryCode;\n  isLoading?: boolean;\n  onChange: (value: ApiCountryCode) => void;\n};\n\nconst MENU_HIDING_DURATION = 200 + ANIMATION_END_DELAY;\nconst SELECT_TIMEOUT = 50;\n\nconst CountryCodeInput: FC<OwnProps & StateProps> = ({\n  id,\n  value,\n  isLoading,\n  onChange,\n  phoneCodeList,\n}) => {\n  const lang = useLang();\n  const inputRef = useRef<HTMLInputElement>();\n\n  const [filter, setFilter] = useState<string | undefined>();\n  const [filteredList, setFilteredList] = useState<ApiCountryCode[]>([]);\n\n  const updateFilter = useCallback((filterValue?: string) => {\n    setFilter(filterValue);\n    setFilteredList(getFilteredList(phoneCodeList, filterValue));\n  }, [phoneCodeList]);\n\n  useSyncEffect(([prevPhoneCodeList]) => {\n    if (!prevPhoneCodeList?.length && phoneCodeList.length) {\n      setFilteredList(getFilteredList(phoneCodeList, filter));\n    }\n  }, [phoneCodeList, filter]);\n\n  const handleChange = useCallback((country: ApiCountryCode) => {\n    onChange(country);\n\n    setTimeout(() => updateFilter(undefined), MENU_HIDING_DURATION);\n  }, [onChange, updateFilter]);\n\n  const handleInput = useCallback((e: React.FormEvent<HTMLInputElement>) => {\n    updateFilter(e.currentTarget.value);\n  }, [updateFilter]);\n\n  const handleInputKeyDown = useCallback((e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (e.keyCode !== 8) {\n      return;\n    }\n\n    const target = e.currentTarget;\n    if (value && filter === undefined) {\n      target.value = '';\n    }\n\n    updateFilter(target.value);\n  }, [filter, updateFilter, value]);\n\n  const CodeInput: FC<{ onTrigger: () => void; isOpen?: boolean }> = useCallback(({ onTrigger, isOpen }) => {\n    const handleTrigger = () => {\n      if (isOpen) {\n        return;\n      }\n\n      setTimeout(() => {\n        inputRef.current!.select();\n      }, SELECT_TIMEOUT);\n\n      onTrigger();\n\n      const formEl = document.getElementById('auth-phone-number-form')!;\n      formEl.scrollTo({ top: formEl.scrollHeight, behavior: 'smooth' });\n    };\n\n    const handleCodeInput = (e: React.FormEvent<HTMLInputElement>) => {\n      handleInput(e);\n      handleTrigger();\n    };\n\n    const emoji = value && IS_EMOJI_SUPPORTED && isoToEmoji(value.iso2);\n    const name = value?.name || value?.defaultName || '';\n    const inputValue = filter ?? [emoji, name].filter(Boolean).join(' ');\n\n    return (\n      <div className={buildClassName('input-group', value && 'touched')}>\n        <input\n          ref={inputRef}\n          className={buildClassName('form-control', isOpen && 'focus')}\n          type=\"text\"\n          id={id}\n          value={inputValue}\n          autoComplete=\"off\"\n          spellCheck={IS_TAURI ? false : undefined}\n          onClick={handleTrigger}\n          onFocus={handleTrigger}\n          onInput={handleCodeInput}\n          onKeyDown={handleInputKeyDown}\n        />\n        <label>{lang('LoginSelectCountryTitle')}</label>\n        {isLoading ? (\n          <Spinner color=\"black\" />\n        ) : (\n          <i onClick={handleTrigger} className={buildClassName('css-icon-down', isOpen && 'open')} />\n        )}\n      </div>\n    );\n  }, [filter, handleInput, handleInputKeyDown, id, isLoading, lang, value]);\n\n  return (\n    <DropdownMenu\n      className=\"CountryCodeInput\"\n      trigger={CodeInput}\n    >\n      {filteredList\n        .map((country: ApiCountryCode) => (\n          <MenuItem\n            key={`${country.iso2}-${country.countryCode}`}\n            className={value && country.iso2 === value.iso2 ? 'selected' : ''}\n\n            onClick={() => handleChange(country)}\n          >\n            <span className=\"country-flag\">{renderText(isoToEmoji(country.iso2), ['hq_emoji'])}</span>\n            <span className=\"country-name\">{country.name || country.defaultName}</span>\n            <span className=\"country-code\">\n              +\n              {country.countryCode}\n            </span>\n          </MenuItem>\n        ))}\n      {!filteredList.length && (\n        <MenuItem\n          key=\"no-results\"\n          className=\"no-results\"\n          disabled\n        >\n          <span>{lang('CountryNone')}</span>\n        </MenuItem>\n      )}\n    </DropdownMenu>\n  );\n};\n\nfunction getFilteredList(countryList: ApiCountryCode[], filter = ''): ApiCountryCode[] {\n  if (!filter.length) {\n    return countryList;\n  }\n\n  const searchWords = prepareSearchWordsForNeedle(filter);\n\n  return countryList.filter((country) => (\n    searchWords(country.defaultName) || (country.name && searchWords(country.name))\n  ));\n}\n\nexport default memo(withGlobal<OwnProps>(\n  (global): Complete<StateProps> => {\n    const { countryList: { phoneCodes: phoneCodeList } } = global;\n    return {\n      phoneCodeList,\n    };\n  },\n)(CountryCodeInput));\n","import type { ChangeEvent } from 'react';\nimport type { FC } from '../../lib/teact/teact';\nimport type React from '../../lib/teact/teact';\nimport {\n  memo, useEffect, useLayoutEffect, useMemo, useRef, useState,\n} from '../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../global';\n\nimport type { ApiCountryCode } from '../../api/types';\nimport type { GlobalState } from '../../global/types';\n\nimport { requestMeasure } from '../../lib/fasterdom/fasterdom';\nimport { IS_SAFARI, IS_TOUCH_ENV } from '../../util/browser/windowEnvironment';\nimport { preloadImage } from '../../util/files';\nimport preloadFonts from '../../util/fonts';\nimport { pick } from '../../util/iteratees';\nimport { getAccountSlotUrl } from '../../util/multiaccount';\nimport { oldSetLanguage } from '../../util/oldLangProvider';\nimport { formatPhoneNumber, getCountryCodeByIso, getCountryFromPhoneNumber } from '../../util/phoneNumber';\nimport { navigateBack } from './helpers/backNavigation';\nimport { getSuggestedLanguage } from './helpers/getSuggestedLanguage';\n\nimport useFlag from '../../hooks/useFlag';\nimport useLang from '../../hooks/useLang';\nimport useLangString from '../../hooks/useLangString';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useMultiaccountInfo from '../../hooks/useMultiaccountInfo';\n\nimport Icon from '../common/icons/Icon';\nimport Button from '../ui/Button';\nimport Checkbox from '../ui/Checkbox';\nimport InputText from '../ui/InputText';\nimport Loading from '../ui/Loading';\nimport CountryCodeInput from './CountryCodeInput';\n\nimport monkeyPath from '../../assets/monkey.svg';\n\ntype StateProps = Pick<GlobalState, (\n  'connectionState' | 'authState' |\n  'authPhoneNumber' | 'authIsLoading' |\n  'authIsLoadingQrCode' | 'authErrorKey' |\n  'authRememberMe' | 'authNearestCountry'\n)> & {\n  language?: string;\n  phoneCodeList: ApiCountryCode[];\n  isTestServer?: boolean;\n};\n\nconst MIN_NUMBER_LENGTH = 7;\n\nlet isPreloadInitiated = false;\n\nconst AuthPhoneNumber: FC<StateProps> = ({\n  connectionState,\n  authState,\n  authPhoneNumber,\n  authIsLoading,\n  authIsLoadingQrCode,\n  authErrorKey,\n  authRememberMe,\n  authNearestCountry,\n  phoneCodeList,\n  language,\n  isTestServer,\n}) => {\n  const {\n    setAuthPhoneNumber,\n    setAuthRememberMe,\n    loadNearestCountry,\n    loadCountryList,\n    clearAuthErrorKey,\n    goToAuthQrCode,\n    setSharedSettingOption,\n  } = getActions();\n\n  const lang = useLang();\n  const inputRef = useRef<HTMLInputElement>();\n  const suggestedLanguage = getSuggestedLanguage();\n\n  const isConnected = connectionState === 'connectionStateReady';\n  const continueText = useLangString('AuthContinueOnThisLanguage', suggestedLanguage);\n  const [country, setCountry] = useState<ApiCountryCode | undefined>();\n  const [phoneNumber, setPhoneNumber] = useState<string | undefined>();\n  const [isTouched, setIsTouched] = useState(false);\n  const [lastSelection, setLastSelection] = useState<[number, number] | undefined>();\n  const [isLoading, markIsLoading, unmarkIsLoading] = useFlag();\n\n  const accountsInfo = useMultiaccountInfo();\n  const hasActiveAccount = Object.values(accountsInfo).length > 0;\n  const phoneNumberSlots = useMemo(() => (\n    Object.entries(accountsInfo)\n      .filter(([, info]) => info.isTest === isTestServer)\n      .reduce((acc, [key, { phone }]) => {\n        if (phone) acc[phone] = Number(key);\n        return acc;\n      }, {} as Record<string, number>)\n  ), [accountsInfo, isTestServer]);\n\n  const fullNumber = country ? `+${country.countryCode} ${phoneNumber || ''}` : phoneNumber;\n  const canSubmit = fullNumber && fullNumber.replace(/[^\\d]+/g, '').length >= MIN_NUMBER_LENGTH;\n\n  useEffect(() => {\n    if (!IS_TOUCH_ENV) {\n      inputRef.current!.focus();\n    }\n  }, [country]);\n\n  useEffect(() => {\n    if (isConnected && !authNearestCountry) {\n      loadNearestCountry();\n    }\n  }, [isConnected, authNearestCountry]);\n\n  useEffect(() => {\n    if (isConnected) {\n      loadCountryList({ langCode: language });\n    }\n  }, [isConnected, language]);\n\n  useEffect(() => {\n    if (authNearestCountry && phoneCodeList && !country && !isTouched) {\n      setCountry(getCountryCodeByIso(phoneCodeList, authNearestCountry));\n    }\n  }, [country, authNearestCountry, isTouched, phoneCodeList]);\n\n  const parseFullNumber = useLastCallback((newFullNumber: string) => {\n    if (!newFullNumber.length) {\n      setPhoneNumber('');\n    }\n\n    const suggestedCountry = phoneCodeList && getCountryFromPhoneNumber(phoneCodeList, newFullNumber);\n\n    // Any phone numbers should be allowed, in some cases ignoring formatting\n    const selectedCountry = !country\n      || (suggestedCountry && suggestedCountry.iso2 !== country.iso2)\n      || (!suggestedCountry && newFullNumber.length)\n      ? suggestedCountry\n      : country;\n\n    if (!country || !selectedCountry || (selectedCountry && selectedCountry.iso2 !== country.iso2)) {\n      setCountry(selectedCountry);\n    }\n    setPhoneNumber(formatPhoneNumber(newFullNumber, selectedCountry));\n  });\n\n  const handleLangChange = useLastCallback(() => {\n    markIsLoading();\n\n    void oldSetLanguage(suggestedLanguage, () => {\n      unmarkIsLoading();\n\n      setSharedSettingOption({ language: suggestedLanguage });\n    });\n  });\n\n  useEffect(() => {\n    if (phoneNumber === undefined && authPhoneNumber) {\n      parseFullNumber(authPhoneNumber);\n    }\n  }, [authPhoneNumber, phoneNumber, parseFullNumber]);\n\n  useLayoutEffect(() => {\n    if (inputRef.current && lastSelection) {\n      inputRef.current.setSelectionRange(...lastSelection);\n    }\n  }, [lastSelection]);\n\n  const isJustPastedRef = useRef(false);\n  const handlePaste = useLastCallback(() => {\n    isJustPastedRef.current = true;\n    requestMeasure(() => {\n      isJustPastedRef.current = false;\n    });\n  });\n\n  const handleBackNavigation = useLastCallback(() => {\n    navigateBack();\n  });\n\n  const handleCountryChange = useLastCallback((value: ApiCountryCode) => {\n    setCountry(value);\n    setPhoneNumber('');\n  });\n\n  const handlePhoneNumberChange = useLastCallback((e: ChangeEvent<HTMLInputElement>) => {\n    if (authErrorKey) {\n      clearAuthErrorKey();\n    }\n\n    // This is for further screens. We delay it until user input to speed up the initial loading.\n    if (!isPreloadInitiated) {\n      isPreloadInitiated = true;\n      preloadFonts();\n      void preloadImage(monkeyPath);\n    }\n\n    const { value, selectionStart, selectionEnd } = e.target;\n    setLastSelection(\n      selectionStart && selectionEnd && selectionEnd < value.length\n        ? [selectionStart, selectionEnd]\n        : undefined,\n    );\n\n    setIsTouched(true);\n\n    const shouldFixSafariAutoComplete = (\n      IS_SAFARI && country && fullNumber !== undefined\n      && value.length - fullNumber.length > 1 && !isJustPastedRef.current\n    );\n    parseFullNumber(shouldFixSafariAutoComplete ? `${country.countryCode} ${value}` : value);\n  });\n\n  const handleKeepSessionChange = useLastCallback((e: ChangeEvent<HTMLInputElement>) => {\n    setAuthRememberMe({ value: e.target.checked });\n  });\n\n  function handleSubmit(event: React.FormEvent<HTMLFormElement>) {\n    event.preventDefault();\n\n    if (authIsLoading) {\n      return;\n    }\n\n    const adaptedPhoneNumber = fullNumber?.replace(/[^\\d]/g, '');\n    if (adaptedPhoneNumber && phoneNumberSlots[adaptedPhoneNumber]) {\n      window.location.replace(getAccountSlotUrl(phoneNumberSlots[adaptedPhoneNumber]));\n      return;\n    }\n\n    if (canSubmit) {\n      setAuthPhoneNumber({ phoneNumber: fullNumber });\n    }\n  }\n\n  const handleGoToAuthQrCode = useLastCallback(() => {\n    goToAuthQrCode();\n  });\n\n  const isAuthReady = authState === 'authorizationStateWaitPhoneNumber';\n\n  return (\n    <div id=\"auth-phone-number-form\" className=\"custom-scroll\">\n      {hasActiveAccount && (\n        <Button size=\"smaller\" round color=\"translucent\" className=\"auth-close\" onClick={handleBackNavigation}>\n          <Icon name=\"close\" />\n        </Button>\n      )}\n      <div className=\"auth-form\">\n        <div id=\"logo\" />\n        <h1>{lang('AuthTitle')}</h1>\n        <p className=\"note\">{lang('StartText')}</p>\n        <form className=\"form\" action=\"\" onSubmit={handleSubmit}>\n          <CountryCodeInput\n            id=\"sign-in-phone-code\"\n            value={country}\n            isLoading={!authNearestCountry && !country}\n            onChange={handleCountryChange}\n          />\n          <InputText\n            ref={inputRef}\n            id=\"sign-in-phone-number\"\n            label={lang('LoginPhonePlaceholder')}\n            value={fullNumber}\n            error={authErrorKey && lang.withRegular(authErrorKey)}\n            inputMode=\"tel\"\n            onChange={handlePhoneNumberChange}\n            onPaste={IS_SAFARI ? handlePaste : undefined}\n          />\n          <Checkbox\n            id=\"sign-in-keep-session\"\n            label={lang('AuthKeepSignedIn')}\n            checked={Boolean(authRememberMe)}\n            onChange={handleKeepSessionChange}\n          />\n          {canSubmit && (\n            isAuthReady ? (\n              <Button\n                className=\"auth-button\"\n                type=\"submit\"\n                ripple\n                isLoading={authIsLoading}\n              >\n                {lang('LoginNext')}\n              </Button>\n            ) : (\n              <Loading />\n            )\n          )}\n          {isAuthReady && (\n            <Button\n              className=\"auth-button\"\n              isText\n              ripple\n              isLoading={authIsLoadingQrCode}\n              onClick={handleGoToAuthQrCode}\n            >\n              {lang('LoginQRLogin')}\n            </Button>\n          )}\n          {suggestedLanguage && suggestedLanguage !== language && continueText && (\n            <Button\n              className=\"auth-button\"\n              isText\n              isLoading={isLoading}\n              onClick={handleLangChange}\n            >\n              {continueText}\n            </Button>\n          )}\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default memo(withGlobal(\n  (global): Complete<StateProps> => {\n    const {\n      sharedState: { settings: { language } },\n      countryList: { phoneCodes: phoneCodeList },\n      config,\n    } = global;\n\n    return {\n      ...pick(global, [\n        'connectionState',\n        'authState',\n        'authPhoneNumber',\n        'authIsLoading',\n        'authIsLoadingQrCode',\n        'authErrorKey',\n        'authRememberMe',\n        'authNearestCountry',\n      ]),\n      language,\n      phoneCodeList,\n      isTestServer: config?.isTestServer,\n    } as Complete<StateProps>;\n  },\n)(AuthPhoneNumber));\n","import {\n  memo, useLayoutEffect, useRef,\n} from '../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../global';\n\nimport type { GlobalState } from '../../global/types';\n\nimport { STRICTERDOM_ENABLED } from '../../config';\nimport { disableStrict, enableStrict } from '../../lib/fasterdom/stricterdom';\nimport { selectSharedSettings } from '../../global/selectors/sharedState';\nimport buildClassName from '../../util/buildClassName';\nimport { oldSetLanguage } from '../../util/oldLangProvider';\nimport { LOCAL_TGS_URLS } from '../common/helpers/animatedAssets';\nimport { navigateBack } from './helpers/backNavigation';\nimport { getSuggestedLanguage } from './helpers/getSuggestedLanguage';\n\nimport useAsync from '../../hooks/useAsync';\nimport useFlag from '../../hooks/useFlag';\nimport useLang from '../../hooks/useLang';\nimport useLangString from '../../hooks/useLangString';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useMediaTransitionDeprecated from '../../hooks/useMediaTransitionDeprecated';\nimport useMultiaccountInfo from '../../hooks/useMultiaccountInfo';\n\nimport AnimatedIcon from '../common/AnimatedIcon';\nimport Icon from '../common/icons/Icon';\nimport Button from '../ui/Button';\nimport Loading from '../ui/Loading';\n\nimport blankUrl from '../../assets/blank.png';\n\ntype StateProps =\n  Pick<GlobalState, 'connectionState' | 'authState' | 'authQrCode'>\n  & {\n    language?: string;\n  };\n\nconst DATA_PREFIX = 'tg://login?token=';\nconst QR_SIZE = 280;\nconst QR_PLANE_SIZE = 54;\nconst QR_CODE_MUTATION_DURATION = 50; // The library is asynchronous and we need to wait for its mutation code\n\nlet qrCodeStylingPromise: Promise<typeof import('qr-code-styling')> | undefined;\n\nfunction ensureQrCodeStyling() {\n  if (!qrCodeStylingPromise) {\n    qrCodeStylingPromise = import('qr-code-styling');\n  }\n  return qrCodeStylingPromise;\n}\n\nconst AuthCode = ({\n  connectionState,\n  authState,\n  authQrCode,\n  language,\n}: StateProps) => {\n  const {\n    returnToAuthPhoneNumber,\n    setSharedSettingOption,\n  } = getActions();\n\n  const suggestedLanguage = getSuggestedLanguage();\n  const lang = useLang();\n  const qrCodeRef = useRef<HTMLDivElement>();\n\n  const isConnected = connectionState === 'connectionStateReady';\n  const continueText = useLangString('AuthContinueOnThisLanguage', suggestedLanguage);\n  const [isLoading, markIsLoading, unmarkIsLoading] = useFlag();\n  const [isQrMounted, markQrMounted, unmarkQrMounted] = useFlag();\n\n  const accountsInfo = useMultiaccountInfo();\n  const hasActiveAccount = Object.values(accountsInfo).length > 0;\n\n  const { result: qrCode } = useAsync(async () => {\n    const QrCodeStyling = (await ensureQrCodeStyling()).default;\n    return new QrCodeStyling({\n      width: QR_SIZE,\n      height: QR_SIZE,\n      image: blankUrl,\n      margin: 10,\n      type: 'svg',\n      dotsOptions: {\n        type: 'rounded',\n      },\n      cornersSquareOptions: {\n        type: 'extra-rounded',\n      },\n      imageOptions: {\n        imageSize: 0.4,\n        margin: 8,\n      },\n      qrOptions: {\n        errorCorrectionLevel: 'M',\n      },\n    });\n  }, []);\n\n  const transitionClassNames = useMediaTransitionDeprecated(isQrMounted);\n\n  useLayoutEffect(() => {\n    if (!authQrCode || !qrCode) {\n      return () => {\n        unmarkQrMounted();\n      };\n    }\n\n    if (!isConnected) {\n      return undefined;\n    }\n\n    const container = qrCodeRef.current!;\n    const data = `${DATA_PREFIX}${authQrCode.token}`;\n\n    if (STRICTERDOM_ENABLED) {\n      disableStrict();\n    }\n\n    qrCode.update({\n      data,\n    });\n\n    if (!isQrMounted) {\n      qrCode.append(container);\n      markQrMounted();\n    }\n\n    if (STRICTERDOM_ENABLED) {\n      setTimeout(() => {\n        enableStrict();\n      }, QR_CODE_MUTATION_DURATION);\n    }\n\n    return undefined;\n  }, [isConnected, authQrCode, isQrMounted, qrCode]);\n\n  const handleBackNavigation = useLastCallback(() => {\n    navigateBack();\n  });\n\n  const handleLangChange = useLastCallback(() => {\n    markIsLoading();\n\n    void oldSetLanguage(suggestedLanguage, () => {\n      unmarkIsLoading();\n\n      setSharedSettingOption({ language: suggestedLanguage });\n    });\n  });\n\n  const handleReturnToAuthPhoneNumber = useLastCallback(() => {\n    returnToAuthPhoneNumber();\n  });\n\n  const isAuthReady = authState === 'authorizationStateWaitQrCode';\n\n  return (\n    <div id=\"auth-qr-form\" className=\"custom-scroll\">\n      {hasActiveAccount && (\n        <Button size=\"smaller\" round color=\"translucent\" className=\"auth-close\" onClick={handleBackNavigation}>\n          <Icon name=\"close\" />\n        </Button>\n      )}\n      <div className=\"auth-form qr\">\n        <div className=\"qr-outer\">\n          <div\n            className={buildClassName('qr-inner', transitionClassNames)}\n            key=\"qr-inner\"\n          >\n            <div\n              key=\"qr-container\"\n              className=\"qr-container\"\n              ref={qrCodeRef}\n              style={`width: ${QR_SIZE}px; height: ${QR_SIZE}px`}\n            />\n            <AnimatedIcon\n              tgsUrl={LOCAL_TGS_URLS.QrPlane}\n              size={QR_PLANE_SIZE}\n              className=\"qr-plane\"\n              nonInteractive\n              noLoop={false}\n            />\n          </div>\n          {!isQrMounted && <div className=\"qr-loading\"><Loading /></div>}\n        </div>\n        <h1>{lang('LoginQRTitle')}</h1>\n        <ol>\n          <li><span>{lang('LoginQRHelp1')}</span></li>\n          <li><span>{lang('LoginQRHelp2', undefined, { withNodes: true, withMarkdown: true })}</span></li>\n          <li><span>{lang('LoginQRHelp3')}</span></li>\n        </ol>\n        {isAuthReady && (\n          <Button className=\"auth-button\" isText onClick={handleReturnToAuthPhoneNumber}>\n            {lang('LoginQRCancel')}\n          </Button>\n        )}\n        {suggestedLanguage && suggestedLanguage !== language && continueText && (\n          <Button className=\"auth-button\" isText isLoading={isLoading} onClick={handleLangChange}>\n            {continueText}\n          </Button>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default memo(withGlobal(\n  (global): Complete<StateProps> => {\n    const {\n      connectionState, authState, authQrCode,\n    } = global;\n\n    const { language } = selectSharedSettings(global);\n\n    return {\n      connectionState,\n      authState,\n      authQrCode,\n      language,\n    };\n  },\n)(AuthCode));\n","import type { FC } from '../../lib/teact/teact';\n\nimport { Bundles } from '../../util/moduleLoader';\n\nimport useModuleLoader from '../../hooks/useModuleLoader';\n\nimport Loading from '../ui/Loading';\n\nconst AuthRegisterAsync: FC = () => {\n  const AuthRegister = useModuleLoader(Bundles.Auth, 'AuthRegister');\n\n  return AuthRegister ? <AuthRegister /> : <Loading />;\n};\n\nexport default AuthRegisterAsync;\n","import '../../global/actions/initial';\n\nimport type { FC } from '../../lib/teact/teact';\nimport { memo } from '../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../global';\n\nimport type { GlobalState } from '../../global/types';\n\nimport { IS_TAURI } from '../../util/browser/globalEnvironment';\nimport { IS_MAC_OS, PLATFORM_ENV } from '../../util/browser/windowEnvironment';\n\nimport useCurrentOrPrev from '../../hooks/useCurrentOrPrev';\nimport useHistoryBack from '../../hooks/useHistoryBack';\n\nimport Transition from '../ui/Transition';\nimport AuthCode from './AuthCode.async';\nimport AuthPassword from './AuthPassword.async';\nimport AuthPhoneNumber from './AuthPhoneNumber';\nimport AuthQrCode from './AuthQrCode';\nimport AuthRegister from './AuthRegister.async';\n\nimport './Auth.scss';\n\ntype StateProps = Pick<GlobalState, 'authState'>;\n\nconst Auth: FC<StateProps> = ({\n  authState,\n}) => {\n  const {\n    returnToAuthPhoneNumber, goToAuthQrCode,\n  } = getActions();\n\n  const isMobile = PLATFORM_ENV === 'iOS' || PLATFORM_ENV === 'Android';\n\n  const handleChangeAuthorizationMethod = () => {\n    if (!isMobile) {\n      goToAuthQrCode();\n    } else {\n      returnToAuthPhoneNumber();\n    }\n  };\n\n  useHistoryBack({\n    isActive: (!isMobile && authState === 'authorizationStateWaitPhoneNumber')\n      || (isMobile && authState === 'authorizationStateWaitQrCode'),\n    onBack: handleChangeAuthorizationMethod,\n  });\n\n  // For animation purposes\n  const renderingAuthState = useCurrentOrPrev(\n    authState !== 'authorizationStateReady' ? authState : undefined,\n    true,\n  );\n\n  function getScreen() {\n    switch (renderingAuthState) {\n      case 'authorizationStateWaitCode':\n        return <AuthCode />;\n      case 'authorizationStateWaitPassword':\n        return <AuthPassword />;\n      case 'authorizationStateWaitRegistration':\n        return <AuthRegister />;\n      case 'authorizationStateWaitPhoneNumber':\n        return <AuthPhoneNumber />;\n      case 'authorizationStateWaitQrCode':\n        return <AuthQrCode />;\n      default:\n        return isMobile ? <AuthPhoneNumber /> : <AuthQrCode />;\n    }\n  }\n\n  function getActiveKey() {\n    switch (renderingAuthState) {\n      case 'authorizationStateWaitCode':\n        return 0;\n      case 'authorizationStateWaitPassword':\n        return 1;\n      case 'authorizationStateWaitRegistration':\n        return 2;\n      case 'authorizationStateWaitPhoneNumber':\n        return 3;\n      case 'authorizationStateWaitQrCode':\n        return 4;\n      default:\n        return isMobile ? 3 : 4;\n    }\n  }\n\n  return (\n    <Transition\n      activeKey={getActiveKey()}\n      name=\"fade\"\n      className=\"Auth\"\n      data-tauri-drag-region={IS_TAURI && IS_MAC_OS ? true : undefined}\n    >\n      {getScreen()}\n    </Transition>\n  );\n};\n\nexport default memo(withGlobal(\n  (global): Complete<StateProps> => {\n    return {\n      authState: global.authState,\n    };\n  },\n)(Auth));\n","// extracted by mini-css-extract-plugin\nexport default {\"bg\":\"ThfRMqwq\"};","// extracted by mini-css-extract-plugin\nexport default {\"mask\":\"U9MowLv_\",\"main\":\"RcG6eRZw\",\"left\":\"oL7XcRwI\",\"middle\":\"LYe7IaQO\",\"right\":\"wYSGQZXX\",\"blank\":\"kN2M6u9m\"};","import type { FC } from '../../lib/teact/teact';\nimport type React from '../../lib/teact/teact';\nimport { getActions, getGlobal, withGlobal } from '../../global';\n\nimport type { TabState } from '../../global/types';\nimport { ApiMediaFormat } from '../../api/types';\n\nimport { getChatAvatarHash } from '../../global/helpers/chats'; // Direct import for better module splitting\nimport { selectIsRightColumnShown, selectTabState } from '../../global/selectors';\nimport buildClassName from '../../util/buildClassName';\nimport { preloadImage } from '../../util/files';\nimport preloadFonts from '../../util/fonts';\nimport { localizationReadyPromise } from '../../util/localization';\nimport * as mediaLoader from '../../util/mediaLoader';\nimport { Bundles, loadModule } from '../../util/moduleLoader';\nimport { pause } from '../../util/schedulers';\n\nimport useEffectOnce from '../../hooks/useEffectOnce';\nimport useFlag from '../../hooks/useFlag';\nimport useShowTransitionDeprecated from '../../hooks/useShowTransitionDeprecated';\n\n// Workaround for incorrect bundling by Webpack: force including in the main chunk\nimport '../ui/Modal.scss';\nimport './Avatar.scss';\nimport appStyles from '../App.module.scss';\nimport styles from './UiLoader.module.scss';\n\nimport lockPreviewPath from '../../assets/lock.png';\nimport monkeyPath from '../../assets/monkey.svg';\nimport spoilerMaskPath from '../../assets/spoilers/mask.svg';\nimport telegramLogoPath from '../../assets/telegram-logo.svg';\n\nexport type UiLoaderPage =\n  'main'\n  | 'lock'\n  | 'inactive'\n  | 'authCode'\n  | 'authPassword'\n  | 'authPhoneNumber'\n  | 'authQrCode';\n\ntype OwnProps = {\n  page?: UiLoaderPage;\n  children: React.ReactNode;\n  isMobile?: boolean;\n};\n\ntype StateProps = Pick<TabState, 'uiReadyState' | 'shouldSkipHistoryAnimations'> & {\n  isRightColumnShown?: boolean;\n  leftColumnWidth?: number;\n};\n\nconst MAX_PRELOAD_DELAY = 700;\nconst SECOND_STATE_DELAY = 1000;\nconst AVATARS_TO_PRELOAD = 10;\n\nfunction preloadAvatars() {\n  const { listIds, byId } = getGlobal().chats;\n  if (!listIds.active) {\n    return undefined;\n  }\n\n  return Promise.all(listIds.active.slice(0, AVATARS_TO_PRELOAD).map((chatId) => {\n    const chat = byId[chatId];\n    if (!chat) {\n      return undefined;\n    }\n\n    const avatarHash = getChatAvatarHash(chat);\n    if (!avatarHash) {\n      return undefined;\n    }\n\n    return mediaLoader.fetch(avatarHash, ApiMediaFormat.BlobUrl);\n  }));\n}\n\nconst preloadTasks = {\n  main: () => Promise.all([\n    loadModule(Bundles.Main)\n      .then(preloadFonts),\n    preloadAvatars(),\n    preloadImage(spoilerMaskPath),\n    localizationReadyPromise,\n  ]),\n  authPhoneNumber: () => Promise.all([\n    preloadFonts(),\n    preloadImage(telegramLogoPath),\n  ]),\n  authCode: () => preloadImage(monkeyPath),\n  authPassword: () => preloadImage(monkeyPath),\n  authQrCode: preloadFonts,\n  lock: () => Promise.all([\n    preloadFonts(),\n    preloadImage(lockPreviewPath),\n  ]),\n  inactive: () => {\n  },\n};\n\nconst UiLoader: FC<OwnProps & StateProps> = ({\n  page,\n  children,\n  isRightColumnShown,\n  shouldSkipHistoryAnimations,\n  leftColumnWidth,\n}) => {\n  const { setIsUiReady } = getActions();\n\n  const [isReady, markReady] = useFlag();\n  const {\n    shouldRender: shouldRenderMask, transitionClassNames,\n  } = useShowTransitionDeprecated(!isReady, undefined, true);\n\n  useEffectOnce(() => {\n    let timeout: number | undefined;\n\n    const safePreload = async () => {\n      try {\n        await preloadTasks[page!]();\n      } catch (err) {\n        // Do nothing\n      }\n    };\n\n    Promise.race([\n      pause(MAX_PRELOAD_DELAY),\n      page ? safePreload() : Promise.resolve(),\n    ]).then(() => {\n      markReady();\n      setIsUiReady({ uiReadyState: 1 });\n\n      timeout = window.setTimeout(() => {\n        setIsUiReady({ uiReadyState: 2 });\n      }, SECOND_STATE_DELAY);\n    });\n\n    return () => {\n      if (timeout) {\n        clearTimeout(timeout);\n        timeout = undefined;\n      }\n\n      setIsUiReady({ uiReadyState: 0 });\n    };\n  });\n\n  return (\n    <>\n      {children}\n      {shouldRenderMask && !shouldSkipHistoryAnimations && Boolean(page) && (\n        <div className={buildClassName(styles.mask, transitionClassNames)}>\n          {page === 'main' ? (\n            <div className={styles.main}>\n              <div\n                className={styles.left}\n                style={leftColumnWidth ? `width: ${leftColumnWidth}px` : undefined}\n              />\n              <div className={buildClassName(styles.middle, appStyles.bg)} />\n              {isRightColumnShown && <div className={styles.right} />}\n            </div>\n          ) : (page === 'inactive' || page === 'lock') ? (\n            <div className={buildClassName(styles.blank, appStyles.bg)} />\n          ) : (\n            <div className={styles.blank} />\n          )}\n        </div>\n      )}\n    </>\n  );\n};\n\nexport default withGlobal<OwnProps>(\n  (global, { isMobile }): Complete<StateProps> => {\n    const tabState = selectTabState(global);\n\n    return {\n      shouldSkipHistoryAnimations: tabState.shouldSkipHistoryAnimations,\n      uiReadyState: tabState.uiReadyState,\n      isRightColumnShown: selectIsRightColumnShown(global, isMobile),\n      leftColumnWidth: global.leftColumnWidth,\n    };\n  },\n)(UiLoader);\n","import renderText from '../common/helpers/renderText';\n\nimport useHistoryBack from '../../hooks/useHistoryBack';\nimport useLang from '../../hooks/useLang';\nimport useLastCallback from '../../hooks/useLastCallback';\n\nimport Button from '../ui/Button';\n\nimport './AppInactive.scss';\n\nimport appInactivePath from '../../assets/app-inactive.png';\n\ntype OwnProps = {\n  inactiveReason: 'auth' | 'otherClient';\n};\n\nconst AppInactive = ({ inactiveReason }: OwnProps) => {\n  const lang = useLang();\n\n  const handleReload = useLastCallback(() => {\n    window.location.reload();\n  });\n\n  useHistoryBack({\n    isActive: true,\n    onBack: handleReload,\n    shouldResetUrlHash: true,\n  });\n\n  return (\n    <div id=\"AppInactive\">\n      <div className=\"content\">\n        <img src={appInactivePath} alt=\"\" />\n        <h3 className=\"title\">\n          {inactiveReason === 'auth' ? lang('AppInactiveAuthTitle') : lang('AppInactiveOtherClientTitle')}\n        </h3>\n        <div className=\"description\">\n          {renderText(\n            lang(inactiveReason === 'auth' ? 'AppInactiveAuthDescription' : 'AppInactiveOtherClientDescription'),\n            ['br'],\n          )}\n        </div>\n        <div className=\"actions\">\n          <Button isText ripple onClick={handleReload}>\n            {lang('AppInactiveReload')}\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default AppInactive;\n","import type { FC } from '../../lib/teact/teact';\n\nimport type { OwnProps } from './LockScreen';\n\nimport { Bundles } from '../../util/moduleLoader';\n\nimport useModuleLoader from '../../hooks/useModuleLoader';\n\nconst LockScreenAsync: FC<OwnProps> = (props) => {\n  const { isLocked } = props;\n  const LockScreen = useModuleLoader(Bundles.Main, 'LockScreen', !isLocked);\n\n  return LockScreen ? <LockScreen {...props} /> : undefined;\n};\n\nexport default LockScreenAsync;\n","import type { FC } from '../../lib/teact/teact';\n\nimport type { OwnProps } from './Main';\n\nimport { Bundles } from '../../util/moduleLoader';\n\nimport useModuleLoader from '../../hooks/useModuleLoader';\n\nconst MainAsync: FC<OwnProps> = (props) => {\n  const Main = useModuleLoader(Bundles.Main, 'Main');\n\n  return Main ? <Main {...props} /> : undefined;\n};\n\nexport default MainAsync;\n","import type { FC } from '../lib/teact/teact';\nimport { useEffect, useLayoutEffect } from '../lib/teact/teact';\nimport { withGlobal } from '../global';\n\nimport type { GlobalState } from '../global/types';\nimport type { ThemeKey } from '../types';\nimport type { UiLoaderPage } from './common/UiLoader';\n\nimport {\n  DARK_THEME_BG_COLOR, INACTIVE_MARKER, LIGHT_THEME_BG_COLOR, PAGE_TITLE,\n  PAGE_TITLE_TAURI,\n} from '../config';\nimport { selectTabState, selectTheme } from '../global/selectors';\nimport { IS_TAURI } from '../util/browser/globalEnvironment';\nimport { IS_INSTALL_PROMPT_SUPPORTED, PLATFORM_ENV } from '../util/browser/windowEnvironment';\nimport buildClassName from '../util/buildClassName';\nimport { setupBeforeInstallPrompt } from '../util/installPrompt';\nimport { ACCOUNT_SLOT, getAccountsInfo, getAccountSlotUrl } from '../util/multiaccount';\nimport { hasEncryptedSession } from '../util/passcode';\nimport { getInitialLocationHash, parseInitialLocationHash } from '../util/routing';\nimport { checkSessionLocked, hasStoredSession } from '../util/sessions';\nimport { updateSizes } from '../util/windowSize';\n\nimport useTauriDrag from '../hooks/tauri/useTauriDrag';\nimport useAppLayout from '../hooks/useAppLayout';\nimport usePrevious from '../hooks/usePrevious';\n\n// import Test from './test/TestLocale';\nimport Auth from './auth/Auth';\nimport UiLoader from './common/UiLoader';\nimport AppInactive from './main/AppInactive';\nimport LockScreen from './main/LockScreen.async';\nimport Main from './main/Main.async';\nimport Transition from './ui/Transition';\n\nimport styles from './App.module.scss';\n\ntype StateProps = {\n  authState: GlobalState['authState'];\n  isScreenLocked?: boolean;\n  hasPasscode?: boolean;\n  inactiveReason?: 'auth' | 'otherClient';\n  hasWebAuthTokenFailed?: boolean;\n  isTestServer?: boolean;\n  theme: ThemeKey;\n};\n\nenum AppScreens {\n  auth,\n  main,\n  lock,\n  inactive,\n}\n\nconst TRANSITION_RENDER_COUNT = Object.keys(AppScreens).length / 2;\nconst ACTIVE_PAGE_TITLE = IS_TAURI ? PAGE_TITLE_TAURI : PAGE_TITLE;\nconst INACTIVE_PAGE_TITLE = `${ACTIVE_PAGE_TITLE} ${INACTIVE_MARKER}`;\n\nconst App: FC<StateProps> = ({\n  authState,\n  isScreenLocked,\n  hasPasscode,\n  inactiveReason,\n  hasWebAuthTokenFailed,\n  isTestServer,\n  theme,\n}) => {\n  const { isMobile } = useAppLayout();\n  const isMobileOs = PLATFORM_ENV === 'iOS' || PLATFORM_ENV === 'Android';\n\n  useEffect(() => {\n    if (IS_INSTALL_PROMPT_SUPPORTED) {\n      setupBeforeInstallPrompt();\n    }\n  }, []);\n\n  useEffect(() => {\n    const hash = getInitialLocationHash();\n    // If there is no stored session on first slot, navigate to any other slot with stored session\n    if (!hasStoredSession() && !ACCOUNT_SLOT && !hash) {\n      const accounts = getAccountsInfo();\n      Object.keys(accounts)\n        .map(Number)\n        .sort((a, b) => b - a)\n        .forEach((key) => {\n          const slot = Number(key);\n          const account = accounts[slot];\n          if (account) {\n            const url = getAccountSlotUrl(slot);\n            window.location.href = `${url}#${hash || 'login'}`;\n          }\n        });\n    }\n\n    // TODO[Passcode]: Remove when multiacc passcode is implemented\n    const checkMultiaccPasscode = async () => {\n      if (checkSessionLocked() && ACCOUNT_SLOT && await hasEncryptedSession()) {\n        const url = getAccountSlotUrl(1);\n        window.location.href = url;\n      }\n    };\n    checkMultiaccPasscode();\n  }, []);\n\n  // Prevent drop on elements that do not accept it\n  useEffect(() => {\n    const body = document.body;\n    const handleDrag = (e: DragEvent) => {\n      e.preventDefault();\n      if (!e.dataTransfer) return;\n      if (!(e.target as HTMLElement).dataset.dropzone) {\n        e.dataTransfer.dropEffect = 'none';\n      } else {\n        e.dataTransfer.dropEffect = 'copy';\n      }\n    };\n    const handleDrop = (e: DragEvent) => {\n      e.preventDefault();\n    };\n    body.addEventListener('drop', handleDrop);\n    body.addEventListener('dragover', handleDrag);\n    body.addEventListener('dragenter', handleDrag);\n\n    return () => {\n      body.removeEventListener('drop', handleDrop);\n      body.removeEventListener('dragover', handleDrag);\n      body.removeEventListener('dragenter', handleDrag);\n    };\n  }, []);\n\n  // return <Test />;\n\n  let activeKey: AppScreens;\n  let page: UiLoaderPage | undefined;\n\n  if (inactiveReason) {\n    activeKey = AppScreens.inactive;\n  } else if (isScreenLocked) {\n    page = 'lock';\n    activeKey = AppScreens.lock;\n  } else if (authState) {\n    switch (authState) {\n      case 'authorizationStateWaitPhoneNumber':\n        page = 'authPhoneNumber';\n        activeKey = AppScreens.auth;\n        break;\n      case 'authorizationStateWaitCode':\n        page = 'authCode';\n        activeKey = AppScreens.auth;\n        break;\n      case 'authorizationStateWaitPassword':\n        page = 'authPassword';\n        activeKey = AppScreens.auth;\n        break;\n      case 'authorizationStateWaitRegistration':\n        activeKey = AppScreens.auth;\n        break;\n      case 'authorizationStateWaitQrCode':\n        page = 'authQrCode';\n        activeKey = AppScreens.auth;\n        break;\n      case 'authorizationStateClosed':\n      case 'authorizationStateClosing':\n      case 'authorizationStateLoggingOut':\n      case 'authorizationStateReady':\n        page = 'main';\n        activeKey = AppScreens.main;\n        break;\n    }\n  } else if (hasStoredSession()) {\n    page = 'main';\n    activeKey = AppScreens.main;\n  } else if (hasPasscode) {\n    activeKey = AppScreens.lock;\n  } else {\n    page = isMobileOs ? 'authPhoneNumber' : 'authQrCode';\n    activeKey = AppScreens.auth;\n  }\n\n  if (activeKey !== AppScreens.lock\n    && activeKey !== AppScreens.inactive\n    && activeKey !== AppScreens.main\n    && parseInitialLocationHash()?.tgWebAuthToken\n    && !hasWebAuthTokenFailed) {\n    page = 'main';\n    activeKey = AppScreens.main;\n  }\n\n  useEffect(() => {\n    updateSizes();\n  }, []);\n\n  useEffect(() => {\n    if (inactiveReason) {\n      document.title = INACTIVE_PAGE_TITLE;\n    } else {\n      document.title = ACTIVE_PAGE_TITLE;\n    }\n  }, [inactiveReason]);\n\n  const prevActiveKey = usePrevious(activeKey);\n\n  function renderContent() {\n    switch (activeKey) {\n      case AppScreens.auth:\n        return <Auth />;\n      case AppScreens.main:\n        return <Main isMobile={isMobile} />;\n      case AppScreens.lock:\n        return <LockScreen isLocked={isScreenLocked} />;\n      case AppScreens.inactive:\n        return <AppInactive inactiveReason={inactiveReason!} />;\n    }\n  }\n\n  useTauriDrag();\n\n  useLayoutEffect(() => {\n    document.body.classList.add(styles.bg);\n  }, []);\n\n  useLayoutEffect(() => {\n    document.body.style.setProperty(\n      '--theme-background-color',\n      theme === 'dark' ? DARK_THEME_BG_COLOR : LIGHT_THEME_BG_COLOR,\n    );\n  }, [theme]);\n\n  return (\n    <UiLoader page={page} isMobile={isMobile}>\n      <Transition\n        name=\"fade\"\n        activeKey={activeKey}\n        shouldCleanup\n        className={buildClassName(\n          'full-height',\n          (activeKey === AppScreens.auth || prevActiveKey === AppScreens.auth) && 'is-auth',\n        )}\n        renderCount={TRANSITION_RENDER_COUNT}\n      >\n        {renderContent}\n      </Transition>\n      {activeKey === AppScreens.auth && isTestServer && <div className=\"test-server-badge\">Test server</div>}\n    </UiLoader>\n  );\n};\n\nexport default withGlobal(\n  (global): Complete<StateProps> => {\n    return {\n      authState: global.authState,\n      isScreenLocked: global.passcode?.isScreenLocked,\n      hasPasscode: global.passcode?.hasPasscode,\n      inactiveReason: selectTabState(global).inactiveReason,\n      hasWebAuthTokenFailed: global.hasWebAuthTokenFailed || global.hasWebAuthTokenPasswordRequired,\n      theme: selectTheme(global),\n      isTestServer: global.config?.isTestServer,\n    };\n  },\n)(App);\n","import { useCallback, useEffect } from '../../lib/teact/teact';\n\nimport { IS_TAURI } from '../../util/browser/globalEnvironment';\nimport { IS_MAC_OS } from '../../util/browser/windowEnvironment';\n\nconst NO_DRAG_ELEMENTS = 'input, a, button';\n\nconst useTauriDrag = () => {\n  const handleMouseDown = useCallback(async (event: MouseEvent) => {\n    if (!(event.target instanceof HTMLElement)) {\n      return;\n    }\n\n    if (event.target?.closest(NO_DRAG_ELEMENTS)) {\n      return;\n    }\n\n    if (event.target?.closest('[data-tauri-drag-region]')) {\n      const tauriWindow = await window.tauri?.getCurrentWindow();\n      tauriWindow?.startDragging();\n    }\n  }, []);\n\n  useEffect(() => {\n    if (!(IS_TAURI && IS_MAC_OS)) return undefined;\n\n    document.addEventListener('mousedown', handleMouseDown);\n\n    return () => {\n      document.removeEventListener('mousedown', handleMouseDown);\n    };\n  }, [handleMouseDown]);\n};\n\nexport default useTauriDrag;\n","import './util/handleError';\nimport './util/setupServiceWorker';\nimport './global/init';\n\nimport TeactDOM from './lib/teact/teact-dom';\nimport {\n  getActions, getGlobal,\n} from './global';\n\nimport {\n  DEBUG, STRICTERDOM_ENABLED,\n} from './config';\nimport { enableStrict, requestMutation } from './lib/fasterdom/fasterdom';\nimport { selectTabState } from './global/selectors';\nimport { selectSharedSettings } from './global/selectors/sharedState';\nimport { betterView } from './util/betterView';\nimport { IS_TAURI } from './util/browser/globalEnvironment';\nimport listenOtherClients from './util/browser/listenOtherClients';\nimport { requestGlobal, subscribeToMultitabBroadcastChannel } from './util/browser/multitab';\nimport { establishMultitabRole, subscribeToMasterChange } from './util/establishMultitabRole';\nimport { initGlobal } from './util/init';\nimport { initLocalization } from './util/localization';\nimport { MULTITAB_STORAGE_KEY } from './util/multiaccount';\nimport { checkAndAssignPermanentWebVersion } from './util/permanentWebVersion';\nimport { onBeforeUnload } from './util/schedulers';\nimport initTauriApi from './util/tauri/initTauriApi';\nimport setupTauriListeners from './util/tauri/setupTauriListeners';\nimport updateWebmanifest from './util/updateWebmanifest';\n\nimport App from './components/App';\n\nimport './assets/fonts/roboto.css';\nimport './styles/index.scss';\n\nif (STRICTERDOM_ENABLED) {\n  enableStrict();\n}\n\nif (IS_TAURI) {\n  initTauriApi();\n  setupTauriListeners();\n}\n\ninit();\n\nasync function init() {\n  if (DEBUG) {\n    // eslint-disable-next-line no-console\n    console.log('>>> INIT');\n  }\n\n  if (!(window as any).isCompatTestPassed) return;\n\n  checkAndAssignPermanentWebVersion();\n  listenOtherClients();\n\n  subscribeToMultitabBroadcastChannel();\n  await requestGlobal(APP_VERSION);\n  localStorage.setItem(MULTITAB_STORAGE_KEY, '1');\n  onBeforeUnload(() => {\n    const global = getGlobal();\n    if (Object.keys(global.byTabId).length === 1) {\n      localStorage.removeItem(MULTITAB_STORAGE_KEY);\n    }\n  });\n\n  await initGlobal();\n  getActions().init();\n\n  getActions().updateShouldEnableDebugLog();\n  getActions().updateShouldDebugExportedSenders();\n\n  const global = getGlobal();\n\n  initLocalization(selectSharedSettings(global).language, true);\n\n  subscribeToMasterChange((isMasterTab) => {\n    getActions()\n      .switchMultitabRole({ isMasterTab }, { forceSyncOnIOs: true });\n  });\n  const shouldReestablishMasterToSelf = getGlobal().authState !== 'authorizationStateReady';\n  establishMultitabRole(shouldReestablishMasterToSelf);\n\n  if (DEBUG) {\n    // eslint-disable-next-line no-console\n    console.log('>>> START INITIAL RENDER');\n  }\n\n  requestMutation(() => {\n    updateWebmanifest();\n\n    TeactDOM.render(\n      <App />,\n      document.getElementById('root')!,\n    );\n\n    betterView();\n  });\n\n  if (DEBUG) {\n    // eslint-disable-next-line no-console\n    console.log('>>> FINISH INITIAL RENDER');\n  }\n\n  if (DEBUG) {\n    document.addEventListener('dblclick', () => {\n      // eslint-disable-next-line no-console\n      console.warn('TAB STATE', selectTabState(getGlobal()));\n      // eslint-disable-next-line no-console\n      console.warn('GLOBAL STATE', getGlobal());\n    });\n  }\n}\n\nonBeforeUnload(() => {\n  const actions = getActions();\n  actions.leaveGroupCall?.({ isPageUnload: true });\n  actions.hangUp?.({ isPageUnload: true });\n});\n","import { IS_MAC_OS } from '../browser/windowEnvironment';\n\nexport default function initTauriApi() {\n  const corePromise = import('@tauri-apps/api/core');\n  async function markTitleBarOverlay(isOverlay: boolean) {\n    if (!IS_MAC_OS) return;\n    const core = await corePromise;\n    return core.invoke<void>('mark_title_bar_overlay', { isOverlay });\n  }\n\n  async function setNotificationsCount(amount: number, isMuted = false) {\n    const core = await corePromise;\n    return core.invoke<void>('set_notifications_count', { amount, isMuted });\n  }\n\n  async function openNewWindow(url: string) {\n    const core = await corePromise;\n    return core.invoke<boolean>('open_new_window_cmd', { url });\n  }\n\n  async function setWindowTitle(title: string) {\n    const core = await corePromise;\n    return core.invoke<void>('set_window_title', { title });\n  }\n\n  // @ts-expect-error\n  window.tauri ??= {};\n  Object.assign(window.tauri, {\n    markTitleBarOverlay,\n    setNotificationsCount,\n    openNewWindow,\n    relaunch: () => import('@tauri-apps/plugin-process').then(({ relaunch }) => relaunch()),\n    checkUpdate: () => import('@tauri-apps/plugin-updater').then(({ check }) => check()),\n    getCurrentWindow: () => import('@tauri-apps/api/window').then(({ getCurrentWindow }) => getCurrentWindow()),\n    setWindowTitle,\n  });\n}\n","import { getGlobal, setGlobal } from '../../global';\n\nimport { APP_CODE_NAME, INTERCLIENT_BROADCAST_CHANNEL } from '../../config';\nimport { updateTabState } from '../../global/reducers/tabs';\nimport { selectTabState } from '../../global/selectors';\n\nexport default function listenOtherClients() {\n  const channel = new BroadcastChannel(INTERCLIENT_BROADCAST_CHANNEL);\n\n  channel.addEventListener('message', (event) => {\n    if (event.data !== APP_CODE_NAME) {\n      let global = getGlobal();\n      const tabState = selectTabState(global);\n      global = updateTabState(global, {\n        inactiveReason: 'otherClient',\n      }, tabState.id);\n      setGlobal(global);\n    }\n  });\n\n  channel.postMessage(APP_CODE_NAME);\n}\n","// Original idea was found here\n// https://medium.com/@alshakero/how-to-setup-your-web-app-manifest-dynamically-using-javascript-f7fbee899a61\n\nimport { DEBUG } from '../config';\nimport { IS_MAC_OS } from './browser/windowEnvironment';\n\nexport default function updateWebmanifest() {\n  if (!IS_MAC_OS) {\n    return;\n  }\n\n  const manifest = document.getElementById('the-manifest-placeholder');\n  if (!manifest) {\n    return;\n  }\n\n  const url = `site_apple${DEBUG ? '_dev' : ''}.webmanifest`;\n  manifest.setAttribute('href', url);\n}\n"],"names":["leafPrototypes","getProto","inProgress","dataWebpackPrefix","useCurrentOrPrev","current","shouldSkipUndefined","shouldForceCurrent","prev","usePreviousDeprecated","RE_NOT_LETTER","e","searchWords","haystack","needle","needleWords","toLowerCase","split","haystackLower","length","includes","haystackWords","every","needleWord","some","haystackWord","startsWith","prepareSearchWordsForNeedle","useThrottledCallback","fn","deps","msOrSchedulerFn","noFirst","fnMemo","useCallback","useMemo","throttle","throttleWith","selectCurrentViewedStory","global","tabId","getCurrentTabId","storyViewer","peerId","storyId","selectTabState","selectIsStoryViewerOpen","Boolean","selectPeerStories","stories","byPeerId","selectPeerStory","byId","selectPinnedStories","pinnedIds","map","id","filter","s","isInProfile","selectPeerFirstUnreadStoryId","peerStories","lastReadId","orderedIds","lastReadIndex","findIndex","selectPeerFirstStoryId","selectStoryListForViewer","isSingleStory","isSinglePeer","isPrivate","isArchive","currentStoryId","peerIds","storyIdsByPeerId","peer","selectPeer","story","isUnread","storyIds","getPeerStoryIdsForViewer","undefined","orderedPeerIds","active","archived","areStoriesHidden","currentPeerId","push","storySourceProp","slice","indexOf","selectActiveStoriesCollectionId","selectedStoryAlbumId","error","showError","window","addEventListener","handleErrorEvent","DEBUG","isCurrentTabMaster","alert","getErrorMessage","throttleError","err","handleError","console","ErrorEvent","message","preventDefault","reason","DEBUG_ALERT_MSG","stack","useThumbnail","media","isMediaContainer","getGlobal","thumbDataUri","selectMessageMediaThumbDataUri","dataUri","theme","selectTheme","uri","replace","Portal","containerSelector","className","children","elementRef","useRef","document","createElement","useLayoutEffect","container","querySelector","element","classList","add","appendChild","TeactDOM","render","removeChild","SPOILER_CHARS","TRUNCATED_SUMMARY_LENGTH","getMessageSummaryText","lang","statefulContent","noEmoji","truncateLength","isExtended","emoji","getMessageSummaryEmoji","getMessageSummaryDescription","trimText","getMessageTextWithSpoilers","transcription","getMessageTranscription","textWithoutTranscription","getMessageTextWithFallback","text","entities","content","reduce","accText","type","offset","ApiMessageEntityTypes","Spoiler","spoiler","Array","fill","Math","floor","random","join","generateBrailleSpoiler","photo","video","audio","voice","sticker","pollId","paidMedia","todo","groupedId","getMediaContentTypeDescription","getSummaryDescription","truncatedText","mediaContent","contact","invoice","location","game","storyData","giveaway","giveawayResults","poll","summary","hasUsedTruncatedText","boughtExtendedMedia","isBought","extendedMedia","previewExtendedMedia","isPaidMediaAlbum","isPaidMediaSingleVideo","duration","isPaidMediaSinglePhoto","isGif","trim","title","performer","getMessageAudioCaption","fileName","renderTextWithEntities","question","asPreview","description","mediaType","promptInstall","setupBeforeInstallPrompt","async","prompt","userChoice","outcome","getActions","setInstallPrompt","canInstall","getPromptInstall","translateWithYou","key","isYou","variables","options","pluralValue","asText","withMarkdown","renderTextFilters","withNodes","getPinnedMediaValue","getMessageContent","isRound","renderPeerLink","renderText","_jsx","Link","buildClassName","styles","peerLink","strong","onClick","stopPropagation","openChat","withMultilineFix","IS_SAFARI","renderMessageLink","targetMessage","params","noEllipsis","messageLink","focusMessage","chatId","messageId","getCallMessageKey","action","isOutgoing","isMissed","isCancelled","isVideo","WORKER_NAME","WorkerGlobalScope","globalThis","self","name","ACCOUNT_SLOT","Number","URLSearchParams","get","ACCOUNT_QUERY","IS_MULTIACCOUNT_SUPPORTED","url","slot","URL","searchParams","slotNumber","isNaN","getAccountSlot","href","DATA_BROADCAST_CHANNEL_NAME","DATA_BROADCAST_CHANNEL_PREFIX","ESTABLISH_BROADCAST_CHANNEL_NAME","ESTABLISH_BROADCAST_CHANNEL_PREFIX","MULTITAB_STORAGE_KEY","MULTITAB_LOCALSTORAGE_KEY_PREFIX","GLOBAL_STATE_CACHE_KEY","GLOBAL_STATE_CACHE_PREFIX","getAccountsInfo","allSlots","Object","keys","localStorage","SESSION_ACCOUNT_PREFIX","accountInfo","i","info","getAccountInfo","sessionData","loadSlotSession","userId","avatarUri","color","emojiStatusId","firstName","lastName","isPremium","isTest","phone","data","JSON","parse","getItem","dcId","storeAccountData","currentSlotData","updatedSharedData","writeSlotSession","setItem","stringify","getAccountSlotUrl","forLogin","set","String","delete","hash","toString","versionChannel","BroadcastChannel","postMessage","version","APP_VERSION","event","semverCompare","reload","a","b","localeCompare","numeric","sensitivity","caseFirst","DEFAULT_SIZE","memo","props","size","play","noLoop","noTransition","nonInteractive","onLoad","otherProps","isAnimationLoaded","markAnimationLoaded","useFlag","transitionClassNames","useMediaTransitionDeprecated","handleLoad","useLastCallback","playKey","setPlayKey","useState","handleClick","AnimatedSticker","HEALTH_CHECK_TIMEOUT","HEALTH_CHECK_MIN_DELAY","NO_QUEUE_BEFORE_INIT","Set","worker","requestStates","Map","requestStatesByCallback","pendingPayloads","savedLocalDb","chats","users","documents","stickerSets","photos","webDocuments","commonBoxState","channelPtsById","isMasterTab","subscribeToMasterChange","isMasterTabNew","channel","postMessagesOnTickEnd","throttleWithTickEnd","payloads","postMessageOnTickEnd","payload","updateCallback","localApiRequestsQueue","apiRequestsQueue","isInited","initApi","onUpdate","initialArgs","token","initApiOnMasterTab","Promise","resolve","log","Worker","forEach","DEBUG_startAt","performance","now","updates","warn","handleMethodResponse","handleMethodCallback","IGNORE_UNHANDLED_ERRORS","has","Error","navigator","sendBeacon","logDebugMessage","level","args","subscribeToWorker","platform","IS_TAURI","ensureWorkerPing","setTimeout","makeRequest","then","request","callApi","fnName","deferred","catch","reject","callApiLocal","updateLocalDb","prop","value","updateFullLocalDb","initial","assign","setShouldEnableDebugLog","isEnabled","Deferred","promise","generateUniqueId","requestState","withCallback","callback","pop","finally","callApiOnMasterTab","makeRequestToMaster","cancelApiProgress","progressCallback","isCanceled","cancelApiProgressMaster","response","callbackArgs","DEBUG_payload","startedAt","Date","isResolved","race","pause","terminate","SIMPLE_MARKDOWN_REGEX","part","filters","compact","textParts","divEl","result","innerText","innerHTML","escapeHtml","EMOJI_REGEX","lastIndex","replaceEmojis","addLineBreaks","highlight","queryPosition","newParts","substring","addLinks","replaceSimpleMarkdown","markdownPostProcessor","IS_EMOJI_SUPPORTED","parts","fixNonStandardEmoji","emojis","match","emojiResult","code","nativeToUnifiedExtendedWithCache","src","isLoaded","LOADED_EMOJIS","alt","draggable","handleEmojiLoad","index","splittenParts","line","source","trimmedLine","trimLeft","indentLength","fromCharCode","repeat","RE_LINK","RegExp","RE_LINK_TEMPLATE","RE_MENTION_TEMPLATE","allowOnlyTgLinks","links","nextLink","shift","MentionLink","username","endsWith","isDeepLink","SafeLink","postProcessor","postProcess","entityResult","entity","areLinesWrapping","lines","lineHeight","getComputedStyle","lineHeightParsed","parseFloat","clientHeight","onUpdateConnectionState","actions","update","connectionState","tabState","multitabNextAction","clearMultitabNextAction","setGlobal","isSynced","channelStackIds","values","byTabId","flatMap","tab","messageLists","messageList","chat","isChatChannel","isChatSuperGroup","unique","requestChannelDifference","signOut","forceInitApi","addActionHandler","oldSetLanguage","selectSharedSettings","language","onUpdateApiReady","wasAuthReady","authState","authorizationState","authIsLoading","forceWebsync","isLoggingOut","authIsCodeViaApp","isCodeViaApp","authHint","hint","noReset","hasWebAuthTokenPasswordRequired","authIsLoadingQrCode","authQrCode","qrCode","updateTabState","inactiveReason","onUpdateAuthorizationState","authErrorKey","errorKey","onUpdateAuthorizationError","clearWebTokenAuth","hasWebAuthTokenFailed","onUpdateWebAuthTokenFailed","authRememberMe","isEmpty","mainDcId","config","isTestServer","saveSession","onUpdateSession","setServerTimeOffset","serverTimeOffset","onUpdateServerTimeOffset","currentUser","currentUserFullInfo","updateUser","currentUserId","updateUserFullInfo","updateSessionUserId","onUpdateCurrentUser","sync","isFetchingDifference","isFetching","paymentShippingError","getShippingError","addPaymentError","shouldClosePaymentModal","closePaymentModal","showDialog","showNotification","getDeviceToken","subscription","toJSON","endpoint","checkIfPushSupported","IS_SERVICE_WORKER_SUPPORTED","ServiceWorkerRegistration","prototype","Notification","permission","checkIfNotificationsSupported","expirationTime","soundPlayedDelay","soundPlayedIds","notificationSound","Audio","playNotifySound","volume","notificationSoundVolume","selectSettingsKeys","currentVolume","once","setAttribute","playNotifySoundDebounced","debounce","requestPermission","tauriPlugin","isPermissionGranted","unsubscribeFromPush","deleteDeviceToken","deviceToken","unsubscribe","serviceWorkerRegistration","serviceWorker","ready","pushManager","getSubscription","isSubscriptionFailed","checkIfOfflinePushFailed","subscribe","setDeviceToken","updateWebNotificationSettings","hasWebNotifications","hasPushNotifications","subscribedAt","checkIfShouldResubscribe","userVisibleOnly","DOMException","ABORT_ERR","NOT_SUPPORTED_ERR","getAvatar","imageHash","getChatAvatarHash","mediaData","mediaLoader","ApiMediaFormat","BlobUrl","notifyAboutCall","call","user","hasFocus","icon","body","getUserFullName","badge","tag","vibrate","notification","oldTranslate","onclick","close","focus","notifyAboutMessage","isReaction","isChatMuted","getIsChatMuted","selectNotifyDefaults","selectNotifyException","topic","selectTopicFromMessage","topicMutedUntil","notifySettings","mutedUntil","isMuted","getServerTime","shouldIgnoreMute","isMentioned","shouldNotifyAboutMessage","isNotJoined","isListed","selectIsChatWithSelf","IS_TOUCH_ENV","selectCurrentMessageList","checkIfShouldNotify","isChatSilent","getIsChatSilent","isSilent","hasSound","areNotificationsSupported","activeReaction","getMessageRecentReaction","reaction","selectCustomEmoji","customEmoji","documentId","customEmojis","buildCollectionByKey","loadCustomEmoji","sender","selectSender","hasReaction","isScreenLocked","passcode","isSelf","getPrivateChatUserId","getShouldShowMessagePreview","senderName","getMessageSenderName","getTranslationFn","jsxToHtml","MessageSummary","textContent","emoticon","getReactionEmoji","APP_NAME","getChatTitle","getNotificationContent","controller","shouldReplaceHistory","dispatch","onshow","closeMessageNotifications","IS_TEST","notifyClientReady","useSignalEffect","effect","dependencies","isFirstRun","dependency","isSignal","useUnmountCleanup","cleanupEffect","useIntersectionObserver","rootRef","throttleMs","throttleScheduler","debounceMs","shouldSkipFirst","margin","threshold","isDisabled","rootCallback","controllerRef","rootCallbackRef","freezeFlagsRef","onUnfreezeRef","freeze","unfreeze","useHeavyAnimation","useEffect","observer","disconnect","destroy","observe","target","targetCallback","callbacks","entriesAccumulator","observerCallback","observerCallbackSync","entries","from","entry","callbackManager","runCallbacks","clear","IntersectionObserver","root","rootMargin","addCallback","createCallbackManager","removeCallback","hasCallbacks","initController","unobserve","useOnIntersect","targetRef","lastCallback","useIsIntersecting","isIntersecting","setIsIntersecting","arePropsShallowEqual","currentProps","newProps","currentKeys","currentKeysLength","logUnequalProps","msg","debugKey","jsx","fragment","AUTO_END_TIMEOUT","counter","counterBlocking","getIsAnimating","setIsAnimating","createSignal","getIsBlockingAnimating","setIsBlockingAnimating","getIsHeavyAnimating","beginHeavyAnimation","isBlocking","timeout","onEnd","hasEnded","clearTimeout","onFullyIdle","cb","onIdle","requestMeasure","throttleWithFullyIdle","STAR_PATH","GoldStarIcon","randomId","mask1Id","mask2Id","gradient1Id","gradient2Id","gradient3Id","_jsxs","svg","width","height","viewBox","style","maskUnits","x","y","d","mask","x1","y1","x2","y2","gradientUnits","PremiumStarIcon","RegularStarIcon","StarIcon","validSvgRandomId","useUniqueId","clickable","renderIcon","constructor","this","resolved","isUserId","entityId","toChannelId","mtpId","n","CHANNEL_ID_BASE","getCleanPeerId","getPeerIdDividend","abs","NON_BUBBLEABLE_EVENTS","documentEventCounters","delegationRegistryByEventType","delegatedEventTypesByElement","propName","handler","asCapture","eventType","resolveEventType","canUseEventDelegation","handleEvent","resolveDelegationRegistry","existing","newSet","resolveDelegatedEventTypes","addDelegatedListener","removeEventListener","removeDelegatedListener","tagName","realEventType","removeAllDelegatedListeners","eventTypes","realEvent","events","furtherCallsPrevented","Proxy","p","Reflect","parentNode","documentListenersCount","delegatedHandlersCount1","acc","delegationRegistriesCount","delegatedHandlersCount2","delegationRegistry","delegationElementsCount","delegatedEventTypesCount","UNSAFE_MIME_TYPES","UNSAFE_EXTENSIONS","SVG_EXTENSIONS","isIpRevealingMedia","mimeType","extension","useKeyboardListNavigation","isOpen","onSelectWithEnter","itemSelector","noCaptureFocus","focusedIndex","setFocusedIndex","requestMutation","tabIndex","keyCode","focusedElement","activeElement","elementChildren","querySelectorAll","newIndex","item","MIN_USERNAME_LENGTH","MIN_UPDATE_USERNAME_LENGTH","MAX_USERNAME_LENGTH","USERNAME_REGEX","isUsernameValid","isUpdating","minUsernameLength","test","prevGlobal","updatePageTitle","updateShouldDebugExportedSenders","updateShouldEnableDebugLog","oldGlobal","oldSharedSettings","sharedSettings","prevPerformance","peerColors","prevPeerColors","updatePeerColors","general","applyPerformanceSettings","withAnimation","selectCanAnimateInterface","switchTheme","timeFormat","setTimeFormat","messageTextSize","documentElement","setProperty","max","IS_IOS","canDisplayChatInTitle","shouldForceHttpTransport","shouldAllowHttpTransport","updateSharedSettings","shouldDebugExportedSenders","shouldCollectDebugLogs","initDebugConsole","disableDebugConsole","settings","replaceSettings","wasAnimationLevelSetManually","updateThemeSettings","foldersAction","nextFoldersAction","contentKey","LeftColumnContent","ChatList","leftColumn","screen","SettingsScreens","Main","openLeftColumnContent","Settings","settingsScreen","folderId","isOnlyInvites","chatFolder","selectChatFolder","openSettingsScreen","FoldersEditFolderInvites","FoldersEditFolderFromChatList","requestNextFoldersAction","noRequestNextScreen","isChatList","FoldersShare","shareFolderScreen","isFromSettings","openEditChatFolder","useFastClick","button","MouseButton","handleMouseDown","captureEscKeyListener","captureKeyboardListener","onEsc","API_GENERAL_ID_LIMIT","RESALE_GIFTS_LIMIT","DEFAULT_LIMITS","uploadMaxFileparts","stickersFaved","savedGifs","dialogFiltersChats","dialogFilters","dialogFolderPinned","captionLength","channels","channelsPublic","aboutLength","chatlistInvites","chatlistJoined","recommendedChannels","savedDialogsPinned","maxReactions","moreAccounts","MULTIACCOUNT_MAX_SLOTS","DEFAULT_MAX_MESSAGE_LENGTH","DEFAULT_APP_CONFIG","limits","autologinDomains","channelLevelMax","boostsPerSentGift","channelRestrictAdsLevelMin","seenByExpiresAt","seenByMaxChatMembers","defaultEmojiStatusesStickerSetId","emojiSounds","giveawayAddPeersMax","giveawayBoostsPerPremium","giveawayCountriesMax","isGiveawayGiftsPurchaseAvailable","groupTranscribeLevelMin","hiddenMembersMinCount","ignoreRestrictionReasons","canLimitNewMessagesWithoutPremium","readDateExpiresAt","premiumBotUsername","premiumPromoOrder","isPremiumPurchaseBlocked","maxUniqueReactions","starGiftMaxConvertPeriod","starGiftMaxMessageLength","starRefStartPrefixes","isStarsGiftEnabled","paidReactionMaxAmount","starsUsdWithdrawRateX1000","storyChangelogUserId","maxPinnedStoriesCount","starsSuggestedPostAmountMax","starsSuggestedPostAmountMin","starsSuggestedPostAgeMin","starsSuggestedPostFutureMin","starsSuggestedPostFutureMax","starsSuggestedPostCommissionPermille","tonSuggestedPostCommissionPermille","todoItemLengthMax","todoItemsMax","todoTitleLengthMax","tonSuggestedPostAmountMax","tonSuggestedPostAmountMin","tonTopupUrl","storyViewersExpirePeriod","topicsPinnedLimit","bandwidthPremiumDownloadSpeedup","bandwidthPremiumNotifyPeriod","bandwidthPremiumUploadSpeedup","urlAuthDomains","whitelistedDomains","typed","typify","getPromiseActions","execAfterActions","withGlobal","generateUniqueNumberId","formatInteger","formatIntegerCompact","views","number","formatPercent","fractionDigits","isInteger","toFixed","getFirstLetters","withCache","phrase","count","word","toUpperCase","FILE_SIZE_UNITS","formatFileSize","bytes","decimals","ESTABLISH_TIMEOUT","addCallbackTokenDied","runCallbacksTokenDied","collectedTokens","isEstablished","initialEstablishment","masterToken","reestablishToken","isWaitingForMaster","isChannelClosed","handleMessage","currentPasscodeHash","setPasscodeHash","hasGaveUpMaster","shouldGiveUpMaster","getPasscodeHash","tokenDied","prevLength","l","establishMultitabRole","shouldReestablishMasterToSelf","reestablishMasterToSelf","signalTokenDead","signalPasscodeHash","getAllMultitabTokens","subscribeToTokenDied","initialEstablishmentPromise","idRef","vs16RegExp","zeroWidthJoiner","removeVS16s","rawEmoji","DEFAULT_CHAT_LISTS","replaceChatListIds","newIds","listIds","replaceChatListLoadingParameters","nextOffsetId","nextOffsetPeerId","nextOffsetDate","loadingParameters","updateChatLastMessageId","lastMessageId","listType","lastMessageIds","updateChatsLastMessageId","messageIds","addChatListIds","idsUpdate","replaceChats","newById","addUnreadMentions","ids","shouldUpdateCount","prevChatUnreadMentions","unreadMentions","updatedUnreadMentions","sort","updateChat","unreadMentionsCount","removeUnreadMentions","removedCount","chatUpdate","noOmitUnreadReactionCount","withDeepCheck","updateKeys","areDeepEqual","pick","updatedChat","getUpdatedChat","updateChatFullInfo","fullInfoUpdate","currentFullInfo","selectChatFullInfo","updatedFullInfo","fullInfoById","replaceChatFullInfo","fullInfo","updateChats","updatedById","addChats","isUpdated","addedById","existingChat","newChat","membersCountChanged","membersCount","isMin","accessHash","omitProps","usernames","omit","omitUndefined","updateChatListType","ARCHIVED_FOLDER_ID","currentListIds","listTypeKey","currentFolderList","updateChatListSecondaryInfo","totalCountKey","orderedPinnedIds","totalCount","totalChatCount","leaveChat","leftChatId","removeChatFromChatLists","joinInfo","addChatMembers","membersToAdd","currentMembers","members","newMemberIds","m","updatedMembers","currentIds","updatedIds","areSortedArraysEqual","adminMembers","isAdmin","isOwner","adminMembersById","replaceSimilarChannels","similarChannelIds","similarChannelsById","toggleSimilarChannels","similarChannels","isExpanded","addSimilarBots","similarBotsIds","similarBotsById","getOffsetToContainer","offsetTop","offsetLeft","contains","offsetParent","clientTop","clientLeft","top","left","useDebouncedCallback","ms","noLast","convertCurrencyFromBaseUnit","amount","currency","getCurrencyExp","convertTonFromNanos","nanos","TON_CURRENCY_CODE","convertTonToNanos","ton","formatCurrency","totalPrice","price","STARS_CURRENCY_CODE","formatStarsAsIcon","asFont","asFontIcon","iconClassName","formatTonAsIcon","formatCurrencyAsString","convertTonToUsd","usdRate","isInNanos","locale","shouldOmitFractions","Intl","NumberFormat","minimumFractionDigits","maximumFractionDigits","format","DETECT_UP_TO","MAX_LENGTH","parseEmojiOnlyString","textWithoutNewlines","countIfEmojiOnly","iterator","matchAll","currentIndex","WEEKDAYS_FULL","MONTHS_FULL_LOWERCASE","month","MIN_SEARCH_YEAR","MAX_DAY_IN_MONTH","MAX_MONTH_IN_YEAR","MILLISECONDS_IN_DAY","isToday","date","getDayStartAt","getDayStart","datetime","setHours","getTime","toYearMonth","timestamp","getFullYear","getMonth","toIsoString","getDate","formatTime","hours","getHours","marker","padStart","getMinutes","formatPastTimeShort","alwaysShowTime","time","today","weekAgo","setDate","weekday","getDay","noYear","formattedDate","formatDateToString","formatFullDate","formatMonthAndYear","isShort","formatCountdown","secondsLeft","days","getDays","formatMediaDuration","formatCountdownShort","msLeft","ceil","formatLocationLastUpdate","currentTime","lastUpdated","seconds","formatRelativePastTime","lastUpdatedDate","yesterday","formatPastDatetime","pastTime","minutes","formatTimeDuration","showLast","durationRecords","labels","multiplier","t","label","idx","modulus","out","reverse","splice","formatScheduledDateTime","scheduleDateTimestamp","oldLang","formatHumanDate","noWeekdays","isUpperFirst","upperFirst","lowerFirst","limitBefore","limitAhead","formatWeekday","day","weekDay","formatMediaDateTime","maxValue","maxHours","maxMinutes","string","formatVoiceRecordDuration","durationInMs","milliseconds","formatDayToStringWithCache","dayStartAt","monthFormat","noDay","toLocaleString","year","formatDateTimeToString","noSeconds","hour","minute","second","hourCycle","formatDateAtTime","formatShortDuration","hoursPriority","isValidDate","parseDateString","query","matchStringDate","matchEuropeStringDate","matchNumberDate","dateParts","monthIndex","timestampPlusDay","str","formatRegistrationMonth","dateString","DateTimeFormat","ref","useStateRef","updateStickerSearch","resultIds","stickerSearch","updateStickerSets","category","sets","updatedSets","stickerSet","stickers","setsById","regularSetIds","setIds","updateCustomEmojiSets","flat","addedSetIds","added","updateStickerSet","stickerSetId","currentStickerSet","isCustomEmoji","isEmoji","addedSets","installedDate","isArchived","customEmojiById","updateGifSearch","isNew","results","nextOffset","currentResults","gifSearch","newResults","gif","replaceAnimatedEmojis","animatedEmojis","updateStickersForEmoji","remoteStickers","allStickers","selectStickersForEmoji","uniqueIds","forEmoji","updateCustomEmojiForEmoji","localStickers","selectCustomEmojiForEmoji","updateRecentStatusCustomEmojis","statusRecent","rebuildStickersForEmoji","replaceUsers","updateContactList","updatedUsers","userIds","contactUserIds","contactList","contactUserIdsFromUpdate","isContact","userUpdate","updatedUser","getUpdatedUser","updateUsers","addUsers","existingUser","newUser","deleteContact","MEMO_EMPTY_ARRAY","updateUserSearch","searchStatePartial","userSearch","updateUserSearchFetchingStatus","newState","fetchingStatus","updateUserBlockedState","isBlocked","replaceUserStatuses","statusesById","userFullInfo","updateUserCommonChats","commonChats","commonChatsById","addUserStatuses","closeNewContactDialog","newContact","updateMissingInvitedUsers","missingUsers","inviteViaLinkModal","updateBotAppPermissions","botId","permissions","botAppPermissionsById","replacePeerSavedGifts","gifts","keyCounts","gift","getSavedGiftKey","localTag","activeCollectionId","selectActiveGiftsCollectionId","savedGifts","collectionsByPeerId","updatePeerStarGiftCollections","collections","starGiftCollections","updateGlobalSearch","globalSearch","updateGlobalSearchContent","currentContent","updateGlobalSearchResults","newFoundMessages","nextOffsetRate","searchFlood","resultsByType","newFoundMessagesById","getSearchResultKey","foundIdsForType","foundIds","newId","updateGlobalSearchFetchingStatus","messages","publicPosts","prevFoundIds","newFoundIds","concat","foundOrPrevFoundIds","updateManagementProgress","progress","management","updateManagement","byChatId","newSettings","byKey","sharedState","updateSharedState","themes","addNotifyExceptions","notifyExceptionById","replaceNotifyExceptions","addNotifyException","notifyException","updateNotifyDefaults","peerType","notifyDefaults","addBlockedUser","contactId","blocked","removeBlockedUser","updateTwoFaSettings","twoFaSettings","updatePasscodeSettings","clearPasscodeSettings","clearGlobalForLockScreen","withTabState","INITIAL_GLOBAL_STATE","clearSharedStateForLockScreen","INITIAL_TAB_STATE","shouldUseSystemTheme","animationLevel","INITIAL_SHARED_STATE","updatePayment","payment","updateStarsPayment","starPayment","selectStarsPayment","starsPayment","updateShippingOptions","shippingOptions","setRequestInfoId","requestId","setPaymentStep","step","setStripeCardInfo","cardInfo","stripeCredentials","setSmartGlocalCardInfo","smartGlocalCredentials","setConfirmPaymentUrl","confirmPaymentUrl","setReceipt","receipt","clearPayment","clearStarPayment","closeInvoice","isPaymentModalOpen","isExtendedMedia","updateStarsBalance","balance","stars","appendStarsTransactions","transactions","isTon","history","newTypeObject","appendStarsSubscriptions","subscriptions","newObject","list","updateStarsSubscriptionLoading","isLoading","openStarsTransactionModal","transaction","starsTransactionModal","openStarsTransactionFromReceipt","transactionId","totalAmount","updateStatistics","statistics","updateMessageStatistics","currentMessage","currentStory","updateStoryStatistics","updateStatisticsGraph","updateChannelMonetizationStatistics","monetization","updateVerifyMonetizationModal","monetizationVerificationModal","updatePeer","peerUpdate","updatePeerFullInfo","peerFullInfoUpdate","updatePeerPhotosIsLoading","profilePhotos","selectPeerPhotos","replacePeerPhotos","peers","profilePhotosById","updatePeerPhotos","newPhotos","shouldInvalidateCache","currentPhotos","profilePhoto","fallbackPhoto","personalPhoto","unshift","currentPhotoArray","at","uniqueByField","deletePeerPhoto","photoId","isFromActionMessage","isChannel","selectUserFullInfo","chatFullInfo","isAvatar","avatarPhotoId","nextAvatarPhoto","newProfilePhoto","addStories","newStoriesByPeerId","updatedByPeerId","newPeerStories","profileIds","lastUpdatedAt","updateOrderedStoriesPeerIds","addStoriesForPeer","newStories","newPinnedIds","addToArchive","albumId","archiveIds","idsByAlbumId","deletedIds","updatedOrderedIds","updatedArchiveIds","updatedProfileIds","expireDate","updatedIdsByAlbumId","newAlbumStoryIds","existingAlbumData","existingIds","selectUser","appConfig","updatePeerLastUpdatedAt","updatePeerStoriesFullyLoaded","isFullyLoaded","updateLastReadStoryForPeer","hasUnreadStories","updateLastViewedStoryForPeer","lastViewedId","lastViewedByPeerId","updatePeersWithStories","storiesByPeerId","hasStories","maxStoryId","updateStoryViews","viewModal","newViews","updateStoryViewsLoading","removePeerStory","newOrderedIds","newProfileIds","lastStoryId","previousStoryId","newLastReadId","isDeleted","updateStoriesForPeer","updateSentStoryReaction","reactionsCount","reactions","r","chosenOrder","updateReactionCount","newReactionsCount","updatePeerStory","sentReaction","storyUpdate","updatePeerStoryViews","viewsUpdate","updatePeerProfileStory","updatePeerStoriesHidden","areHidden","updatePeerIds","newOrderedPeerIds","compare","peerIdA","peerIdB","peerA","peerB","diffCurrentUser","compareFields","luaA","orderedA","lriA","hasUnreadA","luaB","orderedB","lriB","hasUnreadB","diffUnread","diffPremium","updateStealthMode","stealthMode","updateTopicsStore","topicsInfoById","updateListedTopicIds","topicIds","listedIds","selectTopicsInfo","listedTopicIds","updateTopics","topicsCount","topics","oldTopics","selectTopics","newTopics","topicsById","updateThread","firstMessageId","updateThreadInfo","threadId","updateTopic","topicId","selectChat","selectTopic","updatedTopic","deleteTopic","replacePinnedTopicIds","pinnedTopicIds","orderedPinnedTopicIds","renderId","tgsUrl","playSegment","speed","quality","isLowPriority","forceAlways","forceOnHeavyAnimation","sharedCanvas","sharedCanvasCoords","onMouseEnter","onMouseLeave","onEnded","onLoop","containerRef","viewId","animation","setAnimation","animationRef","isFirstRender","shouldUseColorFilter","colorFilter","useColorFilter","playRef","playSegmentRef","rgbColor","shouldForceOnHeavyAnimation","canInitialize","markCanInitialize","unmarkCanInitialize","useSyncEffect","g","hexToRgb","isUnmountedRef","init","offsetWidth","offsetHeight","newAnimation","getRLottie","coords","setSpeed","ensureRLottie","throttledInit","useSharedIntersectionObserver","setColor","removeView","playAnimation","shouldRestart","isFrozen","playAnimationOnRaf","pauseAnimation","isPlaying","useEffectWithPrevDeps","prevNoLoop","setNoLoop","prevSharedCanvasCoords","setSharedCanvasCoords","changeData","usePriorityPlaybackCheck","useBackgroundMode","buildStyle","isPriorityPlaybackActive","isBackgroundModeActive","Icon","role","ariaLabel","character","Blockquote","canBeCollapsible","isToggleDisabled","isCollapsed","isCollapsible","setIsCollapsed","useCollapsibleLines","canExpand","handleExpand","handleToggle","PRETTY_BY_ALIAS","js","javascript","ts","typescript","python","py","go","rust","func","c","cpp","fortran","f90","f","java","sql","swift","kotlin","ruby","rb","php","perl","bash","sh","markdown","cs","json","yaml","yml","solidity","sol","tl","CodeOverlay","noCopy","onWordWrapToggle","windowSize","useWindowSize","useOldLang","isWordWrap","setIsWordWrap","withWordWrapButton","setWithWordWrapButton","checkWordWrap","isWrap","parentElement","handleCopy","copyTextToClipboard","handleWordWrapClick","contentClass","overlayClass","wrapClass","CodeBlock","setWordWrap","highlighted","useAsync","lib","default","handleWordWrapToggle","wrap","blockClass","PeerColorWrapper","codeLanguage","Pre","revealByContainerId","createClassNameBuilder","containerId","contentRef","isRevealed","revealSpoiler","stopEvent","reveal","HQ_EMOJI_THRESHOLD","emojiSize","shouldRenderAsHtml","isProtected","observeIntersectionForLoading","observeIntersectionForPlaying","withTranslucentThumbs","sharedCanvasRef","sharedCanvasHqRef","cacheBuster","forcePlayback","noCustomEmojiPlayback","isInSelectMode","maxTimestamp","renderMessagePart","deleteLineBreakAfterPre","organizedEntities","organizedEntityIndexes","organizedEntity","organizeEntity","organizedIndexes","organizedIndex","organizeEntities","renderEntity","textPartStart","textPartEnd","isLastEntity","renderResult","nestedEntities","textBefore","textBeforeLength","substr","entityStartIndex","entityEndIndex","entityContent","nestedEntityContent","nestedIndex","nestedEntity","nestedEntityIndex","nestedResult","nestedEntityEndIndex","newEntity","rawEntityText","trimEnd","renderedContent","Bold","Italic","Underline","Code","Strike","MentionName","Url","TextUrl","getLinkUrl","CustomEmoji","buildCustomEmojiHtmlFromEntity","processEntityAsHtml","entityText","renderNestedMessagePart","isSelectable","withSharedAnimation","withTranslucentThumb","noPlay","canCollapse","BotCommand","handleBotCommandClick","dir","Hashtag","handleHashtagClick","Cashtag","handleCodeClick","Email","rel","Mention","Phone","entityType","Timestamp","openMediaFromTimestamp","handleTimecodeClick","QuoteFocus","processEntity","isArray","textAfter","arrayIndex","getTextWithEntitiesAsHtml","formattedText","focusedQuote","insertTextEntity","resultEntities","newEntityStart","newEntityEnd","existingEntity","existingEntityStart","existingEntityEnd","parsedEntity","isChanged","sendBotCommand","command","currentTarget","hashtag","openChatByUsername","onChatChanged","searchHashtag","selectPollFromMessage","webPage","selectWebPageFromMessage","translatedText","inChatList","useLang","extractedText","extractMessageText","hasPoll","getMessagePollId","isAction","isActionMessage","groupStatefulContent","summaryText","trimmedText","_Fragment","ActionMessageText","MessageText","messageOrStory","resolverOrSignal","isAsync","resolver","valueRef","forceUpdate","useForceUpdate","resolverRef","runCurrentResolver","isSync","currentResolver","newValue","cache","WeakMap","fnCache","cacheKey","cached","selectCurrentChat","selectChatMessages","selectChatScheduledMessages","scheduledMessages","selectTabThreadParam","tabThreads","selectThreadParam","selectThread","messageInfo","threadsById","selectListedIds","selectOutlyingListByMessageId","outlyingLists","selectOutlyingLists","find","selectCurrentMessageIds","messageListType","selectViewportIds","selectPinnedIds","selectScheduledIds","selectScrollOffset","selectLastScrollOffset","selectEditingId","selectEditingDraft","selectEditingScheduledId","MAIN_THREAD_ID","selectEditingScheduledDraft","selectDraft","selectNoWebPage","selectThreadInfo","selectFirstMessageId","selectReplyStack","selectThreadMessagesCount","threadInfo","messagesCount","isForum","GENERAL_TOPIC_ID","selectThreadByMessage","selectThreadIdFromMessage","selectIsMessageInCurrentMessageList","currentMessageList","selectIsViewportNewest","viewportIds","isSavedDialog","getIsSavedDialog","selectChatLastMessageId","isLocalMessageId","selectChatMessage","chatMessages","selectScheduledMessage","selectQuickReplyMessage","quickReplies","messagesById","selectEditingMessage","selectFocusedMessageId","focusedChatId","focusedMessage","selectIsMessageFocused","currentThreadId","focusedId","previousLocalId","selectIsMessageUnread","lastReadOutboxMessageId","isMessageLocal","selectOutgoingStatus","isScheduledList","getSendingState","senderId","areProfilesShown","getSendersFromSelectedMessages","selectSenderFromMessage","selectSenderFromHeader","header","fromId","selectForwardedSender","forwardInfo","isChannelPost","fromChatId","hiddenUserName","savedFromPeerId","selectPoll","pollById","selectWebPage","webPageId","webPageById","selectFullWebPageFromMessage","webpageType","selectFullWebPage","MAX_MESSAGES_TO_DELETE_OWNER_TOPIC","selectCanDeleteTopic","isCreator","getHasAdminRight","thread","selectCanDeleteOwnerTopic","selectSavedDialogIdFromMessage","savedPeerId","ANONYMOUS_USER_ID","savedDialogId","replyToMsgId","replyToTopId","isForumTopic","getMessageReplyInfo","isChatBasicGroup","selectCanReplyToMessage","isRestricted","selectIsChatRestricted","isForbidden","isLocal","isServiceNotification","isServiceNotificationMessage","isMessageThread","isCommentsInfo","fromChannelId","getCanPostInChat","messageTopic","isClosed","selectCanForwardMessage","hasTtl","hasMessageTtl","isChatProtected","selectIsChatProtected","isStoryForwardForbidden","noForwards","isForwardingAllowed","selectAllowedMessageActionsSlow","isChatWithSelf","isBasicGroup","isSuperGroup","isBotChat","selectBot","isFailed","isMessageFailed","isOwn","isOwnMessage","isForwarded","isForwardedMessage","isDocumentSticker","isMessageDocumentSticker","isBoostMessage","isMonoforum","canPinMessage","hasPinMessageRight","isPinMessageRightBanned","isUserRightBanned","hasUsernameOrGeo","hasUsername","hasGeo","isMessageEditable","editTimeLimit","Infinity","viaBotId","canReply","canReplyGlobally","canPin","canUnpin","pinnedMessageIds","canNotDeleteBoostMessage","canDelete","canReport","canDeleteForAll","hasMessageEditRight","canEdit","hasSticker","hasFavoriteSticker","selectIsStickerFavorite","canFaveSticker","canUnfaveSticker","canCopy","canCopyLink","canSelect","canDownload","selectMessageDownloadableMedia","canSaveGif","canRevote","closed","quiz","isChosen","canClosePoll","noOptions","ability","selectCanDeleteSelectedMessages","selectedMessageIds","selectedMessages","messageIdList","messageActions","selectCanDeleteMessages","selectCanReportSelectedMessages","selectCanDownloadSelectedMessages","selectActiveDownloads","activeDownloads","selectUploadProgress","fileUploads","byMessageKey","getMessageKey","selectRealLastReadId","lastReadInboxMessageId","unreadCount","min","selectFirstUnreadId","lastReadServiceNotificationId","SERVICE_NOTIFICATIONS_USER_ID","serviceNotifications","findAfterLastReadId","isFromScheduled","found","selectIsForwardModalOpen","isShareMessageModalShown","selectCommonBoxChatId","fromLastMessage","isCommonBoxChat","selectIsInSelectMode","selectIsMessageSelected","selectForwardedMessageIdsByGroupId","fromMessageId","selectMessageIdsByGroupId","selectIsDocumentGroupSelected","selectedIds","groupIds","selectSelectedMessagesCount","selectNewestMessageWithBotKeyboardButtons","findLast","keyboardButtons","shouldHideKeyboardButtons","isKeyboardSelective","replyToMessageId","replyMessage","selectShouldDisplayReplyKeyboard","replyHideMessageId","isHideKeyboardSelective","selectShouldHideReplyKeyboard","selectCanAutoLoadMedia","isPhoto","getMessagePhoto","getWebPagePhoto","getMessageVideo","getWebPageVideo","isFile","getMessageAudio","getMessageVoice","getMessageDocument","canAutoLoadPhotoFromContacts","canAutoLoadPhotoInPrivateChats","canAutoLoadPhotoInGroups","canAutoLoadPhotoInChannels","canAutoLoadVideoFromContacts","canAutoLoadVideoInPrivateChats","canAutoLoadVideoInGroups","canAutoLoadVideoInChannels","canAutoLoadFileFromContacts","canAutoLoadFileInPrivateChats","canAutoLoadFileInGroups","canAutoLoadFileInChannels","canAutoLoadMedia","canAutoLoadMediaFromContacts","canAutoLoadMediaInPrivateChats","canAutoLoadMediaInGroups","canAutoLoadMediaInChannels","isMediaFromContact","isChatGroup","selectLastServiceNotification","maxId","selectIsMessageProtected","getMessagePaidMedia","selectHasProtectedMessage","selectCanForwardMessages","selectHasIpRevealingMedia","getDocumentExtension","selectSponsoredMessage","sponsoredByChatId","expiresAt","round","selectDefaultReaction","defaultReaction","chatReactions","enabledReactions","canSendReaction","selectMaxUserReactions","selectCurrentLimit","selectVisibleUsers","selectShouldSchedule","selectCanScheduleUntilOnline","chatBot","paidMessagesStars","selectPeerPaidMessagesStars","selectUserStatus","wasOnline","selectMessageCustomEmojiSets","selectCustomEmojis","doc","stickerSetInfo","shortName","selectForwardsContainVoiceMessages","forwardMessages","selectChatTranslations","translations","selectMessageTranslations","toLanguageCode","byLangCode","selectRequestedMessageTranslationLanguage","requestedInChat","requestedTranslations","toLanguage","manualMessages","selectReplyCanBeSentToChat","toChatId","replyInfo","fromRealChatId","replyToPeerId","isExpiredMessage","selectForwardsCanBeSentToChat","isSavedMessages","isChatWithBot","selectIsChatWithBot","getAllowedAttachmentOptions","isVoice","isRoundVideo","isAudio","isDocument","isSticker","isPlainText","canSendVoices","canSendRoundVideos","canSendStickers","canSendDocuments","canSendAudios","canSendVideos","canSendPhotos","canSendGifs","canSendPlainText","heckMessageSendingDenied","selectCanTranslateMessage","detectedLanguage","canTranslate","isTranslationEnabled","doNotTranslate","canTranslateLanguage","isTranslatable","isMessageTranslatable","chatRequestedLanguage","selectRequestedChatTranslationLanguage","IS_TRANSLATION_SUPPORTED","selectTopicLink","getMessageLink","selectMessageReplyInfo","additionalReplyInfo","isMainThread","selectReplyMessage","selectActiveRestrictionReasons","restrictionReasons","WEB_APP_PLATFORM","shouldIgnore","SEARCH_ENGINE_REGEX","PERMANENT_VERSION_KEY","CLIENT_VERSION","setPermanentWebVersion","switchPermanentWebVersion","clearWebsync","skipLockOnUnload","WEB_VERSION_BASE","checkAndAssignPermanentWebVersion","hostname","PRODUCTION_HOSTNAME","referrer","host","currentVersion","getPermanentWebVersion","hasTest","search","shouldRedirect","AVATAR_SIZE","REM","Checkbox","labelText","subLabel","checked","disabled","withIcon","blocking","permissionGroup","rightIcon","onlyInput","nestedCheckbox","nestedCheckboxCount","nestedOptionList","leftElement","onChange","onCheck","onClickLabel","labelRef","showNested","setShowNested","renderingUser","handleChange","toggleNested","labelClassName","isRtl","Avatar","Button","Spinner","nestedOption","currentInstance","animateSingle","tick","schedulerFn","instance","cancelSingleAnimation","dumbCb","animate","animateInstantly","timingFunctions","linear","easeIn","easeOut","easeInOut","sin","PI","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","animateNumber","timing","to","t0","t1","applyStyles","css","selectUserCommonChats","selectIsUserBlocked","selectIsCurrentUserPremium","selectIsCurrentUserFrozen","freezeUntilDate","selectIsPremiumPurchaseBlocked","selectIsGiveawayGiftsPurchaseAvailable","selectUserByPhoneNumber","phoneNumber","phoneNumberCleaned","isUserBot","selectBotAppPermissions","Fragment","Teact","create","jsxs","getBotCoverMediaHash","convertToApiChatType","getWebAppKey","webApp","requestUrl","appName","isSystemBot","REPLIES_USER_ID","VERIFICATION_CODES_USER_ID","INITIAL_PERFORMANCE_STATE_MAX","animatedEmoji","autoplayGifs","autoplayVideos","contextMenuAnimations","contextMenuBlur","loopAnimatedStickers","mediaViewerAnimations","messageComposerAnimations","messageSendingAnimations","pageTransitions","reactionEffects","rightColumnAnimations","stickerEffects","storyRibbonAnimations","snapEffect","INITIAL_PERFORMANCE_STATE_MED","INITIAL_PERFORMANCE_STATE_MIN","IOS_DEFAULT_MESSAGE_TEXT_SIZE_PX","IS_MAC_OS","MACOS_DEFAULT_MESSAGE_TEXT_SIZE_PX","DEFAULT_MESSAGE_TEXT_SIZE_PX","ANIMATION_LEVEL_DEFAULT","messageSendKeyCombo","shouldSkipWebAppCloseConfirmation","wasTimeFormatSetManually","isConnectionStatusMinimized","shouldWarnAboutFiles","isInitial","cacheVersion","attachMenu","bots","isAppUpdateAvailable","shouldShowContextMenuHint","audioPlayer","lastPlaybackRate","DEFAULT_PLAYBACK_RATE","mediaViewer","countryList","phoneCodes","previewMediaByBotId","saved","playbackByChatId","albumsByPeerId","hasNext","hasNextInArchive","groupCalls","attachmentSettings","shouldCompress","defaultAttachmentCompression","shouldSendGrouped","isInvertedMedia","webPageMediaSize","shouldSendInHighQuality","chatFolders","invites","areTagsEnabled","recentEmojis","recentCustomEmojis","defaultTags","topReactions","recentReactions","effectReactions","availableEffectById","recent","favorite","greeting","premium","featured","lastRendered","emojiKeywords","gifs","topPeers","topInlineBots","topBotApps","activeSessions","byHash","orderedHashes","activeWebSessions","autoLoadFileMaxSizeMb","shouldSuggestStickers","shouldSuggestCustomEmoji","shouldPaidMessageAutoApprove","shouldUpdateStickerSetOrder","shouldArchiveAndMuteNewNonContact","shouldNewNonContactPeersRequirePremium","disallowedGifts","nonContactPeersPaidStars","shouldHideReadMarks","canTranslateChats","privacy","botVerificationShownPeerIds","light","isBlurred","patternColor","DEFAULT_PATTERN_COLOR","dark","DARK_THEME_PATTERN_COLOR","accountDaysTtl","trustedBotIds","transcriptions","archiveSettings","isMinimized","isHidden","isLeftColumnShown","newChatMembersProgress","NewChatMembersProgress","Closed","uiReadyState","shouldInit","activeChatFolder","inlineBots","byUsername","webApps","openedWebApps","openedOrderedKeys","sessionKeys","modalState","isModalOpen","isMoreAppsTabActive","middleSearch","byChatThreadKey","sharedMediaSearch","chatMediaSearch","chatInfo","DEFAULT_GIFT_PROFILE_FILTER_OPTIONS","activeCollectionByPeerId","resaleGifts","updateIteration","DEFAULT_RESALE_GIFTS_FILTER_OPTIONS","isRibbonShown","DEFAULT_VOLUME","playbackRate","isWebAppsCloseConfirmationModalOpen","replyingMessage","pollResults","notifications","dialogs","activeReactions","pollModal","isPaymentMessageConfirmDialogOpen","selectPeerFullInfo","selectChatListLoadingParameters","selectChatUser","selectSupportChat","isSupport","selectChatOnlineCount","MEMBERS_LOAD_SLICE","onlineCount","isUserOnline","selectIsTrustedBot","selectChatType","selectIsChatBotNotStarted","lastMessage","selectChatLastMessage","isHistoryClearMessage","selectAreActiveChatsLoaded","selectIsChatListed","targetList","selectChatListType","selectIsChatPinned","ALL_FOLDER_ID","SAVED_FOLDER_ID","chatFoldersById","pinnedChatIds","selectChatByUsername","usernameLowered","selectIsServiceChatReady","selectSendAs","sendAsId","selectRequestedDraft","requestedDraft","files","selectRequestedDraftFiles","filterChatIdsByType","chatIds","selectCanInviteToChat","migratedTo","isChatPublic","isJoinRequest","selectCanShareFolder","folder","groups","contacts","nonContacts","includedChatIds","excludeArchived","excludeMuted","excludeRead","excludedChatIds","selectShouldDetectChatLanguage","hasAutoTranslation","selectCanTranslateChat","isLanguageDetectable","selectSimilarChannelIds","selectSimilarBotsIds","realChatId","selectIsMonoforumAdmin","selectMonoforumChannel","adminRights","linkedMonoforumId","MINUTE","HOUR","DAY","roundDown","getSeconds","performanceType","toggle","AVATAR_SIZES","micro","mini","tiny","small","medium","large","giant","jumbo","cn","webPhoto","previewUrl","withVideo","withStory","forPremiumPromo","withStoryGap","withStorySolid","storyColors","forceFriendStorySolid","forceUnreadStorySolid","storyViewerOrigin","storyViewerMode","loopIndefinitely","noPersonalPhoto","asMessageBubble","onContextMenu","onMouseMove","openStoryViewer","videoLoopCountRef","isCustomPeer","realPeer","isApiPeerUser","isApiPeerChat","isDeletedUser","isReplies","isChatWithRepliesBot","isAnonymousForwards","isAnonymousForwardsChat","isStoryClickable","videoHash","pxSize","shouldLoadVideo","isBig","getVideoProfilePhotoMediaHash","getWebDocumentHash","specialIcon","avatarIcon","imgBlobUrl","useMedia","videoBlobUrl","imgUrl","hasBlobUrl","shouldPlayVideo","mediaRef","useMediaTransition","hasMediaData","handleVideoEnded","display","author","decoding","OptimizedVideo","canPlay","muted","loop","autoPlay","disablePictureInPicture","playsInline","userFullName","titleKey","isRoundedRect","isAvatarSquare","isPremiumGradient","withPremiumGradient","customColor","customPeerAvatarColor","fullClassName","getPeerColorClass","hasMedia","origin","getPeerStoryHtmlId","onMouseDown","AvatarStoryCircle","withExtraGap","colors","SIGNAL_MARK","Symbol","obj","unsubscribesByEffect","currentEffect","defaultValue","state","effects","unsubscribes","unsub","DropdownMenu","trigger","bubbleClassName","transformOriginX","transformOriginY","positionX","positionY","footer","forceOpen","onOpen","onClose","onTransitionEnd","onMouseEnterBackdrop","onHide","autoClose","menuRef","setIsOpen","handleClose","triggerComponent","onTrigger","isMenuOpen","onKeyDown","menu","toggleIsOpen","Menu","onCloseAnimationEnd","BACKDROP_CLASSNAME","useVirtualBackdrop","ignoreRightClick","excludedClosestSelector","hasActiveViewTransition","matches","closest","value1","value2","type1","isArray1","array1","array2","member1","object1","object2","keys1","key1","EMOJI_EXCEPTIONS","regex","replacement","isCharIcon","customIcon","download","destructive","withWrap","clickArg","withPreventDefaultOnMouseDown","isTouchScreen","useAppLayout","handleKeyDown","base","maxint","decode_digit","cp","adapt","delta","numpoints","firsttime","k","decode","input","preserveCase","output","case_flags","input_length","bias","basic","j","ic","oldi","w","digit","len","lastIndexOf","charCodeAt","RangeError","utf16","domain","domain_array","PROTOCOL_WHITELIST","FALLBACK_PREFIX","ensureProtocol","parsedUrl","protocol","getUnicodeUrl","unicodeDomain","convertPunycode","decodeURI","isMixedScriptUrl","hasLatin","hasNonLatin","char","buildChatThreadKey","LUMA_THRESHOLD","scaleImage","image","ratio","outputType","Blob","createObjectURL","img","Image","onload","scale","blob","revokeObjectURL","resizeImage","steppedScale","bitmap","createImageBitmap","resizeWidth","resizeHeight","resizeQuality","averageColor","getAverageColor","fillColor","getColorLuma","res","canvas","ctx2D","getContext","fillStyle","fillRect","ctx","transferFromImageBitmap","drawImage","toBlob","oc","octx","mul","cur","globalCompositeOperation","ANIMATION_END_DELAY","waitForTransitionEnd","node","propertyName","fallbackMs","waitForEndEvent","waitForAnimationEnd","animationName","detailedName","isHandled","cleanup","handleAnimationEnd","TransitionEvent","AnimationEvent","PATH_BASE","pathname","historyUniqueSessionId","historyState","historyCursor","isAlteringHistory","deferredHistoryOperations","deferredPopstateOperations","isSafariGestureAnimation","handleTouchEnd","applyDeferredHistoryOperations","goOperations","op","stateOperations","goCount","processStateOperations","deferHistoryOperation","historyOperation","resetHistory","onBack","back","replaceState","cleanupClosed","alreadyClosedCount","countClosed","cleanupTrashedState","isAnimationDisabled","disableHistoryAnimations","useHistoryBack","isActive","shouldBeReplaced","shouldResetUrlHash","lastOnBack","indexRef","wasReplaced","pushState","forceReplace","shouldReplace","previousRecord","markReplaced","processBack","useEffectOnce","prevIsActive","TEST_getHistoryState","TEST_getHistoryCursor","touches","pageX","innerWidth","previousUniqueSessionId","updateAppBadge","tauri","setNotificationsCount","setAppBadge","getStoryReplyInfo","bio","about","profileEdit","ProfileEditProgress","InProgress","shouldUsernameUpdate","u","isEditable","Complete","loadFullUser","withPhotos","isFallback","Idle","checkedUsername","isUsernameAvailable","loadedWallpapers","wallpapers","file","previewBlobUrl","slug","UPLOADING_WALLPAPER_SLUG","wallpaper","firstWallpaper","withLocalMedia","blockedIds","isOnlyStories","signUpNotification","all","hasContactJoinedNotifications","shouldShowPreviews","MUTE_INDEFINITE_TIMESTAMP","UNMUTE_TIMESTAMP","oldSettings","languages","phoneNumberSettings","addByPhoneSettings","lastSeenSettings","profilePhotoSettings","forwardsSettings","chatInviteSettings","phoneCallSettings","phoneP2PSettings","voiceMessagesSettings","bioSettings","birthdaySettings","giftsSettings","noPaidMessagesSettings","rules","addByPhone","lastSeen","forwards","chatInvite","phoneCall","phoneP2P","voiceMessages","birthday","noPaidMessages","privacyKey","visibility","onSuccess","buildApiInputPrivacyRules","allowedIds","allowUserIds","allowChatIds","blockUserIds","blockChatIds","botsPrivacy","isAllowList","isPremiumAllowed","isUnspecified","shouldAllowPremium","isOnline","isSensitiveEnabled","langCode","authNearestCountry","COUNTRIES_WITH_12H_TIME_FORMAT","setSharedSettingOption","nearestCountryCode","requestActionTimeout","APP_CONFIG_REFETCH_INTERVAL","isAppConfigLoaded","generalHash","profileHash","generalResult","profileResult","currentPeerColors","profile","timezones","globalSettings","shouldDisplayGiftsButton","shouldUpdateUsersSettings","loadFullChat","loadUser","prevUsernames","sortedUsernames","currentUsername","getChatNotifySettings","defaults","getNotificationPeerType","DEFINITION_MAP","defs","addSvgDefinition","htmlElement","createElementNS","SVG_NAMESPACE","appendElement","removeSvgDefinition","remove","usePrevious","prevRef","lastRef","MONTH_EMOTICON","STAR_EMOTICON","TON_EMOTICON","selectCurrentStickerSearch","selectCurrentGifSearch","selectStickerSet","stickersForEmoji","packs","cleanEmoji","isCurrentUserPremium","addedCustomSets","customEmojiForEmoji","isFree","selectCustomEmojiForEmojis","selectIsSetPremium","selectAnimatedEmoji","cleanedEmoji","selectRestrictedEmoji","restrictedEmoji","selectAnimatedEmojiEffect","animatedEmojiEffects","selectAnimatedEmojiSound","selectIsAlwaysHighPriorityEmoji","RESTRICTED_EMOJI_SET_ID","selectGiftStickerForDuration","premiumGifts","selectGiftStickerForStars","starCount","selectGiftStickerForTon","tonGifts","convertedAmount","selectSharedState","selectLanguageCode","selectCanSetPasscode","accounts","selectTranslationLanguage","translationLanguage","selectNewNoncontactPeersRequirePremium","selectNonContactPeersPaidStars","selectShouldHideReadMarks","setTrigger","APP_CODE_NAME","IS_MOCKED_CLIENT","process","IS_BETA","PAID_MESSAGES_PURPOSE","DEBUG_MORE","DEBUG_LOG_FILENAME","STRICTERDOM_ENABLED","FORCE_FALLBACK_LANG","BETA_CHANGELOG_URL","PAGE_TITLE","PAGE_TITLE_TAURI","INACTIVE_MARKER","DEBUG_PAYMENT_SMART_GLOCAL","SESSION_LEGACY_USER_KEY","LEGACY_PASSCODE_CACHE_NAME","GLOBAL_STATE_CACHE_DISABLED","SHARED_STATE_CACHE_KEY","GLOBAL_STATE_CACHE_USER_LIST_LIMIT","GLOBAL_STATE_CACHE_CHAT_LIST_LIMIT","GLOBAL_STATE_CACHE_ARCHIVED_CHAT_LIST_LIMIT","GLOBAL_STATE_CACHE_CUSTOM_EMOJI_LIMIT","IS_SCREEN_LOCKED_CACHE_KEY","MEDIA_CACHE_DISABLED","MEDIA_CACHE_NAME","MEDIA_CACHE_NAME_AVATARS","MEDIA_PROGRESSIVE_CACHE_NAME","CUSTOM_BG_CACHE_NAME","LANG_CACHE_NAME","AUTODOWNLOAD_FILESIZE_MB_LIMITS","INTERCLIENT_BROADCAST_CHANNEL","DC_IDS","isBigScreen","innerHeight","MIN_PASSWORD_LENGTH","MESSAGE_LIST_SLICE","MESSAGE_LIST_VIEWPORT_LIMIT","ARCHIVE_MINIMIZED_HEIGHT","CHAT_HEIGHT_PX","TOPIC_HEIGHT_PX","PEER_PICKER_ITEM_HEIGHT_PX","CHAT_LIST_SLICE","CHAT_LIST_LOAD_SLICE","SHARED_MEDIA_SLICE","CHAT_MEDIA_SLICE","MESSAGE_SEARCH_SLICE","GLOBAL_SEARCH_SLICE","GLOBAL_TOPIC_SEARCH_SLICE","MEMBERS_SLICE","PROFILE_SENSITIVE_AREA","TOPIC_LIST_SENSITIVE_AREA","PUBLIC_POSTS_SEARCH_DEFAULT_STARS_AMOUNT","PUBLIC_POSTS_SEARCH_DEFAULT_TOTAL_DAILY","VERIFY_AGE_MIN_DEFAULT","STORY_VIEWS_MIN_SEARCH","STORY_MIN_REACTIONS_SORT","STORY_VIEWS_MIN_CONTACTS_FILTER","MEDIA_TIMESTAMP_SAVE_MINIMUM_DURATION","GLOBAL_SUGGESTED_CHANNELS_ID","TOPICS_SLICE","TOPICS_SLICE_SECOND_LOAD","TOP_CHAT_MESSAGES_PRELOAD_LIMIT","DEFAULT_CHARGE_FOR_MESSAGES","MINIMUM_CHARGE_FOR_MESSAGES","DEFAULT_MAXIMUM_CHARGE_FOR_MESSAGES","PLAYBACK_RATE_FOR_AUDIO_MIN_DURATION","ANIMATION_LEVEL_CUSTOM","ANIMATION_LEVEL_MIN","ANIMATION_LEVEL_MED","ANIMATION_LEVEL_MAX","PREVIEW_AVATAR_COUNT","DRAFT_DEBOUNCE","SEND_MESSAGE_ACTION_INTERVAL","GENERAL_REFETCH_INTERVAL","EDITABLE_INPUT_ID","EDITABLE_INPUT_MODAL_ID","EDITABLE_STORY_INPUT_ID","EDITABLE_INPUT_CSS_SELECTOR","EDITABLE_INPUT_MODAL_CSS_SELECTOR","EDITABLE_STORY_INPUT_CSS_SELECTOR","CUSTOM_APPENDIX_ATTRIBUTE","MESSAGE_CONTENT_CLASS_NAME","MESSAGE_CONTENT_SELECTOR","VT_CLASS_NAME","VT_TYPE_CLASS_PREFIX","RESIZE_HANDLE_CLASS_NAME","RESIZE_HANDLE_SELECTOR","SNAP_EFFECT_CONTAINER_ID","SNAP_EFFECT_ID","STARS_ICON_PLACEHOLDER","MIN_SCREEN_WIDTH_FOR_STATIC_RIGHT_COLUMN","MIN_SCREEN_WIDTH_FOR_STATIC_LEFT_COLUMN","MOBILE_SCREEN_MAX_WIDTH","MOBILE_SCREEN_LANDSCAPE_MAX_WIDTH","MOBILE_SCREEN_LANDSCAPE_MAX_HEIGHT","MAX_INT_32","TMP_CHAT_ID","ANIMATION_WAVE_MIN_INTERVAL","MESSAGE_APPEARANCE_DELAY","SCROLL_MIN_DURATION","SCROLL_MAX_DURATION","SCROLL_MAX_DISTANCE","SCROLL_SHORT_TRANSITION_MAX_DISTANCE","LOCK_SCREEN_ANIMATION_DURATION_MS","STICKER_SIZE_INLINE_DESKTOP_FACTOR","STICKER_SIZE_INLINE_MOBILE_FACTOR","STICKER_SIZE_AUTH","STICKER_SIZE_AUTH_MOBILE","STICKER_SIZE_PICKER","EMOJI_SIZE_PICKER","COMPOSER_EMOJI_SIZE_PICKER","STICKER_SIZE_GENERAL_SETTINGS","STICKER_SIZE_PICKER_HEADER","STICKER_PICKER_MAX_SHARED_COVERS","STICKER_SIZE_SEARCH","STICKER_SIZE_MODAL","EMOJI_SIZE_MODAL","STICKER_SIZE_TWO_FA","STICKER_SIZE_PASSCODE","STICKER_SIZE_DISCUSSION_GROUPS","STICKER_SIZE_FOLDER_SETTINGS","STICKER_SIZE_INLINE_BOT_RESULT","STICKER_SIZE_JOIN_REQUESTS","STICKER_SIZE_INVITES","EMOJI_STATUS_LOOP_LIMIT","EMOJI_SIZES","TOP_SYMBOL_SET_ID","POPULAR_SYMBOL_SET_ID","RECENT_SYMBOL_SET_ID","COLLECTIBLE_STATUS_SET_ID","FAVORITE_SYMBOL_SET_ID","EFFECT_STICKERS_SET_ID","EFFECT_EMOJIS_SET_ID","CHAT_STICKER_SET_ID","DEFAULT_TOPIC_ICON_STICKER_ID","DEFAULT_STATUS_ICON_ID","EMOJI_IMG_REGEX","BASE_EMOJI_KEYWORD_LANG","MENU_TRANSITION_DURATION","SLIDE_TRANSITION_DURATION","BIRTHDAY_NUMBERS_SET","RESTRICTED_EMOJI_SET","GIF_MIME_TYPE","LOTTIE_STICKER_MIME_TYPE","VIDEO_STICKER_MIME_TYPE","SUPPORTED_PHOTO_CONTENT_TYPES","SUPPORTED_VIDEO_CONTENT_TYPES","SUPPORTED_AUDIO_CONTENT_TYPES","CONTENT_TYPES_WITH_PREVIEW","SUPPORTED_TRANSLATION_LANGUAGES","RE_TG_LINK","RE_TME_LINK","RE_TELEGRAM_LINK","TME_LINK_PREFIX","BOT_FATHER_USERNAME","USERNAME_PURCHASE_ERROR","MESSAGE_ID_REQUIRED_ERROR","PURCHASE_USERNAME","TME_WEB_DOMAINS","LANG_PACK","NSFW_RESTRICTION_REASON","API_CHAT_TYPES","HEART_REACTION","FOLDER_TITLE_MAX_LENGTH","MAX_MEDIA_FILES_FOR_ALBUM","MAX_ACTIVE_PINNED_CHATS","SCHEDULED_WHEN_ONLINE","LANG_PACKS","FEEDBACK_URL","FAQ_URL","PRIVACY_URL","MINI_APP_TOS_URL","FRESH_AUTH_PERIOD","GIVEAWAY_BOOST_PER_PREMIUM","GIVEAWAY_MAX_ADDITIONAL_CHANNELS","GIVEAWAY_MAX_ADDITIONAL_USERS","GIVEAWAY_MAX_ADDITIONAL_COUNTRIES","FRAGMENT_PHONE_CODE","FRAGMENT_PHONE_LENGTH","BOT_VERIFICATION_PEERS_LIMIT","LIGHT_THEME_BG_COLOR","DARK_THEME_BG_COLOR","PEER_COLOR_BG_OPACITY","PEER_COLOR_BG_ACTIVE_OPACITY","PEER_COLOR_GRADIENT_STEP","MAX_UPLOAD_FILEPART_SIZE","GROUP_CALL_VOLUME_MULTIPLIER","GROUP_CALL_DEFAULT_VOLUME","ONE_TIME_MEDIA_TTL_SECONDS","PREMIUM_FEATURE_SECTIONS","PREMIUM_BOTTOM_VIDEOS","PREMIUM_LIMITS_ORDER","sortType","shouldIncludeUnlimited","shouldIncludeLimited","shouldIncludeUnique","shouldIncludeDisplayed","shouldIncludeHidden","shouldIncludeUpgradable","ACCOUNT_TTL_OPTIONS","delay","savedCallback","setInterval","clearInterval","tabStatePartial","timerId","deepMerge","isLiteralObject","oldValue","hasOwnProperty","__delete","reduceDiff","diff","__deleteAllChildren","CLOSE_DURATION","useShowTransition","noMountTransition","noOpenTransition","noCloseTransition","closeDuration","prefix","shouldForceOpen","localRef","closingTimeoutRef","getState","setState","useSignal","optionsRef","onCloseEndLast","useSyncEffectWithPrevDeps","prevIsOpen","applyClassNames","addExtraClass","shouldRender","hasOpenClass","isClosing","toggleExtraClass","withShouldRender","useDerivedState","getIsClosing","useDerivedSignal","startCallbacks","endCallbacks","dispatchPriorityPlaybackEvent","onStart","lastOnStart","lastOnEnd","noUserColors","shouldReset","peerColorId","getPeerColorCount","getPeerColorKey","getApiPeerColorClass","withoutTag","prevDeps","cleanupRef","SVG_MAP","SvgColorFilter","referenceCount","filterId","xmlns","getFilterId","removeReference","isUsed","asValue","prepareStyle","setValue","shouldRunFirst","shouldRunLast","waitingTimeout","interval","isPending","_args","onTickEnd","waiting","rafPromise","fastRaf","FAST_RAF_TIMEOUT_FALLBACK_MS","fastRafCallbacks","fastRafFallbackCallbacks","fastRafFallbackTimeout","onTickEndCallbacks","withTimeoutFallback","requestAnimationFrame","currentCallbacks","currentTimeoutCallbacks","IDLE_TIMEOUT","onIdleCallbacks","beforeUnloadCallbacks","requestIdleCallback","deadline","timeRemaining","onBeforeUnload","isLast","DEBUG_currentRandomId","currentGlobal","DEBUG_invalidateGlobalOnTickEnd","actionHandlers","containers","mapStateToProps","ownProps","mappedProps","activateContainer","newMappedProps","DEBUG_componentName","DEBUG_updates","updateTime","runCallbacksThrottled","setUntypedGlobal","newGlobal","forceOutdated","DEBUG_randomId","forceSyncOnIOs","getUntypedGlobal","getUntypedActions","actionQueue","afterActionQueue","addUntypedActionHandler","handleAction","withUntypedGlobal","activationFn","Component","TeactNContainer","DEBUG_contentComponentName","DEBUG_resolveComponentName","stuckTo","stickTo","orderBy","createListener","matchMedia","devicePixelRatio","useDevicePixelRatio","dpr","setDpr","addLocalizationCallback","THROTTLE","initialWidth","initialHeight","setWidth","setHeight","isResizing","setIsResizing","setIsResizingDebounced","throttledSetIsResizing","throttledSetSize","newWidth","newHeight","handleResize","unloadVideo","removeAttribute","firstChild","load","ICON_POSITIONS","inline","block","opacity","EMOJI_SIZE","EmojiIconBackground","emojiDocumentId","canvasRef","emojiImage","setEmojiImage","useCustomEmoji","previewMediaHash","getStickerMediaHash","useDynamicColorListener","preloadAfterHeavyAnimation","useThrottleForHeavyAnimation","preloadImage","updateCanvas","context","clearRect","save","globalAlpha","translate","restore","tintColor","isLottie","updateCanvasAfterHeavyAnimation","updateCanvasSize","parentWidth","parentHeight","contentRect","useResizeObserver","getBoundingClientRect","InputText","success","readOnly","placeholder","autoComplete","inputMode","maxLength","teactExperimentControlled","onInput","onKeyPress","onBlur","onPaste","spellCheck","htmlFor","CLASSES","ACTIVE_SLIDE_CLASS_NAME","TO_SLIDE_CLASS_NAME","DISABLEABLE_ANIMATIONS","activeKey","nextKey","direction","renderCount","shouldRestoreHeight","shouldCleanup","cleanupExceptionKey","cleanupOnlyKey","shouldWrap","wrapExceptionKey","slideClassName","withSwipeControl","isBlockingAnimation","onStop","onScroll","dataTauriDragRegion","contentSelector","restoreHeightKey","currentKeyRef","shouldDisableAnimation","rendersRef","prevActiveKey","isAnimatingRef","isSwipeJustCancelledRef","hasActiveKeyChanged","prevName","prevIsSliceOptimized","isSlideOptimized","removeExtraClass","isBackwards","prevActiveIndex","activeIndex","childNodes","childElements","el","childElement","setExtraStyles","transition","transform","toSlide","fromSlide","HTMLElement","endHeavyAnimation","requestForcedReflow","forceReflow","performSlideOptimized","onAnimationEnd","watchedNode","giveUpAnimationEnd","allowSwipeControlForTransition","contentElement","clientWidth","flexBasis","asFastList","renders","contents","rendered","teactOrderKey","teactFastList","getIsVideoPlaying","paused","ended","readyState","mediaEl","updateCacheThrottled","updateCache","updateCacheForced","unsubscribeFromBeforeUnload","isCaching","isRemovingCache","cacheGlobal","MAIN_IDB_STORE","cacheSharedState","loadCachedSharedState","removeGlobalFromCache","del","removeSharedStateFromCache","cacheIsScreenLocked","initCache","setupCaching","resetCache","removeItem","clearCaching","loadCache","initialState","cachedFromLocalStorage","timeEnd","migrateCache","readCache","hasPasscode","hasStoredSession","untypedCached","darkPeerColors","miniAppsCachedPosition","miniAppsCachedSize","cachedSharedSettings","shouldWarnAboutSvg","unsafeMigrateCache","force","forceUpdateCache","noEncrypt","serializedGlobal","serializeGlobal","encryptSession","reduceGlobal","reduceSharedState","availableReactions","lastIsChatInfoShown","getIsMobile","reduceCustomEmojis","reduceUsers","reduceChats","reduceMessages","reduceSettings","reduceChatFolders","reduceGroupCalls","idsToSave","currentChatIds","visibleUserIds","chatStoriesUserIds","attachBotIds","recentlyFoundChatIds","getOrderedIds","pickTruthy","messagesChatIds","replyPeer","unlinkedIdsToSave","forumPanelChatIds","forumPanelChatId","chatIdsToSave","openedChatThreadIds","tabChatId","pollIdsToSave","webPageIdsToSave","chatLastMessageId","openedThreadIds","commentThreadIds","originMessageId","threadIds","threadsToSave","viewportIdsToSave","lastViewportIds","topicLastMessageIds","savedLastMessageIds","lastMessageIdsToSave","typingStatus","cleanedById","cleanedMessage","blobUrl","isPreloadedGlobally","omitLocalMedia","localAmount","omitLocalPaidReactions","lastPremiumBandwithNotificationDate","activeGroupCallId","RippleEffect","ripples","setRipples","cleanUpDebounced","position","rippleSize","clientX","clientY","parseLine","separatorIndex","isEscaped","isInsideString","FALLBACK_LANG_CODE","FALLBACK_VERSION","FALLBACK_TRANSLATE_URL","LANGPACK_STORE_PREFIX","FORMATTERS_FALLBACK_LANG","TRANSLATION_CACHE","LimitedMap","formatters","langPack","fallbackLangPack","translationFn","createTranslationFn","areCallbacksScheduled","scheduleCallbacks","localizationReady","loadCachedLangData","cacheLangData","notifyLangpackUpdate","fallbackLoadPromise","loadFallbackPack","forLocalScript","fileData","readFileSync","rawStrings","readStrings","strings","clearKey","pluralSuffix","knownValue","stringsCount","nativeName","pluralCode","translatedCount","translationsUrl","readFallbackStrings","fallbackData","updateLanguage","fetchDifference","fromVersion","applyLangPackDifference","keysToRemove","newLangPack","updateLangPack","newLang","createFormatters","listFormatFallback","items","formatToParts","createListFormat","IS_INTL_LIST_FORMAT_SUPPORTED","ListFormat","pluralRules","PluralRules","region","DisplayNames","conjunction","disjunction","preciseNumber","initLocalization","canLoadFromServer","cachedData","loadAndChangeLanguage","refreshFromCache","shouldCheckCache","changeLanguage","remoteLanguage","requestLangPackDifference","newLanguage","remoteLangPack","baseLangCode","areAdvancedLangFnOptions","processTranslationAdvanced","processTranslation","rawCode","with","withRegular","withAdvanced","of","internalFormatters","languageInfo","getString","langKey","langPackStringValue","initialStrings","isDeletedLangString","select","isPluralLangString","other","finalString","valueAsString","isFinite","replaceAll","variableEntries","tempResult","specialReplacement","replaceInStringsWithTeact","curr","preparedValue","localizationReadyPromise","clamp","num","isBetween","lerp","start","end","interpolationRatio","roundToNearestEven","currentWindowSize","updateSizes","handleOrientationChange","visualViewport","pageTop","vh","getIsKeyboardVisible","mediaQueryCache","isMobile","isTablet","isLandscape","getIsTablet","getIsWebAppsFullscreenSupported","handleMediaQueryChange","isDesktop","mobileQuery","tabletQuery","landscapeQuery","isTouchScreenQuery","initMediaQueryCache","selectCanGift","bot","areStarGiftsAvailable","selectPeerCollectionSavedGifts","collectionId","selectPeerSavedGifts","isChatWithUser","isChatAdmin","selectPeerHasProfileBackground","profileColor","emojiStatus","ELIGIBLE_HOSTNAMES","link","tryParseDeepLink","correctUrl","queryParams","getQueryParams","pathParams","getPathParams","method","boost","isNumber","getHttpDeepLinkType","single","comment","buildPublicMessageLink","commentId","channelId","buildPrivateMessageLink","buildShareLink","buildChatFolderLink","buildLoginCodeLink","buildPublicUsernameOrBotLink","startApp","startapp","mode","startAttach","startattach","attach","choose","direct","buildPrivateChannelLink","buildBusinessChatLink","buildChatBoostLink","isPrivateChannel","buildGiftUniqueLink","parseHttpLink","urlToParse","IS_BAD_URL_PARSER","post","bot_id","scope","public_key","nonce","getTgDeepLinkType","publicKey","callbackUrl","buildTelegramPassportLink","callback_url","appname","buildPremiumReferrerLink","buildPremiumMultigiftLink","buildSettingsScreen","buildSettingsScreenLink","parseTgLink","parseDeepLink","getUsernameFromDeepLink","deepLink","isSingle","parseTimestampDuration","isDirect","screenParam","fromEntries","__classPrivateFieldGet","receiver","kind","TypeError","__classPrivateFieldSet","SuppressedError","elementObserverMap","refOrElement","onIntersectionChange","onIntersectionChangeLast","flush","LOAD_QUEUE","RENDER_HISTORY","loadFromQueue","queue","queueToLoad","otherQueue","loadCustomEmojis","updateLastRendered","updateLastRenderedCustomEmojis","notifyCustomEmojiRender","emojiId","addCustomEmojiInputRenderCallback","setCustomEmoji","setCanPlay","selectCanPlayAnimatedEmojis","handleGlobalChange","addCustomEmojiCallback","removeCustomEmojiCallback","initialLocationHash","parseInitialLocationHash","hasTestParam","tgWebAuthTest","accountsInfo","accountIds","apiUpdate","userAgent","PLATFORM_ENV","loadStoredSession","isWebmSupported","IS_WEBM_SUPPORTED","maxBufferSize","MAX_BUFFER_SIZE","webAuthToken","tgWebAuthToken","tgWebAuthDcId","mockScenario","isTestServerRequested","password","videoTs","ManagementProgress","storeSession","clearStoredSession","hangUp","leaveGroupCall","resetInitialLocationHash","resetLocationHash","reset","clearEncryptedSession","cacheApi","destroySharedStatePort","PASSCODE_IDB_STORE","langCachePrefix","langCacheVersion","initShared","otherTabId","sessionJson","globalJson","forgetPasscode","invalidAttemptsCount","timeoutUntil","formatStarsAsText","formatTonAsText","shouldConvertFromNanos","formattedAmount","containerClassName","hex2rgb","param","parseInt","rgb2hex","p0","p1","p2","rgb2hsb","h","v","hsb2rgb","q","defaultRGB","rgb","naturalHeight","naturalWidth","getImageData","blockSize","getPatternColor","hue","saturation","hsl2rgb","convertToRGBA","getTextColor","DEBUG_DURATION_LIMIT","initials","buildInitials","prepared","DEBUG_getFolderManager","updateFolderManagerThrottled","updateFolderManager","inited","updateFolders","orderedIdsByFolderId","getPinnedChatsCount","pinnedCountByFolderId","getChatsCount","chatsCountByFolderId","getUnreadCounters","unreadCountersByFolderId","getUnreadChatsByFolderId","unreadChatIdsByFolderId","getAllNotificationsCount","notificationsCount","getOrderKey","isForSaved","chatSummariesById","orderInSaved","orderInAll","getChatFolderIds","folderIdsByChatId","addOrderedIdsCallback","addChatsCountCallback","addUnreadChatsByFolderIdCallback","addUnreadCountersCallback","DEBUG_startedAt","isAllFolderChanged","isMainFolderChanged","isArchivedFolderChanged","isSavedFolderChanged","isAllFullyLoadedChanged","isAllFolderFullyLoaded","isArchivedFullyLoadedChanged","isArchivedFolderFullyLoaded","isSavedFolderFullyLoadedChanged","isSavedFolderFullyLoaded","areFoldersChanged","foldersById","areChatsChanged","chatsById","areSavedLastMessageIdsChanged","lastSavedMessageIds","areAllLastMessageIdsChanged","lastAllMessageIds","areTopicsChanged","areUsersChanged","usersById","areNotifyDefaultsChanged","areNotifyExceptionsChanged","notifyExceptions","affectedFolderIds","emptyFolderIds","folderSummariesById","updateFullyLoaded","updateResults","prevAllFolderListIds","allFolderListIds","prevArchivedFolderListIds","archivedFolderListIds","prevSavedFolderListIds","savedFolderListIds","newChatsById","newUsersById","newAllLastMessageIds","newSavedLastMessageIds","newNotifyDefaults","newNotifyExceptions","folderSummaries","newAllFolderListIds","newArchivedFolderListIds","newSavedFolderListIds","newGeneralIds","allIds","newFolderIds","currentSummary","isRemovedFromAll","isRemovedFromSaved","newSummary","chatUnreadCount","chatUnreadMentionsCount","hasUnreadMark","userInfo","shouldHideServiceChat","creationDate","draftDate","lastMessageInSaved","isListedInAll","isListedInSaved","isUserContact","buildChatSummary","chatSummary","folderSummary","isChatInFolder","buildChatFolderIds","currentFolderIds","deletedFolderIds","currentFolderIdsSet","newFolderIdsSet","currentFolderOrderedIds","chatIdsByFolderId","isOrderedListJustPatched","updateListsForChat","newListIds","currentPinnedIds","allFolderPinnedIds","savedFolderPinnedIds","archivedFolderPinnedIds","changedFolders","buildFolderSummaryFromMainList","newFoldersById","buildFolderSummary","wasUnreadCountersChanged","wasChatsCountChanged","wasUnreadChatsChanged","pinnedCount","newPinnedCount","prevOrderedIds","isSavedFolder","sortedPinnedIds","allListIds","sortedNotPinnedIds","chatId1","chatId2","buildFolderOrderedIds","currentOrderedIds","currentPinnedCount","currentChatsCount","newChatsCount","currentUnreadCounters","newUnreadCounters","chatsCount","buildFolderUnreadCounters","currentUnreadChats","newUnreadChats","buildFolderByUnreadChats","newInitials","SAFE_EXEC_ENABLED","safeExec","rescue","always","shouldIgnoreError","SwipeDirection","IOS_SCREEN_EDGE_THRESHOLD","SWIPE_DIRECTION_THRESHOLD","SWIPE_DIRECTION_TOLERANCE","MOVE_THRESHOLD","SWIPE_THRESHOLD_DEFAULT","RELEASE_WHEEL_ZOOM_DELAY","RELEASE_WHEEL_DRAG_DELAY","getDistance","hypot","pageY","getTouchCenter","lastClickTime","lethargy","stability","tolerance","lastUpDeltas","lastDownDeltas","deltasTimestamp","check","lastDelta","originalEvent","wheelDelta","deltaY","detail","isInertia","lastDeltas","lastDeltasOld","lastDeltasNew","oldSum","newSum","oldAverage","newAverage","IS_WINDOWS","captureEvents","captureEvent","hasMoved","hasSwiped","isZooming","initialDistance","wheelZoom","initialZoom","initialDragOffset","isDragCanceled","initialSwipeAxis","initialTouchCenter","minZoom","maxZoom","isNearEdge","onCapture","includedClosestSelector","withNativeDrag","withCursor","onDrag","onMove","onRelease","passive","selectorToPreventScroll","scrollable","overflow","onDoubleClick","centerX","centerY","newWindowSize","onZoom","endDistance","touchCenter","dragOffsetX","dragOffsetY","zoomFactor","initialCenterX","initialCenterY","currentCenterX","currentCenterY","shouldPreventScroll","onSwipe","xAbs","yAbs","swipeThreshold","axis","currentSwipeAxis","offsets","Left","Right","Up","Down","processSwipe","releaseWheelDrag","releaseWheelZoom","onWheelCapture","onWheel","doubleTapZoom","is","deltaX","ctrlKey","metaKeyPressed","metaKey","shiftKey","zoom","onWheelZoom","isUserEvent","sign","dx","dy","onWheelDrag","withWheelDrag","isNotPassive","useShowTransitionDeprecated","onCloseTransitionEnd","noFirstOpenTransition","setIsClosed","closeTimeoutRef","hasOpenClassName","setHasOpenClassName","exec","shouldHaveOpenClassName","hasShownClass","EXCLUDE_EMOJIS","ISO_FLAGS_OFFSET","unifiedToNative","unified","codePoints","fromCodePoint","dataset","path","pairs","nativeToUnified","uncompressEmoji","emojiData","categories","emojiRaw","names","native","isoToEmoji","iso","codePointAt","keyToHandlerName","Enter","Backspace","Delete","Esc","Escape","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Tab","handlers","onEnter","onDelete","onBackspace","onUp","onDown","onLeft","onRight","onTab","captureKeyboardListeners","hasActiveHandlers","handlerName","currentEventHandlers","releaseKeyboardListener","keyHandlers","Loading","backgroundColor","preventMessageInputBlur","withBubbling","preventMessageInputBlurWithBubbling","processDeepLink","linkContext","parsedLink","openPrivateChannel","parseChooseParameter","startParam","originalParts","resolveBusinessChatLink","openPremiumModal","openGiftRecipientPicker","processBoostParameters","usernameOrId","openUniqueGiftBySlug","EditProfile","Language","ActiveSessions","Privacy","Folders","General","openStarsBalanceModal","checkChatInvite","openChatByPhoneNumber","openStickerSet","joinVoiceChatByLink","openInvoice","openChatWithDraft","checkChatlistInvite","openStoryViewerByUsername","checkGiftCode","voicechat","livestream","inviteHash","invite","urlParam","formatShareText","purpose","balanceNeeded","topup","sharedWorker","synced","lastSharedState","initSharedState","localState","SharedWorker","port","onMessage","sendToWorker","onGlobalChange","deepDiff","updateGlobal","scheduledEvents","sendOnTickEnd","selectPaymentInputInvoice","inputInvoice","selectPaymentRequestId","selectProviderPublishableKey","form","nativeParams","publishableKey","selectProviderPublicToken","publicToken","selectStripeCredentials","selectSmartGlocalCredentials","selectCanUseGiftProfileAdminFilter","selectCanUseGiftProfileFilter","selectGiftProfileFilter","_Channel_onmessage","_Channel_nextMessageIndex","_Channel_pendingMessages","_Channel_messageEndIndex","_Resource_rid","SERIALIZE_TO_IPC_FN","transformCallback","__TAURI_INTERNALS__","Channel","onmessage","rawMessage","cleanupCallback","unregisterCallback","PluginListener","plugin","unregister","invoke","addPluginListener","checkPermissions","requestPermissions","cmd","convertFileSrc","filePath","Resource","rid","isTauri","INERTIA_DURATION","INERTIA_EASING","swipeOffsets","cancelCurrentReleaseAnimation","isSwipeActive","captureControlledSwipe","onSwipeLeftStart","onSwipeRightStart","onCancel","currentSlide","nextSlide","onCancelForTransition","targetPosition","getAnimations","KeyframeEffect","keyframe","getKeyframes","extractPositionFromTransform","extractAnimationEndPosition","currentDirection","animationTimingFunction","initialPositionPx","distance","units","dragOffset","newProgress","updateAnimationProgress","onCancelForClient","isRevertSwipe","cancel","releaseProgress","elements","getTiming","transformRule","userOrChat","closeStoryViewer","setShouldCloseRightColumn","selectIsMediaNsfw","chatActiveRestrictions","messageActiveRestrictions","singleEmoji","getMessageSingleRegularEmoji","animatedCustomEmojiId","getMessageSingleCustomEmoji","getMessageSticker","getWebPageAudio","thumbnail","getMessageInvoice","selectMessageMediaThumbnail","selectMessageMediaDuration","selectTimestampableMedia","selectMessageTimestampableDuration","noReplies","timestampableMedia","replyTimestampableMedia","selectMessageLastPlaybackTimestamp","setIsLoading","setError","setResult","wasCancelled","parseSearchResultKey","WINDOW_RESIZE_LINE_RECALC_DEBOUNCE","maxLinesBeforeCollapse","cutoutRef","isFirstRenderRef","cutoutHeightRef","setIsCollapsible","maxHeight","recalculateTextLines","totalLines","calcTextLineHeightAndCount","debouncedRecalcTextLines","windowWidth","checkSessionLocked","slotData","legacyAuthJson","userAuth","dcID","newSlotData","storeLegacySession","loadStoredLegacySession","LOCAL_TGS_PREVIEW_URLS","DuckNothingFound","Search","LOCAL_TGS_URLS","MonkeyIdle","MonkeyTracking","MonkeyClose","MonkeyPeek","FoldersAll","FoldersNew","DiscussionGroups","Lock","CameraFlip","HandFilled","HandOutline","Speaker","VoiceAllowTalk","VoiceMini","VoiceMuted","VoiceOutlined","JoinRequest","Invite","QrPlane","Congratulations","Experimental","PartyPopper","Flame","ReadTime","Unlock","LastSeen","StarReactionEffect","StarReaction","Report","SearchingDuck","BannedDuck","Diamond","SAMPLE_RATE","BIT_DEPTH","oggToWav","opusData","arrayBuffer","Response","typedArray","Uint8Array","decoderWorker","wavWorker","buffers","buffer","page","wavBitDepth","wavSampleRate","decoderSampleRate","outputBufferSampleRate","pages","asCacheApiType","Type","Text","DownloadUrl","Progressive","PROGRESSIVE_URL_PREFIX","DOWNLOAD_URL_PREFIX","MAX_MEDIA_RETRIES","memoryCache","fetchPromises","progressCallbacks","cancellableCallbacks","fetch","mediaFormat","isHtmlAllowed","onProgress","callbackUniqueId","IS_PROGRESSIVE_SUPPORTED","getProgressiveUrl","getDownloadUrl","fetchFromCacheOrRemote","activeCallbacks","getFromMemory","cancelProgress","parentCallback","retryNumber","cacheName","IS_OPUS_SUPPORTED","prepareMedia","makeOnProgress","remote","getRetryTimeout","debug","dataBlob","fetchBlob","downloadWithRetry","fullSize","INPUT_CUSTOM_EMOJI_SELECTOR","buildCustomEmojiHtml","isPlaceholder","uniqueId","getInputCustomEmojiParams","shouldUseTextColor","rawText","getCustomEmojiSize","maxEmojisInLine","langProvider","MULTITAB_ESTABLISH_TIMEOUT","resolveGlobalPromise","isFirstGlobalResolved","lastBroadcastDiffGlobal","isBroadcastDiffScheduled","subscribeToMultitabBroadcastChannel","appVersion","batchedUpdates","localDb","argsWithCallback","refreshLangPackFromCache","requestGlobal","resolveWithoutGlobal","extractCurrentThemeParams","getPropertyHexColor","secondaryTextColor","bgColor","textColor","buttonColor","buttonTextColor","linkColor","hintColor","secondaryBgColor","sectionSeparatorColor","bg_color","text_color","hint_color","link_color","button_color","button_text_color","secondary_bg_color","header_bg_color","accent_text_color","section_bg_color","section_header_text_color","subtitle_text_color","destructive_text_color","section_separator_color","validateHexColor","property","getPropertyValue","prepareHexColor","SUBSTITUTION_REGEX","PLURAL_OPTIONS","PLURAL_RULES","en","ar","be","n10","n100","ca","v0","de","es","fa","fi","fr","it","hr","i10","i100","f10","f100","hu","ko","nb","nl","pl","ru","sk","sr","tr","uk","uz","currentLangCode","currentTimeFormat","createLangFn","cacheValue","importFallbackLangPack","langString","preferredPluralOption","optionIndex","getPluralOption","template","otherValue","translationSlices","initialValue","processTemplate","withFallback","Json","sourceLangPacks","fetchRemote","langInfo","langName","INPUT_WAITING_CUSTOM_EMOJI_IDS","renderCallbacks","loaded","processMessageInputForCustomEmoji","checkInputCustomEmojiLoad","callInputRenderHandlers","getCustomEmojiMediaDataForInput","isPreview","mediaHash","getStickerHashById","fetchAndProcess","placeholderSrc","shouldUseStaticFallback","blankSrc","buildMessageKey","getMessageServerKey","msgId","parseMessageKey","getIsInBackgroundLocal","setIsInBackground","getIsInBackground","onFocus","lastOnBlur","lastOnFocus","DEBUG_LEVELS","ORIGINAL_FUNCTIONS","DEBUG_LOGS","getDebugLogs","FILTERED_ATTRIBUTES","HTML_ATTRIBUTES","CONTROLLABLE_TAGS","MAPPED_ATTRIBUTES","autoCapitalize","autoCorrect","INDEX_KEY_PREFIX","SELECTION_STATE_ATTRIBUTE","headsByElement","extraClasses","extraStyles","renderWithVirtual","parentEl","$current","$new","$parent","currentContext","skipComponentUpdate","nextSibling","namespace","isCurrentComponent","VirtualType","isNewComponent","$newAsReal","isCurrentFragment","isNewFragment","Tag","hasElementChanged","componentInstance","renderComponent","updateComponent","mountState","MountState","Mounted","setupComponentUpdateListener","newTarget","initComponent","mountChildren","createNode","insertBefore","setElementRef","remount","getNextSibling","renderChildren","forceMoveToEnd","$currentAsReal","$newAsTag","processControlled","currentEntries","newEntries","currentValue","updateAttributes","$element","Unmounted","mountComponent","fragmentEl","placeholderTarget","createComment","$child","$renderedChild","Empty","createTextNode","defaultChecked","processUncontrolledOnMount","componentNextSibling","isComponent","isFragment","unmountComponent","unmountChildren","replaceChild","unmountRealTree","currentEl","child","DEBUG_checkKeyUniqueness","currentChildren","newChildren","newKeys","$newChild","isParentElement","currentRemainingIndex","remainingByKey","$currentChild","isKeyPresent","newChildKey","orderKey","fragmentIndex","fragmentSize","currentPreservedIndex","currentChildInfo","renderFragment","newOrderKey","shouldMoveNode","isMovingDown","renderFastListChildren","currentFragment","newFragment","siblingAfterFragment","currentChildrenLength","newChildrenLength","createDocumentFragment","lastCurrentChild","fragmentNextSibling","isValueControlled","isCheckedControlled","selectionStart","selectionEnd","isCaretAtEnd","setSelectionRange","selectionState","updateClassName","inputEl","selectionStateJson","updateStyle","__html","extra","extraArray","cssText","applyExtraStyles","standardStyles","runImmediateEffects","captureImmediateEffects","$head","FOREVER_BANNED_DATE","isChatMonoforum","isChatWithVerificationCodesBot","getChatTypeString","getChatLink","activeUsername","getMainUsername","owner","getCanManageTopic","unrestrictedByBoosts","boostsToUnrestrict","boostsApplied","currentUserBannedRights","defaultBannedRights","isStoryReply","isInScheduledList","canAttachMedia","canAttachPolls","canAttachEmbedLinks","canAttachToDoLists","getMessageSendingRestrictionReason","sendMessages","untilDate","getForumComposerPlaceholder","isReplying","isChatArchived","getCanDeleteChat","getFolderDescriptionText","getOrderedTopics","pinnedOrder","shouldSortByLastMessage","pinned","isPinned","ordered","hidden","getGroupStatus","chatTypeString","getCustomPeerFromInvite","isVerified","isFake","isScam","fakeType","getMockPreparedMessageFromResult","preparedMessage","inlineButtons","sendMessage","replyMarkup","noLoad","isStreaming","useSelector","selectIsSynced","spentTime","ARE_WEBCODECS_SUPPORTED","IS_ELECTRON","electron","selector","selectorSignal","useSelectorSignal","backgroundImage","pill","fluid","isText","isShiny","withSparkleEffect","noSparkleAnimation","ariaControls","hasPopup","allowDisabledClick","noFastClick","ripple","faded","isRectangular","noPreventDefault","shouldStopPropagation","noForcedUpperCase","iconName","iconAlignment","onMouseUp","isClicked","setIsClicked","isNotInteractive","Sparkles","preset","noAnimation","renderContent","limit","selectPremiumLimit","PATTERN_PLACEHOLDER","DEFAULT_PATTERN","getCountryCodeByIso","phoneCodeList","country","iso2","getCountryFromPhoneNumber","bestMatches","countryCode","prefixes","formatPhoneNumber","pattern","numberWithoutCode","patterns","defaultPattern","stripped","getBestPattern","formatPhoneNumberWithCode","numberWithPlus","isPriority","onReady","onBroken","onTimeUpdate","restProps","handlePlaying","handlePlayingForAutoPause","playerRef","canPlayRef","shouldPauseRef","isLoadingPlayRef","usePlayPause","unfreezePlaying","unfreezePlayingOnRaf","useVideoAutoPause","isReadyRef","handleReady","isBuffered","bufferingHandlers","useBuffering","onPlaying","handlePlayingForBuffering","otherBufferingHandlers","prevIsBuffered","mergedOtherBufferingHandlers","mergedHandlers","keyString","useVideoCleanup","useLayoutEffectWithPrevDeps","prevDepsRef","parsedInitialLocationHash","messageHash","isAlreadyParsed","createLocationHash","displayType","parseLocationHash","isType","createMessageHashUrl","locationHash","getInitialLocationHash","parsedHash","pendingMeasureTasks","pendingMutationTasks","pendingForceReflowTasks","runUpdatePassOnRaf","currentMeasureTasks","task","setPhase","currentMutationTasks","pendingForceReflowMutationTasks","mutationTask","throttledFn","requestNextMutation","SKIP_TIMEOUT","hasActiveTransition","useViewTransition","parameters","transitionState","setTransitionState","domUpdateCallback","types","onHeavyAnimationEnd","startViewTransition","getTypes","finished","cleanUp","isReady","skipTransition","minimumAnimationLevel","IS_VIEW_TRANSITION_SUPPORTED","replaceMiddleSearch","chatThreadKey","rest","updateMiddleSearch","currentSearch","updated","isHashtag","savedTag","resetMiddleSearch","replaceMiddleSearchResults","fetchingQuery","updateMiddleSearchResults","prevQuery","closeMiddleSearch","replaceSharedMediaSearch","updateSharedMediaSearchType","currentType","updateSharedMediaSearchResults","replaceSharedMediaSearchResults","mergeWithChatMediaSearchSegment","loadingState","segment","mergedFoundIds","mergedLoadingState","areAllItemsLoadedForwards","areAllItemsLoadedBackwards","updateChatMediaSearchResults","currentSegment","segments","areSortedArraysIntersecting","mergeChatMediaSearchSegments","replaceChatMediaSearch","replaceChatMediaSearchResults","removeIdFromSegment","foundId","removeIdFromSearchResults","selectChatMediaSearch","updatedSearchParams","removeIdsFromChatMediaSearchParams","updateChatMediaLoadingState","newMessage","isMediaLoadableInViewer","resetForwardsLoadingStateInParams","initializeChatMediaSearchResults","setChatMediaSearchLoading","filterPeersByQuery","selectorFn","localizedTitle","isFoundInLocalized","getPeerFullTitle","getPeerTypeKey","getPeerTitle","getUserFirstOrLastName","promisifyRequest","oncomplete","onsuccess","onabort","onerror","createStore","dbName","storeName","dbp","txMode","indexedDB","open","onupgradeneeded","createObjectStore","db","onclose","getDB","objectStore","defaultGetStoreFunc","defaultGetStore","eachCursor","store","openCursor","continue","IdbStore","customStore","put","setMany","getMany","delMany","getAll","getAllKeys","cursor","getEntries","getKeys","getValues","updater","TIMESTAMP_RE","addTimestampEntities","apiText","resultText","fullMatch","hourStr","minuteStr","secondStr","totalSeconds","overlaps","inserted","IV_LENGTH","SALT","UnrecoverablePasscodeError","passcodeHash","setupPasscode","sha256","sessionEncrypted","aesEncrypt","globalEncrypted","decryptSessionByCurrentHash","aesDecrypt","decryptSession","plaintext","crypto","subtle","digest","TextEncoder","encode","asArray","hasEncryptedSession","ArrayBuffer","pwHash","iv","getRandomValues","alg","importKey","ptUint8","ctBuffer","encrypt","ct","dataArray","plainBuffer","decrypt","TextDecoder","isInitialized","HEX_COLOR_REGEX","RGB_VARIABLES","themeColors","hex","lerpRgb","applyColorAnimationStep","startIndex","endIndex","propertyColors","roundedA","themeClassName","isDarkTheme","shouldAnimate","startAt","themeColorTag","uninjectCss","head","injectCss","EMPTY_RECT","applyStaticOptions","bubbleRef","bubbleStyle","containerEl","bubbleEl","transformOrigin","externalRef","shouldCloseFast","ariaLabelledBy","noCloseOnBackdrop","backdropExcludedSelector","noCompact","withPortal","positionOptions","options2","staticOptions","anchor","getRootElement","getMenuElement","getTriggerElement","getLayout","withMaxHeight","triggerEl","anchorX","anchorY","menuEl","rootEl","extraPaddingX","extraTopPadding","extraMarginTop","topShiftY","menuElMinWidth","shouldAvoidNegativePosition","isDense","marginTop","menuElWidth","menuElHeight","menuRect","rootRect","yWithTopShift","triggerRect","addedYForPortalPositioning","addedXForPortalPositioning","leftWithPossibleNegative","addedXForMenuPositioning","offsetX","offsetY","processDynamically","useMenuPosition","bubbleFullClassName","IS_BACKDROP_BLUR_SUPPORTED","noInitiallyBuffered","setIsBuffered","setIsReady","bufferedProgress","setBufferedProgress","bufferedRanges","setBufferedRanges","setIsBufferedDebounced","handleBuffering","isSafariPatchInProgress","buffered","ranges","getTimeRanges","bufferedLength","currentRanges","onPLay","onLoadedData","onLoadStart","onPause","checkBuffering","videoRef","handlersRef","videoEl","handlers2","next","GENERAL_VARIABLES","LIGHT_VARIABLES","DARK_VARIABLES","setVariable","lightValueOrGeneral","darkValue","isUpdateScheduled","updateVariables","generalVariables","buildVariables","lightVariables","darkVariables","setPeerColor","darkColors","mainLightColor","mainDarkColor","lightBgColor","darkBgColor","lightBgActiveColor","darkBgActiveColor","lightGradientColors","darkGradientColors","caches","SUFFIX","isSupported","isCacheApiSupported","Request","contentType","headers","shouldRecreate","resolvedType","cacheData","isForAnimation","focusedQuoteOffset","canBeEmpty","textCacheBusterRef","adaptedFormattedText","stripCustomEmoji","entitiesWithFocusedQuote","offsetIndex","lendth","withSharedCanvas","hasSpoilers","Element","methods","VisualViewport","Document","HTMLInputElement","MouseEvent","Range","onError","nativeMethods","phase","isStrict","newPhase","enableStrict","LAYOUT_CAUSES","causes","nativeGetter","getOwnPropertyDescriptor","defineProperty","onMeasure","nativeMethod","apply","MutationObserver","mutations","attributeName","forcedMutationAllowedFor","contentEditable","childList","attributes","subtree","characterData","disableStrict","forceMeasure","MEDIA_VIEWER_MEDIA_QUERY","fontSize","ROUND_VIDEO_DIMENSIONS_PX","GIF_MIN_WIDTH","AVATAR_FULL_DIMENSIONS","VIDEO_AVATAR_FULL_DIMENSIONS","LIKE_STICKER_ID","DEFAULT_MEDIA_DIMENSIONS","MOBILE_SCREEN_NO_AVATARS_MESSAGE_EXTRA_WIDTH_REM","MOBILE_SCREEN_MESSAGE_EXTRA_WIDTH_REM","MESSAGE_MAX_WIDTH_REM","MESSAGE_OWN_MAX_WIDTH_REM","cachedMaxWidthOwn","cachedMaxWidth","cachedMaxWidthNoAvatar","getAvailableWidth","fromOwnMessage","isWebPageMedia","noAvatars","extraPaddingRem","availableWidthRem","getMaxMessageWidthRem","calculateDimensionsForMessageMedia","aspectRatio","availableWidth","availableHeight","getAvailableHeight","mediaWidth","calculateDimensions","getMediaViewerAvailableDimensions","withFooter","mql","windowHeight","occupiedHeightRem","calculateInlineImageDimensions","asForwarded","getPhotoInlineDimensions","calculateVideoDimensions","getVideoDimensions","calculateExtendedPreviewDimensions","preview","getPictogramDimensions","getDocumentThumbnailDimensions","smaller","getStickerDimensions","baseWidth","calculatedHeight","calculateMediaViewerDimensions","mediaHeight","calculatedWidth","TopicDefaultIcon","letterClassName","iconColor","iconSrc","getTopicDefaultIcon","hasMessageMedia","getMessageContact","getMessageTodo","getMessageAction","canEditMedia","otherMedia","getMessageRoundVideo","isDocumentPhoto","innerMediaType","isDocumentVideo","getMessageLocation","getMessageWebPage","getMessageDocumentPhoto","getWebPageDocument","getMessageDocumentVideo","getMediaThumbUri","getMessageIsSpoiler","invoiceMedia","isSpoiler","buildStaticMapHash","geo","long","lat","accuracyRadius","getPhotoMediaHash","hasMediaLocalBlobUrl","getProfilePhotoMediaHash","getVideoMediaHash","appendProgressiveQueryParameters","getVideoPreviewMediaHash","hasVideoPreview","getDocumentMediaHash","getDocumentHasPreview","getAudioMediaHash","getAudioHasCover","getVoiceMediaHash","webDocument","previewPhotoSizes","getMediaHash","getGamePreviewPhotoHash","getGamePreviewVideoHash","append","thumbnailSizes","getMediaFormat","hasInnerVideo","getMediaFileSize","IS_OPFS_SUPPORTED","getChatMediaMessageIds","isFromSharedMedia","getMessageContentIds","getPhotoFullDimensions","sizes","getMediaTransferState","isLoadNeeded","isUploading","isTransferring","transferProgress","validator","matchLinkInMessageText","getMediaFilename","getIsDownloading","getMessageMediaHash","statefulMedia","messagePhoto","actionPhoto","getMessageActionPhoto","messageVideo","messageDocument","messageAudio","canReplaceMessageMedia","attachment","isPhotoOrVideo","fileType","getAttachmentMediaType","stickerId","containsCustomEmoji","getUserStatus","userStatus","botActiveUsers","getServerTimeOffset","wasOnlineDate","withSelfOnline","getCanAddContact","sortUserIds","userStatusesById","priorityIds","expires","Bundles","LOAD_PROMISES","MEMORY_CACHE","loadBundle","bundleName","Auth","Extra","Calls","Stars","bundle","loadModule","getModuleFromMemory","moduleName","addLoadListener","_serverTimeOffset","useModuleLoader","autoUpdate","module","patchSafariProgressiveAudio","audioEl","patchedForSafari","patchForSafariInProgress","preventPlayAfterPatch","getEmojiOnlyCountForMessage","updateCurrentMessageList","shouldReplaceLast","newMessageLists","previous","replaceChatMessages","updateMessageStore","threadUpdate","replaceTabThreadParam","paramName","replaceThreadParam","updateTabThread","addMessages","addedByChatId","messagesByChatId","addChatMessagesById","replaceMessages","updatedByChatId","updateChatMessage","messageUpdate","isMediaUnread","emojiOnlyCount","updatedMessage","updateScheduledMessage","updateScheduledMessages","updateQuickReplyMessage","updateQuickReplyMessages","deleteQuickReplyMessages","deleteChatMessages","orderHistoryIds","updatedThreads","mediaIdsToRemove","threadMessages","clearMessageTranslation","deletedForwardedPosts","isLinkedChannelPost","threadMessageIds","newMessageCount","excludeSortedArray","orderPinnedIds","nonLocalMessageCount","originChatId","cancelMessageMediaDownload","mediaId","newViewportIds","canDeleteCurrentThread","originalPost","deleteChatScheduledMessages","scheduledIds","newScheduledIds","updateListedIds","removeOutlyingList","updateOutlyingLists","mergeIdRanges","addViewportId","safeReplaceViewportIds","safeReplacePinnedIds","doNotUpdateLinked","newThreadInfo","linkedUpdate","updateThreadInfos","originChannelId","updateFocusedMessage","noHighlight","isResizingContainer","quote","quoteOffset","scrollTargetPosition","updateSponsoredMessage","deleteSponsoredMessage","updateFocusDirection","enterMessageSelectMode","toggleMessageSelection","childMessageIds","withShift","oldSelectedMessages","newMessageIds","newSelectedMessageIds","prevIndex","exitMessageSelectMode","updateThreadUnreadFromForwardedMessage","originMessage","isDeleting","channelPostId","threadInfoOld","addActiveMediaDownload","metadata","mediaHashes","newActiveDownloads","updateUploadByMessageKey","messageKey","updateQuickReplies","quickRepliesUpdate","deleteQuickReply","quickReplyId","updateFullWebPage","webpage","updatedWebpage","replaceWebPage","updatePoll","pollUpdate","oldResults","option","updatedPoll","updatePollVote","recentVoterIds","totalVoters","newRecentVoterIds","newTotalVoters","targetOptionIndex","targetOption","updatedOption","votersCount","StickerView","thumbClassName","fullMediaHash","fullMediaClassName","isSmall","loopLimit","shouldLoop","shouldPreloadPreview","noVideoOnMobile","onVideoEnded","onAnimatedStickerLoop","isVideoBroken","markVideoBroken","isUnsupportedVideo","IS_ANDROID","isStatic","filterStyle","isIntersectingForLoading","shouldLoad","isIntersectingForPlaying","shouldPlay","hasIntersectedForPlayingRef","cachedPreview","isReadyToMountFullMedia","hasIntersected","getNoHeavyAnimation","setNoHeavyAnimation","$getIsHeavyAnimating","useMountAfterHeavyAnimation","shouldForcePreview","shouldLoadPreview","previewMediaData","withPreview","shouldSkipLoadingFullMedia","fullMediaData","shouldRenderFullMedia","isPlayerReady","markPlayerReady","isFullMediaReady","thumbData","isThumbOpaque","noCrossTransition","thumbRef","fullMediaRef","useCoordsInSharedCanvas","randomIdPrefix","isMediaReady","resolverOrDependency","getValue","isRegularLangString","isLangFnParam","object","KEYS_TO_IGNORE","counters","renderCountersThrottled","loggerEl","clearEl","setupOverlay","halfSecondAgo","maxRenders","maxDuration","lastUpdateAt","factor","incrementOverlayCounter","DEBUG_RENDER_THRESHOLD","DEBUG_EFFECT_THRESHOLD","DEBUG_SILENT_RENDERS_FOR","renderingInstance","lastComponentId","buildChildren","buildFragmentElement","buildComponentElement","createComponentInstance","buildTagElement","noEmpty","cleanChildren","isEmptyPlaceholder","dropEmptyTail","buildChildElement","DEBUG_components","TOTAL","DEBUG_memos","DEBUG_MEMOS_CALLS_THRESHOLD","avgRenderTime","calls","hitRate","instancesPendingUpdate","idsToExcludeFromUpdate","pendingEffects","pendingCleanups","pendingLayoutEffects","pendingLayoutCleanups","areImmediateEffectsCaptured","instancesToUpdate","currentCleanups","currentEffects","prepareComponentForFrame","currentElement","forceUpdateComponent","runCapturedImmediateEffects","currentLayoutCleanups","currentLayoutEffects","newRenderedValue","hooks","memos","refs","componentName","renderedValue","$old","Mounting","byCursor","releaseSignals","hook","schedule","nextValue","setter","helpGc","useEffectBase","isLayout","effectConfig","cleanupsContainer","effectsContainer","effectId","runEffectCleanup","runEffect","scheduleEffect","causedBy","prevValue","cleanups","signal","setupSignals","debugHitRateKey","DEBUG_state","instanceKey","misses","newCallback","signalRef","TeactMemoWrapper","afterHeavyAnimation","isScheduledRef","themeChangeCallback","systemThemeCache","getSystemTheme","setSystemThemeChangeCallback","MESSAGE_DELETED","WEBSYNC_URLS","WEBSYNC_VERSION","WEBSYNC_KEY","WEBSYNC_TIMEOUT","getTs","lastTimeout","authed","currentTs","canRedirect","script","removeElement","saveSync","startWebsync","stopWebsync","shouldSkipModal","openUrl","isRegularLink","isTrustedLink","classNames","insertionQueue","keyToRemove","callbackfn","thisArg","toStringTag","BUTTON_POSITIONS","durationShift","PROGRESS_POSITIONS","positions","velocityX","velocityY","generateRandomProgressPositions","presetSettings","shiftX","cos","atan2","shiftY","CLIPBOARD_ITEM_SUPPORTED","clipboard","ClipboardItem","textCopyEl","selection","getSelection","rangeToRestore","rangeCount","getRangeAt","execCommand","removeAllRanges","addRange","copyHtmlToClipboard","html","write","copyImageToClipboard","imageUrl","imageEl","copyBlobToClipboard","copyTextToClipboardFromPromise","getTextPromise","onFailure","copyTextToClipboardFallback","hasGetDataError","rejectGetDataError","clipboardTextItem","pngBlob","peerColor","emojiIconClassName","backgroundEmojiId","getMessageHtmlId","getMessageOriginalId","transcriptionId","hasMessageText","getMessageStatefulContent","storyPeerId","getMessageText","getMessageCustomShape","hasOtherFormatting","firstEntity","getFirstLinkInMessage","firstTextUrl","firstUrl","isReplyToMessage","isAnonymousOwnMessage","sendingState","isGeoLiveExpired","period","allowOutgoing","isScheduled","getMessageSingleInlineButton","hasIntersection","newOutlyingLists","array","prevArray","contentText","authCode","oldEntities","ttlSeconds","shouldSendAsFile","isUploadingFileSticker","chatUsername","normalizedId","chatPart","topicPart","messagePart","splitMessagesForForwarding","currentArr","lastGroup","batch","getSuggestedChangesInfo","originalMessage","suggestedPostInfo","original","suggested","originalContent","suggestedContent","originalText","originalMediaContent","suggestedText","suggestedMediaContent","isNewText","isNewMedia","originalPrice","suggestedPrice","isNewPrice","isNewTime","scheduleDate","getSuggestedChangesActionText","senderLink","changesInfo","changesParts","changesText","changes","UPDATE_DEBOUNCE","DEBOUNCE","updateValue","computedValue","removeProperty","handleTransitionEnd","useStyleObserver","elementName","modifiers","baseName","modifier","loopCountRef","setShouldPlay","hasCustomColor","safePlay","handleStickerLoop","isHq","blankImg","blobToFile","File","lastModified","preloadVideo","onloadedmetadata","createPosterForVideo","onseeked","videoWidth","videoHeight","imgToCanvas","validateFiles","fixMovMime","ext","fileBits","super","collection","member","buildCollectionByCallback","mapValues","newByKey","stringKeys","stringKey","orderRule","compareValues","currentOrderRule","isAsc","aValue","bValue","mode1","mode2","orderRule1","orderRule2","isAsc1","isAsc2","field","isInsideSortedArrayRange","findIntersectionWithSet","toExclude","excludeIndex","chunkSize","partition","pass","fail","arr","cloneDeep","isObject","predicate","RLottie","BLUE","GREEN","STROKE_WIDTH","STROKE_WIDTH_LARGE","GAP_PERCENT","SEGMENTS_MAX","LARGE_SIZE","EXTRA_GAP_ANGLE","EXTRA_GAP_SIZE","GAP_PERCENT_EXTRA","EXTRA_GAP_START","EXTRA_GAP_END","appTheme","isLarge","strokeWidth","adaptedSize","total","read","isCloseFriend","isRead","isForCloseFriends","drawGradientCircle","segmentsCount","colorStops","readSegmentsCount","readSegmentColor","strokeWidthPx","sizeModifier","strokeModifier","canvasSize","centerCoordinate","radius","segmentAngle","gapSize","gradient","createLinearGradient","addColorStop","colorStop","lineCap","_","startAngle","endAngle","strokeStyle","lineWidth","beginPath","arc","stroke","session","destroyConnection","onSomeTabSwitchedMultitabRole","subscribeAfterUserGesture","globalTheme","systemTheme","selectPerformanceSettings","IS_LINUX","canAnimate","authPhoneNumber","shouldSkipHistoryAnimations","LoadMoreDirection","FocusDirection","GlobalSearchContent","RightColumnContent","MediaViewerOrigin","StoryViewerOrigin","AudioOrigin","ChatCreationProgress","ProfileState","PaymentStep","ManagementScreens","TOPIC_MAPPING","blue","violet","green","rose","red","getTopicColors","grey","getTopicColorCssVariable","checkIfHasUnreadReactions","areReactionsEmpty","getReactionKey","isSameReaction","first","areCustomAllowed","allowed","sortReactions","right","reactionOne","reactionTwo","indexOne","indexTwo","getUserReactions","isReactionChosen","reactionCount","newReactions","existingIndex","addPaidReaction","isAnonymous","localIsPrivate","localPeerId","localPreviousChosenOrder","STORY_ALT_VIDEO_WIDTH","getStoryMediaHash","isAlt","altVideos","getStoryKey","allowedUserIds","allowedChatIds","blockedUserIds","blockedChatIds","allowedUsers","allowedChats","blockedUsers","blockedChats","getCurrentMaxAccountCount","premiumCount","account","currentMaxCount","getCurrentProdAccountCount","selectManagement","selectCurrentManagementType","selectCanManage","canAddContact","isBot","selectStatistics","selectIsMediaViewerOpen","isAvatarView","standaloneMedia","isSponsoredMessage","selectRightColumnContentKey","editTopicPanel","EditTopic","createTopicPanel","CreateTopic","PollResults","currentManagement","selectCurrentManagement","Management","isStatisticsShown","currentMessageId","MessageStatistics","StoryStatistics","currentChatId","canViewStatistics","selectIsStatisticsShown","Statistics","boostStatistics","BoostStatistics","monetizationStatistics","MonetizationStatistics","StickerSearch","GifSearch","AddingMembers","ChatInfo","selectIsRightColumnShown","selectThemeValues","themeKey","selectIsForumPanelOpen","selectIsForumPanelClosed","selectIsReactionPickerOpen","reactionPicker","selectPerformanceSettingsValue","selectCanAutoPlayMedia","canAutoPlayVideos","canAutoPlayGifs","asGif","selectShouldLoopStickers","selectCanAnimateRightColumn","selectCanAnimateSnapEffect","IS_SNAP_EFFECT_SUPPORTED","selectIsContextMenuTranslucent","selectWebApp","selectActiveWebApp","activeWebAppKey","selectPeerProfileColor","selectCurrentGlobalSearchQuery","ONE_GIGABYTE","ONE_MEGABYTE","getFileSizeString","getFileExtension","getColorFromExtension","textContainer","scrollHeight","onResize","onResizeRef","ResizeObserver","LOCAL_STORAGE_LISTENING_THROTTLE","REFRESH_INTERVAL","PREVIEW_SIZE","useMultiaccountInfo","isUpdater","setAccountsInfo","avatarHash","avatarUrl","refresh","updateAvatar","abortSignal","resizedAvatar","aborted","dataUrl","toDataURL","AbortController","abort","useInterval","handleStorageChange","selectCurrentMiddleSearch","selectCurrentSharedMediaSearch","selectCurrentChatMediaSearch","THROTTLE_MS","setX","setY","recalculate","targetLeftOffset","targetTopOffset","canvasLeftOffset","canvasTopOffset","throttledRecalculate","EQUAL","DELETE","DELETE_ALL_CHILDREN","keys2","subValue1","subValue2","subDiff","updateMessageTranslation","translation","translatedMessages","chatTranslations","newByLangCode","newTranslatedMessages","updateMessageTranslations","updateRequestedChatTranslation","updateRequestedMessageTranslation","removeRequestedMessageTranslation","newManualMessages","maxTouchPoints","getPlatform","IS_MOBILE","IS_YA_BROWSER","IS_FIREFOX","Auxiliary","Secondary","Fourth","Fifth","IS_PWA","standalone","IS_APP","IS_VOICE_RECORDING_SUPPORTED","mediaDevices","AudioContext","webkitAudioContext","inlineEl","newEmojiWidth","legacyEmojiWidth","isLastEmojiVersionSupported","chromeVersion","hasBrokenServiceWorkerStreaming","canPlayType","IS_CANVAS_FILTER_SUPPORTED","IS_REQUEST_FULLSCREEN_SUPPORTED","ARE_CALLS_SUPPORTED","IS_WAVE_TRANSFORM_SUPPORTED","IS_FLUID_BACKGROUND_SUPPORTED","TEST_VIDEO","MASK_IMAGE_DISABLED","storage","getDirectory","directory","removeEntry","recursive","IS_OFFSET_PATH_SUPPORTED","CSS","supports","IS_INSTALL_PROMPT_SUPPORTED","IS_OPEN_IN_NEW_TAB_SUPPORTED","MESSAGE_LIST_SENSITIVE_AREA","IS_GEOLOCATION_SUPPORTED","getGeolocationStatus","permissionStatus","accessRequested","accessGranted","geolocation","getCurrentPosition","isPrimary","conjuctionWithNodes","langFn","nodes","placeholders","replaced","UNIQUE_PLACEHOLDER_PREFIX","UNSUPPORTED_LANG_KEY","isInsideTopic","openThread","openTelegramLink","renderStrong","isServiceNotificationsChat","senderTitle","chatTitle","userFallbackText","chatFallbackText","channelFallbackText","chatLink","textLink","mediaValue","score","gameTitle","gameLink","isViaRequest","inviterId","inviter","inviterLink","channelLink","originalChatId","originalChatLink","iconEmojiId","topicLink","currentTopic","topicPlaceholderLink","boosts","userTitle","userLink","userLinks","app","isAttachMenu","isFromRequest","senderUsername","appLink","winnersCount","isStars","unclaimedCount","cryptoAmount","cryptoCurrency","cryptoPrice","cost","durationText","isRecurringInit","isRecurringUsed","invoiceTitle","peerTitle","alreadyPaidUpgradeStars","savedId","isToChannel","fromPeer","fromTitle","fromLink","starsAmount","channelPeer","channelTitle","isTransferred","isUpgrade","resaleAmount","transferStars","amountText","actionPeer","actionPeerLink","isAllowedInChannel","payerInitiated","postSender","postSenderTitle","postSenderLink","isRejected","isBalanceTooLow","rejectComment","replyMessageSender","replyPeerTitle","currencyName","publishDate","isPostPublished","completedIds","incompletedIds","completedItem","incompletedItem","todoItems","incompletedTaskTitle","incompletedTaskLink","completedTaskTitle","completedTaskLink","completedText","completedLink","incompletedText","incompletedLink","listTitle","listLink","taskTitle","taskLink","tasksText","tasksLink","tasks","renderActionText","bySelector","getter","clientsCount","state2","replaceWithTeact","searchValue","replaceValue","firstElement","READABLE_ERROR_MESSAGES","CHAT_RESTRICTED","CHAT_SEND_POLL_FORBIDDEN","CHAT_SEND_STICKERS_FORBIDDEN","CHAT_SEND_GIFS_FORBIDDEN","CHAT_SEND_MEDIA_FORBIDDEN","CHAT_LINK_EXISTS","SLOWMODE_WAIT_X","USER_BANNED_IN_CHANNEL","USER_IS_BLOCKED","YOU_BLOCKED_USER","IMAGE_PROCESS_FAILED","MEDIA_EMPTY","MEDIA_GROUPED_INVALID","MEDIA_NEW_INVALID","MESSAGE_NOT_MODIFIED","MEDIA_INVALID","PASSWORD_HASH_INVALID","PHOTO_EXT_INVALID","PHOTO_INVALID_DIMENSIONS","PHOTO_SAVE_FILE_INVALID","MESSAGE_DELETE_FORBIDDEN","MESSAGE_POLL_CLOSED","MESSAGE_EDIT_TIME_EXPIRED","PINNED_DIALOGS_TOO_MUCH","CHANNEL_PRIVATE","MEDIA_CAPTION_TOO_LONG","ADDRESS_STREET_LINE1_INVALID","ADDRESS_STREET_LINE2_INVALID","ADDRESS_CITY_INVALID","ADDRESS_COUNTRY_INVALID","ADDRESS_POSTCODE_INVALID","ADDRESS_STATE_INVALID","REQ_INFO_NAME_INVALID","REQ_INFO_PHONE_INVALID","REQ_INFO_EMAIL_INVALID","LINK_NOT_MODIFIED","MESSAGE_TOO_LONG","SERVICE_WORKER_DISABLED","MESSAGE_TOO_LONG_PLEASE_REMOVE_CHARACTERS","FRESH_RESET_AUTHORISATION_FORBIDDEN","BOTS_TOO_MUCH","BOT_GROUPS_BLOCKED","USERS_TOO_MUCH","USER_CHANNELS_TOO_MUCH","USER_KICKED","USER_NOT_MUTUAL_CONTACT","USER_PRIVACY_RESTRICTED","INVITE_HASH_EMPTY","INVITE_HASH_EXPIRED","INVITE_HASH_INVALID","CHANNELS_TOO_MUCH","USER_ALREADY_PARTICIPANT","SCHEDULE_DATE_INVALID","WALLPAPER_DIMENSIONS_INVALID","ADMINS_TOO_MUCH","ADMIN_RANK_EMOJI_NOT_ALLOWED","ADMIN_RANK_INVALID","FRESH_CHANGE_ADMINS_FORBIDDEN","INPUT_USER_DEACTIVATED","BOT_PRECHECKOUT_TIMEOUT","PROVIDER_ACCOUNT_TIMEOUT","STARGIFT_CONVERT_TOO_OLD","SUBSCRIPTION_ALREADY_ACTIVE","PEERS_LIST_EMPTY","PAID_MEDIA_FORBIDDEN","USER_DISALLOWED_STARGIFTS","CHAT_WRITE_FORBIDDEN","CHAT_ADMIN_REQUIRED","SHIPPING_ERRORS","FINAL_PAYMENT_ERRORS","getReadableErrorText","isSlowMode","textParams","extraPartIndex","errorMessage","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","__webpack_modules__","getPrototypeOf","__esModule","ns","def","getOwnPropertyNames","definition","o","enumerable","chunkId","promises","miniCssF","Function","done","needAttach","scripts","getElementsByTagName","getAttribute","charset","nc","onScriptComplete","doneFns","bind","scriptUrl","importScripts","currentScript","installedCssChunks","miniCss","fullhref","existingLinkTags","dataHref","existingStyleTags","findStylesheet","oldTag","linkTag","errorType","realHref","createStylesheet","loadStylesheet","baseURI","installedChunks","installedChunkData","realSrc","webpackJsonpCallback","parentChunkLoadingFunction","chunkIds","moreModules","runtime","chunkLoadingGlobal","handleWorkerMessage","scriptURL","ourRegistrations","getRegistrations","register","getRegistration","hasErrorKey","intervals","checkStoryExpiration","serverTime","previousGlobal","isCurrentMaster","isPreviousMaster","initGlobal","storedSharedState","initialTabState","isPlaybackRateActive","isLastPlaybackRateActive","fixedThreadsById","parsedMessageList","actionPayload","isImproved","testAndImprove","frames","lastFrameAt","mean","boosterEl","improveView","isSetup","openLink","urlObject","openNewWindow","shellPlugin","AuthCodeAsync","AuthCode","AuthPasswordAsync","AuthPassword","SITE_FONTS","preloadFonts","font","fonts","navigateBack","currentUrl","getSuggestedLanguage","suggestedLanguage","useLangString","fetchLangString","MENU_HIDING_DURATION","getFilteredList","defaultName","CountryCodeInput","inputRef","setFilter","filteredList","setFilteredList","updateFilter","filterValue","prevPhoneCodeList","handleInput","handleInputKeyDown","CodeInput","handleTrigger","formEl","getElementById","scrollTo","behavior","inputValue","MenuItem","isPreloadInitiated","AuthPhoneNumber","setAuthPhoneNumber","setAuthRememberMe","loadNearestCountry","loadCountryList","clearAuthErrorKey","goToAuthQrCode","isConnected","continueText","setCountry","setPhoneNumber","isTouched","setIsTouched","lastSelection","setLastSelection","markIsLoading","unmarkIsLoading","hasActiveAccount","phoneNumberSlots","fullNumber","canSubmit","parseFullNumber","newFullNumber","suggestedCountry","selectedCountry","handleLangChange","isJustPastedRef","handlePaste","handleBackNavigation","handleCountryChange","handlePhoneNumberChange","monkeyPath","shouldFixSafariAutoComplete","handleKeepSessionChange","handleGoToAuthQrCode","isAuthReady","onSubmit","adaptedPhoneNumber","qrCodeStylingPromise","returnToAuthPhoneNumber","qrCodeRef","isQrMounted","markQrMounted","unmarkQrMounted","QrCodeStyling","blankUrl","dotsOptions","cornersSquareOptions","imageOptions","imageSize","qrOptions","errorCorrectionLevel","handleReturnToAuthPhoneNumber","AnimatedIcon","AuthRegisterAsync","AuthRegister","handleChangeAuthorizationMethod","renderingAuthState","Transition","getActiveKey","AuthQrCode","getScreen","preloadAvatars","preloadTasks","main","spoilerMaskPath","telegramLogoPath","authPassword","lock","lockPreviewPath","inactive","isRightColumnShown","leftColumnWidth","UiLoader","setIsUiReady","markReady","shouldRenderMask","safePreload","appStyles","AppInactive","handleReload","appInactivePath","isLocked","LockScreen","AppScreens","TRANSITION_RENDER_COUNT","ACTIVE_PAGE_TITLE","INACTIVE_PAGE_TITLE","App","isMobileOs","checkMultiaccPasscode","handleDrag","dataTransfer","dropzone","dropEffect","handleDrop","auth","useTauriDrag","tauriWindow","getCurrentWindow","startDragging","corePromise","markTitleBarOverlay","isOverlay","relaunch","checkUpdate","setWindowTitle","initTauriApi","listen","isContentEditable","features","setupTauriListeners","isCompatTestPassed","listenOtherClients","switchMultitabRole","manifest","updateWebmanifest","lastFocusAt","setupInterval","betterView","isPageUnload"],"sourceRoot":""}