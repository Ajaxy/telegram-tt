"use strict";(self.webpackChunktelegram_t=self.webpackChunktelegram_t||[]).push([[2394],{285:(e,t,n)=>{n.d(t,{A:()=>u});var a=n(84051),i=n(13439),o=n(90709),s=n(91048),r=n(4961),c=n(59030),l=n(94189),d=n(20021);const u=(0,a.ph)((0,i.EK)((e,{userId:t})=>{const n=(0,s.meB)(e),a=t&&(0,s.mBe)(e,t);return{chat:n,contactName:a?(0,o.u0)(a):void 0}})(({isOpen:e,chat:t,userId:n,contactName:o,onClose:s})=>{const{deleteChatMember:u}=(0,i.ko)(),p=(0,c.A)(),m=(0,a.hb)(()=>{u({chatId:t.id,userId:n}),s()},[t,u,s,n]);if(t&&n)return(0,d.Y)(l.A,{isOpen:e,onClose:s,title:p("GroupRemoved.Remove"),textParts:(0,r.A)(p("PeerInfo.Confirm.RemovePeer",o)),confirmLabel:p("lng_box_remove"),confirmHandler:m,confirmIsDestructive:!0})}))},59324:(e,t,n)=>{n.d(t,{A:()=>c});var a=n(84051),i=n(57474),o=n(41036),s=n(18276);var r=n(20021);const c=(0,a.ph)(({iconName:e,isLoading:t})=>(0,r.Y)(o.Ay,{className:"LLqNvbR9",activeKey:t?0:1,name:"fade",children:t?(0,r.Y)(i.A,{className:"PbV71feg",color:"white"}):(0,r.Y)(s.A,{className:"sohV68PB",name:e})}))},71331:(e,t,n)=>{n.d(t,{Ip:()=>r,O7:()=>p,iT:()=>d,mD:()=>s,n5:()=>c,qI:()=>l,uu:()=>u});var a=n(90709),i=n(21133),o=n(19926);function s(e,t){const n=(0,i.AW)(e,t);if(n&&n.groupCallId)return r(e,n.groupCallId)}function r(e,t){return e.groupCalls.byId[t]}function c(e,t,n){return r(e,t)?.participants[n]}function l(e){const t=d(e)?.chatId;if(!t)return!1;const n=(0,i.hd)(e,t);return!!n&&((0,a.yn)(n)&&n.isCreator||Boolean(n.adminRights?.manageCall))}function d(e){const{groupCalls:{activeGroupCallId:t}}=e;if(t)return r(e,t)}function u(e){const{phoneCall:t,currentUserId:n}=e;if(!t||!t.participantId||!t.adminId)return;const a=t.adminId===n?t.participantId:t.adminId;return(0,o.mB)(e,a)}function p(e){const t=d(e);if(!t||!t.chatId)return!1;const n=(0,i.hd)(e,t.chatId);if(!n)return!1;if(Boolean((0,a.Kl)(n)))return!0;const o=(0,i.AW)(e,n.id)?.inviteLink;return Boolean(o)}},83320:(e,t,n)=>{n.r(t),n.d(t,{ActiveCallHeader:()=>tt,GroupCall:()=>et,PhoneCall:()=>rt,RatePhoneCallModal:()=>lt});var a=n(12859),i=n(96454),o=n(31481);function s(e){return 0|e}function r(e){return e>>>0}function c(e,t=3){if(!e)return 0;const{length:n}=e;let a=0;for(let t=0;t<n;t++)a+=e[t]*e[t];const i=Math.sqrt(a/n)/255;return Math.min(1,i*t)}function l(e){return{id:e.id,name:e.name,"rtcp-fbs":e.feedbackTypes,clockrate:e.clockrate,parameters:e.parameters,channels:e.channels}}const d=.1,u="getDisplayMedia"in(navigator?.mediaDevices||{}),p=navigator?.mediaDevices?.getSupportedConstraints().echoCancellation,m=navigator?.mediaDevices?.getSupportedConstraints().noiseSuppression,h=(e,t=!1)=>{if(!e||!e.sdp)throw Error("Failed parsing SDP: session description is null");const n=e.sdp.split("\r\nm=").map((e,t)=>0===t?e:`m=${e}`).reduce((e,t)=>{const n=t.match(/^m=(.+?)\s/)?.[1]||"header";return e[e.hasOwnProperty(n)&&"video"===n?"screencast":n]=t.split("\r\n").filter(Boolean),e},{}),a=(e,t)=>t?n[t]?.find(t=>t.startsWith(e))?.substr(e.length):Object.values(n).map(t=>t.find(t=>t.startsWith(e))?.substr(e.length)).filter(Boolean)[0],i=e=>n[e].filter(e=>e.startsWith("a=extmap")).map(e=>{const[,t,n]=e.match(/extmap:(\d+)(?:\/.+)?\s(.+)/);return{id:Number(t),uri:n}}),o=e=>{const t=n[e].filter(e=>e.startsWith("a=rtpmap")).map(e=>{const[,t,n]=e.match(/:(\d+)\s(.+)/)||[],[a,i,o]=n.split("/");return{id:Number(t),name:a,clockrate:Number(i),...o&&{channels:Number(o)}}}),a=n[e].filter(e=>e.startsWith("a=rtcp-fb")).map(e=>{const[,t,n]=e.match(/:(\d+)\s(.+)/)||[],[a,i]=n.split(" ");return{id:Number(t),type:a,subtype:i||""}}),i=n[e].filter(e=>e.startsWith("a=fmtp")).map(e=>{const[,t,n]=e.match(/:(\d+)\s(.+)/)||[],a=n?.split(";").reduce((e,t)=>{const[n,a]=t.split("=");return e[n]=a,e},{});if(a&&!Object.values(a).some(e=>!e))return{id:Number(t),data:a}}).filter(Boolean);return t.map(e=>{const t=i.filter(t=>t.id===e.id).map(e=>e.data).reduce((e,t)=>Object.assign(e,t),{}),n=a.filter(t=>t.id===e.id).map(e=>({type:e.type,subtype:e.subtype}));return{...e,...Object.keys(t).length>0&&{parameters:t},...n.length>0&&{feedbackTypes:n}}})},r=a("a=ssrc:","audio"),c=r&&Number(r.split(" ")[0]),l=a("a=ssrc-group:","video")?.split(" ")||void 0,d=a("a=ssrc-group:","screencast")?.split(" ")||void 0;if(!l)throw Error("Failed parsing SDP: no video ssrc");const[u,p]=a("a=fingerprint:")?.split(" ")||[],m=a("a=setup:");if(!u||!p)throw Error("Failed parsing SDP: no fingerprint");console.log(n);const h=a("a=ice-ufrag:"),g=a("a=ice-pwd:");if(!h||!g)throw Error("Failed parsing SDP: no ICE ufrag or pwd");return{fingerprints:[{fingerprint:p,hash:u,setup:t?m:"active"}],pwd:g,ufrag:h,...c&&{ssrc:s(c)},...l&&{"ssrc-groups":[{semantics:l[0],sources:l.slice(1,l.length).map(Number).map(s)},t&&d&&{semantics:d[0],sources:d.slice(1,d.length).map(Number).map(s)}].filter(Boolean)},...t&&{audioExtmap:i("audio"),videoExtmap:i("video"),screencastExtmap:i("screencast"),audioPayloadTypes:o("audio"),videoPayloadTypes:o("video"),screencastPayloadTypes:o("screencast")}}},g=(e,t=!1,n=!1,a=!1)=>{const i=[],o=e=>{i.push(e)},{sessionId:s,ssrcs:c,audioExtensions:l,videoExtensions:d,audioPayloadTypes:u,videoPayloadTypes:p,transport:{ufrag:m,pwd:h,fingerprints:g,candidates:f}}=e;o("v=0"),o(`o=- ${s} 2 IN IP4 0.0.0.0`),o("s=-"),o("t=0 0"),o("a=ice-options:trickle"),o("a=msid-semantic:WMS *"),o(`a=group:BUNDLE ${c.map(e=>e.mid).join(" ")}${n?"":" "+(a?"3":"2")}`),a||o("a=ice-lite");const v=e=>{if(e.sdpString)o(`a=${e.sdpString}`);else{let t="";t+="a=candidate:",t+=`${e.foundation} ${e.component} ${e.protocol} ${e.priority} ${e.ip} ${e.port} typ ${e.type}`,"rel-addr"in e&&(t+=` raddr ${e["rel-addr"]} rport ${e["rel-port"]}`),t+=` generation ${e.generation}`,o(t)}},C=()=>{o(`a=ice-ufrag:${m}`),o(`a=ice-pwd:${h}`),g.forEach(e=>{o(`a=fingerprint:${e.hash} ${e.fingerprint}`),o(`a=setup:${a?e.setup:"passive"}`)}),f.forEach(v)},y=e=>{const{channels:t,id:n,name:a,clockrate:i,parameters:s}=e;if(o(`a=rtpmap:${n} ${a}/${i}${t?`/${t}`:""}`),s){const e=Object.keys(s).map(e=>`${e}=${s[e]};`).join(" ");o(`a=fmtp:${n} ${e}`)}e["rtcp-fbs"]?.forEach(e=>{o(`a=rtcp-fb:${n} ${e.type}${e.subtype?` ${e.subtype}`:""}`)})},b=e=>{const n=e.isVideo?p:u,i=e.isVideo?"video":"audio";if(o(`m=${i} ${e.isMain?1:0} RTP/SAVPF ${n.map(e=>e.id).join(" ")}`),o("c=IN IP4 0.0.0.0"),o("b=AS:1300"),o(`a=mid:${e.mid}`),o("a=rtcp-mux"),n.forEach(y),o("a=rtcp:1 IN IP4 0.0.0.0"),e.isVideo&&o("a=rtcp-rsize"),(e.isVideo?d:l).forEach(({id:e,uri:t})=>{o(`a=extmap:${e} ${t}`)}),e.isRemoved)o("a=inactive");else{if(C(),a)o("a=sendrecv"),o("a=bundle-only");else{if(t)return void o("a=recvonly");e.isMain?o("a=sendrecv"):(o("a=sendonly"),o("a=bundle-only"))}e.sourceGroups.forEach(t=>{t.semantics&&o(`a=ssrc-group:${t.semantics} ${t.sources.map(r).join(" ")}`),t.sources.forEach(t=>{const n=r(t);o(`a=ssrc:${n} cname:${e.endpoint}`),o(`a=ssrc:${n} msid:${e.endpoint} ${e.endpoint}`),o(`a=ssrc:${n} mslabel:${e.endpoint}`),o(`a=ssrc:${n} label:${e.endpoint}`)})})}};return a?c.filter(b):c.filter(e=>"0"===e.mid||"1"===e.mid).map(b),n||(o("m=application 1 UDP/DTLS/SCTP webrtc-datachannel"),o("c=IN IP4 0.0.0.0"),C(),o("a=ice-options:trickle"),o("a=mid:"+(a?"3":n?"1":"2")),o("a=sctp-port:5000"),o("a=max-message-size:262144")),a||c.filter(e=>"0"!==e.mid&&"1"!==e.mid).map(b),`${i.join("\n")}\n`},f=e=>{const t=e.createOscillator(),n=t.connect(e.createMediaStreamDestination());return t.start(),new MediaStream([Object.assign(n.stream.getAudioTracks()[0],{enabled:!1})])},v=({width:e=640,height:t=480}={})=>{const n=Object.assign(document.createElement("canvas"),{width:e,height:t}),a=n.getContext("2d");if(!a)throw Error("Cannot create canvas ctx");a.fillRect(0,0,e,t);const i=n.captureStream();return new MediaStream([Object.assign(i.getVideoTracks()[0],{enabled:!1})])};var C=n(9705),y=n(41733);let b,w;function A(e){b&&(b.screenshareDataChannel?.close(),b.screenshareConnection?.close(),e||b.onUpdate?.({"@type":"updateGroupCallLeavePresentation"}))}function S(e){return b?.streams?.[e]}function k(e,t){const n=b?.participantFunctions?.[e];n&&n.setVolume?.(t)}function I(e,t){const n=t||b?.myId,a=n&&S(n)?.[e];return!!a&&a.getTracks()[0]?.enabled}function P(e){b?.onUpdate?.({"@type":"updateGroupCallStreams",userId:e,hasAudioStream:I("audio",e),hasVideoStream:I("video",e),hasPresentationStream:I("presentation",e),amplitude:b.speaking?.[e]})}async function T(e,t="user"){if("audio"===e&&b?.audioStream)return b.audioStream;if("presentation"===e)return navigator.mediaDevices.getDisplayMedia({audio:!1,video:!0});const n=await navigator.mediaDevices.getUserMedia({audio:"audio"===e&&{...p&&{echoCancellation:!0},...m&&{noiseSuppression:!0}},video:"video"===e&&{facingMode:t}});if(b&&"audio"===e&&(b.audioStream=n),"video"===e){const e=document.createElement("video");e.srcObject=n;const t=new C.A;e.oncanplay=()=>t.resolve(),await t.promise}return n}async function N(e,t=void 0){if(!(b&&b.myId&&b.connection&&b.streams))return;const n=S(b.myId)?.[e];if(!n)return;const a=n.getTracks()[0];if(!a)return;const i=[...b.connection.getSenders(),...b.screenshareConnection?.getSenders()||[]].find(e=>a.id===e.track?.id);if(i){t=void 0===t?!a.enabled:t;try{if(t&&!a.enabled){const t=await T(e);if(await i.replaceTrack(t.getTracks()[0]),b.streams[b.myId][e]=t,"video"===e)b.facingMode="user";else if("audio"===e){const{audioContext:e}=b;if(!e)return;const n=b.audioSource||e.createMediaStreamSource(t),a=b.audioAnalyser||e.createAnalyser();a.minDecibels=-100,a.maxDecibels=-30,a.smoothingTimeConstant=.05,a.fftSize=1024,n.connect(a),b={...b,audioSource:n,audioAnalyser:a,participantFunctions:{...b.participantFunctions,[b.myId]:{...b.participantFunctions?.[b.myId],getCurrentAmplitude:()=>{const e=new Uint8Array(a.frequencyBinCount);return a.getByteFrequencyData(e),c(e,1.5)}}}}}}else if(!t&&a.enabled){const t="audio"===e?b.silence:b.black;if(!t)return;await i.replaceTrack(t.getTracks()[0]),b.streams[b.myId][e]=t,"video"===e&&(b.facingMode=void 0),"audio"!==e?a.stop():(b.audioSource?.disconnect(),b.audioAnalyser?.disconnect())}P(b.myId),"presentation"!==e||t||A(!0)}catch(e){}}}function M(e){b?.onUpdate?.({"@type":"updateGroupCallConnectionState",connectionState:e})}function x(){b&&(b.myId&&b.streams?.[b.myId]&&Object.values(b.streams[b.myId]||{}).forEach(e=>{e?.getTracks().forEach(e=>{e.stop()})}),b.audioStream?.getTracks().forEach(e=>{e.stop()}),A(!0),b.dataChannel?.close(),b.connection?.close(),M("disconnected"),b.analyserInterval&&clearInterval(b.analyserInterval),b=void 0)}function V(){b&&b.participantFunctions&&Object.keys(b.participantFunctions).forEach(e=>{const{getCurrentAmplitude:t}=b.participantFunctions[Number(e)];if(t){const n=t(),a=b.speaking[e]||0;b.speaking[e]=n,(n>d&&a<=d||n<=d&&a>d)&&P(e)}})}async function E(e){if(!b)return;const{participants:t,conference:n,connection:a,myId:i}=b;if(!(t&&n&&a&&n.ssrcs&&n.transport&&i))return;if(e.find(e=>e.isSelf&&e.source!==b?.conference?.ssrcs?.find(e=>e.isMain&&!e.isVideo)?.sourceGroups[0].sources[0]))return void x();const o=[];if(e.forEach(e=>{if(e.isSelf)return void(e.isMuted&&!e.canSelfUnmute&&(N("audio",!1),N("video",!1),N("presentation",!1)));const{isLeft:t}=e,a=e.isMuted||e.isMutedByMe,i=!e.isVideoJoined||!e.video||t,s=!e.presentation||t;let r=!1,c=!1,l=!1;n.ssrcs.filter(t=>t.userId===e.id).forEach(t=>{t.isVideo||(t.sourceGroups[0].sources[0]===e.source&&(c=!0),t.isRemoved=a),t.isVideo&&(t.isPresentation||(e.video&&t.endpoint===e.video.endpoint&&(r=!0),t.isRemoved=i),t.isPresentation&&(e.presentation&&t.endpoint===e.presentation.endpoint&&(l=!0),t.isRemoved=s))}),a||c||(b.lastMid=b.lastMid+1,n.ssrcs.push({userId:e.id,isMain:!1,endpoint:`audio${e.source}`,isVideo:!1,sourceGroups:[{sources:[e.source]}],mid:b.lastMid.toString()})),i||r||!e.video||(b.lastMid=b.lastMid+1,o.push(e.video.endpoint),n.ssrcs.push({userId:e.id,isMain:!1,endpoint:e.video.endpoint,isVideo:!0,sourceGroups:e.video.sourceGroups,mid:b.lastMid.toString()})),s||l||!e.presentation||(b.lastMid=b.lastMid+1,n.ssrcs.push({isPresentation:!0,userId:e.id,isMain:!1,endpoint:e.presentation.endpoint,isVideo:!0,sourceGroups:e.presentation.sourceGroups,mid:b.lastMid.toString()}))}),b.updatingParticipantsQueue)return void b.updatingParticipantsQueue.push(n);b.updatingParticipantsQueue=[];const s=g(n);await a.setRemoteDescription({type:"offer",sdp:s});try{const e=await a.createAnswer();if(await a.setLocalDescription(e),P(i),b.updatingParticipantsQueue.length>0)for(const e of b.updatingParticipantsQueue){await a.setRemoteDescription({type:"offer",sdp:g(e)});const t=await a.createAnswer();await a.setLocalDescription(t),P(i)}b.updatingParticipantsQueue=void 0}catch(e){console.error(e)}}function F(e){if(!(b&&b.audioElement&&b.audioContext&&b.mediaStream))return;const t=b.conference?.ssrcs?.find(t=>t.endpoint===e.track.id);if(!t||!t.userId)return;const{userId:n,isPresentation:a}=t,i=b.participants?.find(e=>e.id===n),o="video"===e.track.kind?a?"presentation":"video":"audio";e.track.onended=()=>{delete b?.streams?.[n][o],P(n)};const s=e.streams[0];if("audio"===e.track.kind){const{mediaStream:e}=b,t=new window.AudioContext,a=t.createMediaStreamSource(s),o=t.createGain();o.gain.value=(i?.volume||1e4)/1e4;const r=t.createGain();o.gain.value=1;const l=t.createAnalyser();l.minDecibels=-100,l.maxDecibels=-30,l.smoothingTimeConstant=.05,l.fftSize=1024,a.connect(l).connect(r).connect(o).connect(t.destination),e.addTrack(a.mediaStream.getAudioTracks()[0]);const d=new Audio;d.srcObject=s,d.muted=!0,d.remove(),b={...b,participantFunctions:{...b.participantFunctions,[n]:{...b.participantFunctions?.[n],setVolume:e=>{o.gain.value=e>1?2*e:e},toggleMute:e=>{r.gain.value=e?0:1},getCurrentAmplitude:()=>{const e=new Uint8Array(l.frequencyBinCount);return l.getByteFrequencyData(e),c(e,1.5)}}}}}b={...b,streams:{...b.streams,[n]:{...b.streams?.[n],[o]:s}}},P(n)}function D(e,t,n=!1){const a=new RTCPeerConnection,i=n?void 0:function(e){const t=e.createDataChannel("data",{id:0});return t.onopen=()=>{},t.onmessage=e=>{JSON.parse(e.data).colibriClass},t.onerror=e=>{console.log("%conerror","background: green; font-size: 5em"),console.error(e)},t}(a);return e.forEach(e=>e.getTracks().forEach(t=>{a.addTrack(t,e)})),n||(a.oniceconnectionstatechange=()=>{const e=a.iceConnectionState;console.log("iceconnectionstatechange",e),"connected"===e||"completed"===e?M("connected"):"checking"===e||"new"===e?M("connecting"):"disconnected"===a.iceConnectionState&&M("reconnecting")}),a.onconnectionstatechange=()=>{console.log("connectionstatechange",a.connectionState)},a.ontrack=F,a.onnegotiationneeded=async()=>{if(!b)return;console.log("onnegotiationneeded");const{myId:i}=b;if(!i)return;const o=await a.createOffer({offerToReceiveVideo:!0,offerToReceiveAudio:!n});if(console.log("offer created"),await a.setLocalDescription(o),console.log("local desc set"),!o.sdp)return;const s=h(o),r=n?void 0:{userId:"",sourceGroups:[{sources:[s.ssrc||0]}],isRemoved:n,isMain:!0,isVideo:!1,isPresentation:n,endpoint:n?"1":"0",mid:n?"1":"0"},c=s["ssrc-groups"]&&{isPresentation:n,userId:"",sourceGroups:s["ssrc-groups"],isMain:!0,isVideo:!0,endpoint:n?"0":"1",mid:n?"0":"1"},l=n?b.screenshareConference:b.conference,d=[];n?(c&&d.push(c),r&&d.push(r)):(r&&d.push(r),c&&d.push(c));const u=e.find(e=>"audio"===e.getTracks()[0].kind),p=e.find(e=>"video"===e.getTracks()[0].kind);b={...b,...n?{screenshareConference:{...l,ssrcs:d}}:{conference:{...l,ssrcs:d}},streams:{...b.streams,[i]:{...b.streams?.[i],...u&&{audio:u},...!n&&p?{video:p}:{presentation:p}}}},P(i),t(s)},{connection:a,dataChannel:i}}function B(){w?.onUpdate({...w.mediaState,"@type":"updatePhoneCallMediaState"})}function Y(e,t="user"){return"presentation"===e?navigator.mediaDevices.getDisplayMedia({audio:!1,video:!0}):navigator.mediaDevices.getUserMedia({audio:"audio"===e&&{...p&&{echoCancellation:!0},...m&&{noiseSuppression:!0}},video:"video"===e&&{facingMode:t}})}async function G(e,t=void 0){if(!w)return;const n="audio"===e?w.streams.ownAudio:"video"===e?w.streams.ownVideo:w.streams.ownPresentation;if(!n)return;const a=n.getTracks()[0];if(!a)return;const i=w.connection.getSenders().find(e=>a.id===e.track?.id);if(i){t=void 0===t?!a.enabled:t;try{if(t&&!a.enabled){const t=await Y(e);t.getTracks()[0].onended=()=>{G(e,!1)},await i.replaceTrack(t.getTracks()[0]),"audio"===e?w.streams.ownAudio=t:"video"===e?(w.streams.ownVideo=t,w.facingMode="user"):w.streams.ownPresentation=t,"video"!==e&&"presentation"!==e||G("video"===e?"presentation":"video",!1)}else if(!t&&a.enabled){a.stop();const t="audio"===e?w.silence:"video"===e?w.blackVideo:w.blackPresentation;if(!t)return;await i.replaceTrack(t.getTracks()[0]),"audio"===e?w.streams.ownAudio=t:"video"===e?w.streams.ownVideo=t:w.streams.ownPresentation=t}B(),L()}catch(e){console.error(e)}}}function R(){w&&(w.streams.ownVideo?.getTracks().forEach(e=>e.stop()),w.streams.ownPresentation?.getTracks().forEach(e=>e.stop()),w.streams.ownAudio?.getTracks().forEach(e=>e.stop()),w.dataChannel.close(),w.connection.close(),w=void 0)}function L(){if(!w)return;const{emitSignalingData:e,streams:t}=w;e({"@type":"MediaState",videoRotation:0,isMuted:!t.ownAudio?.getTracks()[0].enabled,isBatteryLow:!0,videoState:t.ownVideo?.getTracks()[0].enabled?"active":"inactive",screencastState:t.ownPresentation?.getTracks()[0].enabled?"active":"inactive"})}function O(e){if(!w||w.isOutgoing)return e;const{payloadTypes:t}=e,n=t.findIndex(e=>"VP8"===e.name),a=t[n],i=t.findIndex(e=>Number(e.parameters?.apt)===a.id);return e.payloadTypes=[t[n],t[i]],e}function U(e){if(!w)return;const{emitSignalingData:t}=w;e.ssrc&&e["ssrc-groups"]&&e["ssrc-groups"][0]&&e["ssrc-groups"][1]&&t({"@type":"InitialSetup",fingerprints:e.fingerprints,ufrag:e.ufrag,pwd:e.pwd,audio:{ssrc:r(e.ssrc).toString(),ssrcGroups:[],payloadTypes:e.audioPayloadTypes,rtpExtensions:e.audioExtmap},video:O({ssrc:r(e["ssrc-groups"][0].sources[0]).toString(),ssrcGroups:[{semantics:e["ssrc-groups"][0].semantics,ssrcs:e["ssrc-groups"][0].sources.map(r)}],payloadTypes:e.videoPayloadTypes,rtpExtensions:e.videoExtmap}),screencast:O({ssrc:r(e["ssrc-groups"][1].sources[0]).toString(),ssrcGroups:[{semantics:e["ssrc-groups"][1].semantics,ssrcs:e["ssrc-groups"][1].sources.map(r)}],payloadTypes:e.screencastPayloadTypes,rtpExtensions:e.screencastExtmap})})}async function _(e){if(w&&w.connection)switch(e["@type"]){case"MediaState":w.mediaState=e,B(),L();break;case"Candidates":{const{pendingCandidates:t,gotInitialSetup:n}=w;e.candidates.forEach(e=>{t.push(e.sdpString)}),n&&await $();break}case"InitialSetup":{const{connection:t,isOutgoing:n}=w;if(!t)return;const a={transport:{candidates:[],ufrag:e.ufrag,pwd:e.pwd,fingerprints:e.fingerprints,"rtcp-mux":!1,xmlns:""},sessionId:Date.now(),ssrcs:[e.audio&&{isVideo:!1,isMain:!1,userId:"123",endpoint:"0",mid:"0",sourceGroups:[{sources:[e.audio.ssrc]}]},e.video&&{isVideo:!0,isPresentation:!1,isMain:!1,userId:"123",endpoint:"1",mid:"1",sourceGroups:e.video.ssrcGroups.map(e=>({semantics:e.semantics,sources:e.ssrcs}))},e.screencast&&{isVideo:!0,isPresentation:!0,isMain:!1,userId:"123",endpoint:"2",mid:"2",sourceGroups:e.screencast.ssrcGroups.map(e=>({semantics:e.semantics,sources:e.ssrcs}))}],audioPayloadTypes:e.audio.payloadTypes?.map(l)||[],audioExtensions:e.audio.rtpExtensions,videoPayloadTypes:O(e.video).payloadTypes?.map(l)||[],videoExtensions:e.video.rtpExtensions};if(await t.setRemoteDescription({sdp:g(a,n,void 0,!0),type:n?"answer":"offer"}),w.conference=a,!n){const e=await t.createAnswer();await t.setLocalDescription(e),U(h(t.localDescription,!0))}w.gotInitialSetup=!0,await $();break}}}async function $(){if(!w)return;const{pendingCandidates:e,connection:t}=w;e.length&&(await Promise.all(e.map(e=>async function(e,t){try{await e.addIceCandidate({candidate:t,sdpMLineIndex:0})}catch(e){console.error(e)}}(t,e))),w.pendingCandidates=[])}async function J(e,t){const n=await e.createOffer(t);await e.setLocalDescription(n),U(h(e.localDescription,!0))}var j=n(14487),z=n(4875),K=n(13439),H=n(80840),q=n(32989),W=n(91048),Z=n(71331),Q=n(42347);(0,K.aJ)("leaveGroupCall",async(e,t,n)=>{const{isFromLibrary:i,shouldDiscard:o,shouldRemove:s,rejoin:r,isPageUnload:c,tabId:l=(0,j.g0)()}=n||{},d=(0,Z.iT)(e);d&&(e=(0,H.R6)(e,{connectionState:"disconnected"},d.participantsCount-1),e={...e,groupCalls:{...e.groupCalls,activeGroupCallId:void 0}},(0,K.UF)(e),await(0,z.px)("leaveGroupCall",{call:d,isPageUnload:c}),await(0,z.px)("abortRequestGroup","call"),o&&await(0,z.px)("discardGroupCall",{call:d}),e=(0,K.mS)(),s&&(e=(0,H.um)(e,d.id)),(0,a.ow)(),(0,K.UF)(e),t.toggleGroupCallPanel({force:void 0,tabId:l}),i||x(),t.afterHangUp(),r&&t.requestMasterAndJoinGroupCall({...r,tabId:l}))}),(0,K.aJ)("toggleGroupCallVideo",async e=>{const t=(0,Z.iT)(e),n=(0,W.mBe)(e,e.currentUserId);n&&t&&(await N("video"),await(0,z.px)("editGroupCallParticipant",{call:t,videoStopped:!I("video"),participant:n}))}),(0,K.aJ)("requestToSpeak",(e,t,n)=>{const{value:a}=n||{value:!0},i=(0,Z.iT)(e),o=(0,W.mBe)(e,e.currentUserId);o&&i&&(0,z.px)("editGroupCallParticipant",{call:i,raiseHand:a,participant:o})}),(0,K.aJ)("setGroupCallParticipantVolume",(e,t,n)=>{const{participantId:a,volume:i}=n,s=(0,Z.iT)(e),r=(0,W.mBe)(e,a);r&&s&&(k(a,Math.floor(i/o.CH0)/100),(0,z.px)("editGroupCallParticipant",{call:s,volume:Number(i),participant:r}))}),(0,K.aJ)("toggleGroupCallMute",async(e,t,n)=>{const{participantId:a,value:i}=n||{},o=(0,Z.iT)(e),s=(0,W.mBe)(e,a||e.currentUserId);if(!s||!o)return;const r=void 0===i?I("audio",s.id):i;a?k(a,r?0:1):await N("audio"),await(0,z.px)("editGroupCallParticipant",{call:o,muted:r,participant:s})}),(0,K.aJ)("toggleGroupCallPresentation",async(e,t,n)=>{const a=(0,Z.iT)(e),i=(0,W.mBe)(e,e.currentUserId);if(i&&a){if(void 0!==n?.value?n?.value:!I("presentation")){const e=await async function(){if(b)try{const e=await T("presentation");if(!e)return;return e.getTracks()[0].onended=()=>{b&&b.myId&&(delete b.streams?.[b.myId].presentation,P(b.myId),A())},await new Promise(t=>{const{connection:n,dataChannel:a}=D([e],t,!0);b={...b,screenshareConnection:n,screenshareDataChannel:a}})}catch(e){return}}();if(!e)return;await(0,z.px)("joinGroupCallPresentation",{call:a,params:e})}else await N("presentation",!1),await(0,z.px)("leaveGroupCallPresentation",{call:a});await(0,z.px)("editGroupCallParticipant",{call:a,presentationPaused:!I("presentation"),participant:i})}}),(0,K.aJ)("connectToActiveGroupCall",async(e,t,n)=>{const{tabId:i=(0,j.g0)()}=n||{},o=(0,Z.iT)(e);if(!o)return;if("discarded"===o.connectionState)return void t.showNotification({message:"This voice chat is not active",tabId:i});const s=(0,a.sN)(),r=(0,a.Hc)();if(!s||!r)return;const{currentUserId:c}=e;if(!c)return;const l=await function(e,t,n,a){if(b)throw Error("Already in call");M("connecting");const i=new MediaStream;return n.srcObject=i,(0,y.A)(n),b={onUpdate:a,participants:[],myId:e,speaking:{},silence:f(t),black:v({width:640,height:480}),analyserInterval:setInterval(V,1e3),audioElement:n,audioContext:t,mediaStream:i,lastMid:3},T("audio"),new Promise(e=>{b={...b,...D([b.silence,b.black],e)}})}(c,r,s,t.apiUpdate),d=await(0,z.px)("joinGroupCall",{call:o,params:l,inviteHash:o.inviteHash});if(e=(0,K.mS)(),!d)return t.showNotification({message:"Failed to join voice chat",tabId:i}),void t.leaveGroupCall({tabId:i});if(t.loadMoreGroupCallParticipants(),o.chatId){e=(0,K.mS)();const n=(0,W.hds)(e,o.chatId);if(!n)return;await(0,Q.ad)(e,t,n)}}),(0,K.aJ)("connectToActivePhoneCall",async(e,t)=>{const{phoneCall:n}=e;if(!n)return;const a=(0,Z.uu)(e);if(!a)return;const i=await(0,z.px)("getDhConfig");if(!i)return;await(0,z.px)("createPhoneCallState",[!0]);const o=await(0,z.px)("requestPhoneCall",[i]);await(0,z.px)("requestCall",{user:a,gAHash:o,isVideo:n.isVideo})||"hangUp"in t&&t.hangUp({tabId:(0,j.g0)()})}),(0,K.aJ)("acceptCall",async e=>{const{phoneCall:t}=e;if(!t)return;const n=await(0,z.px)("getDhConfig");if(!n)return;await(0,z.px)("createPhoneCallState",[!1]);const a=await(0,z.px)("acceptPhoneCall",[n]);await(0,z.px)("acceptCall",{call:t,gB:a})}),(0,K.aJ)("sendSignalingData",(e,t,n)=>{const{phoneCall:a}=e;if(!a)return;const i=JSON.stringify(n);(async()=>{const e=await(0,z.px)("encodePhoneCallData",[i]);e&&(0,z.px)("sendSignalingData",{data:e,call:a})})()}),(0,K.aJ)("closeCallRatingModal",(e,t,n)=>{const{tabId:a=(0,j.g0)()}=n||{};return(0,q.w)(e,{ratingPhoneCall:void 0},a)}),(0,K.aJ)("setCallRating",(e,t,n)=>{const{rating:a,comment:i,tabId:o=(0,j.g0)()}=n,{ratingPhoneCall:s}=(0,W.nTw)(e,o);if(s)return(0,z.px)("setCallRating",{call:s,rating:a,comment:i}),(0,q.w)(e,{ratingPhoneCall:void 0},o)}),(0,K.aJ)("hangUp",(e,t,n)=>{const{isPageUnload:a,tabId:i=(0,j.g0)()}=n||{},{phoneCall:o}=e;if(o){if("discarded"===o.state)return(0,z.px)("destroyPhoneCallState"),R(),e={...e,phoneCall:void 0},(0,K.UF)(e),t.toggleGroupCallPanel({force:void 0,tabId:i}),void t.afterHangUp();if((0,z.px)("destroyPhoneCallState"),R(),(0,z.px)("discardCall",{call:o,isPageUnload:a}),"requesting"===o.state)return e={...e,phoneCall:void 0},(0,K.UF)(e),t.toggleGroupCallPanel({force:void 0,tabId:i}),void t.afterHangUp();setTimeout(()=>{e=(0,K.mS)(),e={...e,phoneCall:void 0},(0,K.UF)(e),t.toggleGroupCallPanel({force:void 0,tabId:i}),t.afterHangUp()},500)}});var X=n(87894),ee=n(6e4);const te=new Uint16Array([55357,56841,55357,56845,55357,56859,55357,56877,55357,56881,55357,56865,55357,56846,55357,56884,55357,56885,55357,56840,55357,56876,55357,56839,55357,56847,55357,56430,55357,56439,55357,56450,55357,56438,55357,56424,55357,56425,55357,56436,55357,56437,55357,56891,55357,56893,55357,56896,55357,56442,55357,56904,55357,56905,55357,56906,55357,56448,55357,56445,55357,56489,55357,56613,55357,56485,55357,56484,55357,56386,55357,56384,55357,56387,55357,56389,55357,56388,55357,56397,55357,56398,55357,56396,55357,56394,9996,9995,55357,56400,55357,56390,55357,56391,55357,56393,55357,56392,55357,56911,55357,56399,55357,56490,55357,57014,55356,57283,55357,56451,55357,56427,55357,56426,55357,56428,55357,56429,55357,56453,55356,57257,55357,56401,55357,56402,55357,56415,55357,56414,55357,56416,55357,56405,55357,56407,55357,56406,55357,56409,55357,56412,55357,56403,55356,57216,55357,56452,55357,56475,55357,56473,55357,56476,55357,56474,55357,56461,55357,56462,55357,56374,55357,56378,55357,56369,55357,56365,55357,56377,55357,56368,55357,56376,55357,56367,55357,56360,55357,56379,55357,56375,55357,56366,55357,56343,55357,56372,55357,56337,55357,56344,55357,56380,55357,56359,55357,56357,55357,56340,55357,56333,55357,56354,55357,56347,55357,56349,55357,56348,55357,56350,55357,56332,55357,56345,55357,56346,55357,56351,55357,56364,55357,56331,55357,56336,55357,56330,55357,56363,55356,57152,55356,57145,55356,57147,55356,57153,55356,57150,55356,57156,55356,57141,55356,57140,55356,57139,55356,57118,55356,57114,55356,57113,55356,57102,55356,57099,9889,9748,10052,9924,55356,57088,55356,57096,55356,57098,55356,57235,55356,57222,55356,57219,55357,56443,55356,57221,55356,57220,55356,57217,55356,57224,55357,56622,55356,57253,55357,56567,55357,56511,55357,56507,9742,55357,56545,55357,56570,55357,56571,55357,56585,55357,56596,9203,9200,8986,55357,56594,55357,56593,55357,56590,55357,56481,55357,56614,55357,56588,55357,56587,55357,57023,55357,57021,55357,56615,55357,56616,55357,57002,55357,57004,55357,56483,55357,56619,55357,56618,55357,56458,55357,56457,55357,56496,55357,56501,55357,56499,9993,55357,56555,55357,56550,55357,56517,55357,56513,9986,55357,56524,55357,56526,10002,9999,55357,56528,55357,56538,55357,56620,55357,56621,55356,57256,55356,57260,55356,57252,55356,57255,55356,57269,55356,57273,55356,57275,55356,57274,55356,57272,55357,56446,55356,57262,55356,56527,55356,57266,55356,57263,55356,57288,55356,57280,9917,9918,55356,57278,55356,57265,55356,57289,55356,57267,55356,57281,55356,57287,55356,57286,55356,57290,55356,57284,9749,55356,57212,55356,57210,55356,57207,55356,57204,55356,57173,55356,57172,55356,57183,55356,57175,55356,57201,55356,57178,55356,57180,55356,57185,55356,57203,55356,57182,55356,57193,55356,57190,55356,57218,55356,57200,55356,57194,55356,57195,55356,57197,55356,57199,55356,57166,55356,57167,55356,57162,55356,57163,55356,57170,55356,57159,55356,57161,55356,57171,55356,57169,55356,57164,55356,57168,55356,57165,55356,57158,55356,57157,55356,57149,55356,57313,55356,57317,55356,57318,9962,55356,57328,9978,55356,57325,55357,56827,55357,56829,55356,57248,55356,57249,9970,55356,57250,55357,56994,55357,56996,9875,55357,56960,9992,55357,56961,55357,56962,55357,56971,55357,56974,55357,56972,55357,56985,55357,56983,55357,56981,55357,56987,55357,57e3,55357,56980,55357,56978,55357,56977,55357,57010,55357,56992,55357,56988,55357,56998,9888,55357,56999,9981,55356,57264,55357,56831,55356,57258,55356,57261,55356,56815,55356,56821,55356,56816,55356,56823,55356,56809,55356,56810,55356,56808,55356,56819,55356,56826,55356,56824,55356,56811,55356,56823,55356,56810,55356,56824,55356,56814,55356,56825,55356,56823,55356,56826,55356,56812,55356,56807,49,8419,50,8419,51,8419,52,8419,53,8419,54,8419,55,8419,56,8419,57,8419,48,8419,55357,56607,10071,10067,9829,9830,55357,56495,55357,56599,55357,56625,55357,56628,55357,56629,55357,56630,55357,56631]),ne=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46,48,50,52,54,56,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,87,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,118,120,122,124,126,128,130,132,134,136,138,140,142,144,146,148,150,152,154,156,158,160,162,164,166,168,170,172,174,176,178,180,182,184,186,188,190,192,194,196,198,200,202,204,206,208,210,212,214,216,218,220,222,224,226,228,230,232,234,236,238,240,242,244,246,248,250,252,254,256,258,259,260,261,262,264,266,268,270,272,274,276,278,280,282,284,286,288,290,292,294,295,297,299,301,303,305,306,307,308,310,312,314,316,318,320,322,324,326,328,330,332,334,336,338,340,342,344,346,348,350,351,353,355,357,359,360,362,364,365,366,368,370,372,374,376,378,380,382,384,386,388,390,392,394,396,398,400,402,404,406,407,408,410,412,414,416,418,420,422,424,426,427,429,431,433,435,437,439,441,443,445,447,449,451,453,455,457,459,461,463,465,467,469,471,473,475,477,479,481,483,485,487,489,491,493,495,497,499,501,503,505,507,508,510,511,513,515,517,519,521,522,524,526,528,529,531,532,534,536,538,540,542,544,546,548,550,552,554,556,558,560,562,564,566,567,569,570,572,574,576,578,582,586,590,594,598,602,606,610,614,618,620,622,624,626,628,630,632,634,636,638,640,641,642,643,644,646,648,650,652,654,656,658];(0,K.aJ)("apiUpdate",(e,t,n)=>{const{activeGroupCallId:a}=e.groupCalls;switch(n["@type"]){case"updateGroupCallLeavePresentation":t.toggleGroupCallPresentation({value:!1});break;case"updateGroupCallStreams":if(!n.userId||!a)break;if(!(0,Z.n5)(e,a,n.userId))break;return(0,H.c5)(e,a,n.userId,(0,X.cJ)(n,["@type","userId"]));case"updateGroupCallConnectionState":if(!a)break;if("disconnected"===n.connectionState){"leaveGroupCall"in t&&t.leaveGroupCall({isFromLibrary:!0,tabId:(0,j.g0)()});break}return(0,H.h9)(e,a,{connectionState:n.connectionState,isSpeakerDisabled:n.isSpeakerDisabled});case"updateGroupCallParticipants":{const{groupCallId:e,participants:t}=n;a===e&&E(t);break}case"updateGroupCallConnection":{if(n.data.stream){t.showNotification({message:"Big live streams are not yet supported",tabId:(0,j.g0)()}),"leaveGroupCall"in t&&t.leaveGroupCall({tabId:(0,j.g0)()});break}!async function(e,t){if(!b)return;const n=t?b.screenshareConference:b.conference,a=t?b.screenshareConnection:b.connection;if(!n||!a||!n.ssrcs)return;const i=Date.now(),o={...n,transport:e.transport,sessionId:i,audioExtensions:e.audio?.["rtp-hdrexts"],audioPayloadTypes:e.audio?.["payload-types"],videoExtensions:e.video?.["rtp-hdrexts"],videoPayloadTypes:e.video?.["payload-types"]};b={...b,...t?{screenshareConference:o}:{conference:o}};try{await a.setRemoteDescription({type:"answer",sdp:g(o,!0,t)})}catch(e){console.error(e)}}(n.data,n.presentation);const a=(0,Z.iT)(e);a?.participants&&Object.keys(a.participants).length>0&&E(Object.values(a.participants));break}case"updatePhoneCallMediaState":return{...e,phoneCall:{...e.phoneCall,...(0,X.cJ)(n,["@type"])}};case"updatePhoneCall":{if(!i.OL)return;const{phoneCall:a,currentUserId:s}=e,r={...a,...n.call},c=a?.adminId===s;if(e={...e,phoneCall:r},(0,K.UF)(e),e=(0,K.mS)(),a&&a.id&&r.id!==a.id)return void("discarded"!==r.state&&(0,z.px)("discardCall",{call:r,isBusy:!0}));const{accessHash:l,state:d,connections:u,gB:p}=r;if(("active"===d||"accepted"===d)&&(o=r.protocol,!o?.libraryVersions.some(e=>"4.0.0"===e||"4.0.1"===e))){const n=(0,Z.uu)(e);return"hangUp"in t&&t.hangUp({tabId:(0,j.g0)()}),void t.showNotification({message:ee.yE("VoipPeerIncompatible",n?.firstName),tabId:(0,j.g0)()})}if("discarded"===d){if(!a)return;return(0,q.w)(e,{...r.needRating&&{ratingPhoneCall:r},isCallPanelVisible:void 0},(0,j.g0)())}return"accepted"===d&&l&&p?(async()=>{const{gA:t,keyFingerprint:n,emojis:a}=await(0,z.px)("confirmPhoneCall",[p,te,ne]),i={...(e=(0,K.mS)()).phoneCall,emojis:a};e={...e,phoneCall:i},(0,K.UF)(e),(0,z.px)("confirmCall",{call:r,gA:t,keyFingerprint:n})})():"active"===d&&u&&"active"!==a?.state&&(c||((0,z.px)("receivedCall",{call:r}),(async()=>{const{emojis:t}=await(0,z.px)("confirmPhoneCall",[r.gAOrB,te,ne]),n={...(e=(0,K.mS)()).phoneCall,emojis:t};e={...e,phoneCall:n},(0,K.UF)(e)})()),async function(e,t,n,a,i,o){const s=new RTCPeerConnection({iceServers:e.map(e=>({urls:[e.isTurn&&`turn:${e.ip}:${e.port}`,e.isStun&&`stun:${e.ip}:${e.port}`].filter(Boolean),username:e.username,credentialType:"password",credential:e.password})),iceTransportPolicy:i?"all":"relay",bundlePolicy:"max-bundle",iceCandidatePoolSize:10});s.onicecandidate=e=>{e.candidate&&t({"@type":"Candidates",candidates:[{sdpString:e.candidate.candidate}]})},s.onconnectionstatechange=()=>{o({"@type":"updatePhoneCallConnectionState",connectionState:s.connectionState})},s.ontrack=e=>{if(!w)return;const t=e.streams[0];"audio"===e.track.kind?(w.audio.srcObject=t,w.audio.play().catch(),w.streams.audio=t):"1"===e.transceiver.mid?w.streams.video=t:w.streams.presentation=t,B()},s.oniceconnectionstatechange=async e=>{switch(s.iceConnectionState){case"disconnected":case"failed":n&&await J(s,{offerToReceiveAudio:!0,offerToReceiveVideo:!0,iceRestart:!0})}};const r=f(new AudioContext),c=v({width:640,height:480}),l=v({width:640,height:480});s.addTrack(r.getTracks()[0],r),s.addTrack(c.getTracks()[0],c),s.addTrack(l.getTracks()[0],l);const d=s.createDataChannel("data",{id:0,negotiated:!0});d.onmessage=e=>{_(JSON.parse(e.data))};const u=new Audio;w={audio:u,connection:s,emitSignalingData:t,isOutgoing:n,pendingCandidates:[],onUpdate:o,streams:{ownVideo:c,ownAudio:r,ownPresentation:l},mediaState:{isBatteryLow:!1,screencastState:"inactive",videoState:"inactive",videoRotation:0,isMuted:!0},blackVideo:c,blackPresentation:l,silence:r,dataChannel:d};try{G("audio",!0)}catch(e){console.error(e)}n&&await J(s,{offerToReceiveAudio:!0,offerToReceiveVideo:!0})}(u,t.sendSignalingData,c,Boolean(r?.isVideo),Boolean(r.isP2pAllowed),t.apiUpdate)),e}case"updatePhoneCallConnectionState":{const{connectionState:a}=n;return e.phoneCall?"closed"===a||"disconnected"===a||"failed"===a?void("hangUp"in t&&t.hangUp({tabId:(0,j.g0)()})):{...e,phoneCall:{...e.phoneCall,isConnected:"connected"===a}}:e}case"updatePhoneCallSignalingData":{const{phoneCall:t}=e;if(!t)break;(0,z.px)("decodePhoneCallData",[n.data])?.then(_);break}}var o});var ae=n(84051),ie=n(87357),oe=n(43874),se=n(37661),re=n(5912),ce=n(17712),le=n(59030),de=n(90423),ue=n(73767),pe=n(93545),me=n(64493),he=n(19806),ge=n(12933),fe=n(22337),ve=n(96374),Ce=n(46222),ye=n(4961);function be(e){return Math.floor((e.volume||o.iRY)/o.CH0).toString()}var we=n(10722),Ae=n(21849),Se=n(34431),ke=n(18276),Ie=n(22720),Pe=n(36175),Te=n(672),Ne=n(4438),Me=n(285),xe=n(71429),Ve=n(24433),Ee=n(20021);const Fe=[0,17],De=[17,34],Be=(0,ae.ph)((0,K.EK)(e=>({isAdmin:(0,Z.qI)(e)}))(({participant:e,onCloseAnimationEnd:t,onClose:n,isDropdownOpen:a,isAdmin:i,menuRef:s,...r})=>{const{toggleGroupCallMute:c,setGroupCallParticipantVolume:l,toggleGroupCallPanel:d,openChat:u,requestToSpeak:p}=(0,K.ko)(),m=(0,le.A)(),[h,g,f]=(0,se.A)(),v=e?.id,{isMutedByMe:C,isMuted:y,isSelf:b,canSelfUnmute:w}=e||{},A=Boolean(e?.raiseHandRating),S=!w&&y,[k,I]=(0,ae.J0)(C?0:(e?.volume||o.iRY)/o.CH0),[P,T]=(0,ae.J0)(!1),N=0===k,M=N?Fe:De;(0,ae.vJ)(()=>{a||T(!1)},[a]);const x=(0,ce.A)(e=>{I(e),T(0===e!==N)});(0,ae.vJ)(()=>{I(C?0:(e?.volume||o.iRY)/o.CH0)},[v]);const V=function(e,t,n=[]){return(0,Te.A)(e=>{e()},n,e,t)}(500),E=(0,ce.A)(e=>{e.stopPropagation(),g(),n()}),F=(0,ce.A)(e=>{e.stopPropagation(),p({value:!1}),n()}),D=(0,ce.A)(t=>{t.stopPropagation(),n(),i?S&&x((e?.volume??o.iRY)/o.CH0):x(C?o.iRY/o.CH0:0),c({participantId:v,value:i?!S:!C})}),B=(0,ce.A)(e=>{e.stopPropagation(),d(),u({id:v}),n()});return(0,Ee.FD)("div",{children:[(0,Ee.FD)(xe.A,{isOpen:a,ref:s,withPortal:!0,onClose:n,onCloseAnimationEnd:t,className:"participant-menu with-menu-transitions",...r,children:[!b&&!S&&(0,Ee.Y)("div",{className:"group",children:(0,Ee.FD)("div",{className:(0,ie.A)("volume-control",k<50&&"low",k>=50&&k<100&&"medium",k>=100&&k<150&&"normal",k>=150&&"high"),children:[(0,Ee.Y)("input",{type:"range",min:"0",max:"200",value:k,onChange:e=>{const t=Number(e.target.value);x(t),V(()=>{0===t?c({participantId:v,value:!0}):l({participantId:v,volume:Math.floor(t*o.CH0)})})}}),(0,Ee.FD)("div",{className:"info",children:[(0,Ee.Y)(Ne.A,{tgsUrl:Pe.w.Speaker,play:!!P&&M.toString(),playSegment:M,size:24}),(0,Ee.FD)("span",{children:[k,"%"]})]})]})}),(0,Ee.FD)("div",{className:"group",children:[A&&b&&(0,Ee.Y)(Ve.A,{icon:"stop-raising-hand",onClick:F,children:m("VoipGroupCancelRaiseHand")}),!b&&(0,Ee.Y)(Ve.A,{icon:"user",onClick:B,children:m("VoipGroupOpenProfile")}),!b&&(0,Ee.Y)(Ve.A,{icon:y&&i&&S?"allow-speak":"microphone-alt",onClick:D,children:m(i?S?"VoipGroupAllowToSpeak":"VoipMute":C?"VoipGroupUnmuteForMe":"VoipGroupMuteForMe")}),!b&&i&&(0,Ee.Y)(Ve.A,{icon:"delete-user",destructive:!0,onClick:E,children:m("VoipGroupUserRemove")})]})]}),!b&&i&&(0,Ee.Y)(Me.A,{isOpen:h,userId:v,onClose:f})]})})),Ye=(0,ae.ph)(({participant:e,noColor:t,className:n})=>{const{isMuted:a,isMutedByMe:i}=e,o=(e.amplitude||0)>d,s=Boolean(e.raiseHandRating),r=(0,ue.A)(s),c=!Boolean(e?.canSelfUnmute)&&a,l=(0,ue.A)(a),u=(0,ae.Kr)(()=>a&&!l?[43,64]:!a&&l?[22,42]:s&&!r?[65,84]:!c&&r?[0,21]:a?[22,23]:[43,44],[a,c,s]),p=(0,ae.Kr)(()=>t?"#ffffff":s?"#4da6e0":c||i?"#ff706f":o?"#57bc6c":"#aaaaaa",[t,s,c,i,o]);return(0,Ee.Y)(Ne.A,{tgsUrl:Pe.w.VoiceOutlined,play:u.toString(),playSegment:u,size:28,color:p,className:n,forceAlways:!0,nonInteractive:!0})}),Ge={root:"Wk7JwPx3",subtitle:"ShcCNemD",subtitleText:"UZLgp2cx",icon:"vRc6jhKf",subtitleBlue:"yA7bxEWw",subtitleRed:"DnuZwImI",subtitleGreen:"BkgYQGFq",avatar:"ouHUJ9ff"},Re=(0,ae.ph)((0,K.EK)((e,{participant:t})=>({peer:(0,W.mBe)(e,t.id)||(0,W.hds)(e,t.id)}))(({participant:e,peer:t})=>{const n=(0,ae.li)(),a=(0,ae.li)(),i=(0,le.A)(),{isSelf:s,isMutedByMe:r,isMuted:c,hasVideoStream:l,hasPresentationStream:u}=e,p=(e.amplitude||0)>d,m=Boolean(e.raiseHandRating),{isContextMenuOpen:h,contextMenuAnchor:g,handleContextMenu:f,handleBeforeContextMenu:v,handleContextMenuClose:C,handleContextMenuHide:y}=(0,we.A)(n,s),b=(0,ae.hb)(()=>n.current,[]),w=(0,ae.hb)(()=>n.current.closest(".custom-scroll, .no-scrollbar"),[]),A=(0,ae.hb)(()=>a.current,[]),S=(0,ae.hb)(()=>({withPortal:!0}),[]),k=Boolean(!c&&p&&e.volume&&e.volume!==o.iRY),[I,P]=(0,ae.Kr)(()=>r?[i("VoipGroupMutedForMe"),Ge.subtitleRed]:m?[i("WantsToSpeak"),Ge.subtitleBlue]:k?[i("SpeakingWithVolume",be(e)).replace("%%","%"),Ge.subtitleGreen]:!c&&p?[i("Speaking"),Ge.subtitleGreen]:s?[i("ThisIsYou"),Ge.subtitleBlue]:e.about?[e.about,""]:[i("Listening"),Ge.subtitleBlue],[r,m,k,c,p,s,e,i]);if(t)return(0,Ee.FD)(Ie.A,{leftElement:(0,Ee.Y)(Ae.A,{peer:t,className:Ge.avatar}),rightElement:(0,Ee.Y)(Ye,{participant:e,className:Ge.icon}),className:Ge.root,onClick:f,onMouseDown:v,onContextMenu:f,multiline:!0,ripple:!0,ref:n,children:[(0,Ee.Y)(Se.A,{peer:t,withEmojiStatus:!0,className:Ge.title}),(0,Ee.FD)("span",{className:(0,ie.A)(Ge.subtitle,"subtitle",P),children:[u&&(0,Ee.Y)(ke.A,{name:"share-screen"}),l&&(0,Ee.Y)(ke.A,{name:"video"}),k&&(0,Ee.Y)(ke.A,{name:"speaker"}),(0,Ee.Y)("span",{className:Ge.subtitleText,children:(0,ye.A)(I)})]}),(0,Ee.Y)(Be,{participant:e,isDropdownOpen:h,anchor:g,getTriggerElement:b,getRootElement:w,getMenuElement:A,getLayout:S,onClose:C,onCloseAnimationEnd:y,menuRef:a})]})}));function Le(e,t){return(0,X.zV)(!e.isMuted,!t.isMuted)||(0,X.zV)(e.presentation,t.presentation)||(0,X.zV)(e.video,t.video)||(0,X.zV)(e.raiseHandRating,t.raiseHandRating)}const Oe=(0,ae.ph)((0,K.EK)(e=>{const{participantsCount:t,participants:n}=(0,Z.iT)(e)||{};return{participants:n,participantsCount:t||0}})(({panelOffset:e,participants:t,participantsCount:n,isLandscape:a})=>{const{loadMoreGroupCallParticipants:i}=(0,K.ko)(),o=(0,ae.Kr)(()=>Object.values(t||{}).sort(Le).map(e=>e.id),[t]),s=(0,ce.A)(()=>{i()}),[r,c]=(0,ve.A)(s,o,o.length>=n);return(0,Ee.Y)(Ce.A,{items:r,onLoadMore:c,style:`transform: translateY(${e}px);`,className:(0,ie.A)("npTa6CmI",!a&&"v7oB2HTv"),children:t&&r?.map(e=>t[e]&&(0,Ee.Y)(Re,{teactOrderKey:o.indexOf(e),participant:t[e]},e))})}));var Ue=n(32587),_e=n(66644),$e=n(19822),Je=n(37836),je=n(32625),ze=n(55158);const Ke="eUXuK9Oz",He="O2bTiH2E",qe=(0,ae.ph)((0,K.EK)((e,{participant:t})=>({user:t.isUser?(0,W.mBe)(e,t.id):void 0,chat:t.isUser?void 0:(0,W.hds)(e,t.id)}))(({layout:e,pinnedVideo:t,setPinned:n,canPin:a,className:s,participant:r,user:c,chat:l})=>{const u=(0,le.A)(),p=(0,ae.li)(),m=(0,ae.li)(),h=(0,ae.li)(),{x:g,y:f,width:v,height:C,noAnimate:y,isRemoved:b,type:w}=e,{isSelf:A,isMutedByMe:k,isMuted:I}=r,P=t?.id===r.id&&t?.type===w,T=(r.amplitude||0)>d,N=Boolean(r.raiseHandRating),M="video"===w&&r.isSelf,x=(0,ae.Kr)(()=>A?u("ThisIsYou"):k?u("VoipGroupMutedForMe"):N?u("WantsToSpeak"):I||!T?u("Listening"):r.volume&&r.volume!==o.iRY?u("SpeakingWithVolume",be(r)).replace("%%","%"):u("Speaking"),[A,k,N,I,T,r,u]),V=(0,ae.li)();b||(V.current=e);const{x:E,y:F,width:D,height:B}=V.current||{},[Y,G,R,L]=b?[E,F,D,B]:[g,f,v,C],[O,U]=(0,ae.J0)(!y),_=S(c?.id||l.id),$="video"===w?_?.video:_?.presentation,J=(0,ae.li)($);$?.active&&$?.getVideoTracks()[0].enabled&&(J.current=$);const j=J.current,z=(0,ce.A)(()=>{const e=m.current;e&&(e.srcObject=null)});(0,ae.vJ)(()=>(j?.addEventListener("inactive",z),()=>{j?.removeEventListener("inactive",z)}),[z,j]),(0,ae.vJ)(()=>{U(!1)},[]);const[K,H]=(0,ae.J0)(!0),q=(0,ce.A)(()=>{H(!1)});(0,je.A)(()=>{if(!j?.active)return;const e=m.current,t=h.current;(0,_e.RK)(()=>{t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0,t.width,t.height)})},1e3),(0,ae.vJ)(()=>{const e=m.current,t=p.current;if(!e||!t||!j)return;const n=t.getContext("2d",{alpha:!1});if(!n)return;let a=!0;return(0,_e.RK)(()=>{a&&(t.width=16,t.height=16,n.filter="blur(2px)",(0,$e.i0)(()=>!!a&&!!j.active&&(n.drawImage(e,0,0,e.videoWidth,e.videoHeight,0,0,t.width,t.height),i.QH||(0,Ue.A)(n,0,0,t.width,t.height,2,2),!0),Je.IJ))}),()=>{a=!1}},[j]);const W=(0,ae.li)(),Z=(0,ae.li)(),{isContextMenuOpen:Q,contextMenuAnchor:X,handleContextMenu:ee,handleContextMenuClose:te,handleContextMenuHide:ne}=(0,we.A)(W,A),oe=(0,ae.hb)(()=>W.current,[]),se=(0,ae.hb)(()=>W.current.closest(".custom-scroll, .no-scrollbar"),[]),re=(0,ae.hb)(()=>Z.current,[]),de=(0,ae.hb)(()=>({withPortal:!0}),[]),ue=(0,ae.hb)(()=>{n(P?void 0:{id:c?.id||l.id,type:w})},[l,P,n,w,c?.id]);return(0,Ee.FD)("div",{className:(0,ie.A)("DKuzmnN7",(O||b)&&"T_wodAHA",y&&"yPCkJzpi",s,P&&"B4WZhF9P"),style:`--x: ${Y}px; --y: ${G}px; --width: ${R}px; --height: ${L}px;`,ref:W,onContextMenu:ee,onDoubleClick:a?ue:void 0,children:[(0,Ee.FD)("div",{className:(0,ie.A)("eBq1NoLo",T&&"h4NcT6OS"),children:[K&&(0,Ee.Y)(ze.A,{className:(0,ie.A)(Ke,"XedVWQii")}),j&&(0,Ee.Y)("video",{className:(0,ie.A)(Ke,M&&He),muted:!0,autoPlay:!0,playsInline:!0,srcObject:j,ref:m,onCanPlay:q}),(0,Ee.Y)("canvas",{className:(0,ie.A)("eTpvBU_b eUXuK9Oz",M&&He),ref:h}),(0,Ee.Y)("div",{className:"R5ULTrF9",children:(0,Ee.Y)("canvas",{className:(0,ie.A)("cjUWuViy",M&&He),ref:p})}),a&&(0,Ee.Y)(me.A,{round:!0,size:"smaller",ripple:!0,color:"translucent",className:"lPdblo0y",ariaLabel:u(P?"lng_group_call_context_unpin_camera":"lng_group_call_context_pin_camera"),onClick:ue,iconName:P?"unpin":"pin"}),(0,Ee.FD)("div",{className:"T1deCDSn",children:[(0,Ee.FD)("div",{className:"LzFFayK3",children:[(0,Ee.Y)(Se.A,{peer:c||l,className:"RBwMAuKp"}),(0,Ee.Y)("div",{className:"z1ZZTsjC",children:x})]}),(0,Ee.Y)(Ye,{participant:r,className:"j1aDzn1H",noColor:!0})]})]}),(0,Ee.Y)(Be,{participant:r,isDropdownOpen:Q,anchor:X,getTriggerElement:oe,getRootElement:se,getMenuElement:re,getLayout:de,onClose:te,onCloseAnimationEnd:ne,menuRef:Z})]})})),We=()=>{navigator.vibrate?.(50)};var Ze=n(57474);const Qe=(0,ae.ph)((0,K.EK)(e=>{const t=(0,Z.iT)(e),{connectionState:n}=t||{},a=t&&(0,Z.n5)(e,t.id,e.currentUserId),{raiseHandRating:i,hasAudioStream:o,canSelfUnmute:s,isMuted:r}=a||{};return{connectionState:n||"discarded",hasRequestedToSpeak:Boolean(i),noAudioStream:!o,canSelfUnmute:s,isMuted:r}})(({className:e,noAudioStream:t,canSelfUnmute:n,isMuted:a,connectionState:i})=>{const{toggleGroupCallMute:o,requestToSpeak:s,playGroupCallSound:r}=(0,K.ko)(),c=(0,le.A)(),l=(0,ae.li)("up"),[d,u]=(0,ae.J0)(!1),p="connected"!==i,m=!n&&a,h=(0,ue.A)(m);(0,ae.vJ)(()=>{h&&!m&&r({sound:"allowTalk"})},[r,h,m]);const g=(0,ae.Kr)(()=>{if(d){const e=Math.floor(100*Math.random());return e<32?[0,120]:e<64?[120,240]:e<97?[240,420]:[420,540]}return!h&&m?t?[99,135]:[136,172]:h&&!m?[0,36]:m?[0,0]:t?[69,99]:[36,69]},[h,d,t,m]),f=d?"HandFilled":"VoiceMini",v=(0,ae.hb)(()=>{We(),o()},[o]),C=(0,ae.hb)(()=>{if(m){if(d)return;return We(),s(),u(!0),void setTimeout(()=>{u(!1)},3e3)}l.current="down",t&&setTimeout(()=>{"down"===l.current&&(l.current="hold",v())},200)},[d,t,s,m,v]),y=(0,ae.hb)(()=>{m||(v(),l.current="up")},[m,v]);return(0,Ee.FD)(me.A,{round:!0,size:"default",className:(0,ie.A)("lKdhQ5pw",!p&&t&&"bjKqp3SI",!p&&m&&"Ynow5UuE",e),onMouseDown:C,onMouseUp:y,ariaLabel:c(a?"VoipUnmute":"VoipMute"),disabled:p,children:[(0,Ee.Y)(Ne.A,{tgsUrl:Pe.w[f],size:36,play:g.toString(),playSegment:g,className:"Ea1XnQaX",forceAlways:!0}),(0,Ee.Y)(Ze.A,{className:(0,ie.A)("tyQNJC6B",p&&"LowChABq"),color:"white"})]})})),Xe={root:"OsO5GKfn",panelWrapper:"cUVoePr_",panel:"Thuz79M3",panelScrollTrigger:"zoK6Y6IS",panelHeader:"DMBtCL9Z",scrolled:"GdEH1Agb",fullscreen:"JJx0QI2w",landscape:"wamCuzMB",headerButton:"gmyieSid",firstButton:"hVnn6KBp",lastButton:"iy78A5rG",panelHeaderText:"TwEEA77i",title:"pNZ9skLf",bigger:"NumT3v5i",subtitle:"gmfUKabx",participants:"iTeC_RxH",participantVideos:"PZmKIdTl",addParticipantButton:"clmu2oBt",videos:"ATwoMlAV",mainVideoContainer:"hqFon3dV",videosHeader:"KPHc659W",appFullscreen:"cl2sfoBF",videosHeaderLastButton:"_t50HVNJ",videosContent:"oEEQZilE",actions:"uGzi9s97",actionButton:"foXbVcnN",destructive:"YIR9Z9CZ",canRequestToSpeak:"ZoiZQu_O",muted:"wpvv1V6m",portrait:"R6HQcMwx",noVideoParticipants:"aepCFyJQ",noSidebar:"XjgP21E6"},et=(0,ae.ph)((0,K.EK)((e,{groupCallId:t})=>{const{connectionState:n,title:a,participants:i,participantsCount:o,chatId:s}=(0,Z.Ip)(e,t)||{},r=s?(0,W.hds)(e,s):void 0;return{connectionState:n,title:a||r?.title,participantsCount:o,meParticipant:(0,Z.n5)(e,t,e.currentUserId),isCallPanelVisible:Boolean((0,W.nTw)(e).isCallPanelVisible),isAdmin:(0,Z.qI)(e),participants:i,canInvite:(0,Z.O7)(e)}})(({groupCallId:e,isCallPanelVisible:t,connectionState:n,participantsCount:a,title:i,meParticipant:o,isAdmin:s,participants:r,canInvite:c})=>{const{toggleGroupCallVideo:l,toggleGroupCallPresentation:d,leaveGroupCall:p,toggleGroupCallPanel:m,connectToActiveGroupCall:h,playGroupCallSound:g,createGroupCallInviteLink:f}=(0,K.ko)(),v=(0,le.A)(),C=(0,ae.li)(),y=(0,ae.li)(),b=(0,ae.li)(),w=(0,ae.li)(),A=(0,ae.li)(),[S,k]=(0,ae.J0)(!1),I=!t&&!S,{observe:P}=(0,re.BL)({rootRef:A,throttleMs:200,isDisabled:!I}),T=!(0,re.Vz)(w,I?P:void 0),{isMobile:N,isLandscape:M}=(0,oe.Ay)(),[x,V,E]=(0,se.A)(),[F,D,B]=(0,se.A)(!0),Y=Boolean(x&&M),G=(0,de.zk)(),R=(0,ae.Kr)(()=>Object.values(r).find(({presentation:e})=>e),[r]),L=(0,ae.Kr)(()=>Object.values(r).filter(({video:e,presentation:t})=>e||t).flatMap(({id:e,video:t,presentation:n})=>(0,X.oE)([t?{id:e,type:"video"}:void 0,n?{id:e,type:"screen"}:void 0])),[r]),O=L.length>0,U=i||v("VoipGroupVoiceChat"),_=v("Participants",a,"i"),[$,J,j]=(0,se.A)(),[z,H]=(0,ae.J0)(!1),[q,W]=(0,ae.J0)(!1),Z=o?.hasVideoStream,Q=o?.hasPresentationStream,ee=o?.hasAudioStream,te="connected"!==n,ne=o?.canSelfUnmute,ve=!ne&&!ee;(0,ae.vJ)(()=>{"connected"===n?g({sound:"join"}):"reconnecting"===n&&g({sound:"connecting"})},[n]);const Ce=(0,ce.A)(()=>{j(),H(!1)}),ye=(0,ce.A)(()=>{C.current&&!N&&(x?E():V())}),be=(0,ce.A)(()=>{F?B():D()}),we=(0,ce.A)(()=>{m()}),Ae=(0,ce.A)(()=>{f()}),Se=(0,ce.A)(()=>{l()});(0,ae.vJ)(()=>{h()},[h,e]);const ke=(0,ce.A)(()=>{!s||$?(g({sound:"leave"}),k(!0),j()):J()}),Ie=(0,ce.A)(()=>{S&&p({shouldDiscard:q})}),Pe=(0,ce.A)(()=>{d()}),Te=L.length>1&&!N,Ne=Y&&O,[Me,xe]=(0,ae.J0)(void 0),{videoLayout:Ve,panelOffset:Fe}=function({primaryContainerRef:e,secondaryContainerRef:t,videoParticipants:n,isLandscapeLayout:a,pinnedVideo:i}){const[o,s]=(0,ae.J0)([]),[r,c]=(0,ae.J0)(0),l=n.length,d=(0,ue.A)(l),u=(0,ue.A)(n),p=(0,ae.Kr)(()=>u?.filter(({id:e,type:t})=>!n.some(n=>n.id===e&&n.type===t)),[u,n]),m=(0,ce.A)(()=>{const o=e.current,r=t.current;if(!r)return;const u=void 0!==d&&d>l?d-l:0,{x:m,y:h,width:g}=r.getBoundingClientRect(),f=[];if(void 0!==i||!o||!a){const e=!0;let t,r=!1,d=0,v=n;if(i&&o&&a&&(d=v.findIndex(({id:e,type:t})=>e===i.id&&t===i.type),-1!==d)){const{x:e,y:n,width:a,height:s}=o.getBoundingClientRect(),{id:c,type:l}=i;t={x:e,y:n,width:a,height:s,participantId:c,type:l,orderKey:d},r=!0,v=v.filter(({id:e,type:t})=>e!==c||t!==i.type)}const C=r?l-1:l,y=C%2==1,b=2,w=Math.ceil(C/b),A=(g-10*(b-1))/b,S=Math.max(0,y?240+(w-1)*A+8*(w-1):w*A+8*(w-1));for(let t=0;t<C;t++){const n=y&&0===t,a=n?g:A,i=n?240:A,o=y&&0!==t?t+1:t,s=(e?0:m)+o%b*(a+10),r=(e?0:h)+(y&&0!==t?248+(Math.floor(o/b)-1)*(i+8):Math.floor(o/b)*(i+8));f.push({x:s,y:r,width:a,height:i,shouldRemount:!e,isRemounted:e,noAnimate:!0,participantId:v[t].id,type:v[t].type,orderKey:t>=d?t+1:t})}if(t&&f.splice(d,0,t),p)for(let t=0;t<u;t++)f.push({x:0,y:0,width:0,height:0,isRemounted:e,isRemoved:!0,participantId:p[t].id,type:p[t].type,orderKey:t+l});return c(S),void s(f)}const{x:v,y:C,width:y,height:b}=o.getBoundingClientRect(),w=function(e){return e>=25?5:e>=13?4:e>=7?3:e>=3?2:1}(l),A=Math.ceil(l/w),S=A*w>l,k=(y-10*(w-1))/w,I=(b-8*(A-1))/A,P=k*(l%w);for(let e=0;e<l;e++){const t=Math.floor(e/w),a=v+e%w*(k+10)+(S&&t===A-1?(y-P)/2:0),i=C+Math.floor(e/w)*(I+8);f.push({x:a,y:i,width:k,height:I,participantId:n[e].id,type:n[e].type,orderKey:e})}if(p)for(let e=0;e<u;e++)f.push({x:0,y:0,width:0,height:0,isRemoved:!0,participantId:p[e].id,type:p[e].type,orderKey:e+l});c(0),s(f)});return(0,ae.vJ)(m,[m,n,a,i]),(0,pe.A)(e,m,!e.current),(0,pe.A)(t,m,!t.current),{videoLayout:o,panelOffset:r}}({primaryContainerRef:y,secondaryContainerRef:b,videoParticipants:L,isLandscapeLayout:Y,pinnedVideo:Me}),De=(0,ce.A)(e=>{xe(e),e&&!x&&V()}),Be=(0,ce.A)(()=>{R&&xe({id:R.id,type:"screen"})});return(0,ae.vJ)(Be,[Be,Boolean(R)]),(0,ae.vJ)(()=>{Me&&(L.some(e=>e.type===Me.type&&e.id===Me.id)||xe(void 0))},[Me,Ve,L]),(0,Ee.FD)(fe.A,{isOpen:I,onClose:m,className:(0,ie.A)(Xe.root,(x||N)&&Xe.fullscreen,G&&Xe.appFullscreen,Y&&Xe.landscape,!O&&Xe.noVideoParticipants,!Y&&Xe.portrait,!F&&Ne&&Xe.noSidebar),dialogRef:C,onCloseAnimationEnd:Ie,children:[Ne&&(0,Ee.FD)("div",{className:Xe.videos,children:[(0,Ee.FD)("div",{className:Xe.videosHeader,children:[!N&&(0,Ee.Y)(me.A,{round:!0,size:"smaller",color:"translucent",onClick:ye,className:(0,ie.A)(Xe.headerButton,Xe.firstButton),ariaLabel:v(x?"AccExitFullscreen":"AccSwitchToFullscreen"),iconName:x?"smallscreen":"fullscreen"}),(0,Ee.Y)("h3",{className:(0,ie.A)(Xe.title,Xe.bigger),children:i||v("VoipGroupVoiceChat")}),Ne&&!F&&(0,Ee.Y)(me.A,{round:!0,size:"smaller",color:"translucent",className:(0,ie.A)(Xe.headerButton,Xe.videosHeaderLastButton),onClick:be,ariaLabel:v("AccDescrExpandPanel"),iconName:"sidebar"})]}),(0,Ee.Y)("div",{className:Xe.videosContent,ref:y})]}),(0,Ee.FD)("div",{className:Xe.panelWrapper,ref:A,children:[(0,Ee.FD)("div",{className:(0,ie.A)(Xe.panel,"custom-scroll"),children:[(0,Ee.Y)("div",{className:Xe.panelScrollTrigger,ref:w}),(0,Ee.FD)("div",{className:(0,ie.A)(Xe.panelHeader,T&&Xe.scrolled),children:[!Ne&&!N&&(0,Ee.Y)(me.A,{round:!0,size:"smaller",color:"translucent",ripple:!N,className:(0,ie.A)(Xe.firstButton,Xe.headerButton),onClick:ye,ariaLabel:v("AccSwitchToFullscreen"),iconName:"fullscreen"}),N&&(0,Ee.Y)(me.A,{round:!0,size:"smaller",color:"translucent",onClick:we,className:(0,ie.A)(Xe.headerButton,Xe.firstButton),ariaLabel:v("Close"),iconName:"close"}),Ne&&(0,Ee.Y)(me.A,{round:!0,size:"smaller",ripple:!N,className:(0,ie.A)(Xe.firstButton,Xe.headerButton),color:"translucent",onClick:be,ariaLabel:v("AccDescrCollapsePanel"),iconName:"sidebar"}),(0,Ee.FD)("div",{className:Xe.panelHeaderText,children:[(0,Ee.Y)("h3",{className:(0,ie.A)(Xe.title,Ne&&Xe.bigger),children:Ne?_:U}),!Ne&&(0,Ee.Y)("span",{className:Xe.subtitle,children:_})]}),!Ne&&c&&(0,Ee.Y)(me.A,{round:!0,size:"smaller",ripple:!N,className:(0,ie.A)(Xe.lastButton,Xe.headerButton),color:"translucent",onClick:Ae,ariaLabel:v("VoipGroupInviteMember"),iconName:"add-user"})]}),(0,Ee.FD)("div",{className:Xe.participants,children:[(0,Ee.Y)("div",{className:Xe.participantVideos,ref:b,style:`height: ${Fe}px;`,children:Ve.map(e=>{const t=r[e.participantId];return e.isRemounted&&t?(0,Ee.Y)(qe,{teactOrderKey:e.orderKey,layout:e,canPin:Te,setPinned:De,pinnedVideo:Me,participant:t},`${e.participantId}_${e.type}`):(0,Ee.Y)("div",{teactOrderKey:e.orderKey},`${e.participantId}_${e.type}`)})}),(0,Ee.Y)(Oe,{panelOffset:Fe,isLandscape:Ne})]})]}),(0,Ee.Y)(ge.A,{isShown:Ne&&c,onClick:Ae,className:Xe.addParticipantButton,ariaLabel:v("VoipGroupInviteMember"),iconName:"add-user-filled"},"add-participant")]}),(0,Ee.Y)("div",{className:Xe.mainVideoContainer,children:Ve.map(e=>{const t=r[e.participantId];return e.isRemounted||!t?(0,Ee.Y)("div",{teactOrderKey:e.orderKey},`${e.participantId}_${e.type}`):(0,Ee.Y)(qe,{teactOrderKey:e.orderKey,layout:e,canPin:Te,setPinned:De,pinnedVideo:Me,participant:t,className:Xe.video},`${e.participantId}_${e.type}`)})}),(0,Ee.FD)("div",{className:Xe.actions,children:[(0,Ee.Y)(me.A,{round:!0,size:"default",ripple:!0,className:(0,ie.A)(Xe.actionButton,!ee&&Xe.muted,ve&&Xe.canRequestToSpeak),onClick:Se,ariaLabel:v(Z?"VoipStopVideo":"VoipStartVideo"),disabled:te,iconName:Z?"video":"video-stop"}),(0,Ee.Y)(me.A,{round:!0,size:"default",ripple:!0,className:(0,ie.A)(Xe.actionButton,!ee&&Xe.muted,ve&&Xe.canRequestToSpeak),onClick:Pe,ariaLabel:v(Q?"lng_group_call_screen_share_stop":"lng_group_call_tooltip_screen"),disabled:te||!u,iconName:Q?"share-screen":"share-screen-stop"}),(0,Ee.Y)(Qe,{className:Xe.actionButton}),(0,Ee.Y)(me.A,{round:!0,size:"default",ripple:!0,className:(0,ie.A)(Xe.actionButton,!ee&&Xe.muted,ve&&Xe.canRequestToSpeak),ariaLabel:v("lng_group_call_settings"),disabled:!0,iconName:"settings-filled"}),(0,Ee.Y)(me.A,{round:!0,size:"default",ripple:!0,className:(0,ie.A)(Xe.actionButton,Xe.destructive),onClick:ke,ariaLabel:v("lng_group_call_leave"),iconName:"close"})]}),(0,Ee.FD)(fe.A,{isOpen:$,onClose:Ce,className:"error",title:v(z?"VoipGroupEndAlertTitle":"VoipGroupLeaveAlertTitle"),children:[(0,Ee.Y)("p",{children:v(z?"VoipGroupEndAlertText":"VoipGroupLeaveAlertText")}),!z&&(0,Ee.Y)(he.A,{className:"dialog-checkbox",label:v("VoipGroupEndChat"),checked:q,onCheck:W}),(0,Ee.FD)("div",{className:"dialog-buttons",children:[(0,Ee.Y)(me.A,{isText:!0,className:"confirm-dialog-button",onClick:ke,children:v(z?"VoipGroupEnd":"VoipGroupLeave")}),(0,Ee.Y)(me.A,{isText:!0,className:"confirm-dialog-button",onClick:Ce,children:v("Cancel")})]})]})]})})),tt=(0,ae.ph)((0,K.EK)(e=>{const t=(0,W.nTw)(e);return{groupCall:t.isMasterTab?(0,Z.iT)(e):void 0,isCallPanelVisible:t.isCallPanelVisible,phoneCallUser:t.isMasterTab?(0,Z.uu)(e):void 0}})(({groupCall:e,phoneCallUser:t,isCallPanelVisible:n})=>{const{toggleGroupCallPanel:a}=(0,K.ko)(),i=(0,le.A)();if((0,ae.vJ)(()=>(document.body.classList.toggle("has-call-header",Boolean(n)),window.tauri?.markTitleBarOverlay(!n),()=>{document.body.classList.toggle("has-call-header",!1),window.tauri?.markTitleBarOverlay(!0)}),[n]),e||t)return(0,Ee.Y)("div",{className:(0,ie.A)("ActiveCallHeader",n&&"open"),onClick:function(){a()},children:(0,Ee.Y)("span",{className:"title",children:t?.firstName||e?.title||i("VoipGroupVoiceChat")})})}));var nt=n(17663),at=n(80140),it=n(30857);const ot=(0,ae.ph)(({onClick:e,label:t,customIcon:n,icon:a,iconClassName:i,className:o,isDisabled:s,isActive:r})=>(0,Ee.FD)("div",{className:"lBO3RZUM",children:[(0,Ee.Y)(me.A,{round:!0,className:(0,ie.A)(o,"ch2sqAKW",r&&"OQxlsRp7"),onClick:e,disabled:s,children:n||(0,Ee.Y)(ke.A,{name:a,className:i})}),(0,Ee.Y)("div",{className:"aHguvLcL",children:t})]})),st={root:"GNYRVAUg",blurred:"RBmbMiou","single-column":"O7cZE08z",singleColumn:"O7cZE08z",header:"GI6dY5aJ","close-button":"ULiJZuaP",closeButton:"ULiJZuaP","emojis-backdrop":"RFBKZpjx",emojisBackdrop:"RFBKZpjx",open:"zi1NlOXX",emojis:"DFco1VIN","emoji-tooltip":"MRIShZ3V",emojiTooltip:"MRIShZ3V","user-info":"eaUe2A0c",userInfo:"eaUe2A0c",buttons:"qIeflO02",leave:"hclywYYk",accept:"ln_ZBUHy","accept-icon":"cVRd3twS",acceptIcon:"cVRd3twS","main-video":"bGlBFSJq",mainVideo:"bGlBFSJq","second-video":"TOFu1n5x",secondVideo:"TOFu1n5x",visible:"LOnSFN9w",fullscreen:"Omg5T1o6"},rt=(0,ae.ph)((0,K.EK)(e=>{const{phoneCall:t,currentUserId:n}=e,{isCallPanelVisible:a,isMasterTab:i}=(0,W.nTw)(e),o=(0,Z.uu)(e);return{isCallPanelVisible:Boolean(a),user:o,isOutgoing:t?.adminId===n,phoneCall:i?t:void 0}})(({user:e,isOutgoing:t,phoneCall:n,isCallPanelVisible:a})=>{const o=(0,le.A)(),{hangUp:s,requestMasterAndAcceptCall:r,playGroupCallSound:c,toggleGroupCallPanel:l,connectToActivePhoneCall:d}=(0,K.ko)(),p=(0,ae.li)(),[m,h,g]=(0,se.A)(),{isMobile:f}=(0,oe.Ay)(),v=(0,ae.hb)(()=>{m?g():h()},[g,m,h]),C=(0,ae.hb)(()=>{p.current&&(m?document.exitFullscreen().then(g):p.current.requestFullscreen().then(h))},[g,m,h]);(0,ae.vJ)(()=>{if(!i.SC)return;const e=p.current;return e?(e.addEventListener("fullscreenchange",v),()=>{e.removeEventListener("fullscreenchange",v)}):void 0},[v]);const y=(0,ae.hb)(()=>{l(),m&&g()},[g,m,l]),b="discarded"===n?.state,A="busy"===n?.reason,S="requested"===n?.state&&!t,k=("requested"===n?.state||"waiting"===n?.state)&&t,I="active"===n?.state,P=n?.isConnected,[T,N,M]=(0,se.A)(),x=(0,ae.hb)(()=>{N(),s()},[s,N]);(0,ae.vJ)(()=>{T?c({sound:"end"}):S?c({sound:"incoming"}):A?c({sound:"busy"}):b?c({sound:"end"}):k?c({sound:"ringing"}):P&&c({sound:"connect"})},[A,b,S,k,P,c,T]),(0,ae.vJ)(()=>{n?.id?M():d()},[d,n?.id,M]);const V=(0,it.A)();(0,je.A)(V,P?1e3:void 0);const E=(0,ae.Kr)(()=>{const e=n?.state;return T?o("lng_call_status_hanging"):A?"busy":"requesting"===e?o("lng_call_status_requesting"):"requested"===e?o(t?"lng_call_status_ringing":"lng_call_status_incoming"):"waiting"===e?o("lng_call_status_waiting"):"active"===e&&P?void 0:o("lng_call_status_exchanging")},[A,P,T,t,o,n?.state]),F="active"===n?.videoState,D="active"===n?.screencastState,R=w?.streams,L=R?.ownAudio?.getTracks()[0].enabled,O=R?.ownPresentation?.getTracks()[0].enabled,U=R?.ownVideo?.getTracks()[0].enabled,[_,$,J]=(0,se.A)(),[j,z,H]=(0,se.A)(),q=(0,ae.hb)(()=>{O&&$(),U&&z(),setTimeout(async()=>{await G("presentation"),J(),H()},250)},[O,U,$,z,J,H]),W=(0,ae.hb)(()=>{U&&z(),O&&$(),setTimeout(async()=>{await G("video"),J(),H()},250)},[O,U,$,z,J,H]),Z=(0,ae.hb)(()=>{G("audio")},[]),[Q,X,ee]=(0,se.A)(),[te,ne,re]=(0,se.A)(),ce=(0,ae.hb)(()=>{ne(),async function(){if(!w||!w.facingMode)return;const e=w.streams.ownVideo;if(!e)return;const t=e.getTracks()[0];if(!t)return;const n=w.connection.getSenders().find(e=>t.id===e.track?.id);if(n){w.facingMode="environment"===w.facingMode?"user":"environment";try{const e=await Y("video",w.facingMode);await n.replaceTrack(e.getTracks()[0]),w.streams.ownVideo=e,B()}catch(e){}}}(),setTimeout(re,250)},[ne,re]),de=n?.startDate&&(0,at.Fm)()-n.startDate;return(0,ae.vJ)(()=>{"discarded"===n?.state&&setTimeout(s,250)},[s,n?.reason,n?.state]),(0,Ee.FD)(fe.A,{isOpen:n&&"discarded"!==n?.state&&!a,onClose:y,className:(0,ie.A)(st.root,f&&st.singleColumn),dialogRef:p,children:[(0,Ee.Y)(Ae.A,{peer:e,size:"jumbo",className:F||D?st.blurred:""}),"active"===n?.screencastState&&R?.presentation&&(0,Ee.Y)("video",{className:st.mainVideo,muted:!0,autoPlay:!0,playsInline:!0,srcObject:R.presentation}),"active"===n?.videoState&&R?.video&&(0,Ee.Y)("video",{className:st.mainVideo,muted:!0,autoPlay:!0,playsInline:!0,srcObject:R.video}),(0,Ee.Y)("video",{className:(0,ie.A)(st.secondVideo,!_&&O&&st.visible,m&&st.fullscreen),muted:!0,autoPlay:!0,playsInline:!0,srcObject:R?.ownPresentation}),(0,Ee.Y)("video",{className:(0,ie.A)(st.secondVideo,!j&&U&&st.visible,m&&st.fullscreen),muted:!0,autoPlay:!0,playsInline:!0,srcObject:R?.ownVideo}),(0,Ee.FD)("div",{className:st.header,children:[i.SC&&(0,Ee.Y)(me.A,{round:!0,size:"smaller",color:"translucent",iconName:m?"smallscreen":"fullscreen",onClick:C,ariaLabel:o(m?"AccExitFullscreen":"AccSwitchToFullscreen")}),(0,Ee.Y)(me.A,{round:!0,size:"smaller",color:"translucent",iconName:"close",onClick:y,className:st.closeButton})]}),(0,Ee.FD)("div",{className:(0,ie.A)(st.emojisBackdrop,Q&&st.open),onClick:Q?ee:X,children:[(0,Ee.Y)("div",{className:(0,ie.A)(st.emojis,Q&&st.open),children:n?.isConnected&&n?.emojis&&(0,ye.A)(n.emojis,["emoji"])}),(0,Ee.Y)("div",{className:(0,ie.A)(st.emojiTooltip,Q&&st.open),children:o("CallEmojiKeyTooltip",e?.firstName).replace("%%","%")})]}),(0,Ee.FD)("div",{className:st.userInfo,children:[(0,Ee.Y)("h1",{children:e?.firstName}),(0,Ee.Y)("span",{className:st.status,children:E||(0,nt.QO)(de||0)})]}),(0,Ee.FD)("div",{className:st.buttons,children:[(0,Ee.Y)(ot,{onClick:Z,icon:"microphone",isDisabled:!I,isActive:L,label:o(L?"lng_call_mute_audio":"lng_call_unmute_audio")}),(0,Ee.Y)(ot,{onClick:W,icon:"video",isDisabled:!I,isActive:U,label:o(U?"lng_call_stop_video":"lng_call_start_video")}),U&&(i.Ni||i.pz)&&(0,Ee.Y)(ot,{onClick:ce,customIcon:(0,Ee.Y)(Ne.A,{tgsUrl:Pe.w.CameraFlip,playSegment:te?[0,10]:[0,1],size:32}),isDisabled:!I,label:o("VoipFlip")}),u&&(0,Ee.Y)(ot,{onClick:q,icon:"share-screen",isDisabled:!I,isActive:O,label:o("lng_call_screencast")}),S&&(0,Ee.Y)(ot,{onClick:r,icon:"phone-discard",isDisabled:b,label:o("lng_call_accept"),className:st.accept,iconClassName:st.acceptIcon}),(0,Ee.Y)(ot,{onClick:x,icon:"phone-discard",isDisabled:b,label:o(S?"lng_call_decline":"lng_call_end_call"),className:st.leave})]})]})}));var ct=n(40664);const lt=(0,ae.ph)(({isOpen:e})=>{const{closeCallRatingModal:t,setCallRating:n}=(0,K.ko)(),a=(0,ae.li)(),i=(0,le.A)(),[o,s]=(0,ae.J0)(),r=(0,ae.hb)(()=>{o?n({rating:o+1,comment:a.current?.value||""}):t()},[t,o,n]),c=(0,ae.hb)(()=>{t()},[t]);return(0,Ee.FD)(fe.A,{title:i("lng_call_rate_label"),className:"narrow",onClose:t,isOpen:e,children:[(0,Ee.Y)("div",{className:"P7EfDKJN",children:new Array(5).fill(void 0).map((e,t)=>{const n=void 0!==o&&o>=t;return(0,Ee.Y)(ke.A,{name:n?"favorite-filled":"favorite",className:(0,ie.A)(n&&"_XX6q8YW","t8LJLFSN"),onClick:(a=t,()=>s(o===a?void 0:a))});var a})}),(0,Ee.Y)(ct.A,{ref:a,placeholder:i("lng_call_rate_comment"),className:(0,ie.A)("EvL0WaKD",4!==o&&void 0!==o&&"v5hn1XvT")}),(0,Ee.FD)("div",{className:"dialog-buttons mt-2",children:[(0,Ee.Y)(me.A,{className:"confirm-dialog-button",isText:!0,onClick:r,children:i("Send")}),(0,Ee.Y)(me.A,{className:"confirm-dialog-button",isText:!0,onClick:c,children:i("Cancel")})]})]})});(i.Yw||i.pz)&&document.addEventListener("click",a.cw,{once:!0})},90423:(e,t,n)=>{n.d(t,{Ay:()=>r,j9:()=>d,zk:()=>c});var a=n(84051),i=n(63495),o=n(96454);const s=l();function r(e,t,n){const[i,r]=(0,a.J0)(Boolean(s&&document[s]));return(0,a.Nf)(()=>{const a=e.current,i=()=>{const e=Boolean(s&&document[s]);r(e),e?n?.(!1):t?.(!1),a instanceof HTMLVideoElement&&(a.controls=e)},o=()=>{r(!0),n&&n(!0)},c=()=>{r(!1),t&&t(!1)};return document.addEventListener("fullscreenchange",i,!1),document.addEventListener("webkitfullscreenchange",i,!1),document.addEventListener("mozfullscreenchange",i,!1),a&&(a.addEventListener("webkitbeginfullscreen",o,!1),a.addEventListener("webkitendfullscreen",c,!1)),()=>{document.removeEventListener("fullscreenchange",i,!1),document.removeEventListener("webkitfullscreenchange",i,!1),document.removeEventListener("mozfullscreenchange",i,!1),a&&(a.removeEventListener("webkitbeginfullscreen",o,!1),a.removeEventListener("webkitendfullscreen",c,!1))}},[]),s||o.pz?[i,()=>{var t;e.current&&(s||o.pz)&&!i&&((t=e.current).requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.webkitEnterFullscreen?t.webkitEnterFullscreen():t.mozRequestFullScreen&&t.mozRequestFullScreen(),r(!0))},()=>{e.current&&(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),r(!1))}]:[!1]}const c=()=>{const[e,t]=(0,a.J0)(!1);return(0,a.vJ)(()=>{const e=()=>{t(d())};let n;return i.Vq&&(window.tauri?.getCurrentWindow().then(e=>{e.isFullscreen().then(t)}),(async()=>{const e=await(window.tauri?.getCurrentWindow());n=await e.onResized(()=>{e.isFullscreen().then(t)})})()),document.addEventListener("fullscreenchange",e,!1),document.addEventListener("webkitfullscreenchange",e,!1),document.addEventListener("mozfullscreenchange",e,!1),()=>{n?.(),document.removeEventListener("fullscreenchange",e,!1),document.removeEventListener("webkitfullscreenchange",e,!1),document.removeEventListener("mozfullscreenchange",e,!1)}},[]),e};function l(){return void 0!==document.fullscreenElement?"fullscreenElement":void 0!==document.mozFullScreenElement?"mozFullScreenElement":void 0!==document.webkitFullscreenElement?"webkitFullscreenElement":""}function d(){const e=l();return Boolean(e&&document[e])}}}]);
//# sourceMappingURL=2394.6428afac50505701e978.js.map