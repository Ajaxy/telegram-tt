"use strict";(self.webpackChunktelegram_t=self.webpackChunktelegram_t||[]).push([[2859],{12859:(t,e,a)=>{a.d(e,{Hc:()=>S,JD:()=>w,cw:()=>y,ow:()=>x,re:()=>M,sN:()=>A});var s=a(66644),i=a(96454),o=a(85982),d=a(14487),n=a(87894),r=a(6e4),c=a(41733),l=a(4875),h=a(90709),u=a(13439),I=a(80840),p=a(32989),m=a(91048),g=a(71331),f=a(42347);const b="data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQsRbAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/zQMSkAAADSAAAAABVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV";let C,V,v;function y(){return w(),Promise.all(Object.values(v).map(t=>{const e=t.src;return t.src=b,t.muted=!0,t.volume=1e-4,t.play().then(()=>{t.pause(),t.volume=1,t.currentTime=0,t.muted=!1,(0,s.Uz)(()=>{t.src=e})})}))}function w(){if(v)return;const t=new Audio("./voicechat_join.mp3"),e=new Audio("./voicechat_connecting.mp3");e.loop=!0;const a=new Audio("./voicechat_leave.mp3"),s=new Audio("./voicechat_onallowtalk.mp3"),i=new Audio("./call_busy.mp3"),o=new Audio("./call_connect.mp3"),d=new Audio("./call_end.mp3"),n=new Audio("./call_incoming.mp3");n.loop=!0;const r=new Audio("./call_ringing.mp3");r.loop=!0,v={join:t,allowTalk:s,leave:a,connecting:e,incoming:n,end:d,connect:o,busy:i,ringing:r}}(0,u.aJ)("toggleGroupCallPanel",(t,e,a)=>{const{force:s,tabId:i=(0,d.g0)()}=a||{};return(0,p.w)(t,{isCallPanelVisible:"force"in(a||{})?s:!(0,m.nTw)(t,i).isCallPanelVisible},i)}),(0,u.aJ)("createGroupCall",async(t,e,a)=>{const{chatId:s,tabId:i=(0,d.g0)()}=a,o=(0,m.hds)(t,s);if(!o)return;const n=await(0,l.px)("createGroupCall",{peer:o});n&&(t=(0,u.mS)(),t=(0,I.h9)(t,n.id,{...n,chatId:s}),(0,u.UF)(t),e.requestMasterAndJoinGroupCall({id:n.id,accessHash:n.accessHash,tabId:i}))}),(0,u.aJ)("createGroupCallInviteLink",async(t,e,a)=>{const{tabId:s=(0,d.g0)()}=a||{},i=(0,g.iT)(t);if(!i||!i.chatId)return;const n=(0,m.hds)(t,i.chatId);if(!n)return;const r=Boolean((0,h.Kl)(n));let c=(0,m.AWZ)(t,n.id)?.inviteLink;r&&(c=await(0,l.px)("exportGroupCallInvite",{call:i,canSelfUnmute:!1})),c&&((0,o.eM)(c),e.showNotification({message:{key:"LinkCopied"},tabId:s}))}),(0,u.aJ)("joinVoiceChatByLink",async(t,e,a)=>{const{username:s,inviteHash:i,tabId:o=(0,d.g0)()}=a,n=await(0,f.A$)(t,s);if(!n)return void e.showNotification({message:r.yE("NoUsernameFound"),tabId:o});t=(0,u.mS)();const c=await(0,f.ad)(t,e,n);c?.groupCall&&e.requestMasterAndJoinGroupCall({id:c.groupCall.id,accessHash:c.groupCall.accessHash,inviteHash:i,tabId:o})}),(0,u.aJ)("requestMasterAndJoinGroupCall",(t,e,a)=>{e.requestMasterAndCallAction({action:"joinGroupCall",payload:a,tabId:a.tabId||(0,d.g0)()})}),(0,u.aJ)("requestMasterAndAcceptCall",(t,e,a)=>{e.requestMasterAndCallAction({action:"acceptCall",payload:void 0,tabId:a?.tabId||(0,d.g0)()})}),(0,u.aJ)("joinGroupCall",async(t,e,a)=>{const{chatId:s,id:o,accessHash:r,inviteHash:h,tabId:p=(0,d.g0)()}=a;if(!i.OL)return void e.showNotification({message:"Sorry, your browser doesn't support group calls",tabId:p});if(t.phoneCall)return void e.toggleGroupCallPanel({tabId:p});!function(){const t=new(window.AudioContext||window.webkitAudioContext);C=new Audio,V=t,C.srcObject=F(t),(0,c.A)(C)}(),w(),M(t=(0,u.mS)(),e,!0,p);const{groupCalls:{activeGroupCallId:b}}=t;let v=o?(0,g.Ip)(t,o):(0,g.mD)(t,s);if(v&&v.id===b)e.toggleGroupCallPanel({tabId:p});else if(b)"leaveGroupCall"in e&&e.leaveGroupCall({rejoin:a,tabId:p});else if(v&&b===v.id)e.toggleGroupCallPanel({tabId:p});else{if(v||o&&r||!s)!v&&o&&r&&(v=await async function(t,e){if((0,m.trm)(t))return;const a=await(0,l.px)("getGroupCall",{call:e});if(!a)return;t=(0,u.mS)();const s=(0,g.Ip)(t,e.id);return t=(0,I.h9)(t,e.id,(0,n.cJ)(a.groupCall,["connectionState"]),void 0,s?.isLoaded?void 0:a.groupCall.participantsCount),(0,u.UF)(t),a.groupCall}(t,{id:o,accessHash:r}));else{const a=(0,m.hds)(t,s);if(!a)return;await(0,f.ad)(t,e,a),t=(0,u.mS)(),v=(0,g.mD)(t,s)}v&&(t=(0,u.mS)(),t=(0,I.h9)(t,v.id,{...v,inviteHash:h},void 0,v.participantsCount+1),t={...t,groupCalls:{...t.groupCalls,activeGroupCallId:v.id}},(0,u.UF)(t),e.toggleGroupCallPanel({force:!1,tabId:p}))}}),(0,u.aJ)("playGroupCallSound",(t,e,a)=>{const{sound:s}=a;v?.[s]&&("connecting"!==s&&v.connecting.pause(),"incoming"!==s&&v.incoming.pause(),"ringing"!==s&&v.ringing.pause(),(0,c.A)(v[s]))}),(0,u.aJ)("loadMoreGroupCallParticipants",t=>{const e=(0,g.iT)(t);e&&function(t,e){(0,l.px)("fetchGroupCallParticipants",{call:t,offset:e})}(e,e.nextOffset)}),(0,u.aJ)("requestMasterAndRequestCall",(t,e,a)=>{e.requestMasterAndCallAction({action:"requestCall",payload:a,tabId:a.tabId||(0,d.g0)()})}),(0,u.aJ)("requestCall",(t,e,a)=>{const{userId:s,isVideo:i,tabId:o=(0,d.g0)()}=a;t.phoneCall?e.toggleGroupCallPanel({tabId:o}):(0,m.mBe)(t,s)&&(w(),M(t=(0,u.mS)(),e,i,o),t=(0,u.mS)(),t={...t,phoneCall:{id:"",state:"requesting",participantId:s,isVideo:i,adminId:t.currentUserId}},(0,u.UF)(t),e.toggleGroupCallPanel({force:!1,tabId:o}))});const F=t=>{const e=t.createOscillator(),a=e.connect(t.createMediaStreamDestination());return e.start(),new MediaStream([Object.assign(a.stream.getAudioTracks()[0],{enabled:!1})])};function A(){return C}function S(){return V}function x(){C?.pause(),V=void 0,C=void 0}function M(t,e,a,...[s=(0,d.g0)()]){a?navigator.mediaDevices.getUserMedia({video:!0}).then(t=>{0===t.getVideoTracks().length?e.showNotification({message:r.yE("Call.Camera.Error"),tabId:s}):(t.getTracks().forEach(t=>t.stop()),T(0,e,s))}).catch(()=>{e.showNotification({message:r.yE("Call.Camera.Error"),tabId:s})}):T(0,e,s)}function T(t,e,...[a=(0,d.g0)()]){navigator.mediaDevices.getUserMedia({audio:!0}).then(t=>{0===t.getAudioTracks().length?e.showNotification({message:r.yE("RequestAcces.Error.HaveNotAccess.Call"),tabId:a}):t.getTracks().forEach(t=>t.stop())}).catch(()=>{e.showNotification({message:r.yE("RequestAcces.Error.HaveNotAccess.Call"),tabId:a})})}},42347:(t,e,a)=>{a.d(e,{A$:()=>k,Jm:()=>D,ad:()=>J});var s=a(23174),i=a(89925),o=a(31481),d=a(85982),n=a(55148),r=a(46275),c=a(48899),l=a(14487),h=a(49763),u=a(87894),I=a(60343),p=a(6e4),m=a(37836),g=a(59852),f=a(4875),b=a(90709),C=a(13439),V=a(27336),v=a(80840),y=a(32989),w=a(91048),F=a(71331),A=a(64520);const S=new Set(["FILTERS_TOO_MUCH","CHATLISTS_TOO_MUCH","INVITES_TOO_MUCH"]),x=(0,m.nF)(t=>t(),3e3,!0),M=(0,m.sg)(t=>t(),500,!1,!0);function T(t,e){(0,f.px)("abortChatRequests",{chatId:t,threadId:e})}function P(t,e,a,...[s=(0,l.g0)()]){const i=(0,w.Xf0)(t,s),o=i?.chatId,d=i?.threadId;if(o&&(o!==e||d!==a)){const[a,i]=Object.values(t.byTabId).reduce(([e,a],{id:i})=>{if(i===s||e&&a)return[e,a];const n=(0,w.Xf0)(t,i),r=n?.chatId===o;return[e||r,a||r&&n?.threadId===d]},[o===e,!1]);(!a||!i)&&T(o,a?d:void 0)}}async function U(t,e,a){let i=(0,C.mS)(),d=(0,w.xzS)(i)?.id;const n=a?{}:(0,w.$TA)(i,t),r=n.nextOffsetPeerId?(0,w.PVB)(i,n.nextOffsetPeerId):void 0,c=n.nextOffsetDate,l=n.nextOffsetId,h=!(a||r||c||l),I="active"===t&&h,p=(0,w.trm)(i),m="saved"===t?await(0,f.px)("fetchSavedChats",{limit:o.uCr,offsetDate:c,offsetId:l,offsetPeer:r,withPinned:h&&!p}):await(0,f.px)("fetchChats",{limit:o.uCr,offsetDate:c,offsetId:l,offsetPeer:r,archived:"archived"===t,withPinned:h&&!p,lastLocalServiceMessageId:d});if(!m)return;const{chatIds:g}=m;i=(0,C.mS)(),d=(0,w.xzS)(i)?.id;const b=(0,u.dU)(m.chats,"id");i=(0,V.CKT)(i,(0,u.dU)(m.users,"id")),i=(0,V.h7P)(i,b),i=h?(0,V.hOQ)(i,t,g):(0,V.ec2)(i,t,g),I?(i=(0,V.wWy)(i,m.userStatusesById),i=(0,V.GEE)(i,m.notifyExceptionById)):(i=(0,V.d2X)(i,m.userStatusesById),i=(0,V.DeY)(i,m.notifyExceptionById)),i=(0,V.qwk)(i,t,m),i=(0,V.tTf)(i,m.messages),i=(0,V.XUr)(i,m.lastMessageByChatId,t),a||(i=(0,V.tPq)(i,t,m.nextOffsetId,m.nextOffsetPeerId,m.nextOffsetDate)),("active"===t||"archived"===t)&&(e?m.chatIds:Object.keys(m.draftsById)).forEach(t=>{const e=m.draftsById[t],a=(0,w.$jd)(i,t,s.l3);(e||a)&&((0,w.GA4)(i,t,s.l3)?.isLocal||(i=(0,V.eww)(i,t,s.l3,"draft",e)))}),0!==g.length&&g.length!==m.totalChatCount||i.chats.isFullyLoaded[t]||(i={...i,chats:{...i.chats,isFullyLoaded:{...i.chats.isFullyLoaded,[t]:!0}}}),(0,C.UF)(i)}async function J(t,e,a){if((0,w.trm)(t))return;const s=await(0,f.px)("fetchFullChat",a);if(!s)return;const{chats:i,userStatusesById:o,fullInfo:d,groupCall:n,membersCount:r,isForumAsMessages:c}=s;if(t=(0,C.mS)(),t=(0,V.h7P)(t,(0,u.dU)(i,"id")),o&&(t=(0,V.d2X)(t,o)),n){const e=(0,F.Ip)(t,n.id);t=(0,v.h9)(t,n.id,(0,u.cJ)(n,["connectionState","isLoaded"]),void 0,e?void 0:n.participantsCount)}void 0!==r&&(t=(0,V.wix)(t,a.id,{membersCount:r})),a.isForum&&(t=(0,V.wix)(t,a.id,{isForumAsMessages:c})),t=(0,V.iW2)(t,a.id,d),(0,C.UF)(t);const l=d.stickerSet,h=l&&(0,w.ycM)(t,l);l&&!h&&e.loadStickers({stickerSetInfo:{id:l.id,accessHash:l.accessHash}});const I=d.emojiSet,p=I&&(0,w.ycM)(t,I);return I&&!p&&e.loadStickers({stickerSetInfo:{id:I.id,accessHash:I.accessHash}}),s}async function k(t,e,a){t=(0,C.mS)();const s=a?void 0:(0,w.qn$)(t,e);if(s&&!s.isMin)return s;const{chat:i,user:o}=await(0,f.px)("getChatByUsername",e,a)||{};return i?(t=(0,C.mS)(),t=(0,V.wix)(t,i.id,i),o&&(t=(0,V.TKu)(t,o.id,o)),(0,C.UF)(t),i):void 0}async function B(t,e,a,...[s=(0,l.g0)()]){const i=await k(t,a);if(!i)return;t=(0,C.mS)();const o=(0,w.mBe)(t,i.id);if(!o)return;if(!(0,b.tv)(o))return;const d=await(0,f.px)("loadAttachBot",{bot:o});if(t=(0,C.mS)(),d)return(0,C.UF)(t),d.bot;e.showNotification({message:p.yE("WebApp.AddToAttachmentUnavailableError"),tabId:s})}async function R(t,e,a,i,...[o=(0,l.g0)()]){const{isCurrentChat:d,threadId:n,messageId:r,startParam:c,referrer:h,startAttach:u,attach:I,text:p,timestamp:m,linkContext:g}=i;if(r){let s=!1;if(a.isForum&&!n){let i=(0,w.pSx)(t,a.id)?.[r];if(!i){const t=await(0,f.px)("fetchTopicById",{chat:a,topicId:r});i=t?.topic}i&&(e.openThread({chatId:a.id,threadId:i.id,tabId:o}),s=!0)}s||e.focusMessage({chatId:a.id,threadId:n,messageId:r,timestamp:m,tabId:o,replyMessageId:g?.messageId})}else d||e.openThread({chatId:a.id,threadId:n??s.l3,tabId:o});c&&!h&&e.startBot({botId:a.id,param:c}),I&&E(t=(0,C.mS)(),e,a.id,I,u,o),p&&e.openChatWithDraft({chatId:a.id,text:{text:p},tabId:o}),r&&m&&e.openMediaFromTimestamp({chatId:a.id,threadId:n,messageId:r,timestamp:m,tabId:o})}async function E(t,e,a,s,i,...[o=(0,l.g0)()]){t=(0,C.mS)();const d=await B(t,e,s,o);d&&e.callAttachBot({bot:d,chatId:a,..."string"==typeof i&&{startParam:i},tabId:o})}async function D(t,e,a,...[s=(0,l.g0)()]){const i=(0,w.hds)(t,a);if(!i||!(0,b.yn)(i))return i;const o=await async function(t,e,a,...[s=(0,l.g0)()]){try{return await(0,f.px)("migrateChat",a)}catch(t){return void("CHANNELS_TOO_MUCH"===t.message?e.openLimitReachedModal({limit:"channels",tabId:s}):e.showDialog({data:{...t,hasErrorKey:!0},tabId:s}))}}(0,e,i,s);return o?(e.loadFullChat({chatId:o.id}),e.openChat({id:o.id,tabId:s}),o):void 0}(0,C.aJ)("preloadTopChatMessages",async(t,e)=>{const a=new Set;for(let i=0;i<o.irO;i++){await(0,m.v7)(100),t=(0,C.mS)();const i=Object.values(t.byTabId).map(({id:e})=>(0,w.Xf0)(t,e)?.chatId).filter(Boolean),d=(0,h.YA)(o.DSF),n=d?.find(t=>!i.includes(t)&&!a.has(t));if(!n)return;a.add(n),e.loadViewportMessages({chatId:n,threadId:s.l3,tabId:(0,l.g0)()})}}),(0,C.aJ)("openChat",(t,e,a)=>{const{id:i,type:d,noForumTopicPanel:n,shouldReplaceHistory:r,shouldReplaceLast:c,tabId:h=(0,l.g0)()}=a;if(e.processOpenChatOrThread({chatId:i,type:d,threadId:s.l3,noForumTopicPanel:n,shouldReplaceHistory:r,shouldReplaceLast:c,tabId:h}),P(t,i,s.l3,h),!i||i===o.Xab)return;const u=(0,w.hds)(t,i);u?.hasUnreadMark&&e.markChatRead({id:i});const I=!(0,w.ZZX)(t,i);if(u)I&&!u.isMin&&e.requestChatUpdate({chatId:i});else if((0,w.nZ4)(t,i))(0,f.px)("fetchChat",{type:"self"});else{const e=(0,w.mBe)(t,i);e&&(0,f.px)("fetchChat",{type:"user",user:e})}}),(0,C.aJ)("openSavedDialog",(t,e,a)=>{const{chatId:s,tabId:i=(0,l.g0)(),...o}=a;e.openThread({chatId:t.currentUserId,threadId:s,tabId:i,...o})}),(0,C.aJ)("openThread",async(t,e,a)=>{const{type:i,isComments:o,noForumTopicPanel:d,shouldReplaceHistory:n,shouldReplaceLast:r,focusMessageId:c,tabId:h=(0,l.g0)()}=a;let I,m,g,{chatId:v}=a;if(o){const{originChannelId:t,originMessageId:e}=a;m=t,g=e}else{m=a.chatId,I=a.threadId,g=I;const c=(0,w.hds)(t,m);if(I===s.l3)return void e.openChat({id:v,type:i,noForumTopicPanel:d,shouldReplaceHistory:n,shouldReplaceLast:r,tabId:h});if(c?.isForum||v&&(0,b.cG)(v,I,t.currentUserId))return void e.processOpenChatOrThread({chatId:v,type:i,threadId:I,isComments:o,noForumTopicPanel:d,shouldReplaceHistory:n,shouldReplaceLast:r,tabId:h})}const F=(0,w.hds)(t,m),A=(0,w.Vw0)(t,m,g),S=(0,w.$jd)(t,m,g);if(!F)return;if(P(t,m,g,h),v&&A?.threadId&&(o||S?.listedIds?.length&&S.listedIds.includes(Number(A.threadId))))return t=(0,y.w)(t,{loadingThread:void 0},h),(0,C.UF)(t),void e.processOpenChatOrThread({chatId:v,type:i,threadId:A.threadId,isComments:o,noForumTopicPanel:d,shouldReplaceHistory:n,shouldReplaceLast:r,tabId:h});let{loadingThread:x}=(0,w.nTw)(t,h);x&&T(x.loadingChatId,x.loadingMessageId),t=(0,y.w)(t,{loadingThread:{loadingChatId:m,loadingMessageId:Number(g)}},h),(0,C.UF)(t);const M=()=>{const t=(0,C.mS)();o||(0,w.Xf0)(t,h)?.chatId!==m||(0,w.Xf0)(t,h)?.threadId!==g||e.openPreviousChat({tabId:h})};o||e.processOpenChatOrThread({chatId:v,type:i,threadId:I,tabId:h,isComments:o,noForumTopicPanel:d,shouldReplaceHistory:n,shouldReplaceLast:r});const U=(0,w.trm)(t)?void 0:await(0,f.px)("fetchDiscussionMessage",{chat:(0,w.hds)(t,m),messageId:Number(g)});if(t=(0,C.mS)(),x=(0,w.nTw)(t,h).loadingThread,x?.loadingChatId===m&&x?.loadingMessageId===g){if(!U)return t=(0,y.w)(t,{loadingThread:void 0},h),(0,C.UF)(t),e.showNotification({message:p.yE(o?"ChannelPostDeleted":"lng_message_not_found"),tabId:h}),void M();if(I??=U.threadId,v??=U.chatId,v){if(t=(0,C.mS)(),t=(0,V.KcS)(t,U.messages),o){t=(0,V.eAk)(t,m,g,{threadId:I});const e=void 0!==A?.lastMessageId?A.lastMessageId:0===A?.messagesCount?U.threadId:void 0;t=(0,V.eAk)(t,v,I,{isCommentsInfo:!1,threadId:I,chatId:v,fromChannelId:m,fromMessageId:g,lastMessageId:e,...A&&(0,u.Up)(A,["messagesCount","lastReadInboxMessageId","recentReplierIds"])})}t=(0,V.e49)(t,v,I,{firstMessageId:U.firstMessageId}),(0,C.UF)(t),c&&e.focusMessage({chatId:v,threadId:I,messageId:c,tabId:h}),e.loadViewportMessages({chatId:v,threadId:I,tabId:h,onError:()=>{t=(0,C.mS)(),t=(0,y.w)(t,{loadingThread:void 0},h),(0,C.UF)(t),e.showNotification({message:p.yE("Group.ErrorAccessDenied"),tabId:h})},onLoaded:()=>{t=(0,C.mS)(),x=(0,w.nTw)(t,h).loadingThread,x?.loadingChatId===m&&x?.loadingMessageId===g&&(t=(0,y.w)(t,{loadingThread:void 0},h),(0,C.UF)(t),e.processOpenChatOrThread({chatId:v,type:i,threadId:I,tabId:h,isComments:o,noForumTopicPanel:d,shouldReplaceHistory:n,shouldReplaceLast:r}))}})}else M()}else M()}),(0,C.aJ)("openLinkedChat",async(t,e,a)=>{const{id:s,tabId:i=(0,l.g0)()}=a,o=(0,w.hds)(t,s);if(!o)return;const d=await(0,f.px)("fetchFullChat",o);d?.fullInfo?.linkedChatId&&e.openChat({id:d.fullInfo.linkedChatId,tabId:i})}),(0,C.aJ)("openSupportChat",async(t,e,a)=>{const{tabId:s=(0,l.g0)()}=a||{},i=(0,w.ke9)(t);if(i)return void e.openChat({id:i.id,shouldReplaceHistory:!0,tabId:s});e.openChat({id:o.Xab,shouldReplaceHistory:!0,tabId:s});const d=await(0,f.px)("fetchChat",{type:"support"});d&&e.openChat({id:d.chatId,shouldReplaceHistory:!0,tabId:s})}),(0,C.aJ)("loadAllChats",async(t,e,a)=>{const{whenFirstBatchDone:s}=a,i=a.listType;let d=!1,n=0;for(;!t.chats.isFullyLoaded[i];){if(n++>=100)return void(o.Oig&&console.error("`actions/loadAllChats`: Infinite loop detected"));if("connectionStateReady"!==(t=(0,C.mS)()).connectionState||"authorizationStateReady"!==t.authState)return;await U(i,!0),d||(await(s?.()),d=!0),t=(0,C.mS)()}}),(0,C.aJ)("loadPinnedDialogs",async(t,e,a)=>{const{listType:s}=a,i=await(0,f.px)("fetchPinnedDialogs",{listType:s});if(!i)return;const{dialogIds:o,messages:d,chats:n,users:r}=i;t=(0,C.mS)(),t=(0,V.h7P)(t,(0,u.dU)(n,"id")),t=(0,V.CKT)(t,(0,u.dU)(r,"id")),t=(0,V.tTf)(t,d),t={...t,chats:{...t.chats,orderedPinnedIds:{...t.chats.orderedPinnedIds,[s]:o.length?o:void 0}}},(0,C.UF)(t)}),(0,C.aJ)("loadFullChat",(t,e,a)=>{const{chatId:s,force:i,withPhotos:o}=a,d=(0,w.hds)(t,s);if(!d)return;const n=async()=>{await J(t,e,d),o&&e.loadMoreProfilePhotos({peerId:s,shouldInvalidateCache:!0})};i?n():M(n)}),(0,C.aJ)("invalidateFullInfo",(t,e,a)=>{const{peerId:s}=a;return(0,c.L8)(s)?{...t,users:{...t.users,fullInfoById:(0,u.cJ)(t.users.fullInfoById,[s])}}:{...t,chats:{...t.chats,fullInfoById:(0,u.cJ)(t.chats.fullInfoById,[s])}}}),(0,C.aJ)("loadTopChats",()=>{x(()=>{U("active",void 0,!0),U("archived",void 0,!0)})}),(0,C.aJ)("requestChatUpdate",(t,e,a)=>{const{chatId:s}=a,i=(0,w.hds)(t,s);i&&(0,f.px)("requestChatUpdate",{chat:i,...s===o.zv8&&{lastLocalMessage:(0,w.xzS)(t)?.message}})}),(0,C.aJ)("requestSavedDialogUpdate",async(t,e,a)=>{const{chatId:s}=a,i=(0,w.hds)(t,s);if(!i)return;const o=await(0,f.px)("fetchMessages",{chat:i,isSavedDialog:!0,limit:1});o&&(t=(0,C.mS)(),t=(0,V.KcS)(t,o.messages),o.messages.length?(t=(0,V.yKC)(t,s,o.messages[0].id,"saved"),t=(0,V.ec2)(t,"saved",[s]),(0,C.UF)(t)):(t=(0,V.SJu)(t,s,"saved"),(0,C.UF)(t),Object.values(t.byTabId).forEach(({id:a})=>{const i=(0,w.Xf0)(t,a);if(!i)return;const{chatId:o,threadId:d}=i;(0,w.nZ4)(t,o)&&d===s&&e.openChat({id:void 0,tabId:a})})))}),(0,C.aJ)("updateChatMutedState",(t,e,a)=>{const{chatId:s,mutedUntil:i}=a;if((0,w.trm)(t))return void e.openFrozenAccountModal({tabId:(0,l.g0)()});const o=(0,w.hds)(t,s);o&&(0,f.px)("updateChatNotifySettings",{chat:o,settings:{mutedUntil:i}})}),(0,C.aJ)("updateChatSilentPosting",(t,e,a)=>{const{chatId:s,isEnabled:i}=a,o=(0,w.hds)(t,s);o&&(0,f.px)("updateChatNotifySettings",{chat:o,settings:{isSilentPosting:i}})}),(0,C.aJ)("updateTopicMutedState",(t,e,a)=>{const{chatId:s,topicId:i,mutedUntil:o}=a,d=(0,w.hds)(t,s);d&&(0,f.px)("updateTopicMutedState",{chat:d,topicId:i,mutedUntil:o})}),(0,C.aJ)("createChannel",async(t,e,a)=>{const{title:s,about:o,photo:d,memberIds:n,discussionChannelId:r,tabId:c=(0,l.g0)()}=a,h="isChannel"in a?a.isChannel:void 0,u="isSuperGroup"in a?a.isSuperGroup:void 0,I=n?.map(e=>(0,w.mBe)(t,e)).filter(Boolean);let p,m;t=(0,y.w)(t,{chatCreation:{progress:i.n7.InProgress}},c),(0,C.UF)(t);try{const t=await(0,f.px)("createChannel",{title:s,about:o,users:I,isBroadcast:h,isMegagroup:u});p=t?.channel,m=t?.missingUsers}catch(a){t=(0,C.mS)(),t=(0,y.w)(t,{chatCreation:{progress:i.n7.Error}},c),(0,C.UF)(t),"CHANNELS_TOO_MUCH"===a.message?e.openLimitReachedModal({limit:"channels",tabId:c}):e.showDialog({data:{...a,hasErrorKey:!0},tabId:c})}if(!p)return;const{id:g,accessHash:b}=p;t=(0,C.mS)(),t=(0,V.wix)(t,g,p),t=(0,y.w)(t,{chatCreation:{...(0,w.nTw)(t,c).chatCreation,progress:p?i.n7.Complete:i.n7.Error}},c),(0,C.UF)(t),r&&g&&e.linkDiscussionGroup({channelId:r,chatId:g,tabId:c}),e.openChat({id:g,shouldReplaceHistory:!0,tabId:c}),m&&(t=(0,C.mS)(),t=(0,V.hQe)(t,g,m,c),(0,C.UF)(t)),g&&b&&d&&await(0,f.px)("editChatPhoto",{chatId:g,accessHash:b,photo:d})}),(0,C.aJ)("joinChannel",async(t,e,a)=>{const{chatId:s,tabId:i=(0,l.g0)()}=a,o=(0,w.hds)(t,s);if(!o)return;const{id:d,accessHash:n}=o;if(d&&n)try{await(0,f.px)("joinChannel",{channelId:d,accessHash:n})}catch(t){"CHANNELS_TOO_MUCH"===t.message?e.openLimitReachedModal({limit:"channels",tabId:i}):e.showDialog({data:{...t,hasErrorKey:!0},tabId:i})}}),(0,C.aJ)("deleteChatUser",(t,e,a)=>{const{chatId:s,userId:i,shouldRevokeHistory:o,tabId:d=(0,l.g0)()}=a,n=(0,w.hds)(t,s),r=(0,w.mBe)(t,i);n&&r&&(t=(0,V.CX_)(t,s),(0,C.UF)(t),(0,w.Xf0)(t,d)?.chatId===s&&e.openChat({id:void 0,tabId:d}),(0,f.px)("deleteChatUser",{chat:n,user:r,shouldRevokeHistory:o}))}),(0,C.aJ)("deleteChat",(t,e,a)=>{const{chatId:s,tabId:i=(0,l.g0)()}=a,o=(0,w.hds)(t,s);o&&(t=(0,V.CX_)(t,s),(0,C.UF)(t),(0,w.Xf0)(t,i)?.chatId===s&&e.openChat({id:void 0,tabId:i}),(0,f.px)("deleteChat",{chatId:o.id}))}),(0,C.aJ)("leaveChannel",async(t,e,a)=>{const{chatId:s,tabId:i=(0,l.g0)()}=a,o=(0,w.hds)(t,s);if(!o)return;t=(0,V.CX_)(t,s),(0,C.UF)(t),(0,w.Xf0)(t,i)?.chatId===s&&e.openChat({id:void 0,tabId:i});const{id:d,accessHash:n}=o;if(d&&n){await(0,f.px)("leaveChannel",{channelId:d,accessHash:n}),t=(0,C.mS)();const e=(0,w.zeq)(t,s),a=Object.keys(e).map(Number).filter(I.iL);t=(0,V.AH0)(t,s,a),(0,C.UF)(t)}}),(0,C.aJ)("deleteChannel",(t,e,a)=>{const{chatId:s,tabId:i=(0,l.g0)()}=a,o=(0,w.hds)(t,s);if(!o)return;t=(0,V.CX_)(t,s),(0,C.UF)(t),(0,w.Xf0)(t,i)?.chatId===s&&e.openChat({id:void 0,tabId:i});const{id:d,accessHash:n}=o;d&&n&&(0,f.px)("deleteChannel",{channelId:d,accessHash:n})}),(0,C.aJ)("createGroupChat",async(t,e,a)=>{const{title:s,memberIds:o,photo:d,tabId:n=(0,l.g0)()}=a,r=o.map(e=>(0,w.mBe)(t,e)).filter(Boolean);t=(0,y.w)(t,{chatCreation:{progress:i.n7.InProgress}},n),(0,C.UF)(t);try{const{chat:a,missingUsers:o}=await(0,f.px)("createGroupChat",{title:s,users:r})??{};if(!a)return;const{id:c}=a;t=(0,C.mS)(),t=(0,V.wix)(t,c,a),t=(0,y.w)(t,{chatCreation:{...(0,w.nTw)(t,n).chatCreation,progress:a?i.n7.Complete:i.n7.Error}},n),(0,C.UF)(t),e.openChat({id:c,shouldReplaceHistory:!0,tabId:n}),o&&(t=(0,C.mS)(),t=(0,V.hQe)(t,c,o,n),(0,C.UF)(t)),c&&d&&await(0,f.px)("editChatPhoto",{chatId:c,photo:d})}catch(e){"USERS_TOO_FEW"===e.message&&(t=(0,C.mS)(),t=(0,y.w)(t,{chatCreation:{...(0,w.nTw)(t,n).chatCreation,progress:i.n7.Error,error:"CreateGroupError"}},n),(0,C.UF)(t))}}),(0,C.aJ)("toggleChatPinned",(t,e,a)=>{const{id:s,folderId:i,tabId:d=(0,l.g0)()}=a;if((0,w.trm)(t))return void e.openFrozenAccountModal({tabId:d});const n=(0,w.hds)(t,s);if(!n)return;const r=(0,A.d)(t,"dialogFolderPinned");if(i){const e=(0,w.$aQ)(t,i);if(e){const a=!(0,w.D3D)(t,s,i),{pinnedChatIds:o,includedChatIds:d}=e,n=a?[s,...o||[]]:(o||[]).filter(t=>t!==s),r=[s,...d];(0,f.px)("editChatFolder",{id:i,folderUpdate:{...e,pinnedChatIds:n,includedChatIds:r}})}}else{const a=(0,w.P4G)(t,s),i=(0,w.D3D)(t,s,"archived"===a?o._E9:void 0),c=t.chats.orderedPinnedIds["archived"===a?"archived":"active"];if((c?.length||0)>=r&&!i)return void e.openLimitReachedModal({limit:"dialogFolderPinned",tabId:d});(0,f.px)("toggleChatPinned",{chat:n,shouldBePinned:!i})}}),(0,C.aJ)("toggleChatArchived",(t,e,a)=>{const{id:s}=a;if((0,w.trm)(t))return void e.openFrozenAccountModal({tabId:(0,l.g0)()});const i=(0,w.hds)(t,s);i&&(0,f.px)("toggleChatArchived",{chat:i,folderId:(0,b.TJ)(i)?0:o._E9})}),(0,C.aJ)("toggleSavedDialogPinned",(t,e,a)=>{const{id:s,tabId:i=(0,l.g0)()}=a;if((0,w.trm)(t))return void e.openFrozenAccountModal({tabId:i});const d=(0,w.hds)(t,s);if(!d)return;const n=(0,A.d)(t,"savedDialogsPinned"),r=(0,w.D3D)(t,s,o.pX9),c=t.chats.orderedPinnedIds.saved;(c?.length||0)>=n&&!r?e.openLimitReachedModal({limit:"savedDialogsPinned",tabId:i}):(0,f.px)("toggleSavedDialogPinned",{chat:d,shouldBePinned:!r})}),(0,C.aJ)("loadChatFolders",async t=>{const e=await(0,f.px)("fetchChatFolders");e&&(t=(0,C.mS)(),t={...t,chatFolders:{...t.chatFolders,...e}},(0,C.UF)(t))}),(0,C.aJ)("loadRecommendedChatFolders",async t=>{const e=await(0,f.px)("fetchRecommendedChatFolders");e&&(t=(0,C.mS)(),t={...t,chatFolders:{...t.chatFolders,recommended:e}},(0,C.UF)(t))}),(0,C.aJ)("toggleDialogFilterTags",async(t,e,a)=>{const{isEnabled:s}=a;await(0,f.px)("toggleDialogFilterTags",s)&&(t=(0,C.mS)(),t={...t,chatFolders:{...t.chatFolders,areTagsEnabled:s}},(0,C.UF)(t))}),(0,C.aJ)("editChatFolders",(t,e,a)=>{const{chatId:s,idsToRemove:i,idsToAdd:o,tabId:d=(0,l.g0)()}=a,n=(0,A.d)(t,"dialogFiltersChats");o.some(e=>(0,w.$aQ)(t,e).includedChatIds.length>=n)?e.openLimitReachedModal({limit:"dialogFiltersChats",tabId:d}):(i.forEach(e=>{const a=(0,w.$aQ)(t,e);a&&(0,f.px)("editChatFolder",{id:e,folderUpdate:{...a,pinnedChatIds:a.pinnedChatIds?.filter(t=>t!==s),includedChatIds:a.includedChatIds.filter(t=>t!==s)}})}),o.forEach(e=>{const a=(0,w.$aQ)(t,e);a&&(0,f.px)("editChatFolder",{id:e,folderUpdate:{...a,includedChatIds:a.includedChatIds.concat(s)}})}))}),(0,C.aJ)("editChatFolder",(t,e,a)=>{const{id:s,folderUpdate:i}=a,o=(0,w.$aQ)(t,s);o&&(0,f.px)("editChatFolder",{id:s,folderUpdate:{id:s,emoticon:o.emoticon,pinnedChatIds:o.pinnedChatIds,...i}})}),(0,C.aJ)("addChatFolder",async(t,e,a)=>{const{folder:s,tabId:i=(0,l.g0)()}=a,{orderedIds:d,byId:n}=t.chatFolders,r=(0,A.d)(t,"dialogFilters");if(Object.keys(n).length>=r)return void e.openLimitReachedModal({limit:"dialogFilters",tabId:i});const c=Math.max(...d||[],o._E9),{id:h,description:u,...I}=s,p=c+1,m={id:p,...I};if(await(0,f.px)("editChatFolder",{id:p,folderUpdate:m}),e.apiUpdate({"@type":"updateChatFolder",id:p,folder:m}),e.requestNextFoldersAction({foldersAction:{type:"setFolderId",payload:c+1},tabId:i}),!u)return;t=(0,C.mS)();const{recommended:g}=t.chatFolders;g&&(t={...t,chatFolders:{...t.chatFolders,recommended:g.filter(({id:t})=>t!==h)}},(0,C.UF)(t))}),(0,C.aJ)("sortChatFolders",async(t,e,a)=>{const{folderIds:s}=a;await(0,f.px)("sortChatFolders",s)&&(t=(0,C.mS)(),t={...t,chatFolders:{...t.chatFolders,orderedIds:s}},(0,C.UF)(t))}),(0,C.aJ)("deleteChatFolder",async(t,e,a)=>{const{id:s}=a;(0,w.$aQ)(t,s)&&await(0,f.px)("deleteChatFolder",s)}),(0,C.aJ)("markChatUnread",(t,e,a)=>{const{id:s}=a;if((0,w.trm)(t))return void e.openFrozenAccountModal({tabId:(0,l.g0)()});const i=(0,w.hds)(t,s);i&&(0,f.px)("toggleDialogUnread",{chat:i,hasUnreadMark:!i.hasUnreadMark})}),(0,C.aJ)("markChatMessagesRead",async(t,e,a)=>{if((0,w.trm)(t))return;const{id:i}=a;if((0,w.trm)(t))return void e.openFrozenAccountModal({tabId:(0,l.g0)()});const o=(0,w.hds)(t,i);if(!o)return;if(!o.isForum)return await(0,f.px)("markMessageListRead",{chat:o,threadId:s.l3}),e.readAllMentions({chatId:i}),e.readAllReactions({chatId:i}),void(o.hasUnreadMark&&e.markChatRead({id:i}));let d,n=!0,r=0;for(;n;){const t=await(0,f.px)("fetchTopics",{chat:o,offsetDate:d?.date,offsetTopicId:d?.id,offsetId:d?.lastMessageId,limit:100});if(!t?.topics?.length)return;t.topics.forEach(t=>{(t.unreadCount||t.unreadMentionsCount||t.unreadReactionsCount)&&e.markTopicRead({chatId:i,topicId:t.id})}),d=t.topics[t.topics.length-1],r+=t.topics.length,t.count<=r&&(n=!1)}}),(0,C.aJ)("markChatRead",(t,e,a)=>{const{id:s}=a,i=(0,w.hds)(t,s);i&&(0,f.px)("toggleDialogUnread",{chat:i,hasUnreadMark:!i.hasUnreadMark})}),(0,C.aJ)("markTopicRead",(t,e,a)=>{if((0,w.trm)(t))return;const{chatId:s,topicId:i}=a,o=(0,w.hds)(t,s);if(!o)return;const d=(0,w.S0q)(t,s,i),n=d?.lastMessageId;n&&((0,f.px)("markMessageListRead",{chat:o,threadId:i,maxId:n}),e.readAllMentions({chatId:s,threadId:i}),e.readAllReactions({chatId:s,threadId:i}),t=(0,C.mS)(),t=(0,V.TwA)(t,s,i,{unreadCount:0}),t=(0,V.eAk)(t,s,i,{lastReadInboxMessageId:n}),(0,C.UF)(t))}),(0,C.aJ)("checkChatInvite",async(t,e,a)=>{const{hash:s,tabId:i=(0,l.g0)()}=a,o=await(0,f.px)("checkChatInvite",s);if(o){if(t=(0,C.mS)(),o.users&&(t=(0,V.g18)(t,(0,u.dU)(o.users,"id"))),o.chat)return t=(0,V.Nl5)(t,(0,u.dU)([o.chat],"id")),(0,C.UF)(t),void e.openChat({id:o.chat.id,tabId:i});if(o.invite.subscriptionFormId)return t=(0,y.w)(t,{starsPayment:{inputInvoice:{type:"chatInviteSubscription",hash:s},subscriptionInfo:o.invite,status:"pending"}},i),void(0,C.UF)(t);t=(0,y.w)(t,{chatInviteModal:{hash:s,inviteInfo:o.invite}},i),(0,C.UF)(t)}}),(0,C.aJ)("openChatByPhoneNumber",async(t,e,a)=>{const{phoneNumber:s,startAttach:i,attach:d,text:n,tabId:r=(0,l.g0)()}=a;e.openChat({id:o.Xab,tabId:r});const c=await async function(t,e){t=(0,C.mS)();const a=(0,w.gTO)(t,e);if(a&&!a.isMin)return(0,w.hds)(t,a.id);const{chat:s,user:i}=await(0,f.px)("getChatByPhoneNumber",e)||{};return s?(t=(0,C.mS)(),t=(0,V.wix)(t,s.id,s),i&&(t=(0,V.TKu)(t,i.id,i)),(0,C.UF)(t),s):void 0}(t,s);if(!c)return e.openPreviousChat({tabId:r}),void e.showNotification({message:p.yE("lng_username_by_phone_not_found").replace("{phone}",s),tabId:r});n?e.openChatWithDraft({chatId:c.id,text:{text:n},tabId:r}):e.openChat({id:c.id,tabId:r}),d&&E(t=(0,C.mS)(),e,c.id,d,i,r)}),(0,C.aJ)("openTelegramLink",async(t,e,a)=>{const{url:s,shouldIgnoreCache:i,linkContext:d,tabId:c=(0,l.g0)()}=a,{openChatByPhoneNumber:h,checkChatInvite:u,openStickerSet:I,openChatWithDraft:p,joinVoiceChatByLink:m,openInvoice:g,checkChatlistInvite:b,openChatByUsername:V,openStoryViewerByUsername:v,checkGiftCode:y}=e;if((0,r.zq)(s)&&((0,n._)(s,d)||s.match(o.bnE)))return;const F=new URL(s.toLowerCase().startsWith("http")?s:`https://${s}`);if(o.G38.has(F.hostname)&&"/"===F.pathname)return void window.open(F.toString(),"_blank","noopener");const A=(o.G38.has(F.hostname)?"t.me":F.hostname).split(".");if(A.length>3)return;const S=F.pathname.replace(/^\/?s\//,""),x=3===A.length?`${A[0]}/${S}`:S,[M,T,P]=x.split("/").filter(Boolean).map(t=>decodeURI(t)),U=Object.fromEntries(F.searchParams);let J;"joinchat"===M&&(J=T);const B="s"===T&&(Number(P)||void 0);if(M.match(/^\+([0-9]+)(\?|$)/))return void h({phoneNumber:M.substr(1,M.length-1),startAttach:U.startattach,attach:U.attach,text:U.text,tabId:c});if(B)return void v({username:M,storyId:B,tabId:c});if((M.startsWith(" ")||M.startsWith("+"))&&(J=M.substr(1,M.length-1)),J)return void u({hash:J,tabId:c});if("addstickers"===M||"addemoji"===M)return void I({stickerSetInfo:{shortName:T},shouldIgnoreCache:i,tabId:c});if("share"===M)return void p({text:(0,n.E)(U.url,U.text),tabId:c});if("addlist"===M)return void b({slug:T,tabId:c});if("giftcode"===M)return void y({slug:T,tabId:c});const R=T||void 0,E=P?Number(P):void 0,D=U.comment?Number(U.comment):void 0,L=await async function(t,e,a){if(!e||!a)return!1;t=(0,C.mS)();const s=await k(t,e);t=(0,C.mS)();const i=s&&(0,w.mBe)(t,s.id),o=i&&await(0,f.px)("fetchBotApp",{bot:i,appName:a});return Boolean(o)}(t,M,T),H=M&&!T||Number.isInteger(Number(T))||L;U.hasOwnProperty("voicechat")||U.hasOwnProperty("livestream")?m({username:M,inviteHash:U.voicechat||U.livestream,tabId:c}):M.startsWith("$")?g({type:"slug",slug:M.substring(1),tabId:c}):"invoice"===M?g({type:"slug",slug:T,tabId:c}):H?V({username:M,messageId:E||Number(R),threadId:E?Number(R):void 0,commentId:D,startParam:U.start,startAttach:U.startattach,attach:U.attach,startApp:U.startapp,mode:U.mode,originalParts:[M,T,P],tabId:c}):e.openUrl({url:s,shouldSkipModal:!0,tabId:c,ignoreDeepLinks:!0})}),(0,C.aJ)("processBoostParameters",async(t,e,a)=>{const{usernameOrId:s,isPrivate:i,tabId:o=(0,l.g0)()}=a;let d;if(i){if(d=(0,w.hds)(t,s),!d)return void e.showNotification({message:{key:"PrivateChannelInaccessible"},tabId:o})}else if(d=await k(t,s),!d)return void e.showNotification({message:{key:"NoUsernameFound"},tabId:o});(0,b.WX)(d)||(0,b.Vs)(d)?e.openBoostModal({chatId:d.id,tabId:o}):e.openChat({id:d.id,tabId:o})}),(0,C.aJ)("acceptChatInvite",async(t,e,a)=>{const{hash:s,tabId:i=(0,l.g0)()}=a,o=await(0,f.px)("importChatInvite",{hash:s});o&&e.openChat({id:o.id,tabId:i})}),(0,C.aJ)("openChatByUsername",async(t,e,a)=>{const{username:s,messageId:i,commentId:d,startParam:n,startAttach:r,attach:c,threadId:h,originalParts:u,startApp:I,shouldStartMainApp:p,mode:m,isDirect:f,text:b,onChatChanged:V,choose:v,ref:y,timestamp:F,linkContext:A,tabId:S=(0,l.g0)()}=a,x=(0,w.meB)(t,S),M=u?.[1],T=M&&!Number(M)&&!u?.[2];if(!d){if(void 0===r&&i&&!n&&!y&&x?.usernames?.some(t=>t.username===s))return void e.focusMessage({chatId:x.id,threadId:h,messageId:i,timestamp:F,tabId:S});if(void 0!==r&&v)return void e.processAttachBotParameters({username:s,filter:v,startParam:r||I,tabId:S});if(void 0!==I&&!M||p){const a=(0,g.A)(),i=await k(t,s);t=(0,C.mS)();const o=i&&(0,w.mBe)(t,i.id);if(!i||!o?.hasMainMiniApp)return;return void e.requestMainWebView({botId:i.id,peerId:x?.id||i.id,theme:a,startParam:I,mode:m,tabId:S})}if(!T)return await async function(t,e,a,...[s=(0,l.g0)()]){const{username:i,threadId:d,channelPostId:n,startParam:r,ref:c,startAttach:h,attach:u,text:I,timestamp:p,linkContext:m,isDirect:g}=a,f=(0,w.meB)(t,s);if(void 0!==h&&!u){const a=await B(t,e,i,s);if(!a)return;return void e.callAttachBot({bot:a,chatId:f?.id||a.id,startParam:h,tabId:s})}const b=(0,w.qn$)(t,i),C=g&&b?.linkedMonoforumId&&!b.isMonoforum?(0,w.hds)(t,b.linkedMonoforumId):void 0,V=g?C?.id===f?.id:f?.usernames?.some(t=>t.username===i);V||e.openChat({id:o.Xab,tabId:s});const v=t.appConfig.starRefStartPrefixes;let y=c;if(r&&v?.length){const t=v.find(t=>r.startsWith(t));t&&(y=r.slice(t.length))}const F=await k(t,i,y);if(!F)return void(V||(e.openPreviousChat({tabId:s}),e.showNotification({message:"User does not exist",tabId:s})));const A=g&&!F.isMonoforum&&F.linkedMonoforumId?(0,w.hds)(t,F.linkedMonoforumId):void 0;R(t,e,g&&A||F,{isCurrentChat:V,threadId:d,messageId:n,startParam:r,referrer:y,startAttach:h,attach:u,text:I,timestamp:p,linkContext:m},s)}(t,e,{username:s,threadId:h,channelPostId:i,startParam:n,ref:y,startAttach:r,attach:c,text:b,timestamp:F,linkContext:A,isDirect:f},S),void(V&&e[V.action](V.payload))}const P=(0,w.qn$)(t,s);if(d&&i&&P)return e.openThread({isComments:!0,originChannelId:P.id,originMessageId:i,tabId:S,focusMessageId:d}),void(F&&e.openMediaFromTimestamp({chatId:P.id,messageId:d,timestamp:F,tabId:S}));T||e.openChat({id:o.Xab,tabId:S});const U=await k(t,s);if(U){if(T&&U){const t=(0,g.A)();return void e.requestAppWebView({appName:M,botId:U.id,tabId:S,startApp:I,mode:m,theme:t})}i&&(e.openThread({isComments:!0,originChannelId:U.id,originMessageId:i,tabId:S,focusMessageId:d}),F&&e.openMediaFromTimestamp({chatId:U.id,messageId:d||i,timestamp:F,tabId:S}),V&&e[V.action](V.payload))}}),(0,C.aJ)("openPrivateChannel",(t,e,a)=>{const{id:s,commentId:i,messageId:o,threadId:d,timestamp:n,linkContext:r,tabId:c=(0,l.g0)()}=a,h=(0,w.hds)(t,s);h?i||o||d?(n&&e.openMediaFromTimestamp({chatId:s,messageId:i||o,timestamp:n,tabId:c}),i&&o?e.openThread({isComments:!0,originChannelId:s,originMessageId:o,tabId:c,focusMessageId:i}):R(t,e,h,{messageId:o,threadId:d,timestamp:n,linkContext:r},c)):e.openChat({id:s,tabId:c}):e.showNotification({message:{key:"PrivateChannelInaccessible"},tabId:c})}),(0,C.aJ)("togglePreHistoryHidden",async(t,e,a)=>{const{chatId:s,isEnabled:i,tabId:o=(0,l.g0)()}=a,d=await D(t,e,s,o);d&&(t=(0,C.mS)(),t=(0,V.ltr)(t,d.id,{isPreHistoryHidden:i}),(0,C.UF)(t),(0,f.px)("togglePreHistoryHidden",{chat:d,isEnabled:i}))}),(0,C.aJ)("updateChatDefaultBannedRights",(t,e,a)=>{const{chatId:s,bannedRights:i}=a,o=(0,w.hds)(t,s);o&&(0,f.px)("updateChatDefaultBannedRights",{chat:o,bannedRights:i})}),(0,C.aJ)("updateChatMemberBannedRights",async(t,e,a)=>{const{chatId:s,userId:i,bannedRights:o,tabId:d=(0,l.g0)()}=a,n=(0,w.mBe)(t,i);if(!n)return;const r=await D(t,e,s,d);if(!r)return;if(!await(0,f.px)("updateChatMemberBannedRights",{chat:r,user:n,bannedRights:o}))return;t=(0,C.mS)();const c=(0,w.AWZ)(t,r.id);if(!c)return;const{members:h,kickedMembers:u}=c,I=Boolean(o.viewMessages),p=!Object.keys(o).length;t=(0,V.ltr)(t,r.id,{...h&&I&&{members:h.filter(t=>t.userId!==i)},...h&&!I&&{members:h.map(t=>t.userId===i?{...t,bannedRights:o}:t)},...p&&u&&{kickedMembers:u.filter(t=>t.userId!==i)}}),I&&(t=(0,V.wix)(t,r.id,{membersCount:Math.max(0,(r.membersCount||0)-1)})),(0,C.UF)(t)}),(0,C.aJ)("updateChatAdmin",async(t,e,a)=>{if((0,w.trm)(t))return;const{chatId:s,userId:i,adminRights:o,customTitle:d,tabId:n=(0,l.g0)()}=a,r=(0,w.mBe)(t,i);if(!r)return;const c=await D(t,e,s,n);if(!c)return;await(0,f.px)("updateChatAdmin",{chat:c,user:r,adminRights:o,customTitle:d});const h=await(0,f.px)("fetchFullChat",c);if(!h?.fullInfo)return;const{adminMembersById:u}=h.fullInfo,I=!Object.keys(o).length;let p;if(u)if(I){const{[i]:t,...e}=u;p=e}else p={...u,[i]:{...u[i],adminRights:o,customTitle:d}};p&&(t=(0,C.mS)(),t=(0,V.ltr)(t,c.id,{adminMembersById:p}),(0,C.UF)(t))}),(0,C.aJ)("updateChat",async(t,e,a)=>{const{chatId:s,title:o,about:d,photo:n,tabId:r=(0,l.g0)()}=a,c=(0,w.hds)(t,s),h=(0,w.AWZ)(t,s);c&&(t=(0,C.mS)(),t=(0,V.G42)(t,i.TD.InProgress,r),(0,C.UF)(t),await Promise.all([c.title!==o?(0,f.px)("updateChatTitle",c,o):void 0,h?.about!==d?(0,f.px)("updateChatAbout",c,d):void 0,n?(0,f.px)("editChatPhoto",{chatId:s,accessHash:c.accessHash,photo:n}):void 0]),t=(0,C.mS)(),t=(0,V.G42)(t,i.TD.Complete,r),(0,C.UF)(t),n&&e.loadFullChat({chatId:s,withPhotos:!0}))}),(0,C.aJ)("updateChatPhoto",async(t,e,a)=>{const{photo:s,chatId:i}=a,o=(0,w.hds)(t,i);o&&(await(0,f.px)("editChatPhoto",{chatId:i,accessHash:o.accessHash,photo:s}),e.loadFullChat({chatId:i,withPhotos:!0}))}),(0,C.aJ)("deleteChatPhoto",async(t,e,a)=>{const{photo:s,chatId:i}=a,o=(0,w.hds)(t,i);if(!o)return;let d;d=s.id===o.avatarPhotoId?await(0,f.px)("editChatPhoto",{chatId:i,accessHash:o.accessHash}):await(0,f.px)("deleteProfilePhotos",[s]),d&&(t=(0,C.mS)(),t=(0,V.sol)(t,i,s.id),(0,C.UF)(t),e.loadFullChat({chatId:i,withPhotos:!0}))}),(0,C.aJ)("toggleSignatures",(t,e,a)=>{const{chatId:s,areProfilesEnabled:i,areSignaturesEnabled:o}=a,d=(0,w.hds)(t,s);d&&(0,f.px)("toggleSignatures",{chat:d,areProfilesEnabled:i,areSignaturesEnabled:o})}),(0,C.aJ)("loadGroupsForDiscussion",async t=>{const e=await(0,f.px)("fetchGroupsForDiscussion");if(!e)return;const a=e.reduce((t,e)=>(e&&!e.isForum&&(t[e.id]=e),t),{});t=(0,C.mS)(),t={...t,chats:{...t.chats,forDiscussionIds:Object.keys(a)}},(0,C.UF)(t)}),(0,C.aJ)("linkDiscussionGroup",async(t,e,a)=>{if((0,w.trm)(t))return;const{channelId:s,chatId:i,tabId:o=(0,l.g0)()}=a||{},d=(0,w.hds)(t,s);if(!d)return;const n=await D(t,e,i,o);if(!n)return;let r=(0,w.AWZ)(t,n.id);if(!r){const t=await(0,f.px)("fetchFullChat",n);if(!t)return;r=t.fullInfo}r.isPreHistoryHidden&&(t=(0,C.mS)(),t=(0,V.ltr)(t,n.id,{isPreHistoryHidden:!1}),(0,C.UF)(t),await(0,f.px)("togglePreHistoryHidden",{chat:n,isEnabled:!1})),(0,f.px)("setDiscussionGroup",{channel:d,chat:n})}),(0,C.aJ)("unlinkDiscussionGroup",async(t,e,a)=>{const{channelId:s}=a,i=(0,w.hds)(t,s);if(!i)return;const o=(0,w.AWZ)(t,s);let d;o?.linkedChatId&&(d=(0,w.hds)(t,o.linkedChatId)),await(0,f.px)("setDiscussionGroup",{channel:i}),d&&J(t=(0,C.mS)(),e,d)}),(0,C.aJ)("setActiveChatFolder",(t,e,a)=>{const{activeChatFolder:s,tabId:i=(0,l.g0)()}=a;if(!(s+1>(0,A.d)(t,"dialogFilters")))return(0,y.w)(t,{activeChatFolder:s},i);e.openLimitReachedModal({limit:"dialogFilters",tabId:i})}),(0,C.aJ)("resetOpenChatWithDraft",(t,e,a)=>{const{tabId:s=(0,l.g0)()}=a||{};return(0,y.w)(t,{requestedDraft:void 0},s)}),(0,C.aJ)("loadMoreMembers",async(t,e,a)=>{const{chatId:s}=a||{};if((0,w.trm)(t))return;const i=(0,w.hds)(t,s);if(!i||(0,b.yn)(i)||(0,b.Ve)(i))return;const o=(0,w.AWZ)(t,i.id)?.members?.length;if(void 0!==o&&void 0!==i.membersCount&&o>=i.membersCount)return;const d=await(0,f.px)("fetchMembers",{chat:i,offset:o});if(!d)return;const{members:n,userStatusesById:r}=d;n&&n.length&&(t=(0,C.mS)(),t=(0,V.d2X)(t,r),t=(0,V.t_k)(t,i,n),(0,C.UF)(t))}),(0,C.aJ)("addChatMembers",async(t,e,a)=>{const{chatId:s,memberIds:o,tabId:d=(0,l.g0)()}=a,n=(0,w.hds)(t,s),r=o.map(e=>(0,w.mBe)(t,e)).filter(Boolean);if(!n||!r.length)return;e.setNewChatMembersDialogState({newChatMembersProgress:i.D7.Loading,tabId:d});const c=await(0,f.px)("addChatMembers",n,r);c&&(t=(0,C.mS)(),t=(0,V.hQe)(t,s,c,d),(0,C.UF)(t)),e.setNewChatMembersDialogState({newChatMembersProgress:i.D7.Closed,tabId:d}),J(t=(0,C.mS)(),e,n)}),(0,C.aJ)("deleteChatMember",async(t,e,a)=>{const{chatId:s,userId:i,tabId:o=(0,l.g0)()}=a,d=(0,w.hds)(t,s),n=(0,w.mBe)(t,i);d&&n&&((0,b.Vs)(d)||(0,b.WX)(d)?e.updateChatMemberBannedRights({chatId:s,userId:i,bannedRights:{viewMessages:!0,sendMessages:!0,sendMedia:!0,sendStickers:!0,sendGifs:!0,sendGames:!0,sendInline:!0,embedLinks:!0,sendPolls:!0,changeInfo:!0,inviteUsers:!0,pinMessages:!0,manageTopics:!0,sendPhotos:!0,sendVideos:!0,sendRoundvideos:!0,sendAudios:!0,sendVoices:!0,sendDocs:!0,sendPlain:!0},tabId:o}):(await(0,f.px)("deleteChatMember",d,n),J(t=(0,C.mS)(),e,d)))}),(0,C.aJ)("toggleIsProtected",(t,e,a)=>{const{chatId:s,isProtected:i}=a,o=(0,w.hds)(t,s);o&&(0,f.px)("toggleIsProtected",{chat:o,isProtected:i})}),(0,C.aJ)("setChatEnabledReactions",async(t,e,a)=>{const{chatId:s,enabledReactions:i,reactionsLimit:o}=a,d=(0,w.hds)(t,s);d&&(await(0,f.px)("setChatEnabledReactions",{chat:d,enabledReactions:i,reactionsLimit:o}),J(t=(0,C.mS)(),e,d))}),(0,C.aJ)("fetchChat",(t,e,a)=>{const{chatId:s}=a;if(!(0,w.hds)(t,s))if((0,w.nZ4)(t,s))(0,f.px)("fetchChat",{type:"self"});else{const e=(0,w.mBe)(t,s);e&&(0,f.px)("fetchChat",{type:"user",user:e})}}),(0,C.aJ)("toggleJoinToSend",async(t,e,a)=>{const{chatId:s,isEnabled:i}=a,o=(0,w.hds)(t,s);o&&((0,b.Vs)(o)||(0,b.WX)(o))&&await(0,f.px)("toggleJoinToSend",o,i)}),(0,C.aJ)("toggleJoinRequest",async(t,e,a)=>{const{chatId:s,isEnabled:i}=a,o=(0,w.hds)(t,s);o&&((0,b.Vs)(o)||(0,b.WX)(o))&&await(0,f.px)("toggleJoinRequest",o,i)}),(0,C.aJ)("openForumPanel",(t,e,a)=>{const{chatId:s,tabId:i=(0,l.g0)()}=a;return e.toggleStoryRibbon({isShown:!1,tabId:i}),e.toggleStoryRibbon({isShown:!1,isArchived:!0,tabId:i}),(0,y.w)(t,{forumPanelChatId:s},i)}),(0,C.aJ)("closeForumPanel",(t,e,a)=>{const{tabId:s=(0,l.g0)()}=a||{};return(0,y.w)(t,{forumPanelChatId:void 0},s)}),(0,C.aJ)("processAttachBotParameters",async(t,e,a)=>{const{username:s,filter:i,startParam:o,tabId:d=(0,l.g0)()}=a,n=await B(t,e,s,d);if(!n)return;if(!Boolean(i))return void e.callAttachBot({isFromSideMenu:!0,bot:n,startParam:o,tabId:d});t=(0,C.mS)();const{attachMenu:{bots:r}}=t;if(!r[n.id])return t=(0,y.w)(t,{requestedAttachBotInstall:{bot:n,onConfirm:{action:"requestAttachBotInChat",payload:{bot:n,filter:i,startParam:o}}}},d),void(0,C.UF)(t);e.requestAttachBotInChat({bot:n,filter:i,startParam:o,tabId:d})}),(0,C.aJ)("loadTopics",async(t,e,a)=>{if((0,w.trm)(t))return;const{chatId:s,force:i}=a;if((0,w.trm)(t))return;const d=(0,w.hds)(t,s);if(!d)return;const n=(0,w.xyP)(t,s);if(!i&&n?.listedTopicIds&&n.listedTopicIds.length===n.totalCount)return;const r=i?void 0:n?.listedTopicIds?.reduce((e,a)=>{const i=(0,w.S0q)(t,s,a),o=(0,w.S0q)(t,s,e);return i&&(!o||i.lastMessageId<o.lastMessageId)?a:e}),{id:c,date:l,lastMessageId:h}=r&&(0,w.S0q)(t,s,r)||{},u=await(0,f.px)("fetchTopics",{chat:d,offsetTopicId:c,offsetId:h,offsetDate:l,limit:c?o.iIc:o.qj6});u&&(t=(0,C.mS)(),t=(0,V.KcS)(t,u.messages),t=(0,V.mIA)(t,s,u.count,u.topics),t=(0,V.Y4o)(t,s,u.topics.map(t=>t.id)),Object.entries(u.draftsById||{}).forEach(([e,a])=>{t=(0,V.eww)(t,s,Number(e),"draft",a)}),Object.entries(u.readInboxMessageIdByTopicId||{}).forEach(([e,a])=>{t=(0,V.eAk)(t,s,Number(e),{lastReadInboxMessageId:a})}),(0,C.UF)(t))}),(0,C.aJ)("loadTopicById",async(t,e,a)=>{const{chatId:s,topicId:i}=a,o=(0,w.hds)(t,s);if(!o)return;const d=await(0,f.px)("fetchTopicById",{chat:o,topicId:i});if(d)t=(0,C.mS)(),t=(0,V.KcS)(t,d.messages),t=(0,V.TwA)(t,s,i,d.topic),(0,C.UF)(t);else if("tabId"in a&&a.shouldCloseChatOnError){const{tabId:t=(0,l.g0)()}=a;e.openChat({id:void 0,tabId:t})}}),(0,C.aJ)("toggleForum",async(t,e,a)=>{const{chatId:s,isEnabled:i,tabId:o=(0,l.g0)()}=a,d=await D(t,e,s,o);if(!d)return;let n;try{n=await(0,f.px)("toggleForum",{chat:d,isEnabled:i})}catch(t){"FLOOD"===t.message?e.showNotification({message:p.yE("FloodWait"),tabId:o}):e.showDialog({data:{...t,hasErrorKey:!0},tabId:o})}n&&(t=(0,C.mS)(),t=(0,V.wix)(t,d.id,{isForum:i}),(0,C.UF)(t),i?e.openForumPanel({chatId:d.id,tabId:o}):e.closeForumPanel({tabId:o}))}),(0,C.aJ)("toggleParticipantsHidden",async(t,e,a)=>{const{chatId:s,isEnabled:i}=a,o=(0,w.hds)(t,s);if(!o)return;const d=(0,w.AWZ)(t,o.id)?.areParticipantsHidden;t=(0,V.ltr)(t,s,{areParticipantsHidden:i}),(0,C.UF)(t),await(0,f.px)("toggleParticipantsHidden",{chat:o,isEnabled:i})||void 0===d||(t=(0,C.mS)(),t=(0,V.ltr)(t,s,{areParticipantsHidden:d}),(0,C.UF)(t))}),(0,C.aJ)("createTopic",async(t,e,a)=>{const{chatId:s,title:i,iconColor:o,iconEmojiId:d,tabId:n=(0,l.g0)()}=a,r=(0,w.hds)(t,s);if(!r)return;(0,w.nTw)(t,n).createTopicPanel&&(t=(0,y.w)(t,{createTopicPanel:{chatId:s,isLoading:!0}},n),(0,C.UF)(t));const c=await(0,f.px)("createTopic",{chat:r,title:i,iconColor:o,iconEmojiId:d});c&&e.openThread({chatId:s,threadId:c,shouldReplaceHistory:!0,tabId:n}),e.closeCreateTopicPanel({tabId:n})}),(0,C.aJ)("deleteTopic",async(t,e,a)=>{const{chatId:s,topicId:i}=a,o=(0,w.hds)(t,s);o&&(await(0,f.px)("deleteTopic",{chat:o,topicId:i}),t=(0,C.mS)(),t=(0,V.do9)(t,s,i),(0,C.UF)(t))}),(0,C.aJ)("editTopic",async(t,e,a)=>{const{chatId:s,topicId:i,tabId:o=(0,l.g0)(),...d}=a,n=(0,w.hds)(t,s),r=(0,w.S0q)(t,s,i);n&&r&&((0,w.nTw)(t,o).editTopicPanel&&(t=(0,y.w)(t,{editTopicPanel:{chatId:s,topicId:i,isLoading:!0}},o),(0,C.UF)(t)),await(0,f.px)("editTopic",{chat:n,topicId:i,...d})&&(t=(0,C.mS)(),t=(0,V.TwA)(t,s,i,d),(0,C.UF)(t),e.closeEditTopicPanel({tabId:o})))}),(0,C.aJ)("toggleTopicPinned",(t,e,a)=>{const{chatId:s,topicId:i,isPinned:o,tabId:d=(0,l.g0)()}=a,{topicsPinnedLimit:n}=t.appConfig,r=(0,w.hds)(t,s),c=(0,w.pSx)(t,s);r&&c&&n&&(o&&Object.values(c).filter(t=>t.isPinned).length>=n?e.showNotification({message:p.yE("LimitReachedPinnedTopics",n,"i"),tabId:d}):(0,f.px)("togglePinnedTopic",{chat:r,topicId:i,isPinned:o}))}),(0,C.aJ)("checkChatlistInvite",async(t,e,a)=>{const{slug:s,tabId:i=(0,l.g0)()}=a,o=await(0,f.px)("checkChatlistInvite",{slug:s});o?(t=(0,C.mS)(),t=(0,y.w)(t,{chatlistModal:{invite:o.invite}},i),(0,C.UF)(t)):e.showNotification({message:p.yE("lng_group_invite_bad_link"),tabId:i})}),(0,C.aJ)("joinChatlistInvite",async(t,e,a)=>{const{invite:s,peerIds:i,tabId:o=(0,l.g0)()}=a,d=i.map(e=>(0,w.hds)(t,e)).filter(Boolean),n=d.filter(t=>t.isNotJoined).length,r="folderId"in s?(0,w.$aQ)(t,s.folderId):void 0,c="title"in s?s.title:r?.title;try{if(!await(0,f.px)("joinChatlistInvite",{slug:s.slug,peers:d}))return;if(r)return void e.showNotification({title:{key:"FolderLinkNotificationUpdatedTitle",variables:{title:c.text}},message:{key:"FolderLinkNotificationUpdatedSubtitle",variables:{count:n},options:{pluralValue:n}},tabId:o});e.showNotification({title:{key:"FolderLinkNotificationAddedTitle",variables:{title:c.text}},message:{key:"FolderLinkNotificationAddedSubtitle",variables:{count:n},options:{pluralValue:n}},tabId:o})}catch(t){"CHATLISTS_TOO_MUCH"===t.message?e.openLimitReachedModal({limit:"chatlistJoined",tabId:o}):e.showDialog({data:{...t,hasErrorKey:!0},tabId:o})}}),(0,C.aJ)("leaveChatlist",async(t,e,a)=>{const{folderId:s,peerIds:i,tabId:o=(0,l.g0)()}=a,d=(0,w.$aQ)(t,s),n=i?.map(e=>(0,w.hds)(t,e)).filter(Boolean)||[];await(0,f.px)("leaveChatlist",{folderId:s,peers:n})&&d&&e.showNotification({title:{key:"FolderLinkNotificationDeletedTitle",variables:{title:d.title.text}},message:{key:"FolderLinkNotificationDeletedSubtitle",variables:{count:n.length},options:{pluralValue:n.length}},tabId:o})}),(0,C.aJ)("loadChatlistInvites",async(t,e,a)=>{const{folderId:s}=a,i=await(0,f.px)("fetchChatlistInvites",{folderId:s});i&&(t=(0,C.mS)(),t={...t,chatFolders:{...t.chatFolders,invites:{...t.chatFolders.invites,[s]:i.invites}}},(0,C.UF)(t))}),(0,C.aJ)("createChatlistInvite",async(t,e,a)=>{const{folderId:s,tabId:o=(0,l.g0)()}=a,d=(0,w.$aQ)(t,s);if(!d)return;let n;t=(0,y.w)(t,{shareFolderScreen:{...(0,w.nTw)(t,o).shareFolderScreen,isLoading:!0}},o),(0,C.UF)(t);try{n=await(0,f.px)("createChalistInvite",{folderId:s,peers:d.includedChatIds.concat(d.pinnedChatIds||[]).map(e=>(0,w.hds)(t,e)||(0,w.mBe)(t,e)).filter(Boolean)})}catch(t){S.has(t.message)?(e.openLimitReachedModal({limit:"chatlistInvites",tabId:o}),e.openSettingsScreen({screen:i.VS.Folders,tabId:o})):e.showDialog({data:{...t,hasErrorKey:!0},tabId:o})}if(!n||!n.invite)return;const{shareFolderScreen:r}=(0,w.nTw)(t,o);r&&(t=(0,C.mS)(),t={...t,chatFolders:{...t.chatFolders,byId:{...t.chatFolders.byId,[s]:{...t.chatFolders.byId[s],...n.filter}},invites:{...t.chatFolders.invites,[s]:[...t.chatFolders.invites[s]||[],n.invite]}}},t=(0,y.w)(t,{shareFolderScreen:{...r,url:n.invite.url,isLoading:!1}},o),(0,C.UF)(t))}),(0,C.aJ)("editChatlistInvite",async(t,e,a)=>{const{folderId:s,peerIds:i,url:o,tabId:d=(0,l.g0)()}=a,n=o.split("/").pop();if(!n)return;const r=i.map(e=>(0,w.hds)(t,e)||(0,w.mBe)(t,e)).filter(Boolean);t=(0,y.w)(t,{shareFolderScreen:{...(0,w.nTw)(t,d).shareFolderScreen,isLoading:!0}},d),(0,C.UF)(t);try{const e=await(0,f.px)("editChatlistInvite",{folderId:s,slug:n,peers:r});if(!e)return;t=(0,C.mS)(),t={...t,chatFolders:{...t.chatFolders,invites:{...t.chatFolders.invites,[s]:t.chatFolders.invites[s]?.map(t=>t.url===o?e:t)}}},(0,C.UF)(t)}catch(t){e.showDialog({data:{...t,hasErrorKey:!0},tabId:d})}finally{t=(0,C.mS)(),t=(0,y.w)(t,{shareFolderScreen:{...(0,w.nTw)(t,d).shareFolderScreen,isLoading:!1}},d),(0,C.UF)(t)}}),(0,C.aJ)("deleteChatlistInvite",async(t,e,a)=>{const{folderId:s,url:i}=a,o=i.split("/").pop();o&&await(0,f.px)("deleteChatlistInvite",{folderId:s,slug:o})&&(t=(0,C.mS)(),t={...t,chatFolders:{...t.chatFolders,invites:{...t.chatFolders.invites,[s]:t.chatFolders.invites[s]?.filter(t=>t.url!==i)}}},(0,C.UF)(t))}),(0,C.aJ)("openDeleteChatFolderModal",async(t,e,a)=>{const{folderId:s,isConfirmedForChatlist:i,tabId:o=(0,l.g0)()}=a,d=(0,w.$aQ)(t,s);if(d){if(d.isChatList&&(!d.hasMyInvites||i)){const e=(0,h.YA)(s),a=await(0,f.px)("fetchLeaveChatlistSuggestions",{folderId:s});return t=(0,C.mS)(),t=(0,y.w)(t,{chatlistModal:{removal:{folderId:s,suggestedPeerIds:(0,u.Am)([...a||[],...e||[]])}}},o),void(0,C.UF)(t)}t=(0,y.w)(t,{deleteFolderDialogModal:s},o),(0,C.UF)(t)}}),(0,C.aJ)("updateChatDetectedLanguage",(t,e,a)=>{const{chatId:s,detectedLanguage:i}=a;return t=(0,C.mS)(),(0,V.wix)(t,s,{detectedLanguage:i},void 0,!0)}),(0,C.aJ)("togglePeerTranslations",async(t,e,a)=>{const{chatId:s,isEnabled:i}=a,o=(0,w.hds)(t,s);o&&void 0!==await(0,f.px)("togglePeerTranslations",{chat:o,isEnabled:i})&&(t=(0,C.mS)(),t=(0,V.zTz)(t,s,{isTranslationDisabled:!i||void 0}),(0,C.UF)(t))}),(0,C.aJ)("setViewForumAsMessages",(t,e,a)=>{const{chatId:s,isEnabled:i}=a,o=(0,w.hds)(t,s);o?.isForum&&o.isForumAsMessages!==i&&(t=(0,V.wix)(t,s,{isForumAsMessages:i||void 0}),(0,C.UF)(t),(0,f.px)("setViewForumAsMessages",{chat:o,isEnabled:i}))}),(0,C.aJ)("loadChannelRecommendations",async(t,e,a)=>{if((0,w.trm)(t))return;const{chatId:s}=a,i=s?(0,w.hds)(t,s):void 0;if(s&&!i)return;if(!s&&(0,w.dg4)(t,o.rBM))return;const d=await(0,f.px)("fetchChannelRecommendations",{chat:i});if(!d)return;const{similarChannels:n,count:r}=d,c=(0,u.dU)(n,"id");t=(0,C.mS)(),t=(0,V.czZ)(t,s||o.rBM,Object.keys(c),r),(0,C.UF)(t)}),(0,C.aJ)("loadBotRecommendations",async(t,e,a)=>{if((0,w.trm)(t))return;const{userId:s}=a,i=(0,w.hds)(t,s);if(!i)return;const o=await(0,f.px)("fetchBotsRecommendations",{user:i});if(!o)return;const{similarBots:d,count:n}=o,r=(0,u.dU)(d,"id");t=(0,C.mS)(),t=(0,V.g18)(t,r),t=(0,V.tNY)(t,s,Object.keys(r),n),(0,C.UF)(t)}),(0,C.aJ)("toggleChannelRecommendations",(t,e,a)=>{const{chatId:s}=a;(0,w.hds)(t,s)&&(t=(0,V.Cbr)(t,s),(0,C.UF)(t))}),(0,C.aJ)("updatePaidMessagesPrice",async(t,e,a)=>{const{chatId:s,paidMessagesStars:o,tabId:d=(0,l.g0)()}=a,n=s?(0,w.hds)(t,s):void 0;n&&(t=(0,V.G42)(t,i.TD.InProgress,d),(0,C.UF)(t),await(0,f.px)("updatePaidMessagesPrice",{chat:n,paidMessagesStars:o})&&(t=(0,C.mS)(),t=(0,V.G42)(t,i.TD.Complete,d),t=(0,V.wix)(t,s,{paidMessagesStars:o}),(0,C.UF)(t)))}),(0,C.aJ)("toggleAutoTranslation",async(t,e,a)=>{const{chatId:s,isEnabled:i}=a,o=(0,w.hds)(t,s);o&&await(0,f.px)("toggleAutoTranslation",{chat:o,isEnabled:i})&&(t=(0,C.mS)(),t=(0,V.wix)(t,s,{hasAutoTranslation:i||void 0}),(0,C.UF)(t))}),(0,C.aJ)("setMainProfileTab",async(t,e,a)=>{const{chatId:s,tab:i}=a,o=(0,w.hds)(t,s);if(!o)return;const d=(0,w.kBv)(t,s),n=d?.mainTab;if(n===i)return;let r;t=(0,V.zTz)(t,s,{mainTab:i}),(0,C.UF)(t),r=s===t.currentUserId?await(0,f.px)("setAccountMainProfileTab",{tab:i}):await(0,f.px)("setChannelMainProfileTab",{chat:o,tab:i}),r||(t=(0,C.mS)(),t=(0,V.zTz)(t,s,{mainTab:n}),(0,C.UF)(t))}),(0,C.aJ)("resolveBusinessChatLink",async(t,e,a)=>{const{slug:s,tabId:i=(0,l.g0)()}=a,o=await(0,f.px)("resolveBusinessChatLink",{slug:s});if(!o)return void e.showNotification({message:p.yE("BusinessLink.ErrorExpired"),tabId:i});const{chatLink:d}=o;e.openChatWithDraft({chatId:d.chatId,text:d.text,tabId:i})}),(0,C.aJ)("requestCollectibleInfo",async(t,e,a)=>{const{type:s,collectible:i,peerId:o,tabId:n=(0,l.g0)()}=a;let r;if("phone"===s&&(r={phone:i}),"username"===s&&(r={username:i}),!r)return;const c=await(0,f.px)("fetchCollectionInfo",r);c?(t=(0,C.mS)(),t=(0,y.w)(t,{collectibleInfoModal:{...c,type:s,collectible:i,peerId:o}},n),(0,C.UF)(t)):(0,d.eM)(i)})},80840:(t,e,a)=>{a.d(e,{R6:()=>c,c5:()=>l,h9:()=>n,um:()=>r});var s=a(87894),i=a(91048),o=a(71331),d=a(16350);function n(t,e,a,i,o){const d=Object.values({...t.groupCalls.byId[e]?.participants,...a.participants}).filter(({isLeft:t})=>!t).reduce((t,e)=>(t[e.id]=e,t),{});return{...t,groupCalls:{...t.groupCalls,byId:{...t.groupCalls.byId,[e]:{...t.groupCalls.byId[e],...(0,s.cJ)(a,["participantsCount"]),...i&&{participantsCount:t.groupCalls.byId[e].participantsCount+i},...void 0!==o&&{participantsCount:o},participants:d}}}}}function r(t,e){const a=(0,o.Ip)(t,e);return a&&a.chatId&&(0,i.hds)(t,a.chatId)&&(t=(0,d.lt)(t,a.chatId,{groupCallId:void 0})),{...t,groupCalls:{...t.groupCalls,byId:{...(0,s.cJ)(t.groupCalls.byId,[e.toString()])}}}}function c(t,e,a){return t.groupCalls.activeGroupCallId?n(t,t.groupCalls.activeGroupCallId,e,void 0,a):t}function l(t,e,a,s,i=!1){const d=(0,o.Ip)(t,e);return d?n(t,e,{participants:{...d.participants,[a]:{...d.participants[a],...s}}},s.isLeft?i?0:-1:d.participants[a]||i?0:1):t}}}]);
//# sourceMappingURL=2859.d71964eb1f32ca2ad613.js.map