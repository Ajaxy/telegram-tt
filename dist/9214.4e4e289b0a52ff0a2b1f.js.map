{"version":3,"file":"9214.4e4e289b0a52ff0a2b1f.js","mappings":"gMAIO,SAASA,EAAkBC,EAAKC,EAAUC,GAC7C,IAAIC,EACJ,OAAO,IAAAC,WAAUC,UAAM,OAAQ,GAAQ,WACnC,IAAIC,EAAMC,EAAkBC,EAAOC,EAC/BC,EAAQL,KACZ,OAAO,IAAAM,aAAYN,MAAM,SAAUO,GAC/B,OAAQA,EAAGC,OACP,KAAK,EACD,OAAI,SACO,CAAC,EAAc,KAE1BP,GAAO,UACPC,EAAyD,QAArCJ,EAAKF,EAASa,yBAAsC,IAAPX,EAAgBA,EAAK,CAAC,EACvFK,EAAQO,OAAOC,QAAQT,GAClBU,QAAO,SAAUd,GAElB,OADQA,EAAG,GAAcA,EAAG,EAEhC,IACKe,KAAI,SAAUf,GAEf,OADWA,EAAG,EAElB,IACAM,EAAUD,EAAMU,KAAI,SAAUC,GAAQ,OAAO,IAAAf,WAAUM,OAAO,OAAQ,GAAQ,WAC1E,IAAIU,EAAeC,EAAYC,EAAUC,EACzC,OAAO,IAAAZ,aAAYN,MAAM,SAAUF,GAC/B,OAAQA,EAAGU,OACP,KAAK,EACDO,EAAgBD,EAAKK,QAAQ,YAAa,IAC1CH,EAAaD,EACTlB,IACAmB,EAAaI,KAAKL,GAAeI,QAAQ,KAAM,KAEnDF,EAAW,GAAGI,OAAOpB,EAAM,gBAAgBoB,OAAOL,EAAY,YAAYK,OAAOL,EAAY,UAC7FlB,EAAGU,MAAQ,EACf,KAAK,EAED,OADAV,EAAGwB,KAAKC,KAAK,CAAC,EAAG,EAAG,CAAE,IACf,CAAC,GAAa,OAAWN,IAGpC,KAAK,EAGD,OAFAnB,EAAG0B,OAEI,CAAC,EAAcC,OAAO,GAAGJ,OAAON,EAAe,gBAC1D,KAAK,EAID,OAHAG,EAAUpB,EAAG0B,OACb7B,EAAI+B,IAAI,QAASR,GACjBvB,EAAIgC,MAAMC,UAAU,4BACb,CAAC,EAAa,GACzB,KAAK,EAAG,MAAO,CAAC,GAExB,GACJ,GAAI,IACG,CAAC,EAAaC,QAAQC,IAAI1B,KACrC,KAAK,EAGD,MAAO,CAAC,EAFKG,EAAGiB,OACQZ,OAAOmB,UAG3C,GACJ,GACJ,C","sources":["webpack://telegram-t/./node_modules/@june-so/analytics-next/dist/pkg/plugins/remote-middleware/index.js"],"sourcesContent":["import { __awaiter, __generator } from \"tslib\";\nimport { isServer } from '../../core/environment';\nimport { loadScript } from '../../lib/load-script';\nimport { getNextIntegrationsURL } from '../../lib/parse-cdn';\nexport function remoteMiddlewares(ctx, settings, obfuscate) {\n    var _a;\n    return __awaiter(this, void 0, void 0, function () {\n        var path, remoteMiddleware, names, scripts, middleware;\n        var _this = this;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    if (isServer()) {\n                        return [2 /*return*/, []];\n                    }\n                    path = getNextIntegrationsURL();\n                    remoteMiddleware = (_a = settings.enabledMiddleware) !== null && _a !== void 0 ? _a : {};\n                    names = Object.entries(remoteMiddleware)\n                        .filter(function (_a) {\n                        var _ = _a[0], enabled = _a[1];\n                        return enabled;\n                    })\n                        .map(function (_a) {\n                        var name = _a[0];\n                        return name;\n                    });\n                    scripts = names.map(function (name) { return __awaiter(_this, void 0, void 0, function () {\n                        var nonNamespaced, bundleName, fullPath, error_1;\n                        return __generator(this, function (_a) {\n                            switch (_a.label) {\n                                case 0:\n                                    nonNamespaced = name.replace('@segment/', '');\n                                    bundleName = nonNamespaced;\n                                    if (obfuscate) {\n                                        bundleName = btoa(nonNamespaced).replace(/=/g, '');\n                                    }\n                                    fullPath = \"\".concat(path, \"/middleware/\").concat(bundleName, \"/latest/\").concat(bundleName, \".js.gz\");\n                                    _a.label = 1;\n                                case 1:\n                                    _a.trys.push([1, 3, , 4]);\n                                    return [4 /*yield*/, loadScript(fullPath)\n                                        // @ts-ignore\n                                    ];\n                                case 2:\n                                    _a.sent();\n                                    // @ts-ignore\n                                    return [2 /*return*/, window[\"\".concat(nonNamespaced, \"Middleware\")]];\n                                case 3:\n                                    error_1 = _a.sent();\n                                    ctx.log('error', error_1);\n                                    ctx.stats.increment('failed_remote_middleware');\n                                    return [3 /*break*/, 4];\n                                case 4: return [2 /*return*/];\n                            }\n                        });\n                    }); });\n                    return [4 /*yield*/, Promise.all(scripts)];\n                case 1:\n                    middleware = _b.sent();\n                    middleware = middleware.filter(Boolean);\n                    return [2 /*return*/, middleware];\n            }\n        });\n    });\n}\n//# sourceMappingURL=index.js.map"],"names":["remoteMiddlewares","ctx","settings","obfuscate","_a","__awaiter","this","path","remoteMiddleware","names","scripts","_this","__generator","_b","label","enabledMiddleware","Object","entries","filter","map","name","nonNamespaced","bundleName","fullPath","error_1","replace","btoa","concat","trys","push","sent","window","log","stats","increment","Promise","all","Boolean"],"sourceRoot":""}