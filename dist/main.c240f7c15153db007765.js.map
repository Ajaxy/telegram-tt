{"version":3,"file":"main.c240f7c15153db007765.js","mappings":"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,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB,KAAO,uBAAuB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","sources":["webpack://telegram-t/webpack/runtime/create fake namespace object","webpack://telegram-t/webpack/runtime/load script","webpack://telegram-t/./src/api/gramjs/worker/connector.ts","webpack://telegram-t/./src/api/types/media.ts","webpack://telegram-t/./src/api/types/messages.ts","webpack://telegram-t/./src/components/common/AnimatedIcon.tsx","webpack://telegram-t/./src/components/common/AnimatedSticker.tsx","webpack://telegram-t/./src/components/common/CustomEmoji.tsx","webpack://telegram-t/./src/components/common/CustomEmoji.module.scss?8f5a","webpack://telegram-t/./src/components/common/MessageSummary.tsx","webpack://telegram-t/./src/components/common/MessageText.tsx","webpack://telegram-t/./src/components/common/PeerColorWrapper.tsx","webpack://telegram-t/./src/components/common/PeerColorWrapper.module.scss?b340","webpack://telegram-t/./src/components/common/SafeLink.tsx","webpack://telegram-t/./src/components/common/Sparkles.module.scss?15c2","webpack://telegram-t/./src/components/common/Sparkles.tsx","webpack://telegram-t/./src/components/common/StickerView.module.scss?7ce5","webpack://telegram-t/./src/components/common/StickerView.tsx","webpack://telegram-t/./src/hooks/useMountAfterHeavyAnimation.ts","webpack://telegram-t/./src/components/common/TopicDefaultIcon.module.scss?06b0","webpack://telegram-t/./src/components/common/TopicDefaultIcon.tsx","webpack://telegram-t/./src/components/common/embedded/EmojiIconBackground.module.scss?aa76","webpack://telegram-t/./src/components/common/embedded/EmojiIconBackground.tsx","webpack://telegram-t/./src/components/common/helpers/animatedAssets.ts","webpack://telegram-t/./src/components/common/helpers/documentInfo.ts","webpack://telegram-t/./src/components/common/helpers/mediaDimensions.ts","webpack://telegram-t/./src/components/common/helpers/peerColor.ts","webpack://telegram-t/./src/components/common/helpers/renderText.tsx","webpack://telegram-t/./src/components/common/Blockquote.module.scss?d7ef","webpack://telegram-t/./src/components/common/Blockquote.tsx","webpack://telegram-t/./src/util/prettyCodeLanguageNames.ts","webpack://telegram-t/./src/components/common/code/CodeOverlay.module.scss?733a","webpack://telegram-t/./src/components/common/code/CodeOverlay.tsx","webpack://telegram-t/./src/components/common/code/CodeBlock.tsx","webpack://telegram-t/./src/components/common/spoiler/Spoiler.tsx","webpack://telegram-t/./src/components/common/helpers/renderTextWithEntities.tsx","webpack://telegram-t/./src/hooks/useEnsureCustomEmoji.ts","webpack://telegram-t/./src/components/common/hooks/useCustomEmoji.ts","webpack://telegram-t/./src/components/common/icons/Icon.tsx","webpack://telegram-t/./src/components/common/icons/StarIcon.module.scss?d424","webpack://telegram-t/./src/components/common/icons/StarIcon.tsx","webpack://telegram-t/./src/components/middle/composer/helpers/customEmoji.ts","webpack://telegram-t/./src/components/middle/helpers/preventMessageInputBlur.ts","webpack://telegram-t/./src/util/localization/utils.ts","webpack://telegram-t/./src/components/middle/message/ActionMessageText.tsx","webpack://telegram-t/./src/components/middle/message/MentionLink.tsx","webpack://telegram-t/./src/components/middle/message/helpers/messageActions.tsx","webpack://telegram-t/./src/components/ui/Button.tsx","webpack://telegram-t/./src/components/ui/Checkbox.tsx","webpack://telegram-t/./src/components/ui/DropdownMenu.tsx","webpack://telegram-t/./src/components/ui/InputText.tsx","webpack://telegram-t/./src/components/ui/Link.module.scss?2387","webpack://telegram-t/./src/components/ui/Link.tsx","webpack://telegram-t/./src/components/ui/Loading.tsx","webpack://telegram-t/./src/hooks/useMenuPosition.ts","webpack://telegram-t/./src/components/ui/Menu.tsx","webpack://telegram-t/./src/components/ui/MenuItem.tsx","webpack://telegram-t/./src/components/middle/message/hooks/useVideoAutoPause.ts","webpack://telegram-t/./src/components/ui/OptimizedVideo.tsx","webpack://telegram-t/./src/components/ui/Portal.ts","webpack://telegram-t/./src/components/ui/RippleEffect.tsx","webpack://telegram-t/./src/components/ui/Spinner.tsx","webpack://telegram-t/./src/components/ui/Transition.tsx","webpack://telegram-t/./src/config.ts","webpack://telegram-t/./src/global/actions/api/initial.ts","webpack://telegram-t/./src/global/actions/api/settings.ts","webpack://telegram-t/./src/global/actions/apiUpdaters/initial.ts","webpack://telegram-t/./src/global/actions/ui/initial.ts","webpack://telegram-t/./src/global/actions/ui/settings.ts","webpack://telegram-t/./src/global/cache.ts","webpack://telegram-t/./src/global/helpers/bots.ts","webpack://telegram-t/./src/global/helpers/chats.ts","webpack://telegram-t/./src/global/helpers/reactions.ts","webpack://telegram-t/./src/global/helpers/media.ts","webpack://telegram-t/./src/global/helpers/misc.ts","webpack://telegram-t/./src/global/helpers/messageMedia.ts","webpack://telegram-t/./src/global/helpers/messageSummary.ts","webpack://telegram-t/./src/global/helpers/messages.ts","webpack://telegram-t/./src/global/helpers/middleSearch.ts","webpack://telegram-t/./src/global/helpers/notifications.ts","webpack://telegram-t/./src/global/helpers/replies.ts","webpack://telegram-t/./src/global/helpers/symbols.ts","webpack://telegram-t/./src/global/helpers/users.ts","webpack://telegram-t/./src/global/index.ts","webpack://telegram-t/./src/global/initialState.ts","webpack://telegram-t/./src/global/reducers/chats.ts","webpack://telegram-t/./src/global/reducers/symbols.ts","webpack://telegram-t/./src/global/reducers/users.ts","webpack://telegram-t/./src/global/reducers/globalSearch.ts","webpack://telegram-t/./src/global/reducers/management.ts","webpack://telegram-t/./src/global/reducers/settings.ts","webpack://telegram-t/./src/global/reducers/twoFaSettings.ts","webpack://telegram-t/./src/global/reducers/passcode.ts","webpack://telegram-t/./src/global/reducers/payments.ts","webpack://telegram-t/./src/global/reducers/statistics.ts","webpack://telegram-t/./src/global/reducers/peers.ts","webpack://telegram-t/./src/global/reducers/stories.ts","webpack://telegram-t/./src/global/reducers/topics.ts","webpack://telegram-t/./src/global/helpers/getEmojiOnlyCountForMessage.ts","webpack://telegram-t/./src/global/reducers/messages.ts","webpack://telegram-t/./src/global/reducers/middleSearch.ts","webpack://telegram-t/./src/global/reducers/tabs.ts","webpack://telegram-t/./src/global/reducers/translations.ts","webpack://telegram-t/./src/global/selectors/chats.ts","webpack://telegram-t/./src/global/selectors/management.ts","webpack://telegram-t/./src/global/selectors/statistics.ts","webpack://telegram-t/./src/global/selectors/ui.ts","webpack://telegram-t/./src/global/selectors/globalSearch.ts","webpack://telegram-t/./src/global/selectors/payments.ts","webpack://telegram-t/./src/global/selectors/settings.ts","webpack://telegram-t/./src/global/selectors/messages.ts","webpack://telegram-t/./src/global/selectors/middleSearch.ts","webpack://telegram-t/./src/global/selectors/peers.ts","webpack://telegram-t/./src/global/selectors/stories.ts","webpack://telegram-t/./src/global/selectors/symbols.ts","webpack://telegram-t/./src/global/selectors/tabs.ts","webpack://telegram-t/./src/global/selectors/topics.ts","webpack://telegram-t/./src/global/selectors/users.ts","webpack://telegram-t/./src/hooks/animations/useViewTransition.ts","webpack://telegram-t/./src/hooks/data/useSelector.ts","webpack://telegram-t/./src/hooks/data/useSelectorSignal.ts","webpack://telegram-t/./src/hooks/element/useCollapsibleLines.ts","webpack://telegram-t/./src/hooks/stickers/useColorFilter.tsx","webpack://telegram-t/./src/hooks/element/useStyleObserver.ts","webpack://telegram-t/./src/hooks/stickers/useDynamicColorListener.ts","webpack://telegram-t/./src/hooks/useAppLayout.ts","webpack://telegram-t/./src/hooks/useAsync.ts","webpack://telegram-t/./src/hooks/useBuffering.ts","webpack://telegram-t/./src/hooks/useCoordsInSharedCanvas.ts","webpack://telegram-t/./src/hooks/useCurrentOrPrev.ts","webpack://telegram-t/./src/hooks/useDebouncedCallback.ts","webpack://telegram-t/./src/hooks/useDerivedSignal.ts","webpack://telegram-t/./src/hooks/useDerivedState.ts","webpack://telegram-t/./src/hooks/useEffectOnce.ts","webpack://telegram-t/./src/hooks/useEffectWithPrevDeps.ts","webpack://telegram-t/./src/hooks/useElectronDrag.ts","webpack://telegram-t/./src/hooks/useFlag.ts","webpack://telegram-t/./src/hooks/useForceUpdate.ts","webpack://telegram-t/./src/hooks/useHeavyAnimation.ts","webpack://telegram-t/./src/hooks/useHistoryBack.ts","webpack://telegram-t/./src/hooks/useIntersectionObserver.ts","webpack://telegram-t/./src/hooks/useKeyboardListNavigation.ts","webpack://telegram-t/./src/hooks/useLang.ts","webpack://telegram-t/./src/hooks/useLastCallback.ts","webpack://telegram-t/./src/hooks/useMedia.ts","webpack://telegram-t/./src/hooks/useMediaTransition.ts","webpack://telegram-t/./src/hooks/useMediaTransitionDeprecated.ts","webpack://telegram-t/./src/hooks/useModuleLoader.ts","webpack://telegram-t/./src/hooks/useOldLang.ts","webpack://telegram-t/./src/hooks/usePreviousDeprecated.ts","webpack://telegram-t/./src/hooks/usePriorityPlaybackCheck.ts","webpack://telegram-t/./src/hooks/useResizeObserver.ts","webpack://telegram-t/./src/hooks/useSharedIntersectionObserver.ts","webpack://telegram-t/./src/hooks/useSyncEffectWithPrevDeps.ts","webpack://telegram-t/./src/hooks/useShowTransition.ts","webpack://telegram-t/./src/hooks/useShowTransitionDeprecated.ts","webpack://telegram-t/./src/hooks/useSignalEffect.ts","webpack://telegram-t/./src/hooks/useStateRef.ts","webpack://telegram-t/./src/hooks/useSyncEffect.ts","webpack://telegram-t/./src/hooks/useThrottledCallback.ts","webpack://telegram-t/./src/hooks/useThumbnail.ts","webpack://telegram-t/./src/hooks/useUniqueId.ts","webpack://telegram-t/./src/hooks/useVideoCleanup.ts","webpack://telegram-t/./src/hooks/useVirtualBackdrop.ts","webpack://telegram-t/./src/hooks/window/useBackgroundMode.ts","webpack://telegram-t/./src/hooks/window/useDevicePixelRatio.ts","webpack://telegram-t/./src/hooks/window/useWindowSize.ts","webpack://telegram-t/./src/lib/fasterdom/fasterdom.ts","webpack://telegram-t/./src/lib/fasterdom/layoutCauses.ts","webpack://telegram-t/./src/lib/fasterdom/stricterdom.ts","webpack://telegram-t/./src/lib/rlottie/RLottie.async.ts","webpack://telegram-t/./src/lib/teact/dom-events.ts","webpack://telegram-t/./src/lib/teact/heavyAnimation.ts","webpack://telegram-t/./src/lib/teact/teact-dom.ts","webpack://telegram-t/./src/util/debugOverlay.ts","webpack://telegram-t/./src/lib/teact/teact.ts","webpack://telegram-t/./src/lib/teact/teactn.tsx","webpack://telegram-t/./src/lib/twemojiRegex.js","webpack://telegram-t/./src/types/index.ts","webpack://telegram-t/./src/util/Deferred.ts","webpack://telegram-t/./src/util/animation.ts","webpack://telegram-t/./src/util/appBadge.ts","webpack://telegram-t/./src/util/areDeepEqual.ts","webpack://telegram-t/./src/util/arePropsShallowEqual.ts","webpack://telegram-t/./node_modules/idb-keyval/dist/index.js","webpack://telegram-t/./src/util/browser/idb.ts","webpack://telegram-t/./src/util/browser/unloadVideo.ts","webpack://telegram-t/./src/lib/punycode.js","webpack://telegram-t/./src/util/browser/url.ts","webpack://telegram-t/./src/util/buildClassName.ts","webpack://telegram-t/./src/util/buildStyle.ts","webpack://telegram-t/./src/util/cacheApi.ts","webpack://telegram-t/./src/util/callbacks.ts","webpack://telegram-t/./src/util/captureEscKeyListener.ts","webpack://telegram-t/./src/util/captureEvents.ts","webpack://telegram-t/./src/util/lethargy.ts","webpack://telegram-t/./src/util/captureKeyboardListeners.ts","webpack://telegram-t/./src/util/clipboard.ts","webpack://telegram-t/./src/util/cssAnimationEndListeners.ts","webpack://telegram-t/./src/util/dates/dateFormat.ts","webpack://telegram-t/./src/util/dates/timestamp.ts","webpack://telegram-t/./src/util/dates/units.ts","webpack://telegram-t/./src/util/debugConsole.ts","webpack://telegram-t/./src/util/deepLinkParser.ts","webpack://telegram-t/./src/util/deeplink.ts","webpack://telegram-t/./src/util/element/calcTextLineHeightAndCount.ts","webpack://telegram-t/./src/util/element/jsxToHtml.ts","webpack://telegram-t/./src/util/emoji/customEmojiManager.ts","webpack://telegram-t/./src/util/emoji/emoji.ts","webpack://telegram-t/./src/util/emoji/fixNonStandardEmoji.ts","webpack://telegram-t/./src/util/emoji/parseEmojiOnlyString.ts","webpack://telegram-t/./src/util/establishMultitabRole.ts","webpack://telegram-t/./src/util/files.ts","webpack://telegram-t/./src/util/folderManager.ts","webpack://telegram-t/./src/util/forceReflow.ts","webpack://telegram-t/./src/util/formatCurrency.tsx","webpack://telegram-t/./src/util/forumColors.ts","webpack://telegram-t/./src/util/generateUniqueId.ts","webpack://telegram-t/./src/util/getReadableErrorText.ts","webpack://telegram-t/./src/util/handleError.ts","webpack://telegram-t/./src/util/installPrompt.ts","webpack://telegram-t/./src/util/iteratees.ts","webpack://telegram-t/./src/util/keys/messageKey.ts","webpack://telegram-t/./src/util/keys/searchResultKey.ts","webpack://telegram-t/./src/util/localization/format.tsx","webpack://telegram-t/./src/util/data/readStrings.ts","webpack://telegram-t/./src/util/data/readFallbackStrings.ts","webpack://telegram-t/./src/assets/localization/initialStrings.ts","webpack://telegram-t/./src/util/localization/index.ts","webpack://telegram-t/./src/util/browser/intlListFormat.ts","webpack://telegram-t/./src/util/localization/types.ts","webpack://telegram-t/./src/util/math.ts","webpack://telegram-t/./src/util/oggToWav.ts","webpack://telegram-t/./src/util/mediaLoader.ts","webpack://telegram-t/./src/util/memo.ts","webpack://telegram-t/./src/util/moduleLoader.ts","webpack://telegram-t/./src/util/deepDiff.ts","webpack://telegram-t/./src/util/deepMerge.ts","webpack://telegram-t/./src/util/multitab.ts","webpack://telegram-t/./src/util/notifications.tsx","webpack://telegram-t/./src/util/oldLangProvider.ts","webpack://telegram-t/./src/util/passcode.ts","webpack://telegram-t/./src/util/patchSafariProgressiveAudio.ts","webpack://telegram-t/./src/util/perfomanceSettings.ts","webpack://telegram-t/./src/util/permanentWebVersion.ts","webpack://telegram-t/./src/util/phoneNumber.ts","webpack://telegram-t/./src/util/primitives/LimitedMap.ts","webpack://telegram-t/./src/util/replaceWithTeact.ts","webpack://telegram-t/./src/util/requestActionTimeout.ts","webpack://telegram-t/./src/util/routing.ts","webpack://telegram-t/./src/util/safeExec.ts","webpack://telegram-t/./src/util/safePlay.ts","webpack://telegram-t/./src/util/schedulers.ts","webpack://telegram-t/./src/util/searchWords.ts","webpack://telegram-t/./src/util/serverTime.ts","webpack://telegram-t/./src/util/sessions.ts","webpack://telegram-t/./src/util/signals.ts","webpack://telegram-t/./src/util/stopEvent.ts","webpack://telegram-t/./src/util/svgController.ts","webpack://telegram-t/./src/util/swipeController.ts","webpack://telegram-t/./src/util/switchTheme.ts","webpack://telegram-t/./src/util/systemTheme.ts","webpack://telegram-t/./src/util/textFormat.ts","webpack://telegram-t/./src/util/theme.ts","webpack://telegram-t/./src/util/themeStyle.ts","webpack://telegram-t/./src/util/trimText.ts","webpack://telegram-t/./src/util/username.ts","webpack://telegram-t/./src/util/websync.ts","webpack://telegram-t/./src/util/windowEnvironment.ts","webpack://telegram-t/./src/util/windowSize.ts","webpack://telegram-t/./src/util/withCache.ts","webpack://telegram-t/./src/components/middle/message/ActionMessage.module.scss?5fb2","webpack://telegram-t/webpack/bootstrap","webpack://telegram-t/webpack/runtime/compat get default export","webpack://telegram-t/webpack/runtime/define property getters","webpack://telegram-t/webpack/runtime/ensure chunk","webpack://telegram-t/webpack/runtime/get javascript chunk filename","webpack://telegram-t/webpack/runtime/get mini-css chunk filename","webpack://telegram-t/webpack/runtime/global","webpack://telegram-t/webpack/runtime/hasOwnProperty shorthand","webpack://telegram-t/webpack/runtime/make namespace object","webpack://telegram-t/webpack/runtime/publicPath","webpack://telegram-t/webpack/runtime/css loading","webpack://telegram-t/webpack/runtime/jsonp chunk loading","webpack://telegram-t/./src/util/setupServiceWorker.ts","webpack://telegram-t/./src/global/intervals.ts","webpack://telegram-t/./src/util/init.ts","webpack://telegram-t/./src/global/init.ts","webpack://telegram-t/./src/util/betterView.ts","webpack://telegram-t/./src/util/activeTabMonitor.ts","webpack://telegram-t/./src/components/auth/AuthCode.async.tsx","webpack://telegram-t/./src/components/auth/AuthPassword.async.tsx","webpack://telegram-t/./src/util/fonts.ts","webpack://telegram-t/./src/components/auth/helpers/getSuggestedLanguage.ts","webpack://telegram-t/./src/hooks/useLangString.ts","webpack://telegram-t/./src/components/auth/CountryCodeInput.tsx","webpack://telegram-t/./src/components/auth/AuthPhoneNumber.tsx","webpack://telegram-t/./src/components/auth/AuthQrCode.tsx","webpack://telegram-t/./src/components/auth/AuthRegister.async.tsx","webpack://telegram-t/./src/components/auth/Auth.tsx","webpack://telegram-t/./src/components/App.module.scss?a9d3","webpack://telegram-t/./src/components/common/UiLoader.module.scss?03f6","webpack://telegram-t/./src/components/common/UiLoader.tsx","webpack://telegram-t/./src/components/main/AppInactive.tsx","webpack://telegram-t/./src/components/main/LockScreen.async.tsx","webpack://telegram-t/./src/components/main/Main.async.tsx","webpack://telegram-t/./src/components/App.tsx","webpack://telegram-t/./src/index.tsx","webpack://telegram-t/./src/util/updateWebmanifest.ts"],"sourcesContent":["var getProto = Object.getPrototypeOf ? (obj) => (Object.getPrototypeOf(obj)) : (obj) => (obj.__proto__);\nvar leafPrototypes;\n// create a fake namespace object\n// mode & 1: value is a module id, require it\n// mode & 2: merge all properties of value into the ns\n// mode & 4: return value when already ns object\n// mode & 16: return value when it's Promise-like\n// mode & 8|1: behave like require\n__webpack_require__.t = function(value, mode) {\n\tif(mode & 1) value = this(value);\n\tif(mode & 8) return value;\n\tif(typeof value === 'object' && value) {\n\t\tif((mode & 4) && value.__esModule) return value;\n\t\tif((mode & 16) && typeof value.then === 'function') return value;\n\t}\n\tvar ns = Object.create(null);\n\t__webpack_require__.r(ns);\n\tvar def = {};\n\tleafPrototypes = leafPrototypes || [null, getProto({}), getProto([]), getProto(getProto)];\n\tfor(var current = mode & 2 && value; typeof current == 'object' && !~leafPrototypes.indexOf(current); current = getProto(current)) {\n\t\tObject.getOwnPropertyNames(current).forEach((key) => (def[key] = () => (value[key])));\n\t}\n\tdef['default'] = () => (value);\n\t__webpack_require__.d(ns, def);\n\treturn ns;\n};","var inProgress = {};\nvar dataWebpackPrefix = \"telegram-t:\";\n// loadScript function to load a script via script tag\n__webpack_require__.l = (url, done, key, chunkId) => {\n\tif(inProgress[url]) { inProgress[url].push(done); return; }\n\tvar script, needAttach;\n\tif(key !== undefined) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tfor(var i = 0; i < scripts.length; i++) {\n\t\t\tvar s = scripts[i];\n\t\t\tif(s.getAttribute(\"src\") == url || s.getAttribute(\"data-webpack\") == dataWebpackPrefix + key) { script = s; break; }\n\t\t}\n\t}\n\tif(!script) {\n\t\tneedAttach = true;\n\t\tscript = document.createElement('script');\n\n\t\tscript.charset = 'utf-8';\n\t\tscript.timeout = 120;\n\t\tif (__webpack_require__.nc) {\n\t\t\tscript.setAttribute(\"nonce\", __webpack_require__.nc);\n\t\t}\n\t\tscript.setAttribute(\"data-webpack\", dataWebpackPrefix + key);\n\n\t\tscript.src = url;\n\t}\n\tinProgress[url] = [done];\n\tvar onScriptComplete = (prev, event) => {\n\t\t// avoid mem leaks in IE.\n\t\tscript.onerror = script.onload = null;\n\t\tclearTimeout(timeout);\n\t\tvar doneFns = inProgress[url];\n\t\tdelete inProgress[url];\n\t\tscript.parentNode && script.parentNode.removeChild(script);\n\t\tdoneFns && doneFns.forEach((fn) => (fn(event)));\n\t\tif(prev) return prev(event);\n\t}\n\tvar timeout = setTimeout(onScriptComplete.bind(null, undefined, { type: 'timeout', target: script }), 120000);\n\tscript.onerror = onScriptComplete.bind(null, script.onerror);\n\tscript.onload = onScriptComplete.bind(null, script.onload);\n\tneedAttach && document.head.appendChild(script);\n};","import type { Api } from '../../../lib/gramjs';\nimport type { TypedBroadcastChannel } from '../../../util/multitab';\nimport type { ApiInitialArgs, ApiOnProgress, OnApiUpdate } from '../../types';\nimport type { LocalDb } from '../localDb';\nimport type { MethodArgs, MethodResponse, Methods } from '../methods/types';\nimport type { OriginPayload, ThenArg, WorkerMessageEvent } from './types';\n\nimport { DATA_BROADCAST_CHANNEL_NAME, DEBUG, IGNORE_UNHANDLED_ERRORS } from '../../../config';\nimport { logDebugMessage } from '../../../util/debugConsole';\nimport Deferred from '../../../util/Deferred';\nimport { getCurrentTabId, subscribeToMasterChange } from '../../../util/establishMultitabRole';\nimport generateUniqueId from '../../../util/generateUniqueId';\nimport { pause, throttleWithTickEnd } from '../../../util/schedulers';\nimport { IS_MULTITAB_SUPPORTED } from '../../../util/windowEnvironment';\n\ntype RequestState = {\n  messageId: string;\n  resolve: Function;\n  reject: Function;\n  callback?: AnyToVoidFunction;\n  DEBUG_payload?: any;\n};\n\nconst HEALTH_CHECK_TIMEOUT = 150;\nconst HEALTH_CHECK_MIN_DELAY = 5 * 1000; // 5 sec\nconst NO_QUEUE_BEFORE_INIT = new Set(['destroy']);\n\nlet worker: Worker | undefined;\n\nconst requestStates = new Map<string, RequestState>();\nconst requestStatesByCallback = new Map<AnyToVoidFunction, RequestState>();\n\nlet pendingPayloads: OriginPayload[] = [];\n\nconst savedLocalDb: LocalDb = {\n  chats: {},\n  users: {},\n  documents: {},\n  stickerSets: {},\n  photos: {},\n  webDocuments: {},\n  commonBoxState: {},\n  channelPtsById: {},\n};\n\nlet isMasterTab = true;\nsubscribeToMasterChange((isMasterTabNew) => {\n  isMasterTab = isMasterTabNew;\n});\n\nconst channel = IS_MULTITAB_SUPPORTED\n  ? new BroadcastChannel(DATA_BROADCAST_CHANNEL_NAME) as TypedBroadcastChannel\n  : undefined;\n\nconst postMessagesOnTickEnd = throttleWithTickEnd(() => {\n  const payloads = pendingPayloads;\n  pendingPayloads = [];\n  worker?.postMessage({ payloads });\n});\n\nfunction postMessageOnTickEnd(payload: OriginPayload) {\n  pendingPayloads.push(payload);\n  postMessagesOnTickEnd();\n}\n\nexport function initApiOnMasterTab(initialArgs: ApiInitialArgs) {\n  if (!channel) return;\n\n  channel.postMessage({\n    type: 'initApi',\n    token: getCurrentTabId(),\n    initialArgs,\n  });\n}\n\nlet updateCallback: OnApiUpdate;\n\nlet localApiRequestsQueue: { fnName: any; args: any; deferred: Deferred<any> }[] = [];\nlet apiRequestsQueue: { fnName: any; args: any; deferred: Deferred<any> }[] = [];\nlet isInited = false;\n\nexport function initApi(onUpdate: OnApiUpdate, initialArgs: ApiInitialArgs) {\n  updateCallback = onUpdate;\n\n  if (!isMasterTab) {\n    initApiOnMasterTab(initialArgs);\n    return Promise.resolve();\n  }\n\n  if (!worker) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.log('>>> START LOAD WORKER');\n    }\n\n    worker = new Worker(new URL('./worker.ts', import.meta.url));\n    subscribeToWorker(onUpdate);\n\n    if (initialArgs.platform === 'iOS') {\n      setupIosHealthCheck();\n    }\n  }\n\n  return makeRequest({\n    type: 'initApi',\n    args: [initialArgs, savedLocalDb],\n  }).then(() => {\n    isInited = true;\n\n    apiRequestsQueue.forEach((request) => {\n      callApi(request.fnName, ...request.args)\n        .then(request.deferred.resolve)\n        .catch(request.deferred.reject);\n    });\n    apiRequestsQueue = [];\n\n    localApiRequestsQueue.forEach((request) => {\n      callApiLocal(request.fnName, ...request.args)\n        .then(request.deferred.resolve)\n        .catch(request.deferred.reject);\n    });\n    localApiRequestsQueue = [];\n  });\n}\n\nexport function updateLocalDb(name: keyof LocalDb, prop: string, value: any) {\n  savedLocalDb[name][prop] = value;\n}\n\nexport function updateFullLocalDb(initial: LocalDb) {\n  Object.assign(savedLocalDb, initial);\n}\n\nexport function callApiOnMasterTab(payload: any) {\n  if (!channel) return;\n\n  channel.postMessage({\n    type: 'callApi',\n    token: getCurrentTabId(),\n    ...payload,\n  });\n}\n\nexport function setShouldEnableDebugLog(value: boolean) {\n  return makeRequest({\n    type: 'toggleDebugMode',\n    isEnabled: value,\n  });\n}\n\n/*\n * Call a worker method on this tab's worker, without transferring to master tab\n * Mostly needed to disconnect worker when re-electing master\n */\nexport function callApiLocal<T extends keyof Methods>(fnName: T, ...args: MethodArgs<T>) {\n  if (!isInited) {\n    if (NO_QUEUE_BEFORE_INIT.has(fnName)) {\n      return Promise.resolve(undefined) as MethodResponse<T>;\n    }\n\n    const deferred = new Deferred();\n    localApiRequestsQueue.push({ fnName, args, deferred });\n\n    return deferred.promise as MethodResponse<T>;\n  }\n\n  const promise = makeRequest({\n    type: 'callMethod',\n    name: fnName,\n    args,\n  });\n\n  // Some TypeScript magic to make sure `VirtualClass` is never returned from any method\n  if (DEBUG) {\n    (async () => {\n      try {\n        type ForbiddenTypes =\n          Api.VirtualClass<any>\n          | (Api.VirtualClass<any> | undefined)[];\n        type ForbiddenResponses =\n          ForbiddenTypes\n          | (AnyLiteral & { [k: string]: ForbiddenTypes });\n\n        // Unwrap all chained promises\n        const response = await promise;\n        // Make sure responses do not include `VirtualClass` instances\n        const allowedResponse: Exclude<typeof response, ForbiddenResponses> = response;\n        // Suppress \"unused variable\" constraint\n        void allowedResponse;\n      } catch (err) {\n        // Do noting\n      }\n    })();\n  }\n\n  return promise as MethodResponse<T>;\n}\n\nexport function callApi<T extends keyof Methods>(fnName: T, ...args: MethodArgs<T>) {\n  if (!isInited && isMasterTab) {\n    if (NO_QUEUE_BEFORE_INIT.has(fnName)) {\n      return Promise.resolve(undefined) as MethodResponse<T>;\n    }\n\n    const deferred = new Deferred();\n    apiRequestsQueue.push({ fnName, args, deferred });\n\n    return deferred.promise as MethodResponse<T>;\n  }\n\n  const promise = isMasterTab ? makeRequest({\n    type: 'callMethod',\n    name: fnName,\n    args,\n  }) : makeRequestToMaster({\n    name: fnName,\n    args,\n  });\n\n  // Some TypeScript magic to make sure `VirtualClass` is never returned from any method\n  if (DEBUG) {\n    (async () => {\n      try {\n        type ForbiddenTypes =\n          Api.VirtualClass<any>\n          | (Api.VirtualClass<any> | undefined)[];\n        type ForbiddenResponses =\n          ForbiddenTypes\n          | (AnyLiteral & { [k: string]: ForbiddenTypes });\n\n        // Unwrap all chained promises\n        const response = await promise;\n        // Make sure responses do not include `VirtualClass` instances\n        const allowedResponse: Exclude<typeof response, ForbiddenResponses> = response;\n        // Suppress \"unused variable\" constraint\n        void allowedResponse;\n      } catch (err) {\n        // Do noting\n      }\n    })();\n  }\n\n  return promise as MethodResponse<T>;\n}\n\nexport function cancelApiProgress(progressCallback: ApiOnProgress) {\n  progressCallback.isCanceled = true;\n\n  const { messageId } = requestStatesByCallback.get(progressCallback) || {};\n  if (!messageId) {\n    return;\n  }\n\n  if (isMasterTab) {\n    cancelApiProgressMaster(messageId);\n  } else {\n    if (!channel) return;\n\n    channel.postMessage({\n      type: 'cancelApiProgress',\n      token: getCurrentTabId(),\n      messageId,\n    });\n  }\n}\n\nexport function cancelApiProgressMaster(messageId: string) {\n  postMessageOnTickEnd({\n    type: 'cancelProgress',\n    messageId,\n  });\n}\n\nfunction subscribeToWorker(onUpdate: OnApiUpdate) {\n  worker?.addEventListener('message', ({ data }: WorkerMessageEvent) => {\n    data?.payloads.forEach((payload) => {\n      if (payload.type === 'updates') {\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        let DEBUG_startAt: number | undefined;\n        if (DEBUG) {\n          DEBUG_startAt = performance.now();\n        }\n\n        payload.updates.forEach(onUpdate);\n\n        if (DEBUG) {\n          const duration = performance.now() - DEBUG_startAt!;\n          if (duration > 5) {\n            // eslint-disable-next-line no-console\n            console.warn(`[API] Slow updates processing: ${payload.updates.length} updates in ${duration} ms`);\n          }\n        }\n      } else if (payload.type === 'methodResponse') {\n        handleMethodResponse(payload);\n      } else if (payload.type === 'methodCallback') {\n        handleMethodCallback(payload);\n      } else if (payload.type === 'unhandledError') {\n        const message = payload.error?.message;\n        if (message && IGNORE_UNHANDLED_ERRORS.has(message)) return;\n        throw new Error(message);\n      } else if (payload.type === 'sendBeacon') {\n        navigator.sendBeacon(payload.url, payload.data);\n      } else if (payload.type === 'debugLog') {\n        logDebugMessage(payload.level, ...payload.args);\n      }\n    });\n  });\n}\n\nexport function handleMethodResponse(data: {\n  messageId: string;\n  response?: ThenArg<MethodResponse<keyof Methods>>;\n  error?: { message: string };\n}) {\n  const requestState = requestStates.get(data.messageId);\n  if (requestState) {\n    if (data.error) {\n      requestState.reject(data.error);\n    } else {\n      requestState.resolve(data.response);\n    }\n  }\n}\n\nexport function handleMethodCallback(data: {\n  messageId: string;\n  callbackArgs: any[];\n}) {\n  requestStates.get(data.messageId)?.callback?.(...data.callbackArgs);\n}\n\nfunction makeRequestToMaster(message: {\n  messageId?: string;\n  name: keyof Methods;\n  args: MethodArgs<keyof Methods>;\n  withCallback?: boolean;\n}) {\n  const messageId = generateUniqueId();\n  const payload = {\n    messageId,\n    ...message,\n  };\n\n  const requestState = { messageId } as RequestState;\n\n  // Re-wrap type because of `postMessage`\n  const promise: Promise<MethodResponse<keyof Methods>> = new Promise((resolve, reject) => {\n    Object.assign(requestState, { resolve, reject });\n  });\n\n  if ('args' in payload && 'name' in payload && typeof payload.args[1] === 'function') {\n    payload.withCallback = true;\n\n    const callback = payload.args.pop() as AnyToVoidFunction;\n    requestState.callback = callback;\n    requestStatesByCallback.set(callback, requestState);\n  }\n\n  requestStates.set(messageId, requestState);\n\n  promise\n    .catch(() => undefined)\n    .finally(() => {\n      requestStates.delete(messageId);\n\n      if (requestState.callback) {\n        requestStatesByCallback.delete(requestState.callback);\n      }\n    });\n\n  callApiOnMasterTab(payload);\n\n  return promise;\n}\n\nfunction makeRequest(message: OriginPayload) {\n  const messageId = generateUniqueId();\n  const payload: OriginPayload = {\n    messageId,\n    ...message,\n  };\n\n  const requestState = { messageId } as RequestState;\n\n  // Re-wrap type because of `postMessage`\n  const promise: Promise<MethodResponse<keyof Methods>> = new Promise((resolve, reject) => {\n    Object.assign(requestState, { resolve, reject });\n  });\n\n  if ('args' in payload && 'name' in payload && typeof payload.args[1] === 'function') {\n    payload.withCallback = true;\n\n    const callback = payload.args.pop() as AnyToVoidFunction;\n    requestState.callback = callback;\n    requestStatesByCallback.set(callback, requestState);\n  }\n\n  requestState.DEBUG_payload = payload;\n\n  requestStates.set(messageId, requestState);\n\n  promise\n    .catch(() => undefined)\n    .finally(() => {\n      requestStates.delete(messageId);\n\n      if (requestState.callback) {\n        requestStatesByCallback.delete(requestState.callback);\n      }\n    });\n\n  postMessageOnTickEnd(payload);\n\n  return promise;\n}\n\nconst startedAt = Date.now();\n\n// Workaround for iOS sometimes stops interacting with worker\nfunction setupIosHealthCheck() {\n  window.addEventListener('focus', () => {\n    void ensureWorkerPing();\n    // Sometimes a single check is not enough\n    setTimeout(() => ensureWorkerPing(), 1000);\n  });\n}\n\nasync function ensureWorkerPing() {\n  let isResolved = false;\n\n  try {\n    await Promise.race([\n      makeRequest({ type: 'ping' }),\n      pause(HEALTH_CHECK_TIMEOUT)\n        .then(() => (isResolved ? undefined : Promise.reject(new Error('HEALTH_CHECK_TIMEOUT')))),\n    ]);\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.error(err);\n\n    if (Date.now() - startedAt >= HEALTH_CHECK_MIN_DELAY) {\n      worker?.terminate();\n      worker = undefined;\n      updateCallback({ '@type': 'requestReconnectApi' });\n    }\n  } finally {\n    isResolved = true;\n  }\n}\n","// We cache avatars as Data URI for faster initial load\n// and messages media as Blob for smaller size.\n\nexport enum ApiMediaFormat {\n  BlobUrl,\n  Progressive,\n  DownloadUrl,\n  Text,\n}\n\nexport type ApiParsedMedia = string | Blob | ArrayBuffer;\nexport type ApiPreparedMedia = string;\n","import type { ThreadId, WebPageMediaSize } from '../../types';\nimport type {\n  ApiBotInlineMediaResult,\n  ApiBotInlineResult,\n  ApiWebDocument,\n} from './bots';\nimport type { ApiPeerColor } from './chats';\nimport type { ApiMessageAction } from './messageActions';\nimport type {\n  ApiLabeledPrice,\n} from './payments';\nimport type { ApiStarGiftUnique } from './stars';\nimport type {\n  ApiMessageStoryData, ApiStory, ApiWebPageStickerData, ApiWebPageStoryData,\n} from './stories';\nimport type { ApiInlineQueryPeerType } from './users';\n\nexport interface ApiDimensions {\n  width: number;\n  height: number;\n}\n\nexport interface ApiPhotoSize extends ApiDimensions {\n  type: 's' | 'm' | 'x' | 'y' | 'w';\n}\n\nexport interface ApiVideoSize extends ApiDimensions {\n  type: 'u' | 'v';\n  videoStartTs?: number;\n  size: number;\n}\n\nexport interface ApiThumbnail extends ApiDimensions {\n  dataUri: string;\n}\n\nexport interface ApiPhoto {\n  mediaType: 'photo';\n  id: string;\n  date: number;\n  thumbnail?: ApiThumbnail;\n  isVideo?: boolean;\n  sizes: ApiPhotoSize[];\n  videoSizes?: ApiVideoSize[];\n  blobUrl?: string;\n  isSpoiler?: boolean;\n}\n\nexport interface ApiSticker {\n  mediaType: 'sticker';\n  id: string;\n  stickerSetInfo: ApiStickerSetInfo;\n  emoji?: string;\n  isCustomEmoji?: boolean;\n  isLottie: boolean;\n  isVideo: boolean;\n  width?: number;\n  height?: number;\n  thumbnail?: ApiThumbnail;\n  previewPhotoSizes?: ApiPhotoSize[];\n  isPreloadedGlobally?: boolean;\n  hasEffect?: boolean;\n  isFree?: boolean;\n  shouldUseTextColor?: boolean;\n}\n\nexport interface ApiStickerSet {\n  isArchived?: true;\n  isEmoji?: true;\n  installedDate?: number;\n  id: string;\n  accessHash: string;\n  title: string;\n  hasThumbnail?: boolean;\n  hasStaticThumb?: boolean;\n  hasAnimatedThumb?: boolean;\n  hasVideoThumb?: boolean;\n  thumbCustomEmojiId?: string;\n  count: number;\n  stickers?: ApiSticker[];\n  packs?: Record<string, ApiSticker[]>;\n  covers?: ApiSticker[];\n  shortName: string;\n}\n\ntype ApiStickerSetInfoShortName = {\n  shortName: string;\n};\n\ntype ApiStickerSetInfoId = {\n  id: string;\n  accessHash: string;\n};\n\ntype ApiStickerSetInfoMissing = {\n  isMissing: true;\n};\n\nexport type ApiStickerSetInfo = ApiStickerSetInfoShortName | ApiStickerSetInfoId | ApiStickerSetInfoMissing;\n\nexport interface ApiVideo {\n  mediaType: 'video';\n  id: string;\n  mimeType: string;\n  duration: number;\n  fileName: string;\n  width?: number;\n  height?: number;\n  supportsStreaming?: boolean;\n  isRound?: boolean;\n  isGif?: boolean;\n  hasVideoPreview?: boolean;\n  isSpoiler?: boolean;\n  thumbnail?: ApiThumbnail;\n  previewPhotoSizes?: ApiPhotoSize[];\n  blobUrl?: string;\n  previewBlobUrl?: string;\n  size: number;\n  noSound?: boolean;\n  waveform?: number[];\n  timestamp?: number;\n}\n\nexport interface ApiAudio {\n  mediaType: 'audio';\n  id: string;\n  size: number;\n  mimeType: string;\n  fileName: string;\n  duration: number;\n  performer?: string;\n  title?: string;\n  thumbnailSizes?: ApiPhotoSize[];\n}\n\nexport interface ApiVoice {\n  mediaType: 'voice';\n  id: string;\n  duration: number;\n  waveform?: number[];\n  size: number;\n}\n\nexport interface ApiDocument {\n  mediaType: 'document';\n  id?: string;\n  fileName: string;\n  size: number;\n  timestamp?: number;\n  mimeType: string;\n  thumbnail?: ApiThumbnail;\n  previewPhotoSizes?: ApiPhotoSize[];\n  previewBlobUrl?: string;\n  innerMediaType?: 'photo' | 'video';\n  mediaSize?: ApiDimensions;\n}\n\nexport interface ApiContact {\n  mediaType: 'contact';\n  firstName: string;\n  lastName: string;\n  phoneNumber: string;\n  userId: string;\n}\n\nexport type ApiPaidMedia = {\n  mediaType: 'paidMedia';\n  starsAmount: number;\n} & ({\n  isBought?: true;\n  extendedMedia: BoughtPaidMedia[];\n} | {\n  isBought?: undefined;\n  extendedMedia: ApiMediaExtendedPreview[];\n});\n\nexport interface ApiPollAnswer {\n  text: ApiFormattedText;\n  option: string;\n}\n\nexport interface ApiPollResult {\n  isChosen?: true;\n  isCorrect?: true;\n  option: string;\n  votersCount: number;\n}\n\nexport interface ApiPoll {\n  mediaType: 'poll';\n  id: string;\n  summary: {\n    closed?: true;\n    isPublic?: true;\n    multipleChoice?: true;\n    quiz?: true;\n    question: ApiFormattedText;\n    answers: ApiPollAnswer[];\n    closePeriod?: number;\n    closeDate?: number;\n  };\n  results: {\n    isMin?: true;\n    results?: ApiPollResult[];\n    totalVoters?: number;\n    recentVoterIds?: string[];\n    solution?: string;\n    solutionEntities?: ApiMessageEntity[];\n  };\n}\n\nexport interface ApiInvoice {\n  prices: ApiLabeledPrice[];\n  totalAmount: number;\n  currency: string;\n  isTest?: boolean;\n  isRecurring?: boolean;\n  subscriptionPeriod?: number;\n  termsUrl?: string;\n  maxTipAmount?: number;\n  suggestedTipAmounts?: number[];\n  isNameRequested?: boolean;\n  isPhoneRequested?: boolean;\n  isEmailRequested?: boolean;\n  isShippingAddressRequested?: boolean;\n  isFlexible?: boolean;\n  isPhoneSentToProvider?: boolean;\n  isEmailSentToProvider?: boolean;\n}\n\nexport interface ApiMediaInvoice {\n  mediaType: 'invoice';\n  title: string;\n  description: string;\n  photo?: ApiWebDocument;\n  isTest?: boolean;\n  receiptMessageId?: number;\n  currency: string;\n  amount: number;\n  extendedMedia?: ApiMediaExtendedPreview;\n}\n\nexport interface ApiMediaExtendedPreview {\n  mediaType: 'extendedMediaPreview';\n  width?: number;\n  height?: number;\n  thumbnail?: ApiThumbnail;\n  duration?: number;\n}\n\nexport interface ApiPaymentCredentials {\n  id: string;\n  title: string;\n}\n\nexport interface ApiGeoPoint {\n  long: number;\n  lat: number;\n  accessHash: string;\n  accuracyRadius?: number;\n}\n\nexport interface ApiGeo {\n  mediaType: 'geo';\n  geo: ApiGeoPoint;\n}\n\nexport interface ApiVenue {\n  mediaType: 'venue';\n  geo: ApiGeoPoint;\n  title: string;\n  address: string;\n  provider: string;\n  venueId: string;\n  venueType: string;\n}\n\nexport interface ApiGeoLive {\n  mediaType: 'geoLive';\n  geo: ApiGeoPoint;\n  heading?: number;\n  period: number;\n}\n\nexport type ApiLocation = ApiGeo | ApiVenue | ApiGeoLive;\n\nexport type ApiGame = {\n  mediaType: 'game';\n  title: string;\n  description: string;\n  photo?: ApiPhoto;\n  shortName: string;\n  id: string;\n  accessHash: string;\n  document?: ApiDocument;\n};\n\nexport type ApiGiveaway = {\n  mediaType: 'giveaway';\n  quantity: number;\n  months?: number;\n  stars?: number;\n  untilDate: number;\n  isOnlyForNewSubscribers?: true;\n  countries?: string[];\n  channelIds: string[];\n  prizeDescription?: string;\n};\n\nexport type ApiGiveawayResults = {\n  mediaType: 'giveawayResults';\n  months?: number;\n  stars?: number;\n  untilDate: number;\n  isRefunded?: true;\n  isOnlyForNewSubscribers?: true;\n  channelId: string;\n  prizeDescription?: string;\n  winnersCount?: number;\n  winnerIds: string[];\n  additionalPeersCount?: number;\n  launchMessageId: number;\n  unclaimedCount: number;\n};\n\nexport type ApiNewPoll = {\n  summary: ApiPoll['summary'];\n  quiz?: {\n    correctAnswers: string[];\n    solution?: string;\n    solutionEntities?: ApiMessageEntity[];\n  };\n};\n\nexport interface ApiWebPage {\n  mediaType: 'webpage';\n  id: number;\n  url: string;\n  displayUrl: string;\n  type?: string;\n  siteName?: string;\n  title?: string;\n  description?: string;\n  photo?: ApiPhoto;\n  audio?: ApiAudio;\n  duration?: number;\n  document?: ApiDocument;\n  video?: ApiVideo;\n  story?: ApiWebPageStoryData;\n  gift?: ApiStarGiftUnique;\n  stickers?: ApiWebPageStickerData;\n  mediaSize?: WebPageMediaSize;\n  hasLargeMedia?: boolean;\n}\n\nexport type ApiReplyInfo = ApiMessageReplyInfo | ApiStoryReplyInfo;\n\nexport interface ApiMessageReplyInfo {\n  type: 'message';\n  replyToMsgId?: number;\n  replyToPeerId?: string;\n  replyFrom?: ApiMessageForwardInfo;\n  replyMedia?: MediaContent;\n  replyToTopId?: number;\n  isForumTopic?: true;\n  isQuote?: true;\n  quoteText?: ApiFormattedText;\n}\n\nexport interface ApiStoryReplyInfo {\n  type: 'story';\n  peerId: string;\n  storyId: number;\n}\n\nexport interface ApiInputMessageReplyInfo {\n  type: 'message';\n  replyToMsgId: number;\n  replyToTopId?: number;\n  replyToPeerId?: string;\n  quoteText?: ApiFormattedText;\n}\n\nexport interface ApiInputStoryReplyInfo {\n  type: 'story';\n  peerId: string;\n  storyId: number;\n}\n\nexport type ApiInputReplyInfo = ApiInputMessageReplyInfo | ApiInputStoryReplyInfo;\n\nexport interface ApiMessageForwardInfo {\n  date: number;\n  savedDate?: number;\n  isImported?: boolean;\n  isChannelPost: boolean;\n  channelPostId?: number;\n  isLinkedChannelPost?: boolean;\n  fromChatId?: string;\n  fromId?: string;\n  savedFromPeerId?: string;\n  isSavedOutgoing?: boolean;\n  fromMessageId?: number;\n  hiddenUserName?: string;\n  postAuthorTitle?: string;\n}\n\nexport interface ApiStoryForwardInfo {\n  fromPeerId?: string;\n  fromName?: string;\n  storyId?: number;\n  isModified?: boolean;\n}\n\nexport type ApiMessageEntityDefault = {\n  type: Exclude<\n  `${ApiMessageEntityTypes}`,\n  `${ApiMessageEntityTypes.Pre}` | `${ApiMessageEntityTypes.TextUrl}` | `${ApiMessageEntityTypes.MentionName}` |\n  `${ApiMessageEntityTypes.CustomEmoji}` | `${ApiMessageEntityTypes.Blockquote}` | `${ApiMessageEntityTypes.Timestamp}`\n  >;\n  offset: number;\n  length: number;\n};\n\nexport type ApiMessageEntityPre = {\n  type: ApiMessageEntityTypes.Pre;\n  offset: number;\n  length: number;\n  language?: string;\n};\n\nexport type ApiMessageEntityTextUrl = {\n  type: ApiMessageEntityTypes.TextUrl;\n  offset: number;\n  length: number;\n  url: string;\n};\n\nexport type ApiMessageEntityMentionName = {\n  type: ApiMessageEntityTypes.MentionName;\n  offset: number;\n  length: number;\n  userId: string;\n};\n\nexport type ApiMessageEntityBlockquote = {\n  type: ApiMessageEntityTypes.Blockquote;\n  offset: number;\n  length: number;\n  canCollapse?: boolean;\n};\n\nexport type ApiMessageEntityCustomEmoji = {\n  type: ApiMessageEntityTypes.CustomEmoji;\n  offset: number;\n  length: number;\n  documentId: string;\n};\n\nexport type ApiMessageEntityTimestamp = {\n  type: ApiMessageEntityTypes.Timestamp;\n  offset: number;\n  length: number;\n  timestamp: number;\n};\n\nexport type ApiMessageEntity = ApiMessageEntityDefault | ApiMessageEntityPre | ApiMessageEntityTextUrl |\nApiMessageEntityMentionName | ApiMessageEntityCustomEmoji | ApiMessageEntityBlockquote | ApiMessageEntityTimestamp;\n\nexport enum ApiMessageEntityTypes {\n  Bold = 'MessageEntityBold',\n  Blockquote = 'MessageEntityBlockquote',\n  BotCommand = 'MessageEntityBotCommand',\n  Cashtag = 'MessageEntityCashtag',\n  Code = 'MessageEntityCode',\n  Email = 'MessageEntityEmail',\n  Hashtag = 'MessageEntityHashtag',\n  Italic = 'MessageEntityItalic',\n  MentionName = 'MessageEntityMentionName',\n  Mention = 'MessageEntityMention',\n  Phone = 'MessageEntityPhone',\n  Pre = 'MessageEntityPre',\n  Strike = 'MessageEntityStrike',\n  TextUrl = 'MessageEntityTextUrl',\n  Url = 'MessageEntityUrl',\n  Underline = 'MessageEntityUnderline',\n  Spoiler = 'MessageEntitySpoiler',\n  CustomEmoji = 'MessageEntityCustomEmoji',\n  Timestamp = 'MessageEntityTimestamp',\n  Unknown = 'MessageEntityUnknown',\n}\n\nexport interface ApiFormattedText {\n  text: string;\n  entities?: ApiMessageEntity[];\n}\n\nexport type MediaContent = {\n  text?: ApiFormattedText;\n  photo?: ApiPhoto;\n  video?: ApiVideo;\n  altVideos?: ApiVideo[];\n  document?: ApiDocument;\n  sticker?: ApiSticker;\n  contact?: ApiContact;\n  pollId?: string;\n  action?: ApiMessageAction;\n  webPage?: ApiWebPage;\n  audio?: ApiAudio;\n  voice?: ApiVoice;\n  invoice?: ApiMediaInvoice;\n  location?: ApiLocation;\n  game?: ApiGame;\n  storyData?: ApiMessageStoryData;\n  giveaway?: ApiGiveaway;\n  giveawayResults?: ApiGiveawayResults;\n  paidMedia?: ApiPaidMedia;\n  ttlSeconds?: number;\n};\nexport type MediaContainer = {\n  content: MediaContent;\n};\n\nexport type StatefulMediaContent = {\n  poll?: ApiPoll;\n  story?: ApiStory;\n};\n\nexport type BoughtPaidMedia = Pick<MediaContent, 'photo' | 'video'>;\n\nexport interface ApiMessage {\n  id: number;\n  chatId: string;\n  content: MediaContent;\n  date: number;\n  isOutgoing: boolean;\n  senderId?: string;\n  replyInfo?: ApiReplyInfo;\n  sendingState?: 'messageSendingStatePending' | 'messageSendingStateFailed';\n  forwardInfo?: ApiMessageForwardInfo;\n  isDeleting?: boolean;\n  previousLocalId?: number;\n  viewsCount?: number;\n  forwardsCount?: number;\n  isEdited?: boolean;\n  editDate?: number;\n  isMentioned?: boolean;\n  isMediaUnread?: boolean;\n  groupedId?: string;\n  isInAlbum?: boolean;\n  hasUnreadMention?: boolean;\n  inlineButtons?: ApiKeyboardButtons;\n  keyboardButtons?: ApiKeyboardButtons;\n  keyboardPlaceholder?: string;\n  isKeyboardSingleUse?: boolean;\n  isKeyboardSelective?: boolean;\n  viaBotId?: string;\n  viaBusinessBotId?: string;\n  postAuthorTitle?: string;\n  isScheduled?: boolean;\n  shouldHideKeyboardButtons?: boolean;\n  isHideKeyboardSelective?: boolean;\n  isFromScheduled?: boolean;\n  isSilent?: boolean;\n  isPinned?: boolean;\n  seenByDates?: Record<string, number>;\n  isProtected?: boolean;\n  isForwardingAllowed?: boolean;\n  transcriptionId?: string;\n  isTranscriptionError?: boolean;\n  emojiOnlyCount?: number;\n  reactors?: {\n    nextOffset?: string;\n    count: number;\n    reactions: ApiPeerReaction[];\n  };\n  reactions?: ApiReactions;\n  hasComments?: boolean;\n  readDate?: number;\n  savedPeerId?: string;\n  senderBoosts?: number;\n  factCheck?: ApiFactCheck;\n  effectId?: string;\n  isInvertedMedia?: true;\n  isVideoProcessingPending?: true;\n  areReactionsPossible?: true;\n  reportDeliveryUntilDate?: number;\n}\n\nexport interface ApiReactions {\n  canSeeList?: boolean;\n  areTags?: boolean;\n  results: ApiReactionCount[];\n  recentReactions?: ApiPeerReaction[];\n  topReactors?: ApiMessageReactor[];\n}\n\nexport interface ApiPeerReaction {\n  peerId: string;\n  reaction: ApiReaction;\n  isOwn?: boolean;\n  isBig?: boolean;\n  isUnread?: boolean;\n  addedDate: number;\n}\n\nexport interface ApiMessageReactor {\n  isTop?: true;\n  isMy?: true;\n  count: number;\n  isAnonymous?: true;\n  peerId?: string;\n}\n\nexport interface ApiReactionCount {\n  chosenOrder?: number;\n  count: number;\n  reaction: ApiReactionWithPaid;\n  localAmount?: number;\n  localIsPrivate?: boolean;\n  localPeerId?: string;\n  localPreviousChosenOrder?: number;\n}\n\nexport interface ApiAvailableReaction {\n  selectAnimation?: ApiDocument;\n  appearAnimation?: ApiDocument;\n  activateAnimation?: ApiDocument;\n  effectAnimation?: ApiDocument;\n  staticIcon?: ApiDocument;\n  centerIcon?: ApiDocument;\n  aroundAnimation?: ApiDocument;\n  reaction: ApiReactionEmoji;\n  title: string;\n  isInactive?: boolean;\n  isPremium?: boolean;\n}\n\nexport interface ApiAvailableEffect {\n  id: string;\n  emoticon: string;\n  staticIconId?: string;\n  effectAnimationId?: string;\n  effectStickerId: string;\n  isPremium?: boolean;\n}\n\ntype ApiChatReactionsAll = {\n  type: 'all';\n  areCustomAllowed?: true;\n};\n\ntype ApiChatReactionsSome = {\n  type: 'some';\n  allowed: ApiReaction[];\n};\n\nexport type ApiChatReactions = ApiChatReactionsAll | ApiChatReactionsSome;\n\nexport type ApiReactionEmoji = {\n  type: 'emoji';\n  emoticon: string;\n};\n\nexport type ApiReactionCustomEmoji = {\n  type: 'custom';\n  documentId: string;\n};\n\nexport type ApiReactionPaid = {\n  type: 'paid';\n};\n\nexport type ApiReaction = ApiReactionEmoji | ApiReactionCustomEmoji;\nexport type ApiReactionWithPaid = ApiReaction | ApiReactionPaid;\n\nexport type ApiReactionKey = `${string}-${string}` | 'paid' | 'unsupported';\n\nexport type ApiSavedReactionTag = {\n  reaction: ApiReaction;\n  title?: string;\n  count: number;\n};\n\nexport type ApiPaidReactionPrivacyType = ApiPaidReactionPrivacyDefault |\nApiPaidReactionPrivacyAnonymous | PaidReactionPrivacyPeer;\n\nexport type ApiPaidReactionPrivacyDefault = {\n  type: 'default';\n};\n\nexport type ApiPaidReactionPrivacyAnonymous = {\n  type: 'anonymous';\n};\n\nexport type PaidReactionPrivacyPeer = {\n  type: 'peer';\n  peerId: string;\n};\n\ninterface ApiBaseThreadInfo {\n  chatId: string;\n  messagesCount: number;\n  lastMessageId?: number;\n  lastReadInboxMessageId?: number;\n  recentReplierIds?: string[];\n}\n\nexport interface ApiCommentsInfo extends ApiBaseThreadInfo {\n  isCommentsInfo: true;\n  threadId?: never;\n  originChannelId: string;\n  originMessageId: number;\n}\n\nexport interface ApiMessageThreadInfo extends ApiBaseThreadInfo {\n  isCommentsInfo: false;\n  threadId: ThreadId;\n  // For linked messages in discussion\n  fromChannelId?: string;\n  fromMessageId?: number;\n}\n\nexport type ApiThreadInfo = ApiCommentsInfo | ApiMessageThreadInfo;\n\nexport type ApiMessageReportResult = {\n  type: 'reported';\n} | {\n  type: 'comment';\n  isOptional?: boolean;\n  option: string;\n} | {\n  type: 'selectOption';\n  title: string;\n  options: {\n    text: string;\n    option: string;\n  }[];\n};\n\nexport type ApiMessageOutgoingStatus = 'read' | 'succeeded' | 'pending' | 'failed';\n\nexport type ApiSponsoredMessage = {\n  chatId: string;\n  randomId: string;\n  isRecommended?: true;\n  expiresAt: number;\n  sponsorInfo?: string;\n  additionalInfo?: string;\n  buttonText?: string;\n  canReport?: true;\n  title: string;\n  url: string;\n  photo?: ApiPhoto;\n  content: MediaContent;\n  peerColor?: ApiPeerColor;\n};\n\n// KeyboardButtons\n\ninterface ApiKeyboardButtonSimple {\n  type: 'unsupported' | 'buy' | 'command' | 'requestPhone' | 'game';\n  text: string;\n}\n\ninterface ApiKeyboardButtonReceipt {\n  type: 'receipt';\n  receiptMessageId: number;\n}\n\ninterface ApiKeyboardButtonUrl {\n  type: 'url';\n  text: string;\n  url: string;\n}\n\ninterface ApiKeyboardButtonSimpleWebView {\n  type: 'simpleWebView';\n  text: string;\n  url: string;\n}\n\ninterface ApiKeyboardButtonWebView {\n  type: 'webView';\n  text: string;\n  url: string;\n}\n\ninterface ApiKeyboardButtonCallback {\n  type: 'callback';\n  text: string;\n  data: string;\n}\n\ninterface ApiKeyboardButtonRequestPoll {\n  type: 'requestPoll';\n  text: string;\n  isQuiz?: boolean;\n}\n\ninterface ApiKeyboardButtonSwitchBotInline {\n  type: 'switchBotInline';\n  text: string;\n  query: string;\n  isSamePeer?: boolean;\n}\n\ninterface ApiKeyboardButtonUserProfile {\n  type: 'userProfile';\n  text: string;\n  userId: string;\n}\n\ninterface ApiKeyboardButtonUrlAuth {\n  type: 'urlAuth';\n  text: string;\n  url: string;\n  buttonId: number;\n}\n\ninterface ApiKeyboardButtonCopy {\n  type: 'copy';\n  text: string;\n  copyText: string;\n}\n\nexport type ApiKeyboardButton = (\n  ApiKeyboardButtonSimple\n  | ApiKeyboardButtonReceipt\n  | ApiKeyboardButtonUrl\n  | ApiKeyboardButtonCallback\n  | ApiKeyboardButtonRequestPoll\n  | ApiKeyboardButtonSwitchBotInline\n  | ApiKeyboardButtonUserProfile\n  | ApiKeyboardButtonWebView\n  | ApiKeyboardButtonSimpleWebView\n  | ApiKeyboardButtonUrlAuth\n  | ApiKeyboardButtonCopy\n);\n\nexport type ApiKeyboardButtons = ApiKeyboardButton[][];\nexport type ApiReplyKeyboard = {\n  keyboardPlaceholder?: string;\n  isKeyboardSingleUse?: boolean;\n  isKeyboardSelective?: boolean;\n} & {\n  [K in 'inlineButtons' | 'keyboardButtons']?: ApiKeyboardButtons;\n};\n\nexport type ApiTranscription = {\n  text: string;\n  isPending?: boolean;\n  transcriptionId: string;\n};\n\nexport type ApiMessageSearchType = 'text' | 'media' | 'documents' | 'links' | 'audio' | 'voice' | 'profilePhoto';\nexport type ApiGlobalMessageSearchType = 'text' | 'channels' | 'media' | 'documents' | 'links' | 'audio' | 'voice';\nexport type ApiMessageSearchContext = 'all' | 'users' | 'groups' | 'channels';\n\nexport type ApiReportReason = 'spam' | 'violence' | 'pornography' | 'childAbuse'\n| 'copyright' | 'geoIrrelevant' | 'fake' | 'illegalDrugs' | 'personalDetails' | 'other';\n\nexport type ApiSendMessageAction = {\n  type: 'cancel' | 'typing' | 'recordAudio' | 'chooseSticker' | 'playingGame';\n};\n\nexport type ApiThemeParameters = {\n  bg_color: string;\n  text_color: string;\n  hint_color: string;\n  link_color: string;\n  button_color: string;\n  button_text_color: string;\n  secondary_bg_color: string;\n  header_bg_color: string;\n  accent_text_color: string;\n  section_bg_color: string;\n  section_header_text_color: string;\n  subtitle_text_color: string;\n  destructive_text_color: string;\n  section_separator_color: string;\n};\n\nexport type ApiBotApp = {\n  id: string;\n  accessHash: string;\n  title: string;\n  shortName: string;\n  description: string;\n  photo?: ApiPhoto;\n  document?: ApiDocument;\n};\n\nexport type ApiMessagesBotApp = ApiBotApp & {\n  isInactive?: boolean;\n  shouldRequestWriteAccess?: boolean;\n};\n\nexport type ApiQuickReply = {\n  id: number;\n  shortcut: string;\n  topMessageId: number;\n};\n\nexport type ApiFactCheck = {\n  shouldFetch?: true;\n  hash: string;\n  countryCode?: string;\n  text?: ApiFormattedText;\n};\n\nexport type ApiSponsoredMessageReportResult = {\n  type: 'reported' | 'hidden' | 'premiumRequired';\n} | {\n  type: 'selectOption';\n  title: string;\n  options: {\n    text: string;\n    option: string;\n  }[];\n};\n\nexport type ApiPreparedInlineMessage = {\n  queryId: string;\n  result: ApiBotInlineResult | ApiBotInlineMediaResult;\n  peerTypes: ApiInlineQueryPeerType[];\n  cacheTime: number;\n};\n\nexport const MAIN_THREAD_ID = -1;\n\n// `Symbol` can not be transferred from worker\nexport const MESSAGE_DELETED = 'MESSAGE_DELETED';\n","import React, { memo, useState } from '../../lib/teact/teact';\n\nimport type { OwnProps as AnimatedStickerProps } from './AnimatedSticker';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport useFlag from '../../hooks/useFlag';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useMediaTransitionDeprecated from '../../hooks/useMediaTransitionDeprecated';\n\nimport AnimatedSticker from './AnimatedSticker';\n\nconst DEFAULT_SIZE = 150;\n\nexport type OwnProps =\n  Partial<AnimatedStickerProps>\n  & { noTransition?: boolean; nonInteractive?: boolean };\n\nfunction AnimatedIcon(props: OwnProps) {\n  const {\n    size = DEFAULT_SIZE,\n    play = true,\n    noLoop = true,\n    className,\n    noTransition,\n    nonInteractive,\n    onLoad,\n    onClick,\n    ...otherProps\n  } = props;\n  const [isAnimationLoaded, markAnimationLoaded] = useFlag(false);\n  const transitionClassNames = useMediaTransitionDeprecated(noTransition || isAnimationLoaded);\n\n  const handleLoad = useLastCallback(() => {\n    markAnimationLoaded();\n    onLoad?.();\n  });\n\n  const [playKey, setPlayKey] = useState(String(Math.random()));\n\n  const handleClick = useLastCallback(() => {\n    if (play === true) {\n      setPlayKey(String(Math.random()));\n    }\n\n    onClick?.();\n  });\n\n  return (\n    <AnimatedSticker\n      className={buildClassName(className, transitionClassNames)}\n      size={size}\n      play={play === true ? playKey : play}\n      noLoop={noLoop}\n      onClick={!nonInteractive ? handleClick : undefined}\n      onLoad={handleLoad}\n      /* eslint-disable-next-line react/jsx-props-no-spreading */\n      {...otherProps}\n    />\n  );\n}\n\nexport default memo(AnimatedIcon);\n","import type { RefObject } from 'react';\nimport type { FC } from '../../lib/teact/teact';\nimport React, {\n  getIsHeavyAnimating,\n  memo,\n  useEffect,\n  useRef,\n  useState,\n  useUnmountCleanup,\n} from '../../lib/teact/teact';\n\nimport type RLottieInstance from '../../lib/rlottie/RLottie';\n\nimport { requestMeasure } from '../../lib/fasterdom/fasterdom';\nimport { ensureRLottie, getRLottie } from '../../lib/rlottie/RLottie.async';\nimport buildClassName from '../../util/buildClassName';\nimport buildStyle from '../../util/buildStyle';\nimport generateUniqueId from '../../util/generateUniqueId';\nimport { hexToRgb } from '../../util/switchTheme';\nimport { IS_ELECTRON } from '../../util/windowEnvironment';\n\nimport useColorFilter from '../../hooks/stickers/useColorFilter';\nimport useEffectWithPrevDeps from '../../hooks/useEffectWithPrevDeps';\nimport useFlag from '../../hooks/useFlag';\nimport useHeavyAnimation from '../../hooks/useHeavyAnimation';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport usePriorityPlaybackCheck, { isPriorityPlaybackActive } from '../../hooks/usePriorityPlaybackCheck';\nimport useSharedIntersectionObserver from '../../hooks/useSharedIntersectionObserver';\nimport { useStateRef } from '../../hooks/useStateRef';\nimport useSyncEffect from '../../hooks/useSyncEffect';\nimport useThrottledCallback from '../../hooks/useThrottledCallback';\nimport useUniqueId from '../../hooks/useUniqueId';\nimport useBackgroundMode, { isBackgroundModeActive } from '../../hooks/window/useBackgroundMode';\n\nexport type OwnProps = {\n  ref?: RefObject<HTMLDivElement>;\n  renderId?: string;\n  className?: string;\n  style?: string;\n  tgsUrl?: string;\n  play?: boolean | string;\n  playSegment?: [number, number];\n  speed?: number;\n  noLoop?: boolean;\n  size: number;\n  quality?: number;\n  color?: string;\n  isLowPriority?: boolean;\n  forceAlways?: boolean;\n  forceOnHeavyAnimation?: boolean;\n  sharedCanvas?: HTMLCanvasElement;\n  sharedCanvasCoords?: { x: number; y: number };\n  onClick?: NoneToVoidFunction;\n  onLoad?: NoneToVoidFunction;\n  onEnded?: NoneToVoidFunction;\n  onLoop?: NoneToVoidFunction;\n};\n\nconst THROTTLE_MS = 150;\n\nconst AnimatedSticker: FC<OwnProps> = ({\n  ref,\n  renderId,\n  className,\n  style,\n  tgsUrl,\n  play,\n  playSegment,\n  speed,\n  noLoop,\n  size,\n  quality,\n  isLowPriority,\n  color,\n  forceAlways,\n  forceOnHeavyAnimation,\n  sharedCanvas,\n  sharedCanvasCoords,\n  onClick,\n  onLoad,\n  onEnded,\n  onLoop,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  let containerRef = useRef<HTMLDivElement>(null);\n  if (ref) {\n    containerRef = ref;\n  }\n\n  const viewId = useUniqueId();\n\n  const [animation, setAnimation] = useState<RLottieInstance>();\n  const animationRef = useRef<RLottieInstance>();\n  const isFirstRender = useRef(true);\n\n  const shouldUseColorFilter = !sharedCanvas && color;\n  const colorFilter = useColorFilter(shouldUseColorFilter ? color : undefined);\n\n  const playKey = play || (play === false ? false : playSegment);\n  const playRef = useStateRef(play);\n  const playSegmentRef = useStateRef(playSegment);\n\n  const rgbColor = useRef<[number, number, number] | undefined>();\n\n  const shouldForceOnHeavyAnimation = forceAlways || forceOnHeavyAnimation;\n  // Delay initialization until heavy animation ends\n  const [\n    canInitialize, markCanInitialize, unmarkCanInitialize,\n  ] = useFlag(!getIsHeavyAnimating() || shouldForceOnHeavyAnimation);\n  useHeavyAnimation(unmarkCanInitialize, markCanInitialize, shouldForceOnHeavyAnimation);\n  useEffect(() => {\n    if (shouldForceOnHeavyAnimation) markCanInitialize();\n  }, [shouldForceOnHeavyAnimation]);\n\n  useSyncEffect(() => {\n    if (color && !shouldUseColorFilter) {\n      const { r, g, b } = hexToRgb(color);\n      rgbColor.current = [r, g, b];\n    } else {\n      rgbColor.current = undefined;\n    }\n  }, [color, shouldUseColorFilter]);\n\n  const isUnmountedRef = useRef(false);\n  useUnmountCleanup(() => {\n    isUnmountedRef.current = true;\n  });\n\n  const init = useLastCallback(() => {\n    if (\n      animationRef.current\n      || isUnmountedRef.current\n      || !tgsUrl\n      || (sharedCanvas && (!sharedCanvasCoords || !sharedCanvas.offsetWidth || !sharedCanvas.offsetHeight))\n      || (getIsHeavyAnimating() && !shouldForceOnHeavyAnimation)\n    ) {\n      return;\n    }\n\n    const container = containerRef.current || sharedCanvas;\n    if (!container) {\n      return;\n    }\n\n    const newAnimation = getRLottie().init(\n      tgsUrl,\n      container,\n      renderId || generateUniqueId(),\n      {\n        size,\n        noLoop,\n        quality,\n        isLowPriority,\n        coords: sharedCanvasCoords,\n      },\n      viewId,\n      rgbColor.current,\n      onLoad,\n      onEnded,\n      onLoop,\n    );\n\n    if (speed) {\n      newAnimation.setSpeed(speed);\n    }\n\n    setAnimation(newAnimation);\n    animationRef.current = newAnimation;\n  });\n\n  useEffect(() => {\n    if (!canInitialize) return;\n    if (getRLottie()) {\n      init();\n    } else {\n      ensureRLottie().then(init);\n    }\n  }, [init, tgsUrl, sharedCanvas, sharedCanvasCoords, canInitialize]);\n\n  const throttledInit = useThrottledCallback(init, [init], THROTTLE_MS);\n  useSharedIntersectionObserver(sharedCanvas, throttledInit);\n\n  useEffect(() => {\n    if (!animation) return;\n\n    animation.setColor(rgbColor.current);\n  }, [color, animation]);\n\n  useUnmountCleanup(() => {\n    animationRef.current?.removeView(viewId);\n  });\n\n  const playAnimation = useLastCallback((shouldRestart = false) => {\n    if (\n      !animation\n      || !(playRef.current || playSegmentRef.current)\n      || isFrozen(forceAlways)\n    ) {\n      return;\n    }\n\n    if (playSegmentRef.current) {\n      animation.playSegment(playSegmentRef.current, shouldRestart, viewId);\n    } else {\n      animation.play(shouldRestart, viewId);\n    }\n  });\n\n  const playAnimationOnRaf = useLastCallback(() => {\n    requestMeasure(playAnimation);\n  });\n\n  const pauseAnimation = useLastCallback(() => {\n    if (animation?.isPlaying()) {\n      animation.pause(viewId);\n    }\n  });\n\n  useEffectWithPrevDeps(([prevNoLoop]) => {\n    if (prevNoLoop !== undefined && noLoop !== prevNoLoop) {\n      animation?.setNoLoop(noLoop);\n    }\n  }, [noLoop, animation]);\n\n  useEffectWithPrevDeps(([prevSharedCanvasCoords]) => {\n    if (prevSharedCanvasCoords !== undefined && sharedCanvasCoords !== prevSharedCanvasCoords) {\n      animation?.setSharedCanvasCoords(viewId, sharedCanvasCoords);\n    }\n  }, [sharedCanvasCoords, viewId, animation]);\n\n  useEffect(() => {\n    if (!animation) {\n      return;\n    }\n\n    if (playKey) {\n      if (!isFrozen(forceAlways, forceOnHeavyAnimation)) {\n        playAnimation(noLoop);\n      }\n    } else {\n      pauseAnimation();\n    }\n  }, [animation, playKey, noLoop, playAnimation, pauseAnimation, forceAlways, forceOnHeavyAnimation]);\n\n  useEffect(() => {\n    if (animation) {\n      if (isFirstRender.current) {\n        isFirstRender.current = false;\n      } else if (tgsUrl) {\n        animation.changeData(tgsUrl);\n        playAnimation();\n      }\n    }\n  }, [playAnimation, animation, tgsUrl]);\n\n  useHeavyAnimation(pauseAnimation, playAnimation, !playKey || shouldForceOnHeavyAnimation);\n  usePriorityPlaybackCheck(pauseAnimation, playAnimation, !playKey || forceAlways);\n  // Pausing frame may not happen in background,\n  // so we need to make sure it happens right after focusing,\n  // then we can play again.\n  useBackgroundMode(pauseAnimation, playAnimationOnRaf, !playKey || forceAlways);\n\n  if (sharedCanvas) {\n    return undefined;\n  }\n\n  return (\n    <div\n      ref={containerRef}\n      className={buildClassName('AnimatedSticker', className)}\n      style={buildStyle(\n        size !== undefined && `width: ${size}px; height: ${size}px;`,\n        onClick && !IS_ELECTRON && 'cursor: pointer',\n        colorFilter,\n        style,\n      )}\n      onClick={onClick}\n    />\n  );\n};\n\nexport default memo(AnimatedSticker);\n\nfunction isFrozen(forceAlways = false, forceOnHeavyAnimation = false) {\n  if (forceAlways) return false;\n  return (!forceOnHeavyAnimation && getIsHeavyAnimating()) || isPriorityPlaybackActive() || isBackgroundModeActive();\n}\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo, useRef, useState } from '../../lib/teact/teact';\nimport { getGlobal } from '../../global';\n\nimport type { ObserveFn } from '../../hooks/useIntersectionObserver';\nimport { ApiMessageEntityTypes } from '../../api/types';\n\nimport { selectIsAlwaysHighPriorityEmoji } from '../../global/selectors';\nimport buildClassName from '../../util/buildClassName';\nimport safePlay from '../../util/safePlay';\n\nimport useDynamicColorListener from '../../hooks/stickers/useDynamicColorListener';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useCustomEmoji from './hooks/useCustomEmoji';\n\nimport Sparkles from './Sparkles';\nimport StickerView from './StickerView';\n\nimport styles from './CustomEmoji.module.scss';\n\nimport blankImg from '../../assets/blank.png';\n\ntype OwnProps = {\n  ref?: React.RefObject<HTMLDivElement>;\n  documentId: string;\n  className?: string;\n  style?: string;\n  size?: number;\n  isBig?: boolean;\n  noPlay?: boolean;\n  noVideoOnMobile?: boolean;\n  loopLimit?: number;\n  isSelectable?: boolean;\n  withSharedAnimation?: boolean;\n  sharedCanvasRef?: React.RefObject<HTMLCanvasElement>;\n  sharedCanvasHqRef?: React.RefObject<HTMLCanvasElement>;\n  withTranslucentThumb?: boolean;\n  shouldPreloadPreview?: boolean;\n  forceOnHeavyAnimation?: boolean;\n  forceAlways?: boolean;\n  observeIntersectionForLoading?: ObserveFn;\n  observeIntersectionForPlaying?: ObserveFn;\n  onClick?: NoneToVoidFunction;\n  onAnimationEnd?: NoneToVoidFunction;\n  withSparkles?: boolean;\n  sparklesClassName?: string;\n  sparklesStyle?: string;\n};\n\nconst STICKER_SIZE = 20;\n\nconst CustomEmoji: FC<OwnProps> = ({\n  ref,\n  documentId,\n  className,\n  style,\n  size = STICKER_SIZE,\n  isBig,\n  noPlay,\n  noVideoOnMobile,\n  loopLimit,\n  isSelectable,\n  withSharedAnimation,\n  sharedCanvasRef,\n  sharedCanvasHqRef,\n  withTranslucentThumb,\n  shouldPreloadPreview,\n  forceAlways,\n  forceOnHeavyAnimation,\n  observeIntersectionForLoading,\n  observeIntersectionForPlaying,\n  onClick,\n  onAnimationEnd,\n  withSparkles,\n  sparklesStyle,\n  sparklesClassName,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  let containerRef = useRef<HTMLDivElement>(null);\n  if (ref) {\n    containerRef = ref;\n  }\n\n  // An alternative to `withGlobal` to avoid adding numerous global containers\n  const { customEmoji, canPlay } = useCustomEmoji(documentId);\n\n  const loopCountRef = useRef(0);\n  const [shouldPlay, setShouldPlay] = useState(true);\n\n  const hasCustomColor = customEmoji?.shouldUseTextColor;\n  const customColor = useDynamicColorListener(containerRef, undefined, !hasCustomColor);\n\n  const handleVideoEnded = useLastCallback((e) => {\n    if (!loopLimit) return;\n\n    loopCountRef.current += 1;\n\n    if (loopCountRef.current >= loopLimit) {\n      setShouldPlay(false);\n      e.currentTarget.currentTime = 0;\n    } else {\n      // Loop manually\n      safePlay(e.currentTarget);\n    }\n  });\n\n  const handleStickerLoop = useLastCallback(() => {\n    if (!loopLimit) return;\n\n    loopCountRef.current += 1;\n\n    if (loopCountRef.current >= loopLimit) {\n      setShouldPlay(false);\n    }\n  });\n\n  const isHq = customEmoji?.stickerSetInfo && selectIsAlwaysHighPriorityEmoji(getGlobal(), customEmoji.stickerSetInfo);\n\n  return (\n    <div\n      ref={containerRef}\n      className={buildClassName(\n        styles.root,\n        withSparkles && styles.withSparkles,\n        className,\n        'custom-emoji',\n        'emoji',\n      )}\n      onClick={onClick}\n      onAnimationEnd={onAnimationEnd}\n      data-entity-type={ApiMessageEntityTypes.CustomEmoji}\n      data-document-id={documentId}\n      data-alt={customEmoji?.emoji}\n      style={style}\n    >\n      {withSparkles && (\n        <Sparkles\n          className={buildClassName(\n            styles.sparkles,\n            sparklesClassName,\n          )}\n          style={sparklesStyle}\n          preset=\"button\"\n        />\n      )}\n      {isSelectable && (\n        <img\n          className={styles.highlightCatch}\n          src={blankImg}\n          alt={customEmoji?.emoji}\n          data-entity-type={ApiMessageEntityTypes.CustomEmoji}\n          data-document-id={documentId}\n          draggable={false}\n        />\n      )}\n      {!customEmoji ? (\n        <div className={buildClassName(styles.placeholder)} draggable={false} />\n      ) : (\n        <StickerView\n          containerRef={containerRef}\n          sticker={customEmoji}\n          isSmall={!isBig}\n          size={size}\n          noPlay={noPlay || !(shouldPlay && canPlay)}\n          noVideoOnMobile={noVideoOnMobile}\n          thumbClassName={styles.thumb}\n          fullMediaClassName={styles.media}\n          shouldLoop\n          loopLimit={loopLimit}\n          shouldPreloadPreview={shouldPreloadPreview || noPlay || !canPlay}\n          forceOnHeavyAnimation={forceOnHeavyAnimation}\n          forceAlways={forceAlways}\n          observeIntersectionForLoading={observeIntersectionForLoading}\n          observeIntersectionForPlaying={observeIntersectionForPlaying}\n          withSharedAnimation={withSharedAnimation}\n          sharedCanvasRef={isHq ? sharedCanvasHqRef : sharedCanvasRef}\n          withTranslucentThumb={withTranslucentThumb}\n          onVideoEnded={handleVideoEnded}\n          onAnimatedStickerLoop={handleStickerLoop}\n          customColor={customColor}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default memo(CustomEmoji);\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"CEFe1FhH\",\"withSparkles\":\"yjv4Sc_e\",\"sparkles\":\"iOlUvSI8\",\"placeholder\":\"DKi1177s\",\"thumb\":\"O_TaDxWg\",\"media\":\"wqju02hR\",\"highlight-catch\":\"a8dMNkh3\",\"highlightCatch\":\"a8dMNkh3\"};","import React, { memo } from '../../lib/teact/teact';\nimport { withGlobal } from '../../global';\n\nimport type {\n  ApiFormattedText, ApiMessage, ApiPoll, ApiTypeStory,\n} from '../../api/types';\nimport type { ObserveFn } from '../../hooks/useIntersectionObserver';\n\nimport {\n  extractMessageText,\n  getMessagePollId,\n  groupStatefulContent,\n  isActionMessage,\n} from '../../global/helpers';\nimport {\n  getMessageSummaryDescription,\n  getMessageSummaryEmoji,\n  getMessageSummaryText,\n  TRUNCATED_SUMMARY_LENGTH,\n} from '../../global/helpers/messageSummary';\nimport { selectPeerStory, selectPollFromMessage } from '../../global/selectors';\nimport trimText from '../../util/trimText';\nimport renderText from './helpers/renderText';\n\nimport useOldLang from '../../hooks/useOldLang';\n\nimport ActionMessageText from '../middle/message/ActionMessageText';\nimport MessageText from './MessageText';\n\ntype OwnProps = {\n  message: ApiMessage;\n  translatedText?: ApiFormattedText;\n  noEmoji?: boolean;\n  highlight?: string;\n  truncateLength?: number;\n  withTranslucentThumbs?: boolean;\n  inChatList?: boolean;\n  emojiSize?: number;\n  observeIntersectionForLoading?: ObserveFn;\n  observeIntersectionForPlaying?: ObserveFn;\n};\n\ntype StateProps = {\n  poll?: ApiPoll;\n  story?: ApiTypeStory;\n};\n\nfunction MessageSummary({\n  message,\n  translatedText,\n  noEmoji = false,\n  highlight,\n  truncateLength = TRUNCATED_SUMMARY_LENGTH,\n  withTranslucentThumbs = false,\n  inChatList = false,\n  emojiSize,\n  poll,\n  story,\n  observeIntersectionForLoading,\n  observeIntersectionForPlaying,\n}: OwnProps & StateProps) {\n  const lang = useOldLang();\n  const extractedText = extractMessageText(message, inChatList);\n  const hasPoll = Boolean(getMessagePollId(message));\n  const isAction = isActionMessage(message);\n\n  const statefulContent = groupStatefulContent({ poll, story });\n\n  if (!extractedText && !hasPoll && !isAction) {\n    const summaryText = translatedText?.text\n      || getMessageSummaryText(lang, message, statefulContent, noEmoji, truncateLength);\n    const trimmedText = trimText(summaryText, truncateLength);\n\n    return (\n      <span>\n        {highlight ? (\n          renderText(trimmedText, ['emoji', 'highlight'], { highlight })\n        ) : (\n          renderText(trimmedText)\n        )}\n      </span>\n    );\n  }\n\n  function renderMessageText() {\n    if (isAction) {\n      return <ActionMessageText message={message} asPreview />;\n    }\n\n    return (\n      <MessageText\n        messageOrStory={message}\n        translatedText={translatedText}\n        highlight={highlight}\n        asPreview\n        observeIntersectionForLoading={observeIntersectionForLoading}\n        observeIntersectionForPlaying={observeIntersectionForPlaying}\n        withTranslucentThumbs={withTranslucentThumbs}\n        truncateLength={truncateLength}\n        inChatList={inChatList}\n        emojiSize={emojiSize}\n      />\n    );\n  }\n\n  const emoji = !noEmoji && getMessageSummaryEmoji(message);\n\n  return (\n    <>\n      {[\n        emoji ? renderText(`${emoji} `) : undefined,\n        getMessageSummaryDescription(lang, message, statefulContent, renderMessageText()),\n      ].flat().filter(Boolean)}\n    </>\n  );\n}\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { message }): StateProps => {\n    const poll = selectPollFromMessage(global, message);\n    const storyData = message.content.storyData;\n    const story = storyData && selectPeerStory(global, storyData.peerId, storyData.id);\n\n    return {\n      poll,\n      story,\n    };\n  },\n)(MessageSummary));\n","import React, {\n  memo, useMemo, useRef,\n} from '../../lib/teact/teact';\n\nimport type { ApiFormattedText, ApiMessage, ApiStory } from '../../api/types';\nimport type { ObserveFn } from '../../hooks/useIntersectionObserver';\nimport type { ThreadId } from '../../types';\nimport { ApiMessageEntityTypes } from '../../api/types';\n\nimport { CONTENT_NOT_SUPPORTED } from '../../config';\nimport { extractMessageText, stripCustomEmoji } from '../../global/helpers';\nimport trimText from '../../util/trimText';\nimport { renderTextWithEntities } from './helpers/renderTextWithEntities';\n\nimport useSyncEffect from '../../hooks/useSyncEffect';\nimport useUniqueId from '../../hooks/useUniqueId';\n\ninterface OwnProps {\n  messageOrStory: ApiMessage | ApiStory;\n  threadId?: ThreadId;\n  translatedText?: ApiFormattedText;\n  isForAnimation?: boolean;\n  emojiSize?: number;\n  highlight?: string;\n  asPreview?: boolean;\n  truncateLength?: number;\n  isProtected?: boolean;\n  observeIntersectionForLoading?: ObserveFn;\n  observeIntersectionForPlaying?: ObserveFn;\n  withTranslucentThumbs?: boolean;\n  shouldRenderAsHtml?: boolean;\n  inChatList?: boolean;\n  forcePlayback?: boolean;\n  focusedQuote?: string;\n  isInSelectMode?: boolean;\n  canBeEmpty?: boolean;\n  maxTimestamp?: number;\n}\n\nconst MIN_CUSTOM_EMOJIS_FOR_SHARED_CANVAS = 3;\n\nfunction MessageText({\n  messageOrStory,\n  translatedText,\n  isForAnimation,\n  emojiSize,\n  highlight,\n  asPreview,\n  truncateLength,\n  isProtected,\n  observeIntersectionForLoading,\n  observeIntersectionForPlaying,\n  withTranslucentThumbs,\n  shouldRenderAsHtml,\n  inChatList,\n  forcePlayback,\n  focusedQuote,\n  isInSelectMode,\n  canBeEmpty,\n  maxTimestamp,\n  threadId,\n}: OwnProps) {\n  // eslint-disable-next-line no-null/no-null\n  const sharedCanvasRef = useRef<HTMLCanvasElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const sharedCanvasHqRef = useRef<HTMLCanvasElement>(null);\n\n  const textCacheBusterRef = useRef(0);\n\n  const formattedText = translatedText || extractMessageText(messageOrStory, inChatList);\n  const adaptedFormattedText = isForAnimation && formattedText ? stripCustomEmoji(formattedText) : formattedText;\n  const { text, entities } = adaptedFormattedText || {};\n\n  const containerId = useUniqueId();\n\n  useSyncEffect(() => {\n    textCacheBusterRef.current += 1;\n  }, [text, entities]);\n\n  const withSharedCanvas = useMemo(() => {\n    const hasSpoilers = entities?.some((e) => e.type === ApiMessageEntityTypes.Spoiler);\n    if (hasSpoilers) {\n      return false;\n    }\n\n    const customEmojisCount = entities?.filter((e) => e.type === ApiMessageEntityTypes.CustomEmoji).length || 0;\n    return customEmojisCount >= MIN_CUSTOM_EMOJIS_FOR_SHARED_CANVAS;\n  }, [entities]) || 0;\n\n  if (!text && !canBeEmpty) {\n    return <span className=\"content-unsupported\">{CONTENT_NOT_SUPPORTED}</span>;\n  }\n\n  return (\n    <>\n      {[\n        withSharedCanvas && <canvas ref={sharedCanvasRef} className=\"shared-canvas\" />,\n        withSharedCanvas && <canvas ref={sharedCanvasHqRef} className=\"shared-canvas\" />,\n        renderTextWithEntities({\n          text: trimText(text!, truncateLength),\n          entities,\n          highlight,\n          emojiSize,\n          shouldRenderAsHtml,\n          containerId,\n          asPreview,\n          isProtected,\n          observeIntersectionForLoading,\n          observeIntersectionForPlaying,\n          withTranslucentThumbs,\n          sharedCanvasRef,\n          sharedCanvasHqRef,\n          cacheBuster: textCacheBusterRef.current.toString(),\n          forcePlayback,\n          focusedQuote,\n          isInSelectMode,\n          maxTimestamp,\n          chatId: 'chatId' in messageOrStory ? messageOrStory.chatId : undefined,\n          messageId: messageOrStory.id,\n          threadId,\n        }),\n      ].flat().filter(Boolean)}\n    </>\n  );\n}\n\nexport default memo(MessageText);\n","import React, { memo } from '../../lib/teact/teact';\n\nimport type { ApiPeer, ApiPeerColor } from '../../api/types';\n\nimport buildClassName from '../../util/buildClassName';\nimport { getApiPeerColorClass, getPeerColorClass } from './helpers/peerColor';\n\nimport EmojiIconBackground from './embedded/EmojiIconBackground';\n\nimport styles from './PeerColorWrapper.module.scss';\n\ninterface OwnProps extends React.HTMLAttributes<HTMLDivElement> {\n  ref?: React.RefObject<HTMLDivElement>;\n  peer?: ApiPeer;\n  peerColor?: ApiPeerColor;\n  noUserColors?: boolean;\n  shouldReset?: boolean;\n  className?: string;\n  emojiIconClassName?: string;\n  children: React.ReactNode;\n}\n\nfunction PeerColorWrapper({\n  peer, ref, peerColor, noUserColors,\n  shouldReset, className, emojiIconClassName,\n  children, ...otherProps\n}: OwnProps) {\n  const color = peerColor || peer?.color;\n\n  return (\n    <div\n      ref={ref}\n      className={buildClassName(\n        styles.root,\n        peer && getPeerColorClass(peer, noUserColors, shouldReset),\n        peerColor && getApiPeerColorClass(peerColor),\n        className,\n      )}\n      // eslint-disable-next-line react/jsx-props-no-spreading\n      {...otherProps}\n    >\n      {color?.backgroundEmojiId && (\n        <EmojiIconBackground\n          className={emojiIconClassName}\n          emojiDocumentId={color.backgroundEmojiId}\n        />\n      )}\n      {children}\n    </div>\n  );\n}\n\nexport default memo(PeerColorWrapper);\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"nRjVJOQv\"};","import type { TeactNode } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\nimport { getActions } from '../../global';\n\nimport { ApiMessageEntityTypes } from '../../api/types';\n\nimport { ensureProtocol, getUnicodeUrl, isMixedScriptUrl } from '../../util/browser/url';\nimport buildClassName from '../../util/buildClassName';\n\nimport useLastCallback from '../../hooks/useLastCallback';\n\ntype OwnProps = {\n  url?: string;\n  text: string;\n  className?: string;\n  children?: TeactNode;\n  isRtl?: boolean;\n  shouldSkipModal?: boolean;\n};\n\nconst SafeLink = ({\n  url,\n  text,\n  className,\n  children,\n  isRtl,\n  shouldSkipModal,\n}: OwnProps) => {\n  const { openUrl } = getActions();\n\n  const content = children || text;\n  const isRegularLink = url === text;\n\n  const handleClick = useLastCallback((e: React.MouseEvent<HTMLAnchorElement, MouseEvent>) => {\n    if (!url) return true;\n\n    e.preventDefault();\n\n    const isTrustedLink = isRegularLink && !isMixedScriptUrl(url);\n    openUrl({ url, shouldSkipModal: shouldSkipModal || isTrustedLink });\n\n    return false;\n  });\n\n  if (!url) {\n    return undefined;\n  }\n\n  const classNames = buildClassName(\n    className || 'text-entity-link',\n    isRegularLink && 'word-break-all',\n  );\n\n  return (\n    <a\n      href={ensureProtocol(url)}\n      title={getUnicodeUrl(url)}\n      target=\"_blank\"\n      rel=\"noopener noreferrer\"\n      className={classNames}\n      onClick={handleClick}\n      dir={isRtl ? 'rtl' : 'auto'}\n      data-entity-type={ApiMessageEntityTypes.Url}\n    >\n      {content}\n    </a>\n  );\n};\n\nexport default SafeLink;\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"fWE9Tkfe\",\"progress\":\"F0JPgXgb\",\"button\":\"B94KQ3c0\",\"symbol\":\"wapdILU7\",\"sparkle\":\"AS3Scly3\"};","import React, { memo } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\nimport buildStyle from '../../util/buildStyle';\n\nimport styles from './Sparkles.module.scss';\n\ntype ButtonParameters = {\n  preset: 'button';\n};\n\ntype ProgressParameters = {\n  preset: 'progress';\n};\n\ntype PresetParameters = ButtonParameters | ProgressParameters;\n\ntype OwnProps = {\n  className?: string;\n  style?: string;\n} & PresetParameters;\n\nconst SYMBOL = '✦';\nconst ANIMATION_DURATION = 5;\n\n// Values are in percents\nconst BUTTON_POSITIONS = [{\n  x: 20,\n  y: 0,\n  size: 100,\n  durationShift: 10,\n}, {\n  x: 15,\n  y: 15,\n  size: 75,\n  durationShift: 70,\n}, {\n  x: 10,\n  y: 35,\n  size: 75,\n  durationShift: 90,\n}, {\n  x: 20,\n  y: 70,\n  size: 125,\n  durationShift: 30,\n}, {\n  x: 40,\n  y: 10,\n  size: 125,\n  durationShift: 0,\n}, {\n  x: 45,\n  y: 60,\n  size: 75,\n  durationShift: 60,\n}, {\n  x: 60,\n  y: -10,\n  size: 100,\n  durationShift: 20,\n}, {\n  x: 55,\n  y: 40,\n  size: 75,\n  durationShift: 60,\n}, {\n  x: 70,\n  y: 65,\n  size: 100,\n  durationShift: 90,\n}, {\n  x: 80,\n  y: 10,\n  size: 75,\n  durationShift: 30,\n}, {\n  x: 80,\n  y: 45,\n  size: 125,\n  durationShift: 0,\n}];\nconst PROGRESS_POSITIONS = generateRandomProgressPositions(100);\n\nconst Sparkles = ({\n  className,\n  style,\n  ...presetSettings\n}: OwnProps) => {\n  if (presetSettings.preset === 'button') {\n    return (\n      <div className={buildClassName(styles.root, styles.button, className)} style={style}>\n        {BUTTON_POSITIONS.map((position) => {\n          const shiftX = Math.cos(Math.atan2(-50 + position.y, -50 + position.x)) * 100;\n          const shiftY = Math.sin(Math.atan2(-50 + position.y, -50 + position.x)) * 100;\n          return (\n            <div\n              className={styles.symbol}\n              style={buildStyle(\n                `top: ${position.y}%`,\n                `left: ${position.x}%`,\n                `--_duration-shift: ${(-position.durationShift / 100) * ANIMATION_DURATION}s`,\n                `--_shift-x: ${shiftX}%`,\n                `--_shift-y: ${shiftY}%`,\n                `scale: ${position.size}%`,\n              )}\n            >\n              {SYMBOL}\n            </div>\n          );\n        })}\n      </div>\n    );\n  }\n\n  if (presetSettings.preset === 'progress') {\n    return (\n      <div className={buildClassName(styles.root, styles.progress, className)} style={style}>\n        {PROGRESS_POSITIONS.map((position) => {\n          return (\n            <div\n              className={styles.symbol}\n              style={buildStyle(\n                `top: ${position.y}%`,\n                `left: ${position.x}%`,\n                `--_shift-x: ${position.velocityX}%`,\n                `--_shift-y: ${position.velocityY}%`,\n                `scale: ${position.scale}%`,\n                `--_duration-shift: ${(-position.durationShift / 100) * ANIMATION_DURATION}s`,\n              )}\n            >\n              {SYMBOL}\n            </div>\n          );\n        })}\n      </div>\n    );\n  }\n\n  return undefined;\n};\n\nfunction generateRandomProgressPositions(count: number) {\n  const positions = [];\n  for (let i = 0; i < count; i++) {\n    positions.push({\n      x: Math.random() * 100,\n      y: Math.random() * 100,\n      velocityX: (Math.random() * 5 + 15) * 100,\n      velocityY: (Math.random() * 10 - 5) * 100,\n      scale: (Math.random() * 0.5 + 0.5) * 100,\n      durationShift: Math.random() * 100,\n    });\n  }\n  return positions;\n}\n\nexport default memo(Sparkles);\n","// extracted by mini-css-extract-plugin\nexport default {\"thumb\":\"gYSfUe37\",\"thumb-opaque\":\"vbcXDDxa\",\"thumbOpaque\":\"vbcXDDxa\",\"no-transition\":\"AvU_FtMd\",\"noTransition\":\"AvU_FtMd\",\"media\":\"RrEzFxte\"};","import type { FC } from '../../lib/teact/teact';\nimport React, { memo, useMemo, useRef } from '../../lib/teact/teact';\nimport { getGlobal } from '../../global';\n\nimport type { ApiSticker } from '../../api/types';\nimport type { ObserveFn } from '../../hooks/useIntersectionObserver';\n\nimport { getStickerMediaHash } from '../../global/helpers';\nimport { selectIsAlwaysHighPriorityEmoji } from '../../global/selectors';\nimport buildClassName from '../../util/buildClassName';\nimport * as mediaLoader from '../../util/mediaLoader';\nimport { IS_ANDROID, IS_IOS, IS_WEBM_SUPPORTED } from '../../util/windowEnvironment';\n\nimport useColorFilter from '../../hooks/stickers/useColorFilter';\nimport useCoordsInSharedCanvas from '../../hooks/useCoordsInSharedCanvas';\nimport useFlag from '../../hooks/useFlag';\nimport { useIsIntersecting } from '../../hooks/useIntersectionObserver';\nimport useMedia from '../../hooks/useMedia';\nimport useMediaTransition from '../../hooks/useMediaTransition';\nimport useMountAfterHeavyAnimation from '../../hooks/useMountAfterHeavyAnimation';\nimport useThumbnail from '../../hooks/useThumbnail';\nimport useUniqueId from '../../hooks/useUniqueId';\nimport useDevicePixelRatio from '../../hooks/window/useDevicePixelRatio';\n\nimport OptimizedVideo from '../ui/OptimizedVideo';\nimport AnimatedSticker from './AnimatedSticker';\n\nimport styles from './StickerView.module.scss';\n\ntype OwnProps = {\n  containerRef: React.RefObject<HTMLDivElement>;\n  sticker: ApiSticker;\n  thumbClassName?: string;\n  fullMediaHash?: string;\n  fullMediaClassName?: string;\n  isSmall?: boolean;\n  size?: number;\n  customColor?: string;\n  loopLimit?: number;\n  shouldLoop?: boolean;\n  shouldPreloadPreview?: boolean;\n  forceAlways?: boolean;\n  forceOnHeavyAnimation?: boolean;\n  observeIntersectionForLoading?: ObserveFn;\n  observeIntersectionForPlaying?: ObserveFn;\n  noLoad?: boolean;\n  noPlay?: boolean;\n  noVideoOnMobile?: boolean;\n  withSharedAnimation?: boolean;\n  sharedCanvasRef?: React.RefObject<HTMLCanvasElement>;\n  withTranslucentThumb?: boolean; // With shared canvas thumbs are opaque by default to provide better transition effect\n  onVideoEnded?: AnyToVoidFunction;\n  onAnimatedStickerLoop?: AnyToVoidFunction;\n};\n\nconst SHARED_PREFIX = 'shared';\nconst STICKER_SIZE = 24;\n\nconst StickerView: FC<OwnProps> = ({\n  containerRef,\n  sticker,\n  thumbClassName,\n  fullMediaHash,\n  fullMediaClassName,\n  isSmall,\n  size = STICKER_SIZE,\n  customColor,\n  loopLimit,\n  shouldLoop = false,\n  shouldPreloadPreview,\n  forceAlways,\n  forceOnHeavyAnimation,\n  observeIntersectionForLoading,\n  observeIntersectionForPlaying,\n  noLoad,\n  noPlay,\n  noVideoOnMobile,\n  withSharedAnimation,\n  withTranslucentThumb,\n  sharedCanvasRef,\n  onVideoEnded,\n  onAnimatedStickerLoop,\n}) => {\n  const {\n    id, isLottie, stickerSetInfo, emoji,\n  } = sticker;\n  const [isVideoBroken, markVideoBroken] = useFlag();\n  const isUnsupportedVideo = sticker.isVideo && (\n    !IS_WEBM_SUPPORTED\n    || (noVideoOnMobile && (IS_IOS || IS_ANDROID))\n  );\n  const isVideo = sticker.isVideo;\n  const isStatic = !isLottie && !isVideo;\n  const previewMediaHash = getStickerMediaHash(sticker, 'preview');\n\n  const dpr = useDevicePixelRatio();\n\n  const filterStyle = useColorFilter(customColor);\n\n  const isIntersectingForLoading = useIsIntersecting(containerRef, observeIntersectionForLoading);\n  const shouldLoad = isIntersectingForLoading && !noLoad;\n  const isIntersectingForPlaying = (\n    useIsIntersecting(containerRef, observeIntersectionForPlaying)\n    && isIntersectingForLoading\n  );\n  const shouldPlay = isIntersectingForPlaying && !noPlay;\n  const hasIntersectedForPlayingRef = useRef(isIntersectingForPlaying);\n  if (!hasIntersectedForPlayingRef.current && isIntersectingForPlaying) {\n    hasIntersectedForPlayingRef.current = true;\n  }\n\n  const cachedPreview = mediaLoader.getFromMemory(previewMediaHash);\n  const isReadyToMountFullMedia = useMountAfterHeavyAnimation(hasIntersectedForPlayingRef.current);\n  const shouldForcePreview = isUnsupportedVideo || (isStatic ? isSmall : noPlay);\n  const shouldLoadPreview = !customColor && !cachedPreview && (!isReadyToMountFullMedia || shouldForcePreview);\n  const previewMediaData = useMedia(previewMediaHash, !shouldLoadPreview);\n  const withPreview = shouldLoadPreview || cachedPreview;\n\n  const shouldSkipLoadingFullMedia = Boolean(shouldForcePreview || (\n    fullMediaHash === previewMediaHash && (cachedPreview || previewMediaData)\n  ));\n  const fullMediaData = useMedia(fullMediaHash || `sticker${id}`, !shouldLoad || shouldSkipLoadingFullMedia);\n  const shouldRenderFullMedia = isReadyToMountFullMedia && fullMediaData && !isVideoBroken;\n  const [isPlayerReady, markPlayerReady] = useFlag();\n  const isFullMediaReady = shouldRenderFullMedia && (isStatic || isPlayerReady);\n\n  const thumbDataUri = useThumbnail(sticker.thumbnail);\n  const thumbData = cachedPreview || previewMediaData || thumbDataUri;\n  const isThumbOpaque = sharedCanvasRef && !withTranslucentThumb;\n\n  const noCrossTransition = Boolean(isLottie && withPreview);\n  const thumbRef = useMediaTransition<HTMLImageElement>(thumbData && !isFullMediaReady, {\n    noCloseTransition: noCrossTransition,\n  });\n  const fullMediaRef = useMediaTransition<HTMLElement>(isFullMediaReady, {\n    noOpenTransition: noCrossTransition,\n  });\n\n  const coords = useCoordsInSharedCanvas(containerRef, sharedCanvasRef);\n\n  // Preload preview for Message Input and local message\n  useMedia(previewMediaHash, !shouldLoad || !shouldPreloadPreview);\n\n  const randomIdPrefix = useUniqueId();\n  const renderId = useMemo(() => ([\n    (withSharedAnimation ? SHARED_PREFIX : randomIdPrefix),\n    id,\n    size,\n    (withSharedAnimation ? customColor : undefined),\n    dpr,\n  ].filter(Boolean).join('_')\n  ), [id, size, customColor, dpr, withSharedAnimation, randomIdPrefix]);\n\n  return (\n    <>\n      <img\n        ref={thumbRef}\n        src={thumbData}\n        className={buildClassName(\n          styles.thumb,\n          noCrossTransition && styles.noTransition,\n          isThumbOpaque && styles.thumbOpaque,\n          thumbClassName,\n          'sticker-media',\n        )}\n        style={filterStyle}\n        alt=\"\"\n        draggable={false}\n      />\n      {shouldRenderFullMedia && (isLottie ? (\n        <AnimatedSticker\n          ref={fullMediaRef as React.RefObject<HTMLDivElement>}\n          key={renderId}\n          renderId={renderId}\n          size={size}\n          className={buildClassName(\n            styles.media,\n            (noCrossTransition || isThumbOpaque) && styles.noTransition,\n            fullMediaClassName,\n          )}\n          tgsUrl={fullMediaData}\n          play={shouldPlay}\n          noLoop={!shouldLoop}\n          forceOnHeavyAnimation={forceAlways || forceOnHeavyAnimation}\n          forceAlways={forceAlways}\n          isLowPriority={isSmall && !selectIsAlwaysHighPriorityEmoji(getGlobal(), stickerSetInfo)}\n          sharedCanvas={sharedCanvasRef?.current || undefined}\n          sharedCanvasCoords={coords}\n          onLoad={markPlayerReady}\n          onLoop={onAnimatedStickerLoop}\n          onEnded={onAnimatedStickerLoop}\n          color={customColor}\n        />\n      ) : isVideo ? (\n        <OptimizedVideo\n          ref={fullMediaRef as React.RefObject<HTMLVideoElement>}\n          canPlay={shouldPlay}\n          className={buildClassName(styles.media, fullMediaClassName, 'sticker-media')}\n          src={fullMediaData}\n          playsInline\n          muted\n          loop={shouldLoop && !loopLimit}\n          isPriority={forceAlways}\n          disablePictureInPicture\n          onReady={markPlayerReady}\n          onBroken={markVideoBroken}\n          onEnded={onVideoEnded}\n          style={filterStyle}\n        />\n      ) : (\n        <img\n          ref={fullMediaRef as React.RefObject<HTMLImageElement>}\n          className={buildClassName(styles.media, fullMediaClassName, 'sticker-media')}\n          src={fullMediaData}\n          alt={emoji}\n          style={filterStyle}\n          draggable={false}\n        />\n      ))}\n    </>\n  );\n};\n\nexport default memo(StickerView);\n","import { getIsHeavyAnimating, useEffect, useSignal } from '../lib/teact/teact';\n\nimport useDerivedState from './useDerivedState';\n\nexport default function useMountAfterHeavyAnimation(hasIntersected: boolean) {\n  const [getNoHeavyAnimation, setNoHeavyAnimation] = useSignal(false);\n\n  const $getIsHeavyAnimating = getIsHeavyAnimating;\n\n  // Animation is usually started right after the mount, so we use effect to check for it on the next frame\n  useEffect(() => {\n    if (!$getIsHeavyAnimating()) {\n      setNoHeavyAnimation(true);\n    }\n  }, [$getIsHeavyAnimating, setNoHeavyAnimation]);\n\n  return useDerivedState(() => (getNoHeavyAnimation() && hasIntersected), [getNoHeavyAnimation, hasIntersected]);\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"A72KeAmh\",\"icon\":\"eLEPgwPj\",\"title\":\"ZQJO2BKn\"};","import type { FC } from '../../lib/teact/teact';\nimport React, { memo } from '../../lib/teact/teact';\n\nimport type { ThreadId } from '../../types';\n\nimport { GENERAL_TOPIC_ID } from '../../config';\nimport buildClassName from '../../util/buildClassName';\nimport { getTopicDefaultIcon } from '../../util/forumColors';\nimport { getFirstLetters } from '../../util/textFormat';\nimport renderText from './helpers/renderText';\n\nimport Icon from './icons/Icon';\n\nimport styles from './TopicDefaultIcon.module.scss';\n\ntype OwnProps = {\n  className?: string;\n  letterClassName?: string;\n  topicId: ThreadId;\n  iconColor?: number;\n  title: string;\n  onClick?: NoneToVoidFunction;\n};\n\nconst TopicDefaultIcon: FC<OwnProps> = ({\n  className,\n  letterClassName,\n  topicId,\n  iconColor,\n  title,\n  onClick,\n}) => {\n  const iconSrc = getTopicDefaultIcon(iconColor);\n\n  if (topicId === GENERAL_TOPIC_ID) {\n    return (\n      <Icon\n        name=\"hashtag\"\n        className={buildClassName(styles.root, className, 'general-forum-icon')}\n        onClick={onClick}\n      />\n    );\n  }\n  return (\n    <div className={buildClassName(styles.root, className)} onClick={onClick}>\n      <img className={styles.icon} src={iconSrc} alt=\"\" draggable={false} />\n      <div className={buildClassName(styles.title, letterClassName, 'topic-icon-letter')}>\n        {renderText(getFirstLetters(title, 1))}\n      </div>\n    </div>\n  );\n};\n\nexport default memo(TopicDefaultIcon);\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"pTWe_CYU\"};","import React, {\n  memo, useEffect, useRef, useState,\n} from '../../../lib/teact/teact';\n\nimport { requestMutation } from '../../../lib/fasterdom/fasterdom';\nimport { getStickerMediaHash } from '../../../global/helpers';\nimport buildClassName from '../../../util/buildClassName';\nimport { preloadImage } from '../../../util/files';\nimport { REM } from '../helpers/mediaDimensions';\n\nimport useDynamicColorListener from '../../../hooks/stickers/useDynamicColorListener';\nimport { useThrottleForHeavyAnimation } from '../../../hooks/useHeavyAnimation';\nimport useLastCallback from '../../../hooks/useLastCallback';\nimport useMedia from '../../../hooks/useMedia';\nimport useOldLang from '../../../hooks/useOldLang';\nimport useResizeObserver from '../../../hooks/useResizeObserver';\nimport useDevicePixelRatio from '../../../hooks/window/useDevicePixelRatio';\nimport useCustomEmoji from '../hooks/useCustomEmoji';\n\nimport styles from './EmojiIconBackground.module.scss';\n\ntype IconPosition = {\n  inline: number;\n  block: number;\n  opacity: number;\n  scale: number;\n};\n\nconst ICON_POSITIONS: IconPosition[] = [\n  {\n    inline: 22, block: 38, opacity: 0.35, scale: 0.75,\n  },\n  {\n    inline: 32, block: 12, opacity: 0.3, scale: 1,\n  },\n  {\n    inline: 60, block: 22, opacity: 0.25, scale: 0.75,\n  },\n  {\n    inline: 75, block: 44, opacity: 0.25, scale: 1,\n  },\n  {\n    inline: 75, block: 2, opacity: 0.2, scale: 0.625,\n  },\n  {\n    inline: 95, block: 18, opacity: 0.2, scale: 1,\n  },\n  {\n    inline: 115, block: 38, opacity: 0.2, scale: 0.625,\n  },\n  {\n    inline: 125, block: 12, opacity: 0.1, scale: 0.75,\n  },\n];\n\nconst EMOJI_SIZE = REM;\nconst LOTTIE_TINT_OPACITY = 'ff';\nconst NON_LOTTIE_TINT_OPACITY = 'bb';\n\ntype OwnProps = {\n  emojiDocumentId: string;\n  className?: string;\n};\n\nconst EmojiIconBackground = ({\n  emojiDocumentId,\n  className,\n}: OwnProps) => {\n  // eslint-disable-next-line no-null/no-null\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const [emojiImage, setEmojiImage] = useState<HTMLImageElement | undefined>();\n\n  const dpr = useDevicePixelRatio();\n\n  const lang = useOldLang();\n\n  const { customEmoji } = useCustomEmoji(emojiDocumentId);\n  const previewMediaHash = customEmoji ? getStickerMediaHash(customEmoji, 'preview') : undefined;\n  const previewUrl = useMedia(previewMediaHash);\n\n  const customColor = useDynamicColorListener(containerRef);\n\n  const preloadAfterHeavyAnimation = useThrottleForHeavyAnimation(() => {\n    if (!previewUrl) return;\n    preloadImage(previewUrl).then(setEmojiImage);\n  }, [previewUrl]);\n\n  useEffect(() => {\n    preloadAfterHeavyAnimation();\n  }, [preloadAfterHeavyAnimation]);\n\n  const updateCanvas = useLastCallback(() => {\n    const canvas = canvasRef.current;\n    if (!canvas || !emojiImage || !customColor) return;\n\n    const context = canvas.getContext('2d')!;\n    const { width, height } = canvas;\n\n    context.clearRect(0, 0, width, height);\n\n    ICON_POSITIONS.forEach(({\n      inline, block, opacity, scale,\n    }) => {\n      const x = (lang.isRtl ? inline : width / dpr - inline) * dpr;\n      const y = block * dpr;\n\n      const emojiSize = EMOJI_SIZE * dpr;\n\n      context.save();\n      context.globalAlpha = opacity;\n      context.translate(x, y);\n      context.scale(scale, scale);\n      context.drawImage(emojiImage, -emojiSize / 2, -emojiSize / 2, emojiSize, emojiSize);\n      context.restore();\n    });\n\n    const tintColor = `${customColor}${customEmoji!.isLottie ? LOTTIE_TINT_OPACITY : NON_LOTTIE_TINT_OPACITY}`;\n\n    context.save();\n    context.fillStyle = tintColor;\n    context.globalCompositeOperation = 'source-atop';\n    context.fillRect(0, 0, width, height);\n    context.restore();\n  });\n\n  const updateCanvasAfterHeavyAnimation = useThrottleForHeavyAnimation(updateCanvas, [updateCanvas]);\n\n  useEffect(() => {\n    updateCanvasAfterHeavyAnimation();\n  }, [emojiImage, lang.isRtl, customColor, updateCanvasAfterHeavyAnimation]);\n\n  const updateCanvasSize = useThrottleForHeavyAnimation((parentWidth: number, parentHeight: number) => {\n    requestMutation(() => {\n      const canvas = canvasRef.current;\n      if (!canvas) return;\n\n      canvas.width = parentWidth * dpr;\n      canvas.height = parentHeight * dpr;\n\n      canvas.style.width = `${parentWidth}px`;\n      canvas.style.height = `${parentHeight}px`;\n\n      updateCanvas();\n    });\n  }, [dpr]);\n\n  const handleResize = useThrottleForHeavyAnimation((entry: ResizeObserverEntry) => {\n    const { width, height } = entry.contentRect;\n\n    updateCanvasSize(width, height);\n  }, [updateCanvasSize]);\n\n  useResizeObserver(containerRef, handleResize);\n\n  useEffect(() => {\n    const container = containerRef.current;\n    if (!container) return;\n\n    const { width, height } = container.getBoundingClientRect();\n\n    updateCanvasSize(width, height);\n  }, [updateCanvasSize]);\n\n  return (\n    <div className={buildClassName(styles.root, className)} ref={containerRef}>\n      <canvas ref={canvasRef} />\n    </div>\n  );\n};\n\nexport default memo(EmojiIconBackground);\n","import QrPlane from '../../../assets/tgs/auth/QrPlane.tgs';\nimport CameraFlip from '../../../assets/tgs/calls/CameraFlip.tgs';\nimport HandFilled from '../../../assets/tgs/calls/HandFilled.tgs';\nimport HandOutline from '../../../assets/tgs/calls/HandOutline.tgs';\nimport Speaker from '../../../assets/tgs/calls/Speaker.tgs';\nimport VoiceAllowTalk from '../../../assets/tgs/calls/VoiceAllowTalk.tgs';\nimport VoiceMini from '../../../assets/tgs/calls/VoiceMini.tgs';\nimport VoiceMuted from '../../../assets/tgs/calls/VoiceMuted.tgs';\nimport VoiceOutlined from '../../../assets/tgs/calls/VoiceOutlined.tgs';\nimport Flame from '../../../assets/tgs/general/Flame.tgs';\nimport Fragment from '../../../assets/tgs/general/Fragment.tgs';\nimport Mention from '../../../assets/tgs/general/Mention.tgs';\nimport PartyPopper from '../../../assets/tgs/general/PartyPopper.tgs';\nimport Invite from '../../../assets/tgs/invites/Invite.tgs';\nimport JoinRequest from '../../../assets/tgs/invites/Requests.tgs';\nimport LastSeen from '../../../assets/tgs/LastSeen.tgs';\nimport MonkeyClose from '../../../assets/tgs/monkeys/TwoFactorSetupMonkeyClose.tgs';\nimport MonkeyIdle from '../../../assets/tgs/monkeys/TwoFactorSetupMonkeyIdle.tgs';\nimport MonkeyPeek from '../../../assets/tgs/monkeys/TwoFactorSetupMonkeyPeek.tgs';\nimport MonkeyTracking from '../../../assets/tgs/monkeys/TwoFactorSetupMonkeyTracking.tgs';\nimport ReadTime from '../../../assets/tgs/ReadTime.tgs';\nimport Report from '../../../assets/tgs/Report.tgs';\nimport SearchingDuck from '../../../assets/tgs/SearchingDuck.tgs';\nimport Congratulations from '../../../assets/tgs/settings/Congratulations.tgs';\nimport DiscussionGroups from '../../../assets/tgs/settings/DiscussionGroupsDucks.tgs';\nimport Experimental from '../../../assets/tgs/settings/Experimental.tgs';\nimport FoldersAll from '../../../assets/tgs/settings/FoldersAll.tgs';\nimport FoldersNew from '../../../assets/tgs/settings/FoldersNew.tgs';\nimport FoldersShare from '../../../assets/tgs/settings/FoldersShare.tgs';\nimport Lock from '../../../assets/tgs/settings/Lock.tgs';\nimport StarReaction from '../../../assets/tgs/stars/StarReaction.tgs';\nimport StarReactionEffect from '../../../assets/tgs/stars/StarReactionEffect.tgs';\nimport Unlock from '../../../assets/tgs/Unlock.tgs';\n\nexport const LOCAL_TGS_URLS = {\n  MonkeyIdle,\n  MonkeyTracking,\n  MonkeyClose,\n  MonkeyPeek,\n  FoldersAll,\n  FoldersNew,\n  FoldersShare,\n  DiscussionGroups,\n  Lock,\n  CameraFlip,\n  HandFilled,\n  HandOutline,\n  Speaker,\n  VoiceAllowTalk,\n  VoiceMini,\n  VoiceMuted,\n  VoiceOutlined,\n  JoinRequest,\n  Invite,\n  QrPlane,\n  Congratulations,\n  Experimental,\n  PartyPopper,\n  Flame,\n  ReadTime,\n  Unlock,\n  LastSeen,\n  Mention,\n  Fragment,\n  StarReactionEffect,\n  StarReaction,\n  Report,\n  SearchingDuck,\n};\n","import type { ApiDocument } from '../../../api/types';\n\nconst ONE_GIGABYTE = 1024 * 1024 * 1024;\nconst ONE_MEGABYTE = 1024 * 1024;\n\nexport function getFileSizeString(bytes: number) {\n  if (bytes > (ONE_GIGABYTE / 2)) {\n    return `${(bytes / ONE_GIGABYTE).toFixed(1)} GB`;\n  }\n  if (bytes > (ONE_MEGABYTE / 2)) {\n    return `${(bytes / ONE_MEGABYTE).toFixed(1)} MB`;\n  }\n  return `${(bytes / (1024)).toFixed(1)} KB`;\n}\n\nexport function getDocumentExtension(document: ApiDocument) {\n  const { fileName, mimeType } = document;\n\n  return getFileExtension(fileName, mimeType);\n}\n\nexport function getFileExtension(fileName: string, mimeType: string) {\n  if (fileName && fileName.indexOf('.') !== -1) {\n    return fileName.split('.').pop();\n  } else {\n    return mimeType.split('/').pop();\n  }\n}\n\nexport function getColorFromExtension(extension: string) {\n  switch (extension) {\n    case 'apk':\n    case 'xls':\n    case 'xlsx':\n    case 'ods':\n      return 'green';\n    case 'zip':\n    case 'rar':\n    case '7z':\n    case 'tar':\n    case 'gz':\n    case 'bz2':\n    case 'liz':\n    case 'lz4':\n    case 'lz5':\n    case 'xz':\n    case 'zst':\n    case 'wim':\n    case 'ppt':\n    case 'pptx':\n    case 'odp':\n      return 'orange';\n    case 'pdf':\n    case 'xps':\n      return 'red';\n    default:\n      return 'default';\n  }\n}\n\nexport function getDocumentHasPreview(document: ApiDocument) {\n  return Boolean(document.previewBlobUrl || document.thumbnail);\n}\n","import type {\n  ApiDimensions, ApiMediaExtendedPreview, ApiPhoto, ApiSticker, ApiVideo,\n} from '../../../api/types';\n\nimport { STICKER_SIZE_INLINE_DESKTOP_FACTOR, STICKER_SIZE_INLINE_MOBILE_FACTOR } from '../../../config';\nimport { getPhotoInlineDimensions, getVideoDimensions } from '../../../global/helpers';\nimport { IS_TOUCH_ENV } from '../../../util/windowEnvironment';\nimport windowSize from '../../../util/windowSize';\n\nexport const MEDIA_VIEWER_MEDIA_QUERY = '(max-height: 640px)';\nexport const REM = parseInt(getComputedStyle(document.documentElement).fontSize, 10);\nexport const ROUND_VIDEO_DIMENSIONS_PX = 240;\nexport const GIF_MIN_WIDTH = 300;\nexport const AVATAR_FULL_DIMENSIONS = { width: 640, height: 640 };\nexport const VIDEO_AVATAR_FULL_DIMENSIONS = { width: 800, height: 800 };\nexport const LIKE_STICKER_ID = '4986041492570112461';\n\nconst DEFAULT_MEDIA_DIMENSIONS: ApiDimensions = { width: 100, height: 100 };\nconst MOBILE_SCREEN_NO_AVATARS_MESSAGE_EXTRA_WIDTH_REM = 4.5;\nconst MOBILE_SCREEN_MESSAGE_EXTRA_WIDTH_REM = 7;\nconst MESSAGE_MAX_WIDTH_REM = 29;\nconst MESSAGE_OWN_MAX_WIDTH_REM = 30;\n\nlet cachedMaxWidthOwn: number | undefined;\nlet cachedMaxWidth: number | undefined;\nlet cachedMaxWidthNoAvatar: number | undefined;\n\nfunction getMaxMessageWidthRem(fromOwnMessage?: boolean, noAvatars?: boolean, isMobile?: boolean) {\n  const regularMaxWidth = fromOwnMessage ? MESSAGE_OWN_MAX_WIDTH_REM : MESSAGE_MAX_WIDTH_REM;\n  if (!isMobile) {\n    return regularMaxWidth;\n  }\n\n  const { width: windowWidth } = windowSize.get();\n\n  // @optimization Limitation: changing device screen width not supported\n  if (!cachedMaxWidthOwn) {\n    cachedMaxWidthOwn = Math.min(\n      MESSAGE_OWN_MAX_WIDTH_REM,\n      windowWidth / REM - MOBILE_SCREEN_NO_AVATARS_MESSAGE_EXTRA_WIDTH_REM,\n    );\n  }\n  if (!cachedMaxWidth) {\n    cachedMaxWidth = Math.min(\n      MESSAGE_MAX_WIDTH_REM,\n      windowWidth / REM - MOBILE_SCREEN_MESSAGE_EXTRA_WIDTH_REM,\n    );\n  }\n  if (!cachedMaxWidthNoAvatar) {\n    cachedMaxWidthNoAvatar = Math.min(\n      MESSAGE_MAX_WIDTH_REM,\n      windowWidth / REM - MOBILE_SCREEN_NO_AVATARS_MESSAGE_EXTRA_WIDTH_REM,\n    );\n  }\n\n  return fromOwnMessage\n    ? cachedMaxWidthOwn\n    : (noAvatars ? cachedMaxWidthNoAvatar : cachedMaxWidth);\n}\n\nexport function getAvailableWidth(\n  fromOwnMessage?: boolean,\n  isWebPageMedia?: boolean,\n  noAvatars?: boolean,\n  isMobile?: boolean,\n) {\n  const extraPaddingRem = isWebPageMedia ? 1.625 : 0;\n  const availableWidthRem = getMaxMessageWidthRem(fromOwnMessage, noAvatars, isMobile) - extraPaddingRem;\n\n  return availableWidthRem * REM;\n}\n\nfunction getAvailableHeight(isGif?: boolean, aspectRatio?: number) {\n  if (\n    isGif && aspectRatio\n    && aspectRatio >= 0.75 && aspectRatio <= 1.25\n  ) {\n    return 20 * REM;\n  }\n\n  return 27 * REM;\n}\n\nexport function calculateDimensionsForMessageMedia({\n  width,\n  height,\n  fromOwnMessage,\n  isWebPageMedia,\n  isGif,\n  noAvatars,\n  isMobile,\n}: {\n  width: number;\n  height: number;\n  fromOwnMessage?: boolean;\n  asForwarded?: boolean;\n  isWebPageMedia?: boolean;\n  isGif?: boolean;\n  noAvatars?: boolean;\n  isMobile?: boolean;\n}): ApiDimensions {\n  const aspectRatio = height / width;\n  const availableWidth = getAvailableWidth(fromOwnMessage, isWebPageMedia, noAvatars, isMobile);\n  const availableHeight = getAvailableHeight(isGif, aspectRatio);\n  const mediaWidth = isGif ? Math.max(GIF_MIN_WIDTH, width) : width;\n  const mediaHeight = isGif ? height * (mediaWidth / width) : height;\n\n  return calculateDimensions(availableWidth, availableHeight, mediaWidth, mediaHeight);\n}\n\nexport function getMediaViewerAvailableDimensions(withFooter: boolean, isVideo: boolean): ApiDimensions {\n  const mql = window.matchMedia(MEDIA_VIEWER_MEDIA_QUERY);\n  const { width: windowWidth, height: windowHeight } = windowSize.get();\n  let occupiedHeightRem = isVideo && mql.matches ? 10 : 8.25;\n  if (withFooter && !IS_TOUCH_ENV) {\n    occupiedHeightRem = mql.matches ? 10 : 12.5;\n  }\n  return {\n    width: windowWidth,\n    height: windowHeight - occupiedHeightRem * REM,\n  };\n}\n\nexport function calculateInlineImageDimensions(\n  photo: ApiPhoto,\n  fromOwnMessage?: boolean,\n  asForwarded?: boolean,\n  isWebPageMedia?: boolean,\n  noAvatars?: boolean,\n  isMobile?: boolean,\n) {\n  const { width, height } = getPhotoInlineDimensions(photo) || DEFAULT_MEDIA_DIMENSIONS;\n\n  return calculateDimensionsForMessageMedia({\n    width,\n    height,\n    fromOwnMessage,\n    asForwarded,\n    isWebPageMedia,\n    noAvatars,\n    isMobile,\n  });\n}\n\nexport function calculateVideoDimensions(\n  video: ApiVideo,\n  fromOwnMessage?: boolean,\n  asForwarded?: boolean,\n  isWebPageMedia?: boolean,\n  noAvatars?: boolean,\n  isMobile?: boolean,\n) {\n  const { width, height } = getVideoDimensions(video) || DEFAULT_MEDIA_DIMENSIONS;\n\n  return calculateDimensionsForMessageMedia({\n    width,\n    height,\n    fromOwnMessage,\n    asForwarded,\n    isWebPageMedia,\n    isGif: video.isGif,\n    noAvatars,\n    isMobile,\n  });\n}\n\nexport function calculateExtendedPreviewDimensions(\n  preview: ApiMediaExtendedPreview,\n  fromOwnMessage?: boolean,\n  asForwarded?: boolean,\n  isWebPageMedia?: boolean,\n  noAvatars?: boolean,\n  isMobile?: boolean,\n) {\n  const { width = DEFAULT_MEDIA_DIMENSIONS.width, height = DEFAULT_MEDIA_DIMENSIONS.height } = preview;\n\n  return calculateDimensionsForMessageMedia({\n    width,\n    height,\n    fromOwnMessage,\n    asForwarded,\n    isWebPageMedia,\n    noAvatars,\n    isMobile,\n  });\n}\n\nexport function getPictogramDimensions(): ApiDimensions {\n  return {\n    width: 2 * REM,\n    height: 2 * REM,\n  };\n}\n\nexport function getDocumentThumbnailDimensions(smaller?: boolean): ApiDimensions {\n  if (smaller) {\n    return {\n      width: 3 * REM,\n      height: 3 * REM,\n    };\n  }\n\n  return {\n    width: 3.375 * REM,\n    height: 3.375 * REM,\n  };\n}\n\nexport function getStickerDimensions(sticker: ApiSticker, isMobile?: boolean): ApiDimensions {\n  const { width } = sticker;\n  let { height } = sticker;\n\n  // For some reason this sticker has some weird `height` value\n  if (sticker.id === LIKE_STICKER_ID) {\n    height = width;\n  }\n\n  const aspectRatio = (height && width) && height / width;\n  const baseWidth = REM * (\n    isMobile\n      ? STICKER_SIZE_INLINE_MOBILE_FACTOR\n      : STICKER_SIZE_INLINE_DESKTOP_FACTOR\n  );\n  const calculatedHeight = aspectRatio ? baseWidth * aspectRatio : baseWidth;\n\n  if (aspectRatio && calculatedHeight > baseWidth) {\n    return {\n      width: Math.round(baseWidth / aspectRatio),\n      height: baseWidth,\n    };\n  }\n\n  return {\n    width: baseWidth,\n    height: calculatedHeight,\n  };\n}\n\nexport function calculateMediaViewerDimensions(\n  { width, height }: ApiDimensions, withFooter: boolean, isVideo: boolean = false,\n): ApiDimensions {\n  const { width: availableWidth, height: availableHeight } = getMediaViewerAvailableDimensions(withFooter, isVideo);\n\n  return calculateDimensions(availableWidth, availableHeight, width, height);\n}\n\nexport function calculateDimensions(\n  availableWidth: number,\n  availableHeight: number,\n  mediaWidth: number,\n  mediaHeight: number,\n): ApiDimensions {\n  const aspectRatio = mediaHeight / mediaWidth;\n  const calculatedWidth = Math.min(mediaWidth, availableWidth);\n  const calculatedHeight = Math.round(calculatedWidth * aspectRatio);\n\n  if (calculatedHeight > availableHeight) {\n    return {\n      width: Math.round(availableHeight / aspectRatio),\n      height: availableHeight,\n    };\n  }\n\n  return {\n    width: calculatedWidth,\n    height: Math.round(calculatedWidth * aspectRatio),\n  };\n}\n","import type { ApiPeer, ApiPeerColor } from '../../../api/types';\nimport type { CustomPeer } from '../../../types';\n\nimport { getPeerColorCount, getPeerColorKey } from '../../../global/helpers';\n\nexport function getPeerColorClass(peer?: ApiPeer | CustomPeer, noUserColors?: boolean, shouldReset?: boolean) {\n  if (!peer) {\n    if (!shouldReset) return undefined;\n    return noUserColors ? 'peer-color-count-1' : 'peer-color-0';\n  }\n\n  if ('isCustomPeer' in peer) {\n    if (peer.peerColorId === undefined) return undefined;\n    return `peer-color-${peer.peerColorId}`;\n  }\n  return noUserColors ? `peer-color-count-${getPeerColorCount(peer)}` : `peer-color-${getPeerColorKey(peer)}`;\n}\n\nexport function getApiPeerColorClass(color: ApiPeerColor) {\n  return `peer-color-${color.color}`;\n}\n","import type { TeactNode } from '../../../lib/teact/teact';\nimport React from '../../../lib/teact/teact';\n\nimport type { TextPart } from '../../../types';\n\nimport {\n  BASE_URL, IS_PACKAGED_ELECTRON, RE_LINK_TEMPLATE, RE_MENTION_TEMPLATE,\n} from '../../../config';\nimport EMOJI_REGEX from '../../../lib/twemojiRegex';\nimport buildClassName from '../../../util/buildClassName';\nimport { isDeepLink } from '../../../util/deepLinkParser';\nimport {\n  handleEmojiLoad,\n  LOADED_EMOJIS,\n  nativeToUnifiedExtendedWithCache,\n} from '../../../util/emoji/emoji';\nimport fixNonStandardEmoji from '../../../util/emoji/fixNonStandardEmoji';\nimport { compact } from '../../../util/iteratees';\nimport { IS_EMOJI_SUPPORTED } from '../../../util/windowEnvironment';\n\nimport MentionLink from '../../middle/message/MentionLink';\nimport SafeLink from '../SafeLink';\n\nexport type TextFilter = (\n  'escape_html' | 'hq_emoji' | 'emoji' | 'emoji_html' | 'br' | 'br_html' | 'highlight' | 'links' |\n  'simple_markdown' | 'simple_markdown_html' | 'quote' | 'tg_links'\n  );\n\nconst SIMPLE_MARKDOWN_REGEX = /(\\*\\*|__).+?\\1/g;\n\nexport default function renderText(\n  part: TextPart,\n  filters: Array<TextFilter> = ['emoji'],\n  params?: { highlight?: string; quote?: string; markdownPostProcessor?: (part: string) => TeactNode },\n): TeactNode[] {\n  if (typeof part !== 'string') {\n    return [part];\n  }\n\n  return compact(filters.reduce((text, filter) => {\n    switch (filter) {\n      case 'escape_html':\n        return escapeHtml(text);\n\n      case 'hq_emoji':\n        EMOJI_REGEX.lastIndex = 0;\n        return replaceEmojis(text, 'big', 'jsx');\n\n      case 'emoji':\n        EMOJI_REGEX.lastIndex = 0;\n        return replaceEmojis(text, 'small', 'jsx');\n\n      case 'emoji_html':\n        EMOJI_REGEX.lastIndex = 0;\n        return replaceEmojis(text, 'small', 'html');\n\n      case 'br':\n        return addLineBreaks(text, 'jsx');\n\n      case 'br_html':\n        return addLineBreaks(text, 'html');\n\n      case 'highlight':\n        return addHighlight(text, params!.highlight);\n\n      case 'quote':\n        return addHighlight(text, params!.quote, true);\n\n      case 'links':\n        return addLinks(text);\n\n      case 'tg_links':\n        return addLinks(text, true);\n\n      case 'simple_markdown':\n        return replaceSimpleMarkdown(text, 'jsx', params?.markdownPostProcessor);\n\n      case 'simple_markdown_html':\n        return replaceSimpleMarkdown(text, 'html');\n    }\n\n    return text;\n  }, [part] as TextPart[]));\n}\n\nfunction escapeHtml(textParts: TextPart[]): TextPart[] {\n  const divEl = document.createElement('div');\n  return textParts.reduce((result: TextPart[], part) => {\n    if (typeof part !== 'string') {\n      result.push(part);\n      return result;\n    }\n\n    divEl.innerText = part;\n    result.push(divEl.innerHTML);\n\n    return result;\n  }, []);\n}\n\nfunction replaceEmojis(textParts: TextPart[], size: 'big' | 'small', type: 'jsx' | 'html'): TextPart[] {\n  if (IS_EMOJI_SUPPORTED) {\n    return textParts;\n  }\n\n  return textParts.reduce((result: TextPart[], part: TextPart) => {\n    if (typeof part !== 'string') {\n      result.push(part);\n      return result;\n    }\n\n    part = fixNonStandardEmoji(part);\n    const parts = part.split(EMOJI_REGEX);\n    const emojis: string[] = part.match(EMOJI_REGEX) || [];\n    result.push(parts[0]);\n\n    return emojis.reduce((emojiResult: TextPart[], emoji, i) => {\n      const code = nativeToUnifiedExtendedWithCache(emoji);\n      if (!code) {\n        emojiResult.push(emoji);\n      } else {\n        const baseSrcUrl = IS_PACKAGED_ELECTRON ? BASE_URL : '.';\n        const src = `${baseSrcUrl}/img-apple-${size === 'big' ? '160' : '64'}/${code}.png`;\n        const className = buildClassName(\n          'emoji',\n          size === 'small' && 'emoji-small',\n        );\n\n        if (type === 'jsx') {\n          const isLoaded = LOADED_EMOJIS.has(src);\n\n          emojiResult.push(\n            <img\n              src={src}\n              className={`${className}${!isLoaded ? ' opacity-transition slow shown' : ''}`}\n              alt={emoji}\n              data-path={src}\n              draggable={false}\n              onLoad={!isLoaded ? handleEmojiLoad : undefined}\n            />,\n          );\n        }\n        if (type === 'html') {\n          emojiResult.push(\n            `<img\\\n            draggable=\"false\"\\\n            class=\"${className}\"\\\n            src=\"${src}\"\\\n            alt=\"${emoji}\"\\\n          />`,\n          );\n        }\n      }\n\n      const index = i * 2 + 2;\n      if (parts[index]) {\n        emojiResult.push(parts[index]);\n      }\n\n      return emojiResult;\n    }, result);\n  }, [] as TextPart[]);\n}\n\nfunction addLineBreaks(textParts: TextPart[], type: 'jsx' | 'html'): TextPart[] {\n  return textParts.reduce((result: TextPart[], part) => {\n    if (typeof part !== 'string') {\n      result.push(part);\n      return result;\n    }\n\n    const splittenParts = part\n      .split(/\\r\\n|\\r|\\n/g)\n      .reduce((parts: TextPart[], line: string, i, source) => {\n        // This adds non-breaking space if line was indented with spaces, to preserve the indentation\n        const trimmedLine = line.trimLeft();\n        const indentLength = line.length - trimmedLine.length;\n        parts.push(String.fromCharCode(160).repeat(indentLength) + trimmedLine);\n\n        if (i !== source.length - 1) {\n          parts.push(\n            type === 'jsx' ? <br /> : '<br />',\n          );\n        }\n\n        return parts;\n      }, []);\n\n    return [...result, ...splittenParts];\n  }, []);\n}\n\nfunction addHighlight(textParts: TextPart[], highlight: string | undefined, isQuote?: true): TextPart[] {\n  return textParts.reduce<TextPart[]>((result, part) => {\n    if (typeof part !== 'string' || !highlight) {\n      result.push(part);\n      return result;\n    }\n\n    const lowerCaseText = part.toLowerCase();\n    const queryPosition = lowerCaseText.indexOf(highlight.toLowerCase());\n    if (queryPosition < 0) {\n      result.push(part);\n      return result;\n    }\n\n    const newParts: TextPart[] = [];\n    newParts.push(part.substring(0, queryPosition));\n    newParts.push(\n      <span className={buildClassName('matching-text-highlight', isQuote && 'is-quote')}>\n        {part.substring(queryPosition, queryPosition + highlight.length)}\n      </span>,\n    );\n    newParts.push(part.substring(queryPosition + highlight.length));\n    return [...result, ...newParts];\n  }, []);\n}\n\nconst RE_LINK = new RegExp(`${RE_LINK_TEMPLATE}|${RE_MENTION_TEMPLATE}`, 'ig');\n\nfunction addLinks(textParts: TextPart[], allowOnlyTgLinks?: boolean): TextPart[] {\n  return textParts.reduce<TextPart[]>((result, part) => {\n    if (typeof part !== 'string') {\n      result.push(part);\n      return result;\n    }\n\n    const links = part.match(RE_LINK);\n    if (!links || !links.length) {\n      result.push(part);\n      return result;\n    }\n\n    const content: TextPart[] = [];\n\n    let nextLink = links.shift();\n    let lastIndex = 0;\n    while (nextLink) {\n      const index = part.indexOf(nextLink, lastIndex);\n      content.push(part.substring(lastIndex, index));\n      if (nextLink.startsWith('@')) {\n        content.push(\n          <MentionLink username={nextLink}>\n            {nextLink}\n          </MentionLink>,\n        );\n      } else {\n        if (nextLink.endsWith('?')) {\n          nextLink = nextLink.slice(0, nextLink.length - 1);\n        }\n\n        if (!allowOnlyTgLinks || isDeepLink(nextLink)) {\n          content.push(\n            <SafeLink text={nextLink} url={nextLink} />,\n          );\n        } else {\n          content.push(nextLink);\n        }\n      }\n      lastIndex = index + nextLink.length;\n      nextLink = links.shift();\n    }\n    content.push(part.substring(lastIndex));\n\n    return [...result, ...content];\n  }, []);\n}\n\nfunction replaceSimpleMarkdown(\n  textParts: TextPart[], type: 'jsx' | 'html', postProcessor?: (part: string) => TeactNode,\n): TextPart[] {\n  // Currently supported only for JSX. If needed, add typings to support HTML as well.\n  const postProcess = postProcessor || ((part: string) => part);\n\n  return textParts.reduce<TextPart[]>((result, part) => {\n    if (typeof part !== 'string') {\n      result.push(part);\n      return result;\n    }\n\n    const parts = part.split(SIMPLE_MARKDOWN_REGEX);\n    const entities: string[] = part.match(SIMPLE_MARKDOWN_REGEX) || [];\n    result.push(postProcess(parts[0]));\n\n    return entities.reduce((entityResult: TextPart[], entity, i) => {\n      if (type === 'jsx') {\n        entityResult.push(\n          entity.startsWith('**')\n            ? <b>{postProcess(entity.replace(/\\*\\*/g, ''))}</b>\n            : <i>{postProcess(entity.replace(/__/g, ''))}</i>,\n        );\n      } else {\n        entityResult.push(\n          entity.startsWith('**')\n            ? `<b>${entity.replace(/\\*\\*/g, '')}</b>`\n            : `<i>${entity.replace(/__/g, '')}</i>`,\n        );\n      }\n\n      const index = i * 2 + 2;\n      if (parts[index]) {\n        entityResult.push(postProcess(parts[index]));\n      }\n\n      return entityResult;\n    }, result);\n  }, []);\n}\n\nexport function areLinesWrapping(text: string, element: HTMLElement) {\n  const lines = (text.trim().match(/\\n/g) || '').length + 1;\n  const { lineHeight } = getComputedStyle(element);\n  const lineHeightParsed = parseFloat(lineHeight.split('px')[0]);\n\n  return element.clientHeight >= (lines + 1) * lineHeightParsed;\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"KU67Uur0\",\"collapsed\":\"y_uRZXtA\",\"blockquote\":\"m3sD7_cn\",\"gradientContainer\":\"JNVT2DU9\",\"collapseIcon\":\"pyX4NpPB\",\"clickable\":\"RmvXwV0W\"};","import React, {\n  type TeactNode,\n  useRef,\n} from '../../lib/teact/teact';\n\nimport { ApiMessageEntityTypes } from '../../api/types';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport useCollapsibleLines from '../../hooks/element/useCollapsibleLines';\nimport useLastCallback from '../../hooks/useLastCallback';\n\nimport Icon from './icons/Icon';\n\nimport styles from './Blockquote.module.scss';\n\ntype OwnProps = {\n  canBeCollapsible?: boolean;\n  isToggleDisabled?: boolean;\n  children: TeactNode;\n};\n\nconst MAX_LINES = 4;\n\nconst Blockquote = ({ canBeCollapsible, isToggleDisabled, children }: OwnProps) => {\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLQuoteElement>(null);\n  const {\n    isCollapsed, isCollapsible, setIsCollapsed,\n  } = useCollapsibleLines(ref, MAX_LINES, undefined, !canBeCollapsible);\n\n  const canExpand = !isToggleDisabled && isCollapsed;\n\n  const handleExpand = useLastCallback(() => {\n    setIsCollapsed(false);\n  });\n\n  const handleToggle = useLastCallback(() => {\n    setIsCollapsed((prev) => !prev);\n  });\n\n  return (\n    <span\n      className={buildClassName(styles.root, isCollapsed && styles.collapsed)}\n      onClick={canExpand ? handleExpand : undefined}\n    >\n      <blockquote\n        className={styles.blockquote}\n        ref={ref}\n        data-entity-type={ApiMessageEntityTypes.Blockquote}\n      >\n        <div className={styles.gradientContainer}>\n          {children}\n        </div>\n        {isCollapsible && (\n          <div\n            className={buildClassName(styles.collapseIcon, !isToggleDisabled && styles.clickable)}\n            onClick={!isToggleDisabled ? handleToggle : undefined}\n            aria-hidden\n          >\n            <Icon name={isCollapsed ? 'down' : 'up'} />\n          </div>\n        )}\n      </blockquote>\n    </span>\n  );\n};\n\nexport default Blockquote;\n","const PRETTY_BY_ALIAS: Record<string, string | undefined> = {\n  js: 'JavaScript',\n  javascript: 'JavaScript',\n  ts: 'TypeScript',\n  typescript: 'TypeScript',\n  python: 'Python',\n  py: 'Python',\n  go: 'Go',\n  rust: 'Rust',\n  func: 'FunC',\n  c: 'C',\n  'c++': 'C++',\n  cpp: 'C++',\n  fortran: 'Fortran',\n  f90: 'Fortran',\n  f: 'Fortran',\n  java: 'Java',\n  sql: 'SQL',\n  swift: 'Swift',\n  'objective-c': 'Objective-C',\n  kotlin: 'Kotlin',\n  ruby: 'Ruby',\n  rb: 'Ruby',\n  php: 'PHP',\n  perl: 'Perl',\n  bash: 'Bash',\n  sh: 'Shell',\n  markdown: 'Markdown',\n  'c#': 'C#',\n  cs: 'C#',\n  json: 'JSON',\n  yaml: 'YAML',\n  yml: 'YAML',\n  solidity: 'Solidity',\n  sol: 'Solidity',\n  tl: 'TL',\n};\n\nexport function getPrettyCodeLanguageName(codeLanguage: string) {\n  const prettyLangName = PRETTY_BY_ALIAS[codeLanguage.toLowerCase()];\n  return prettyLangName ?? codeLanguage;\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"overlay\":\"pMUccFN9\",\"copy\":\"auCNtLQ4\",\"wrap\":\"a44ZN3hD\",\"wrapOn\":\"jq1KLfVD\",\"content\":\"L95Dh7wN\",\"hidden\":\"zctwFUQ8\"};","import type { FC } from '../../../lib/teact/teact';\nimport React, {\n  memo, useCallback, useEffect, useRef, useState,\n} from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport buildClassName from '../../../util/buildClassName';\nimport { copyTextToClipboard } from '../../../util/clipboard';\nimport { areLinesWrapping } from '../helpers/renderText';\n\nimport useOldLang from '../../../hooks/useOldLang';\nimport useWindowSize from '../../../hooks/window/useWindowSize';\n\nimport Icon from '../icons/Icon';\n\nimport styles from './CodeOverlay.module.scss';\n\nexport type OwnProps = {\n  className?: string;\n  text: string;\n  noCopy?: boolean;\n  onWordWrapToggle?: (wrap: boolean) => void;\n};\n\nconst CodeOverlay: FC<OwnProps> = ({\n  text, className, noCopy, onWordWrapToggle,\n}) => {\n  const { showNotification } = getActions();\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n  const windowSize = useWindowSize();\n  const lang = useOldLang();\n  const [isWordWrap, setIsWordWrap] = useState(true);\n  const [withWordWrapButton, setWithWordWrapButton] = useState(false);\n\n  const checkWordWrap = useCallback(() => {\n    const isWrap = areLinesWrapping(text, ref.current!.parentElement!);\n    setWithWordWrapButton(isWrap);\n  }, [text]);\n\n  useEffect(() => {\n    if (isWordWrap) {\n      checkWordWrap();\n    }\n  }, [checkWordWrap, isWordWrap, text, windowSize]);\n\n  const handleCopy = useCallback(() => {\n    copyTextToClipboard(text);\n    showNotification({\n      message: lang('TextCopied'),\n    });\n  }, [lang, showNotification, text]);\n\n  const handleWordWrapClick = useCallback(() => {\n    setIsWordWrap(!isWordWrap);\n    onWordWrapToggle?.(!isWordWrap);\n  }, [isWordWrap, onWordWrapToggle]);\n\n  const contentClass = buildClassName(styles.content, !withWordWrapButton && noCopy && styles.hidden);\n  const overlayClass = buildClassName(styles.overlay, className);\n  const wrapClass = buildClassName(styles.wrap, isWordWrap && styles.wrapOn);\n\n  return (\n    <div className={overlayClass} ref={ref}>\n      <div className={contentClass}>\n        {withWordWrapButton && (\n          <div className={wrapClass} onClick={handleWordWrapClick} title=\"Word Wrap\">\n            <Icon name=\"word-wrap\" />\n          </div>\n        )}\n        {!noCopy && (\n          <div className={styles.copy} onClick={handleCopy} title={lang('Copy')}>\n            <Icon name=\"copy\" />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default memo(CodeOverlay);\n","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo, useCallback, useState } from '../../../lib/teact/teact';\n\nimport { ApiMessageEntityTypes } from '../../../api/types';\n\nimport buildClassName from '../../../util/buildClassName';\nimport { getPrettyCodeLanguageName } from '../../../util/prettyCodeLanguageNames';\n\nimport useAsync from '../../../hooks/useAsync';\n\nimport PeerColorWrapper from '../PeerColorWrapper';\nimport CodeOverlay from './CodeOverlay';\n\nimport './CodeBlock.scss';\n\nexport type OwnProps = {\n  text: string;\n  language?: string;\n  noCopy?: boolean;\n};\n\nconst CodeBlock: FC<OwnProps> = ({ text, language, noCopy }) => {\n  const [isWordWrap, setWordWrap] = useState(true);\n\n  const { result: highlighted } = useAsync(() => {\n    if (!language) return Promise.resolve(undefined);\n    return import('../../../util/highlightCode')\n      .then((lib) => lib.default(text, language));\n  }, [language, text]);\n\n  const handleWordWrapToggle = useCallback((wrap) => {\n    setWordWrap(wrap);\n  }, []);\n\n  const blockClass = buildClassName(\n    'code-block',\n    !isWordWrap && 'no-word-wrap',\n  );\n\n  return (\n    <PeerColorWrapper\n      className=\"CodeBlock\"\n    >\n      {language && (<p className=\"code-title\">{getPrettyCodeLanguageName(language)}</p>)}\n      <pre className={blockClass} data-entity-type={ApiMessageEntityTypes.Pre} data-language={language}>\n        {highlighted ?? text}\n        <CodeOverlay\n          text={text}\n          className=\"code-overlay\"\n          onWordWrapToggle={handleWordWrapToggle}\n          noCopy={noCopy}\n        />\n      </pre>\n    </PeerColorWrapper>\n  );\n};\n\nexport default memo(CodeBlock);\n","import type { TeactNode } from '../../../lib/teact/teact';\nimport React, { memo, useEffect, useRef } from '../../../lib/teact/teact';\n\nimport { ApiMessageEntityTypes } from '../../../api/types';\n\nimport { createClassNameBuilder } from '../../../util/buildClassName';\nimport stopEvent from '../../../util/stopEvent';\n\nimport useFlag from '../../../hooks/useFlag';\nimport useLastCallback from '../../../hooks/useLastCallback';\n\nimport './Spoiler.scss';\n\ntype OwnProps = {\n  children?: TeactNode;\n  containerId?: string;\n};\n\nconst revealByContainerId: Map<string, VoidFunction[]> = new Map();\n\nconst buildClassName = createClassNameBuilder('Spoiler');\n\nconst Spoiler = ({\n  children,\n  containerId,\n}: OwnProps) => {\n  // eslint-disable-next-line no-null/no-null\n  const contentRef = useRef<HTMLDivElement>(null);\n\n  const [isRevealed, revealSpoiler] = useFlag();\n\n  const handleClick = useLastCallback((e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    if (!containerId) return;\n\n    if (!isRevealed) {\n      stopEvent(e);\n    }\n\n    revealByContainerId.get(containerId)?.forEach((reveal) => reveal());\n  });\n\n  useEffect(() => {\n    if (!containerId) {\n      return undefined;\n    }\n\n    if (revealByContainerId.has(containerId)) {\n      revealByContainerId.get(containerId)!.push(revealSpoiler);\n    } else {\n      revealByContainerId.set(containerId, [revealSpoiler]);\n    }\n\n    return () => {\n      revealByContainerId.delete(containerId);\n    };\n  }, [containerId]);\n\n  return (\n    <span\n      className={buildClassName(\n        '&',\n        !isRevealed && 'concealed',\n        !isRevealed && Boolean(containerId) && 'animated',\n      )}\n      onClick={containerId && !isRevealed ? handleClick : undefined}\n      data-entity-type={ApiMessageEntityTypes.Spoiler}\n    >\n      <span className={buildClassName('content')} ref={contentRef}>\n        {children}\n      </span>\n    </span>\n  );\n};\n\nexport default memo(Spoiler);\n","import React from '../../../lib/teact/teact';\nimport { getActions } from '../../../global';\n\nimport type { ApiFormattedText, ApiMessageEntity } from '../../../api/types';\nimport type { ObserveFn } from '../../../hooks/useIntersectionObserver';\nimport type { TextPart, ThreadId } from '../../../types';\nimport type { TextFilter } from './renderText';\nimport { ApiMessageEntityTypes } from '../../../api/types';\n\nimport buildClassName from '../../../util/buildClassName';\nimport { copyTextToClipboard } from '../../../util/clipboard';\nimport { oldTranslate } from '../../../util/oldLangProvider';\nimport { buildCustomEmojiHtmlFromEntity } from '../../middle/composer/helpers/customEmoji';\nimport renderText from './renderText';\n\nimport MentionLink from '../../middle/message/MentionLink';\nimport Blockquote from '../Blockquote';\nimport CodeBlock from '../code/CodeBlock';\nimport CustomEmoji from '../CustomEmoji';\nimport SafeLink from '../SafeLink';\nimport Spoiler from '../spoiler/Spoiler';\n\ninterface IOrganizedEntity {\n  entity: ApiMessageEntity;\n  organizedIndexes: Set<number>;\n  nestedEntities: IOrganizedEntity[];\n}\ntype RenderTextParams = Parameters<typeof renderText>[2];\n\nconst HQ_EMOJI_THRESHOLD = 64;\n\nexport function renderTextWithEntities({\n  text,\n  entities,\n  highlight,\n  emojiSize,\n  shouldRenderAsHtml,\n  containerId,\n  asPreview,\n  isProtected,\n  observeIntersectionForLoading,\n  observeIntersectionForPlaying,\n  withTranslucentThumbs,\n  sharedCanvasRef,\n  sharedCanvasHqRef,\n  cacheBuster,\n  forcePlayback,\n  noCustomEmojiPlayback,\n  focusedQuote,\n  isInSelectMode,\n  chatId,\n  messageId,\n  threadId,\n  maxTimestamp,\n}: {\n  text: string;\n  entities?: ApiMessageEntity[];\n  highlight?: string;\n  emojiSize?: number;\n  shouldRenderAsHtml?: boolean;\n  containerId?: string;\n  asPreview?: boolean;\n  isProtected?: boolean;\n  observeIntersectionForLoading?: ObserveFn;\n  observeIntersectionForPlaying?: ObserveFn;\n  withTranslucentThumbs?: boolean;\n  sharedCanvasRef?: React.RefObject<HTMLCanvasElement>;\n  sharedCanvasHqRef?: React.RefObject<HTMLCanvasElement>;\n  cacheBuster?: string;\n  forcePlayback?: boolean;\n  noCustomEmojiPlayback?: boolean;\n  focusedQuote?: string;\n  isInSelectMode?: boolean;\n  chatId?: string;\n  messageId?: number;\n  threadId?: ThreadId;\n  maxTimestamp?: number;\n}) {\n  if (!entities?.length) {\n    return renderMessagePart({\n      content: text,\n      highlight,\n      focusedQuote,\n      emojiSize,\n      shouldRenderAsHtml,\n      asPreview,\n    });\n  }\n\n  const result: TextPart[] = [];\n  let deleteLineBreakAfterPre = false;\n\n  const organizedEntities = organizeEntities(entities);\n\n  // Recursive function to render regular and nested entities\n  function renderEntity(\n    textPartStart: number,\n    textPartEnd: number,\n    organizedEntity: IOrganizedEntity,\n    isLastEntity: boolean,\n  ) {\n    const renderResult: TextPart[] = [];\n    const { entity, nestedEntities } = organizedEntity;\n    const { offset, length, type } = entity;\n\n    // Render text before the entity\n    let textBefore = text.substring(textPartStart, offset);\n    const textBeforeLength = textBefore.length;\n    if (textBefore) {\n      if (deleteLineBreakAfterPre && textBefore.length > 0 && textBefore[0] === '\\n') {\n        textBefore = textBefore.substr(1);\n        deleteLineBreakAfterPre = false;\n      }\n      if (textBefore) {\n        renderResult.push(...renderMessagePart({\n          content: textBefore,\n          highlight,\n          focusedQuote,\n          emojiSize,\n          shouldRenderAsHtml,\n          asPreview,\n        }) as TextPart[]);\n      }\n    }\n\n    const entityStartIndex = textPartStart + textBeforeLength;\n    const entityEndIndex = entityStartIndex + length;\n\n    let entityContent: TextPart = text.substring(offset, offset + length);\n    const nestedEntityContent: TextPart[] = [];\n\n    if (deleteLineBreakAfterPre && entityContent.length > 0 && entityContent[0] === '\\n') {\n      entityContent = entityContent.substr(1);\n      deleteLineBreakAfterPre = false;\n    }\n\n    if (type === ApiMessageEntityTypes.Pre) {\n      deleteLineBreakAfterPre = true;\n    }\n\n    // Render nested entities, if any\n    if (nestedEntities.length) {\n      let nestedIndex = entityStartIndex;\n\n      nestedEntities.forEach((nestedEntity, nestedEntityIndex) => {\n        const {\n          renderResult: nestedResult,\n          entityEndIndex: nestedEntityEndIndex,\n        } = renderEntity(\n          nestedIndex,\n          entityEndIndex,\n          nestedEntity,\n          nestedEntityIndex === nestedEntities.length - 1,\n        );\n\n        nestedEntityContent.push(...nestedResult);\n        nestedIndex = nestedEntityEndIndex;\n      });\n    }\n\n    // Render the entity itself\n    const newEntity = shouldRenderAsHtml\n      ? processEntityAsHtml(entity, entityContent, nestedEntityContent)\n      : processEntity({\n        entity,\n        entityContent,\n        nestedEntityContent,\n        highlight,\n        focusedQuote,\n        containerId,\n        asPreview,\n        isProtected,\n        observeIntersectionForLoading,\n        observeIntersectionForPlaying,\n        withTranslucentThumbs,\n        emojiSize,\n        sharedCanvasRef,\n        sharedCanvasHqRef,\n        cacheBuster,\n        forcePlayback,\n        noCustomEmojiPlayback,\n        isInSelectMode,\n        chatId,\n        messageId,\n        threadId,\n        maxTimestamp,\n      });\n\n    if (Array.isArray(newEntity)) {\n      renderResult.push(...newEntity);\n    } else {\n      renderResult.push(newEntity);\n    }\n\n    // Render text after the entity, if it is the last entity in the text,\n    // or the last nested entity inside of another entity\n    if (isLastEntity && entityEndIndex < textPartEnd) {\n      let textAfter = text.substring(entityEndIndex, textPartEnd);\n      if (deleteLineBreakAfterPre && textAfter.length > 0 && textAfter[0] === '\\n') {\n        textAfter = textAfter.substring(1);\n      }\n      if (textAfter) {\n        renderResult.push(...renderMessagePart({\n          content: textAfter,\n          highlight,\n          focusedQuote,\n          emojiSize,\n          shouldRenderAsHtml,\n          asPreview,\n        }) as TextPart[]);\n      }\n    }\n\n    return {\n      renderResult,\n      entityEndIndex,\n    };\n  }\n\n  // Process highest-level entities\n  let index = 0;\n\n  organizedEntities.forEach((entity, arrayIndex) => {\n    const { renderResult, entityEndIndex } = renderEntity(\n      index,\n      text.length,\n      entity,\n      arrayIndex === organizedEntities.length - 1,\n    );\n\n    result.push(...renderResult);\n    index = entityEndIndex;\n  });\n\n  return result;\n}\n\nexport function getTextWithEntitiesAsHtml(formattedText?: ApiFormattedText) {\n  const { text, entities } = formattedText || {};\n  if (!text) {\n    return '';\n  }\n\n  const result = renderTextWithEntities({\n    text,\n    entities,\n    shouldRenderAsHtml: true,\n  });\n\n  if (Array.isArray(result)) {\n    return result.join('');\n  }\n\n  return result;\n}\n\nfunction renderMessagePart({\n  content,\n  highlight,\n  focusedQuote,\n  emojiSize,\n  shouldRenderAsHtml,\n  asPreview,\n} : {\n  content: TextPart | TextPart[];\n  highlight?: string;\n  focusedQuote?: string;\n  emojiSize?: number;\n  shouldRenderAsHtml?: boolean;\n  asPreview?: boolean;\n}) {\n  if (Array.isArray(content)) {\n    const result: TextPart[] = [];\n\n    content.forEach((c) => {\n      result.push(...renderMessagePart({\n        content: c,\n        highlight,\n        focusedQuote,\n        emojiSize,\n        shouldRenderAsHtml,\n        asPreview,\n      }));\n    });\n\n    return result;\n  }\n\n  if (shouldRenderAsHtml) {\n    return renderText(content, ['escape_html', 'emoji_html', 'br_html']);\n  }\n\n  const emojiFilter = emojiSize && emojiSize > HQ_EMOJI_THRESHOLD ? 'hq_emoji' : 'emoji';\n\n  const filters: TextFilter[] = [emojiFilter];\n  const params: RenderTextParams = {};\n  if (!asPreview) {\n    filters.push('br');\n  }\n\n  if (highlight) {\n    filters.push('highlight');\n    params.highlight = highlight;\n  }\n  if (focusedQuote) {\n    filters.push('quote');\n    params.quote = focusedQuote;\n  }\n\n  return renderText(content, filters, params);\n}\n\n// Organize entities in a tree-like structure to better represent how the text will be displayed\nfunction organizeEntities(entities: ApiMessageEntity[]) {\n  const organizedEntityIndexes: Set<number> = new Set();\n  const organizedEntities: IOrganizedEntity[] = [];\n\n  entities.forEach((entity, index) => {\n    if (organizedEntityIndexes.has(index)) {\n      return;\n    }\n\n    const organizedEntity = organizeEntity(entity, index, entities, organizedEntityIndexes);\n    if (organizedEntity) {\n      organizedEntity.organizedIndexes.forEach((organizedIndex) => {\n        organizedEntityIndexes.add(organizedIndex);\n      });\n\n      organizedEntities.push(organizedEntity);\n    }\n  });\n\n  return organizedEntities;\n}\n\nfunction organizeEntity(\n  entity: ApiMessageEntity,\n  index: number,\n  entities: ApiMessageEntity[],\n  organizedEntityIndexes: Set<number>,\n): IOrganizedEntity | undefined {\n  const { offset, length } = entity;\n  const organizedIndexes = new Set([index]);\n\n  if (organizedEntityIndexes.has(index)) {\n    return undefined;\n  }\n\n  // Determine any nested entities inside current entity\n  const nestedEntities: IOrganizedEntity[] = [];\n  const parsedNestedEntities = entities\n    .filter((e, i) => i > index && e.offset >= offset && e.offset < offset + length)\n    .map((e) => organizeEntity(e, entities.indexOf(e), entities, organizedEntityIndexes))\n    .filter(Boolean);\n\n  parsedNestedEntities.forEach((parsedEntity) => {\n    let isChanged = false;\n\n    parsedEntity.organizedIndexes.forEach((organizedIndex) => {\n      if (!isChanged && !organizedIndexes.has(organizedIndex)) {\n        isChanged = true;\n      }\n\n      organizedIndexes.add(organizedIndex);\n    });\n\n    if (isChanged) {\n      nestedEntities.push(parsedEntity);\n    }\n  });\n\n  return {\n    entity,\n    organizedIndexes,\n    nestedEntities,\n  };\n}\n\nfunction processEntity({\n  entity,\n  entityContent,\n  nestedEntityContent,\n  highlight,\n  focusedQuote,\n  containerId,\n  asPreview,\n  isProtected,\n  observeIntersectionForLoading,\n  observeIntersectionForPlaying,\n  withTranslucentThumbs,\n  emojiSize,\n  sharedCanvasRef,\n  sharedCanvasHqRef,\n  cacheBuster,\n  forcePlayback,\n  noCustomEmojiPlayback,\n  isInSelectMode,\n  chatId,\n  messageId,\n  threadId,\n  maxTimestamp,\n} : {\n  entity: ApiMessageEntity;\n  entityContent: TextPart;\n  nestedEntityContent: TextPart[];\n  highlight?: string;\n  focusedQuote?: string;\n  containerId?: string;\n  asPreview?: boolean;\n  isProtected?: boolean;\n  observeIntersectionForLoading?: ObserveFn;\n  observeIntersectionForPlaying?: ObserveFn;\n  withTranslucentThumbs?: boolean;\n  emojiSize?: number;\n  sharedCanvasRef?: React.RefObject<HTMLCanvasElement>;\n  sharedCanvasHqRef?: React.RefObject<HTMLCanvasElement>;\n  cacheBuster?: string;\n  forcePlayback?: boolean;\n  noCustomEmojiPlayback?: boolean;\n  isInSelectMode?: boolean;\n  chatId?: string;\n  messageId?: number;\n  threadId?: ThreadId;\n  maxTimestamp?: number;\n}) {\n  const entityText = typeof entityContent === 'string' && entityContent;\n  const renderedContent = nestedEntityContent.length ? nestedEntityContent : entityContent;\n\n  function renderNestedMessagePart() {\n    return renderMessagePart({\n      content: renderedContent,\n      highlight,\n      focusedQuote,\n      emojiSize,\n      asPreview,\n    });\n  }\n\n  if (!entityText) {\n    return renderNestedMessagePart();\n  }\n\n  if (asPreview) {\n    const text = renderNestedMessagePart();\n    if (entity.type === ApiMessageEntityTypes.Spoiler) {\n      return <Spoiler>{text}</Spoiler>;\n    }\n\n    if (entity.type === ApiMessageEntityTypes.CustomEmoji) {\n      return (\n        <CustomEmoji\n          key={cacheBuster ? `${cacheBuster}-${entity.offset}` : undefined}\n          documentId={entity.documentId}\n          size={emojiSize}\n          isSelectable\n          withSharedAnimation\n          sharedCanvasRef={sharedCanvasRef}\n          sharedCanvasHqRef={sharedCanvasHqRef}\n          observeIntersectionForLoading={observeIntersectionForLoading}\n          observeIntersectionForPlaying={observeIntersectionForPlaying}\n          withTranslucentThumb={withTranslucentThumbs}\n          forceAlways={forcePlayback}\n          noPlay={noCustomEmojiPlayback}\n        />\n      );\n    }\n    return text;\n  }\n\n  switch (entity.type) {\n    case ApiMessageEntityTypes.Bold:\n      return <strong data-entity-type={entity.type}>{renderNestedMessagePart()}</strong>;\n    case ApiMessageEntityTypes.Blockquote:\n      return (\n        <Blockquote canBeCollapsible={entity.canCollapse} isToggleDisabled={isInSelectMode}>\n          {renderNestedMessagePart()}\n        </Blockquote>\n      );\n    case ApiMessageEntityTypes.BotCommand:\n      return (\n        <a\n          onClick={handleBotCommandClick}\n          className=\"text-entity-link\"\n          dir=\"auto\"\n          data-entity-type={entity.type}\n        >\n          {renderNestedMessagePart()}\n        </a>\n      );\n    case ApiMessageEntityTypes.Hashtag: {\n      const [tag, username] = entityContent.split('@');\n      return (\n        <a\n          onClick={() => handleHashtagClick(tag, username)}\n          className=\"text-entity-link\"\n          dir=\"auto\"\n          data-entity-type={entity.type}\n        >\n          {renderNestedMessagePart()}\n        </a>\n      );\n    }\n    case ApiMessageEntityTypes.Cashtag: {\n      const [tag, username] = entityContent.split('@');\n      return (\n        <a\n          onClick={() => handleHashtagClick(tag, username)}\n          className=\"text-entity-link\"\n          dir=\"auto\"\n          data-entity-type={entity.type}\n        >\n          {renderNestedMessagePart()}\n        </a>\n      );\n    }\n    case ApiMessageEntityTypes.Code:\n      return (\n        <code\n          className={buildClassName('text-entity-code', 'clickable')}\n          onClick={handleCodeClick}\n          role=\"textbox\"\n          tabIndex={0}\n          data-entity-type={entity.type}\n        >\n          {renderNestedMessagePart()}\n        </code>\n      );\n    case ApiMessageEntityTypes.Email:\n      return (\n        <a\n          href={`mailto:${entityText}`}\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          className=\"text-entity-link\"\n          dir=\"auto\"\n          data-entity-type={entity.type}\n        >\n          {renderNestedMessagePart()}\n        </a>\n      );\n    case ApiMessageEntityTypes.Italic:\n      return <em data-entity-type={entity.type}>{renderNestedMessagePart()}</em>;\n    case ApiMessageEntityTypes.MentionName:\n      return (\n        <MentionLink userId={entity.userId}>\n          {renderNestedMessagePart()}\n        </MentionLink>\n      );\n    case ApiMessageEntityTypes.Mention:\n      return (\n        <MentionLink username={entityText}>\n          {renderNestedMessagePart()}\n        </MentionLink>\n      );\n    case ApiMessageEntityTypes.Phone:\n      return (\n        <a\n          href={`tel:${entityText}`}\n          className=\"text-entity-link\"\n          dir=\"auto\"\n          data-entity-type={entity.type}\n        >\n          {renderNestedMessagePart()}\n        </a>\n      );\n    case ApiMessageEntityTypes.Pre:\n      return <CodeBlock text={entityText} language={entity.language} noCopy={isProtected} />;\n    case ApiMessageEntityTypes.Strike:\n      return <del data-entity-type={entity.type}>{renderNestedMessagePart()}</del>;\n    case ApiMessageEntityTypes.TextUrl:\n    case ApiMessageEntityTypes.Url:\n      return (\n        <SafeLink\n          url={getLinkUrl(entityText, entity)}\n          text={entityText}\n        >\n          {renderNestedMessagePart()}\n        </SafeLink>\n      );\n    case ApiMessageEntityTypes.Underline:\n      return <ins data-entity-type={entity.type}>{renderNestedMessagePart()}</ins>;\n    case ApiMessageEntityTypes.Timestamp:\n      if (!chatId || !messageId || !maxTimestamp || entity.timestamp > maxTimestamp) {\n        return renderNestedMessagePart();\n      }\n\n      return (\n        <a\n          onClick={() => handleTimecodeClick(chatId, messageId, threadId, entity.timestamp)}\n          className=\"text-entity-link\"\n          dir=\"auto\"\n          data-entity-type={entity.type}\n        >\n          {renderNestedMessagePart()}\n        </a>\n      );\n    case ApiMessageEntityTypes.Spoiler:\n      return <Spoiler containerId={containerId}>{renderNestedMessagePart()}</Spoiler>;\n    case ApiMessageEntityTypes.CustomEmoji:\n      return (\n        <CustomEmoji\n          key={cacheBuster ? `${cacheBuster}-${entity.offset}` : undefined}\n          documentId={entity.documentId}\n          size={emojiSize}\n          isSelectable\n          withSharedAnimation\n          sharedCanvasRef={sharedCanvasRef}\n          sharedCanvasHqRef={sharedCanvasHqRef}\n          observeIntersectionForLoading={observeIntersectionForLoading}\n          observeIntersectionForPlaying={observeIntersectionForPlaying}\n          withTranslucentThumb={withTranslucentThumbs}\n          forceAlways={forcePlayback}\n          noPlay={noCustomEmojiPlayback}\n        />\n      );\n    default:\n      return renderNestedMessagePart();\n  }\n}\n\nfunction processEntityAsHtml(\n  entity: ApiMessageEntity,\n  entityContent: TextPart,\n  nestedEntityContent: TextPart[],\n) {\n  const rawEntityText = typeof entityContent === 'string' ? entityContent : undefined;\n\n  // Prevent adding newlines when editing\n  const content = entity.type === ApiMessageEntityTypes.Pre ? (entityContent as string).trimEnd() : entityContent;\n\n  const renderedContent = nestedEntityContent.length\n    ? nestedEntityContent.join('')\n    : renderText(content, ['escape_html', 'emoji_html', 'br_html']).join('');\n\n  if (!rawEntityText) {\n    return renderedContent;\n  }\n\n  switch (entity.type) {\n    case ApiMessageEntityTypes.Bold:\n      return `<b>${renderedContent}</b>`;\n    case ApiMessageEntityTypes.Italic:\n      return `<i>${renderedContent}</i>`;\n    case ApiMessageEntityTypes.Underline:\n      return `<u>${renderedContent}</u>`;\n    case ApiMessageEntityTypes.Code:\n      return `<code class=\"text-entity-code\">${renderedContent}</code>`;\n    case ApiMessageEntityTypes.Pre:\n      return `\\`\\`\\`${renderText(entity.language || '', ['escape_html'])}<br/>${renderedContent}<br/>\\`\\`\\`<br/>`;\n    case ApiMessageEntityTypes.Strike:\n      return `<del>${renderedContent}</del>`;\n    case ApiMessageEntityTypes.MentionName:\n      return `<a\n        class=\"text-entity-link\"\n        data-entity-type=\"${ApiMessageEntityTypes.MentionName}\"\n        data-user-id=\"${entity.userId}\"\n        contenteditable=\"false\"\n        dir=\"auto\"\n      >${renderedContent}</a>`;\n    case ApiMessageEntityTypes.Url:\n    case ApiMessageEntityTypes.TextUrl:\n      return `<a\n        class=\"text-entity-link\"\n        href=${getLinkUrl(rawEntityText, entity)}\n        data-entity-type=\"${entity.type}\"\n        dir=\"auto\"\n      >${renderedContent}</a>`;\n    case ApiMessageEntityTypes.Spoiler:\n      return `<span\n        class=\"spoiler\"\n        data-entity-type=\"${ApiMessageEntityTypes.Spoiler}\"\n        >${renderedContent}</span>`;\n    case ApiMessageEntityTypes.CustomEmoji:\n      return buildCustomEmojiHtmlFromEntity(rawEntityText, entity);\n    case ApiMessageEntityTypes.Blockquote:\n      return `<blockquote\n        class=\"blockquote\"\n        data-entity-type=\"${ApiMessageEntityTypes.Blockquote}\"\n        >${renderedContent}</blockquote>`;\n    default:\n      return renderedContent;\n  }\n}\n\nfunction getLinkUrl(entityContent: string, entity: ApiMessageEntity) {\n  const { type } = entity;\n  return type === ApiMessageEntityTypes.TextUrl && entity.url ? entity.url : entityContent;\n}\n\nfunction handleBotCommandClick(e: React.MouseEvent<HTMLAnchorElement>) {\n  getActions().sendBotCommand({ command: e.currentTarget.innerText });\n}\n\nfunction handleHashtagClick(hashtag?: string, username?: string) {\n  if (!hashtag) return;\n  if (username) {\n    getActions().openChatByUsername({\n      username,\n      onChatChanged: {\n        action: 'searchHashtag',\n        payload: { hashtag },\n      },\n    });\n    return;\n  }\n  getActions().searchHashtag({ hashtag });\n}\n\nfunction handleCodeClick(e: React.MouseEvent<HTMLElement>) {\n  copyTextToClipboard(e.currentTarget.innerText);\n  getActions().showNotification({\n    message: oldTranslate('TextCopied'),\n  });\n}\n\nfunction handleTimecodeClick(\n  chatId: string, messageId: number, threadId: ThreadId | undefined, timestamp: number,\n) {\n  getActions().openMediaFromTimestamp({\n    chatId, messageId, threadId, timestamp,\n  });\n}\n","import { getActions, getGlobal } from '../global';\n\nimport { addCustomEmojiInputRenderCallback } from '../util/emoji/customEmojiManager';\nimport { throttle } from '../util/schedulers';\n\nlet LOAD_QUEUE = new Set<string>();\nconst RENDER_HISTORY = new Set<string>();\nconst THROTTLE = 200;\nconst LIMIT_PER_REQUEST = 100;\n\nconst loadFromQueue = throttle(() => {\n  const queue = [...LOAD_QUEUE];\n\n  const queueToLoad = queue.slice(0, LIMIT_PER_REQUEST);\n  const otherQueue = queue.slice(LIMIT_PER_REQUEST + 1);\n\n  getActions().loadCustomEmojis({\n    ids: queueToLoad,\n  });\n\n  LOAD_QUEUE = new Set(otherQueue);\n\n  // Schedule next load\n  if (LOAD_QUEUE.size) {\n    loadFromQueue();\n  }\n}, THROTTLE, false);\n\nconst updateLastRendered = throttle(() => {\n  getActions().updateLastRenderedCustomEmojis({\n    ids: [...RENDER_HISTORY].reverse(),\n  });\n\n  RENDER_HISTORY.clear();\n}, THROTTLE, false);\n\nfunction notifyCustomEmojiRender(emojiId: string) {\n  RENDER_HISTORY.add(emojiId);\n  updateLastRendered();\n}\n\naddCustomEmojiInputRenderCallback(notifyCustomEmojiRender);\n\nexport default function useEnsureCustomEmoji(id?: string) {\n  if (!id) return;\n  notifyCustomEmojiRender(id);\n\n  if (getGlobal().customEmojis.byId[id]) {\n    return;\n  }\n\n  LOAD_QUEUE.add(id);\n  loadFromQueue();\n}\n","import { useEffect, useState } from '../../../lib/teact/teact';\nimport { getGlobal } from '../../../global';\n\nimport type { ApiSticker } from '../../../api/types';\nimport type { GlobalState } from '../../../global/types';\n\nimport { selectCanPlayAnimatedEmojis } from '../../../global/selectors';\nimport { addCustomEmojiCallback, removeCustomEmojiCallback } from '../../../util/emoji/customEmojiManager';\n\nimport useEnsureCustomEmoji from '../../../hooks/useEnsureCustomEmoji';\nimport useLastCallback from '../../../hooks/useLastCallback';\n\nexport default function useCustomEmoji(documentId?: string) {\n  const [customEmoji, setCustomEmoji] = useState<ApiSticker | undefined>(\n    documentId ? getGlobal().customEmojis.byId[documentId] : undefined,\n  );\n  const [canPlay, setCanPlay] = useState(selectCanPlayAnimatedEmojis(getGlobal()));\n\n  useEnsureCustomEmoji(documentId);\n\n  const handleGlobalChange = useLastCallback((customEmojis?: GlobalState['customEmojis']) => {\n    if (!documentId) return;\n\n    const newGlobal = getGlobal();\n    setCustomEmoji((customEmojis ?? newGlobal.customEmojis).byId[documentId]);\n    setCanPlay(selectCanPlayAnimatedEmojis(newGlobal));\n  });\n\n  useEffect(handleGlobalChange, [documentId, handleGlobalChange]);\n\n  useEffect(() => {\n    if (!documentId) return undefined;\n\n    addCustomEmojiCallback(handleGlobalChange, documentId);\n\n    return () => {\n      removeCustomEmojiCallback(handleGlobalChange);\n    };\n  }, [customEmoji, documentId, handleGlobalChange]);\n\n  return { customEmoji, canPlay };\n}\n","import type { AriaRole } from 'react';\nimport React from '../../../lib/teact/teact';\n\nimport type { IconName } from '../../../types/icons';\n\nimport buildClassName from '../../../util/buildClassName';\n\ntype OwnProps = {\n  name: IconName;\n  className?: string;\n  style?: string;\n  role?: AriaRole;\n  ariaLabel?: string;\n  character?: string;\n  ref?: React.RefObject<HTMLElement>;\n  onClick?: (e: React.MouseEvent<HTMLDivElement>) => void;\n};\n\nconst Icon = ({\n  name,\n  ref,\n  className,\n  style,\n  role,\n  ariaLabel,\n  character,\n  onClick,\n}: OwnProps) => {\n  return (\n    <i\n      ref={ref}\n      className={buildClassName(`icon icon-${name}`, className)}\n      style={style}\n      aria-hidden={!ariaLabel}\n      aria-label={ariaLabel}\n      data-char={character}\n      role={role}\n      onClick={onClick}\n    />\n  );\n};\n\nexport default Icon;\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"qEhgJEpm\",\"middle\":\"GjxPnwZR\",\"big\":\"HRLrnZvQ\",\"adaptive\":\"ebO2WJkv\",\"svg\":\"lbK6aMGA\",\"clickable\":\"hqg1cKl7\"};","import type { FC } from '../../../lib/teact/teact';\nimport React, { memo } from '../../../lib/teact/teact';\n\nimport buildClassName from '../../../util/buildClassName';\n\nimport useUniqueId from '../../../hooks/useUniqueId';\n\nimport styles from './StarIcon.module.scss';\n\ntype OwnProps = {\n  type?: 'gold' | 'premium' | 'regular';\n  size?: 'small' | 'middle' | 'big' | 'adaptive';\n  className?: string;\n  style?: string;\n  onClick?: VoidFunction;\n};\n\n/* eslint-disable max-len */\nconst STAR_PATH = 'M6.63869 12.1902L3.50621 14.1092C3.18049 14.3087 2.75468 14.2064 2.55515 13.8807C2.45769 13.7216 2.42864 13.5299 2.47457 13.3491L2.95948 11.4405C3.13452 10.7515 3.60599 10.1756 4.24682 9.86791L7.6642 8.22716C7.82352 8.15067 7.89067 7.95951 7.81418 7.80019C7.75223 7.67116 7.61214 7.59896 7.47111 7.62338L3.66713 8.28194C2.89387 8.41581 2.1009 8.20228 1.49941 7.69823L0.297703 6.69116C0.00493565 6.44581 -0.0335059 6.00958 0.211842 5.71682C0.33117 5.57442 0.502766 5.48602 0.687982 5.47153L4.35956 5.18419C4.61895 5.16389 4.845 4.99974 4.94458 4.75937L6.36101 1.3402C6.5072 0.987302 6.91179 0.819734 7.26469 0.965925C7.43413 1.03612 7.56876 1.17075 7.63896 1.3402L9.05539 4.75937C9.15496 4.99974 9.38101 5.16389 9.6404 5.18419L13.3322 5.47311C13.713 5.50291 13.9975 5.83578 13.9677 6.2166C13.9534 6.39979 13.8667 6.56975 13.7269 6.68896L10.9114 9.08928C10.7131 9.25826 10.6267 9.52425 10.6876 9.77748L11.5532 13.3733C11.6426 13.7447 11.414 14.1182 11.0427 14.2076C10.8642 14.2506 10.676 14.2208 10.5195 14.1249L7.36128 12.1902C7.13956 12.0544 6.8604 12.0544 6.63869 12.1902Z';\n/* eslint-enable max-len */\n\nconst StarIcon: FC<OwnProps> = ({\n  type = 'regular',\n  size = 'small',\n  className,\n  style,\n  onClick,\n}) => {\n  const randomId = useUniqueId();\n  const validSvgRandomId = `svg-${randomId}`; // ID must start with a letter\n\n  const renderIcon = () => {\n    switch (type) {\n      case 'gold':\n        return <GoldStarIcon randomId={validSvgRandomId} />;\n      case 'premium':\n        return <PremiumStarIcon randomId={validSvgRandomId} />;\n      default:\n        return <RegularStarIcon />;\n    }\n  };\n\n  return (\n    <i\n      onClick={onClick}\n      className={buildClassName(\n        'StarIcon',\n        styles.root,\n        className,\n        onClick && styles.clickable,\n        styles[size],\n      )}\n      style={style}\n    >\n      {renderIcon()}\n    </i>\n  );\n};\n\nfunction GoldStarIcon({ randomId }: { randomId: string }) {\n  const mask1Id = `${randomId}-mask1`;\n  const mask2Id = `${randomId}-mask2`;\n  const gradient1Id = `${randomId}-gradient1`;\n  const gradient2Id = `${randomId}-gradient2`;\n  const gradient3Id = `${randomId}-gradient3`;\n\n  return (\n    <svg className={styles.svg} width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n      <g clip-path=\"url(#clip0_4913_7387)\">\n        <mask id={mask1Id} style=\"mask-type:luminance\" maskUnits=\"userSpaceOnUse\" x=\"-2\" y=\"-2\" width=\"24\" height=\"24\">\n          <path d=\"M21.416 -1.42493H-1.08398V21.0751H21.416V-1.42493Z\" fill=\"white\" />\n        </mask>\n        <g mask={`url(#${mask1Id})`}>\n          <mask\n            id={mask2Id}\n            style=\"mask-type:luminance\"\n            maskUnits=\"userSpaceOnUse\"\n            x=\"-2\"\n            y=\"-2\"\n            width=\"24\"\n            height=\"24\"\n          >\n            <path d=\"M-1.08398 -1.42493H21.416V21.0751H-1.08398V-1.42493Z\" fill=\"white\" />\n          </mask>\n          <g mask={`url(#${mask2Id})`}>\n            <path d=\"M7.26843 6.25162L9.28943 2.22541C9.52311 1.76121 10.0884 1.5749 10.5494 1.80857C10.7294 1.90015 10.8747 2.04857 10.9662 2.23172L12.8767 6.11583C13.0314 6.43477 13.3378 6.64951 13.6883 6.69056L17.6829 7.17055C18.2261 7.23686 18.6145 7.73264 18.5513 8.27894C18.5229 8.50314 18.4218 8.71156 18.2608 8.86945L15.0998 11.9862C14.9703 12.1125 14.9103 12.2894 14.9324 12.4694L15.4598 16.6756C15.5356 17.2787 15.1093 17.8282 14.5093 17.904C14.2819 17.9324 14.0546 17.8913 13.8525 17.7808L10.5147 15.9556C10.2715 15.823 9.98099 15.8198 9.73784 15.9461L6.27687 17.7208C5.79057 17.9703 5.1969 17.7745 4.94743 17.285C4.8527 17.1019 4.82112 16.8966 4.84954 16.6945L5.12427 14.7619C5.26006 13.8177 5.84425 12.9967 6.69055 12.5641L10.5305 10.6031C10.6315 10.5526 10.6726 10.4263 10.622 10.322C10.581 10.2431 10.4957 10.1957 10.4073 10.2084L5.70847 10.8841C4.99164 10.9852 4.26535 10.7831 3.7001 10.322L2.13698 9.04629C1.69173 8.68314 1.6191 8.02 1.98225 7.57159C2.15277 7.36317 2.39592 7.22739 2.66118 7.19265L6.6716 6.67793C6.92739 6.64319 7.15159 6.4853 7.26843 6.25162Z\" fill={`url(#${gradient1Id})`} />\n            <path d=\"M10.8242 2.9422C10.4168 2.85062 9.98417 3.0464 9.78839 3.43797L7.76423 7.46419C7.64739 7.69787 7.42634 7.85576 7.1674 7.89049L3.15698 8.40837C2.89804 8.44311 2.6612 8.56942 2.49384 8.76837L3.97801 9.98097C4.44537 10.3631 5.05167 10.5304 5.64849 10.4452L10.3442 9.77255C10.6221 9.73466 10.8936 9.8736 11.0168 10.1231C11.1778 10.442 11.0515 10.8336 10.7326 10.9978L9.50734 11.623L10.9031 11.4209C10.9915 11.4083 11.0799 11.4557 11.1178 11.5346C11.1715 11.6388 11.1273 11.7651 11.0263 11.8157L7.18635 13.7767C6.34006 14.2093 5.75586 15.0303 5.62007 15.9745L5.44008 17.2282C5.60428 17.3924 5.86322 17.4366 6.07796 17.326L9.53261 15.5514C9.90839 15.3587 10.3536 15.365 10.7231 15.5671L14.0609 17.3924C14.1809 17.4587 14.3199 17.4839 14.4556 17.4682C14.8093 17.4239 15.0651 17.0955 15.0209 16.7324L14.4967 12.523C14.4588 12.2072 14.5662 11.8946 14.7904 11.6736L17.9513 8.55679C18.005 8.50311 18.0461 8.43995 18.0745 8.37048L14.1841 7.90312C13.8336 7.86207 13.5304 7.64418 13.3725 7.3284L13.2209 7.01578C12.902 6.87683 12.6399 6.63052 12.482 6.31159L10.8242 2.9422Z\" fill={`url(#${gradient2Id})`} />\n            <path d=\"M10.7484 1.41397C10.0663 1.06977 9.23893 1.3445 8.89789 2.02659L6.87373 6.05596C6.8232 6.15701 6.72531 6.22649 6.61478 6.23912L2.60436 6.757C2.22542 6.80437 1.87806 7.00015 1.63807 7.29699C1.12334 7.93486 1.22124 8.86958 1.85596 9.38746L3.42223 10.6664C4.08222 11.2032 4.93167 11.44 5.77165 11.32L9.09051 10.8432L6.48847 12.1727C5.51271 12.6716 4.84325 13.6126 4.68852 14.6989L4.41063 16.6315C4.36958 16.9252 4.41695 17.222 4.55273 17.4873C4.90956 18.1915 5.77481 18.4725 6.479 18.1125L9.93681 16.3378C10.0505 16.2778 10.1863 16.281 10.3 16.3441L13.6378 18.1662C13.9188 18.3209 14.2441 18.3841 14.563 18.343C15.4061 18.2357 15.9998 17.462 15.8956 16.622L15.3714 12.4126C15.3651 12.3716 15.3809 12.3274 15.4093 12.299L18.5703 9.1822C18.8008 8.95168 18.9492 8.65169 18.9871 8.32959C19.0787 7.5433 18.5229 6.82963 17.7366 6.73489L13.7388 6.25491C13.5399 6.2328 13.363 6.10649 13.2715 5.92334L11.3641 2.03606C11.2315 1.76765 11.0136 1.54976 10.7484 1.41397ZM9.68418 2.42132C9.80734 2.17501 10.1073 2.07712 10.3505 2.20027C10.4452 2.24764 10.5242 2.32974 10.5715 2.42763L12.482 6.31175C12.7031 6.76332 13.1357 7.06962 13.6346 7.12962L17.6324 7.60961C17.9324 7.64435 18.1471 7.91908 18.1124 8.22538C18.0966 8.3517 18.0398 8.46854 17.9513 8.55695L14.7904 11.6737C14.5662 11.8948 14.4588 12.2074 14.4967 12.5232L15.0209 16.7325C15.0651 17.0957 14.8093 17.4241 14.4556 17.4683C14.3199 17.4841 14.1809 17.4588 14.0609 17.3925L10.7231 15.5673C10.3536 15.3652 9.90839 15.362 9.53261 15.5547L6.0748 17.3294C5.80638 17.4652 5.47797 17.3578 5.33903 17.0862C5.2885 16.9852 5.26956 16.8683 5.28534 16.7546L5.56007 14.8252C5.67376 14.0231 6.17269 13.3253 6.88952 12.959L10.7294 10.9979C11.0515 10.8337 11.1778 10.4422 11.0168 10.1232C10.8905 9.87376 10.6221 9.73482 10.3442 9.77271L5.64534 10.4453C5.04851 10.5306 4.44537 10.3632 3.97801 9.98113L2.41489 8.70221C2.15595 8.49064 2.1149 8.10854 2.32647 7.8496C2.42436 7.72961 2.56331 7.65066 2.71488 7.63171L6.72531 7.11383C7.12951 7.06331 7.48003 6.81384 7.66318 6.45069L9.68418 2.42132Z\" fill={`url(#${gradient3Id})`} />\n          </g>\n        </g>\n      </g>\n      <defs>\n        <linearGradient\n          id={gradient1Id}\n          x1=\"10.1547\"\n          y1=\"1.70752\"\n          x2=\"10.1547\"\n          y2=\"17.9134\"\n          gradientUnits=\"userSpaceOnUse\"\n        >\n          <stop stop-color=\"#FFF0C2\" />\n          <stop offset=\"1\" stop-color=\"#FFEBBA\" />\n        </linearGradient>\n        <linearGradient\n          id={gradient2Id}\n          x1=\"10.2842\"\n          y1=\"2.92009\"\n          x2=\"14.7304\"\n          y2=\"17.4713\"\n          gradientUnits=\"userSpaceOnUse\"\n        >\n          <stop stop-color=\"#FFD147\" />\n          <stop offset=\"1\" stop-color=\"#FFB526\" />\n        </linearGradient>\n        <linearGradient\n          id={gradient3Id}\n          x1=\"10.1547\"\n          y1=\"1.26556\"\n          x2=\"14.0546\"\n          y2=\"18.3525\"\n          gradientUnits=\"userSpaceOnUse\"\n        >\n          <stop stop-color=\"#E58F0D\" />\n          <stop offset=\"1\" stop-color=\"#EB7814\" />\n        </linearGradient>\n        <clipPath id=\"clip0_4913_7387\">\n          <rect width=\"20\" height=\"20\" fill=\"white\" />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n}\n\nfunction PremiumStarIcon({ randomId }: { randomId: string }) {\n  return (\n    <svg className={styles.svg} width=\"14\" height=\"15\" viewBox=\"0 0 14 15\" fill=\"none\">\n      <defs>\n        <linearGradient id={randomId} x1=\"3\" y1=\"63.5001\" x2=\"84.1475\" y2=\"-1.32262\" gradientUnits=\"userSpaceOnUse\">\n          <stop stop-color=\"#6B93FF\" />\n          <stop offset=\"0.439058\" stop-color=\"#976FFF\" />\n          <stop offset=\"1\" stop-color=\"#E46ACE\" />\n        </linearGradient>\n      </defs>\n      <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d={STAR_PATH} fill={`url(#${randomId})`} />\n    </svg>\n  );\n}\n\nfunction RegularStarIcon() {\n  return (\n    <svg className={styles.svg} width=\"14\" height=\"15\" viewBox=\"0 0 14 15\" fill=\"none\">\n      <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d={STAR_PATH} fill=\"var(--color-fill)\" />\n    </svg>\n  );\n}\n\nexport default memo(StarIcon);\n","import { getGlobal } from '../../../../global';\n\nimport type { ApiMessageEntityCustomEmoji, ApiSticker } from '../../../../api/types';\nimport { ApiMessageEntityTypes } from '../../../../api/types';\n\nimport { EMOJI_SIZES } from '../../../../config';\nimport buildClassName from '../../../../util/buildClassName';\nimport { getInputCustomEmojiParams } from '../../../../util/emoji/customEmojiManager';\nimport { REM } from '../../../common/helpers/mediaDimensions';\n\nexport const INPUT_CUSTOM_EMOJI_SELECTOR = 'img[data-document-id]';\n\nexport function buildCustomEmojiHtml(emoji: ApiSticker) {\n  const [isPlaceholder, src, uniqueId] = getInputCustomEmojiParams(emoji);\n\n  const className = buildClassName(\n    'custom-emoji', 'emoji', 'emoji-small', isPlaceholder && 'placeholder', emoji.shouldUseTextColor && 'colorable',\n  );\n\n  return `<img\n    class=\"${className}\"\n    draggable=\"false\"\n    alt=\"${emoji.emoji}\"\n    data-document-id=\"${emoji.id}\"\n    ${uniqueId ? `data-unique-id=\"${uniqueId}\"` : ''}\n    data-entity-type=\"${ApiMessageEntityTypes.CustomEmoji}\"\n    src=\"${src}\"\n  />`;\n}\n\nexport function buildCustomEmojiHtmlFromEntity(rawText: string, entity: ApiMessageEntityCustomEmoji) {\n  const customEmoji = getGlobal().customEmojis.byId[entity.documentId];\n  const [isPlaceholder, src, uniqueId] = getInputCustomEmojiParams(customEmoji);\n\n  const className = buildClassName(\n    'custom-emoji',\n    'emoji',\n    'emoji-small',\n    isPlaceholder && 'placeholder',\n    customEmoji?.shouldUseTextColor && 'colorable',\n  );\n\n  return `<img\n    class=\"${className}\"\n    draggable=\"false\"\n    alt=\"${rawText}\"\n    data-document-id=\"${entity.documentId}\"\n    ${uniqueId ? `data-unique-id=\"${uniqueId}\"` : ''}\n    data-entity-type=\"${ApiMessageEntityTypes.CustomEmoji}\"\n    src=\"${src}\"\n  />`;\n}\n\nexport function getCustomEmojiSize(maxEmojisInLine?: number): number | undefined {\n  if (!maxEmojisInLine) return undefined;\n\n  // Should be the same as in _message-content.scss\n  if (maxEmojisInLine > EMOJI_SIZES) return 2.25 * REM;\n  if (maxEmojisInLine === 1) return 7 * REM;\n  return Math.min(7.5 - (maxEmojisInLine * 0.75), 5.625) * REM;\n}\n","import type React from '../../../lib/teact/teact';\n\nimport { EDITABLE_INPUT_ID } from '../../../config';\nimport { IS_IOS } from '../../../util/windowEnvironment';\n\nexport function preventMessageInputBlur(e: React.MouseEvent<HTMLElement>, withBubbling = false) {\n  if (\n    IS_IOS\n    || !document.activeElement\n    || document.activeElement.id !== EDITABLE_INPUT_ID\n    || (!withBubbling && e.target !== e.currentTarget)\n  ) {\n    return;\n  }\n\n  e.preventDefault();\n}\n\nexport function preventMessageInputBlurWithBubbling(e: React.MouseEvent<HTMLElement>) {\n  preventMessageInputBlur(e, true);\n}\n","import type { TeactNode } from '../../lib/teact/teact';\n\nimport type { LangFn } from './types';\n\nconst UNIQUE_PLACEHOLDER_PREFIX = '$PLACEHOLDER-';\n\nexport function conjuctionWithNodes(langFn: LangFn, nodes: TeactNode[]) {\n  const placeholders = nodes.map((node, i) => `${UNIQUE_PLACEHOLDER_PREFIX}${i}`);\n  const replaced = langFn.internalFormatters.conjunction.formatToParts(placeholders);\n  const result: TeactNode[] = [];\n  replaced.forEach((part) => {\n    if (part.type === 'literal') {\n      result.push(part.value);\n      return;\n    }\n\n    const index = Number(part.value.slice(UNIQUE_PLACEHOLDER_PREFIX.length));\n    result.push(nodes[index]);\n  });\n\n  return result;\n}\n\nexport function disjunctionWithNodes(langFn: LangFn, nodes: TeactNode[]) {\n  const placeholders = nodes.map((node, i) => `${UNIQUE_PLACEHOLDER_PREFIX}${i}`);\n  const replaced = langFn.internalFormatters.disjunction.formatToParts(placeholders);\n  const result: TeactNode[] = [];\n  replaced.forEach((part) => {\n    if (part.type === 'literal') {\n      result.push(part.value);\n      return;\n    }\n\n    const index = Number(part.value.slice(UNIQUE_PLACEHOLDER_PREFIX.length));\n    result.push(nodes[index]);\n  });\n\n  return result;\n}\n","import React, { memo, type TeactNode } from '../../../lib/teact/teact';\nimport { getActions, getGlobal, withGlobal } from '../../../global';\n\nimport type { ApiChat, ApiMessage, ApiPeer } from '../../../api/types';\n\nimport { GENERAL_TOPIC_ID, SERVICE_NOTIFICATIONS_USER_ID, TME_LINK_PREFIX } from '../../../config';\nimport {\n  getMessageInvoice, getMessageText, getPeerTitle, isChatChannel,\n} from '../../../global/helpers';\nimport { getMessageReplyInfo } from '../../../global/helpers/replies';\nimport {\n  selectChat,\n  selectChatMessage,\n  selectPeer,\n  selectSender,\n  selectThreadIdFromMessage,\n  selectTopic,\n} from '../../../global/selectors';\nimport { ensureProtocol } from '../../../util/browser/url';\nimport { formatDateTimeToString, formatShortDuration } from '../../../util/dates/dateFormat';\nimport { formatCurrency } from '../../../util/formatCurrency';\nimport { formatStarsAsText } from '../../../util/localization/format';\nimport { conjuctionWithNodes } from '../../../util/localization/utils';\nimport renderText from '../../common/helpers/renderText';\nimport { renderTextWithEntities } from '../../common/helpers/renderTextWithEntities';\nimport {\n  getCallMessageKey,\n  getPinnedMediaValue,\n  renderMessageLink,\n  renderPeerLink,\n  translateWithYou,\n} from './helpers/messageActions';\n\nimport useLang from '../../../hooks/useLang';\nimport useLastCallback from '../../../hooks/useLastCallback';\n\nimport CustomEmoji from '../../common/CustomEmoji';\nimport TopicDefaultIcon from '../../common/TopicDefaultIcon';\nimport Link from '../../ui/Link';\n\nimport styles from './ActionMessage.module.scss';\n\ntype OwnProps = {\n  message: ApiMessage;\n  isInsideTopic?: boolean;\n  asPreview?: boolean;\n};\n\ntype StateProps = {\n  currentUserId?: string;\n  sender?: ApiPeer;\n  replyMessage?: ApiMessage;\n  chat?: ApiChat;\n};\n\nconst NBSP = '\\u00A0';\nconst DEFAULT_TOPIC_ICON_ID = '0';\n\nconst UNSUPPORTED_LANG_KEY = 'ActionUnsupported';\n\nconst ActionMessageText = ({\n  message,\n  currentUserId,\n  sender,\n  chat,\n  replyMessage,\n  isInsideTopic,\n  asPreview,\n}: OwnProps & StateProps) => {\n  const {\n    openThread,\n    openTelegramLink,\n    openUrl,\n  } = getActions();\n  const { chatId, isOutgoing } = message;\n  const action = message.content.action!;\n\n  const lang = useLang();\n\n  function renderStrong(text: TeactNode) {\n    if (asPreview) return text;\n    return <span className={styles.strong}>{text}</span>;\n  }\n\n  const renderActionText = useLastCallback(() => {\n    const global = getGlobal();\n\n    const isChannel = chat && isChatChannel(chat);\n    const isServiceNotificationsChat = chatId === SERVICE_NOTIFICATIONS_USER_ID;\n    const isSavedMessages = chatId === currentUserId;\n\n    const senderTitle = sender && getPeerTitle(lang, sender);\n    const chatTitle = chat && getPeerTitle(lang, chat);\n\n    const userFallbackText = lang('ActionFallbackUser');\n    const chatFallbackText = lang('ActionFallbackChat');\n    const channelFallbackText = lang('ActionFallbackChannel');\n\n    const senderLink = renderPeerLink(sender?.id, senderTitle || userFallbackText, asPreview);\n    const chatLink = renderPeerLink(chat?.id, chatTitle || chatFallbackText, asPreview);\n\n    switch (action.type) {\n      case 'pinMessage': {\n        if (replyMessage) {\n          const formattedText = getMessageText(replyMessage);\n          if (formattedText) {\n            const textLink = renderMessageLink(\n              replyMessage,\n              renderTextWithEntities({\n                text: formattedText.text,\n                entities: formattedText.entities,\n                asPreview: true,\n              }),\n              asPreview,\n            );\n\n            return translateWithYou(\n              lang, 'ActionPinnedText', isOutgoing, { text: textLink, from: senderLink },\n            );\n          }\n\n          const mediaValue = getPinnedMediaValue(lang, replyMessage);\n          if (mediaValue) {\n            const messageLink = renderMessageLink(replyMessage, mediaValue, asPreview);\n            return translateWithYou(\n              lang, 'ActionPinnedMedia', isOutgoing, { from: senderLink, media: messageLink },\n            );\n          }\n        }\n\n        return translateWithYou(\n          lang,\n          'ActionPinnedNotFound',\n          isOutgoing,\n          { from: senderLink },\n        );\n      }\n\n      case 'gameScore': {\n        const { score } = action;\n\n        const gameTitle = replyMessage?.content.game?.title;\n        const gameLink = gameTitle && renderMessageLink(replyMessage, renderText(gameTitle), asPreview);\n\n        if (gameLink) {\n          return translateWithYou(\n            lang,\n            'ActionGameScore',\n            isOutgoing,\n            { from: senderLink, count: score, game: gameLink },\n            { pluralValue: score },\n          );\n        }\n\n        return translateWithYou(\n          lang, 'ActionGameScoreNoGame', isOutgoing, { from: senderLink, count: score }, { pluralValue: score },\n        );\n      }\n\n      case 'chatJoinedByLink':\n        return lang('ActionUserJoinedByLink', { from: senderLink }, { withNodes: true });\n\n      case 'chatJoinedByRequest':\n        return translateWithYou(lang, 'ActionJoinedByRequest', isOutgoing, { from: senderLink });\n\n      case 'channelJoined': {\n        const { isViaRequest, inviterId } = action;\n        const inviter = inviterId ? selectPeer(global, inviterId) : undefined;\n        if (inviter && inviterId !== currentUserId) {\n          const inviterLink = renderPeerLink(inviterId, getPeerTitle(lang, inviter) || userFallbackText, asPreview);\n          return lang('ActionAddYou', { from: inviterLink }, { withNodes: true });\n        }\n\n        return lang(isViaRequest ? 'ActionChannelJoinedByRequestChannelYou' : 'ActionChannelJoinedYou');\n      }\n\n      case 'chatEditTitle': {\n        const { title } = action;\n        if (isChannel) return lang('ActionChangedTitleChannel', { title });\n        return translateWithYou(lang, 'ActionChangedTitle', isOutgoing, { title, from: senderLink });\n      }\n\n      case 'chatDeletePhoto':\n        return isChannel ? lang('ActionRemovedPhotoChannel')\n          : translateWithYou(lang, 'ActionRemovedPhoto', isOutgoing, { from: senderLink });\n\n      case 'chatEditPhoto':\n        return isChannel ? lang('ActionChangedPhotoChannel')\n          : translateWithYou(lang, 'ActionChangedPhoto', isOutgoing, { from: senderLink });\n\n      case 'chatCreate': {\n        const { title } = action;\n        return lang('ActionCreatedChat', { title, from: senderLink }, { withNodes: true });\n      }\n\n      case 'channelCreate': {\n        const { title } = action;\n        return isChannel ? lang('ActionCreatedChannel')\n          : translateWithYou(lang, 'ActionCreatedChat', isOutgoing, { title, from: senderLink });\n      }\n\n      case 'chatMigrateTo': {\n        const { channelId } = action;\n        const channel = selectChat(global, channelId)!;\n        const channelLink = renderPeerLink(channelId, getPeerTitle(lang, channel)!, asPreview);\n        return lang('ActionMigratedTo', { chat: channelLink }, { withNodes: true });\n      }\n\n      case 'channelMigrateFrom': {\n        const { chatId: originalChatId, title } = action;\n        const originalChatLink = renderPeerLink(originalChatId, title || chatFallbackText, asPreview);\n        return lang('ActionMigratedFrom', { chat: originalChatLink }, { withNodes: true });\n      }\n\n      case 'topicCreate': {\n        const { title, iconColor, iconEmojiId } = action;\n\n        const topicId = selectThreadIdFromMessage(global, message);\n\n        const topicLink = (\n          <Link\n            className={styles.topicLink}\n            // eslint-disable-next-line react/jsx-no-bind\n            onClick={() => openThread({ chatId, threadId: topicId })}\n          >\n            {iconEmojiId ? <CustomEmoji documentId={iconEmojiId} isSelectable />\n              : <TopicDefaultIcon topicId={topicId} title={title} iconColor={iconColor} />}\n            {NBSP}\n            {renderText(title)}\n          </Link>\n        );\n        return lang('ActionTopicCreated', { topic: topicLink }, { withNodes: true });\n      }\n\n      case 'topicEdit': {\n        const {\n          iconEmojiId, isClosed, isHidden, title,\n        } = action;\n\n        const topicId = selectThreadIdFromMessage(global, message);\n        const currentTopic = selectTopic(global, chatId, topicId);\n        const topicLink = (\n          <Link\n            className={styles.topicLink}\n            // eslint-disable-next-line react/jsx-no-bind\n            onClick={() => openThread({ chatId, threadId: topicId })}\n          >\n            {iconEmojiId && iconEmojiId !== DEFAULT_TOPIC_ICON_ID\n              ? <CustomEmoji documentId={iconEmojiId} isSelectable />\n              : (\n                <TopicDefaultIcon\n                  topicId={topicId}\n                  title={title || currentTopic?.title || lang('ActionTopicPlaceholder')}\n                  iconColor={currentTopic?.iconColor}\n                />\n              )}\n            {topicId !== GENERAL_TOPIC_ID && NBSP}\n            {renderText(title || currentTopic?.title || lang('ActionTopicPlaceholder'))}\n          </Link>\n        );\n\n        const topicPlaceholderLink = (\n          <Link\n            className={styles.topicLink}\n            // eslint-disable-next-line react/jsx-no-bind\n            onClick={() => openThread({ chatId, threadId: topicId })}\n          >\n            {lang('ActionTopicPlaceholder')}\n          </Link>\n        );\n\n        if (isClosed !== undefined) {\n          if (isInsideTopic) {\n            return lang(isClosed ? 'ActionTopicClosedInside' : 'ActionTopicReopenedInside');\n          }\n\n          return lang(\n            isClosed ? 'ActionTopicClosed' : 'ActionTopicReopened',\n            { from: senderLink, topic: topicLink },\n            { withNodes: true },\n          );\n        }\n\n        if (isHidden !== undefined) {\n          if (isInsideTopic) {\n            return lang(isHidden ? 'ActionTopicHiddenInside' : 'ActionTopicUnhiddenInside');\n          }\n          return lang(\n            isHidden ? 'ActionTopicHidden' : 'ActionTopicUnhidden',\n            { topic: topicLink },\n            { withNodes: true },\n          );\n        }\n\n        if (title && iconEmojiId) {\n          return lang(\n            'ActionTopicIconAndRenamed',\n            {\n              from: senderLink,\n              link: topicPlaceholderLink,\n              topic: topicLink,\n            },\n            { withNodes: true },\n          );\n        }\n\n        if (title === undefined) {\n          if (!iconEmojiId || iconEmojiId === DEFAULT_TOPIC_ICON_ID) {\n            return lang(\n              'ActionTopicIconRemoved', { from: senderLink, link: topicPlaceholderLink }, { withNodes: true },\n            );\n          }\n          return lang(\n            'ActionTopicIconChanged',\n            {\n              from: senderLink,\n              link: topicPlaceholderLink,\n              emoji: <CustomEmoji documentId={iconEmojiId} loopLimit={2} />,\n            },\n            { withNodes: true },\n          );\n        }\n\n        return lang('ActionTopicRenamed', { from: senderLink, link: topicPlaceholderLink, title }, { withNodes: true });\n      }\n\n      case 'boostApply':\n        return translateWithYou(\n          lang,\n          'ActionBoostApply',\n          isOutgoing,\n          { from: senderLink, count: action.boosts },\n          { pluralValue: action.boosts },\n        );\n\n      case 'chatAddUser': {\n        const { userIds } = action;\n\n        if (sender?.id === userIds[0]) {\n          return translateWithYou(lang, 'ActionUserJoined', isOutgoing, { from: senderLink });\n        }\n\n        if (userIds.length === 1) {\n          const user = selectPeer(global, userIds[0]);\n          const userTitle = (user && getPeerTitle(lang, user)) || userFallbackText;\n          const userLink = renderPeerLink(user?.id, userTitle, asPreview);\n          return translateWithYou(lang, 'ActionAddUser', isOutgoing, { from: senderLink, user: userLink });\n        }\n\n        const users = userIds.map((userId) => selectPeer(global, userId)).filter(Boolean);\n\n        if (!users.length) {\n          return translateWithYou(lang, 'ActionAddUser', isOutgoing, { from: senderLink, user: userFallbackText });\n        }\n\n        const userLinks = users.map((user) => (\n          renderPeerLink(user.id, getPeerTitle(lang, user) || userFallbackText, asPreview)\n        ));\n\n        return translateWithYou(\n          lang, 'ActionAddUsersMany', isOutgoing, { from: senderLink, users: conjuctionWithNodes(lang, userLinks) },\n        );\n      }\n\n      case 'chatDeleteUser': {\n        const { userId } = action;\n        if (sender?.id === userId) {\n          return translateWithYou(lang, 'ActionUserLeft', isOutgoing, { from: senderLink });\n        }\n\n        const user = selectPeer(global, userId);\n        const userTitle = (user && getPeerTitle(lang, user)) || userFallbackText;\n        const userLink = renderPeerLink(user?.id, userTitle, asPreview);\n        return translateWithYou(lang, 'ActionKickUser', isOutgoing, { from: senderLink, user: userLink });\n      }\n\n      case 'botAllowed': {\n        const {\n          app, domain, isAttachMenu, isFromRequest,\n        } = action;\n        if (isAttachMenu) return lang('ActionAttachMenuBotAllowed');\n        if (isFromRequest) return lang('ActionWebappBotAllowed');\n        if (app) {\n          const link = sender?.usernames?.length\n            && `${TME_LINK_PREFIX + sender.usernames[0].username}/${app.shortName}`;\n          const appLink = link\n            // eslint-disable-next-line react/jsx-no-bind\n            ? <Link onClick={() => openTelegramLink({ url: link })}>{app.title}</Link>\n            : lang('ActionBotAppPlaceholder');\n          return lang('ActionBotAllowedFromApp', { app: appLink }, { withNodes: true });\n        }\n\n        if (!domain) return lang(UNSUPPORTED_LANG_KEY);\n\n        const url = ensureProtocol(domain)!;\n        // eslint-disable-next-line react/jsx-no-bind\n        const link = <Link onClick={() => openUrl({ url })}>{domain}</Link>;\n        return lang('ActionBotAllowedFromDomain', { domain: link }, { withNodes: true });\n      }\n\n      case 'giveawayLaunch': {\n        const { stars } = action;\n\n        if (stars) {\n          return lang(\n            isChannel ? 'ActionGiveawayStarsStarted' : 'ActionGiveawayStarsStartedGroup',\n            { from: senderLink, amount: renderStrong(formatStarsAsText(lang, stars)) },\n            { withNodes: true },\n          );\n        }\n\n        return lang(\n          isChannel ? 'ActionGiveawayStarted' : 'ActionGiveawayStartedGroup',\n          { from: senderLink },\n          { withNodes: true },\n        );\n      }\n\n      case 'giveawayResults': {\n        const { winnersCount, isStars, unclaimedCount } = action;\n        if (!winnersCount) return lang('ActionGiveawayResultsNone');\n        if (unclaimedCount) {\n          return lang(isStars ? 'ActionGiveawayResultsStarsSome' : 'ActionGiveawayResultsSome');\n        }\n\n        return lang(\n          isStars ? 'ActionGiveawayResultsStars' : 'ActionGiveawayResults',\n          { count: winnersCount },\n          { pluralValue: winnersCount },\n        );\n      }\n\n      case 'giftStars':\n      case 'giftPremium': {\n        const {\n          amount, currency, cryptoAmount, cryptoCurrency,\n        } = action;\n\n        const price = formatCurrency(lang, amount, currency, { asFontIcon: true });\n        const cryptoPrice = cryptoAmount ? formatCurrency(lang, cryptoAmount, cryptoCurrency!) : undefined;\n\n        const cost = cryptoPrice ? lang('ActionCostCrypto', { price, cryptoPrice }, { withNodes: true }) : price;\n\n        if (isServiceNotificationsChat) {\n          return lang('ActionGiftTextCostAnonymous', { cost }, { withNodes: true });\n        }\n        return translateWithYou(\n          lang, 'ActionGiftTextCost', isOutgoing, { from: senderLink, cost: renderStrong(cost) },\n        );\n      }\n\n      case 'prizeStars':\n      case 'giftCode': {\n        return lang('ActionGiftTextUnknown');\n      }\n\n      case 'groupCall': {\n        const { duration } = action;\n        const durationText = duration ? formatShortDuration(lang, duration) : undefined;\n        if (durationText) {\n          if (isChannel) {\n            return lang('ActionGroupCallFinishedChannel', { duration: durationText });\n          }\n          return lang(\n            'ActionGroupCallFinishedGroup', { from: senderLink, duration: durationText }, { withNodes: true },\n          );\n        }\n\n        if (isChannel) return lang('ActionGroupCallStartedChannel');\n        return lang('ActionGroupCallStartedGroup', { from: senderLink }, { withNodes: true });\n      }\n\n      case 'groupCallScheduled': {\n        const { scheduleDate } = action;\n        const formattedDate = formatDateTimeToString(scheduleDate * 1000, lang.code, true);\n\n        if (isChannel) return lang('ActionGroupCallScheduledChannel', { date: formattedDate });\n        return lang('ActionGroupCallScheduledGroup', { from: senderLink, date: formattedDate }, { withNodes: true });\n      }\n\n      case 'inviteToGroupCall': {\n        const { userIds } = action;\n\n        if (userIds.length === 1) {\n          const user = selectPeer(global, userIds[0]);\n          const userTitle = (user && getPeerTitle(lang, user)) || userFallbackText;\n          const userLink = renderPeerLink(user?.id, userTitle, asPreview);\n          return translateWithYou(lang, 'ActionVideoInvited', isOutgoing, { from: senderLink, user: userLink });\n        }\n\n        const users = userIds.map((userId) => selectPeer(global, userId)).filter(Boolean);\n\n        if (!users.length) {\n          return translateWithYou(\n            lang, 'ActionVideoInvited', isOutgoing, { from: senderLink, user: userFallbackText },\n          );\n        }\n\n        const userLinks = users.map((user) => (\n          renderPeerLink(user.id, getPeerTitle(lang, user) || userFallbackText, asPreview)\n        ));\n\n        return translateWithYou(\n          lang, 'ActionVideoInvitedMany', isOutgoing, { from: senderLink, users: conjuctionWithNodes(lang, userLinks) },\n        );\n      }\n\n      case 'paymentSent': {\n        const {\n          currency, totalAmount, isRecurringInit, isRecurringUsed,\n        } = action;\n\n        const cost = renderStrong(formatCurrency(lang, totalAmount, currency, { asFontIcon: true }));\n        const invoice = replyMessage && getMessageInvoice(replyMessage);\n        const invoiceTitle = invoice?.title;\n\n        if (isRecurringUsed) {\n          return lang('ActionPaymentUsedRecurring', { amount: cost }, { withNodes: true });\n        }\n\n        if (!invoiceTitle) {\n          if (isRecurringInit) {\n            return lang('ActionPaymentInitRecurring', { amount: cost, user: chatLink }, { withNodes: true });\n          }\n\n          return lang('ActionPaymentDone', { amount: cost, user: chatLink }, { withNodes: true });\n        }\n\n        if (isRecurringInit) {\n          return lang(\n            'ActionPaymentInitRecurringFor',\n            { amount: cost, user: chatLink, invoice: renderMessageLink(replyMessage!, invoiceTitle, asPreview) },\n            { withNodes: true },\n          );\n        }\n\n        return lang(\n          'ActionPaymentDoneFor',\n          { amount: cost, user: chatLink, invoice: renderMessageLink(replyMessage!, invoiceTitle, asPreview) },\n          { withNodes: true },\n        );\n      }\n\n      case 'paymentRefunded': {\n        const { currency, totalAmount, peerId } = action;\n        const peer = selectPeer(global, peerId);\n        const peerTitle = (peer && getPeerTitle(lang, peer)) || userFallbackText;\n        const peerLink = renderPeerLink(peer?.id, peerTitle, asPreview);\n        const amount = formatCurrency(lang, totalAmount, currency, { asFontIcon: true });\n\n        return lang('ActionPaymentRefunded', { peer: peerLink, amount }, { withNodes: true });\n      }\n\n      case 'starGift': {\n        const {\n          gift, alreadyPaidUpgradeStars, peerId, savedId, fromId,\n        } = action;\n        const isToChannel = Boolean(peerId && savedId);\n\n        const fromPeer = fromId ? selectPeer(global, fromId) : sender;\n        const fromTitle = (fromPeer && getPeerTitle(lang, fromPeer)) || userFallbackText;\n        const fromLink = renderPeerLink(fromPeer?.id, fromTitle, asPreview);\n\n        const starsAmount = gift.stars + (alreadyPaidUpgradeStars || 0);\n        const cost = renderStrong(formatStarsAsText(lang, starsAmount));\n\n        if (isToChannel) {\n          const channelPeer = selectPeer(global, peerId!);\n          const isYou = fromPeer?.id === currentUserId;\n\n          const channelTitle = (channelPeer && getPeerTitle(lang, channelPeer)) || channelFallbackText;\n          const channelLink = renderPeerLink(peerId, channelTitle, asPreview);\n          return translateWithYou(\n            lang, 'ActionStarGiftSentChannel', isYou, { user: fromLink, channel: channelLink, cost },\n          );\n        }\n\n        if (isServiceNotificationsChat) {\n          return lang('ActionStarGiftReceivedAnonymous', { cost }, { withNodes: true });\n        }\n\n        if (isSavedMessages) {\n          return lang('ActionStarGiftSelfBought', { cost }, { withNodes: true });\n        }\n\n        if (isOutgoing) {\n          return lang('ActionStarGiftSent', { cost }, { withNodes: true });\n        }\n\n        return lang('ActionStarGiftReceived', { user: senderLink, cost }, { withNodes: true });\n      }\n\n      case 'starGiftUnique': {\n        const {\n          isTransferred, isUpgrade, savedId, peerId, fromId,\n        } = action;\n\n        const isToChannel = Boolean(peerId && savedId);\n\n        const fromPeer = fromId ? selectPeer(global, fromId) : sender;\n        const fromTitle = (fromPeer && getPeerTitle(lang, fromPeer)) || userFallbackText;\n        const fromLink = renderPeerLink(fromPeer?.id, fromTitle, asPreview);\n\n        if (isToChannel) {\n          const channelPeer = selectPeer(global, peerId!);\n          const isYou = fromPeer?.id === currentUserId;\n          const isAnonymous = fromPeer?.id === SERVICE_NOTIFICATIONS_USER_ID;\n\n          const channelTitle = (channelPeer && getPeerTitle(lang, channelPeer)) || channelFallbackText;\n          const channelLink = renderPeerLink(peerId, channelTitle, asPreview);\n\n          if (isUpgrade) {\n            return translateWithYou(\n              lang, 'ActionStarGiftUpgradedChannel', isYou, { user: fromLink, channel: channelLink },\n            );\n          }\n\n          if (isTransferred) {\n            if (isAnonymous) {\n              return lang('ActionStarGiftTransferredUnknownChannel', { channel: channelLink }, { withNodes: true });\n            }\n\n            return translateWithYou(\n              lang, 'ActionStarGiftTransferredChannel', isYou, { user: fromLink, channel: channelLink },\n            );\n          }\n        }\n\n        if (isSavedMessages) {\n          if (isUpgrade) return lang('ActionStarGiftUpgradedSelf');\n          if (isTransferred) return lang('ActionStarGiftTransferredSelf');\n        }\n\n        if (isUpgrade) {\n          if (isOutgoing) {\n            return lang('ActionStarGiftUpgradedMine', { user: chatLink }, { withNodes: true });\n          }\n\n          if (isSavedMessages) {\n            return lang('ActionStarGiftUpgradedSelf');\n          }\n\n          return lang('ActionStarGiftUpgradedUser', { user: senderLink }, { withNodes: true });\n        }\n\n        if (isTransferred) {\n          if (sender?.id === SERVICE_NOTIFICATIONS_USER_ID) {\n            return lang('ActionStarGiftTransferredUnknown');\n          }\n\n          if (isSavedMessages) {\n            return lang('ActionStarGiftTransferredSelf');\n          }\n\n          if (isOutgoing) {\n            return lang('ActionStarGiftTransferredMine', { user: chatLink }, { withNodes: true });\n          }\n\n          return lang('ActionStarGiftTransferred', { user: senderLink }, { withNodes: true });\n        }\n\n        if (isOutgoing) {\n          return lang('ActionGiftUniqueSent');\n        }\n\n        return lang('ActionGiftUniqueReceived', { user: senderLink }, { withNodes: true });\n      }\n\n      case 'suggestProfilePhoto': {\n        const actionPeer = (isOutgoing ? chat : sender)!;\n        const actionPeerLink = renderPeerLink(\n          actionPeer.id, getPeerTitle(lang, actionPeer) || userFallbackText, asPreview,\n        );\n\n        return translateWithYou(lang, 'ActionSuggestedPhoto', isOutgoing, { user: actionPeerLink });\n      }\n\n      case 'webViewDataSent':\n        return lang('ActionWebviewDataDone', { text: action.text });\n\n      case 'expired': {\n        const { isRoundVideo, isVoice } = action;\n        if (isVoice) return lang('ActionExpiredVoice');\n        if (isRoundVideo) return lang('ActionExpiredVideo');\n\n        return lang(UNSUPPORTED_LANG_KEY);\n      }\n\n      case 'historyClear':\n        return lang('ActionHistoryCleared');\n\n      case 'screenshotTaken':\n        return translateWithYou(lang, 'ActionScreenshotTaken', isOutgoing, { from: senderLink });\n\n      case 'contactSignUp':\n        return lang('ActionUserRegistered', { from: senderLink }, { withNodes: true });\n\n      case 'customAction':\n        return action.message;\n\n      case 'phoneCall': // Rendered as a regular message, but considered an action for the summary\n        return lang(getCallMessageKey(action, isOutgoing));\n      default:\n        return lang(UNSUPPORTED_LANG_KEY);\n    }\n  });\n\n  return renderActionText();\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { message }): StateProps => {\n    const chat = selectChat(global, message.chatId);\n    const sender = selectSender(global, message);\n\n    const { replyToMsgId, replyToPeerId } = getMessageReplyInfo(message) || {};\n    const replyMessage = replyToMsgId\n      ? selectChatMessage(global, replyToPeerId || message.chatId, replyToMsgId) : undefined;\n\n    return {\n      currentUserId: global.currentUserId,\n      replyMessage,\n      chat,\n      sender,\n    };\n  },\n)(ActionMessageText));\n","import type { TeactNode } from '../../../lib/teact/teact';\nimport React from '../../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../../global';\n\nimport type { ApiPeer } from '../../../api/types';\nimport { ApiMessageEntityTypes } from '../../../api/types';\n\nimport { selectUser } from '../../../global/selectors';\n\nimport useAppLayout from '../../../hooks/useAppLayout';\n\ntype OwnProps = {\n  userId?: string;\n  username?: string;\n  children: TeactNode;\n};\n\ntype StateProps = {\n  userOrChat?: ApiPeer;\n};\n\nconst MentionLink = ({\n  userId,\n  username,\n  userOrChat,\n  children,\n}: OwnProps & StateProps) => {\n  const {\n    openChat,\n    openChatByUsername,\n    closeStoryViewer,\n    setShouldCloseRightColumn,\n  } = getActions();\n\n  const { isMobile } = useAppLayout();\n\n  const handleClick = () => {\n    if (isMobile) {\n      setShouldCloseRightColumn({\n        value: true,\n      });\n    }\n\n    if (userOrChat) {\n      openChat({ id: userOrChat.id });\n    } else if (username) {\n      closeStoryViewer();\n      openChatByUsername({ username: username.substring(1) });\n    }\n  };\n\n  return (\n    <a\n      onClick={handleClick}\n      className=\"text-entity-link\"\n      dir=\"auto\"\n      data-entity-type={userId ? ApiMessageEntityTypes.MentionName : ApiMessageEntityTypes.Mention}\n    >\n      {children}\n    </a>\n  );\n};\n\nexport default withGlobal<OwnProps>(\n  (global, { userId }): StateProps => {\n    return {\n      userOrChat: userId ? selectUser(global, userId) : undefined,\n    };\n  },\n)(MentionLink);\n","import React, { type TeactNode } from '../../../../lib/teact/teact';\nimport { getActions } from '../../../../global';\n\nimport type { ApiMessage } from '../../../../api/types';\nimport type { ApiMessageActionPhoneCall } from '../../../../api/types/messageActions';\nimport type {\n  LangKey,\n  LangPairPluralWithVariables,\n  LangPairWithVariables,\n  PluralLangKeyWithVariables,\n  RegularLangKey,\n  RegularLangKeyWithVariables,\n} from '../../../../types/language';\nimport type { LangFn } from '../../../../util/localization';\n\nimport { getMessageContent } from '../../../../global/helpers';\nimport buildClassName from '../../../../util/buildClassName';\nimport { IS_SAFARI } from '../../../../util/windowEnvironment';\nimport renderText from '../../../common/helpers/renderText';\n\nimport Link from '../../../ui/Link';\n\nimport styles from '../ActionMessage.module.scss';\n\ntype SuffixKey<T, K extends keyof T> = `${K & string}You` extends keyof T ? T[`${K & string}You`] : never;\ntype VariablesForKey<K extends LangKey> =\n  K extends RegularLangKeyWithVariables\n    ? LangPairWithVariables<TeactNode | undefined>[K] | SuffixKey<LangPairWithVariables, K>\n    : K extends PluralLangKeyWithVariables\n      ? LangPairPluralWithVariables<TeactNode | undefined>[K] | SuffixKey<LangPairPluralWithVariables, K>\n      : undefined;\n\nexport function translateWithYou<K extends LangKey>(\n  lang: LangFn,\n  key: K,\n  isYou: boolean,\n  variables: VariablesForKey<K>,\n  options?: { pluralValue?: number; asText?: boolean; isMarkdown?: boolean },\n): TeactNode {\n  const { pluralValue, asText, isMarkdown } = options || {};\n  const translationKey = isYou ? (`${key}You` as LangKey) : key;\n\n  return lang(\n    // @ts-ignore -- I have no idea if this even possible to type correctly\n    translationKey,\n    variables,\n    { withNodes: !asText, isMarkdown, pluralValue },\n  );\n}\n\nexport function getPinnedMediaValue(lang: LangFn, message: ApiMessage) {\n  const {\n    audio, contact, document, game, giveaway, giveawayResults, paidMedia, storyData,\n    invoice, location, photo, pollId, sticker, video, voice,\n  } = getMessageContent(message);\n\n  if (message.groupedId || paidMedia) return lang('ActionPinnedMediaAlbum');\n  if (photo) return lang('ActionPinnedMediaPhoto');\n  if (audio) return lang('ActionPinnedMediaAudio');\n  if (voice) return lang('ActionPinnedMediaVoice');\n  if (video?.isRound) return lang('ActionPinnedMediaVideoMessage');\n  if (video?.isGif) return lang('ActionPinnedMediaGif');\n  if (video) return lang('ActionPinnedMediaVideo');\n  if (sticker) return lang('ActionPinnedMediaSticker');\n  if (document) return lang('ActionPinnedMediaFile');\n  if (contact) return lang('ActionPinnedMediaContact');\n  if (location) return lang('ActionPinnedMediaLocation');\n  if (storyData) return lang('ActionPinnedMediaStory');\n  if (invoice) return lang('ActionPinnedMediaInvoice');\n  if (game) return lang('ActionPinnedMediaGame', { game: game.title });\n  if (pollId) return lang('ActionPinnedMediaPoll');\n  if (giveaway) return lang('ActionPinnedMediaGiveaway');\n  if (giveawayResults) return lang('ActionPinnedMediaGiveawayResults');\n\n  return undefined;\n}\n\nexport function renderPeerLink(peerId: string | undefined, text: string, asPreview?: boolean) {\n  if (!peerId || asPreview) {\n    return renderText(text);\n  }\n\n  return (\n    <Link\n      className={buildClassName(styles.peerLink, styles.strong)}\n      // eslint-disable-next-line react/jsx-no-bind\n      onClick={(e) => {\n        e.stopPropagation();\n        getActions().openChat({ id: peerId });\n      }}\n      // box-decoration-break: clone; is broken when child has `dir` attribute\n      withMultilineFix={IS_SAFARI}\n    >\n      {renderText(text)}\n    </Link>\n  );\n}\n\nexport function renderMessageLink(targetMessage: ApiMessage, text: TeactNode, asPreview?: boolean) {\n  if (asPreview) return text;\n  return (\n    <Link\n      className={styles.messageLink}\n      // eslint-disable-next-line react/jsx-no-bind\n      onClick={(e) => {\n        e.stopPropagation();\n        getActions().focusMessage({ chatId: targetMessage.chatId, messageId: targetMessage.id });\n      }}\n      withMultilineFix={IS_SAFARI}\n    >\n      {text}\n    </Link>\n  );\n}\n\nexport function getCallMessageKey(action: ApiMessageActionPhoneCall, isOutgoing: boolean): RegularLangKey {\n  const isMissed = action.reason === 'missed';\n  const isCancelled = action.reason === 'busy' || action.duration === undefined;\n  if (action.isVideo) {\n    if (isMissed) return isOutgoing ? 'CallMessageVideoOutgoingMissed' : 'CallMessageVideoIncomingMissed';\n    if (isCancelled) return 'CallMessageVideoIncomingDeclined';\n\n    return isOutgoing ? 'CallMessageVideoOutgoing' : 'CallMessageVideoIncoming';\n  } else {\n    if (isMissed) return isOutgoing ? 'CallMessageOutgoingMissed' : 'CallMessageIncomingMissed';\n    if (isCancelled) return 'CallMessageIncomingDeclined';\n\n    return isOutgoing ? 'CallMessageOutgoing' : 'CallMessageIncoming';\n  }\n}\n","import type { MouseEvent as ReactMouseEvent, RefObject } from 'react';\nimport type { FC } from '../../lib/teact/teact';\nimport React, { useRef, useState } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\nimport buildStyle from '../../util/buildStyle';\nimport { IS_TOUCH_ENV, MouseButton } from '../../util/windowEnvironment';\n\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useOldLang from '../../hooks/useOldLang';\n\nimport Sparkles from '../common/Sparkles';\nimport RippleEffect from './RippleEffect';\nimport Spinner from './Spinner';\n\nimport './Button.scss';\n\nexport type OwnProps = {\n  ref?: RefObject<HTMLButtonElement | HTMLAnchorElement>;\n  type?: 'button' | 'submit' | 'reset';\n  children: React.ReactNode;\n  size?: 'default' | 'smaller' | 'tiny';\n  color?: (\n    'primary' | 'secondary' | 'gray' | 'danger' | 'translucent' | 'translucent-white' | 'translucent-black'\n    | 'translucent-bordered' | 'dark' | 'green' | 'adaptive' | 'stars'\n  );\n  backgroundImage?: string;\n  id?: string;\n  className?: string;\n  round?: boolean;\n  pill?: boolean;\n  badge?: boolean;\n  fluid?: boolean;\n  isText?: boolean;\n  isLoading?: boolean;\n  ariaLabel?: string;\n  ariaControls?: string;\n  hasPopup?: boolean;\n  href?: string;\n  download?: string;\n  disabled?: boolean;\n  nonInteractive?: boolean;\n  allowDisabledClick?: boolean;\n  noFastClick?: boolean;\n  ripple?: boolean;\n  faded?: boolean;\n  tabIndex?: number;\n  isRtl?: boolean;\n  isShiny?: boolean;\n  isRectangular?: boolean;\n  withPremiumGradient?: boolean;\n  withSparkleEffect?: boolean;\n  noPreventDefault?: boolean;\n  noForcedUpperCase?: boolean;\n  shouldStopPropagation?: boolean;\n  style?: string;\n  onClick?: (e: ReactMouseEvent<HTMLButtonElement, MouseEvent>) => void;\n  onContextMenu?: (e: ReactMouseEvent<HTMLButtonElement, MouseEvent>) => void;\n  onMouseDown?: (e: ReactMouseEvent<HTMLButtonElement>) => void;\n  onMouseUp?: (e: ReactMouseEvent<HTMLButtonElement>) => void;\n  onMouseEnter?: (e: ReactMouseEvent<HTMLButtonElement>) => void;\n  onMouseLeave?: NoneToVoidFunction;\n  onFocus?: NoneToVoidFunction;\n  onTransitionEnd?: NoneToVoidFunction;\n};\n\n// Longest animation duration;\nconst CLICKED_TIMEOUT = 400;\n\nconst Button: FC<OwnProps> = ({\n  ref,\n  type = 'button',\n  id,\n  onClick,\n  onContextMenu,\n  onMouseDown,\n  onMouseUp,\n  onMouseEnter,\n  onMouseLeave,\n  onFocus,\n  children,\n  size = 'default',\n  color = 'primary',\n  backgroundImage,\n  className,\n  round,\n  pill,\n  badge,\n  fluid,\n  isText,\n  isLoading,\n  isShiny,\n  withPremiumGradient,\n  withSparkleEffect,\n  onTransitionEnd,\n  ariaLabel,\n  ariaControls,\n  hasPopup,\n  href,\n  download,\n  disabled,\n  nonInteractive,\n  allowDisabledClick,\n  noFastClick = color === 'danger',\n  ripple,\n  faded,\n  tabIndex,\n  isRtl,\n  isRectangular,\n  noPreventDefault,\n  shouldStopPropagation,\n  noForcedUpperCase,\n  style,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  let elementRef = useRef<HTMLButtonElement | HTMLAnchorElement>(null);\n  if (ref) {\n    elementRef = ref;\n  }\n\n  const lang = useOldLang();\n\n  const [isClicked, setIsClicked] = useState(false);\n\n  const isNotInteractive = disabled || nonInteractive;\n\n  const fullClassName = buildClassName(\n    'Button',\n    className,\n    size,\n    color,\n    round && 'round',\n    pill && 'pill',\n    fluid && 'fluid',\n    badge && 'badge',\n    isNotInteractive && 'disabled',\n    nonInteractive && 'non-interactive',\n    allowDisabledClick && 'click-allowed',\n    isText && 'text',\n    isLoading && 'loading',\n    ripple && 'has-ripple',\n    faded && 'faded',\n    isClicked && 'clicked',\n    backgroundImage && 'with-image',\n    isShiny && 'shiny',\n    withPremiumGradient && 'premium',\n    isRectangular && 'rectangular',\n    noForcedUpperCase && 'no-upper-case',\n  );\n\n  const handleClick = useLastCallback((e: ReactMouseEvent<HTMLButtonElement, MouseEvent>) => {\n    if ((allowDisabledClick || !isNotInteractive) && onClick) {\n      onClick(e);\n    }\n\n    if (shouldStopPropagation) e.stopPropagation();\n\n    setIsClicked(true);\n    setTimeout(() => {\n      setIsClicked(false);\n    }, CLICKED_TIMEOUT);\n  });\n\n  const handleMouseDown = useLastCallback((e: ReactMouseEvent<HTMLButtonElement>) => {\n    if (!noPreventDefault) e.preventDefault();\n\n    if ((allowDisabledClick || !isNotInteractive) && onMouseDown) {\n      onMouseDown(e);\n    }\n\n    if (!IS_TOUCH_ENV && e.button === MouseButton.Main && !noFastClick) {\n      handleClick(e);\n    }\n  });\n\n  const content = (\n    <>\n      {withSparkleEffect && <Sparkles preset=\"button\" />}\n      {isLoading ? (\n        <div>\n          <span dir={isRtl ? 'auto' : undefined}>{lang('Cache.ClearProgress')}</span>\n          <Spinner color={isText ? 'blue' : 'white'} />\n        </div>\n      ) : children}\n      {!isNotInteractive && ripple && (\n        <RippleEffect />\n      )}\n    </>\n  );\n\n  if (href) {\n    return (\n      <a\n        ref={elementRef as RefObject<HTMLAnchorElement>}\n        id={id}\n        className={fullClassName}\n        href={href}\n        title={ariaLabel}\n        download={download}\n        tabIndex={tabIndex}\n        dir={isRtl ? 'rtl' : undefined}\n        aria-label={ariaLabel}\n        aria-controls={ariaControls}\n        style={style}\n        onTransitionEnd={onTransitionEnd}\n        target=\"_blank\"\n        rel=\"noreferrer\"\n      >\n        {content}\n      </a>\n    );\n  }\n\n  return (\n    <button\n      ref={elementRef as RefObject<HTMLButtonElement>}\n      id={id}\n      type={type}\n      className={fullClassName}\n      onClick={IS_TOUCH_ENV || noFastClick ? handleClick : undefined}\n      onContextMenu={onContextMenu}\n      onMouseDown={handleMouseDown}\n      onMouseUp={onMouseUp}\n      onMouseEnter={onMouseEnter && !isNotInteractive ? onMouseEnter : undefined}\n      onMouseLeave={onMouseLeave && !isNotInteractive ? onMouseLeave : undefined}\n      onTransitionEnd={onTransitionEnd}\n      onFocus={onFocus && !isNotInteractive ? onFocus : undefined}\n      aria-label={ariaLabel}\n      aria-controls={ariaControls}\n      aria-haspopup={hasPopup}\n      title={ariaLabel}\n      tabIndex={tabIndex}\n      dir={isRtl ? 'rtl' : undefined}\n      style={buildStyle(style, backgroundImage && `background-image: url(${backgroundImage})`) || undefined}\n    >\n      {content}\n    </button>\n  );\n};\n\nexport default Button;\n","import type { ChangeEvent } from 'react';\nimport type { FC, TeactNode } from '../../lib/teact/teact';\nimport React, {\n  memo,\n  useRef,\n  useState,\n} from '../../lib/teact/teact';\n\nimport type { IconName } from '../../types/icons';\nimport type { IRadioOption } from './CheckboxGroup';\n\nimport buildClassName from '../../util/buildClassName';\nimport renderText from '../common/helpers/renderText';\n\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useOldLang from '../../hooks/useOldLang';\n\nimport Icon from '../common/icons/Icon';\nimport Button from './Button';\nimport Spinner from './Spinner';\n\nimport './Checkbox.scss';\n\ntype OwnProps = {\n  id?: string;\n  name?: string;\n  value?: string;\n  label?: TeactNode;\n  labelText?: TeactNode;\n  subLabel?: string;\n  checked?: boolean;\n  rightIcon?: IconName;\n  disabled?: boolean;\n  tabIndex?: number;\n  withIcon?: boolean;\n  blocking?: boolean;\n  permissionGroup?: boolean;\n  isLoading?: boolean;\n  withCheckedCallback?: boolean;\n  onlyInput?: boolean;\n  isRound?: boolean;\n  className?: string;\n  onChange?: (e: ChangeEvent<HTMLInputElement>, nestedOptionList?: IRadioOption) => void;\n  onCheck?: (isChecked: boolean) => void;\n  onClickLabel?: (e: React.MouseEvent, value?: string) => void;\n  nestedCheckbox?: boolean;\n  nestedCheckboxCount?: number | undefined;\n  nestedOptionList?: IRadioOption;\n  leftElement?: TeactNode;\n  values?: string[];\n};\n\nconst Checkbox: FC<OwnProps> = ({\n  id,\n  name,\n  value,\n  label,\n  labelText,\n  subLabel,\n  checked,\n  tabIndex,\n  disabled,\n  withIcon,\n  blocking,\n  permissionGroup,\n  isLoading,\n  className,\n  rightIcon,\n  onlyInput,\n  isRound,\n  nestedCheckbox,\n  nestedCheckboxCount,\n  nestedOptionList,\n  leftElement,\n  values = [],\n  onChange,\n  onCheck,\n  onClickLabel,\n}) => {\n  const lang = useOldLang();\n  // eslint-disable-next-line no-null/no-null\n  const labelRef = useRef<HTMLLabelElement>(null);\n  const [showNested, setShowNested] = useState(false);\n\n  const handleChange = useLastCallback((event: ChangeEvent<HTMLInputElement>) => {\n    if (disabled) {\n      return;\n    }\n\n    if (onChange) {\n      onChange(event, nestedOptionList);\n    }\n\n    if (onCheck) {\n      onCheck(event.currentTarget.checked);\n    }\n  });\n\n  const toggleNested = useLastCallback(() => {\n    setShowNested(!showNested);\n  });\n\n  function handleClick(event: React.MouseEvent) {\n    if (event.target !== labelRef.current) {\n      onClickLabel?.(event, value);\n    }\n  }\n\n  function handleInputClick(event: React.MouseEvent) {\n    event.stopPropagation();\n  }\n\n  const labelClassName = buildClassName(\n    'Checkbox',\n    disabled && 'disabled',\n    withIcon && 'withIcon',\n    isLoading && 'loading',\n    blocking && 'blocking',\n    nestedCheckbox && 'nested',\n    subLabel && 'withSubLabel',\n    permissionGroup && 'permission-group',\n    Boolean(leftElement) && 'avatar',\n    onlyInput && 'onlyInput',\n    isRound && 'round',\n    Boolean(rightIcon) && 'withNestedList',\n    className,\n  );\n\n  return (\n    <>\n      {/* eslint-disable-next-line jsx-a11y/no-noninteractive-element-interactions */}\n      <label\n        className={labelClassName}\n        dir={lang.isRtl ? 'rtl' : undefined}\n        onClick={onClickLabel ? handleClick : undefined}\n        ref={labelRef}\n      >\n        <input\n          type=\"checkbox\"\n          id={id}\n          name={name}\n          value={value}\n          checked={checked}\n          disabled={disabled}\n          tabIndex={tabIndex}\n          onChange={handleChange}\n          onClick={onClickLabel ? handleInputClick : undefined}\n        />\n        <div className={buildClassName(\n          'Checkbox-main',\n          Boolean(leftElement) && 'Nested-avatar-list',\n        )}\n        >\n          <span className=\"label\" dir=\"auto\">\n            {leftElement}\n            {typeof label === 'string' ? renderText(label) : label}\n            {labelText && <span className=\"ml-1\">{renderText(labelText)}</span>}\n          </span>\n          {subLabel && <span className=\"subLabel\" dir=\"auto\">{renderText(subLabel)}</span>}\n          {rightIcon && <Icon name={rightIcon} className=\"right-icon\" />}\n        </div>\n        {nestedCheckbox && (\n          <span className=\"nestedButton\" dir=\"auto\">\n            <Button className=\"button\" color=\"translucent\" size=\"smaller\" onClick={toggleNested}>\n              <Icon name=\"group-filled\" className=\"group-icon\" />\n              {nestedCheckboxCount}\n              <Icon name={showNested ? 'up' : 'down'} />\n            </Button>\n          </span>\n        )}\n        {isLoading && <Spinner />}\n      </label>\n      {nestedCheckbox && (\n        <div\n          className={buildClassName('nested-checkbox-group', showNested && 'nested-checkbox-group-open')}\n        >\n          {nestedOptionList?.nestedOptions?.map((nestedOption) => (\n            <Checkbox\n              key={nestedOption.value}\n              leftElement={leftElement}\n              onChange={handleChange}\n              checked={values.indexOf(nestedOption.value) !== -1}\n              values={values}\n              /* eslint-disable-next-line react/jsx-props-no-spreading */\n              {...nestedOption}\n            />\n          ))}\n        </div>\n      )}\n    </>\n  );\n};\n\nexport default memo(Checkbox);\n","import type { FC } from '../../lib/teact/teact';\nimport React, {\n  useCallback, useMemo, useRef, useState,\n} from '../../lib/teact/teact';\n\nimport Icon from '../common/icons/Icon';\nimport Button from './Button';\nimport Menu from './Menu';\n\nimport './DropdownMenu.scss';\n\ntype OwnProps = {\n  className?: string;\n  bubbleClassName?: string;\n  trigger?: FC<{ onTrigger: () => void; isOpen?: boolean }>;\n  transformOriginX?: number;\n  transformOriginY?: number;\n  positionX?: 'left' | 'right';\n  positionY?: 'top' | 'bottom';\n  footer?: string;\n  forceOpen?: boolean;\n  onOpen?: NoneToVoidFunction;\n  onClose?: NoneToVoidFunction;\n  onHide?: NoneToVoidFunction;\n  onTransitionEnd?: NoneToVoidFunction;\n  onMouseEnterBackdrop?: (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => void;\n  children: React.ReactNode;\n  autoClose?: boolean;\n};\n\nconst DropdownMenu: FC<OwnProps> = ({\n  trigger,\n  className,\n  bubbleClassName,\n  children,\n  transformOriginX,\n  transformOriginY,\n  positionX = 'left',\n  positionY = 'top',\n  footer,\n  forceOpen,\n  onOpen,\n  onClose,\n  onTransitionEnd,\n  onMouseEnterBackdrop,\n  onHide,\n  autoClose = true,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const menuRef = useRef<HTMLDivElement>(null);\n  const [isOpen, setIsOpen] = useState(false);\n\n  const toggleIsOpen = () => {\n    setIsOpen(!isOpen);\n\n    if (isOpen) {\n      onClose?.();\n    } else {\n      onOpen?.();\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent<any>) => {\n    const menu = menuRef.current;\n\n    if (!isOpen || e.keyCode !== 40 || !menu) {\n      return;\n    }\n\n    const focusedElement = document.activeElement;\n    const elementChildren = Array.from(menu.children);\n\n    if (!focusedElement || elementChildren.indexOf(focusedElement) === -1) {\n      (elementChildren[0] as HTMLElement).focus();\n    }\n  };\n\n  const handleClose = useCallback(() => {\n    setIsOpen(false);\n    onClose?.();\n  }, [onClose]);\n\n  const triggerComponent: FC<{ onTrigger: () => void; isOpen?: boolean }> = useMemo(() => {\n    if (trigger) return trigger;\n\n    return ({ onTrigger, isOpen: isMenuOpen }) => (\n      <Button\n        round\n        size=\"smaller\"\n        color=\"translucent\"\n        className={isMenuOpen ? 'active' : ''}\n        onClick={onTrigger}\n        ariaLabel=\"More actions\"\n      >\n        <Icon name=\"more\" />\n      </Button>\n    );\n  }, [trigger]);\n\n  return (\n    <div\n      className={`DropdownMenu ${className || ''}`}\n      onKeyDown={handleKeyDown}\n      onTransitionEnd={onTransitionEnd}\n    >\n      {triggerComponent({ onTrigger: toggleIsOpen, isOpen })}\n\n      <Menu\n        ref={menuRef}\n        isOpen={isOpen || Boolean(forceOpen)}\n        className={className || ''}\n        bubbleClassName={bubbleClassName || ''}\n        transformOriginX={transformOriginX}\n        transformOriginY={transformOriginY}\n        positionX={positionX}\n        positionY={positionY}\n        footer={footer}\n        autoClose={autoClose}\n        onClose={handleClose}\n        onCloseAnimationEnd={onHide}\n        onMouseEnterBackdrop={onMouseEnterBackdrop}\n      >\n        {children}\n      </Menu>\n    </div>\n  );\n};\n\nexport default DropdownMenu;\n","import type {\n  ChangeEvent, FormEvent, RefObject,\n} from 'react';\nimport type { FC } from '../../lib/teact/teact';\nimport React, { memo } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport useOldLang from '../../hooks/useOldLang';\n\ntype OwnProps = {\n  ref?: RefObject<HTMLInputElement>;\n  id?: string;\n  className?: string;\n  value?: string;\n  label?: string;\n  error?: string;\n  success?: string;\n  disabled?: boolean;\n  readOnly?: boolean;\n  placeholder?: string;\n  autoComplete?: string;\n  maxLength?: number;\n  tabIndex?: number;\n  teactExperimentControlled?: boolean;\n  inputMode?: 'text' | 'none' | 'tel' | 'url' | 'email' | 'numeric' | 'decimal' | 'search';\n  onChange?: (e: ChangeEvent<HTMLInputElement>) => void;\n  onInput?: (e: FormEvent<HTMLInputElement>) => void;\n  onKeyPress?: (e: React.KeyboardEvent<HTMLInputElement>) => void;\n  onKeyDown?: (e: React.KeyboardEvent<HTMLInputElement>) => void;\n  onBlur?: (e: React.FocusEvent<HTMLInputElement>) => void;\n  onPaste?: (e: React.ClipboardEvent<HTMLInputElement>) => void;\n};\n\nconst InputText: FC<OwnProps> = ({\n  ref,\n  id,\n  className,\n  value,\n  label,\n  error,\n  success,\n  disabled,\n  readOnly,\n  placeholder,\n  autoComplete,\n  inputMode,\n  maxLength,\n  tabIndex,\n  teactExperimentControlled,\n  onChange,\n  onInput,\n  onKeyPress,\n  onKeyDown,\n  onBlur,\n  onPaste,\n}) => {\n  const lang = useOldLang();\n  const labelText = error || success || label;\n  const fullClassName = buildClassName(\n    'input-group',\n    value && 'touched',\n    error ? 'error' : success && 'success',\n    disabled && 'disabled',\n    readOnly && 'disabled',\n    labelText && 'with-label',\n    className,\n  );\n\n  return (\n    <div className={fullClassName} dir={lang.isRtl ? 'rtl' : undefined}>\n      <input\n        ref={ref}\n        className=\"form-control\"\n        type=\"text\"\n        id={id}\n        dir=\"auto\"\n        value={value || ''}\n        tabIndex={tabIndex}\n        placeholder={placeholder}\n        maxLength={maxLength}\n        autoComplete={autoComplete}\n        inputMode={inputMode}\n        disabled={disabled}\n        readOnly={readOnly}\n        onChange={onChange}\n        onInput={onInput}\n        onKeyPress={onKeyPress}\n        onKeyDown={onKeyDown}\n        onBlur={onBlur}\n        onPaste={onPaste}\n        aria-label={labelText}\n        teactExperimentControlled={teactExperimentControlled}\n      />\n      {labelText && (\n        <label htmlFor={id}>{labelText}</label>\n      )}\n    </div>\n  );\n};\n\nexport default memo(InputText);\n","// extracted by mini-css-extract-plugin\nexport default {\"link\":\"swBnOk1h\",\"isPrimary\":\"Jz1SC8nz\"};","import type { FC } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport useLastCallback from '../../hooks/useLastCallback';\n\nimport styles from './Link.module.scss';\n\ntype OwnProps = {\n  children: React.ReactNode;\n  className?: string;\n  isRtl?: boolean;\n  isPrimary?: boolean;\n  withMultilineFix?: boolean;\n  onClick?: (e: React.MouseEvent<HTMLAnchorElement>) => void;\n};\n\nconst Link: FC<OwnProps> = ({\n  children, isPrimary, className, isRtl, withMultilineFix, onClick,\n}) => {\n  const handleClick = useLastCallback((e: React.MouseEvent<HTMLAnchorElement>) => {\n    e.preventDefault();\n    onClick!(e);\n  });\n\n  return (\n    <a\n      href=\"#\"\n      className={buildClassName('Link', styles.link, className, isPrimary && styles.isPrimary)}\n      dir={!withMultilineFix ? (isRtl ? 'rtl' : 'auto') : undefined}\n      onClick={onClick ? handleClick : undefined}\n    >\n      {children}\n    </a>\n  );\n};\n\nexport default Link;\n","import React, { memo } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport Spinner from './Spinner';\n\nimport './Loading.scss';\n\ntype OwnProps = {\n  color?: 'blue' | 'white' | 'black' | 'yellow';\n  backgroundColor?: 'light' | 'dark';\n  className?: string;\n  onClick?: NoneToVoidFunction;\n};\n\nconst Loading = ({\n  color = 'blue', backgroundColor, className, onClick,\n}: OwnProps) => {\n  return (\n    <div className={buildClassName('Loading', onClick && 'interactive', className)} onClick={onClick}>\n      <Spinner color={color} backgroundColor={backgroundColor} />\n    </div>\n  );\n};\n\nexport default memo(Loading);\n","import type React from '../lib/teact/teact';\nimport { useLayoutEffect } from '../lib/teact/teact';\nimport { addExtraClass, setExtraStyles } from '../lib/teact/teact-dom';\n\nimport type { IAnchorPosition } from '../types';\n\nimport { requestForcedReflow } from '../lib/fasterdom/fasterdom';\nimport { useStateRef } from './useStateRef';\n\ninterface StaticPositionOptions {\n  anchor?: IAnchorPosition;\n  positionX?: 'left' | 'right';\n  positionY?: 'top' | 'bottom';\n  transformOriginX?: number;\n  transformOriginY?: number;\n  style?: string;\n  bubbleStyle?: string;\n}\n\ninterface DynamicPositionOptions {\n  anchor: IAnchorPosition;\n  getTriggerElement: () => HTMLElement | null;\n  getRootElement: () => HTMLElement | null;\n  getMenuElement: () => HTMLElement | null;\n  getLayout?: () => Layout;\n  withMaxHeight?: boolean;\n}\n\nexport type MenuPositionOptions =\n  StaticPositionOptions\n  | DynamicPositionOptions;\n\nexport interface Layout {\n  extraPaddingX?: number;\n  extraTopPadding?: number;\n  extraMarginTop?: number;\n  menuElMinWidth?: number;\n  deltaX?: number;\n  topShiftY?: number;\n  shouldAvoidNegativePosition?: boolean;\n  withPortal?: boolean;\n  isDense?: boolean; //  Allows you to place the menu as close to the edges of the area as possible\n}\n\nconst MENU_POSITION_VISUAL_COMFORT_SPACE_PX = 16;\nconst MENU_POSITION_BOTTOM_MARGIN = 12;\nconst EMPTY_RECT = {\n  width: 0, left: 0, height: 0, top: 0,\n};\n\nexport default function useMenuPosition(\n  isOpen: boolean,\n  containerRef: React.RefObject<HTMLDivElement>,\n  bubbleRef: React.RefObject<HTMLDivElement>,\n  options: MenuPositionOptions,\n) {\n  const optionsRef = useStateRef(options);\n\n  useLayoutEffect(() => {\n    if (!isOpen) return;\n\n    const options2 = optionsRef.current;\n\n    if (!('getTriggerElement' in options2)) {\n      applyStaticOptions(containerRef, bubbleRef, options2);\n    } else {\n      requestForcedReflow(() => {\n        const staticOptions = processDynamically(containerRef, bubbleRef, options2);\n\n        return () => {\n          applyStaticOptions(containerRef, bubbleRef, staticOptions);\n        };\n      });\n    }\n  }, [isOpen, containerRef, bubbleRef, optionsRef]);\n}\n\nfunction applyStaticOptions(\n  containerRef: React.RefObject<HTMLDivElement>,\n  bubbleRef: React.RefObject<HTMLDivElement>,\n  {\n    positionX = 'left',\n    positionY = 'top',\n    transformOriginX,\n    transformOriginY,\n    style,\n    bubbleStyle,\n  }: StaticPositionOptions,\n) {\n  const containerEl = containerRef.current!;\n  const bubbleEl = bubbleRef.current!;\n\n  if (style) {\n    containerEl.style.cssText = style;\n  }\n\n  if (bubbleStyle) {\n    bubbleEl.style.cssText = bubbleStyle;\n  }\n\n  if (positionX) {\n    addExtraClass(bubbleEl, positionX);\n  }\n\n  if (positionY) {\n    addExtraClass(bubbleEl, positionY);\n  }\n\n  setExtraStyles(bubbleEl, {\n    transformOrigin: [\n      transformOriginX ? `${transformOriginX}px` : positionX,\n      transformOriginY ? `${transformOriginY}px` : positionY,\n    ].join(' '),\n  });\n}\n\nfunction processDynamically(\n  containerRef: React.RefObject<HTMLDivElement>,\n  bubbleRef: React.RefObject<HTMLDivElement>,\n  {\n    anchor,\n    getRootElement,\n    getMenuElement,\n    getTriggerElement,\n    getLayout,\n    withMaxHeight,\n  }: DynamicPositionOptions,\n) {\n  const triggerEl = getTriggerElement()!;\n\n  let { x, y } = anchor;\n  const anchorX = x;\n  const anchorY = y;\n\n  const menuEl = getMenuElement();\n  const rootEl = getRootElement();\n\n  const {\n    extraPaddingX = 0,\n    extraTopPadding = 0,\n    extraMarginTop = 0,\n    topShiftY = 0,\n    menuElMinWidth = 0,\n    deltaX = 0,\n    shouldAvoidNegativePosition = false,\n    withPortal = false,\n    isDense = false,\n  } = getLayout?.() || {};\n\n  const marginTop = menuEl ? parseInt(getComputedStyle(menuEl).marginTop, 10) + extraMarginTop : undefined;\n  const { offsetWidth: menuElWidth, offsetHeight: menuElHeight } = menuEl || { offsetWidth: 0, offsetHeight: 0 };\n  const menuRect = menuEl ? {\n    width: Math.max(menuElWidth, menuElMinWidth),\n    height: menuElHeight + marginTop!,\n  } : EMPTY_RECT;\n\n  const rootRect = rootEl ? rootEl.getBoundingClientRect() : EMPTY_RECT;\n\n  let positionX: 'left' | 'right';\n  let positionY: 'top' | 'bottom';\n  if (isDense || (x + menuRect.width + extraPaddingX < rootRect.width + rootRect.left)) {\n    x += 3;\n    positionX = 'left';\n  } else if (x - menuRect.width - rootRect.left > 0) {\n    positionX = 'right';\n    x -= 3;\n  } else {\n    positionX = 'left';\n    x = 16;\n  }\n\n  x += deltaX;\n\n  const yWithTopShift = y + topShiftY;\n\n  if (isDense || (yWithTopShift + menuRect.height < rootRect.height + rootRect.top)) {\n    positionY = 'top';\n    y = yWithTopShift;\n  } else {\n    positionY = 'bottom';\n\n    if (y - menuRect.height < rootRect.top + extraTopPadding) {\n      y = rootRect.top + rootRect.height;\n    }\n  }\n\n  const triggerRect = triggerEl.getBoundingClientRect();\n\n  const addedYForPortalPositioning = (withPortal ? triggerRect.top : 0);\n  const addedXForPortalPositioning = (withPortal ? triggerRect.left : 0);\n\n  const leftWithPossibleNegative = Math.min(\n    x - triggerRect.left,\n    rootRect.width - menuRect.width - MENU_POSITION_VISUAL_COMFORT_SPACE_PX,\n  );\n  let left = (positionX === 'left'\n    ? (withPortal || shouldAvoidNegativePosition\n      ? Math.max(MENU_POSITION_VISUAL_COMFORT_SPACE_PX, leftWithPossibleNegative)\n      : leftWithPossibleNegative)\n    : (x - triggerRect.left)) + addedXForPortalPositioning;\n  let top = y - triggerRect.top + addedYForPortalPositioning;\n\n  if (isDense) {\n    left = Math.min(left, rootRect.width - menuRect.width - MENU_POSITION_VISUAL_COMFORT_SPACE_PX);\n    top = Math.min(top, rootRect.height - menuRect.height - MENU_POSITION_VISUAL_COMFORT_SPACE_PX);\n  }\n\n  // Avoid hiding external parts of menus on mobile devices behind the edges of the screen (ReactionSelector for example)\n  const addedXForMenuPositioning = menuElMinWidth ? Math.max(0, (menuElMinWidth - menuElWidth) / 2) : 0;\n  if (left - addedXForMenuPositioning < 0 && shouldAvoidNegativePosition) {\n    left = addedXForMenuPositioning + MENU_POSITION_VISUAL_COMFORT_SPACE_PX;\n  }\n\n  const offsetX = (anchorX + addedXForPortalPositioning - triggerRect.left) - left;\n  const offsetY = (anchorY + addedYForPortalPositioning - triggerRect.top) - top - (marginTop || 0);\n  const transformOriginX = positionX === 'left' ? offsetX : menuRect.width + offsetX;\n  const transformOriginY = positionY === 'bottom' ? menuRect.height + offsetY : offsetY;\n\n  const style = `left: ${left}px; top: ${top}px`;\n\n  let bubbleStyle;\n  if (withMaxHeight) {\n    const menuMaxHeight = rootRect.height - MENU_POSITION_BOTTOM_MARGIN - (marginTop || 0);\n    bubbleStyle = `max-height: ${menuMaxHeight}px;`;\n  }\n\n  return {\n    positionX,\n    positionY,\n    transformOriginX,\n    transformOriginY,\n    style,\n    bubbleStyle,\n  };\n}\n","import React, {\n  beginHeavyAnimation,\n  type FC, memo, useEffect, useRef,\n} from '../../lib/teact/teact';\n\nimport type { MenuPositionOptions } from '../../hooks/useMenuPosition';\n\nimport buildClassName from '../../util/buildClassName';\nimport captureEscKeyListener from '../../util/captureEscKeyListener';\nimport { IS_BACKDROP_BLUR_SUPPORTED } from '../../util/windowEnvironment';\nimport { preventMessageInputBlurWithBubbling } from '../middle/helpers/preventMessageInputBlur';\n\nimport useAppLayout from '../../hooks/useAppLayout';\nimport useEffectWithPrevDeps from '../../hooks/useEffectWithPrevDeps';\nimport useHistoryBack from '../../hooks/useHistoryBack';\nimport useKeyboardListNavigation from '../../hooks/useKeyboardListNavigation';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useMenuPosition from '../../hooks/useMenuPosition';\nimport useShowTransition from '../../hooks/useShowTransition';\nimport useVirtualBackdrop from '../../hooks/useVirtualBackdrop';\n\nimport Portal from './Portal';\n\nimport './Menu.scss';\n\nexport type { MenuPositionOptions } from '../../hooks/useMenuPosition';\n\ntype OwnProps =\n  {\n    ref?: React.RefObject<HTMLDivElement>;\n    isOpen: boolean;\n    shouldCloseFast?: boolean;\n    id?: string;\n    className?: string;\n    bubbleClassName?: string;\n    ariaLabelledBy?: string;\n    autoClose?: boolean;\n    footer?: string;\n    noCloseOnBackdrop?: boolean;\n    backdropExcludedSelector?: string;\n    noCompact?: boolean;\n    onKeyDown?: (e: React.KeyboardEvent<any>) => void;\n    onCloseAnimationEnd?: () => void;\n    onClose: () => void;\n    onMouseEnter?: (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => void;\n    onMouseEnterBackdrop?: (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => void;\n    onMouseLeave?: (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => void;\n    withPortal?: boolean;\n    children?: React.ReactNode;\n  }\n  & MenuPositionOptions;\n\nconst ANIMATION_DURATION = 200;\n\nconst Menu: FC<OwnProps> = ({\n  ref: externalRef,\n  shouldCloseFast,\n  isOpen,\n  id,\n  className,\n  bubbleClassName,\n  ariaLabelledBy,\n  children,\n  autoClose = false,\n  footer,\n  noCloseOnBackdrop = false,\n  backdropExcludedSelector,\n  noCompact,\n  onCloseAnimationEnd,\n  onClose,\n  onMouseEnter,\n  onMouseLeave,\n  withPortal,\n  onMouseEnterBackdrop,\n  ...positionOptions\n}) => {\n  const { isTouchScreen } = useAppLayout();\n\n  // eslint-disable-next-line no-null/no-null\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const { ref: bubbleRef } = useShowTransition({\n    isOpen,\n    ref: externalRef,\n    onCloseAnimationEnd,\n  });\n\n  useMenuPosition(isOpen, containerRef, bubbleRef, positionOptions);\n\n  useEffect(\n    () => (isOpen ? captureEscKeyListener(onClose) : undefined),\n    [isOpen, onClose],\n  );\n\n  useHistoryBack({\n    isActive: isOpen,\n    onBack: onClose,\n    shouldBeReplaced: true,\n  });\n\n  useEffectWithPrevDeps(([prevIsOpen]) => {\n    if (isOpen || (!isOpen && prevIsOpen === true)) {\n      beginHeavyAnimation(ANIMATION_DURATION);\n    }\n  }, [isOpen]);\n\n  const handleKeyDown = useKeyboardListNavigation(bubbleRef, isOpen, autoClose ? onClose : undefined, undefined, true);\n\n  useVirtualBackdrop(\n    isOpen,\n    containerRef,\n    noCloseOnBackdrop ? undefined : onClose,\n    undefined,\n    backdropExcludedSelector,\n  );\n\n  const bubbleFullClassName = buildClassName(\n    'bubble menu-container custom-scroll',\n    footer && 'with-footer',\n    bubbleClassName,\n    shouldCloseFast && 'close-fast',\n  );\n\n  const handleClick = useLastCallback((e: React.MouseEvent<HTMLDivElement>) => {\n    e.stopPropagation();\n    if (autoClose) {\n      onClose();\n    }\n  });\n\n  const menu = (\n    <div\n      ref={containerRef}\n      id={id}\n      className={buildClassName(\n        'Menu',\n        !noCompact && !isTouchScreen && 'compact',\n        !IS_BACKDROP_BLUR_SUPPORTED && 'no-blur',\n        withPortal && 'in-portal',\n        className,\n      )}\n      aria-labelledby={ariaLabelledBy}\n      role={ariaLabelledBy ? 'menu' : undefined}\n      onKeyDown={isOpen ? handleKeyDown : undefined}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={isOpen ? onMouseLeave : undefined}\n    >\n      {isOpen && (\n        // This only prevents click events triggering on underlying elements\n        <div\n          className=\"backdrop\"\n          onMouseDown={preventMessageInputBlurWithBubbling}\n          onMouseEnter={onMouseEnterBackdrop}\n        />\n      )}\n      <div\n        role=\"presentation\"\n        ref={bubbleRef}\n        className={bubbleFullClassName}\n        onClick={handleClick}\n      >\n        {children}\n        {footer && <div className=\"footer\">{footer}</div>}\n      </div>\n    </div>\n  );\n\n  if (withPortal) {\n    return <Portal>{menu}</Portal>;\n  }\n\n  return menu;\n};\n\nexport default memo(Menu);\n","import type { FC } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\n\nimport type { IconName } from '../../types/icons';\n\nimport { IS_TEST } from '../../config';\nimport buildClassName from '../../util/buildClassName';\n\nimport useAppLayout from '../../hooks/useAppLayout';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useOldLang from '../../hooks/useOldLang';\n\nimport Icon from '../common/icons/Icon';\n\nimport './MenuItem.scss';\n\nexport type MenuItemProps = {\n  customIcon?: React.ReactNode;\n  className?: string;\n  children: React.ReactNode;\n  onClick?: (e: React.SyntheticEvent<HTMLDivElement | HTMLAnchorElement>, arg?: number) => void;\n  clickArg?: number;\n  onContextMenu?: (e: React.UIEvent) => void;\n  href?: string;\n  download?: string;\n  disabled?: boolean;\n  destructive?: boolean;\n  ariaLabel?: string;\n  withWrap?: boolean;\n  withPreventDefaultOnMouseDown?: boolean;\n} & ({\n  icon: 'A' | 'K';\n  isCharIcon: true;\n} | {\n  icon?: IconName;\n  isCharIcon?: false;\n});\n\nconst MenuItem: FC<MenuItemProps> = (props) => {\n  const {\n    icon,\n    isCharIcon,\n    customIcon,\n    className,\n    children,\n    onClick,\n    href,\n    download,\n    disabled,\n    destructive,\n    ariaLabel,\n    withWrap,\n    onContextMenu,\n    clickArg,\n    withPreventDefaultOnMouseDown,\n  } = props;\n\n  const lang = useOldLang();\n  const { isTouchScreen } = useAppLayout();\n  const handleClick = useLastCallback((e: React.MouseEvent<HTMLDivElement>) => {\n    if (disabled || !onClick) {\n      e.preventDefault();\n      return;\n    }\n    onClick(e, clickArg);\n  });\n\n  const handleKeyDown = useLastCallback((e: React.KeyboardEvent<HTMLDivElement>) => {\n    if (e.keyCode !== 13 && e.keyCode !== 32) {\n      return;\n    }\n\n    if (disabled || !onClick) {\n      e.preventDefault();\n\n      return;\n    }\n    onClick(e, clickArg);\n  });\n  const handleMouseDown = useLastCallback((e: React.SyntheticEvent<HTMLDivElement | HTMLAnchorElement>) => {\n    if (withPreventDefaultOnMouseDown) {\n      e.preventDefault();\n    }\n  });\n\n  const fullClassName = buildClassName(\n    'MenuItem',\n    className,\n    disabled && 'disabled',\n    destructive && 'destructive',\n    !isTouchScreen && 'compact',\n    withWrap && 'wrap',\n  );\n\n  const content = (\n    <>\n      {!customIcon && icon && (\n        <Icon name={isCharIcon ? 'char' : icon} character={isCharIcon ? icon : undefined} />\n      )}\n      {customIcon}\n      {children}\n    </>\n  );\n\n  if (href) {\n    return (\n      <a\n        tabIndex={0}\n        className={fullClassName}\n        href={href}\n        download={download}\n        aria-label={ariaLabel}\n        title={ariaLabel}\n        target={href.startsWith(window.location.origin) || IS_TEST ? '_self' : '_blank'}\n        rel=\"noopener noreferrer\"\n        dir={lang.isRtl ? 'rtl' : undefined}\n        onClick={onClick}\n        onMouseDown={handleMouseDown}\n      >\n        {content}\n      </a>\n    );\n  }\n\n  return (\n    <div\n      role=\"menuitem\"\n      tabIndex={0}\n      className={fullClassName}\n      onClick={handleClick}\n      onKeyDown={handleKeyDown}\n      onMouseDown={handleMouseDown}\n      onContextMenu={onContextMenu}\n      aria-label={ariaLabel}\n      title={ariaLabel}\n      dir={lang.isRtl ? 'rtl' : undefined}\n    >\n      {content}\n    </div>\n  );\n};\n\nexport default MenuItem;\n","import { getIsHeavyAnimating, useEffect, useRef } from '../../../../lib/teact/teact';\n\nimport { requestMeasure } from '../../../../lib/fasterdom/fasterdom';\n\nimport useHeavyAnimation from '../../../../hooks/useHeavyAnimation';\nimport useLastCallback from '../../../../hooks/useLastCallback';\nimport usePriorityPlaybackCheck, { isPriorityPlaybackActive } from '../../../../hooks/usePriorityPlaybackCheck';\nimport useBackgroundMode, { isBackgroundModeActive } from '../../../../hooks/window/useBackgroundMode';\n\nexport default function useVideoAutoPause(\n  playerRef: { current: HTMLVideoElement | null }, canPlay: boolean, isPriority?: boolean,\n) {\n  const canPlayRef = useRef();\n  canPlayRef.current = canPlay;\n\n  const { play, pause } = usePlayPause(playerRef);\n\n  const unfreezePlaying = useLastCallback(() => {\n    if (canPlayRef.current && (isPriority || !isFrozen())) {\n      play();\n    }\n  });\n\n  const unfreezePlayingOnRaf = useLastCallback(() => {\n    requestMeasure(unfreezePlaying);\n  });\n\n  useBackgroundMode(pause, unfreezePlayingOnRaf, !canPlay || isPriority);\n  useHeavyAnimation(pause, unfreezePlaying, !canPlay || isPriority);\n  usePriorityPlaybackCheck(pause, unfreezePlaying, !canPlay || isPriority);\n\n  const handlePlaying = useLastCallback(() => {\n    if (!canPlayRef.current || (!isPriority && isFrozen())) {\n      pause();\n    }\n  });\n\n  useEffect(() => {\n    if (canPlay) {\n      if (isPriority || !isFrozen()) {\n        play();\n      }\n    } else {\n      pause();\n    }\n  }, [canPlay, play, pause, isPriority]);\n\n  return { handlePlaying };\n}\n\nfunction usePlayPause(mediaRef: React.RefObject<HTMLMediaElement>) {\n  const shouldPauseRef = useRef(false);\n  const isLoadingPlayRef = useRef(false);\n\n  const play = useLastCallback(() => {\n    shouldPauseRef.current = false;\n    if (mediaRef.current && !isLoadingPlayRef.current && document.body.contains(mediaRef.current)) {\n      isLoadingPlayRef.current = true;\n      mediaRef.current.play().then(() => {\n        isLoadingPlayRef.current = false;\n        if (shouldPauseRef.current) {\n          mediaRef.current?.pause();\n          shouldPauseRef.current = false;\n        }\n      }).catch((e) => {\n        // eslint-disable-next-line no-console\n        console.warn(e);\n      });\n    }\n  });\n\n  const pause = useLastCallback(() => {\n    if (isLoadingPlayRef.current) {\n      shouldPauseRef.current = true;\n    } else {\n      mediaRef.current?.pause();\n    }\n  });\n\n  return { play, pause };\n}\n\nfunction isFrozen() {\n  return getIsHeavyAnimating() || isPriorityPlaybackActive() || isBackgroundModeActive();\n}\n","import React, { memo, useMemo, useRef } from '../../lib/teact/teact';\n\nimport useBuffering from '../../hooks/useBuffering';\nimport useLastCallback from '../../hooks/useLastCallback';\nimport useSyncEffect from '../../hooks/useSyncEffect';\nimport useVideoCleanup from '../../hooks/useVideoCleanup';\nimport useVideoAutoPause from '../middle/message/hooks/useVideoAutoPause';\n\ntype VideoProps = React.DetailedHTMLProps<React.VideoHTMLAttributes<HTMLVideoElement>, HTMLVideoElement>;\n\ntype OwnProps =\n  {\n    ref?: React.RefObject<HTMLVideoElement>;\n    isPriority?: boolean;\n    canPlay: boolean;\n    children?: React.ReactNode;\n    onReady?: NoneToVoidFunction;\n    onBroken?: NoneToVoidFunction;\n  }\n  & VideoProps;\n\nfunction OptimizedVideo({\n  ref,\n  isPriority,\n  canPlay,\n  children,\n  onReady,\n  onBroken,\n  onTimeUpdate,\n  ...restProps\n}: OwnProps) {\n  // eslint-disable-next-line no-null/no-null\n  const localRef = useRef<HTMLVideoElement>(null);\n  if (!ref) {\n    ref = localRef;\n  }\n\n  const { handlePlaying: handlePlayingForAutoPause } = useVideoAutoPause(ref, canPlay, isPriority);\n\n  const isReadyRef = useRef(false);\n  const handleReady = useLastCallback(() => {\n    if (!isReadyRef.current) {\n      onReady?.();\n      isReadyRef.current = true;\n    }\n  });\n\n  // This is only needed for browsers not allowing autoplay\n  const { isBuffered, bufferingHandlers } = useBuffering(true, onTimeUpdate, onBroken);\n  const { onPlaying: handlePlayingForBuffering, ...otherBufferingHandlers } = bufferingHandlers;\n  useSyncEffect(([prevIsBuffered]) => {\n    if (prevIsBuffered === undefined) {\n      return;\n    }\n\n    handleReady();\n  }, [isBuffered, handleReady]);\n\n  const handlePlaying = useLastCallback((e) => {\n    handlePlayingForAutoPause();\n    handlePlayingForBuffering(e);\n    handleReady();\n    restProps.onPlaying?.(e);\n  });\n\n  const mergedOtherBufferingHandlers = useMemo(() => {\n    const mergedHandlers: Record<string, AnyFunction> = {};\n    Object.keys(otherBufferingHandlers).forEach((keyString) => {\n      const key = keyString as keyof typeof otherBufferingHandlers;\n      mergedHandlers[key] = (event: Event) => {\n        restProps[key as keyof typeof restProps]?.(event);\n        otherBufferingHandlers[key]?.(event);\n      };\n    });\n\n    return mergedHandlers;\n  }, [otherBufferingHandlers, restProps]);\n\n  useVideoCleanup(ref, mergedOtherBufferingHandlers);\n\n  return (\n    // eslint-disable-next-line react/jsx-props-no-spreading\n    <video ref={ref} autoPlay {...restProps} {...mergedOtherBufferingHandlers} onPlaying={handlePlaying}>\n      {children}\n    </video>\n  );\n}\n\nexport default memo(OptimizedVideo);\n","import type { FC, VirtualElement } from '../../lib/teact/teact';\nimport { useLayoutEffect, useRef } from '../../lib/teact/teact';\nimport TeactDOM from '../../lib/teact/teact-dom';\n\ntype OwnProps = {\n  containerSelector?: string;\n  className?: string;\n  children: VirtualElement;\n};\n\nconst Portal: FC<OwnProps> = ({ containerSelector, className, children }) => {\n  const elementRef = useRef<HTMLDivElement>();\n  if (!elementRef.current) {\n    elementRef.current = document.createElement('div');\n  }\n\n  useLayoutEffect(() => {\n    const container = document.querySelector<HTMLDivElement>(containerSelector || '#portals');\n    if (!container) {\n      return undefined;\n    }\n\n    const element = elementRef.current!;\n    if (className) {\n      element.classList.add(className);\n    }\n\n    container.appendChild(element);\n\n    return () => {\n      TeactDOM.render(undefined, element);\n      container.removeChild(element);\n    };\n  }, [className, containerSelector]);\n\n  return TeactDOM.render(children, elementRef.current);\n};\n\nexport default Portal;\n","import type { FC } from '../../lib/teact/teact';\nimport React, { memo, useMemo, useState } from '../../lib/teact/teact';\n\nimport { debounce } from '../../util/schedulers';\n\nimport useLastCallback from '../../hooks/useLastCallback';\n\nimport './RippleEffect.scss';\n\ninterface Ripple {\n  x: number;\n  y: number;\n  size: number;\n}\n\nconst ANIMATION_DURATION_MS = 700;\n\nconst RippleEffect: FC = () => {\n  const [ripples, setRipples] = useState<Ripple[]>([]);\n\n  const cleanUpDebounced = useMemo(() => {\n    return debounce(() => {\n      setRipples([]);\n    }, ANIMATION_DURATION_MS, false);\n  }, []);\n\n  const handleMouseDown = useLastCallback((e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    if (e.button !== 0) {\n      return;\n    }\n\n    const container = e.currentTarget;\n    const position = container.getBoundingClientRect();\n    const rippleSize = container.offsetWidth / 2;\n\n    setRipples([\n      ...ripples,\n      {\n        x: e.clientX - position.x - (rippleSize / 2),\n        y: e.clientY - position.y - (rippleSize / 2),\n        size: rippleSize,\n      },\n    ]);\n\n    cleanUpDebounced();\n  });\n\n  return (\n    <div className=\"ripple-container\" onMouseDown={handleMouseDown}>\n      {ripples.map(({ x, y, size }) => (\n        <div\n          className=\"ripple-wave\"\n          style={`left: ${x}px; top: ${y}px; width: ${size}px; height: ${size}px;`}\n        />\n      ))}\n    </div>\n  );\n};\n\nexport default memo(RippleEffect);\n","import type { FC } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport './Spinner.scss';\n\nconst Spinner: FC<{\n  color?: 'blue' | 'white' | 'black' | 'green' | 'gray' | 'yellow';\n  backgroundColor?: 'light' | 'dark';\n  className?: string;\n}> = ({\n  color = 'blue',\n  backgroundColor,\n  className,\n}) => {\n  return (\n    <div className={buildClassName(\n      'Spinner', className, color, backgroundColor && 'with-background', backgroundColor && `bg-${backgroundColor}`,\n    )}\n    >\n      <div className=\"Spinner__inner\" />\n    </div>\n  );\n};\n\nexport default Spinner;\n","import type { RefObject } from 'react';\nimport React, {\n  beginHeavyAnimation, useEffect, useLayoutEffect, useRef,\n} from '../../lib/teact/teact';\nimport {\n  addExtraClass, removeExtraClass, setExtraStyles, toggleExtraClass,\n} from '../../lib/teact/teact-dom';\nimport { getGlobal } from '../../global';\n\nimport { requestForcedReflow, requestMutation } from '../../lib/fasterdom/fasterdom';\nimport { selectCanAnimateInterface } from '../../global/selectors';\nimport buildClassName from '../../util/buildClassName';\nimport { waitForAnimationEnd, waitForTransitionEnd } from '../../util/cssAnimationEndListeners';\nimport forceReflow from '../../util/forceReflow';\nimport { omit } from '../../util/iteratees';\nimport { allowSwipeControlForTransition } from '../../util/swipeController';\n\nimport useForceUpdate from '../../hooks/useForceUpdate';\nimport usePreviousDeprecated from '../../hooks/usePreviousDeprecated';\n\nimport './Transition.scss';\n\ntype AnimationName = (\n  'none' | 'slide' | 'slideRtl' | 'slideFade' | 'zoomFade' | 'zoomBounceSemiFade' | 'slideLayers'\n  | 'fade' | 'pushSlide' | 'reveal' | 'slideOptimized' | 'slideOptimizedRtl' | 'semiFade'\n  | 'slideVertical' | 'slideVerticalFade' | 'slideFadeAndroid'\n  );\nexport type ChildrenFn = (isActive: boolean, isFrom: boolean, currentKey: number, activeKey: number) => React.ReactNode;\nexport type TransitionProps = {\n  ref?: RefObject<HTMLDivElement>;\n  activeKey: number;\n  nextKey?: number;\n  name: AnimationName;\n  direction?: 'auto' | 'inverse' | 1 | -1;\n  renderCount?: number;\n  shouldRestoreHeight?: boolean;\n  shouldCleanup?: boolean;\n  cleanupExceptionKey?: number;\n  cleanupOnlyKey?: number;\n  // Used by async components which are usually remounted during first animation\n  shouldWrap?: boolean;\n  wrapExceptionKey?: number;\n  id?: string;\n  className?: string;\n  slideClassName?: string;\n  withSwipeControl?: boolean;\n  isBlockingAnimation?: boolean;\n  onStart?: NoneToVoidFunction;\n  onStop?: NoneToVoidFunction;\n  children: React.ReactNode | ChildrenFn;\n};\n\nconst FALLBACK_ANIMATION_END = 1000;\nconst CLASSES = {\n  slide: 'Transition_slide',\n  active: 'Transition_slide-active',\n  from: 'Transition_slide-from',\n  to: 'Transition_slide-to',\n  inactive: 'Transition_slide-inactive',\n};\n\nexport const ACTIVE_SLIDE_CLASS_NAME = CLASSES.active;\nexport const TO_SLIDE_CLASS_NAME = CLASSES.to;\n\nconst DISABLEABLE_ANIMATIONS = new Set<AnimationName>([\n  'slide', 'slideRtl', 'slideFade', 'zoomFade', 'zoomBounceSemiFade', 'slideLayers', 'pushSlide', 'reveal',\n  'slideOptimized', 'slideOptimizedRtl', 'slideVertical', 'slideVerticalFade',\n]);\n\nfunction Transition({\n  ref,\n  activeKey,\n  nextKey,\n  name,\n  direction = 'auto',\n  renderCount,\n  shouldRestoreHeight,\n  shouldCleanup,\n  cleanupExceptionKey,\n  cleanupOnlyKey,\n  shouldWrap,\n  wrapExceptionKey,\n  id,\n  className,\n  slideClassName,\n  withSwipeControl,\n  isBlockingAnimation,\n  onStart,\n  onStop,\n  children,\n}: TransitionProps) {\n  const currentKeyRef = useRef<number>();\n  // No need for a container to update on change\n  const shouldDisableAnimation = DISABLEABLE_ANIMATIONS.has(name)\n    && !selectCanAnimateInterface(getGlobal());\n\n  // eslint-disable-next-line no-null/no-null\n  let containerRef = useRef<HTMLDivElement>(null);\n  if (ref) {\n    containerRef = ref;\n  }\n\n  const rendersRef = useRef<Record<number, React.ReactNode | ChildrenFn>>({});\n  const prevActiveKey = usePreviousDeprecated<any>(activeKey);\n  const forceUpdate = useForceUpdate();\n  const isAnimatingRef = useRef(false);\n  const isSwipeJustCancelledRef = useRef(false);\n\n  const hasActiveKeyChanged = prevActiveKey !== undefined && activeKey !== prevActiveKey;\n\n  if (!renderCount && hasActiveKeyChanged) {\n    rendersRef.current = { [prevActiveKey]: rendersRef.current[prevActiveKey] };\n  }\n\n  rendersRef.current[activeKey] = children;\n  if (nextKey) {\n    rendersRef.current[nextKey] = children;\n  }\n\n  const isBackwards = (\n    direction === -1\n    || (direction === 'auto' && prevActiveKey > activeKey)\n    || (direction === 'inverse' && prevActiveKey < activeKey)\n  );\n\n  useLayoutEffect(() => {\n    function cleanup() {\n      if (!shouldCleanup) {\n        return;\n      }\n      if (cleanupExceptionKey !== undefined) {\n        rendersRef.current = { [cleanupExceptionKey]: rendersRef.current[cleanupExceptionKey] };\n      } else if (cleanupOnlyKey !== undefined) {\n        rendersRef.current = omit(rendersRef.current, [cleanupOnlyKey]);\n      } else {\n        rendersRef.current = {};\n      }\n      forceUpdate();\n    }\n\n    const isSlideOptimized = name === 'slideOptimized' || name === 'slideOptimizedRtl';\n    const container = containerRef.current!;\n    const keys = Object.keys(rendersRef.current).map(Number);\n    const prevActiveIndex = renderCount ? prevActiveKey : keys.indexOf(prevActiveKey);\n    const activeIndex = renderCount ? activeKey : keys.indexOf(activeKey);\n\n    const childNodes = Array.from(container.childNodes);\n    if (!childNodes.length) {\n      return;\n    }\n\n    const childElements = Array.from(container.children) as HTMLElement[];\n    childElements.forEach((el) => {\n      addExtraClass(el, CLASSES.slide);\n\n      if (slideClassName) {\n        slideClassName.split(/\\s+/).forEach((token) => {\n          addExtraClass(el, token);\n        });\n      }\n    });\n\n    if (!hasActiveKeyChanged) {\n      if (isAnimatingRef.current) {\n        return;\n      }\n\n      childElements.forEach((childElement) => {\n        if (childElement === childNodes[activeIndex]) {\n          addExtraClass(childElement, CLASSES.active);\n\n          if (isSlideOptimized) {\n            setExtraStyles(childElement, {\n              transition: 'none',\n              transform: 'translate3d(0, 0, 0)',\n            });\n          }\n        } else if (!isSlideOptimized) {\n          addExtraClass(childElement, CLASSES.inactive);\n        }\n      });\n\n      return;\n    }\n\n    currentKeyRef.current = activeKey;\n\n    if (isSlideOptimized) {\n      if (!childNodes[activeIndex]) {\n        return;\n      }\n\n      performSlideOptimized(\n        shouldDisableAnimation,\n        name,\n        isBackwards,\n        cleanup,\n        activeKey,\n        currentKeyRef,\n        isAnimatingRef,\n        container,\n        childNodes[activeIndex],\n        childNodes[prevActiveIndex],\n        shouldRestoreHeight,\n        isBlockingAnimation,\n        onStart,\n        onStop,\n      );\n\n      return;\n    }\n\n    if (name === 'none' || shouldDisableAnimation || isSwipeJustCancelledRef.current) {\n      if (isSwipeJustCancelledRef.current) {\n        isSwipeJustCancelledRef.current = false;\n      }\n\n      childNodes.forEach((node, i) => {\n        if (node instanceof HTMLElement) {\n          removeExtraClass(node, CLASSES.from);\n          removeExtraClass(node, CLASSES.to);\n          toggleExtraClass(node, CLASSES.active, i === activeIndex);\n          toggleExtraClass(node, CLASSES.inactive, i !== activeIndex);\n        }\n      });\n\n      cleanup();\n\n      return;\n    }\n\n    childNodes.forEach((node, i) => {\n      if (node instanceof HTMLElement) {\n        removeExtraClass(node, CLASSES.active);\n        toggleExtraClass(node, CLASSES.from, i === prevActiveIndex);\n        toggleExtraClass(node, CLASSES.to, i === activeIndex);\n        toggleExtraClass(node, CLASSES.inactive, i !== prevActiveIndex && i !== activeIndex);\n      }\n    });\n\n    isAnimatingRef.current = true;\n    const endHeavyAnimation = beginHeavyAnimation(undefined, isBlockingAnimation);\n    onStart?.();\n\n    toggleExtraClass(container, `Transition-${name}`, !isBackwards);\n    toggleExtraClass(container, `Transition-${name}Backwards`, isBackwards);\n\n    function onAnimationEnd() {\n      const activeElement = container.querySelector<HTMLDivElement>(`.${CLASSES.active}`);\n      const { clientHeight } = activeElement || {};\n\n      requestMutation(() => {\n        if (activeKey !== currentKeyRef.current) {\n          endHeavyAnimation();\n          return;\n        }\n\n        removeExtraClass(container, `Transition-${name}`);\n        removeExtraClass(container, `Transition-${name}Backwards`);\n\n        childNodes.forEach((node, i) => {\n          if (node instanceof HTMLElement) {\n            removeExtraClass(node, CLASSES.from);\n            removeExtraClass(node, CLASSES.to);\n            toggleExtraClass(node, CLASSES.active, i === activeIndex);\n            toggleExtraClass(node, CLASSES.inactive, i !== activeIndex);\n          }\n        });\n\n        if (shouldRestoreHeight) {\n          if (activeElement) {\n            setExtraStyles(activeElement, { height: 'auto' });\n            setExtraStyles(container, { height: `${clientHeight}px` });\n          }\n        }\n\n        onStop?.();\n        endHeavyAnimation();\n        isAnimatingRef.current = false;\n\n        cleanup();\n      });\n    }\n\n    const watchedNode = (name === 'reveal' || name === 'slideFadeAndroid') && isBackwards\n      ? childNodes[prevActiveIndex]\n      : childNodes[activeIndex];\n\n    if (watchedNode) {\n      if (withSwipeControl && childNodes[prevActiveIndex]) {\n        const giveUpAnimationEnd = waitForAnimationEnd(watchedNode, onAnimationEnd);\n\n        allowSwipeControlForTransition(\n          childNodes[prevActiveIndex] as HTMLElement,\n          childNodes[activeIndex] as HTMLElement,\n          () => {\n            giveUpAnimationEnd();\n            isSwipeJustCancelledRef.current = true;\n            onStop?.();\n            endHeavyAnimation();\n            isAnimatingRef.current = false;\n          },\n        );\n      } else {\n        waitForAnimationEnd(watchedNode, onAnimationEnd, undefined, FALLBACK_ANIMATION_END);\n      }\n    } else {\n      onAnimationEnd();\n    }\n  }, [\n    activeKey,\n    nextKey,\n    prevActiveKey,\n    hasActiveKeyChanged,\n    isBackwards,\n    name,\n    onStart,\n    onStop,\n    renderCount,\n    shouldRestoreHeight,\n    shouldCleanup,\n    slideClassName,\n    cleanupExceptionKey,\n    shouldDisableAnimation,\n    forceUpdate,\n    withSwipeControl,\n    isBlockingAnimation,\n    cleanupOnlyKey,\n  ]);\n\n  useEffect(() => {\n    if (!shouldRestoreHeight) {\n      return;\n    }\n\n    const container = containerRef.current!;\n    const activeElement = container.querySelector<HTMLDivElement>(`:scope > .${CLASSES.active}`)\n      || container.querySelector<HTMLDivElement>(`:scope > .${CLASSES.from}`);\n    if (!activeElement) {\n      return;\n    }\n\n    const { clientHeight, clientWidth } = activeElement || {};\n    if (!clientHeight || !clientWidth) {\n      return;\n    }\n\n    requestMutation(() => {\n      setExtraStyles(activeElement, { height: 'auto' });\n      setExtraStyles(container, {\n        height: `${clientHeight}px`,\n        flexBasis: `${clientHeight}px`,\n      });\n    });\n  }, [shouldRestoreHeight, children]);\n\n  const asFastList = !renderCount;\n  const renders = rendersRef.current;\n  const renderKeys = Object.keys(renderCount ? new Array(renderCount).fill(undefined) : renders).map(Number);\n  const contents = renderKeys.map((key) => {\n    const render = renders[key];\n    if (!render) {\n      return undefined;\n    }\n\n    const rendered = typeof render === 'function'\n      ? render(key === activeKey, key === prevActiveKey, key, activeKey)\n      : render;\n\n    return (shouldWrap && key !== wrapExceptionKey) || asFastList\n      ? <div key={key} teactOrderKey={key}>{rendered}</div>\n      : rendered;\n  });\n\n  return (\n    <div\n      ref={containerRef}\n      id={id}\n      className={buildClassName('Transition', className)}\n      teactFastList={asFastList}\n    >\n      {contents}\n    </div>\n  );\n}\n\nexport default Transition;\n\nfunction performSlideOptimized(\n  shouldDisableAnimation: boolean,\n  name: 'slideOptimized' | 'slideOptimizedRtl',\n  isBackwards: boolean,\n  cleanup: NoneToVoidFunction,\n  activeKey: number,\n  currentKeyRef: { current: number | undefined },\n  isAnimatingRef: { current: boolean | undefined },\n  container: HTMLElement,\n  toSlide: ChildNode,\n  fromSlide?: ChildNode,\n  shouldRestoreHeight?: boolean,\n  isBlockingAnimation?: boolean,\n  onStart?: NoneToVoidFunction,\n  onStop?: NoneToVoidFunction,\n) {\n  if (shouldDisableAnimation) {\n    toggleExtraClass(container, `Transition-${name}`, !isBackwards);\n    toggleExtraClass(container, `Transition-${name}Backwards`, isBackwards);\n\n    if (fromSlide instanceof HTMLElement) {\n      removeExtraClass(fromSlide, CLASSES.active);\n      setExtraStyles(fromSlide, {\n        transition: 'none',\n        transform: '',\n      });\n    }\n\n    if (toSlide instanceof HTMLElement) {\n      addExtraClass(toSlide, CLASSES.active);\n      setExtraStyles(toSlide, {\n        transition: 'none',\n        transform: 'translate3d(0, 0, 0)',\n      });\n    }\n\n    cleanup();\n\n    return;\n  }\n\n  if (name === 'slideOptimizedRtl') {\n    isBackwards = !isBackwards;\n  }\n\n  isAnimatingRef.current = true;\n  const endHeavyAnimation = beginHeavyAnimation(undefined, isBlockingAnimation);\n  onStart?.();\n\n  toggleExtraClass(container, `Transition-${name}`, !isBackwards);\n  toggleExtraClass(container, `Transition-${name}Backwards`, isBackwards);\n\n  if (fromSlide instanceof HTMLElement) {\n    setExtraStyles(fromSlide, {\n      transition: 'none',\n      transform: 'translate3d(0, 0, 0)',\n    });\n  }\n\n  if (toSlide instanceof HTMLElement) {\n    setExtraStyles(toSlide, {\n      transition: 'none',\n      transform: `translate3d(${isBackwards ? '-' : ''}100%, 0, 0)`,\n    });\n  }\n\n  requestForcedReflow(() => {\n    if (toSlide instanceof HTMLElement) {\n      forceReflow(toSlide);\n    }\n\n    return () => {\n      if (fromSlide instanceof HTMLElement) {\n        removeExtraClass(fromSlide, CLASSES.active);\n        setExtraStyles(fromSlide, {\n          transition: '',\n          transform: `translate3d(${isBackwards ? '' : '-'}100%, 0, 0)`,\n        });\n      }\n\n      if (toSlide instanceof HTMLElement) {\n        addExtraClass(toSlide, CLASSES.active);\n        setExtraStyles(toSlide, {\n          transition: '',\n          transform: 'translate3d(0, 0, 0)',\n        });\n      }\n    };\n  });\n\n  waitForTransitionEnd(toSlide, () => {\n    const clientHeight = toSlide instanceof HTMLElement ? toSlide.clientHeight : undefined;\n\n    requestMutation(() => {\n      if (activeKey !== currentKeyRef.current) {\n        endHeavyAnimation();\n        return;\n      }\n\n      if (fromSlide instanceof HTMLElement) {\n        setExtraStyles(fromSlide, {\n          transition: 'none',\n          transform: '',\n        });\n      }\n\n      if (shouldRestoreHeight && clientHeight && toSlide instanceof HTMLElement) {\n        setExtraStyles(toSlide, { height: 'auto' });\n        setExtraStyles(container, { height: `${clientHeight}px` });\n      }\n\n      onStop?.();\n      endHeavyAnimation();\n      isAnimatingRef.current = false;\n\n      cleanup();\n    });\n  });\n}\n","import type {\n  ApiLimitType, ApiLimitTypeForPromo, ApiPremiumSection, ApiReactionEmoji,\n} from './api/types';\nimport type {\n  GiftProfileFilterOptions,\n} from './types';\n\nexport const APP_CODE_NAME = 'A';\nexport const APP_NAME = process.env.APP_NAME || `Telegram Web ${APP_CODE_NAME}`;\nexport const RELEASE_DATETIME = process.env.RELEASE_DATETIME;\n\nexport const PRODUCTION_HOSTNAME = 'web.telegram.org';\nexport const PRODUCTION_URL = 'https://web.telegram.org/a';\nexport const WEB_VERSION_BASE = 'https://web.telegram.org/'; // Used to redirect to other versions\nexport const BASE_URL = process.env.BASE_URL;\n\nexport const IS_MOCKED_CLIENT = process.env.APP_MOCKED_CLIENT === '1';\nexport const IS_TEST = process.env.APP_ENV === 'test';\nexport const IS_PERF = process.env.APP_ENV === 'perf';\nexport const IS_BETA = process.env.APP_ENV === 'staging';\nexport const IS_PACKAGED_ELECTRON = process.env.IS_PACKAGED_ELECTRON;\n\nexport const DEBUG = process.env.APP_ENV !== 'production';\nexport const DEBUG_MORE = false;\nexport const DEBUG_LOG_FILENAME = 'tt-log.json';\nexport const STRICTERDOM_ENABLED = DEBUG;\nexport const BOT_VERIFICATION_PEERS_LIMIT = 20;\n\nexport const BETA_CHANGELOG_URL = 'https://telegra.ph/WebA-Beta-03-20';\nexport const ELECTRON_HOST_URL = process.env.ELECTRON_HOST_URL!;\n\nexport const DEBUG_ALERT_MSG = 'Shoot!\\nSomething went wrong, please see the error details in Dev Tools Console.';\nexport const DEBUG_GRAMJS = false;\n\nexport const PAGE_TITLE = process.env.APP_TITLE!;\nexport const INACTIVE_MARKER = '[Inactive]';\n\nexport const DEBUG_PAYMENT_SMART_GLOCAL = false;\n\nexport const SESSION_USER_KEY = 'user_auth';\nexport const LEGACY_PASSCODE_CACHE_NAME = 'tt-passcode';\n\nexport const GLOBAL_STATE_CACHE_DISABLED = false;\nexport const GLOBAL_STATE_CACHE_KEY = 'tt-global-state';\nexport const GLOBAL_STATE_CACHE_USER_LIST_LIMIT = 500;\nexport const GLOBAL_STATE_CACHE_CHAT_LIST_LIMIT = 200;\nexport const GLOBAL_STATE_CACHE_ARCHIVED_CHAT_LIST_LIMIT = 10;\nexport const GLOBAL_STATE_CACHE_CUSTOM_EMOJI_LIMIT = 150;\n\nexport const IS_SCREEN_LOCKED_CACHE_KEY = 'tt-is-screen-locked';\n\nexport const MEDIA_CACHE_DISABLED = false;\nexport const MEDIA_CACHE_NAME = 'tt-media';\nexport const MEDIA_CACHE_NAME_AVATARS = 'tt-media-avatars';\nexport const MEDIA_PROGRESSIVE_CACHE_DISABLED = false;\nexport const MEDIA_PROGRESSIVE_CACHE_NAME = 'tt-media-progressive';\nexport const MEDIA_CACHE_MAX_BYTES = 512 * 1024; // 512 KB\nexport const CUSTOM_BG_CACHE_NAME = 'tt-custom-bg';\nexport const LANG_CACHE_NAME = 'tt-lang-packs-v49';\nexport const ASSET_CACHE_NAME = 'tt-assets';\nexport const AUTODOWNLOAD_FILESIZE_MB_LIMITS = [1, 5, 10, 50, 100, 500];\nexport const DATA_BROADCAST_CHANNEL_NAME = 'tt-global';\nexport const ESTABLISH_BROADCAST_CHANNEL_NAME = 'tt-establish';\nexport const MULTITAB_LOCALSTORAGE_KEY = 'tt-multitab';\n\nexport const DOWNLOAD_WORKERS = 16;\nexport const UPLOAD_WORKERS = 16;\n\nconst isBigScreen = typeof window !== 'undefined' && window.innerHeight >= 900;\n\nexport const MIN_PASSWORD_LENGTH = 1;\n\nexport const MESSAGE_LIST_SLICE = isBigScreen ? 60 : 40;\nexport const MESSAGE_LIST_VIEWPORT_LIMIT = MESSAGE_LIST_SLICE * 2;\n\nexport const ARCHIVE_MINIMIZED_HEIGHT = 36;\nexport const CHAT_HEIGHT_PX = 72;\nexport const TOPIC_HEIGHT_PX = 65;\nexport const PEER_PICKER_ITEM_HEIGHT_PX = 56;\nexport const CHAT_LIST_SLICE = isBigScreen ? 30 : 25;\nexport const CHAT_LIST_LOAD_SLICE = 100;\nexport const SHARED_MEDIA_SLICE = 42;\nexport const CHAT_MEDIA_SLICE = 42;\nexport const MESSAGE_SEARCH_SLICE = 42;\nexport const GLOBAL_SEARCH_SLICE = 20;\nexport const GLOBAL_TOPIC_SEARCH_SLICE = 5;\nexport const GLOBAL_SEARCH_CONTACTS_LIMIT = 20;\nexport const MEMBERS_SLICE = 30;\nexport const MEMBERS_LOAD_SLICE = 200;\nexport const PINNED_MESSAGES_LIMIT = 50;\nexport const BLOCKED_LIST_LIMIT = 100;\nexport const PROFILE_SENSITIVE_AREA = 500;\nexport const TOPIC_LIST_SENSITIVE_AREA = 600;\nexport const GROUP_CALL_PARTICIPANTS_LIMIT = 100;\nexport const STORY_LIST_LIMIT = 100;\nexport const API_GENERAL_ID_LIMIT = 100;\nexport const STATISTICS_PUBLIC_FORWARDS_LIMIT = 50;\n\nexport const STORY_VIEWS_MIN_SEARCH = 15;\nexport const STORY_MIN_REACTIONS_SORT = 10;\nexport const STORY_VIEWS_MIN_CONTACTS_FILTER = 20;\n\nexport const MEDIA_TIMESTAMP_SAVE_MINIMUM_DURATION = 30; // 30s\n\nexport const GLOBAL_SUGGESTED_CHANNELS_ID = 'global';\n\n// As in Telegram for Android\n// https://github.com/DrKLO/Telegram/blob/51e9947527/TMessagesProj/src/main/java/org/telegram/messenger/MediaDataController.java#L7799\nexport const TOP_REACTIONS_LIMIT = 100;\n\n// As in Telegram for Android\n// https://github.com/DrKLO/Telegram/blob/51e9947527/TMessagesProj/src/main/java/org/telegram/messenger/MediaDataController.java#L7781\nexport const RECENT_REACTIONS_LIMIT = 50;\nexport const REACTION_LIST_LIMIT = 100;\nexport const REACTION_UNREAD_SLICE = 100;\nexport const MENTION_UNREAD_SLICE = 100;\nexport const TOPICS_SLICE = 20;\nexport const TOPICS_SLICE_SECOND_LOAD = 500;\n\nexport const TOP_CHAT_MESSAGES_PRELOAD_LIMIT = 20;\n\nexport const SPONSORED_MESSAGE_CACHE_MS = 300000; // 5 min\n\nexport const DEFAULT_VOLUME = 1;\nexport const DEFAULT_PLAYBACK_RATE = 1;\nexport const PLAYBACK_RATE_FOR_AUDIO_MIN_DURATION = 20 * 60; // 20 min\n\nexport const ANIMATION_LEVEL_CUSTOM = -1;\nexport const ANIMATION_LEVEL_MIN = 0;\nexport const ANIMATION_LEVEL_MED = 1;\nexport const ANIMATION_LEVEL_MAX = 2;\nexport const ANIMATION_LEVEL_DEFAULT = ANIMATION_LEVEL_MAX;\n\nexport const DEFAULT_MESSAGE_TEXT_SIZE_PX = 16;\nexport const IOS_DEFAULT_MESSAGE_TEXT_SIZE_PX = 17;\nexport const MACOS_DEFAULT_MESSAGE_TEXT_SIZE_PX = 15;\n\nexport const PREVIEW_AVATAR_COUNT = 3;\n\nexport const DRAFT_DEBOUNCE = 10000; // 10s\nexport const SEND_MESSAGE_ACTION_INTERVAL = 3000; // 3s\n// 10000s from https://corefork.telegram.org/api/url-authorization#automatic-authorization\nexport const APP_CONFIG_REFETCH_INTERVAL = 10000 * 1000;\nexport const GENERAL_REFETCH_INTERVAL = 60 * 60 * 1000; // 1h\n\nexport const EDITABLE_INPUT_ID = 'editable-message-text';\nexport const EDITABLE_INPUT_MODAL_ID = 'editable-message-text-modal';\nexport const EDITABLE_STORY_INPUT_ID = 'editable-story-input-text';\n// eslint-disable-next-line max-len\nexport const EDITABLE_INPUT_CSS_SELECTOR = `.messages-layout .Transition_slide-active #${EDITABLE_INPUT_ID}, .messages-layout .Transition > .Transition_slide-to #${EDITABLE_INPUT_ID}`;\nexport const EDITABLE_INPUT_MODAL_CSS_SELECTOR = `#${EDITABLE_INPUT_MODAL_ID}`;\nexport const EDITABLE_STORY_INPUT_CSS_SELECTOR = `#${EDITABLE_STORY_INPUT_ID}`;\n\nexport const CUSTOM_APPENDIX_ATTRIBUTE = 'data-has-custom-appendix';\nexport const MESSAGE_CONTENT_CLASS_NAME = 'message-content';\nexport const MESSAGE_CONTENT_SELECTOR = '.message-content';\nexport const VIEW_TRANSITION_CLASS_NAME = 'active-view-transition';\n\nexport const RESIZE_HANDLE_CLASS_NAME = 'resizeHandle';\nexport const RESIZE_HANDLE_SELECTOR = `.${RESIZE_HANDLE_CLASS_NAME}`;\n\nexport const SNAP_EFFECT_CONTAINER_ID = 'snap-effect-container';\nexport const SNAP_EFFECT_ID = 'snap-effect';\n\nexport const STARS_ICON_PLACEHOLDER = '⭐';\nexport const STARS_CURRENCY_CODE = 'XTR';\n\nexport const MIN_SCREEN_WIDTH_FOR_STATIC_RIGHT_COLUMN = 1275; // px\nexport const MIN_SCREEN_WIDTH_FOR_STATIC_LEFT_COLUMN = 925; // px\nexport const MOBILE_SCREEN_MAX_WIDTH = 600; // px\nexport const MOBILE_SCREEN_LANDSCAPE_MAX_WIDTH = 950; // px\nexport const MOBILE_SCREEN_LANDSCAPE_MAX_HEIGHT = 450; // px\n\nexport const MAX_INT_32 = 2 ** 31 - 1;\nexport const TMP_CHAT_ID = '0';\n\nexport const ANIMATION_END_DELAY = 100;\nexport const ANIMATION_WAVE_MIN_INTERVAL = 200;\nexport const MESSAGE_APPEARANCE_DELAY = 10;\n\nexport const SCROLL_MIN_DURATION = 300;\nexport const SCROLL_MAX_DURATION = 600;\nexport const SCROLL_MAX_DISTANCE = 800;\nexport const SCROLL_SHORT_TRANSITION_MAX_DISTANCE = 300; // px\n\n// Average duration of message sending animation\nexport const API_UPDATE_THROTTLE = Math.round((SCROLL_MIN_DURATION + SCROLL_MAX_DURATION) / 2);\nexport const API_THROTTLE_RESET_UPDATES = new Set([\n  'newMessage',\n  'newScheduledMessage',\n  'deleteMessages',\n  'deleteScheduledMessages',\n  'deleteHistory',\n  'deleteParticipantHistory',\n]);\n\nexport const LOCK_SCREEN_ANIMATION_DURATION_MS = 200;\n\nexport const STICKER_SIZE_INLINE_DESKTOP_FACTOR = 13;\nexport const STICKER_SIZE_INLINE_MOBILE_FACTOR = 11;\nexport const STICKER_SIZE_AUTH = 160;\nexport const STICKER_SIZE_AUTH_MOBILE = 120;\nexport const STICKER_SIZE_PICKER = 72;\nexport const EMOJI_SIZE_PICKER = 36;\nexport const COMPOSER_EMOJI_SIZE_PICKER = 32;\nexport const STICKER_SIZE_GENERAL_SETTINGS = 40;\nexport const STICKER_SIZE_PICKER_HEADER = 32;\nexport const STICKER_PICKER_MAX_SHARED_COVERS = 20;\nexport const STICKER_SIZE_SEARCH = 72;\nexport const STICKER_SIZE_MODAL = 72;\nexport const EMOJI_SIZE_MODAL = 36;\nexport const STICKER_SIZE_TWO_FA = 160;\nexport const STICKER_SIZE_PASSCODE = 160;\nexport const STICKER_SIZE_DISCUSSION_GROUPS = 140;\nexport const STICKER_SIZE_FOLDER_SETTINGS = 100;\nexport const STICKER_SIZE_INLINE_BOT_RESULT = 100;\nexport const STICKER_SIZE_JOIN_REQUESTS = 140;\nexport const STICKER_SIZE_INVITES = 140;\nexport const RECENT_STICKERS_LIMIT = 20;\nexport const RECENT_STATUS_LIMIT = 20;\nexport const EMOJI_STATUS_LOOP_LIMIT = 2;\nexport const EMOJI_SIZES = 7;\nexport const TOP_SYMBOL_SET_ID = 'top';\nexport const POPULAR_SYMBOL_SET_ID = 'popular';\nexport const RECENT_SYMBOL_SET_ID = 'recent';\nexport const COLLECTIBLE_STATUS_SET_ID = 'collectibleStatus';\nexport const FAVORITE_SYMBOL_SET_ID = 'favorite';\nexport const EFFECT_STICKERS_SET_ID = 'effectStickers';\nexport const EFFECT_EMOJIS_SET_ID = 'effectEmojis';\nexport const CHAT_STICKER_SET_ID = 'chatStickers';\nexport const DEFAULT_TOPIC_ICON_STICKER_ID = 'topic-default-icon';\nexport const DEFAULT_STATUS_ICON_ID = 'status-default-icon';\nexport const EMOJI_IMG_REGEX = /<img[^>]+alt=\"([^\"]+)\"(?![^>]*data-document-id)[^>]*>/gm;\n\nexport const BASE_EMOJI_KEYWORD_LANG = 'en';\n\nexport const MENU_TRANSITION_DURATION = 200;\nexport const SLIDE_TRANSITION_DURATION = 450;\n\nexport const BIRTHDAY_NUMBERS_SET = 'FestiveFontEmoji';\nexport const RESTRICTED_EMOJI_SET = 'RestrictedEmoji';\n\nexport const SVG_NAMESPACE = 'http://www.w3.org/2000/svg';\n\nexport const VIDEO_WEBM_TYPE = 'video/webm';\nexport const GIF_MIME_TYPE = 'image/gif';\n\nexport const LOTTIE_STICKER_MIME_TYPE = 'application/x-tgsticker';\nexport const VIDEO_STICKER_MIME_TYPE = VIDEO_WEBM_TYPE;\n\nexport const SUPPORTED_PHOTO_CONTENT_TYPES = new Set([\n  'image/png', 'image/jpeg', GIF_MIME_TYPE,\n]);\n\nexport const SUPPORTED_VIDEO_CONTENT_TYPES = new Set([\n  'video/mp4', 'video/quicktime',\n]);\n\nexport const SUPPORTED_AUDIO_CONTENT_TYPES = new Set([\n  'audio/mp3',\n  'audio/ogg',\n  'audio/wav',\n  'audio/mpeg',\n  'audio/flac',\n  'audio/aac',\n  'audio/m4a',\n  'audio/mp4',\n  'audio/x-m4a',\n]);\n\nexport const CONTENT_TYPES_WITH_PREVIEW = new Set([\n  ...SUPPORTED_PHOTO_CONTENT_TYPES,\n  ...SUPPORTED_VIDEO_CONTENT_TYPES,\n]);\n\nexport const CONTENT_NOT_SUPPORTED = 'The message is not supported on this version of Telegram.';\n\n// Taken from https://github.com/telegramdesktop/tdesktop/blob/41d9a9fcbd0c809c60ddbd9350791b1436aff7d9/Telegram/SourceFiles/ui/boxes/choose_language_box.cpp#L28\nexport const SUPPORTED_TRANSLATION_LANGUAGES = [\n  // Official\n  'en', 'ar', 'be', 'ca', 'zh', 'nl', 'fr', 'de', 'id',\n  'it', 'ja', 'ko', 'pl', 'pt', 'ru', 'es', 'uk',\n  // Unofficial\n  'af', 'sq', 'am', 'hy', 'az', 'eu', 'bn', 'bs', 'bg',\n  'ceb', 'zh-CN', 'zh-TW', 'co', 'hr', 'cs', 'da', 'eo',\n  'et', 'fi', 'fy', 'gl', 'ka', 'el', 'gu', 'ht', 'ha',\n  'haw', 'he', 'iw', 'hi', 'hmn', 'hu', 'is', 'ig', 'ga',\n  'jv', 'kn', 'kk', 'km', 'rw', 'ku', 'ky', 'lo', 'la',\n  'lv', 'lt', 'lb', 'mk', 'mg', 'ms', 'ml', 'mt', 'mi',\n  'mr', 'mn', 'my', 'ne', 'no', 'ny', 'or', 'ps', 'fa',\n  'pa', 'ro', 'sm', 'gd', 'sr', 'st', 'sn', 'sd', 'si',\n  'sk', 'sl', 'so', 'su', 'sw', 'sv', 'tl', 'tg', 'ta',\n  'tt', 'te', 'th', 'tr', 'tk', 'ur', 'ug', 'uz', 'vi',\n  'cy', 'xh', 'yi', 'yo', 'zu',\n];\n\n// eslint-disable-next-line max-len\nexport const RE_LINK_TEMPLATE = '((ftp|https?):\\\\/\\\\/)?((www\\\\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\\\\.[a-zA-Z][-a-zA-Z0-9]{1,62})\\\\b([-a-zA-Z0-9()@:%_+.,~#?&/=]*)';\nexport const RE_MENTION_TEMPLATE = '(@[\\\\w\\\\d_-]+)';\nexport const RE_TG_LINK = /^tg:(\\/\\/)?/i;\nexport const RE_TME_LINK = /^(https?:\\/\\/)?([-a-zA-Z0-9@:%_+~#=]{1,32}\\.)?t\\.me/i;\nexport const RE_TELEGRAM_LINK = /^(https?:\\/\\/)?telegram\\.org\\//i;\nexport const TME_LINK_PREFIX = 'https://t.me/';\nexport const BOT_FATHER_USERNAME = 'botfather';\nexport const USERNAME_PURCHASE_ERROR = 'USERNAME_PURCHASE_AVAILABLE';\nexport const MESSAGE_ID_REQUIRED_ERROR = 'MESSAGE_ID_REQUIRED';\nexport const PURCHASE_USERNAME = 'auction';\nexport const ACCEPTABLE_USERNAME_ERRORS = new Set([USERNAME_PURCHASE_ERROR, 'USERNAME_INVALID']);\nexport const TME_WEB_DOMAINS = new Set(['t.me', 'web.t.me', 'a.t.me', 'k.t.me', 'z.t.me']);\nexport const WEB_APP_PLATFORM = 'weba';\nexport const LANG_PACK = 'weba';\n\n// eslint-disable-next-line max-len\nexport const COUNTRIES_WITH_12H_TIME_FORMAT = new Set(['AU', 'BD', 'CA', 'CO', 'EG', 'HN', 'IE', 'IN', 'JO', 'MX', 'MY', 'NI', 'NZ', 'PH', 'PK', 'SA', 'SV', 'US']);\n\nexport const API_CHAT_TYPES = ['bots', 'channels', 'chats', 'users', 'groups'] as const;\n\nexport const HEART_REACTION: ApiReactionEmoji = {\n  type: 'emoji',\n  emoticon: '❤',\n};\n\n// MTProto constants\nexport const SERVICE_NOTIFICATIONS_USER_ID = '777000';\nexport const REPLIES_USER_ID = '1271266957'; // TODO For Test connection ID must be equal to 708513\nexport const VERIFICATION_CODES_USER_ID = '489000';\nexport const ANONYMOUS_USER_ID = '2666000';\nexport const RESTRICTED_EMOJI_SET_ID = '7173162320003080';\nexport const CHANNEL_ID_LENGTH = 14; // 14 symbols, based on TDLib's `ZERO_CHANNEL_ID = -1000000000000`\nexport const DEFAULT_GIF_SEARCH_BOT_USERNAME = 'gif';\nexport const ALL_FOLDER_ID = 0;\nexport const ARCHIVED_FOLDER_ID = 1;\nexport const SAVED_FOLDER_ID = -1;\nexport const DELETED_COMMENTS_CHANNEL_ID = '-1000000000777';\nexport const MAX_MEDIA_FILES_FOR_ALBUM = 10;\nexport const MAX_ACTIVE_PINNED_CHATS = 5;\nexport const SCHEDULED_WHEN_ONLINE = 0x7FFFFFFE;\nexport const LANG_PACKS = ['android', 'ios', 'tdesktop', 'macos'] as const;\nexport const FEEDBACK_URL = 'https://bugs.telegram.org/?tag_ids=41&sort=time';\nexport const FAQ_URL = 'https://telegram.org/faq';\nexport const PRIVACY_URL = 'https://telegram.org/privacy';\nexport const MINI_APP_TOS_URL = 'https://telegram.org/tos/mini-apps';\nexport const FRAGMENT_ADS_URL = 'https://fragment.com/ads';\nexport const GENERAL_TOPIC_ID = 1;\nexport const STORY_EXPIRE_PERIOD = 86400; // 1 day\nexport const STORY_VIEWERS_EXPIRE_PERIOD = 86400; // 1 day\nexport const FRESH_AUTH_PERIOD = 86400; // 1 day\nexport const GIVEAWAY_BOOST_PER_PREMIUM = 4;\nexport const GIVEAWAY_MAX_ADDITIONAL_CHANNELS = 10;\nexport const GIVEAWAY_MAX_ADDITIONAL_USERS = 10;\nexport const GIVEAWAY_MAX_ADDITIONAL_COUNTRIES = 10;\nexport const BOOST_PER_SENT_GIFT = 3;\nexport const FRAGMENT_PHONE_CODE = '888';\nexport const FRAGMENT_PHONE_LENGTH = 11;\n\nexport const LIGHT_THEME_BG_COLOR = '#99BA92';\nexport const DARK_THEME_BG_COLOR = '#0F0F0F';\nexport const DEFAULT_PATTERN_COLOR = '#4A8E3A8C';\nexport const DARK_THEME_PATTERN_COLOR = '#0A0A0A8C';\nexport const PEER_COLOR_BG_OPACITY = '1a';\nexport const PEER_COLOR_BG_ACTIVE_OPACITY = '2b';\nexport const PEER_COLOR_GRADIENT_STEP = 5; // px\nexport const MAX_UPLOAD_FILEPART_SIZE = 524288;\nexport const MAX_UNIQUE_REACTIONS = 11;\n\nexport const IGNORE_UNHANDLED_ERRORS = new Set([\n  'USER_CANCELED',\n]);\n\n// Group calls\nexport const GROUP_CALL_VOLUME_MULTIPLIER = 100;\nexport const GROUP_CALL_DEFAULT_VOLUME = 100 * GROUP_CALL_VOLUME_MULTIPLIER;\n\nexport const DEFAULT_LIMITS: Record<ApiLimitType, readonly [number, number]> = {\n  uploadMaxFileparts: [4000, 8000],\n  stickersFaved: [5, 10],\n  savedGifs: [200, 400],\n  dialogFiltersChats: [100, 200],\n  dialogFilters: [10, 20],\n  dialogFolderPinned: [5, 10],\n  captionLength: [1024, 4096],\n  channels: [500, 1000],\n  channelsPublic: [10, 20],\n  aboutLength: [70, 140],\n  chatlistInvites: [3, 100],\n  chatlistJoined: [2, 20],\n  recommendedChannels: [10, 100],\n  savedDialogsPinned: [5, 100],\n};\nexport const DEFAULT_MAX_MESSAGE_LENGTH = 4096;\n\nexport const ONE_TIME_MEDIA_TTL_SECONDS = 2147483647;\n\n// Premium\nexport const PREMIUM_FEATURE_SECTIONS = [\n  'stories',\n  'double_limits',\n  'more_upload',\n  'faster_download',\n  'voice_to_text',\n  'no_ads',\n  'infinite_reactions',\n  'premium_stickers',\n  'animated_emoji',\n  'advanced_chat_management',\n  'profile_badge',\n  'animated_userpics',\n  'emoji_status',\n  'translations',\n  'saved_tags',\n  'last_seen',\n  'message_privacy',\n  'effects',\n] as const;\n\nexport const PREMIUM_BOTTOM_VIDEOS: ApiPremiumSection[] = [\n  'faster_download',\n  'voice_to_text',\n  'advanced_chat_management',\n  'infinite_reactions',\n  'profile_badge',\n  'animated_userpics',\n  'emoji_status',\n  'translations',\n  'saved_tags',\n  'last_seen',\n  'message_privacy',\n  'effects',\n];\n\nexport const PREMIUM_LIMITS_ORDER: ApiLimitTypeForPromo[] = [\n  'channels',\n  'dialogFolderPinned',\n  'channelsPublic',\n  'savedGifs',\n  'stickersFaved',\n  'aboutLength',\n  'captionLength',\n  'dialogFilters',\n  'dialogFiltersChats',\n  'recommendedChannels',\n];\n\nexport const DEFAULT_GIFT_PROFILE_FILTER_OPTIONS : GiftProfileFilterOptions = {\n  sortType: 'byDate',\n  shouldIncludeUnlimited: true,\n  shouldIncludeLimited: true,\n  shouldIncludeUnique: true,\n  shouldIncludeDisplayed: true,\n  shouldIncludeHidden: true,\n} as const;\n","import type { ActionReturnType } from '../../types';\nimport { ManagementProgress } from '../../../types';\n\nimport {\n  CUSTOM_BG_CACHE_NAME,\n  LANG_CACHE_NAME,\n  LOCK_SCREEN_ANIMATION_DURATION_MS,\n  MEDIA_CACHE_NAME,\n  MEDIA_CACHE_NAME_AVATARS,\n  MEDIA_PROGRESSIVE_CACHE_NAME,\n} from '../../../config';\nimport { updateAppBadge } from '../../../util/appBadge';\nimport { MAIN_IDB_STORE, PASSCODE_IDB_STORE } from '../../../util/browser/idb';\nimport * as cacheApi from '../../../util/cacheApi';\nimport { getCurrentTabId } from '../../../util/establishMultitabRole';\nimport { unsubscribe } from '../../../util/notifications';\nimport { clearEncryptedSession, encryptSession, forgetPasscode } from '../../../util/passcode';\nimport { parseInitialLocationHash, resetInitialLocationHash, resetLocationHash } from '../../../util/routing';\nimport { pause } from '../../../util/schedulers';\nimport {\n  clearStoredSession,\n  loadStoredSession,\n  storeSession,\n} from '../../../util/sessions';\nimport { forceWebsync } from '../../../util/websync';\nimport {\n  IS_WEBM_SUPPORTED, MAX_BUFFER_SIZE, PLATFORM_ENV,\n} from '../../../util/windowEnvironment';\nimport {\n  callApi, callApiLocal, initApi, setShouldEnableDebugLog,\n} from '../../../api/gramjs';\nimport { serializeGlobal } from '../../cache';\nimport {\n  addActionHandler, getGlobal, setGlobal,\n} from '../../index';\nimport {\n  clearGlobalForLockScreen, updateManagementProgress, updatePasscodeSettings,\n} from '../../reducers';\n\naddActionHandler('initApi', (global, actions): ActionReturnType => {\n  const initialLocationHash = parseInitialLocationHash();\n\n  const hasTestParam = window.location.search.includes('test') || initialLocationHash?.tgWebAuthTest === '1';\n\n  void initApi(actions.apiUpdate, {\n    userAgent: navigator.userAgent,\n    platform: PLATFORM_ENV,\n    sessionData: loadStoredSession(),\n    isWebmSupported: IS_WEBM_SUPPORTED,\n    maxBufferSize: MAX_BUFFER_SIZE,\n    webAuthToken: initialLocationHash?.tgWebAuthToken,\n    dcId: initialLocationHash?.tgWebAuthDcId ? Number(initialLocationHash?.tgWebAuthDcId) : undefined,\n    mockScenario: initialLocationHash?.mockScenario,\n    shouldAllowHttpTransport: global.settings.byKey.shouldAllowHttpTransport,\n    shouldForceHttpTransport: global.settings.byKey.shouldForceHttpTransport,\n    shouldDebugExportedSenders: global.settings.byKey.shouldDebugExportedSenders,\n    langCode: global.settings.byKey.language,\n    isTestServerRequested: hasTestParam,\n  });\n\n  void setShouldEnableDebugLog(Boolean(global.settings.byKey.shouldCollectDebugLogs));\n});\n\naddActionHandler('setAuthPhoneNumber', (global, actions, payload): ActionReturnType => {\n  const { phoneNumber } = payload!;\n\n  void callApi('provideAuthPhoneNumber', phoneNumber.replace(/[^\\d]/g, ''));\n\n  return {\n    ...global,\n    authIsLoading: true,\n    authErrorKey: undefined,\n  };\n});\n\naddActionHandler('setAuthCode', (global, actions, payload): ActionReturnType => {\n  const { code } = payload!;\n\n  void callApi('provideAuthCode', code);\n\n  return {\n    ...global,\n    authIsLoading: true,\n    authErrorKey: undefined,\n  };\n});\n\naddActionHandler('setAuthPassword', (global, actions, payload): ActionReturnType => {\n  const { password } = payload!;\n\n  void callApi('provideAuthPassword', password);\n\n  return {\n    ...global,\n    authIsLoading: true,\n    authErrorKey: undefined,\n  };\n});\n\naddActionHandler('uploadProfilePhoto', async (global, actions, payload): Promise<void> => {\n  const {\n    file, isFallback, isVideo, videoTs, bot,\n    tabId = getCurrentTabId(),\n  } = payload!;\n\n  global = updateManagementProgress(global, ManagementProgress.InProgress, tabId);\n  setGlobal(global);\n\n  const result = await callApi('uploadProfilePhoto', file, isFallback, isVideo, videoTs, bot);\n  if (!result) return;\n\n  global = getGlobal();\n  global = updateManagementProgress(global, ManagementProgress.Complete, tabId);\n  setGlobal(global);\n\n  actions.loadFullUser({ userId: global.currentUserId! });\n});\n\naddActionHandler('signUp', (global, actions, payload): ActionReturnType => {\n  const { firstName, lastName } = payload!;\n\n  void callApi('provideAuthRegistration', { firstName, lastName });\n\n  return {\n    ...global,\n    authIsLoading: true,\n    authErrorKey: undefined,\n  };\n});\n\naddActionHandler('returnToAuthPhoneNumber', (global): ActionReturnType => {\n  void callApi('restartAuth');\n\n  return {\n    ...global,\n    authErrorKey: undefined,\n  };\n});\n\naddActionHandler('goToAuthQrCode', (global): ActionReturnType => {\n  void callApi('restartAuthWithQr');\n\n  return {\n    ...global,\n    authIsLoadingQrCode: true,\n    authErrorKey: undefined,\n  };\n});\n\naddActionHandler('saveSession', (global, actions, payload): ActionReturnType => {\n  if (global.passcode.isScreenLocked) {\n    return;\n  }\n\n  const { sessionData } = payload;\n  if (sessionData) {\n    storeSession(sessionData, global.currentUserId);\n  } else {\n    clearStoredSession();\n  }\n});\n\naddActionHandler('signOut', async (global, actions, payload): Promise<void> => {\n  if ('hangUp' in actions) actions.hangUp({ tabId: getCurrentTabId() });\n  if ('leaveGroupCall' in actions) actions.leaveGroupCall({ tabId: getCurrentTabId() });\n\n  try {\n    resetInitialLocationHash();\n    resetLocationHash();\n    await unsubscribe();\n    await Promise.race([callApi('destroy'), pause(3000)]);\n    await forceWebsync(false);\n  } catch (err) {\n    // Do nothing\n  }\n\n  actions.reset();\n\n  if (payload?.forceInitApi) {\n    actions.initApi();\n  }\n});\n\naddActionHandler('requestChannelDifference', (global, actions, payload): ActionReturnType => {\n  const { chatId } = payload;\n\n  void callApi('requestChannelDifference', chatId);\n});\n\naddActionHandler('reset', (global, actions): ActionReturnType => {\n  clearStoredSession();\n  clearEncryptedSession();\n\n  void cacheApi.clear(MEDIA_CACHE_NAME);\n  void cacheApi.clear(MEDIA_CACHE_NAME_AVATARS);\n  void cacheApi.clear(MEDIA_PROGRESSIVE_CACHE_NAME);\n  void cacheApi.clear(CUSTOM_BG_CACHE_NAME);\n\n  MAIN_IDB_STORE.clear();\n  PASSCODE_IDB_STORE.clear();\n\n  const langCachePrefix = LANG_CACHE_NAME.replace(/\\d+$/, '');\n  const langCacheVersion = Number((LANG_CACHE_NAME.match(/\\d+$/) || ['0'])[0]);\n  for (let i = 0; i < langCacheVersion; i++) {\n    void cacheApi.clear(`${langCachePrefix}${i === 0 ? '' : i}`);\n  }\n\n  updateAppBadge(0);\n\n  actions.initShared({ force: true });\n  Object.values(global.byTabId).forEach(({ id: otherTabId, isMasterTab }) => {\n    actions.init({ tabId: otherTabId, isMasterTab });\n  });\n});\n\naddActionHandler('disconnect', (): ActionReturnType => {\n  void callApiLocal('disconnect');\n});\n\naddActionHandler('destroyConnection', (): ActionReturnType => {\n  void callApiLocal('destroy', true, true);\n});\n\naddActionHandler('loadNearestCountry', async (global): Promise<void> => {\n  if (global.connectionState !== 'connectionStateReady') {\n    return;\n  }\n\n  const authNearestCountry = await callApi('fetchNearestCountry');\n\n  global = getGlobal();\n  global = {\n    ...global,\n    authNearestCountry,\n  };\n  setGlobal(global);\n});\n\naddActionHandler('setDeviceToken', (global, actions, deviceToken): ActionReturnType => {\n  return {\n    ...global,\n    push: {\n      deviceToken,\n      subscribedAt: Date.now(),\n    },\n  };\n});\n\naddActionHandler('deleteDeviceToken', (global): ActionReturnType => {\n  return {\n    ...global,\n    push: undefined,\n  };\n});\n\naddActionHandler('lockScreen', async (global): Promise<void> => {\n  const sessionJson = JSON.stringify({ ...loadStoredSession(), userId: global.currentUserId });\n  const globalJson = await serializeGlobal(global);\n\n  await encryptSession(sessionJson, globalJson);\n  forgetPasscode();\n  clearStoredSession();\n  updateAppBadge(0);\n\n  global = getGlobal();\n  global = updatePasscodeSettings(\n    global,\n    {\n      isScreenLocked: true,\n      invalidAttemptsCount: 0,\n      timeoutUntil: undefined,\n    },\n  );\n  setGlobal(global);\n\n  setTimeout(() => {\n    global = getGlobal();\n    global = clearGlobalForLockScreen(global);\n    setGlobal(global);\n  }, LOCK_SCREEN_ANIMATION_DURATION_MS);\n\n  try {\n    await unsubscribe();\n    await callApi('destroy', true);\n  } catch (err) {\n    // Do nothing\n  }\n});\n","import type { ApiPrivacySettings, ApiUsername } from '../../../api/types';\nimport type { ActionReturnType } from '../../types';\nimport {\n  ProfileEditProgress,\n  UPLOADING_WALLPAPER_SLUG,\n} from '../../../types';\n\nimport { APP_CONFIG_REFETCH_INTERVAL, COUNTRIES_WITH_12H_TIME_FORMAT, MAX_INT_32 } from '../../../config';\nimport { getCurrentTabId } from '../../../util/establishMultitabRole';\nimport { buildCollectionByKey } from '../../../util/iteratees';\nimport { requestPermission, subscribe, unsubscribe } from '../../../util/notifications';\nimport { setTimeFormat } from '../../../util/oldLangProvider';\nimport requestActionTimeout from '../../../util/requestActionTimeout';\nimport { getServerTime } from '../../../util/serverTime';\nimport { callApi } from '../../../api/gramjs';\nimport { buildApiInputPrivacyRules } from '../../helpers';\nimport { addActionHandler, getGlobal, setGlobal } from '../../index';\nimport {\n  addBlockedUser, addNotifyException, addNotifyExceptions, deletePeerPhoto,\n  removeBlockedUser, replaceSettings, updateChat,\n  updateUser, updateUserFullInfo,\n} from '../../reducers';\nimport { updateTabState } from '../../reducers/tabs';\nimport {\n  selectChat, selectTabState, selectUser,\n} from '../../selectors';\n\naddActionHandler('updateProfile', async (global, actions, payload): Promise<void> => {\n  const {\n    photo, firstName, lastName, bio: about, username,\n    tabId = getCurrentTabId(),\n  } = payload;\n\n  const { currentUserId } = global;\n  if (!currentUserId) {\n    return;\n  }\n\n  global = updateTabState(global, {\n    profileEdit: {\n      progress: ProfileEditProgress.InProgress,\n    },\n  }, tabId);\n  setGlobal(global);\n\n  if (photo) {\n    await callApi('uploadProfilePhoto', photo);\n  }\n\n  if (firstName || lastName || about) {\n    const result = await callApi('updateProfile', { firstName, lastName, about });\n    if (result) {\n      global = getGlobal();\n      const currentUser = currentUserId && selectUser(global, currentUserId);\n\n      if (currentUser) {\n        global = updateUser(\n          global,\n          currentUser.id,\n          {\n            firstName,\n            lastName,\n          },\n        );\n        global = updateUserFullInfo(global, currentUser.id, { bio: about });\n        setGlobal(global);\n      }\n    }\n  }\n\n  if (username !== undefined) {\n    const result = await callApi('updateUsername', username);\n    global = getGlobal();\n    const currentUser = currentUserId && selectUser(global, currentUserId);\n\n    if (result && currentUser) {\n      const shouldUsernameUpdate = currentUser.usernames?.find((u) => u.isEditable);\n      const usernames = shouldUsernameUpdate\n        ? currentUser.usernames?.map((u) => (u.isEditable ? { ...u, username } : u))\n        : [{ username, isEditable: true, isActive: true } as ApiUsername, ...currentUser.usernames || []];\n      global = updateUser(global, currentUserId, { usernames });\n      setGlobal(global);\n    }\n  }\n\n  global = getGlobal();\n  global = updateTabState(global, {\n    profileEdit: {\n      progress: ProfileEditProgress.Complete,\n    },\n  }, tabId);\n  setGlobal(global);\n\n  if (photo) {\n    actions.loadFullUser({ userId: currentUserId, withPhotos: true });\n  }\n});\n\naddActionHandler('updateProfilePhoto', async (global, actions, payload): Promise<void> => {\n  const { photo, isFallback } = payload;\n  const { currentUserId } = global;\n  if (!currentUserId) return;\n  const currentUser = selectUser(global, currentUserId);\n  if (!currentUser) return;\n\n  global = updateUser(global, currentUserId, { avatarPhotoId: undefined });\n  global = updateUserFullInfo(global, currentUserId, { profilePhoto: undefined });\n\n  setGlobal(global);\n\n  const result = await callApi('updateProfilePhoto', photo, isFallback);\n  if (!result) return;\n\n  actions.loadFullUser({ userId: currentUserId, withPhotos: true });\n});\n\naddActionHandler('deleteProfilePhoto', async (global, actions, payload): Promise<void> => {\n  const { photo } = payload;\n  const { currentUserId } = global;\n  if (!currentUserId) return;\n\n  const isDeleted = await callApi('deleteProfilePhotos', [photo]);\n  if (!isDeleted) return;\n\n  global = getGlobal();\n  global = deletePeerPhoto(global, currentUserId, photo.id);\n  setGlobal(global);\n\n  actions.loadFullUser({ userId: currentUserId, withPhotos: true });\n});\n\naddActionHandler('checkUsername', async (global, actions, payload): Promise<void> => {\n  const { username, tabId = getCurrentTabId() } = payload!;\n\n  let tabState = selectTabState(global, tabId);\n  // No need to check the username if profile update is already in progress\n  if (tabState.profileEdit && tabState.profileEdit.progress === ProfileEditProgress.InProgress) {\n    return;\n  }\n\n  global = updateTabState(global, {\n    profileEdit: {\n      progress: tabState.profileEdit ? tabState.profileEdit.progress : ProfileEditProgress.Idle,\n      checkedUsername: undefined,\n      isUsernameAvailable: undefined,\n      error: undefined,\n    },\n  }, tabId);\n  setGlobal(global);\n\n  const { result, error } = (await callApi('checkUsername', username))!;\n\n  global = getGlobal();\n  tabState = selectTabState(global, tabId);\n  global = updateTabState(global, {\n    profileEdit: {\n      ...tabState.profileEdit!,\n      checkedUsername: username,\n      isUsernameAvailable: result === true,\n      error,\n    },\n  }, tabId);\n  setGlobal(global);\n});\n\naddActionHandler('loadWallpapers', async (global): Promise<void> => {\n  const result = await callApi('fetchWallpapers');\n  if (!result) {\n    return;\n  }\n\n  global = getGlobal();\n  global = {\n    ...global,\n    settings: {\n      ...global.settings,\n      loadedWallpapers: result.wallpapers,\n    },\n  };\n  setGlobal(global);\n});\n\naddActionHandler('uploadWallpaper', async (global, actions, payload): Promise<void> => {\n  const file = payload;\n  const previewBlobUrl = URL.createObjectURL(file);\n\n  global = {\n    ...global,\n    settings: {\n      ...global.settings,\n      loadedWallpapers: [\n        {\n          slug: UPLOADING_WALLPAPER_SLUG,\n          document: {\n            mediaType: 'document',\n            fileName: '',\n            size: file.size,\n            mimeType: file.type,\n            previewBlobUrl,\n          },\n        },\n        ...(global.settings.loadedWallpapers || []),\n      ],\n    },\n  };\n  setGlobal(global);\n\n  const result = await callApi('uploadWallpaper', file);\n  if (!result) {\n    return;\n  }\n\n  const { wallpaper } = result;\n\n  global = getGlobal();\n  if (!global.settings.loadedWallpapers) {\n    return;\n  }\n\n  const firstWallpaper = global.settings.loadedWallpapers[0];\n  if (!firstWallpaper || firstWallpaper.slug !== UPLOADING_WALLPAPER_SLUG) {\n    return;\n  }\n\n  const withLocalMedia = {\n    ...wallpaper,\n    document: {\n      ...wallpaper.document,\n      previewBlobUrl,\n    },\n  };\n\n  global = {\n    ...global,\n    settings: {\n      ...global.settings,\n      loadedWallpapers: [\n        withLocalMedia,\n        ...global.settings.loadedWallpapers.slice(1),\n      ],\n    },\n  };\n  setGlobal(global);\n});\n\naddActionHandler('loadBlockedUsers', async (global): Promise<void> => {\n  const result = await callApi('fetchBlockedUsers', {});\n  if (!result) return;\n\n  global = getGlobal();\n\n  global = {\n    ...global,\n    blocked: {\n      ids: result.blockedIds,\n      totalCount: result.totalCount,\n    },\n  };\n\n  setGlobal(global);\n});\n\naddActionHandler('blockUser', async (global, actions, payload): Promise<void> => {\n  const { userId, isOnlyStories } = payload;\n\n  const user = selectUser(global, userId);\n  if (!user) return;\n\n  const result = await callApi('blockUser', {\n    user,\n    isOnlyStories: isOnlyStories || undefined,\n  });\n  if (!result) return;\n\n  global = getGlobal();\n  global = addBlockedUser(global, userId);\n  setGlobal(global);\n});\n\naddActionHandler('unblockUser', async (global, actions, payload): Promise<void> => {\n  const { userId, isOnlyStories } = payload;\n\n  const user = selectUser(global, userId);\n  if (!user) return;\n\n  const result = await callApi('unblockUser', {\n    user,\n    isOnlyStories: isOnlyStories || undefined,\n  });\n  if (!result) return;\n\n  global = getGlobal();\n  global = removeBlockedUser(global, userId);\n  setGlobal(global);\n});\n\naddActionHandler('loadNotificationExceptions', async (global): Promise<void> => {\n  const result = await callApi('fetchNotificationExceptions');\n  if (!result) {\n    return;\n  }\n\n  global = getGlobal();\n  global = addNotifyExceptions(global, result);\n  setGlobal(global);\n});\n\naddActionHandler('loadNotificationSettings', async (global): Promise<void> => {\n  const [signUpNotification, notifyDefaults] = await Promise.all([\n    callApi('fetchContactSignUpSetting'),\n    callApi('fetchNotifyDefaultSettings'),\n  ]);\n\n  if (!notifyDefaults) return;\n\n  global = getGlobal();\n  global = replaceSettings(global, {\n    hasContactJoinedNotifications: signUpNotification,\n  });\n  global = {\n    ...global,\n    settings: {\n      ...global.settings,\n      notifyDefaults,\n    },\n  };\n  setGlobal(global);\n});\n\naddActionHandler('updateNotificationSettings', async (global, actions, payload): Promise<void> => {\n  const { peerType, isMuted, shouldShowPreviews } = payload!;\n\n  const result = await callApi('updateNotificationSettings', peerType, { isMuted, shouldShowPreviews });\n  if (!result) {\n    return;\n  }\n\n  global = getGlobal();\n  global = addNotifyException(global, peerType, {\n    mutedUntil: isMuted ? MAX_INT_32 : undefined,\n    shouldShowPreviews,\n  });\n  setGlobal(global);\n});\n\naddActionHandler('updateWebNotificationSettings', async (global, actions, payload): Promise<void> => {\n  const oldSettings = global.settings.byKey;\n  global = replaceSettings(global, payload);\n  setGlobal(global);\n  const { hasWebNotifications, hasPushNotifications } = global.settings.byKey;\n  if (!oldSettings.hasPushNotifications && hasPushNotifications) {\n    await subscribe();\n  }\n  if (oldSettings.hasPushNotifications && !hasPushNotifications) {\n    await unsubscribe();\n  }\n  if (!oldSettings.hasWebNotifications && hasWebNotifications) {\n    const isGranted = await requestPermission();\n    if (!isGranted) {\n      global = getGlobal();\n      global = replaceSettings(global, { hasWebNotifications: false });\n      setGlobal(global);\n    }\n  }\n});\n\naddActionHandler('updateContactSignUpNotification', async (global, actions, payload): Promise<void> => {\n  const { isSilent } = payload;\n\n  const result = await callApi('updateContactSignUpNotification', isSilent);\n  if (!result) {\n    return;\n  }\n\n  global = getGlobal();\n  global = replaceSettings(global, { hasContactJoinedNotifications: !isSilent });\n  setGlobal(global);\n});\n\naddActionHandler('loadLanguages', async (global): Promise<void> => {\n  const result = await callApi('fetchLanguages');\n  if (!result) {\n    return;\n  }\n\n  global = getGlobal();\n  global = {\n    ...global,\n    settings: {\n      ...global.settings,\n      languages: result,\n    },\n  };\n  setGlobal(global);\n});\n\naddActionHandler('loadPrivacySettings', async (global): Promise<void> => {\n  const result = await Promise.all([\n    callApi('fetchPrivacySettings', 'phoneNumber'),\n    callApi('fetchPrivacySettings', 'addByPhone'),\n    callApi('fetchPrivacySettings', 'lastSeen'),\n    callApi('fetchPrivacySettings', 'profilePhoto'),\n    callApi('fetchPrivacySettings', 'forwards'),\n    callApi('fetchPrivacySettings', 'chatInvite'),\n    callApi('fetchPrivacySettings', 'phoneCall'),\n    callApi('fetchPrivacySettings', 'phoneP2P'),\n    callApi('fetchPrivacySettings', 'voiceMessages'),\n    callApi('fetchPrivacySettings', 'bio'),\n    callApi('fetchPrivacySettings', 'birthday'),\n    callApi('fetchPrivacySettings', 'gifts'),\n  ]);\n\n  if (result.some((e) => e === undefined)) {\n    return;\n  }\n\n  const [\n    phoneNumberSettings,\n    addByPhoneSettings,\n    lastSeenSettings,\n    profilePhotoSettings,\n    forwardsSettings,\n    chatInviteSettings,\n    phoneCallSettings,\n    phoneP2PSettings,\n    voiceMessagesSettings,\n    bioSettings,\n    birthdaySettings,\n    giftsSettings,\n  ] = result as {\n    rules: ApiPrivacySettings;\n  }[];\n\n  global = getGlobal();\n  global = {\n    ...global,\n    settings: {\n      ...global.settings,\n      privacy: {\n        ...global.settings.privacy,\n        phoneNumber: phoneNumberSettings.rules,\n        addByPhone: addByPhoneSettings.rules,\n        lastSeen: lastSeenSettings.rules,\n        profilePhoto: profilePhotoSettings.rules,\n        forwards: forwardsSettings.rules,\n        chatInvite: chatInviteSettings.rules,\n        phoneCall: phoneCallSettings.rules,\n        phoneP2P: phoneP2PSettings.rules,\n        voiceMessages: voiceMessagesSettings.rules,\n        bio: bioSettings.rules,\n        birthday: birthdaySettings.rules,\n        gifts: giftsSettings.rules,\n      },\n    },\n  };\n  setGlobal(global);\n});\n\naddActionHandler('setPrivacyVisibility', async (global, actions, payload): Promise<void> => {\n  const { privacyKey, visibility, onSuccess } = payload!;\n\n  if (!global.settings.privacy[privacyKey]) {\n    const result = await callApi('fetchPrivacySettings', privacyKey);\n    if (!result) {\n      return;\n    }\n\n    global = getGlobal();\n    global = {\n      ...global,\n      settings: {\n        ...global.settings,\n        privacy: {\n          ...global.settings.privacy,\n          [privacyKey]: result.rules,\n        },\n      },\n    };\n    setGlobal(global);\n  }\n\n  const {\n    privacy: { [privacyKey]: settings },\n  } = global.settings;\n\n  if (!settings) {\n    return;\n  }\n\n  const rules = buildApiInputPrivacyRules(global, {\n    visibility,\n    allowedIds: [...settings.allowUserIds, ...settings.allowChatIds],\n    blockedIds: [...settings.blockUserIds, ...settings.blockChatIds],\n    botsPrivacy: settings.botsPrivacy,\n  });\n\n  const result = await callApi('setPrivacySettings', privacyKey, rules);\n  if (!result) {\n    return;\n  }\n\n  onSuccess?.();\n\n  global = getGlobal();\n  global = {\n    ...global,\n    settings: {\n      ...global.settings,\n      privacy: {\n        ...global.settings.privacy,\n        [privacyKey]: result.rules,\n      },\n    },\n  };\n  setGlobal(global);\n});\n\naddActionHandler('setPrivacySettings', async (global, actions, payload): Promise<void> => {\n  const {\n    privacyKey, isAllowList, updatedIds, isPremiumAllowed, botsPrivacy,\n  } = payload!;\n  const {\n    privacy: { [privacyKey]: settings },\n  } = global.settings;\n\n  if (!settings) {\n    return;\n  }\n\n  const rules = buildApiInputPrivacyRules(global, {\n    visibility: settings.visibility,\n    isUnspecified: settings.isUnspecified,\n    shouldAllowPremium: isPremiumAllowed,\n    allowedIds: isAllowList ? updatedIds : [...settings.allowUserIds, ...settings.allowChatIds],\n    blockedIds: !isAllowList ? updatedIds : [...settings.blockUserIds, ...settings.blockChatIds],\n    botsPrivacy,\n  });\n\n  const result = await callApi('setPrivacySettings', privacyKey, rules);\n  if (!result) {\n    return;\n  }\n\n  global = getGlobal();\n  global = {\n    ...global,\n    settings: {\n      ...global.settings,\n      privacy: {\n        ...global.settings.privacy,\n        [privacyKey]: result.rules,\n      },\n    },\n  };\n  setGlobal(global);\n});\n\naddActionHandler('updateIsOnline', (global, actions, payload): ActionReturnType => {\n  if (global.connectionState !== 'connectionStateReady') return;\n  callApi('updateIsOnline', payload);\n});\n\naddActionHandler('loadContentSettings', async (global): Promise<void> => {\n  const result = await callApi('fetchContentSettings');\n  if (!result) return;\n\n  global = getGlobal();\n  global = replaceSettings(global, result);\n  setGlobal(global);\n});\n\naddActionHandler('updateContentSettings', async (global, actions, payload): Promise<void> => {\n  global = replaceSettings(global, { isSensitiveEnabled: payload });\n  setGlobal(global);\n\n  const result = await callApi('updateContentSettings', payload);\n  if (!result) {\n    global = getGlobal();\n    global = replaceSettings(global, { isSensitiveEnabled: !payload });\n    setGlobal(global);\n  }\n});\n\naddActionHandler('loadCountryList', async (global, actions, payload): Promise<void> => {\n  let { langCode } = payload;\n  if (!langCode) langCode = global.settings.byKey.language;\n\n  const countryList = await callApi('fetchCountryList', { langCode });\n  if (!countryList) return;\n\n  global = getGlobal();\n  global = {\n    ...global,\n    countryList,\n  };\n  setGlobal(global);\n});\n\naddActionHandler('ensureTimeFormat', async (global, actions): Promise<void> => {\n  if (global.authNearestCountry) {\n    const timeFormat = COUNTRIES_WITH_12H_TIME_FORMAT\n      .has(global.authNearestCountry.toUpperCase()) ? '12h' : '24h';\n    actions.setSettingOption({ timeFormat });\n    setTimeFormat(timeFormat);\n  }\n\n  if (global.settings.byKey.wasTimeFormatSetManually) {\n    return;\n  }\n\n  const nearestCountryCode = await callApi('fetchNearestCountry');\n  if (nearestCountryCode) {\n    const timeFormat = COUNTRIES_WITH_12H_TIME_FORMAT.has(nearestCountryCode.toUpperCase()) ? '12h' : '24h';\n    actions.setSettingOption({ timeFormat });\n    setTimeFormat(timeFormat);\n  }\n});\n\naddActionHandler('loadAppConfig', async (global, actions, payload): Promise<void> => {\n  const hash = payload?.hash;\n\n  const appConfig = await callApi('fetchAppConfig', hash);\n  if (!appConfig) return;\n\n  requestActionTimeout({\n    action: 'loadAppConfig',\n    payload: { hash: appConfig.hash },\n  }, APP_CONFIG_REFETCH_INTERVAL);\n\n  global = getGlobal();\n  global = {\n    ...global,\n    appConfig,\n  };\n  setGlobal(global);\n});\n\naddActionHandler('loadConfig', async (global): Promise<void> => {\n  const config = await callApi('fetchConfig');\n  if (!config) return;\n\n  global = getGlobal();\n  const timeout = config.expiresAt - getServerTime();\n  requestActionTimeout({\n    action: 'loadConfig',\n    payload: undefined,\n  }, timeout * 1000);\n\n  global = {\n    ...global,\n    config,\n  };\n  setGlobal(global);\n});\n\naddActionHandler('loadPeerColors', async (global): Promise<void> => {\n  const hash = global.peerColors?.generalHash;\n  const result = await callApi('fetchPeerColors', hash);\n  if (!result) return;\n\n  global = getGlobal();\n  global = {\n    ...global,\n    peerColors: {\n      ...global.peerColors,\n      general: result.colors,\n      generalHash: result.hash,\n    },\n  };\n  setGlobal(global);\n});\n\naddActionHandler('loadTimezones', async (global): Promise<void> => {\n  const hash = global.timezones?.hash;\n  const result = await callApi('fetchTimezones', hash);\n  if (!result) return;\n\n  global = getGlobal();\n  global = {\n    ...global,\n    timezones: {\n      byId: buildCollectionByKey(result.timezones, 'id'),\n      hash: result.hash,\n    },\n  };\n  setGlobal(global);\n});\n\naddActionHandler('loadGlobalPrivacySettings', async (global): Promise<void> => {\n  const globalSettings = await callApi('fetchGlobalPrivacySettings');\n  if (!globalSettings) {\n    return;\n  }\n\n  global = getGlobal();\n  global = replaceSettings(global, { ...globalSettings });\n  setGlobal(global);\n});\n\naddActionHandler('updateGlobalPrivacySettings', async (global, actions, payload): Promise<void> => {\n  const shouldArchiveAndMuteNewNonContact = payload.shouldArchiveAndMuteNewNonContact\n    ?? Boolean(global.settings.byKey.shouldArchiveAndMuteNewNonContact);\n  const shouldHideReadMarks = payload.shouldHideReadMarks ?? Boolean(global.settings.byKey.shouldHideReadMarks);\n  const shouldNewNonContactPeersRequirePremium = payload.shouldNewNonContactPeersRequirePremium\n    ?? Boolean(global.settings.byKey.shouldNewNonContactPeersRequirePremium);\n\n  global = replaceSettings(global, { shouldArchiveAndMuteNewNonContact, shouldHideReadMarks });\n  setGlobal(global);\n\n  const result = await callApi('updateGlobalPrivacySettings', {\n    shouldArchiveAndMuteNewNonContact,\n    shouldHideReadMarks,\n    shouldNewNonContactPeersRequirePremium,\n  });\n\n  global = getGlobal();\n  global = replaceSettings(global, {\n    shouldArchiveAndMuteNewNonContact: !result\n      ? !shouldArchiveAndMuteNewNonContact\n      : result.shouldArchiveAndMuteNewNonContact,\n    shouldHideReadMarks: !result ? !shouldHideReadMarks : result.shouldHideReadMarks,\n    shouldNewNonContactPeersRequirePremium: !result\n      ? !shouldNewNonContactPeersRequirePremium\n      : result.shouldNewNonContactPeersRequirePremium,\n  });\n  setGlobal(global);\n});\n\naddActionHandler('toggleUsername', async (global, actions, payload): Promise<void> => {\n  const { username, isActive } = payload;\n  const { currentUserId } = global;\n  if (!currentUserId) {\n    return;\n  }\n\n  const currentUser = selectUser(global, currentUserId);\n  if (!currentUser?.usernames) {\n    return;\n  }\n\n  const usernames = currentUser.usernames.map((item) => {\n    if (item.username !== username) {\n      return item;\n    }\n\n    return { ...item, isActive: isActive || undefined };\n  });\n\n  global = updateUser(global, currentUserId, { usernames });\n  setGlobal(global);\n\n  const result = await callApi('toggleUsername', { username, isActive });\n\n  if (!result) {\n    actions.loadFullUser({ userId: currentUserId });\n  }\n});\n\naddActionHandler('toggleChatUsername', async (global, actions, payload): Promise<void> => {\n  const {\n    chatId, username, isActive,\n  } = payload;\n  const chat = selectChat(global, chatId);\n  if (!chat?.usernames) {\n    return;\n  }\n\n  const usernames = chat.usernames.map((item) => {\n    if (item.username !== username) {\n      return item;\n    }\n\n    return { ...item, isActive: isActive || undefined };\n  });\n\n  global = updateChat(global, chatId, { usernames });\n  setGlobal(global);\n\n  const result = await callApi('toggleUsername', {\n    chatId: chat.id,\n    accessHash: chat.accessHash,\n    username,\n    isActive,\n  });\n\n  if (!result) {\n    actions.loadFullChat({ chatId });\n  }\n});\n\naddActionHandler('sortUsernames', async (global, actions, payload): Promise<void> => {\n  const { usernames } = payload;\n  const { currentUserId } = global;\n  if (!currentUserId) {\n    return;\n  }\n\n  const result = await callApi('reorderUsernames', { usernames });\n\n  // After saving the order of usernames, server sends an update with the necessary data,\n  // so there is no need to update the state in this place\n  if (!result) {\n    actions.loadUser({ userId: currentUserId });\n  }\n});\n\naddActionHandler('sortChatUsernames', async (global, actions, payload): Promise<void> => {\n  const { chatId, usernames } = payload;\n  const chat = selectChat(global, chatId);\n  if (!chat) {\n    return;\n  }\n\n  const prevUsernames = [...chat.usernames!];\n  const sortedUsernames = chat.usernames!.reduce((res, currentUsername) => {\n    const idx = usernames.findIndex((username) => username === currentUsername.username);\n    res[idx] = currentUsername;\n\n    return res;\n  }, [] as ApiUsername[]);\n\n  global = updateChat(global, chatId, { usernames: sortedUsernames });\n  setGlobal(global);\n\n  const result = await callApi('reorderUsernames', {\n    chatId: chat.id,\n    accessHash: chat.accessHash,\n    usernames,\n  });\n\n  if (!result) {\n    global = getGlobal();\n    global = updateChat(global, chatId, { usernames: prevUsernames });\n    setGlobal(global);\n  }\n});\n","import type {\n  ApiUpdateAuthorizationError,\n  ApiUpdateAuthorizationState,\n  ApiUpdateConnectionState,\n  ApiUpdateCurrentUser,\n  ApiUpdateServerTimeOffset,\n  ApiUpdateSession,\n} from '../../../api/types';\nimport type { LangCode } from '../../../types';\nimport type { RequiredGlobalActions } from '../../index';\nimport type { ActionReturnType, GlobalState } from '../../types';\n\nimport { SESSION_USER_KEY } from '../../../config';\nimport { getCurrentTabId } from '../../../util/establishMultitabRole';\nimport { getShippingError, shouldClosePaymentModal } from '../../../util/getReadableErrorText';\nimport { unique } from '../../../util/iteratees';\nimport { oldSetLanguage } from '../../../util/oldLangProvider';\nimport { clearWebTokenAuth } from '../../../util/routing';\nimport { setServerTimeOffset } from '../../../util/serverTime';\nimport { forceWebsync } from '../../../util/websync';\nimport { isChatChannel, isChatSuperGroup } from '../../helpers';\nimport {\n  addActionHandler, getGlobal, setGlobal,\n} from '../../index';\nimport { updateUser, updateUserFullInfo } from '../../reducers';\nimport { updateTabState } from '../../reducers/tabs';\nimport { selectTabState } from '../../selectors';\n\naddActionHandler('apiUpdate', (global, actions, update): ActionReturnType => {\n  switch (update['@type']) {\n    case 'updateApiReady':\n      onUpdateApiReady(global);\n      break;\n\n    case 'updateAuthorizationState':\n      onUpdateAuthorizationState(global, update);\n      break;\n\n    case 'updateAuthorizationError':\n      onUpdateAuthorizationError(global, update);\n      break;\n\n    case 'updateWebAuthTokenFailed':\n      onUpdateWebAuthTokenFailed(global);\n      break;\n\n    case 'updateConnectionState':\n      onUpdateConnectionState(global, actions, update);\n      break;\n\n    case 'updateSession':\n      onUpdateSession(global, actions, update);\n      break;\n\n    case 'updateServerTimeOffset':\n      onUpdateServerTimeOffset(update);\n      break;\n\n    case 'updateCurrentUser':\n      onUpdateCurrentUser(global, update);\n      break;\n\n    case 'requestReconnectApi':\n      global = { ...global, isSynced: false };\n      setGlobal(global);\n\n      onUpdateConnectionState(global, actions, {\n        '@type': 'updateConnectionState',\n        connectionState: 'connectionStateConnecting',\n      });\n      actions.initApi();\n      break;\n\n    case 'requestSync':\n      actions.sync();\n      break;\n\n    case 'updateFetchingDifference':\n      global = { ...global, isFetchingDifference: update.isFetching };\n      setGlobal(global);\n      break;\n\n    case 'error': {\n      Object.values(global.byTabId).forEach(({ id: tabId }) => {\n        const paymentShippingError = getShippingError(update.error);\n        if (paymentShippingError) {\n          actions.addPaymentError({ error: paymentShippingError, tabId });\n        } else if (shouldClosePaymentModal(update.error)) {\n          actions.closePaymentModal({ tabId });\n        } else if (actions.showDialog) {\n          actions.showDialog({ data: update.error, tabId });\n        }\n      });\n\n      break;\n    }\n  }\n});\n\nfunction onUpdateApiReady<T extends GlobalState>(global: T) {\n  void oldSetLanguage(global.settings.byKey.language as LangCode);\n}\n\nfunction onUpdateAuthorizationState<T extends GlobalState>(global: T, update: ApiUpdateAuthorizationState) {\n  global = getGlobal();\n\n  const wasAuthReady = global.authState === 'authorizationStateReady';\n  const authState = update.authorizationState;\n\n  global = {\n    ...global,\n    authState,\n    authIsLoading: false,\n  };\n  setGlobal(global);\n\n  global = getGlobal();\n\n  switch (authState) {\n    case 'authorizationStateLoggingOut':\n      void forceWebsync(false);\n\n      global = {\n        ...global,\n        isLoggingOut: true,\n      };\n      setGlobal(global);\n      break;\n    case 'authorizationStateWaitCode':\n      global = {\n        ...global,\n        authIsCodeViaApp: update.isCodeViaApp,\n      };\n      setGlobal(global);\n      break;\n    case 'authorizationStateWaitPassword':\n      global = {\n        ...global,\n        authHint: update.hint,\n      };\n\n      if (update.noReset) {\n        global = {\n          ...global,\n          hasWebAuthTokenPasswordRequired: true,\n        };\n      }\n\n      setGlobal(global);\n      break;\n    case 'authorizationStateWaitQrCode':\n      global = {\n        ...global,\n        authIsLoadingQrCode: false,\n        authQrCode: update.qrCode,\n      };\n      setGlobal(global);\n      break;\n    case 'authorizationStateReady': {\n      if (wasAuthReady) {\n        break;\n      }\n\n      void forceWebsync(true);\n\n      global = {\n        ...global,\n        isLoggingOut: false,\n      };\n      Object.values(global.byTabId).forEach(({ id: tabId }) => {\n        global = updateTabState(global, {\n          isInactive: false,\n        }, tabId);\n      });\n      setGlobal(global);\n\n      break;\n    }\n  }\n}\n\nfunction onUpdateAuthorizationError<T extends GlobalState>(global: T, update: ApiUpdateAuthorizationError) {\n  // TODO: Investigate why TS is not happy with spread for lang related types\n  global = {\n    ...global,\n  };\n  global.authErrorKey = update.errorKey;\n  setGlobal(global);\n}\n\nfunction onUpdateWebAuthTokenFailed<T extends GlobalState>(global: T) {\n  clearWebTokenAuth();\n  global = getGlobal();\n\n  global = {\n    ...global,\n    hasWebAuthTokenFailed: true,\n  };\n  setGlobal(global);\n}\n\nfunction onUpdateConnectionState<T extends GlobalState>(\n  global: T, actions: RequiredGlobalActions, update: ApiUpdateConnectionState,\n) {\n  const { connectionState } = update;\n\n  global = getGlobal();\n  const tabState = selectTabState(global, getCurrentTabId());\n  if (connectionState === 'connectionStateReady' && tabState.isMasterTab && tabState.multitabNextAction) {\n    // @ts-ignore\n    actions[tabState.multitabNextAction.action](tabState.multitabNextAction.payload);\n    actions.clearMultitabNextAction({ tabId: tabState.id });\n  }\n\n  if (connectionState === global.connectionState) {\n    return;\n  }\n\n  global = {\n    ...global,\n    connectionState,\n  };\n  setGlobal(global);\n\n  if (global.isSynced) {\n    const channelStackIds = Object.values(global.byTabId)\n      .flatMap((tab) => tab.messageLists)\n      .map((messageList) => messageList.chatId)\n      .filter((chatId) => {\n        const chat = global.chats.byId[chatId];\n        return chat && (isChatChannel(chat) || isChatSuperGroup(chat));\n      });\n    if (connectionState === 'connectionStateReady' && channelStackIds.length) {\n      unique(channelStackIds).forEach((chatId) => {\n        actions.requestChannelDifference({ chatId });\n      });\n    }\n  }\n\n  if (connectionState === 'connectionStateBroken') {\n    actions.signOut({ forceInitApi: true });\n  }\n}\n\nfunction onUpdateSession<T extends GlobalState>(global: T, actions: RequiredGlobalActions, update: ApiUpdateSession) {\n  const { sessionData } = update;\n  const { authRememberMe, authState } = global;\n  const isEmpty = !sessionData || !sessionData.mainDcId;\n\n  const isTest = sessionData?.isTest;\n  if (isTest) {\n    global = {\n      ...global,\n      config: {\n        ...global.config,\n        isTestServer: isTest,\n      },\n    };\n    setGlobal(global);\n  }\n\n  if (!authRememberMe || authState !== 'authorizationStateReady' || isEmpty) {\n    return;\n  }\n\n  actions.saveSession({ sessionData });\n}\n\nfunction onUpdateServerTimeOffset(update: ApiUpdateServerTimeOffset) {\n  setServerTimeOffset(update.serverTimeOffset);\n}\n\nfunction onUpdateCurrentUser<T extends GlobalState>(global: T, update: ApiUpdateCurrentUser) {\n  const { currentUser, currentUserFullInfo } = update;\n\n  global = {\n    ...updateUser(global, currentUser.id, currentUser),\n    currentUserId: currentUser.id,\n  };\n  global = updateUserFullInfo(global, currentUser.id, currentUserFullInfo);\n  setGlobal(global);\n\n  updateSessionUserId(currentUser.id);\n}\n\nfunction updateSessionUserId(currentUserId: string) {\n  const sessionUserAuth = localStorage.getItem(SESSION_USER_KEY);\n  if (!sessionUserAuth) return;\n\n  const userAuth = JSON.parse(sessionUserAuth);\n  userAuth.id = currentUserId;\n\n  localStorage.setItem(SESSION_USER_KEY, JSON.stringify(userAuth));\n}\n","import { addCallback } from '../../../lib/teact/teactn';\n\nimport type { LangCode } from '../../../types';\nimport type { ActionReturnType, GlobalState } from '../../types';\n\nimport { requestMutation } from '../../../lib/fasterdom/fasterdom';\nimport { getCurrentTabId } from '../../../util/establishMultitabRole';\nimport { subscribe, unsubscribe } from '../../../util/notifications';\nimport { oldSetLanguage } from '../../../util/oldLangProvider';\nimport { decryptSessionByCurrentHash } from '../../../util/passcode';\nimport { applyPerformanceSettings } from '../../../util/perfomanceSettings';\nimport { hasStoredSession, storeSession } from '../../../util/sessions';\nimport switchTheme from '../../../util/switchTheme';\nimport { getSystemTheme, setSystemThemeChangeCallback } from '../../../util/systemTheme';\nimport { startWebsync, stopWebsync } from '../../../util/websync';\nimport {\n  IS_ANDROID, IS_ELECTRON, IS_IOS, IS_LINUX,\n  IS_MAC_OS, IS_SAFARI, IS_TOUCH_ENV, IS_WINDOWS,\n} from '../../../util/windowEnvironment';\nimport { callApi } from '../../../api/gramjs';\nimport { clearCaching, setupCaching } from '../../cache';\nimport { addActionHandler, getGlobal, setGlobal } from '../../index';\nimport { replaceSettings } from '../../reducers';\nimport { updateTabState } from '../../reducers/tabs';\nimport {\n  selectCanAnimateInterface,\n  selectPerformanceSettings,\n  selectSettingsKeys,\n  selectTabState,\n  selectTheme,\n} from '../../selectors';\n\nconst HISTORY_ANIMATION_DURATION = 450;\n\nsetSystemThemeChangeCallback((theme) => {\n  // eslint-disable-next-line eslint-multitab-tt/no-immediate-global\n  let global = getGlobal();\n\n  if (!global.isInited || !global.settings.byKey.shouldUseSystemTheme) return;\n\n  global = replaceSettings(global, { theme });\n  setGlobal(global);\n});\n\naddActionHandler('switchMultitabRole', async (global, actions, payload): Promise<void> => {\n  const { isMasterTab, tabId = getCurrentTabId() } = payload;\n\n  if (isMasterTab === selectTabState(global, tabId).isMasterTab) {\n    callApi('broadcastLocalDbUpdateFull');\n    return;\n  }\n\n  global = updateTabState(global, {\n    isMasterTab,\n  }, tabId);\n  setGlobal(global, { forceSyncOnIOs: true });\n\n  if (!isMasterTab) {\n    void unsubscribe();\n    actions.destroyConnection();\n    stopWebsync();\n    clearCaching();\n    actions.onSomeTabSwitchedMultitabRole();\n  } else {\n    if (global.passcode.hasPasscode && !global.passcode.isScreenLocked) {\n      const { sessionJson } = await decryptSessionByCurrentHash();\n      const session = JSON.parse(sessionJson);\n      storeSession(session, session.userId);\n    }\n\n    if (hasStoredSession()) {\n      setupCaching();\n    }\n\n    global = getGlobal();\n    if (!global.passcode.hasPasscode || !global.passcode.isScreenLocked) {\n      if (global.connectionState === 'connectionStateReady') {\n        global = {\n          ...global,\n          connectionState: 'connectionStateConnecting',\n        };\n        setGlobal(global);\n      }\n      actions.initApi();\n    }\n\n    startWebsync();\n  }\n});\n\naddActionHandler('onSomeTabSwitchedMultitabRole', async (global): Promise<void> => {\n  if (global.passcode.hasPasscode && !global.passcode.isScreenLocked) {\n    const { sessionJson } = await decryptSessionByCurrentHash();\n    const session = JSON.parse(sessionJson);\n    storeSession(session, session.userId);\n  }\n\n  callApi('broadcastLocalDbUpdateFull');\n});\n\naddActionHandler('initShared', (): ActionReturnType => {\n  startWebsync();\n});\n\naddActionHandler('initMain', (global): ActionReturnType => {\n  const { hasWebNotifications, hasPushNotifications } = selectSettingsKeys(global);\n  if (hasWebNotifications && hasPushNotifications) {\n    // Most of the browsers only show the notifications permission prompt after the first user gesture.\n    const events = ['click', 'keypress'];\n    const subscribeAfterUserGesture = () => {\n      void subscribe();\n      events.forEach((event) => {\n        document.removeEventListener(event, subscribeAfterUserGesture);\n      });\n    };\n    events.forEach((event) => {\n      document.addEventListener(event, subscribeAfterUserGesture, { once: true });\n    });\n  }\n});\n\naddCallback((global: GlobalState) => {\n  let isUpdated = false;\n  const tabState = selectTabState(global, getCurrentTabId());\n  if (!tabState?.shouldInit) return;\n\n  global = getGlobal();\n\n  global = updateTabState(global, {\n    shouldInit: false,\n  }, tabState.id);\n\n  const { messageTextSize, language } = global.settings.byKey;\n\n  const globalTheme = selectTheme(global);\n  const systemTheme = getSystemTheme();\n  const theme = global.settings.byKey.shouldUseSystemTheme ? systemTheme : globalTheme;\n\n  const performanceType = selectPerformanceSettings(global);\n\n  void oldSetLanguage(language as LangCode, undefined, true);\n\n  requestMutation(() => {\n    document.documentElement.style.setProperty(\n      '--composer-text-size', `${Math.max(messageTextSize, IS_IOS ? 16 : 15)}px`,\n    );\n    document.documentElement.style.setProperty('--message-meta-height', `${Math.floor(messageTextSize * 1.3125)}px`);\n    document.documentElement.style.setProperty('--message-text-size', `${messageTextSize}px`);\n    document.documentElement.setAttribute('data-message-text-size', messageTextSize.toString());\n    document.body.classList.add('initial');\n    document.body.classList.add(IS_TOUCH_ENV ? 'is-touch-env' : 'is-pointer-env');\n    applyPerformanceSettings(performanceType);\n\n    if (IS_IOS) {\n      document.body.classList.add('is-ios');\n    } else if (IS_ANDROID) {\n      document.body.classList.add('is-android');\n    } else if (IS_MAC_OS) {\n      document.body.classList.add('is-macos');\n    } else if (IS_WINDOWS) {\n      document.body.classList.add('is-windows');\n    } else if (IS_LINUX) {\n      document.body.classList.add('is-linux');\n    }\n    if (IS_SAFARI) {\n      document.body.classList.add('is-safari');\n    }\n    if (IS_ELECTRON) {\n      document.body.classList.add('is-electron');\n    }\n  });\n\n  const canAnimate = selectCanAnimateInterface(global);\n\n  switchTheme(theme, canAnimate);\n  // Make sure global has the latest theme. Will cause `switchTheme` on change\n  global = replaceSettings(global, { theme });\n\n  startWebsync();\n\n  isUpdated = true;\n\n  if (isUpdated) setGlobal(global);\n});\n\naddActionHandler('setInstallPrompt', (global, actions, payload): ActionReturnType => {\n  const { canInstall, tabId = getCurrentTabId() } = payload;\n  return updateTabState(global, {\n    canInstall,\n  }, tabId);\n});\n\naddActionHandler('setIsUiReady', (global, actions, payload): ActionReturnType => {\n  const { uiReadyState, tabId = getCurrentTabId() } = payload!;\n\n  if (uiReadyState === 2) {\n    requestMutation(() => {\n      document.body.classList.remove('initial');\n    });\n  }\n\n  return updateTabState(global, {\n    uiReadyState,\n  }, tabId);\n});\n\naddActionHandler('setAuthPhoneNumber', (global, actions, payload): ActionReturnType => {\n  const { phoneNumber } = payload!;\n\n  return {\n    ...global,\n    authPhoneNumber: phoneNumber,\n  };\n});\n\naddActionHandler('setAuthRememberMe', (global, actions, payload): ActionReturnType => {\n  return {\n    ...global,\n    authRememberMe: Boolean(payload),\n  };\n});\n\naddActionHandler('clearAuthErrorKey', (global): ActionReturnType => {\n  return {\n    ...global,\n    authErrorKey: undefined,\n  };\n});\n\naddActionHandler('disableHistoryAnimations', (global, actions, payload): ActionReturnType => {\n  const { tabId = getCurrentTabId() } = payload || {};\n\n  setTimeout(() => {\n    global = getGlobal();\n    global = updateTabState(global, {\n      shouldSkipHistoryAnimations: false,\n    }, tabId);\n    setGlobal(global);\n\n    requestMutation(() => {\n      document.body.classList.remove('no-animate');\n    });\n  }, HISTORY_ANIMATION_DURATION);\n\n  global = updateTabState(global, {\n    shouldSkipHistoryAnimations: true,\n  }, tabId);\n  setGlobal(global, { forceSyncOnIOs: true });\n});\n","import { addCallback } from '../../../lib/teact/teactn';\n\nimport type { ActionReturnType, GlobalState } from '../../types';\nimport { type LangCode, SettingsScreens } from '../../../types';\n\nimport { requestMutation } from '../../../lib/fasterdom/fasterdom';\nimport { disableDebugConsole, initDebugConsole } from '../../../util/debugConsole';\nimport { getCurrentTabId } from '../../../util/establishMultitabRole';\nimport { oldSetLanguage, setTimeFormat } from '../../../util/oldLangProvider';\nimport { applyPerformanceSettings } from '../../../util/perfomanceSettings';\nimport switchTheme from '../../../util/switchTheme';\nimport { updatePeerColors } from '../../../util/theme';\nimport { IS_IOS } from '../../../util/windowEnvironment';\nimport { callApi, setShouldEnableDebugLog } from '../../../api/gramjs';\nimport {\n  addActionHandler, getActions, getGlobal, setGlobal,\n} from '../../index';\nimport { replaceSettings, replaceThemeSettings } from '../../reducers';\nimport { updateTabState } from '../../reducers/tabs';\nimport { selectCanAnimateInterface, selectChatFolder } from '../../selectors';\n\nlet prevGlobal: GlobalState | undefined;\n\naddCallback((global: GlobalState) => {\n  // eslint-disable-next-line eslint-multitab-tt/no-getactions-in-actions\n  const { updatePageTitle, updateShouldDebugExportedSenders, updateShouldEnableDebugLog } = getActions();\n\n  const oldGlobal = prevGlobal;\n  prevGlobal = global;\n\n  if (!oldGlobal) return;\n\n  const settings = global.settings.byKey;\n  const prevSettings = oldGlobal.settings.byKey;\n  const performance = global.settings.performance;\n  const prevPerformance = oldGlobal.settings.performance;\n  const peerColors = global.peerColors;\n  const prevPeerColors = oldGlobal.peerColors;\n\n  if (peerColors && peerColors !== prevPeerColors) {\n    updatePeerColors(peerColors.general);\n  }\n\n  if (performance !== prevPerformance) {\n    requestMutation(() => {\n      applyPerformanceSettings(performance);\n    });\n  }\n\n  if (settings.theme !== prevSettings.theme) {\n    const withAnimation = document.hasFocus() ? selectCanAnimateInterface(global) : false;\n    switchTheme(settings.theme, withAnimation);\n  }\n\n  if (settings.language !== prevSettings.language) {\n    oldSetLanguage(settings.language as LangCode);\n  }\n\n  if (settings.timeFormat !== prevSettings.timeFormat) {\n    setTimeFormat(settings.timeFormat);\n  }\n\n  if (settings.messageTextSize !== prevSettings.messageTextSize) {\n    document.documentElement.style.setProperty(\n      '--composer-text-size', `${Math.max(settings.messageTextSize, IS_IOS ? 16 : 15)}px`,\n    );\n    document.documentElement.style.setProperty('--message-meta-height',\n      `${Math.floor(settings.messageTextSize * 1.3125)}px`);\n    document.documentElement.style.setProperty('--message-text-size', `${settings.messageTextSize}px`);\n    document.documentElement.setAttribute('data-message-text-size', settings.messageTextSize.toString());\n  }\n\n  if (settings.canDisplayChatInTitle !== prevSettings.canDisplayChatInTitle) {\n    updatePageTitle();\n  }\n\n  if (settings.shouldForceHttpTransport !== prevSettings.shouldForceHttpTransport) {\n    callApi('setForceHttpTransport', Boolean(settings.shouldForceHttpTransport));\n  }\n\n  if (settings.shouldAllowHttpTransport !== prevSettings.shouldAllowHttpTransport) {\n    callApi('setAllowHttpTransport', Boolean(settings.shouldAllowHttpTransport));\n    if (!settings.shouldAllowHttpTransport && settings.shouldForceHttpTransport) {\n      global = getGlobal();\n      global = {\n        ...global,\n        settings: {\n          ...global.settings,\n          byKey: {\n            ...global.settings.byKey,\n            shouldForceHttpTransport: false,\n          },\n        },\n      };\n      setGlobal(global);\n    }\n  }\n\n  if (settings.shouldDebugExportedSenders !== prevSettings.shouldDebugExportedSenders) {\n    updateShouldDebugExportedSenders();\n  }\n\n  if (settings.shouldCollectDebugLogs !== prevSettings.shouldCollectDebugLogs) {\n    updateShouldEnableDebugLog();\n  }\n});\n\naddActionHandler('updateShouldEnableDebugLog', (global): ActionReturnType => {\n  const { settings } = global;\n\n  if (settings.byKey.shouldCollectDebugLogs) {\n    setShouldEnableDebugLog(true);\n    initDebugConsole();\n  } else {\n    setShouldEnableDebugLog(false);\n    disableDebugConsole();\n  }\n});\n\naddActionHandler('updateShouldDebugExportedSenders', (global): ActionReturnType => {\n  const { settings } = global;\n  callApi('setShouldDebugExportedSenders', Boolean(settings.byKey.shouldDebugExportedSenders));\n});\n\naddActionHandler('setSettingOption', (global, actions, payload): ActionReturnType => {\n  return replaceSettings(global, payload);\n});\n\naddActionHandler('updatePerformanceSettings', (global, actions, payload): ActionReturnType => {\n  global = {\n    ...global,\n    settings: {\n      ...global.settings,\n      performance: {\n        ...global.settings.performance,\n        ...payload,\n      },\n    },\n  };\n\n  return global;\n});\n\naddActionHandler('setThemeSettings', (global, actions, payload): ActionReturnType => {\n  const { theme, ...settings } = payload;\n\n  return replaceThemeSettings(global, theme, settings);\n});\n\naddActionHandler('requestNextSettingsScreen', (global, actions, payload): ActionReturnType => {\n  const { screen, foldersAction, tabId = getCurrentTabId() } = payload;\n  return updateTabState(global, {\n    nextSettingsScreen: screen,\n    nextFoldersAction: foldersAction,\n  }, tabId);\n});\n\naddActionHandler('openEditChatFolder', (global, actions, payload): ActionReturnType => {\n  const { folderId, isOnlyInvites, tabId = getCurrentTabId() } = payload;\n\n  const chatFolder = selectChatFolder(global, folderId);\n  if (!chatFolder) return;\n\n  actions.requestNextSettingsScreen({\n    screen: isOnlyInvites ? SettingsScreens.FoldersEditFolderInvites : SettingsScreens.FoldersEditFolderFromChatList,\n    foldersAction: {\n      type: 'editFolder',\n      payload: chatFolder,\n    },\n    tabId,\n  });\n});\n\naddActionHandler('openShareChatFolderModal', (global, actions, payload): ActionReturnType => {\n  const {\n    folderId, url, noRequestNextScreen, tabId = getCurrentTabId(),\n  } = payload;\n\n  const chatFolder = selectChatFolder(global, folderId);\n  const isChatList = chatFolder?.isChatList;\n  if (isChatList && !noRequestNextScreen) {\n    actions.openEditChatFolder({ folderId, isOnlyInvites: true, tabId });\n    return undefined;\n  }\n\n  if (!noRequestNextScreen) actions.requestNextSettingsScreen({ screen: SettingsScreens.FoldersShare, tabId });\n\n  return updateTabState(global, {\n    shareFolderScreen: {\n      folderId,\n      isFromSettings: Boolean(noRequestNextScreen),\n      url,\n    },\n  }, tabId);\n});\n\naddActionHandler('closeShareChatFolderModal', (global, actions, payload): ActionReturnType => {\n  const { tabId = getCurrentTabId() } = payload || {};\n\n  actions.requestNextSettingsScreen({ screen: undefined, tabId });\n\n  return updateTabState(global, {\n    shareFolderScreen: undefined,\n  }, tabId);\n});\n","/* eslint-disable eslint-multitab-tt/no-immediate-global */\nimport { getIsHeavyAnimating, onFullyIdle } from '../lib/teact/teact';\nimport { addCallback, removeCallback } from '../lib/teact/teactn';\n\nimport type {\n  ApiAvailableReaction,\n  ApiMessage,\n} from '../api/types';\nimport type { MessageList, ThreadId } from '../types';\nimport type { ActionReturnType, GlobalState } from './types';\nimport { MAIN_THREAD_ID } from '../api/types';\n\nimport {\n  ALL_FOLDER_ID,\n  ANIMATION_LEVEL_MED,\n  ANIMATION_LEVEL_MIN,\n  ARCHIVED_FOLDER_ID,\n  DEBUG,\n  DEFAULT_LIMITS,\n  GLOBAL_STATE_CACHE_ARCHIVED_CHAT_LIST_LIMIT,\n  GLOBAL_STATE_CACHE_CHAT_LIST_LIMIT,\n  GLOBAL_STATE_CACHE_CUSTOM_EMOJI_LIMIT,\n  GLOBAL_STATE_CACHE_DISABLED,\n  GLOBAL_STATE_CACHE_KEY,\n  GLOBAL_STATE_CACHE_USER_LIST_LIMIT,\n  IS_SCREEN_LOCKED_CACHE_KEY,\n  SAVED_FOLDER_ID,\n} from '../config';\nimport { MAIN_IDB_STORE } from '../util/browser/idb';\nimport { getOrderedIds } from '../util/folderManager';\nimport {\n  compact, pick, pickTruthy, unique,\n} from '../util/iteratees';\nimport { encryptSession } from '../util/passcode';\nimport { onBeforeUnload, throttle } from '../util/schedulers';\nimport { hasStoredSession } from '../util/sessions';\nimport { isUserId } from './helpers';\nimport { addActionHandler, getGlobal } from './index';\nimport { INITIAL_GLOBAL_STATE, INITIAL_PERFORMANCE_STATE_MID, INITIAL_PERFORMANCE_STATE_MIN } from './initialState';\nimport { clearGlobalForLockScreen } from './reducers';\nimport {\n  selectChatLastMessageId,\n  selectChatMessages,\n  selectCurrentMessageList,\n  selectTopics,\n  selectViewportIds,\n  selectVisibleUsers,\n} from './selectors';\n\nimport { getIsMobile } from '../hooks/useAppLayout';\n\nconst UPDATE_THROTTLE = 5000;\n\nconst updateCacheThrottled = throttle(() => onFullyIdle(() => updateCache()), UPDATE_THROTTLE, false);\nconst updateCacheForced = () => updateCache(true);\n\nlet isCaching = false;\nlet isRemovingCache = false;\nlet unsubscribeFromBeforeUnload: NoneToVoidFunction | undefined;\n\nexport function cacheGlobal(global: GlobalState) {\n  return MAIN_IDB_STORE.set(GLOBAL_STATE_CACHE_KEY, global);\n}\n\nexport function loadCachedGlobal() {\n  return MAIN_IDB_STORE.get<GlobalState>(GLOBAL_STATE_CACHE_KEY);\n}\n\nexport function removeGlobalFromCache() {\n  return MAIN_IDB_STORE.del(GLOBAL_STATE_CACHE_KEY);\n}\n\nfunction cacheIsScreenLocked(global: GlobalState) {\n  if (global?.passcode?.isScreenLocked) localStorage.setItem(IS_SCREEN_LOCKED_CACHE_KEY, 'true');\n}\n\nexport function initCache() {\n  if (GLOBAL_STATE_CACHE_DISABLED) {\n    return;\n  }\n\n  const resetCache = () => {\n    isRemovingCache = true;\n    removeGlobalFromCache().finally(() => {\n      localStorage.removeItem(IS_SCREEN_LOCKED_CACHE_KEY);\n      isRemovingCache = false;\n      if (!isCaching) {\n        return;\n      }\n\n      clearCaching();\n    });\n  };\n\n  addActionHandler('saveSession', (): ActionReturnType => {\n    if (isCaching) {\n      return;\n    }\n\n    setupCaching();\n    updateCacheForced();\n  });\n\n  addActionHandler('reset', resetCache);\n}\n\nexport async function loadCache(initialState: GlobalState): Promise<GlobalState | undefined> {\n  if (GLOBAL_STATE_CACHE_DISABLED) {\n    return undefined;\n  }\n\n  const cache = await readCache(initialState);\n\n  if (cache.passcode.hasPasscode || hasStoredSession()) {\n    setupCaching();\n\n    return cache;\n  } else {\n    clearCaching();\n\n    return undefined;\n  }\n}\n\nexport function setupCaching() {\n  isCaching = true;\n  unsubscribeFromBeforeUnload = onBeforeUnload(updateCacheForced, true);\n  window.addEventListener('blur', updateCacheForced);\n  addCallback(updateCacheThrottled);\n}\n\nexport function clearCaching() {\n  isCaching = false;\n  removeCallback(updateCacheThrottled);\n  window.removeEventListener('blur', updateCacheForced);\n  if (unsubscribeFromBeforeUnload) {\n    unsubscribeFromBeforeUnload();\n  }\n}\n\nasync function readCache(initialState: GlobalState): Promise<GlobalState> {\n  if (DEBUG) {\n    // eslint-disable-next-line no-console\n    console.time('global-state-cache-read');\n  }\n\n  const json = localStorage.getItem(GLOBAL_STATE_CACHE_KEY);\n  const cachedFromLocalStorage = json ? JSON.parse(json) as GlobalState : undefined;\n  if (cachedFromLocalStorage) localStorage.removeItem(GLOBAL_STATE_CACHE_KEY);\n\n  const cached = cachedFromLocalStorage || await loadCachedGlobal();\n\n  if (DEBUG) {\n    // eslint-disable-next-line no-console\n    console.timeEnd('global-state-cache-read');\n  }\n\n  if (cached) {\n    migrateCache(cached, initialState);\n  }\n\n  const newState = {\n    ...initialState,\n    ...cached,\n  };\n\n  return newState;\n}\n\nexport function migrateCache(cached: GlobalState, initialState: GlobalState) {\n  try {\n    unsafeMigrateCache(cached, initialState);\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.error(err);\n  }\n}\n\nfunction unsafeMigrateCache(cached: GlobalState, initialState: GlobalState) {\n  const untypedCached = cached as any;\n  // Pre-fill settings with defaults\n  cached.settings.byKey = {\n    ...initialState.settings.byKey,\n    ...cached.settings.byKey,\n  };\n\n  cached.settings.themes = {\n    ...initialState.settings.themes,\n    ...cached.settings.themes,\n  };\n\n  cached.chatFolders = {\n    ...initialState.chatFolders,\n    ...cached.chatFolders,\n  };\n\n  if (!cached.settings.performance) {\n    if (cached.settings.byKey.animationLevel === ANIMATION_LEVEL_MIN) {\n      cached.settings.performance = INITIAL_PERFORMANCE_STATE_MIN;\n    } else if (cached.settings.byKey.animationLevel === ANIMATION_LEVEL_MED) {\n      cached.settings.performance = INITIAL_PERFORMANCE_STATE_MID;\n    } else {\n      cached.settings.performance = initialState.settings.performance;\n    }\n  }\n\n  cached.settings.performance = {\n    ...initialState.settings.performance,\n    ...cached.settings.performance,\n  };\n\n  if (cached.appConfig && !cached.appConfig.limits) {\n    cached.appConfig.limits = DEFAULT_LIMITS;\n  }\n\n  if (!cached.chats.similarChannelsById) {\n    cached.chats.similarChannelsById = initialState.chats.similarChannelsById;\n  }\n\n  if (!cached.chats.similarBotsById) {\n    cached.chats.similarBotsById = initialState.chats.similarBotsById;\n  }\n\n  if (!cached.chats.lastMessageIds) {\n    cached.chats.lastMessageIds = initialState.chats.lastMessageIds;\n  }\n\n  // Clear old color storage to optimize cache size\n  if (untypedCached?.appConfig?.peerColors) {\n    untypedCached.appConfig.peerColors = undefined;\n    untypedCached.appConfig.darkPeerColors = undefined;\n  }\n\n  if (!cached.fileUploads.byMessageKey) {\n    cached.fileUploads.byMessageKey = {};\n  }\n\n  if (!cached.reactions) {\n    cached.reactions = initialState.reactions;\n  }\n\n  if (!cached.quickReplies) {\n    cached.quickReplies = initialState.quickReplies;\n  }\n\n  if (!cached.users.previewMediaByBotId) {\n    cached.users.previewMediaByBotId = initialState.users.previewMediaByBotId;\n  }\n  if (!cached.chats.loadingParameters) {\n    cached.chats.loadingParameters = initialState.chats.loadingParameters;\n  }\n  if (!cached.topBotApps) {\n    cached.topBotApps = initialState.topBotApps;\n  }\n\n  if (!cached.reactions.defaultTags?.[0]?.type) {\n    cached.reactions = initialState.reactions;\n  }\n\n  if (!cached.users.commonChatsById) {\n    cached.users.commonChatsById = initialState.users.commonChatsById;\n  }\n  if (!cached.users.botAppPermissionsById) {\n    cached.users.botAppPermissionsById = initialState.users.botAppPermissionsById;\n  }\n  if (!cached.chats.topicsInfoById) {\n    cached.chats.topicsInfoById = initialState.chats.topicsInfoById;\n  }\n\n  if (!cached.messages.pollById) {\n    cached.messages.pollById = initialState.messages.pollById;\n  }\n  if (!cached.settings.botVerificationShownPeerIds) {\n    cached.settings.botVerificationShownPeerIds = initialState.settings.botVerificationShownPeerIds;\n  }\n\n  if (!cached.peers) {\n    cached.peers = initialState.peers;\n  }\n\n  if (!cached.cacheVersion) {\n    cached.cacheVersion = initialState.cacheVersion;\n    // Reset because of the new action message structure\n    cached.messages = initialState.messages;\n    cached.chats.listIds = initialState.chats.listIds;\n  }\n\n  if (!cached.messages.playbackByChatId) {\n    cached.messages.playbackByChatId = initialState.messages.playbackByChatId;\n  }\n\n  if (cached.cacheVersion < 2) {\n    if (cached.settings.themes.dark) {\n      cached.settings.themes.dark.patternColor = initialState.settings.themes.dark!.patternColor;\n    }\n\n    if (cached.settings.themes.light) {\n      cached.settings.themes.light.patternColor = initialState.settings.themes.light!.patternColor;\n    }\n\n    cached.cacheVersion = 2;\n  }\n\n  if (!cached.chats.notifyExceptionById) {\n    cached.chats.notifyExceptionById = initialState.chats.notifyExceptionById;\n  }\n}\n\nfunction updateCache(force?: boolean) {\n  const global = getGlobal();\n  if (isRemovingCache || !isCaching || global.isLoggingOut || (!force && getIsHeavyAnimating())) {\n    return;\n  }\n\n  forceUpdateCache();\n}\n\nexport function forceUpdateCache(noEncrypt = false) {\n  const global = getGlobal();\n  const { hasPasscode, isScreenLocked } = global.passcode;\n\n  if (hasPasscode) {\n    if (!isScreenLocked && !noEncrypt) {\n      const serializedGlobal = serializeGlobal(global);\n      void encryptSession(undefined, serializedGlobal);\n    }\n\n    cacheIsScreenLocked(global);\n    cacheGlobal(clearGlobalForLockScreen(global, false));\n    return;\n  }\n\n  cacheIsScreenLocked(global);\n  cacheGlobal(reduceGlobal(global));\n}\n\nfunction reduceGlobal<T extends GlobalState>(global: T) {\n  const reducedGlobal: GlobalState = {\n    ...INITIAL_GLOBAL_STATE,\n    ...pick(global, [\n      'appConfig',\n      'config',\n      'authState',\n      'authPhoneNumber',\n      'authRememberMe',\n      'authNearestCountry',\n      'attachMenu',\n      'currentUserId',\n      'contactList',\n      'topPeers',\n      'topInlineBots',\n      'topBotApps',\n      'recentEmojis',\n      'recentCustomEmojis',\n      'push',\n      'serviceNotifications',\n      'attachmentSettings',\n      'leftColumnWidth',\n      'archiveSettings',\n      'mediaViewer',\n      'audioPlayer',\n      'shouldShowContextMenuHint',\n      'trustedBotIds',\n      'recentlyFoundChatIds',\n      'peerColors',\n      'savedReactionTags',\n      'timezones',\n      'availableEffectById',\n    ]),\n    lastIsChatInfoShown: !getIsMobile() ? global.lastIsChatInfoShown : undefined,\n    customEmojis: reduceCustomEmojis(global),\n    users: reduceUsers(global),\n    chats: reduceChats(global),\n    messages: reduceMessages(global),\n    settings: reduceSettings(global),\n    chatFolders: reduceChatFolders(global),\n    groupCalls: reduceGroupCalls(global),\n    reactions: {\n      ...pick(global.reactions, [\n        'defaultTags',\n        'recentReactions',\n        'topReactions',\n        'effectReactions',\n        'hash',\n      ]),\n      availableReactions: reduceAvailableReactions(global.reactions.availableReactions),\n    },\n    passcode: pick(global.passcode, [\n      'isScreenLocked',\n      'hasPasscode',\n      'invalidAttemptsCount',\n      'timeoutUntil',\n    ]),\n  };\n\n  return reducedGlobal;\n}\n\nexport function serializeGlobal<T extends GlobalState>(global: T) {\n  return JSON.stringify(reduceGlobal(global));\n}\n\nfunction reduceCustomEmojis<T extends GlobalState>(global: T): GlobalState['customEmojis'] {\n  const { lastRendered, byId } = global.customEmojis;\n  const idsToSave = lastRendered.slice(0, GLOBAL_STATE_CACHE_CUSTOM_EMOJI_LIMIT);\n  const byIdToSave = pick(byId, idsToSave);\n\n  return {\n    byId: byIdToSave,\n    lastRendered: idsToSave,\n    forEmoji: {},\n    added: {},\n    statusRecent: {},\n  };\n}\n\nfunction reduceUsers<T extends GlobalState>(global: T): GlobalState['users'] {\n  const {\n    users: {\n      byId, statusesById, fullInfoById, botAppPermissionsById,\n    }, currentUserId,\n  } = global;\n  const currentChatIds = compact(\n    Object.values(global.byTabId)\n      .map(({ id: tabId }) => selectCurrentMessageList(global, tabId)),\n  ).map(({ chatId }) => chatId).filter((chatId) => isUserId(chatId));\n\n  const visibleUserIds = unique(compact(Object.values(global.byTabId)\n    .flatMap(({ id: tabId }) => selectVisibleUsers(global, tabId)?.map((u) => u.id) || [])));\n\n  const chatStoriesUserIds = currentChatIds\n    .flatMap((chatId) => Object.values(selectChatMessages(global, chatId) || {}))\n    .map((message) => message.content.storyData?.peerId || message.content.webPage?.story?.peerId)\n    .filter((id): id is string => Boolean(id) && isUserId(id));\n\n  const attachBotIds = Object.keys(global.attachMenu?.bots || {});\n\n  const idsToSave = unique([\n    ...currentUserId ? [currentUserId] : [],\n    ...currentChatIds,\n    ...chatStoriesUserIds,\n    ...visibleUserIds || [],\n    ...attachBotIds,\n    ...global.topPeers.userIds || [],\n    ...global.recentlyFoundChatIds?.filter(isUserId) || [],\n    ...getOrderedIds(ARCHIVED_FOLDER_ID)?.slice(0, GLOBAL_STATE_CACHE_ARCHIVED_CHAT_LIST_LIMIT).filter(isUserId) || [],\n    ...getOrderedIds(ALL_FOLDER_ID)?.filter(isUserId) || [],\n    ...global.contactList?.userIds || [],\n    ...Object.keys(byId),\n  ]).slice(0, GLOBAL_STATE_CACHE_USER_LIST_LIMIT);\n\n  return {\n    ...INITIAL_GLOBAL_STATE.users,\n    byId: pickTruthy(byId, idsToSave),\n    statusesById: pickTruthy(statusesById, idsToSave),\n    fullInfoById: pickTruthy(fullInfoById, idsToSave),\n    botAppPermissionsById,\n  };\n}\n\nfunction reduceChats<T extends GlobalState>(global: T): GlobalState['chats'] {\n  const { chats: { byId }, currentUserId } = global;\n  const currentChatIds = compact(\n    Object.values(global.byTabId)\n      .map(({ id: tabId }): MessageList | undefined => {\n        return selectCurrentMessageList(global, tabId);\n      }),\n  ).map(({ chatId }) => chatId);\n\n  const messagesChatIds = compact(Object.values(global.byTabId).flatMap(({ id: tabId }) => {\n    const messageList = selectCurrentMessageList(global, tabId);\n    if (!messageList) return undefined;\n\n    const messages = selectChatMessages(global, messageList.chatId);\n    const viewportIds = selectViewportIds(global, messageList.chatId, messageList.threadId, tabId);\n    return viewportIds?.map((id) => {\n      const message = messages[id];\n      if (!message) return undefined;\n      const content = message.content;\n      const replyPeer = message.replyInfo?.type === 'message' && message.replyInfo.replyToPeerId;\n      return content.storyData?.peerId || content.webPage?.story?.peerId || replyPeer;\n    });\n  }));\n\n  const idsToSave = unique([\n    ...currentUserId ? [currentUserId] : [],\n    ...currentChatIds,\n    ...messagesChatIds,\n    ...global.recentlyFoundChatIds || [],\n    ...getOrderedIds(ARCHIVED_FOLDER_ID)?.slice(0, GLOBAL_STATE_CACHE_ARCHIVED_CHAT_LIST_LIMIT) || [],\n    ...getOrderedIds(ALL_FOLDER_ID) || [],\n    ...getOrderedIds(SAVED_FOLDER_ID) || [],\n    ...Object.keys(byId),\n  ]).slice(0, GLOBAL_STATE_CACHE_CHAT_LIST_LIMIT);\n\n  return {\n    ...global.chats,\n    similarChannelsById: {},\n    similarBotsById: {},\n    isFullyLoaded: {},\n    notifyExceptionById: pickTruthy(global.chats.notifyExceptionById, idsToSave),\n    loadingParameters: INITIAL_GLOBAL_STATE.chats.loadingParameters,\n    byId: pickTruthy(global.chats.byId, idsToSave),\n    fullInfoById: pickTruthy(global.chats.fullInfoById, idsToSave),\n    lastMessageIds: {\n      all: pickTruthy(global.chats.lastMessageIds.all || {}, idsToSave),\n      saved: global.chats.lastMessageIds.saved,\n    },\n    topicsInfoById: pickTruthy(global.chats.topicsInfoById, currentChatIds),\n  };\n}\n\nfunction reduceMessages<T extends GlobalState>(global: T): GlobalState['messages'] {\n  const { currentUserId } = global;\n  const byChatId: GlobalState['messages']['byChatId'] = {};\n  const currentChatIds = compact(\n    Object.values(global.byTabId)\n      .map(({ id: tabId }) => selectCurrentMessageList(global, tabId)),\n  ).map(({ chatId }) => chatId);\n  const forumPanelChatIds = compact(\n    Object.values(global.byTabId)\n      .map(({ forumPanelChatId }) => forumPanelChatId),\n  );\n  const chatIdsToSave = unique([\n    ...currentChatIds,\n    ...currentUserId ? [currentUserId] : [],\n    ...forumPanelChatIds,\n    ...getOrderedIds(ALL_FOLDER_ID) || [],\n    ...getOrderedIds(ARCHIVED_FOLDER_ID)?.slice(0, GLOBAL_STATE_CACHE_ARCHIVED_CHAT_LIST_LIMIT) || [],\n  ]);\n\n  const openedChatThreadIds = Object.values(global.byTabId).reduce((acc, { id: tabId }) => {\n    const { chatId: tabChatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n    if (!tabChatId || !threadId || threadId === MAIN_THREAD_ID) {\n      return acc;\n    }\n    const current = acc[tabChatId] || new Set();\n    current.add(threadId);\n    acc[tabChatId] = current;\n\n    return acc;\n  }, {} as Record<string, Set<ThreadId>>);\n\n  const pollIdsToSave: string[] = [];\n\n  chatIdsToSave.forEach((chatId) => {\n    const current = global.messages.byChatId[chatId];\n    if (!current) {\n      return;\n    }\n\n    const chatLastMessageId = selectChatLastMessageId(global, chatId);\n\n    const openedThreadIds = Array.from(openedChatThreadIds[chatId] || []);\n    const commentThreadIds = Object.values(global.messages.byChatId[chatId].threadsById || {})\n      .map(({ threadInfo }) => (threadInfo?.isCommentsInfo ? threadInfo?.originMessageId : undefined))\n      .filter(Boolean);\n    const threadIds = unique(openedThreadIds.concat(commentThreadIds));\n\n    const threadsToSave = pickTruthy(current.threadsById, [MAIN_THREAD_ID, ...threadIds]);\n\n    const viewportIdsToSave = unique(Object.values(threadsToSave).flatMap((thread) => thread.lastViewportIds || []));\n    const topics = selectTopics(global, chatId);\n    const topicLastMessageIds = topics && forumPanelChatIds.includes(chatId)\n      ? Object.values(topics).map(({ lastMessageId }) => lastMessageId) : [];\n    const savedLastMessageIds = chatId === currentUserId && global.chats.lastMessageIds.saved\n      ? Object.values(global.chats.lastMessageIds.saved) : [];\n    const lastMessageIdsToSave = [chatLastMessageId].concat(topicLastMessageIds).concat(savedLastMessageIds)\n      .filter(Boolean);\n    const byId = pick(current.byId, viewportIdsToSave.concat(lastMessageIdsToSave));\n    const threadsById = Object.keys(threadsToSave).reduce((acc, key) => {\n      const thread = threadsToSave[Number(key)];\n      acc[Number(key)] = {\n        ...thread,\n        listedIds: thread.lastViewportIds,\n        pinnedIds: undefined,\n        typingStatus: undefined,\n      };\n      return acc;\n    }, {} as GlobalState['messages']['byChatId'][string]['threadsById']);\n\n    const cleanedById = Object.values(byId).reduce((acc, message) => {\n      if (!message) return acc;\n\n      let cleanedMessage = omitLocalMedia(message);\n      cleanedMessage = omitLocalPaidReactions(cleanedMessage);\n      acc[message.id] = cleanedMessage;\n\n      if (message.content.pollId) {\n        pollIdsToSave.push(message.content.pollId);\n      }\n\n      return acc;\n    }, {} as Record<number, ApiMessage>);\n\n    byChatId[chatId] = {\n      byId: cleanedById,\n      threadsById,\n    };\n  });\n\n  return {\n    byChatId,\n    pollById: pickTruthy(global.messages.pollById, pollIdsToSave),\n    sponsoredByChatId: {},\n    playbackByChatId: {},\n  };\n}\n\nfunction omitLocalPaidReactions(message: ApiMessage): ApiMessage {\n  if (!message.reactions?.results.length) return message;\n  return {\n    ...message,\n    reactions: {\n      ...message.reactions,\n      results: message.reactions.results.map((reaction) => {\n        if (reaction.localAmount) {\n          return {\n            ...reaction,\n            localAmount: undefined,\n          };\n        }\n        return reaction;\n      }),\n    },\n  };\n}\n\nfunction omitLocalMedia(message: ApiMessage): ApiMessage {\n  const {\n    photo, video, document, sticker,\n  } = message.content;\n\n  return {\n    ...message,\n    content: {\n      ...message.content,\n      photo: photo && {\n        ...photo,\n        blobUrl: undefined,\n      },\n      video: video && {\n        ...video,\n        blobUrl: undefined,\n        previewBlobUrl: undefined,\n      },\n      document: document && {\n        ...document,\n        previewBlobUrl: undefined,\n      },\n      sticker: sticker && {\n        ...sticker,\n        isPreloadedGlobally: undefined,\n      },\n    },\n    previousLocalId: undefined,\n  };\n}\n\nfunction reduceSettings<T extends GlobalState>(global: T): GlobalState['settings'] {\n  const {\n    byKey, themes, performance, botVerificationShownPeerIds, miniAppsCachedPosition, miniAppsCachedSize, notifyDefaults,\n  } = global.settings;\n\n  return {\n    byKey,\n    themes,\n    performance,\n    privacy: {},\n    botVerificationShownPeerIds,\n    miniAppsCachedPosition,\n    miniAppsCachedSize,\n    notifyDefaults,\n  };\n}\n\nfunction reduceChatFolders<T extends GlobalState>(global: T): GlobalState['chatFolders'] {\n  return {\n    ...global.chatFolders,\n  };\n}\n\nfunction reduceGroupCalls<T extends GlobalState>(global: T): GlobalState['groupCalls'] {\n  return {\n    ...global.groupCalls,\n    byId: {},\n    activeGroupCallId: undefined,\n  };\n}\n\nfunction reduceAvailableReactions(availableReactions?: ApiAvailableReaction[]): ApiAvailableReaction[] | undefined {\n  return availableReactions\n    ?.map((r) => pick(r, ['reaction', 'staticIcon', 'title', 'isInactive']));\n}\n","import type { ApiChatType, ApiPhoto } from '../../api/types';\nimport type { WebApp } from '../../types/webapp';\n\nimport { REPLIES_USER_ID, VERIFICATION_CODES_USER_ID } from '../../config';\n\nexport function getBotCoverMediaHash(photo: ApiPhoto) {\n  return `photo${photo.id}?size=x`;\n}\n\nexport function convertToApiChatType(type: string): ApiChatType | undefined {\n  if (type === 'channels') return 'channels';\n  if (type === 'chats' || type === 'groups') return 'chats';\n  if (type === 'users') return 'users';\n  if (type === 'bots') return 'bots';\n  return undefined;\n}\n\nexport function getWebAppKey(webApp: Partial<WebApp>) {\n  if (webApp.requestUrl) return webApp.requestUrl;\n  if (webApp.appName) return `${webApp.botId}?appName=${webApp.appName}`;\n  return webApp.botId!;\n}\n\nexport function isSystemBot(botId: string) {\n  return botId === REPLIES_USER_ID || botId === VERIFICATION_CODES_USER_ID;\n}\n","import type {\n  ApiChat,\n  ApiChatAdminRights,\n  ApiChatBannedRights,\n  ApiChatFolder,\n  ApiChatFullInfo,\n  ApiChatInviteInfo,\n  ApiMessage,\n  ApiPeer,\n  ApiPreparedInlineMessage,\n  ApiTopic,\n  ApiUser,\n} from '../../api/types';\nimport type { OldLangFn } from '../../hooks/useOldLang';\nimport type {\n  CustomPeer, ThreadId,\n} from '../../types';\nimport type { LangFn } from '../../util/localization';\nimport { MAIN_THREAD_ID } from '../../api/types';\n\nimport {\n  ANONYMOUS_USER_ID,\n  ARCHIVED_FOLDER_ID, CHANNEL_ID_LENGTH, GENERAL_TOPIC_ID, REPLIES_USER_ID, TME_LINK_PREFIX,\n  VERIFICATION_CODES_USER_ID,\n} from '../../config';\nimport { formatDateToString, formatTime } from '../../util/dates/dateFormat';\nimport { getServerTime } from '../../util/serverTime';\nimport { getGlobal } from '..';\nimport { isSystemBot } from './bots';\nimport { getMainUsername, getUserFirstOrLastName } from './users';\n\nconst FOREVER_BANNED_DATE = Date.now() / 1000 + 31622400; // 366 days\n\nexport function isUserId(entityId: string) {\n  return !entityId.startsWith('-');\n}\n\nexport function isPeerChat(entity: ApiPeer): entity is ApiChat {\n  return 'title' in entity;\n}\n\nexport function isPeerUser(entity: ApiPeer): entity is ApiUser {\n  return !isPeerChat(entity);\n}\n\nexport function isChannelId(entityId: string) {\n  return entityId.length === CHANNEL_ID_LENGTH && entityId.startsWith('-1');\n}\n\nexport function toChannelId(mtpId: string) {\n  return `-1${mtpId.padStart(CHANNEL_ID_LENGTH - 2, '0')}`;\n}\n\nexport function isChatGroup(chat: ApiChat) {\n  return isChatBasicGroup(chat) || isChatSuperGroup(chat);\n}\n\nexport function isChatBasicGroup(chat: ApiChat) {\n  return chat.type === 'chatTypeBasicGroup';\n}\n\nexport function isChatSuperGroup(chat: ApiChat) {\n  return chat.type === 'chatTypeSuperGroup';\n}\n\nexport function isChatChannel(chat: ApiChat) {\n  return chat.type === 'chatTypeChannel';\n}\n\nexport function isCommonBoxChat(chat: ApiChat) {\n  return chat.type === 'chatTypePrivate' || chat.type === 'chatTypeBasicGroup';\n}\n\nexport function isChatWithRepliesBot(chatId: string) {\n  return chatId === REPLIES_USER_ID;\n}\n\nexport function isChatWithVerificationCodesBot(chatId: string) {\n  return chatId === VERIFICATION_CODES_USER_ID;\n}\n\nexport function isAnonymousForwardsChat(chatId: string) {\n  return chatId === ANONYMOUS_USER_ID;\n}\n\nexport function getChatTypeString(chat: ApiChat) {\n  switch (chat.type) {\n    case 'chatTypePrivate':\n      return 'PrivateChat';\n    case 'chatTypeBasicGroup':\n    case 'chatTypeSuperGroup':\n      return 'AccDescrGroup';\n    case 'chatTypeChannel':\n      return 'AccDescrChannel';\n    default:\n      return 'Chat';\n  }\n}\n\nexport function getPrivateChatUserId(chat: ApiChat) {\n  if (chat.type !== 'chatTypePrivate' && chat.type !== 'chatTypeSecret') {\n    return undefined;\n  }\n  return chat.id;\n}\n\nexport function getChatTitle(lang: OldLangFn | LangFn, chat: ApiChat, isSelf = false) {\n  if (isSelf) {\n    return lang('SavedMessages');\n  }\n  return chat.title || lang('HiddenName');\n}\n\nexport function getChatLink(chat: ApiChat) {\n  const activeUsername = getMainUsername(chat);\n\n  return activeUsername ? `${TME_LINK_PREFIX}${activeUsername}` : undefined;\n}\n\nexport function getChatAvatarHash(\n  owner: ApiPeer,\n  size: 'normal' | 'big' = 'normal',\n  avatarPhotoId = owner.avatarPhotoId,\n) {\n  if (!avatarPhotoId) {\n    return undefined;\n  }\n\n  switch (size) {\n    case 'big':\n      return `profile${owner.id}?${avatarPhotoId}`;\n    default:\n      return `avatar${owner.id}?${avatarPhotoId}`;\n  }\n}\n\nexport function isChatAdmin(chat: ApiChat) {\n  return Boolean(chat.adminRights || chat.isCreator);\n}\n\nexport function getHasAdminRight(chat: ApiChat, key: keyof ApiChatAdminRights) {\n  return chat.adminRights?.[key] || false;\n}\n\nexport function getCanManageTopic(chat: ApiChat, topic: ApiTopic) {\n  if (topic.id === GENERAL_TOPIC_ID) return chat.isCreator;\n  return chat.isCreator || getHasAdminRight(chat, 'manageTopics') || topic.isOwner;\n}\n\nexport function isUserRightBanned(chat: ApiChat, key: keyof ApiChatBannedRights, chatFullInfo?: ApiChatFullInfo) {\n  const unrestrictedByBoosts = chatFullInfo?.boostsToUnrestrict\n    && (chatFullInfo.boostsApplied || 0) >= chatFullInfo.boostsToUnrestrict;\n  return Boolean(\n    (chat.currentUserBannedRights?.[key])\n    || (chat.defaultBannedRights?.[key] && !unrestrictedByBoosts),\n  );\n}\n\nexport function getCanPostInChat(\n  chat: ApiChat, topic?: ApiTopic, isMessageThread?: boolean, chatFullInfo?: ApiChatFullInfo,\n) {\n  if (topic) {\n    if (chat.isForum) {\n      if (chat.isNotJoined) {\n        return false;\n      }\n\n      if (topic?.isClosed && !topic.isOwner && !getHasAdminRight(chat, 'manageTopics')) {\n        return false;\n      }\n    }\n  }\n\n  if (chat.isRestricted || chat.isForbidden || chat.migratedTo\n    || (!isMessageThread && chat.isNotJoined) || isSystemBot(chat.id) || isAnonymousForwardsChat(chat.id)) {\n    return false;\n  }\n\n  if (chat.isCreator) {\n    return true;\n  }\n\n  if (isUserId(chat.id)) {\n    return true;\n  }\n\n  if (isChatChannel(chat)) {\n    return getHasAdminRight(chat, 'postMessages');\n  }\n\n  return isChatAdmin(chat) || !isUserRightBanned(chat, 'sendMessages', chatFullInfo);\n}\n\nexport interface IAllowedAttachmentOptions {\n  canAttachMedia: boolean;\n  canAttachPolls: boolean;\n  canSendStickers: boolean;\n  canSendGifs: boolean;\n  canAttachEmbedLinks: boolean;\n  canSendPhotos: boolean;\n  canSendVideos: boolean;\n  canSendRoundVideos: boolean;\n  canSendAudios: boolean;\n  canSendVoices: boolean;\n  canSendPlainText: boolean;\n  canSendDocuments: boolean;\n}\n\nexport function getAllowedAttachmentOptions(\n  chat?: ApiChat,\n  chatFullInfo?: ApiChatFullInfo,\n  isChatWithBot = false,\n  isStoryReply = false,\n): IAllowedAttachmentOptions {\n  if (!chat) {\n    return {\n      canAttachMedia: false,\n      canAttachPolls: false,\n      canSendStickers: false,\n      canSendGifs: false,\n      canAttachEmbedLinks: false,\n      canSendPhotos: false,\n      canSendVideos: false,\n      canSendRoundVideos: false,\n      canSendAudios: false,\n      canSendVoices: false,\n      canSendPlainText: false,\n      canSendDocuments: false,\n    };\n  }\n\n  const isAdmin = isChatAdmin(chat);\n\n  return {\n    canAttachMedia: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendMedia', chatFullInfo),\n    canAttachPolls: !isStoryReply\n      && (isAdmin || !isUserRightBanned(chat, 'sendPolls', chatFullInfo))\n      && (!isUserId(chat.id) || isChatWithBot),\n    canSendStickers: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendStickers', chatFullInfo),\n    canSendGifs: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendGifs', chatFullInfo),\n    canAttachEmbedLinks: !isStoryReply && (isAdmin || !isUserRightBanned(chat, 'embedLinks', chatFullInfo)),\n    canSendPhotos: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendPhotos', chatFullInfo),\n    canSendVideos: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendVideos', chatFullInfo),\n    canSendRoundVideos: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendRoundvideos', chatFullInfo),\n    canSendAudios: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendAudios', chatFullInfo),\n    canSendVoices: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendVoices', chatFullInfo),\n    canSendPlainText: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendPlain', chatFullInfo),\n    canSendDocuments: isAdmin || isStoryReply || !isUserRightBanned(chat, 'sendDocs', chatFullInfo),\n  };\n}\n\nexport function getMessageSendingRestrictionReason(\n  lang: OldLangFn,\n  currentUserBannedRights?: ApiChatBannedRights,\n  defaultBannedRights?: ApiChatBannedRights,\n) {\n  if (currentUserBannedRights?.sendMessages) {\n    const { untilDate } = currentUserBannedRights;\n    return untilDate && untilDate < FOREVER_BANNED_DATE\n      ? lang(\n        'Channel.Persmission.Denied.SendMessages.Until',\n        lang(\n          'formatDateAtTime',\n          [formatDateToString(new Date(untilDate * 1000), lang.code), formatTime(lang, untilDate * 1000)],\n        ),\n      )\n      : lang('Channel.Persmission.Denied.SendMessages.Forever');\n  }\n\n  if (defaultBannedRights?.sendMessages) {\n    return lang('Channel.Persmission.Denied.SendMessages.DefaultRestrictedText');\n  }\n\n  return undefined;\n}\n\nexport function getForumComposerPlaceholder(\n  lang: OldLangFn,\n  chat?: ApiChat,\n  threadId: ThreadId = MAIN_THREAD_ID,\n  topics?: Record<number, ApiTopic>,\n  isReplying?: boolean,\n) {\n  if (!chat?.isForum) {\n    return undefined;\n  }\n\n  if (threadId === MAIN_THREAD_ID) {\n    if (isReplying || (topics && !topics[GENERAL_TOPIC_ID]?.isClosed)) return undefined;\n    return lang('lng_forum_replies_only');\n  }\n\n  const topic = topics?.[Number(threadId)];\n  if (!topic) {\n    return undefined;\n  }\n\n  if (topic.isClosed && !topic.isOwner && !getHasAdminRight(chat, 'manageTopics')) {\n    return lang('TopicClosedByAdmin');\n  }\n\n  return undefined;\n}\n\nexport function isChatArchived(chat: ApiChat) {\n  return chat.folderId === ARCHIVED_FOLDER_ID;\n}\n\nexport function getCanDeleteChat(chat: ApiChat) {\n  return isChatBasicGroup(chat) || ((isChatSuperGroup(chat) || isChatChannel(chat)) && chat.isCreator);\n}\n\nexport function getFolderDescriptionText(lang: OldLangFn, folder: ApiChatFolder, chatsCount?: number) {\n  const {\n    excludedChatIds, includedChatIds,\n    bots, groups, contacts, nonContacts, channels,\n  } = folder;\n\n  const filters = [bots, groups, contacts, nonContacts, channels];\n\n  // If folder has multiple additive filters or uses include/exclude lists,\n  // we display folder chats count\n  if (\n    chatsCount !== undefined && (\n      Object.values(filters).filter(Boolean).length > 1\n      || (excludedChatIds?.length)\n      || (includedChatIds?.length)\n    )) {\n    return lang('Chats', chatsCount);\n  }\n\n  // Otherwise, we return a short description of a single filter\n  if (bots) {\n    return lang('FilterBots');\n  } else if (groups) {\n    return lang('FilterGroups');\n  } else if (channels) {\n    return lang('FilterChannels');\n  } else if (contacts) {\n    return lang('FilterContacts');\n  } else if (nonContacts) {\n    return lang('FilterNonContacts');\n  } else {\n    return undefined;\n  }\n}\n\nexport function getMessageSenderName(lang: OldLangFn, chatId: string, sender?: ApiPeer) {\n  if (!sender || isUserId(chatId)) {\n    return undefined;\n  }\n\n  if (isPeerChat(sender)) {\n    if (chatId === sender.id) return undefined;\n\n    return sender.title;\n  }\n\n  if (sender.isSelf) {\n    return lang('FromYou');\n  }\n\n  return getUserFirstOrLastName(sender);\n}\n\nexport function isChatPublic(chat: ApiChat) {\n  return chat.usernames?.some(({ isActive }) => isActive);\n}\n\nexport function getOrderedTopics(\n  topics: ApiTopic[], pinnedOrder?: number[], shouldSortByLastMessage = false,\n): ApiTopic[] {\n  if (shouldSortByLastMessage) {\n    return topics.sort((a, b) => b.lastMessageId - a.lastMessageId);\n  } else {\n    const pinned = topics.filter((topic) => topic.isPinned);\n    const ordered = topics\n      .filter((topic) => !topic.isPinned && !topic.isHidden)\n      .sort((a, b) => b.lastMessageId - a.lastMessageId);\n    const hidden = topics.filter((topic) => !topic.isPinned && topic.isHidden)\n      .sort((a, b) => b.lastMessageId - a.lastMessageId);\n\n    const pinnedOrdered = pinnedOrder\n      ? pinnedOrder.map((id) => pinned.find((topic) => topic.id === id)).filter(Boolean) : pinned;\n\n    return [...pinnedOrdered, ...ordered, ...hidden];\n  }\n}\n\nexport function getCleanPeerId(peerId: string) {\n  return isChannelId(peerId)\n    // Remove -1 and leading zeros\n    ? peerId.replace(/^-10+/, '')\n    : peerId.replace('-', '');\n}\n\nexport function getPeerIdDividend(peerId: string) {\n  return Math.abs(Number(getCleanPeerId(peerId)));\n}\n\nexport function getPeerColorKey(peer: ApiPeer | undefined) {\n  if (peer?.color?.color) return peer.color.color;\n\n  return peer ? getPeerIdDividend(peer.id) % 7 : 0;\n}\n\nexport function getPeerColorCount(peer: ApiPeer) {\n  const key = getPeerColorKey(peer);\n  // eslint-disable-next-line eslint-multitab-tt/no-immediate-global\n  return getGlobal().peerColors?.general[key].colors?.length || 1;\n}\n\nexport function getIsSavedDialog(chatId: string, threadId: ThreadId | undefined, currentUserId: string | undefined) {\n  return chatId === currentUserId && threadId !== MAIN_THREAD_ID;\n}\n\nexport function getGroupStatus(lang: OldLangFn, chat: ApiChat) {\n  const chatTypeString = lang(getChatTypeString(chat));\n  const { membersCount } = chat;\n\n  if (chat.isRestricted) {\n    return chatTypeString === 'Channel' ? 'channel is inaccessible' : 'group is inaccessible';\n  }\n\n  if (!membersCount) {\n    return chatTypeString;\n  }\n\n  return chatTypeString === 'Channel'\n    ? lang('Subscribers', membersCount, 'i')\n    : lang('Members', membersCount, 'i');\n}\n\nexport function getCustomPeerFromInvite(invite: ApiChatInviteInfo): CustomPeer {\n  const {\n    title, color, isVerified, isFake, isScam,\n  } = invite;\n  return {\n    isCustomPeer: true,\n    title,\n    peerColorId: color,\n    isVerified,\n    fakeType: isFake ? 'fake' : isScam ? 'scam' : undefined,\n  };\n}\n\nexport function getMockPreparedMessageFromResult(botId: string, preparedMessage: ApiPreparedInlineMessage) {\n  const { result } = preparedMessage;\n\n  const inlineButtons = result?.sendMessage?.replyMarkup?.inlineButtons;\n\n  return {\n    chatId: botId,\n    content: result.sendMessage.content,\n    date: getServerTime(),\n    id: 0,\n    isOutgoing: true,\n    viaBotId: botId,\n    inlineButtons,\n  } satisfies ApiMessage;\n}\n","import type {\n  ApiAvailableReaction,\n  ApiChatReactions,\n  ApiMessage,\n  ApiReactionCount,\n  ApiReactionKey,\n  ApiReactions,\n  ApiReactionWithPaid,\n} from '../../api/types';\nimport type { GlobalState } from '../types';\n\nexport function getMessageRecentReaction(message: Partial<ApiMessage>) {\n  return message.isOutgoing ? message.reactions?.recentReactions?.[0] : undefined;\n}\nexport function checkIfHasUnreadReactions(global: GlobalState, reactions: ApiReactions) {\n  const { currentUserId } = global;\n  return reactions?.recentReactions?.some(\n    ({ isUnread, isOwn, peerId }) => isUnread && !isOwn && currentUserId !== peerId,\n  );\n}\n\nexport function areReactionsEmpty(reactions: ApiReactions) {\n  return !reactions.results.some(({ count, localAmount }) => count || localAmount);\n}\n\nexport function getReactionKey(reaction: ApiReactionWithPaid): ApiReactionKey {\n  switch (reaction.type) {\n    case 'emoji':\n      return `emoji-${reaction.emoticon}`;\n    case 'custom':\n      return `document-${reaction.documentId}`;\n    case 'paid':\n      return 'paid';\n    default: {\n      // Legacy reactions\n      const uniqueValue = (reaction as any).emoticon || (reaction as any).documentId;\n      return `unsupported-${uniqueValue}`;\n    }\n  }\n}\n\nexport function isSameReaction(first?: ApiReactionWithPaid, second?: ApiReactionWithPaid) {\n  if (first === second) {\n    return true;\n  }\n\n  if (!first || !second) {\n    return false;\n  }\n\n  return getReactionKey(first) === getReactionKey(second);\n}\n\nexport function canSendReaction(reaction: ApiReactionWithPaid, chatReactions: ApiChatReactions) {\n  if (chatReactions.type === 'all') {\n    return reaction.type === 'emoji' || chatReactions.areCustomAllowed;\n  }\n\n  if (chatReactions.type === 'some') {\n    return chatReactions.allowed.some((r) => isSameReaction(r, reaction));\n  }\n\n  return false;\n}\n\nexport function sortReactions<T extends ApiAvailableReaction | ApiReactionWithPaid>(\n  reactions: T[],\n  topReactions?: ApiReactionWithPaid[],\n): T[] {\n  return reactions.slice().sort((left, right) => {\n    const reactionOne = left ? ('reaction' in left ? left.reaction : left) as ApiReactionWithPaid : undefined;\n    const reactionTwo = right ? ('reaction' in right ? right.reaction : right) as ApiReactionWithPaid : undefined;\n\n    if (reactionOne?.type === 'paid') return -1;\n    if (reactionTwo?.type === 'paid') return 1;\n\n    const indexOne = topReactions?.findIndex((reaction) => isSameReaction(reaction, reactionOne)) || 0;\n    const indexTwo = topReactions?.findIndex((reaction) => isSameReaction(reaction, reactionTwo)) || 0;\n    return (\n      (indexOne > -1 ? indexOne : Infinity) - (indexTwo > -1 ? indexTwo : Infinity)\n    );\n  });\n}\n\nexport function getUserReactions(message: ApiMessage): ApiReactionWithPaid[] {\n  return message.reactions?.results?.filter((r): r is Required<ApiReactionCount> => isReactionChosen(r))\n    .sort((a, b) => a.chosenOrder - b.chosenOrder)\n    .map((r) => r.reaction) || [];\n}\n\nexport function isReactionChosen(reaction: ApiReactionCount) {\n  return reaction.chosenOrder !== undefined;\n}\n\nexport function updateReactionCount(reactionCount: ApiReactionCount[], newReactions: ApiReactionWithPaid[]) {\n  const results = reactionCount.map((current) => (\n    isReactionChosen(current) ? {\n      ...current,\n      chosenOrder: undefined,\n      count: current.count - 1,\n    } : current\n  )).filter(({ count }) => count > 0);\n\n  newReactions.forEach((reaction, i) => {\n    const existingIndex = results.findIndex((r) => isSameReaction(r.reaction, reaction));\n    if (existingIndex > -1) {\n      results[existingIndex] = {\n        ...results[existingIndex],\n        chosenOrder: i,\n        count: results[existingIndex].count + 1,\n      };\n    } else {\n      results.push({\n        reaction,\n        chosenOrder: i,\n        count: 1,\n      });\n    }\n  });\n\n  return results;\n}\n\nexport function addPaidReaction(\n  reactionCount: ApiReactionCount[], count: number, isAnonymous?: boolean, peerId?: string,\n): ApiReactionCount[] {\n  const results: ApiReactionCount[] = [];\n  const hasPaid = reactionCount.some((current) => current.reaction.type === 'paid');\n  if (hasPaid) {\n    reactionCount.forEach((current) => {\n      if (current.reaction.type === 'paid') {\n        results.push({\n          ...current,\n          localAmount: (current.localAmount || 0) + count,\n          chosenOrder: -1,\n          localIsPrivate: isAnonymous !== undefined ? isAnonymous : current.localIsPrivate,\n          localPeerId: peerId || current.localPeerId,\n          localPreviousChosenOrder: current.chosenOrder,\n        });\n        return;\n      }\n\n      results.push(current);\n    });\n\n    return results;\n  }\n\n  return [\n    {\n      reaction: { type: 'paid' },\n      count: 0,\n      chosenOrder: -1,\n      localAmount: count,\n      localIsPrivate: isAnonymous,\n      localPeerId: peerId,\n    },\n    ...reactionCount,\n  ];\n}\n","import type { ApiStory, ApiVideo } from '../../api/types';\n\nimport { getPhotoMediaHash, getVideoMediaHash } from './messageMedia';\n\ntype StorySize = 'pictogram' | 'preview' | 'full' | 'download';\nconst STORY_ALT_VIDEO_WIDTH = 480;\n\nexport function getStoryMediaHash(\n  story: ApiStory, size: StorySize, isAlt: true,\n): string | undefined;\nexport function getStoryMediaHash(story: ApiStory): string;\nexport function getStoryMediaHash(story: ApiStory, size: StorySize): string;\nexport function getStoryMediaHash(\n  story: ApiStory, size: StorySize = 'preview', isAlt?: boolean,\n) {\n  const isVideo = Boolean(story.content.video);\n\n  if (isVideo) {\n    if (isAlt && !story.content.altVideos) return undefined;\n    const media = isAlt ? getPreferredAlt(story.content.altVideos!) : story.content.video!;\n    return getVideoMediaHash(media, size);\n  }\n\n  return getPhotoMediaHash(story.content.photo!, size);\n}\n\nfunction getPreferredAlt(alts: ApiVideo[]) {\n  const alt = alts.reduce((prev, curr) => (\n    Math.abs((curr.width || 0) - STORY_ALT_VIDEO_WIDTH) < Math.abs((prev.width || 0) - STORY_ALT_VIDEO_WIDTH)\n      ? curr : prev\n  ));\n  return alt;\n}\n\nexport function getStoryKey(chatId: string, storyId: number) {\n  return `story${chatId}-${storyId}`;\n}\n","import type {\n  ApiInputPrivacyRules,\n  BotsPrivacyType,\n  PrivacyVisibility,\n} from '../../api/types';\nimport type { GlobalState } from '../types';\n\nimport { partition } from '../../util/iteratees';\nimport { isUserId } from './chats';\n\nexport function buildApiInputPrivacyRules(global: GlobalState, {\n  visibility,\n  isUnspecified,\n  allowedIds,\n  blockedIds,\n  shouldAllowPremium,\n  botsPrivacy,\n}: {\n  visibility: PrivacyVisibility;\n  isUnspecified?: boolean;\n  allowedIds: string[];\n  blockedIds: string[];\n  shouldAllowPremium?: true;\n  botsPrivacy: BotsPrivacyType;\n}): ApiInputPrivacyRules {\n  const {\n    users: { byId: usersById },\n    chats: { byId: chatsById },\n  } = global;\n\n  const [allowedUserIds, allowedChatIds] = partition(allowedIds, isUserId);\n  const [blockedUserIds, blockedChatIds] = partition(blockedIds, isUserId);\n\n  const rules: ApiInputPrivacyRules = {\n    visibility,\n    isUnspecified,\n    allowedUsers: allowedUserIds.map((userId) => usersById[userId]).filter(Boolean),\n    allowedChats: allowedChatIds.map((chatId) => chatsById[chatId]).filter(Boolean),\n    blockedUsers: blockedUserIds.map((userId) => usersById[userId]).filter(Boolean),\n    blockedChats: blockedChatIds.map((chatId) => chatsById[chatId]).filter(Boolean),\n    shouldAllowPremium,\n    botsPrivacy,\n  };\n\n  return rules;\n}\n","import type {\n  ApiAttachment,\n  ApiAudio,\n  ApiDimensions,\n  ApiDocument,\n  ApiGame,\n  ApiLocation,\n  ApiMediaExtendedPreview,\n  ApiMessage,\n  ApiMessageSearchType,\n  ApiPhoto,\n  ApiSticker,\n  ApiVideo,\n  ApiVoice,\n  ApiWebDocument,\n  MediaContainer,\n} from '../../api/types';\nimport type { ActiveDownloads } from '../../types';\nimport { ApiMediaFormat } from '../../api/types';\n\nimport {\n  IS_OPFS_SUPPORTED,\n  IS_OPUS_SUPPORTED,\n  IS_PROGRESSIVE_SUPPORTED,\n  IS_SAFARI,\n  MAX_BUFFER_SIZE,\n} from '../../util/windowEnvironment';\nimport { getDocumentHasPreview } from '../../components/common/helpers/documentInfo';\nimport { getAttachmentMediaType, matchLinkInMessageText } from './messages';\n\nexport type MediaWithThumbs = ApiPhoto | ApiVideo | ApiDocument | ApiSticker | ApiMediaExtendedPreview;\nexport type DownloadableMedia = ApiPhoto | ApiVideo | ApiDocument | ApiSticker | ApiAudio | ApiVoice | ApiWebDocument;\n\ntype Target =\n  'micro'\n  | 'pictogram'\n  | 'inline'\n  | 'preview'\n  | 'full'\n  | 'download';\n\nexport function getMessageContent(message: MediaContainer) {\n  return message.content;\n}\n\nexport function hasMessageMedia(message: MediaContainer) {\n  return Boolean((\n    getMessagePhoto(message)\n    || getMessageVideo(message)\n    || getMessageDocument(message)\n    || getMessageSticker(message)\n    || getMessageContact(message)\n    || getMessagePollId(message)\n    || getMessageAction(message)\n    || getMessageAudio(message)\n    || getMessageVoice(message)\n  ));\n}\n\nexport function canEditMedia(message: MediaContainer) {\n  const {\n    photo, video, altVideos, audio, document, text, webPage, ...otherMedia\n  } = message.content;\n\n  return !video?.isRound && !Object.keys(otherMedia).length;\n}\n\nexport function getMessagePhoto(message: MediaContainer) {\n  return message.content.photo;\n}\n\nexport function getMessageActionPhoto(message: MediaContainer) {\n  return message.content.action?.type === 'suggestProfilePhoto' ? message.content.action.photo : undefined;\n}\n\nexport function getMessageVideo(message: MediaContainer) {\n  return message.content.video;\n}\n\nexport function getMessageRoundVideo(message: MediaContainer) {\n  const { video } = message.content;\n\n  return video?.isRound ? video : undefined;\n}\n\nexport function getMessageAction(message: MediaContainer) {\n  return message.content.action;\n}\n\nexport function getMessageAudio(message: MediaContainer) {\n  return message.content.audio;\n}\n\nexport function getMessageVoice(message: MediaContainer) {\n  return message.content.voice;\n}\n\nexport function getMessageSticker(message: MediaContainer) {\n  return message.content.sticker;\n}\n\nexport function getMessageDocument(message: MediaContainer) {\n  return message.content.document;\n}\n\nexport function getMessageWebPageDocument(message: MediaContainer) {\n  return getMessageWebPage(message)?.document;\n}\n\nexport function isDocumentPhoto(document: ApiDocument) {\n  return document.innerMediaType === 'photo';\n}\n\nexport function isDocumentVideo(document: ApiDocument) {\n  return document.innerMediaType === 'video';\n}\n\nexport function isMessageDocumentSticker(message: MediaContainer) {\n  const document = getMessageDocument(message);\n  return document ? document.mimeType === 'image/webp' : undefined;\n}\n\nexport function getMessageContact(message: MediaContainer) {\n  return message.content.contact;\n}\n\nexport function getMessagePollId(message: MediaContainer) {\n  return message.content.pollId;\n}\n\nexport function getMessageInvoice(message: MediaContainer) {\n  return message.content.invoice;\n}\n\nexport function getMessageLocation(message: MediaContainer) {\n  return message.content.location;\n}\n\nexport function getMessageWebPage(message: MediaContainer) {\n  return message.content.webPage;\n}\n\nexport function getMessagePaidMedia(message: MediaContainer) {\n  return message.content.paidMedia;\n}\n\nexport function getMessageWebPagePhoto(message: MediaContainer) {\n  return getMessageWebPage(message)?.photo;\n}\n\nexport function getMessageDocumentPhoto(message: MediaContainer) {\n  const document = getMessageDocument(message);\n  return document && isDocumentPhoto(document) ? document : undefined;\n}\n\nexport function getMessageWebPageVideo(message: MediaContainer) {\n  return getMessageWebPage(message)?.video;\n}\n\nexport function getMessageWebPageAudio(message: MediaContainer) {\n  return getMessageWebPage(message)?.audio;\n}\n\nexport function getMessageDocumentVideo(message: MediaContainer) {\n  const document = getMessageDocument(message);\n  return document && isDocumentVideo(document) ? document : undefined;\n}\n\nexport function getMessageDownloadableMedia(message: MediaContainer): DownloadableMedia | undefined {\n  return (\n    getMessagePhoto(message)\n    || getMessageVideo(message)\n    || getMessageDocument(message)\n    || getMessageSticker(message)\n    || getMessageAudio(message)\n    || getMessageVoice(message)\n    || getMessageWebPagePhoto(message)\n    || getMessageWebPageVideo(message)\n    || getMessageWebPageAudio(message)\n  );\n}\n\nfunction getMessageMediaThumbnail(message: MediaContainer) {\n  const media = getMessagePhoto(message)\n    || getMessageVideo(message)\n    || getMessageDocument(message)\n    || getMessageSticker(message)\n    || getMessageWebPagePhoto(message)\n    || getMessageWebPageVideo(message)\n    || getMessageInvoice(message)?.extendedMedia;\n\n  if (!media) {\n    return undefined;\n  }\n\n  return media.thumbnail;\n}\n\nexport function getMessageMediaThumbDataUri(message: MediaContainer) {\n  return getMessageMediaThumbnail(message)?.dataUri;\n}\n\nexport function getMediaThumbUri(media: MediaWithThumbs) {\n  return media.thumbnail?.dataUri;\n}\n\nexport function getMessageIsSpoiler(message: MediaContainer) {\n  const media = getMessagePhoto(message)\n    || getMessageVideo(message);\n\n  const invoiceMedia = getMessageInvoice(message)?.extendedMedia;\n  return Boolean(invoiceMedia || media?.isSpoiler);\n}\n\nexport function buildStaticMapHash(\n  geo: ApiLocation['geo'],\n  width: number,\n  height: number,\n  zoom: number,\n  scale: number,\n) {\n  const {\n    long, lat, accessHash, accuracyRadius,\n  } = geo;\n\n  // eslint-disable-next-line max-len\n  return `staticMap:${accessHash}?lat=${lat}&long=${long}&w=${width}&h=${height}&zoom=${zoom}&scale=${scale}&accuracyRadius=${accuracyRadius}`;\n}\n\nexport function getMessageMediaHash(\n  message: MediaContainer,\n  target: Target,\n) {\n  const {\n    video, sticker, audio, voice, document,\n  } = message.content;\n\n  const messagePhoto = getMessagePhoto(message) || getMessageWebPagePhoto(message);\n  const actionPhoto = getMessageActionPhoto(message);\n  const messageVideo = video || getMessageWebPageVideo(message);\n  const messageDocument = document || getMessageWebPageDocument(message);\n  const messageAudio = audio || getMessageWebPageAudio(message);\n\n  if (messageVideo) {\n    return getVideoMediaHash(messageVideo, target);\n  }\n\n  if (messagePhoto || actionPhoto) {\n    return getPhotoMediaHash(messagePhoto || actionPhoto!, target, Boolean(actionPhoto));\n  }\n\n  if (messageDocument) {\n    return getDocumentMediaHash(messageDocument, target);\n  }\n\n  if (sticker) {\n    return getStickerMediaHash(sticker, target);\n  }\n\n  if (messageAudio) {\n    return getAudioMediaHash(messageAudio, target);\n  }\n\n  if (voice) {\n    return getVoiceMediaHash(voice, target);\n  }\n\n  return undefined;\n}\n\nexport function getPhotoMediaHash(photo: ApiPhoto | ApiDocument, target: Target, isAction?: boolean) {\n  const base = `photo${photo.id}`;\n  const isVideo = photo.mediaType === 'photo' && photo.isVideo;\n\n  switch (target) {\n    case 'micro':\n    case 'pictogram':\n      return `${base}?size=${isAction ? 'a' : 'm'}`;\n    case 'inline':\n      return !hasMediaLocalBlobUrl(photo) ? `${base}?size=${isAction ? 'b' : 'x'}` : undefined;\n    case 'preview':\n      return `${base}?size=${isAction ? 'b' : 'x'}`;\n    case 'download':\n      return !isVideo ? base : getVideoProfilePhotoMediaHash(photo);\n    case 'full':\n    default:\n      return base;\n  }\n}\n\nexport function getProfilePhotoMediaHash(photo: ApiPhoto) {\n  return `photo${photo.id}?size=c`;\n}\n\nexport function getVideoProfilePhotoMediaHash(photo: ApiPhoto) {\n  if (!photo.isVideo) return undefined;\n  return `photo${photo.id}?size=u`;\n}\n\nexport function getVideoMediaHash(video: ApiVideo | ApiDocument, target: Target) {\n  const base = `document${video.id}`;\n\n  switch (target) {\n    case 'micro':\n    case 'pictogram':\n      return `${base}?size=m`;\n    case 'inline':\n      return !hasMediaLocalBlobUrl(video) ? appendProgressiveQueryParameters(video, base) : undefined;\n    case 'preview':\n      return `${base}?size=x`;\n    case 'download':\n      return `${base}?download`;\n    case 'full':\n    default:\n      return appendProgressiveQueryParameters(video, base);\n  }\n}\n\nexport function getVideoPreviewMediaHash(video: ApiVideo) {\n  return video.hasVideoPreview ? `document${video.id}?size=v` : undefined;\n}\n\nexport function getDocumentMediaHash(document: ApiDocument, target: Target) {\n  const base = `document${document.id}`;\n\n  switch (target) {\n    case 'micro':\n    case 'pictogram':\n    case 'inline':\n    case 'preview':\n      if (!getDocumentHasPreview(document) || hasMediaLocalBlobUrl(document)) {\n        return undefined;\n      }\n\n      return `${base}?size=m`;\n    case 'full':\n    case 'download':\n    default:\n      return base;\n  }\n}\n\nexport function getAudioMediaHash(audio: ApiAudio, target: Target) {\n  const base = `document${audio.id}`;\n\n  switch (target) {\n    case 'micro':\n    case 'pictogram':\n      return getAudioHasCover(audio) ? `${base}?size=m` : undefined;\n    case 'inline':\n      return appendProgressiveQueryParameters(audio, base);\n    case 'download':\n      return `${base}?download`;\n    default:\n      return base;\n  }\n}\n\nexport function getVoiceMediaHash(voice: ApiVoice, target: Target) {\n  const base = `document${voice.id}`;\n\n  switch (target) {\n    case 'micro':\n    case 'pictogram':\n      return undefined;\n    case 'download':\n      return `${base}?download`;\n    case 'inline':\n    default:\n      return base;\n  }\n}\n\nexport function getWebDocumentHash(webDocument?: ApiWebDocument) {\n  if (!webDocument) return undefined;\n  return `webDocument:${webDocument.url}`;\n}\n\nexport function getStickerMediaHash(sticker: ApiSticker, target: Target) {\n  const base = `document${sticker.id}`;\n\n  switch (target) {\n    case 'micro':\n    case 'pictogram':\n      if (!sticker.previewPhotoSizes?.some((size) => size.type === 's')) {\n        return getStickerMediaHash(sticker, 'preview');\n      }\n      return `${base}?size=s`;\n    case 'preview':\n      return `${base}?size=m`;\n    case 'download':\n      return `${base}?download`;\n    case 'inline':\n    default:\n      return base;\n  }\n}\n\nexport function getMediaHash(media: DownloadableMedia, target: Target) {\n  switch (media.mediaType) {\n    case 'photo':\n      return getPhotoMediaHash(media, target);\n    case 'video':\n      return getVideoMediaHash(media, target);\n    case 'document':\n      return getDocumentMediaHash(media, target);\n    case 'audio':\n      return getAudioMediaHash(media, target);\n    case 'voice':\n      return getVoiceMediaHash(media, target);\n    case 'sticker':\n      return getStickerMediaHash(media, target);\n    case 'webDocument':\n      return getWebDocumentHash(media);\n    default:\n      return undefined;\n  }\n}\n\nexport function getGamePreviewPhotoHash(game: ApiGame) {\n  const { photo } = game;\n\n  if (photo) {\n    return `photo${photo.id}?size=x`;\n  }\n\n  return undefined;\n}\n\nexport function getGamePreviewVideoHash(game: ApiGame) {\n  const { document } = game;\n\n  if (document) {\n    return `document${document.id}`;\n  }\n\n  return undefined;\n}\n\nexport function appendProgressiveQueryParameters(media: ApiAudio | ApiVideo | ApiDocument, base: string) {\n  if (IS_PROGRESSIVE_SUPPORTED && IS_SAFARI) {\n    return `${base}?fileSize=${media.size}&mimeType=${media.mimeType}`;\n  }\n\n  return base;\n}\n\nexport function getAudioHasCover(media: ApiAudio) {\n  return media.thumbnailSizes && media.thumbnailSizes.length > 0;\n}\n\nexport function getMediaFormat(\n  media: DownloadableMedia, target: Target,\n): ApiMediaFormat {\n  const isDocument = media.mediaType === 'document';\n  const hasInnerVideo = isDocument && media.innerMediaType === 'video';\n  const isVideo = media.mediaType === 'video' || hasInnerVideo;\n  const isAudio = media.mediaType === 'audio';\n  const isVoice = media.mediaType === 'voice';\n\n  const size = getMediaFileSize(media) || 0; // Media types that do not have `size` are smaller than `MAX_BUFFER_SIZE`\n\n  if (target === 'download') {\n    if (IS_PROGRESSIVE_SUPPORTED && size > MAX_BUFFER_SIZE && !IS_OPFS_SUPPORTED) {\n      return ApiMediaFormat.DownloadUrl;\n    }\n    return ApiMediaFormat.BlobUrl;\n  }\n\n  if (isVideo && IS_PROGRESSIVE_SUPPORTED && (\n    target === 'full' || target === 'inline'\n  )) {\n    return ApiMediaFormat.Progressive;\n  }\n\n  if (isAudio || isVoice) {\n    // Safari\n    if (isVoice && !IS_OPUS_SUPPORTED) {\n      return ApiMediaFormat.BlobUrl;\n    }\n\n    return ApiMediaFormat.Progressive;\n  }\n\n  return ApiMediaFormat.BlobUrl;\n}\n\nexport function getMediaFileSize(media: DownloadableMedia) {\n  return 'size' in media ? media.size : undefined;\n}\n\nexport function hasMediaLocalBlobUrl(media: ApiPhoto | ApiVideo | ApiDocument) {\n  if ('blobUrl' in media) {\n    return Boolean(media.blobUrl);\n  }\n\n  if ('previewBlobUrl' in media) {\n    return Boolean(media.previewBlobUrl);\n  }\n\n  return false;\n}\n\nexport function getChatMediaMessageIds(\n  messages: Record<number, ApiMessage>, listedIds: number[], isFromSharedMedia = false,\n) {\n  return getMessageContentIds(messages, listedIds, isFromSharedMedia ? 'media' : 'inlineMedia');\n}\n\nexport function getPhotoFullDimensions(photo: Pick<ApiPhoto, 'sizes' | 'thumbnail'>): ApiDimensions | undefined {\n  return (\n    photo.sizes.find((size) => size.type === 'w')\n    || photo.sizes.find((size) => size.type === 'y')\n    || getPhotoInlineDimensions(photo)\n  );\n}\n\nexport function getPhotoInlineDimensions(photo: Pick<ApiPhoto, 'sizes' | 'thumbnail'>): ApiDimensions | undefined {\n  return (\n    photo.sizes.find((size) => size.type === 'x')\n    || photo.sizes.find((size) => size.type === 'm')\n    || photo.sizes.find((size) => size.type === 's')\n    || photo.thumbnail\n  );\n}\n\nexport function getVideoDimensions(video: ApiVideo): ApiDimensions | undefined {\n  if (video.width && video.height) {\n    return video as ApiDimensions;\n  }\n\n  return undefined;\n}\n\nexport function getMediaTransferState(\n  progress?: number, isLoadNeeded = false, isUploading = false,\n) {\n  const isTransferring = isUploading || isLoadNeeded;\n  const transferProgress = Number(progress);\n\n  return {\n    isUploading, isTransferring, transferProgress,\n  };\n}\n\nexport function getMessageContentIds(\n  messages: Record<number, ApiMessage>, messageIds: number[], contentType: ApiMessageSearchType | 'inlineMedia',\n) {\n  let validator: Function;\n\n  switch (contentType) {\n    case 'media':\n      validator = (message: ApiMessage) => {\n        const video = getMessageVideo(message);\n        return getMessagePhoto(message) || (video && !video.isRound && !video.isGif);\n      };\n      break;\n\n    case 'documents':\n      validator = getMessageDocument;\n      break;\n\n    case 'links':\n      validator = (message: ApiMessage) => getMessageWebPage(message) || matchLinkInMessageText(message);\n      break;\n\n    case 'audio':\n      validator = getMessageAudio;\n      break;\n\n    case 'voice':\n      validator = (message: ApiMessage) => {\n        const video = getMessageVideo(message);\n        return getMessageVoice(message) || (video && video.isRound);\n      };\n      break;\n\n    case 'inlineMedia':\n      validator = (message: ApiMessage) => {\n        const video = getMessageVideo(message);\n        const document = getMessageDocument(message);\n        return (\n          getMessagePhoto(message)\n          || (video && !video.isRound && !video.isGif)\n          || (document && isDocumentPhoto(document))\n          || (document && isDocumentVideo(document))\n        );\n      };\n      break;\n\n    default:\n      return [] as Array<number>;\n  }\n\n  return messageIds.reduce((result, messageId) => {\n    if (messages[messageId] && validator(messages[messageId])) {\n      result.push(messageId);\n    }\n\n    return result;\n  }, [] as Array<number>);\n}\n\nexport function getMediaDuration(message: ApiMessage) {\n  const { audio, voice, video } = getMessageContent(message);\n  const media = audio || voice || video || getMessageWebPageVideo(message) || getMessageWebPageAudio(message);\n  if (!media) {\n    return undefined;\n  }\n\n  return media.duration;\n}\n\nexport function canReplaceMessageMedia(message: ApiMessage, attachment: ApiAttachment) {\n  const isPhotoOrVideo = Boolean(getMessagePhoto(message)\n    || getMessageWebPagePhoto(message) || Boolean(getMessageVideo(message)\n      || getMessageWebPageVideo(message)));\n  const isFile = Boolean(getMessageAudio(message)\n    || getMessageVoice(message) || getMessageDocument(message));\n\n  const fileType = getAttachmentMediaType(attachment);\n\n  return (\n    (isPhotoOrVideo && (fileType === 'photo' || fileType === 'video'))\n    || (isFile && (fileType === 'audio' || fileType === 'file'))\n  );\n}\n\nexport function isMediaLoadableInViewer(newMessage: ApiMessage) {\n  if (!newMessage.content) return false;\n  if (newMessage.content.photo) return true;\n  if (newMessage.content.video && !newMessage.content.video.isRound && !newMessage.content.video.isGif) return true;\n  return false;\n}\n\nexport function getMediaFilename(media: DownloadableMedia) {\n  if ('fileName' in media && media.fileName) {\n    return media.fileName;\n  }\n\n  if (media.mediaType === 'sticker') {\n    const extension = media.isLottie ? 'tgs' : media.isVideo ? 'webm' : 'webp';\n    return `${media.id}.${extension}`;\n  }\n\n  if (media.mediaType === 'photo') {\n    return `${media.id}.${media.isVideo ? 'mp4' : 'jpg'}`;\n  }\n\n  if (media.mediaType === 'voice') {\n    return `${media.id}.${IS_OPUS_SUPPORTED ? 'ogg' : 'wav'}`;\n  }\n\n  if ('id' in media && media.id) {\n    return media.id;\n  }\n\n  return `${media.mediaType}-${Math.random().toString(36).slice(4)}`;\n}\n\nexport function getIsDownloading(activeDownloads: ActiveDownloads, media: DownloadableMedia) {\n  const hash = getMediaHash(media, 'download');\n  if (!hash) return false;\n  return Boolean(activeDownloads[hash]);\n}\n\nexport function getTimestampableMedia(message: MediaContainer) {\n  const video = getMessageVideo(message) || getMessageWebPageVideo(message);\n  return (video && !video.isRound && !video.isGif ? video : undefined)\n    || getMessageAudio(message)\n    || getMessageVoice(message);\n}\n","import type { TeactNode } from '../../lib/teact/teact';\n\nimport type {\n  ApiMediaExtendedPreview, ApiMessage, MediaContent, StatefulMediaContent,\n} from '../../api/types';\nimport type { OldLangFn } from '../../hooks/useOldLang';\nimport { ApiMessageEntityTypes } from '../../api/types';\n\nimport { CONTENT_NOT_SUPPORTED } from '../../config';\nimport trimText from '../../util/trimText';\nimport { renderTextWithEntities } from '../../components/common/helpers/renderTextWithEntities';\nimport {\n  getMessageText, getMessageTranscription,\n} from './messages';\n\nconst SPOILER_CHARS = ['⠺', '⠵', '⠞', '⠟'];\nexport const TRUNCATED_SUMMARY_LENGTH = 80;\n\nexport function getMessageSummaryText(\n  lang: OldLangFn,\n  message: ApiMessage,\n  statefulContent: StatefulMediaContent | undefined,\n  noEmoji = false,\n  truncateLength = TRUNCATED_SUMMARY_LENGTH,\n  isExtended = false,\n) {\n  const emoji = !noEmoji && getMessageSummaryEmoji(message);\n  const emojiWithSpace = emoji ? `${emoji} ` : '';\n  const text = trimText(getMessageTextWithSpoilers(message, statefulContent), truncateLength);\n  const description = getMessageSummaryDescription(lang, message, statefulContent, text, isExtended);\n\n  return `${emojiWithSpace}${description}`;\n}\n\nexport function getMessageTextWithSpoilers(message: ApiMessage, statefulContent: StatefulMediaContent | undefined) {\n  const transcription = getMessageTranscription(message);\n\n  const textWithoutTranscription = getMessageText(statefulContent?.story || message)?.text;\n  if (!textWithoutTranscription) {\n    return transcription;\n  }\n\n  const { entities } = message.content.text || {};\n  if (!entities?.length) {\n    return transcription ? `${transcription}\\n${textWithoutTranscription}` : textWithoutTranscription;\n  }\n\n  const text = entities.reduce((accText, {\n    type,\n    offset,\n    length,\n  }) => {\n    if (type !== ApiMessageEntityTypes.Spoiler) {\n      return accText;\n    }\n\n    const spoiler = generateBrailleSpoiler(length);\n\n    return `${accText.substr(0, offset)}${spoiler}${accText.substr(offset + length, accText.length)}`;\n  }, textWithoutTranscription);\n\n  return transcription ? `${transcription}\\n${text}` : text;\n}\n\nexport function getMessageSummaryEmoji(message: ApiMessage) {\n  const {\n    photo,\n    video,\n    audio,\n    voice,\n    document,\n    sticker,\n    pollId,\n    paidMedia,\n  } = message.content;\n\n  if (message.groupedId || photo || paidMedia) {\n    return '🖼';\n  }\n\n  if (video) {\n    return '📹';\n  }\n\n  if (sticker) {\n    return sticker.emoji;\n  }\n\n  if (audio) {\n    return '🎧';\n  }\n\n  if (voice) {\n    return '🎤';\n  }\n\n  if (document) {\n    return '📎';\n  }\n\n  if (pollId) {\n    return '📊';\n  }\n\n  return undefined;\n}\n\nexport function getMediaContentTypeDescription(\n  lang: OldLangFn, content: MediaContent, statefulContent: StatefulMediaContent | undefined,\n) {\n  return getSummaryDescription(lang, content, statefulContent);\n}\nexport function getMessageSummaryDescription(\n  lang: OldLangFn,\n  message: ApiMessage,\n  statefulContent: StatefulMediaContent | undefined,\n  truncatedText?: string | TeactNode,\n  isExtended = false,\n) {\n  return getSummaryDescription(lang, message.content, statefulContent, message, truncatedText, isExtended);\n}\nfunction getSummaryDescription(\n  lang: OldLangFn,\n  mediaContent: MediaContent,\n  statefulContent: StatefulMediaContent | undefined,\n  message?: ApiMessage,\n  truncatedText?: string | TeactNode,\n  isExtended = false,\n) {\n  const {\n    text,\n    photo,\n    video,\n    audio,\n    voice,\n    document,\n    sticker,\n    contact,\n    invoice,\n    location,\n    game,\n    storyData,\n    giveaway,\n    giveawayResults,\n    paidMedia,\n  } = mediaContent;\n  const { poll } = statefulContent || {};\n\n  let hasUsedTruncatedText = false;\n  let summary: TeactNode | undefined;\n\n  const boughtExtendedMedia = paidMedia?.isBought && paidMedia.extendedMedia;\n  const previewExtendedMedia = paidMedia && !paidMedia.isBought\n    ? paidMedia.extendedMedia as ApiMediaExtendedPreview[] : undefined;\n\n  const isPaidMediaAlbum = paidMedia && paidMedia.extendedMedia.length > 1;\n  const isPaidMediaSingleVideo = !isPaidMediaAlbum\n    && (boughtExtendedMedia?.[0].video || previewExtendedMedia?.[0].duration);\n  const isPaidMediaSinglePhoto = !isPaidMediaAlbum && !isPaidMediaSingleVideo;\n\n  if (message?.groupedId || isPaidMediaAlbum) {\n    hasUsedTruncatedText = true;\n    summary = truncatedText || lang('lng_in_dlg_album');\n  }\n\n  if (photo || isPaidMediaSinglePhoto) {\n    hasUsedTruncatedText = true;\n    summary = truncatedText || lang('AttachPhoto');\n  }\n\n  if (video || isPaidMediaSingleVideo) {\n    hasUsedTruncatedText = true;\n    summary = truncatedText || lang(video?.isGif ? 'AttachGif' : 'AttachVideo');\n  }\n\n  if (sticker) {\n    summary = lang('AttachSticker').trim();\n  }\n\n  if (audio) {\n    summary = getMessageAudioCaption(mediaContent) || lang('AttachMusic');\n  }\n\n  if (voice) {\n    hasUsedTruncatedText = true;\n    summary = truncatedText || lang('AttachAudio');\n  }\n\n  if (document) {\n    hasUsedTruncatedText = !isExtended;\n    summary = isExtended ? document.fileName : (truncatedText || document.fileName);\n  }\n\n  if (contact) {\n    summary = lang('AttachContact');\n  }\n\n  if (poll) {\n    summary = renderTextWithEntities({\n      text: poll.summary.question.text,\n      entities: poll.summary.question.entities,\n      asPreview: true,\n    });\n  }\n\n  if (invoice) {\n    summary = invoice.extendedMedia ? invoice.title : `${lang('PaymentInvoice')}: ${invoice.description}`;\n  }\n\n  if (text) {\n    if (isExtended && summary && !hasUsedTruncatedText) {\n      summary += `\\n${truncatedText}`;\n    } else {\n      summary = truncatedText;\n    }\n  }\n\n  if (location?.mediaType === 'geo' || location?.mediaType === 'venue') {\n    summary = lang('Message.Location');\n  }\n\n  if (location?.mediaType === 'geoLive') {\n    summary = lang('Message.LiveLocation');\n  }\n\n  if (game) {\n    summary = `🎮 ${game.title}`;\n  }\n\n  if (giveaway) {\n    summary = lang('BoostingGiveawayChannelStarted');\n  }\n\n  if (giveawayResults) {\n    summary = lang('Message.GiveawayEndedWinners', giveawayResults.winnersCount);\n  }\n\n  if (storyData) {\n    summary = truncatedText || (message ? lang('ForwardedStory') : lang('Chat.ReplyStory'));\n  }\n\n  return summary || CONTENT_NOT_SUPPORTED;\n}\n\nexport function generateBrailleSpoiler(length: number) {\n  return new Array(length)\n    .fill(undefined)\n    .map(() => SPOILER_CHARS[Math.floor(Math.random() * SPOILER_CHARS.length)])\n    .join('');\n}\n\nfunction getMessageAudioCaption(mediaContent: MediaContent) {\n  const {\n    audio,\n    text,\n  } = mediaContent;\n\n  return (audio && [audio.title, audio.performer].filter(Boolean)\n    .join(' — ')) || (text?.text);\n}\n","import type {\n  ApiAttachment,\n  ApiMessage,\n  ApiMessageEntityTextUrl,\n  ApiPeer,\n  ApiStory,\n  ApiTypeStory,\n} from '../../api/types';\nimport type {\n  ApiPoll, MediaContainer, StatefulMediaContent,\n} from '../../api/types/messages';\nimport type { OldLangFn } from '../../hooks/useOldLang';\nimport type { CustomPeer, ThreadId } from '../../types';\nimport type { LangFn } from '../../util/localization';\nimport type { GlobalState } from '../types';\nimport { ApiMessageEntityTypes, MAIN_THREAD_ID } from '../../api/types';\n\nimport {\n  CONTENT_NOT_SUPPORTED,\n  LOTTIE_STICKER_MIME_TYPE,\n  RE_LINK_TEMPLATE,\n  SERVICE_NOTIFICATIONS_USER_ID,\n  SUPPORTED_AUDIO_CONTENT_TYPES,\n  SUPPORTED_PHOTO_CONTENT_TYPES,\n  SUPPORTED_VIDEO_CONTENT_TYPES,\n  TME_LINK_PREFIX,\n  VERIFICATION_CODES_USER_ID,\n  VIDEO_STICKER_MIME_TYPE,\n} from '../../config';\nimport { areSortedArraysIntersecting, unique } from '../../util/iteratees';\nimport { isLocalMessageId } from '../../util/keys/messageKey';\nimport { getServerTime } from '../../util/serverTime';\nimport { getGlobal } from '../index';\nimport {\n  getChatTitle, getCleanPeerId, isPeerUser, isUserId,\n} from './chats';\nimport { getMainUsername, getUserFirstOrLastName, getUserFullName } from './users';\n\nconst RE_LINK = new RegExp(RE_LINK_TEMPLATE, 'i');\n\nexport function getMessageHtmlId(messageId: number, index?: number) {\n  const parts = ['message', messageId.toString().replace('.', '-'), index].filter(Boolean);\n  return parts.join('-');\n}\n\nexport function getMessageOriginalId(message: ApiMessage) {\n  return message.previousLocalId || message.id;\n}\n\nexport function getMessageTranscription(message: ApiMessage) {\n  const { transcriptionId } = message;\n  // eslint-disable-next-line eslint-multitab-tt/no-immediate-global\n  const global = getGlobal();\n\n  return transcriptionId && global.transcriptions[transcriptionId]?.text;\n}\n\nexport function hasMessageText(message: MediaContainer) {\n  const {\n    action, text, sticker, photo, video, audio, voice, document, pollId, webPage, contact, invoice, location,\n    game, storyData, giveaway, giveawayResults, paidMedia,\n  } = message.content;\n\n  return Boolean(text) || !(\n    sticker || photo || video || audio || voice || document || contact || pollId || webPage || invoice || location\n    || game || storyData || giveaway || giveawayResults || paidMedia || action?.type === 'phoneCall'\n  );\n}\n\nexport function getMessageStatefulContent(global: GlobalState, message: ApiMessage): StatefulMediaContent {\n  const poll = message.content.pollId ? global.messages.pollById[message.content.pollId] : undefined;\n\n  const { peerId: storyPeerId, id: storyId } = message.content.storyData || {};\n  const story = storyId && storyPeerId ? global.stories.byPeerId[storyPeerId]?.byId[storyId] : undefined;\n\n  return groupStatefulContent({ poll, story });\n}\n\nexport function groupStatefulContent({\n  poll,\n  story,\n} : {\n  poll?: ApiPoll;\n  story?: ApiTypeStory;\n}) {\n  return {\n    poll,\n    story: story && 'content' in story ? story : undefined,\n  };\n}\n\nexport function getMessageText(message: MediaContainer) {\n  return hasMessageText(message) ? message.content.text || { text: CONTENT_NOT_SUPPORTED } : undefined;\n}\n\nexport function getMessageCustomShape(message: ApiMessage): boolean {\n  const {\n    text, sticker, photo, video, audio, voice,\n    document, pollId, webPage, contact, action,\n    game, invoice, location, storyData,\n  } = message.content;\n\n  if (sticker || (video?.isRound)) {\n    return true;\n  }\n\n  if (!text || photo || video || audio || voice || document || pollId || webPage || contact || action || game || invoice\n    || location || storyData) {\n    return false;\n  }\n\n  const hasOtherFormatting = text?.entities?.some((entity) => entity.type !== ApiMessageEntityTypes.CustomEmoji);\n\n  return Boolean(message.emojiOnlyCount && !hasOtherFormatting);\n}\n\nexport function getMessageSingleRegularEmoji(message: ApiMessage) {\n  const { text } = message.content;\n\n  if (text?.entities?.length || message.emojiOnlyCount !== 1) {\n    return undefined;\n  }\n\n  return text!.text;\n}\n\nexport function getMessageSingleCustomEmoji(message: ApiMessage): string | undefined {\n  const { text } = message.content;\n\n  if (text?.entities?.length !== 1\n    || text.entities[0].type !== ApiMessageEntityTypes.CustomEmoji\n    || message.emojiOnlyCount !== 1) {\n    return undefined;\n  }\n\n  return text.entities[0].documentId;\n}\n\nexport function getFirstLinkInMessage(message: ApiMessage) {\n  const { text } = message.content;\n\n  let match: RegExpMatchArray | null | undefined;\n  if (text?.entities) {\n    const firstTextUrl = text.entities.find((entity): entity is ApiMessageEntityTextUrl => (\n      entity.type === ApiMessageEntityTypes.TextUrl\n    ));\n    if (firstTextUrl) {\n      match = firstTextUrl.url.match(RE_LINK);\n    }\n\n    if (!match) {\n      const firstUrl = text.entities.find((entity) => entity.type === ApiMessageEntityTypes.Url);\n      if (firstUrl) {\n        const { offset, length } = firstUrl;\n        match = text.text.substring(offset, offset + length).match(RE_LINK);\n      }\n    }\n  }\n\n  if (!match && text) {\n    match = text.text.match(RE_LINK);\n  }\n\n  if (!match) {\n    return undefined;\n  }\n\n  return {\n    url: match[0],\n    domain: match[3],\n  };\n}\n\nexport function matchLinkInMessageText(message: ApiMessage) {\n  const { text } = message.content;\n  const match = text && text.text.match(RE_LINK);\n\n  if (!match) {\n    return undefined;\n  }\n\n  return {\n    url: match[0],\n    domain: match[3],\n  };\n}\n\nexport function isOwnMessage(message: ApiMessage) {\n  return message.isOutgoing;\n}\n\nexport function isReplyToMessage(message: ApiMessage) {\n  return Boolean(message.replyInfo?.type === 'message');\n}\n\nexport function isForwardedMessage(message: ApiMessage) {\n  return Boolean(message.forwardInfo || message.content.storyData);\n}\n\nexport function isActionMessage(message: ApiMessage) {\n  return Boolean(message.content.action);\n}\n\nexport function isServiceNotificationMessage(message: ApiMessage) {\n  return message.chatId === SERVICE_NOTIFICATIONS_USER_ID && Math.round(message.id) !== message.id;\n}\n\nexport function isAnonymousOwnMessage(message: ApiMessage) {\n  return Boolean(message.senderId) && !isUserId(message.senderId) && isOwnMessage(message);\n}\n\nexport function getPeerTitle(lang: OldLangFn | LangFn, peer: ApiPeer | CustomPeer) {\n  if (!peer) return undefined;\n  if ('isCustomPeer' in peer) {\n    // TODO: Remove any after full migration to new lang\n    return peer.titleKey ? lang(peer.titleKey as any) : peer.title;\n  }\n  return isPeerUser(peer) ? getUserFirstOrLastName(peer) : getChatTitle(lang, peer);\n}\n\nexport function getPeerFullTitle(lang: OldLangFn | LangFn, peer: ApiPeer | CustomPeer) {\n  if (!peer) return undefined;\n  if ('isCustomPeer' in peer) {\n    // TODO: Remove any after full migration to new lang\n    return peer.titleKey ? lang(peer.titleKey as any) : peer.title;\n  }\n  return isPeerUser(peer) ? getUserFullName(peer) : getChatTitle(lang, peer);\n}\n\nexport function getSendingState(message: ApiMessage) {\n  if (!message.sendingState) {\n    return 'succeeded';\n  }\n\n  return message.sendingState === 'messageSendingStateFailed' ? 'failed' : 'pending';\n}\n\nexport function isMessageLocal(message: ApiMessage) {\n  return isLocalMessageId(message.id);\n}\n\nexport function isMessageFailed(message: ApiMessage) {\n  return message.sendingState === 'messageSendingStateFailed';\n}\n\nexport function isHistoryClearMessage(message: ApiMessage) {\n  return message.content.action && message.content.action.type === 'historyClear';\n}\n\nexport function isGeoLiveExpired(message: ApiMessage) {\n  const { location } = message.content;\n  if (location?.mediaType !== 'geoLive') return false;\n  return getServerTime() - (message.date || 0) >= location.period;\n}\n\nexport function isMessageTranslatable(message: ApiMessage, allowOutgoing?: boolean) {\n  const { text, game } = message.content;\n\n  const isLocal = isMessageLocal(message);\n  const isServiceNotification = isServiceNotificationMessage(message);\n  const isAction = isActionMessage(message);\n\n  return Boolean(text?.text.length && !message.emojiOnlyCount && !game && (allowOutgoing || !message.isOutgoing)\n    && !isLocal && !isServiceNotification && !isAction && !message.isScheduled);\n}\n\nexport function getMessageSingleInlineButton(message: ApiMessage) {\n  return message.inlineButtons?.length === 1\n    && message.inlineButtons[0].length === 1\n    && message.inlineButtons[0][0];\n}\n\nexport function orderHistoryIds(listedIds: number[]) {\n  return listedIds.sort((a, b) => a - b);\n}\n\nexport function orderPinnedIds(pinnedIds: number[]) {\n  return pinnedIds.sort((a, b) => b - a);\n}\n\nexport function mergeIdRanges(ranges: number[][], idsUpdate: number[]): number[][] {\n  let hasIntersection = false;\n  let newOutlyingLists = ranges.length ? ranges.map((list) => {\n    if (areSortedArraysIntersecting(list, idsUpdate) && !hasIntersection) {\n      hasIntersection = true;\n      return orderHistoryIds(unique(list.concat(idsUpdate)));\n    }\n    return list;\n  }) : [idsUpdate];\n\n  if (!hasIntersection) {\n    newOutlyingLists = newOutlyingLists.concat([idsUpdate]);\n  }\n\n  newOutlyingLists.sort((a, b) => a[0] - b[0]);\n\n  let length = newOutlyingLists.length;\n  for (let i = 0; i < length; i++) {\n    const array = newOutlyingLists[i];\n    const prevArray = newOutlyingLists[i - 1];\n\n    if (prevArray && (prevArray.includes(array[0]) || prevArray.includes(array[0] - 1))) {\n      newOutlyingLists[i - 1] = orderHistoryIds(unique(array.concat(prevArray)));\n      newOutlyingLists.splice(i, 1);\n\n      length--;\n      i--;\n    }\n  }\n\n  return newOutlyingLists;\n}\n\nexport function extractMessageText(message: ApiMessage | ApiStory, inChatList = false) {\n  const contentText = message.content.text;\n  if (!contentText) return undefined;\n\n  const { text } = contentText;\n  let { entities } = contentText;\n\n  if (text && 'chatId' in message) {\n    if (message.chatId === SERVICE_NOTIFICATIONS_USER_ID) {\n      const authCode = text.match(/^\\D*([\\d-]{5,7})\\D/)?.[1];\n      if (authCode) {\n        entities = [\n          ...entities || [],\n          {\n            type: inChatList ? ApiMessageEntityTypes.Spoiler : ApiMessageEntityTypes.Code,\n            offset: text.indexOf(authCode),\n            length: authCode.length,\n          },\n        ];\n        entities.sort((a, b) => (a.offset > b.offset ? 1 : -1));\n      }\n    }\n\n    if (inChatList && message.chatId === VERIFICATION_CODES_USER_ID && entities) {\n      // Wrap code entities in spoiler\n      const hasCodeEntities = entities.some((entity) => entity.type === ApiMessageEntityTypes.Code);\n      if (hasCodeEntities) {\n        const oldEntities = entities;\n        entities = [];\n\n        for (let i = 0; i < oldEntities.length; i++) {\n          const entity = oldEntities[i];\n          if (entity.type === ApiMessageEntityTypes.Code) {\n            entities.push({\n              type: ApiMessageEntityTypes.Spoiler,\n              offset: entity.offset,\n              length: entity.length,\n            });\n          }\n          entities.push(entity);\n        }\n      }\n    }\n  }\n\n  return { text, entities };\n}\n\nexport function isExpiredMessage(message: ApiMessage) {\n  return message.content.action?.type === 'expired';\n}\n\nexport function hasMessageTtl(message: ApiMessage) {\n  return message.content?.ttlSeconds !== undefined;\n}\n\nexport function getAttachmentMediaType(attachment: ApiAttachment) {\n  if (SUPPORTED_AUDIO_CONTENT_TYPES.has(attachment.mimeType)) {\n    return 'audio';\n  }\n\n  if (attachment.shouldSendAsFile) return 'file';\n\n  if (SUPPORTED_PHOTO_CONTENT_TYPES.has(attachment.mimeType)) {\n    return 'photo';\n  }\n\n  if (SUPPORTED_VIDEO_CONTENT_TYPES.has(attachment.mimeType)) {\n    return 'video';\n  }\n\n  return 'file';\n}\n\nexport function isUploadingFileSticker(attachment: ApiAttachment) {\n  return attachment ? (attachment.mimeType === 'image/webp' || attachment.mimeType === LOTTIE_STICKER_MIME_TYPE\n    || attachment.mimeType === VIDEO_STICKER_MIME_TYPE) : undefined;\n}\n\nexport function getMessageLink(peer: ApiPeer, topicId?: ThreadId, messageId?: number) {\n  const chatUsername = getMainUsername(peer);\n\n  const normalizedId = getCleanPeerId(peer.id);\n\n  const chatPart = chatUsername || `c/${normalizedId}`;\n  const topicPart = topicId && topicId !== MAIN_THREAD_ID ? `/${topicId}` : '';\n  const messagePart = messageId ? `/${messageId}` : '';\n  return `${TME_LINK_PREFIX}${chatPart}${topicPart}${messagePart}`;\n}\n\nexport function splitMessagesForForwarding(messages: ApiMessage[], limit: number): ApiMessage[][] {\n  const result: ApiMessage[][] = [];\n  let currentArr: ApiMessage[] = [];\n\n  // Group messages by `groupedId`\n  messages.reduce<ApiMessage[][]>((acc, message) => {\n    const lastGroup = acc[acc.length - 1];\n    if (message.groupedId && lastGroup?.[0]?.groupedId === message.groupedId) {\n      lastGroup.push(message);\n      return acc;\n    }\n\n    acc.push([message]);\n    return acc;\n  }, []).forEach((batch) => {\n    // Fit them into `limit` size\n    if (currentArr.length + batch.length > limit) {\n      result.push(currentArr);\n      currentArr = [];\n    }\n\n    currentArr.push(...batch);\n  });\n\n  if (currentArr.length) {\n    result.push(currentArr);\n  }\n\n  return result;\n}\n","import type { ThreadId } from '../../types';\n\nexport function buildChatThreadKey(chatId: string, threadId: ThreadId) {\n  return `${chatId}_${threadId}`;\n}\n","import type {\n  ApiChat,\n  ApiNotifyPeerType,\n  ApiPeer,\n  ApiPeerNotifySettings,\n} from '../../api/types';\n\nimport { omitUndefined } from '../../util/iteratees';\nimport { getServerTime } from '../../util/serverTime';\nimport { isChatChannel, isUserId } from './chats';\n\nexport function getIsChatMuted(\n  chat: ApiChat,\n  notifyDefaults?: Record<ApiNotifyPeerType, ApiPeerNotifySettings>,\n  notifyException?: ApiPeerNotifySettings,\n) {\n  const settings = getChatNotifySettings(chat, notifyDefaults, notifyException);\n  if (!settings?.mutedUntil) return false;\n  return getServerTime() < settings.mutedUntil;\n}\n\nexport function getIsChatSilent(\n  chat: ApiChat,\n  notifyDefaults?: Record<ApiNotifyPeerType, ApiPeerNotifySettings>,\n  notifyException?: ApiPeerNotifySettings,\n) {\n  const settings = getChatNotifySettings(chat, notifyDefaults, notifyException);\n  if (!settings) return false;\n  return !settings.hasSound;\n}\n\nexport function getShouldShowMessagePreview(\n  chat: ApiChat,\n  notifyDefaults?: Record<ApiNotifyPeerType, ApiPeerNotifySettings>,\n  notifyException?: ApiPeerNotifySettings,\n) {\n  const settings = getChatNotifySettings(chat, notifyDefaults, notifyException);\n  return Boolean(settings?.shouldShowPreviews);\n}\n\nexport function getChatNotifySettings(\n  chat: ApiChat,\n  notifyDefaults?: Record<ApiNotifyPeerType, ApiPeerNotifySettings>,\n  notifyException?: ApiPeerNotifySettings,\n): ApiPeerNotifySettings | undefined {\n  const defaults = notifyDefaults?.[getNotificationPeerType(chat)];\n\n  if (!notifyException && !defaults) {\n    return undefined;\n  }\n\n  return {\n    ...defaults,\n    ...(notifyException && omitUndefined(notifyException)),\n  };\n}\n\nexport function getNotificationPeerType(peer: ApiPeer): ApiNotifyPeerType {\n  if (isUserId(peer.id)) {\n    return 'users';\n  }\n\n  const chat = peer as ApiChat;\n  return isChatChannel(chat) ? 'channels' : 'groups';\n}\n","import type { ApiMessage, ApiMessageReplyInfo, ApiStoryReplyInfo } from '../../api/types';\n\nexport function getMessageReplyInfo(message: ApiMessage): ApiMessageReplyInfo | undefined {\n  const { replyInfo } = message;\n  if (!replyInfo || replyInfo.type !== 'message') return undefined;\n  return replyInfo;\n}\n\nexport function getStoryReplyInfo(message: ApiMessage): ApiStoryReplyInfo | undefined {\n  const { replyInfo } = message;\n  if (!replyInfo || replyInfo.type !== 'story') return undefined;\n  return replyInfo;\n}\n","import type { ApiFormattedText } from '../../api/types';\nimport { ApiMessageEntityTypes } from '../../api/types';\n\nexport function getStickerHashById(stickerId: string, isPreview?: boolean) {\n  const base = `sticker${stickerId}`;\n  return !isPreview ? base : `${base}?size=m`;\n}\n\nexport function containsCustomEmoji(formattedText: ApiFormattedText) {\n  return formattedText.entities?.some((e) => e.type === ApiMessageEntityTypes.CustomEmoji);\n}\n\nexport function stripCustomEmoji(text: ApiFormattedText): ApiFormattedText {\n  if (!text.entities) return text;\n\n  const entities = text.entities.filter((entity) => entity.type !== ApiMessageEntityTypes.CustomEmoji);\n  return { ...text, entities };\n}\n","import type { ApiPeer, ApiUser, ApiUserStatus } from '../../api/types';\nimport type { OldLangFn } from '../../hooks/useOldLang';\n\nimport { ANONYMOUS_USER_ID, SERVICE_NOTIFICATIONS_USER_ID } from '../../config';\nimport { formatFullDate, formatTime } from '../../util/dates/dateFormat';\nimport { DAY } from '../../util/dates/units';\nimport { orderBy } from '../../util/iteratees';\nimport { formatPhoneNumber } from '../../util/phoneNumber';\nimport { getServerTime, getServerTimeOffset } from '../../util/serverTime';\n\nexport function getUserFirstOrLastName(user?: ApiUser) {\n  if (!user) {\n    return undefined;\n  }\n\n  switch (user.type) {\n    case 'userTypeBot':\n      return user.firstName;\n    case 'userTypeRegular': {\n      return user.firstName || user.lastName;\n    }\n\n    case 'userTypeDeleted':\n    case 'userTypeUnknown': {\n      return 'Deleted';\n    }\n\n    default:\n      return undefined;\n  }\n}\n\nexport function getUserFullName(user?: ApiUser) {\n  if (!user) {\n    return undefined;\n  }\n\n  if (isDeletedUser(user)) {\n    return 'Deleted Account';\n  }\n\n  switch (user.type) {\n    case 'userTypeBot':\n    case 'userTypeRegular': {\n      if (user.firstName && user.lastName) {\n        return `${user.firstName} ${user.lastName}`;\n      }\n\n      if (user.firstName) {\n        return user.firstName;\n      }\n\n      if (user.lastName) {\n        return user.lastName;\n      }\n\n      if (user.phoneNumber) {\n        return `+${formatPhoneNumber(user.phoneNumber)}`;\n      }\n\n      break;\n    }\n  }\n\n  return undefined;\n}\n\nexport function getUserStatus(\n  lang: OldLangFn, user: ApiUser, userStatus: ApiUserStatus | undefined,\n) {\n  if (user.id === SERVICE_NOTIFICATIONS_USER_ID) {\n    return lang('ServiceNotifications');\n  }\n\n  if (user.isSupport) {\n    return lang('SupportStatus');\n  }\n\n  if (user.type && user.type === 'userTypeBot') {\n    if (user.botActiveUsers) {\n      return lang('BotUsers', user.botActiveUsers, 'i');\n    }\n    return lang('Bot');\n  }\n\n  if (!userStatus) {\n    return '';\n  }\n\n  switch (userStatus.type) {\n    case 'userStatusEmpty': {\n      return lang('ALongTimeAgo');\n    }\n\n    case 'userStatusLastMonth': {\n      return lang('WithinAMonth');\n    }\n\n    case 'userStatusLastWeek': {\n      return lang('WithinAWeek');\n    }\n\n    case 'userStatusOffline': {\n      const { wasOnline } = userStatus;\n\n      if (!wasOnline) return lang('LastSeen.Offline');\n\n      const serverTimeOffset = getServerTimeOffset();\n      const now = new Date(Date.now() + serverTimeOffset * 1000);\n      const wasOnlineDate = new Date(wasOnline * 1000);\n\n      if (wasOnlineDate >= now) {\n        return lang('LastSeen.JustNow');\n      }\n\n      const diff = new Date(now.getTime() - wasOnlineDate.getTime());\n\n      // within a minute\n      if (diff.getTime() / 1000 < 60) {\n        return lang('LastSeen.JustNow');\n      }\n\n      // within an hour\n      if (diff.getTime() / 1000 < 60 * 60) {\n        const minutes = Math.floor(diff.getTime() / 1000 / 60);\n        return lang('LastSeen.MinutesAgo', minutes);\n      }\n\n      // today\n      const today = new Date();\n      today.setHours(0, 0, 0, 0);\n      const serverToday = new Date(today.getTime() + serverTimeOffset * 1000);\n      if (wasOnlineDate > serverToday) {\n        // up to 6 hours ago\n        if (diff.getTime() / 1000 < 6 * 60 * 60) {\n          const hours = Math.floor(diff.getTime() / 1000 / 60 / 60);\n          return lang('LastSeen.HoursAgo', hours);\n        }\n\n        // other\n        return lang('LastSeen.TodayAt', formatTime(lang, wasOnlineDate));\n      }\n\n      // yesterday\n      const yesterday = new Date();\n      yesterday.setDate(now.getDate() - 1);\n      yesterday.setHours(0, 0, 0, 0);\n      const serverYesterday = new Date(yesterday.getTime() + serverTimeOffset * 1000);\n      if (wasOnlineDate > serverYesterday) {\n        return lang('LastSeen.YesterdayAt', formatTime(lang, wasOnlineDate));\n      }\n\n      return lang('LastSeen.AtDate', formatFullDate(lang, wasOnlineDate));\n    }\n\n    case 'userStatusOnline': {\n      return lang('Online');\n    }\n\n    case 'userStatusRecently': {\n      return lang('Lately');\n    }\n\n    default:\n      return undefined;\n  }\n}\n\nexport function isUserOnline(user: ApiUser, userStatus?: ApiUserStatus, withSelfOnline = false) {\n  const { id, type } = user;\n\n  if (!userStatus) {\n    return false;\n  }\n\n  if (id === SERVICE_NOTIFICATIONS_USER_ID) {\n    return false;\n  }\n\n  if (user.isSelf && !withSelfOnline) {\n    return false;\n  }\n\n  return userStatus.type === 'userStatusOnline' && type !== 'userTypeBot';\n}\n\nexport function isDeletedUser(user: ApiUser) {\n  return (user.type === 'userTypeDeleted' || user.type === 'userTypeUnknown')\n    && user.id !== SERVICE_NOTIFICATIONS_USER_ID;\n}\n\nexport function isUserBot(user: ApiUser) {\n  return user.type === 'userTypeBot';\n}\n\nexport function getCanAddContact(user: ApiUser) {\n  return !user.isSelf && !user.isContact && !isUserBot(user) && user.id !== ANONYMOUS_USER_ID;\n}\n\nexport function sortUserIds(\n  userIds: string[],\n  usersById: Record<string, ApiUser>,\n  userStatusesById: Record<string, ApiUserStatus>,\n  priorityIds?: string[],\n) {\n  return orderBy(userIds, (id) => {\n    const now = getServerTime();\n\n    if (priorityIds && priorityIds.includes(id)) {\n      // Assuming that online status expiration date can't be as far as two days from now,\n      // this should place prioritized on top of the list.\n      // Then we subtract index of `id` in `priorityIds` to preserve selected order\n      return now + (48 * 60 * 60) - (priorityIds.length - priorityIds.indexOf(id));\n    }\n\n    const user = usersById[id];\n    const userStatus = userStatusesById[id];\n    if (!user || !userStatus) {\n      return 0;\n    }\n\n    if (userStatus.type === 'userStatusOnline') {\n      return userStatus.expires;\n    } else if (userStatus.type === 'userStatusOffline' && userStatus.wasOnline) {\n      return userStatus.wasOnline;\n    }\n\n    switch (userStatus.type) {\n      case 'userStatusRecently':\n        return now - DAY;\n      case 'userStatusLastWeek':\n        return now - DAY * 7;\n      case 'userStatusLastMonth':\n        return now - DAY * 7 * 30;\n      default:\n        return 0;\n    }\n  }, 'desc');\n}\n\nexport function getMainUsername(userOrChat: ApiPeer) {\n  return userOrChat.usernames?.find((u) => u.isActive)?.username;\n}\n\nexport function getPeerStoryHtmlId(userId: string) {\n  return `peer-story${userId}`;\n}\n","import type { ActionOptions } from '../lib/teact/teactn';\nimport { typify } from '../lib/teact/teactn';\n\nimport type {\n  ActionPayloads, GlobalState, RequiredActionPayloads, RequiredGlobalState,\n} from './types';\n\nconst typed = typify<GlobalState, ActionPayloads & RequiredActionPayloads>();\n\ntype ProjectActionTypes =\n  ActionPayloads\n  & RequiredActionPayloads;\n\ntype ProjectActionNames = keyof ProjectActionTypes;\n\ntype Helper<T, E> = Exclude<T, E> extends never ? {} : Exclude<T, E>;\n\nexport type TabStateActionNames = {\n  [ActionName in ProjectActionNames]:\n  'tabId' extends keyof Helper<ProjectActionTypes[ActionName], undefined> ? ActionName : never\n}[ProjectActionNames];\n// `Required` actions are called from actions to ensure the `tabId` is always provided if needed.\n// There are three types of actions:\n// 1. With tabId, which is made required when calling action from another action handler\n// 2. Without payload (= undefined), hence made the payload not required\n// 3. With payload, hence made the payload required\nexport type RequiredGlobalActions = {\n  [ActionName in ProjectActionNames]: ActionName extends TabStateActionNames ? ((\n    payload: ProjectActionTypes[ActionName] & { tabId: number },\n    options?: ActionOptions,\n  ) => void) :\n    (undefined extends ProjectActionTypes[ActionName] ? (\n      (payload?: ProjectActionTypes[ActionName], options?: ActionOptions) => void\n    ) : (\n      (payload: ProjectActionTypes[ActionName], options?: ActionOptions) => void\n    ))\n} & { _: never };\n\ntype ActionHandlers = {\n  [ActionName in keyof ProjectActionTypes]: (\n    global: RequiredGlobalState,\n    actions: RequiredGlobalActions,\n    payload: ProjectActionTypes[ActionName],\n  ) => GlobalState | void | Promise<void>;\n};\n\nexport const getGlobal = typed.getGlobal;\nexport const setGlobal = typed.setGlobal;\nexport const getActions = typed.getActions;\nexport const addActionHandler = typed.addActionHandler as <ActionName extends ProjectActionNames>(\n  name: ActionName,\n  handler: ActionHandlers[ActionName],\n) => void;\nexport const withGlobal = typed.withGlobal;\nexport type GlobalActions = ReturnType<typeof getActions>;\n","import type { PerformanceType } from '../types';\nimport type { GlobalState, TabState } from './types';\nimport { NewChatMembersProgress } from '../types';\n\nimport {\n  ANIMATION_LEVEL_DEFAULT,\n  DARK_THEME_PATTERN_COLOR,\n  DEFAULT_GIFT_PROFILE_FILTER_OPTIONS,\n  DEFAULT_MESSAGE_TEXT_SIZE_PX,\n  DEFAULT_PATTERN_COLOR,\n  DEFAULT_PLAYBACK_RATE,\n  DEFAULT_VOLUME,\n  IOS_DEFAULT_MESSAGE_TEXT_SIZE_PX,\n  MACOS_DEFAULT_MESSAGE_TEXT_SIZE_PX,\n} from '../config';\nimport { IS_IOS, IS_MAC_OS } from '../util/windowEnvironment';\n\nexport const INITIAL_PERFORMANCE_STATE_MAX: PerformanceType = {\n  animatedEmoji: true,\n  autoplayGifs: true,\n  autoplayVideos: true,\n  contextMenuAnimations: true,\n  contextMenuBlur: true,\n  loopAnimatedStickers: true,\n  mediaViewerAnimations: true,\n  messageComposerAnimations: true,\n  messageSendingAnimations: true,\n  pageTransitions: true,\n  reactionEffects: true,\n  rightColumnAnimations: true,\n  stickerEffects: true,\n  storyRibbonAnimations: true,\n  snapEffect: true,\n};\n\nexport const INITIAL_PERFORMANCE_STATE_MID: PerformanceType = {\n  animatedEmoji: true,\n  autoplayGifs: true,\n  autoplayVideos: true,\n  contextMenuAnimations: true,\n  contextMenuBlur: true,\n  loopAnimatedStickers: true,\n  mediaViewerAnimations: true,\n  messageComposerAnimations: true,\n  messageSendingAnimations: true,\n  pageTransitions: true,\n  reactionEffects: true,\n  rightColumnAnimations: false,\n  stickerEffects: false,\n  storyRibbonAnimations: false,\n  snapEffect: false,\n};\n\nexport const INITIAL_PERFORMANCE_STATE_MIN: PerformanceType = {\n  animatedEmoji: false,\n  autoplayGifs: false,\n  autoplayVideos: false,\n  contextMenuAnimations: false,\n  contextMenuBlur: false,\n  loopAnimatedStickers: false,\n  mediaViewerAnimations: false,\n  messageComposerAnimations: false,\n  messageSendingAnimations: false,\n  pageTransitions: false,\n  reactionEffects: false,\n  rightColumnAnimations: false,\n  stickerEffects: false,\n  storyRibbonAnimations: false,\n  snapEffect: false,\n};\n\nexport const INITIAL_GLOBAL_STATE: GlobalState = {\n  cacheVersion: 2,\n  isInited: true,\n  attachMenu: { bots: {} },\n  passcode: {},\n  twoFaSettings: {},\n  isAppUpdateAvailable: false,\n  isElectronUpdateAvailable: false,\n  shouldShowContextMenuHint: true,\n\n  audioPlayer: {\n    lastPlaybackRate: DEFAULT_PLAYBACK_RATE,\n  },\n\n  mediaViewer: {\n    lastPlaybackRate: DEFAULT_PLAYBACK_RATE,\n  },\n\n  authRememberMe: true,\n  countryList: {\n    phoneCodes: [],\n    general: [],\n  },\n\n  blocked: {\n    ids: [],\n    totalCount: 0,\n  },\n\n  users: {\n    byId: {},\n    statusesById: {},\n    fullInfoById: {},\n    previewMediaByBotId: {},\n    commonChatsById: {},\n    botAppPermissionsById: {},\n  },\n\n  peers: {\n    profilePhotosById: {},\n  },\n\n  chats: {\n    listIds: {},\n    isFullyLoaded: {},\n    orderedPinnedIds: {},\n    totalCount: {},\n    lastMessageIds: {},\n    byId: {},\n    fullInfoById: {},\n    similarChannelsById: {},\n    similarBotsById: {},\n    topicsInfoById: {},\n    notifyExceptionById: {},\n    loadingParameters: {\n      active: {},\n      archived: {},\n      saved: {},\n    },\n  },\n\n  messages: {\n    byChatId: {},\n    sponsoredByChatId: {},\n    pollById: {},\n    playbackByChatId: {},\n  },\n\n  stories: {\n    byPeerId: {},\n    orderedPeerIds: {\n      archived: [],\n      active: [],\n    },\n    hasNext: true,\n    hasNextInArchive: true,\n    stealthMode: {},\n  },\n\n  groupCalls: {\n    byId: {},\n  },\n\n  attachmentSettings: {\n    shouldCompress: true,\n    shouldSendGrouped: true,\n    isInvertedMedia: undefined,\n    webPageMediaSize: undefined,\n  },\n\n  scheduledMessages: {\n    byChatId: {},\n  },\n\n  quickReplies: {\n    byId: {},\n    messagesById: {},\n  },\n\n  chatFolders: {\n    byId: {},\n    invites: {},\n  },\n\n  fileUploads: {\n    byMessageKey: {},\n  },\n\n  recentEmojis: ['grinning', 'kissing_heart', 'christmas_tree', 'brain', 'trophy', 'duck', 'cherries'],\n  recentCustomEmojis: ['5377305978079288312'],\n\n  reactions: {\n    defaultTags: [],\n    topReactions: [],\n    recentReactions: [],\n    effectReactions: [],\n    hash: {},\n  },\n  availableEffectById: {},\n\n  stickers: {\n    setsById: {},\n    added: {},\n    recent: {\n      stickers: [],\n    },\n    favorite: {\n      stickers: [],\n    },\n    greeting: {\n      stickers: [],\n    },\n    premium: {\n      stickers: [],\n    },\n    featured: {\n      setIds: [],\n    },\n    effect: {\n      stickers: [],\n      emojis: [],\n    },\n    forEmoji: {},\n  },\n\n  customEmojis: {\n    lastRendered: [],\n    byId: {},\n    added: {},\n    forEmoji: {},\n    statusRecent: {},\n  },\n\n  emojiKeywords: {},\n\n  gifs: {\n    saved: {},\n  },\n\n  topPeers: {},\n\n  topInlineBots: {},\n  topBotApps: {},\n\n  activeSessions: {\n    byHash: {},\n    orderedHashes: [],\n  },\n\n  activeWebSessions: {\n    byHash: {},\n    orderedHashes: [],\n  },\n\n  settings: {\n    byKey: {\n      theme: 'light',\n      shouldUseSystemTheme: true,\n      messageTextSize: IS_IOS\n        ? IOS_DEFAULT_MESSAGE_TEXT_SIZE_PX\n        : (IS_MAC_OS ? MACOS_DEFAULT_MESSAGE_TEXT_SIZE_PX : DEFAULT_MESSAGE_TEXT_SIZE_PX),\n      animationLevel: ANIMATION_LEVEL_DEFAULT,\n      messageSendKeyCombo: 'enter',\n      canAutoLoadPhotoFromContacts: true,\n      canAutoLoadPhotoInPrivateChats: true,\n      canAutoLoadPhotoInGroups: true,\n      canAutoLoadPhotoInChannels: true,\n      canAutoLoadVideoFromContacts: true,\n      canAutoLoadVideoInPrivateChats: true,\n      canAutoLoadVideoInGroups: true,\n      canAutoLoadVideoInChannels: true,\n      canAutoLoadFileFromContacts: false,\n      canAutoLoadFileInPrivateChats: false,\n      canAutoLoadFileInGroups: false,\n      canAutoLoadFileInChannels: false,\n      autoLoadFileMaxSizeMb: 10,\n      hasWebNotifications: true,\n      hasPushNotifications: true,\n      notificationSoundVolume: 5,\n      shouldSuggestStickers: true,\n      shouldSuggestCustomEmoji: true,\n      shouldSkipWebAppCloseConfirmation: false,\n      shouldUpdateStickerSetOrder: true,\n      language: 'en',\n      timeFormat: '24h',\n      wasTimeFormatSetManually: false,\n      isConnectionStatusMinimized: true,\n      shouldArchiveAndMuteNewNonContact: false,\n      shouldNewNonContactPeersRequirePremium: false,\n      shouldHideReadMarks: false,\n      canTranslate: false,\n      canTranslateChats: true,\n      doNotTranslate: [],\n      canDisplayChatInTitle: true,\n      shouldAllowHttpTransport: true,\n      shouldWarnAboutSvg: true,\n    },\n    themes: {\n      light: {\n        isBlurred: true,\n        patternColor: DEFAULT_PATTERN_COLOR,\n      },\n      dark: {\n        isBlurred: true,\n        patternColor: DARK_THEME_PATTERN_COLOR,\n      },\n    },\n    performance: INITIAL_PERFORMANCE_STATE_MAX,\n    privacy: {},\n    botVerificationShownPeerIds: [],\n  },\n\n  serviceNotifications: [],\n  trustedBotIds: [],\n\n  transcriptions: {},\n  translations: {\n    byChatId: {},\n  },\n\n  byTabId: {},\n\n  archiveSettings: {\n    isMinimized: false,\n    isHidden: false,\n  },\n};\n\nexport const INITIAL_TAB_STATE: TabState = {\n  id: 0,\n  isMasterTab: false,\n  isLeftColumnShown: true,\n  isChatInfoShown: false,\n  newChatMembersProgress: NewChatMembersProgress.Closed,\n  uiReadyState: 0,\n  shouldInit: true,\n\n  gifSearch: {},\n  stickerSearch: {},\n\n  messageLists: [],\n  activeChatFolder: 0,\n  tabThreads: {},\n\n  inlineBots: {\n    isLoading: false,\n    byUsername: {},\n  },\n\n  webApps: {\n    openedWebApps: {},\n    openedOrderedKeys: [],\n    sessionKeys: [],\n    modalState: 'maximized',\n    isModalOpen: false,\n    isMoreAppsTabActive: false,\n  },\n\n  globalSearch: {},\n\n  userSearch: {},\n\n  middleSearch: {\n    byChatThreadKey: {},\n  },\n\n  sharedMediaSearch: {\n    byChatThreadKey: {},\n  },\n\n  chatMediaSearch: {\n    byChatThreadKey: {},\n  },\n\n  management: {\n    byChatId: {},\n  },\n\n  savedGifts: {\n    filter: {\n      ...DEFAULT_GIFT_PROFILE_FILTER_OPTIONS,\n    },\n    giftsByPeerId: {},\n  },\n\n  storyViewer: {\n    isMuted: true,\n    isRibbonShown: false,\n  },\n\n  mediaViewer: {\n    volume: DEFAULT_VOLUME,\n    playbackRate: DEFAULT_PLAYBACK_RATE,\n    isMuted: false,\n  },\n\n  audioPlayer: {\n    volume: DEFAULT_VOLUME,\n    playbackRate: DEFAULT_PLAYBACK_RATE,\n    isMuted: false,\n  },\n\n  isShareMessageModalShown: false,\n\n  isWebAppsCloseConfirmationModalOpen: false,\n\n  forwardMessages: {},\n\n  replyingMessage: {},\n\n  pollResults: {},\n\n  payment: {},\n  starsPayment: {},\n\n  notifications: [],\n\n  dialogs: [],\n\n  activeReactions: {},\n\n  activeDownloads: {},\n\n  statistics: {\n    byChatId: {},\n  },\n\n  pollModal: {\n    isOpen: false,\n  },\n\n  requestedTranslations: {\n    byChatId: {},\n  },\n};\n","import type {\n  ApiChat, ApiChatFullInfo, ApiChatMember,\n} from '../../api/types';\nimport type { ChatListType } from '../../types';\nimport type { GlobalState } from '../types';\n\nimport { ARCHIVED_FOLDER_ID } from '../../config';\nimport { areDeepEqual } from '../../util/areDeepEqual';\nimport {\n  areSortedArraysEqual, buildCollectionByKey, omit, omitUndefined, pick, unique,\n} from '../../util/iteratees';\nimport { selectChatFullInfo } from '../selectors';\n\nconst DEFAULT_CHAT_LISTS: ChatListType[] = ['active', 'archived'];\n\nexport function replaceChatListIds<T extends GlobalState>(\n  global: T,\n  type: ChatListType,\n  newIds: string[] | undefined,\n): T {\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      listIds: {\n        ...global.chats.listIds,\n        [type]: newIds,\n      },\n    },\n  };\n}\n\nexport function replaceChatListLoadingParameters<T extends GlobalState>(\n  global: T, type: ChatListType, nextOffsetId?: number, nextOffsetPeerId?: string, nextOffsetDate?: number,\n): T {\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      loadingParameters: {\n        ...global.chats.loadingParameters,\n        [type]: {\n          nextOffsetId,\n          nextOffsetPeerId,\n          nextOffsetDate,\n        },\n      },\n    },\n  };\n}\n\nexport function updateChatLastMessageId<T extends GlobalState>(\n  global: T, chatId: string, lastMessageId: number, listType?: ChatListType,\n): T {\n  const key = listType === 'saved' ? 'saved' : 'all';\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      lastMessageIds: {\n        ...global.chats.lastMessageIds,\n        [key]: {\n          ...global.chats.lastMessageIds[key],\n          [chatId]: lastMessageId,\n        },\n      },\n    },\n  };\n}\n\nexport function updateChatsLastMessageId<T extends GlobalState>(\n  global: T, messageIds: Record<string, number>, listType?: ChatListType,\n): T {\n  const key = listType === 'saved' ? 'saved' : 'all';\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      lastMessageIds: {\n        ...global.chats.lastMessageIds,\n        [key]: {\n          ...global.chats.lastMessageIds[key],\n          ...messageIds,\n        },\n      },\n    },\n  };\n}\n\nexport function addChatListIds<T extends GlobalState>(\n  global: T, type: ChatListType, idsUpdate: string[],\n): T {\n  const { [type]: listIds } = global.chats.listIds;\n  const newIds = listIds?.length\n    ? idsUpdate.filter((id) => !listIds.includes(id))\n    : idsUpdate;\n\n  if (listIds && !newIds.length) {\n    return global;\n  }\n\n  return replaceChatListIds(global, type, [\n    ...(listIds || []),\n    ...newIds,\n  ]);\n}\n\nexport function replaceChats<T extends GlobalState>(global: T, newById: Record<string, ApiChat>): T {\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      byId: newById,\n    },\n  };\n}\n\nexport function addUnreadMentions<T extends GlobalState>(\n  global: T, chatId: string, chat: ApiChat, ids: number[], shouldUpdateCount: boolean = false,\n): T {\n  const prevChatUnreadMentions = (chat.unreadMentions || []);\n  const updatedUnreadMentions = unique([...prevChatUnreadMentions, ...ids]).sort((a, b) => b - a);\n  global = updateChat(global, chatId, {\n    unreadMentions: updatedUnreadMentions,\n  });\n\n  if (shouldUpdateCount) {\n    const updatedUnreadMentionsCount = (chat.unreadMentionsCount || 0)\n    + Math.max(0, updatedUnreadMentions.length - prevChatUnreadMentions.length);\n\n    global = updateChat(global, chatId, {\n      unreadMentionsCount: updatedUnreadMentionsCount,\n    });\n  }\n  return global;\n}\n\nexport function removeUnreadMentions<T extends GlobalState>(\n  global: T, chatId: string, chat: ApiChat, ids: number[], shouldUpdateCount: boolean = false,\n): T {\n  const prevChatUnreadMentions = (chat.unreadMentions || []);\n  const updatedUnreadMentions = prevChatUnreadMentions?.filter((id) => !ids.includes(id));\n\n  global = updateChat(global, chatId, {\n    unreadMentions: updatedUnreadMentions,\n  });\n\n  if (shouldUpdateCount && chat.unreadMentionsCount) {\n    const removedCount = prevChatUnreadMentions.length - updatedUnreadMentions.length;\n    const updatedUnreadMentionsCount = Math.max(chat.unreadMentionsCount - removedCount, 0) || undefined;\n\n    global = updateChat(global, chatId, {\n      unreadMentionsCount: updatedUnreadMentionsCount,\n    });\n  }\n  return global;\n}\n\nexport function updateChat<T extends GlobalState>(\n  global: T, chatId: string, chatUpdate: Partial<ApiChat>, noOmitUnreadReactionCount = false, withDeepCheck = false,\n): T {\n  const { byId } = global.chats;\n\n  const chat = byId[chatId];\n  if (withDeepCheck && chat) {\n    const updateKeys = Object.keys(chatUpdate) as (keyof ApiChat)[];\n    if (areDeepEqual(pick(chat, updateKeys), chatUpdate)) {\n      return global;\n    }\n  }\n\n  const updatedChat = getUpdatedChat(global, chatId, chatUpdate, noOmitUnreadReactionCount);\n  if (!updatedChat) {\n    return global;\n  }\n\n  return replaceChats(global, {\n    ...byId,\n    [chatId]: updatedChat,\n  });\n}\n\nexport function updateChatFullInfo<T extends GlobalState>(\n  global: T, chatId: string, fullInfoUpdate: Partial<ApiChatFullInfo>,\n): T {\n  const currentFullInfo = selectChatFullInfo(global, chatId);\n  const updatedFullInfo = {\n    ...currentFullInfo,\n    ...fullInfoUpdate,\n  };\n\n  if (areDeepEqual(currentFullInfo, updatedFullInfo)) {\n    return global;\n  }\n\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      fullInfoById: {\n        ...global.chats.fullInfoById,\n        [chatId]: updatedFullInfo,\n      },\n    },\n  };\n}\n\nexport function replaceChatFullInfo<T extends GlobalState>(global: T, chatId: string, fullInfo: ApiChatFullInfo): T {\n  const currentFullInfo = selectChatFullInfo(global, chatId);\n\n  if (areDeepEqual(currentFullInfo, fullInfo)) {\n    return global;\n  }\n\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      fullInfoById: {\n        ...global.chats.fullInfoById,\n        [chatId]: fullInfo,\n      },\n    },\n  };\n}\n\nexport function updateChats<T extends GlobalState>(global: T, newById: Record<string, ApiChat>): T {\n  const updatedById = Object.keys(newById).reduce((acc: Record<string, ApiChat>, id) => {\n    const updatedChat = getUpdatedChat(global, id, newById[id]);\n    if (updatedChat) {\n      acc[id] = updatedChat;\n    }\n\n    return acc;\n  }, {});\n\n  global = replaceChats(global, {\n    ...global.chats.byId,\n    ...updatedById,\n  });\n\n  return global;\n}\n\n// @optimization Allows to avoid redundant updates which cause a lot of renders\nexport function addChats<T extends GlobalState>(global: T, newById: Record<string, ApiChat>): T {\n  const { byId } = global.chats;\n  let isUpdated = false;\n\n  const addedById = Object.keys(newById).reduce<Record<string, ApiChat>>((acc, id) => {\n    const existingChat = byId[id];\n    const newChat = newById[id];\n\n    const membersCountChanged = !existingChat?.membersCount && newChat.membersCount;\n\n    if (existingChat && !existingChat.isMin && !membersCountChanged\n        && (newChat.isMin || existingChat.accessHash === newChat.accessHash)) {\n      return acc;\n    }\n\n    const updatedChat = getUpdatedChat(global, id, newChat);\n    if (updatedChat) {\n      acc[id] = updatedChat;\n      if (!isUpdated) {\n        isUpdated = true;\n      }\n    }\n\n    return acc;\n  }, {});\n\n  if (!isUpdated) {\n    return global;\n  }\n\n  global = replaceChats(global, {\n    ...byId,\n    ...addedById,\n  });\n\n  return global;\n}\n\n// @optimization Don't spread/unspread global for each element, do it in a batch\nfunction getUpdatedChat<T extends GlobalState>(\n  global: T, chatId: string, chatUpdate: Partial<ApiChat>,\n  noOmitUnreadReactionCount = false,\n) {\n  const { byId } = global.chats;\n  const chat = byId[chatId];\n  const omitProps: (keyof ApiChat)[] = [];\n\n  if (chatUpdate.isMin && chat && !chat.isMin) {\n    return undefined; // Do not apply updates from min constructor\n  }\n\n  if (!noOmitUnreadReactionCount) {\n    omitProps.push('unreadReactionsCount');\n  }\n\n  if (areDeepEqual(chat?.usernames, chatUpdate.usernames)) {\n    omitProps.push('usernames');\n  }\n\n  const updatedChat: ApiChat = {\n    ...chat,\n    ...omit(chatUpdate, omitProps),\n  } as ApiChat;\n\n  if (!updatedChat.id || !updatedChat.type) {\n    return undefined;\n  }\n\n  return omitUndefined(updatedChat);\n}\n\nexport function updateChatListType<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  folderId?: number,\n): T {\n  const listType = folderId === ARCHIVED_FOLDER_ID ? 'archived' : 'active';\n\n  let currentListIds = global.chats.listIds;\n  (Object.keys(currentListIds) as Array<keyof typeof currentListIds>).forEach((listTypeKey) => {\n    const currentFolderList = currentListIds[listTypeKey] || [];\n    if (listTypeKey === listType && !currentFolderList.includes(chatId)) {\n      currentListIds = {\n        ...currentListIds,\n        [listTypeKey]: [...currentFolderList, chatId],\n      };\n    } else if (listTypeKey !== listType && currentFolderList.includes(chatId)) {\n      currentListIds = {\n        ...currentListIds,\n        [listTypeKey]: currentFolderList.filter((id) => id !== chatId),\n      };\n    }\n  });\n\n  global = {\n    ...global,\n    chats: {\n      ...global.chats,\n      listIds: currentListIds,\n    },\n  };\n\n  global = updateChat(global, chatId, { folderId: folderId || undefined });\n\n  return global;\n}\n\nexport function updateChatListSecondaryInfo<T extends GlobalState>(\n  global: T,\n  type: ChatListType,\n  info: {\n    orderedPinnedIds?: string[];\n    totalChatCount: number;\n  },\n): T {\n  const totalCountKey = type === 'active' ? 'all' : type;\n\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      ...(info.orderedPinnedIds && {\n        orderedPinnedIds: {\n          ...global.chats.orderedPinnedIds,\n          [type]: info.orderedPinnedIds,\n        },\n      }),\n      totalCount: {\n        ...global.chats.totalCount,\n        [totalCountKey]: info.totalChatCount,\n      },\n    },\n  };\n}\n\nexport function leaveChat<T extends GlobalState>(global: T, leftChatId: string): T {\n  global = removeChatFromChatLists(global, leftChatId);\n\n  global = updateChat(global, leftChatId, { isNotJoined: true });\n  global = updateChatFullInfo(global, leftChatId, { joinInfo: undefined });\n\n  return global;\n}\n\nexport function removeChatFromChatLists<T extends GlobalState>(\n  global: T, chatId: string, type: 'all' | 'saved' = 'all',\n): T {\n  const chatLists = type === 'all' ? DEFAULT_CHAT_LISTS : [type];\n  chatLists.forEach((listType) => {\n    global = replaceChatListIds(global, listType, global.chats.listIds[listType]?.filter((id) => id !== chatId));\n  });\n\n  return global;\n}\n\nexport function addChatMembers<T extends GlobalState>(global: T, chat: ApiChat, membersToAdd: ApiChatMember[]): T {\n  const currentMembers = selectChatFullInfo(global, chat.id)?.members;\n  const newMemberIds = new Set(membersToAdd.map((m) => m.userId));\n  const updatedMembers = [\n    ...currentMembers?.filter(({ userId }) => !newMemberIds.has(userId)) || [],\n    ...membersToAdd,\n  ];\n  const currentIds = currentMembers?.map(({ userId }) => userId) || [];\n  const updatedIds = updatedMembers.map(({ userId }) => userId);\n\n  if (areSortedArraysEqual(currentIds, updatedIds)) {\n    return global;\n  }\n\n  const adminMembers = updatedMembers.filter(({ isAdmin, isOwner }) => isAdmin || isOwner);\n\n  return updateChatFullInfo(global, chat.id, {\n    members: updatedMembers,\n    adminMembersById: buildCollectionByKey(adminMembers, 'userId'),\n  });\n}\n\nexport function replaceSimilarChannels<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  similarChannelIds: string[],\n  count?: number,\n) {\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      similarChannelsById: {\n        ...global.chats.similarChannelsById,\n        [chatId]: {\n          similarChannelIds,\n          count: count || similarChannelIds.length,\n        },\n      },\n    },\n  };\n}\n\nexport function toggleSimilarChannels<T extends GlobalState>(\n  global: T,\n  chatId: string,\n) {\n  const similarChannels = global.chats.similarChannelsById[chatId];\n\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      similarChannelsById: {\n        ...global.chats.similarChannelsById,\n        [chatId]: {\n          ...similarChannels,\n          isExpanded: !similarChannels?.isExpanded,\n        },\n      },\n    },\n  };\n}\n\nexport function addSimilarBots<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  similarBotsIds: string[],\n  count?: number,\n) {\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      similarBotsById: {\n        ...global.chats.similarBotsById,\n        [chatId]: {\n          similarBotsIds,\n          count,\n        },\n      },\n    },\n  };\n}\n","import type { ApiSticker, ApiStickerSet, ApiVideo } from '../../api/types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { buildCollectionByKey, unique } from '../../util/iteratees';\nimport { selectCustomEmojiForEmoji, selectStickersForEmoji, selectTabState } from '../selectors';\nimport { updateTabState } from './tabs';\n\nexport function updateStickerSearch<T extends GlobalState>(\n  global: T,\n  hash: string,\n  resultIds?: string[],\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    stickerSearch: {\n      ...selectTabState(global, tabId).stickerSearch,\n      hash,\n      resultIds,\n    },\n  }, tabId);\n}\n\nexport function updateStickerSets<T extends GlobalState>(\n  global: T,\n  category: 'added' | 'featured' | 'search',\n  hash: string,\n  sets: ApiStickerSet[],\n): T {\n  const updatedSets = sets.map((stickerSet) => {\n    const existing = global.stickers.setsById[stickerSet.id];\n    if (!existing) {\n      return stickerSet;\n    }\n\n    return {\n      ...existing,\n      ...stickerSet,\n    };\n  });\n\n  const regularSetIds = sets.map((set) => set.id);\n\n  if (category === 'search') {\n    return {\n      ...global,\n      stickers: {\n        ...global.stickers,\n        setsById: {\n          ...global.stickers.setsById,\n          ...buildCollectionByKey(updatedSets, 'id'),\n        },\n      },\n    };\n  }\n\n  return {\n    ...global,\n    stickers: {\n      ...global.stickers,\n      setsById: {\n        ...global.stickers.setsById,\n        ...buildCollectionByKey(updatedSets, 'id'),\n      },\n      [category]: {\n        ...global.stickers[category],\n        hash,\n        setIds: [\n          ...(global.stickers[category].setIds || []),\n          ...regularSetIds,\n        ],\n      },\n    },\n  };\n}\n\nexport function updateCustomEmojiSets<T extends GlobalState>(\n  global: T,\n  hash: string,\n  sets: ApiStickerSet[],\n): T {\n  const updatedSets = sets.map((stickerSet) => {\n    const existing = global.stickers.setsById[stickerSet.id];\n    if (!existing) {\n      return stickerSet;\n    }\n\n    return {\n      ...existing,\n      ...stickerSet,\n    };\n  });\n\n  const customEmojis = sets.map((set) => set.stickers).flat().filter(Boolean);\n  const addedSetIds = sets.map((set) => set.id);\n\n  return {\n    ...global,\n    stickers: {\n      ...global.stickers,\n      setsById: {\n        ...global.stickers.setsById,\n        ...buildCollectionByKey(updatedSets, 'id'),\n      },\n    },\n    customEmojis: {\n      ...global.customEmojis,\n      added: {\n        ...global.customEmojis.added,\n        hash,\n        setIds: [\n          ...(global.customEmojis.added.setIds || []),\n          ...addedSetIds,\n        ],\n      },\n      byId: {\n        ...global.customEmojis.byId,\n        ...buildCollectionByKey(customEmojis, 'id'),\n      },\n    },\n  };\n}\n\nexport function updateStickerSet<T extends GlobalState>(\n  global: T, stickerSetId: string, update: Partial<ApiStickerSet>,\n): T {\n  const currentStickerSet = global.stickers.setsById[stickerSetId] || {};\n  const isCustomEmoji = update.isEmoji || currentStickerSet.isEmoji;\n  const addedSets = (isCustomEmoji ? global.customEmojis.added.setIds : global.stickers.added.setIds) || [];\n  let setIds: string[] = addedSets;\n  if (update.installedDate && !update.isArchived && addedSets && !addedSets.includes(stickerSetId)) {\n    setIds = [stickerSetId, ...setIds];\n  }\n\n  if (!update.installedDate && addedSets?.includes(stickerSetId)) {\n    setIds = setIds.filter((id) => id !== stickerSetId);\n  }\n\n  const customEmojiById = isCustomEmoji && update.stickers && buildCollectionByKey(update.stickers, 'id');\n\n  return {\n    ...global,\n    stickers: {\n      ...global.stickers,\n      added: {\n        ...global.stickers.added,\n        ...(!isCustomEmoji && { setIds }),\n      },\n      setsById: {\n        ...global.stickers.setsById,\n        [stickerSetId]: {\n          ...currentStickerSet,\n          ...update,\n        },\n      },\n    },\n    customEmojis: {\n      ...global.customEmojis,\n      byId: {\n        ...global.customEmojis.byId,\n        ...customEmojiById,\n      },\n      added: {\n        ...global.customEmojis.added,\n        ...(isCustomEmoji && { setIds }),\n      },\n    },\n  };\n}\n\nexport function updateGifSearch<T extends GlobalState>(\n  global: T, isNew: boolean, results: ApiVideo[], nextOffset?: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const { results: currentResults } = selectTabState(global, tabId).gifSearch;\n\n  let newResults!: ApiVideo[];\n  if (isNew || !currentResults) {\n    newResults = results;\n  } else {\n    const currentIds = new Set(currentResults.map((gif) => gif.id));\n    newResults = [\n      ...currentResults,\n      ...results.filter((gif) => !currentIds.has(gif.id)),\n    ];\n  }\n\n  return updateTabState(global, {\n    gifSearch: {\n      ...selectTabState(global, tabId).gifSearch,\n      offset: nextOffset,\n      results: newResults,\n    },\n  }, tabId);\n}\n\nexport function replaceAnimatedEmojis<T extends GlobalState>(global: T, stickerSet: ApiStickerSet): T {\n  return {\n    ...global,\n    animatedEmojis: stickerSet,\n  };\n}\n\nexport function updateStickersForEmoji<T extends GlobalState>(\n  global: T, emoji: string, remoteStickers?: ApiSticker[], hash?: string,\n): T {\n  const localStickers = selectStickersForEmoji(global, emoji);\n  const allStickers = [...localStickers, ...(remoteStickers || [])];\n  const uniqueIds = unique(allStickers.map(({ id }) => id));\n  const byId = buildCollectionByKey(allStickers, 'id');\n  const stickers = uniqueIds.map((id) => byId[id]);\n\n  return {\n    ...global,\n    stickers: {\n      ...global.stickers,\n      forEmoji: {\n        emoji,\n        stickers,\n        hash,\n      },\n    },\n  };\n}\n\nexport function updateCustomEmojiForEmoji<T extends GlobalState>(\n  global: T, emoji: string,\n): T {\n  const localStickers = selectCustomEmojiForEmoji(global, emoji);\n  const uniqueIds = unique(localStickers.map(({ id }) => id));\n  const byId = buildCollectionByKey(localStickers, 'id');\n  const stickers = uniqueIds.map((id) => byId[id]);\n\n  return {\n    ...global,\n    customEmojis: {\n      ...global.customEmojis,\n      forEmoji: {\n        emoji,\n        stickers,\n      },\n    },\n  };\n}\n\nexport function updateRecentStatusCustomEmojis<T extends GlobalState>(\n  global: T, hash: string, emojis: ApiSticker[],\n): T {\n  return {\n    ...global,\n    customEmojis: {\n      ...global.customEmojis,\n      statusRecent: {\n        ...global.customEmojis.statusRecent,\n        hash,\n        emojis,\n      },\n    },\n  };\n}\n\nexport function rebuildStickersForEmoji<T extends GlobalState>(global: T): T {\n  if (global.stickers.forEmoji) {\n    const { emoji, stickers, hash } = global.stickers.forEmoji;\n    if (!emoji) {\n      return global;\n    }\n\n    return updateStickersForEmoji(global, emoji, stickers, hash);\n  }\n\n  if (global.customEmojis.forEmoji) {\n    const { emoji } = global.customEmojis.forEmoji;\n    if (!emoji) {\n      return global;\n    }\n\n    return updateCustomEmojiForEmoji(global, emoji);\n  }\n\n  return global;\n}\n","import type {\n  ApiMissingInvitedUser,\n  ApiSavedStarGift,\n  ApiUser,\n  ApiUserCommonChats,\n  ApiUserFullInfo,\n  ApiUserStatus,\n} from '../../api/types';\nimport type { BotAppPermissions } from '../../types';\nimport type { GlobalState, TabArgs, TabState } from '../types';\n\nimport { areDeepEqual } from '../../util/areDeepEqual';\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { omit, omitUndefined, unique } from '../../util/iteratees';\nimport { MEMO_EMPTY_ARRAY } from '../../util/memo';\nimport { selectTabState } from '../selectors';\nimport { updateChat } from './chats';\nimport { updateTabState } from './tabs';\n\nexport function replaceUsers<T extends GlobalState>(global: T, newById: Record<string, ApiUser>): T {\n  return {\n    ...global,\n    users: {\n      ...global.users,\n      byId: newById,\n    },\n  };\n}\n\nfunction updateContactList<T extends GlobalState>(global: T, updatedUsers: ApiUser[]): T {\n  const { userIds: contactUserIds } = global.contactList || {};\n\n  if (!contactUserIds) return global;\n\n  const contactUserIdsFromUpdate = updatedUsers\n    .filter((user) => user?.isContact)\n    .map((user) => user.id);\n\n  if (contactUserIdsFromUpdate.length === 0) return global;\n\n  return {\n    ...global,\n    contactList: {\n      userIds: unique([\n        ...contactUserIdsFromUpdate,\n        ...contactUserIds,\n      ]),\n    },\n  };\n}\n\nexport function updateUser<T extends GlobalState>(global: T, userId: string, userUpdate: Partial<ApiUser>): T {\n  const { byId } = global.users;\n\n  const updatedUser = getUpdatedUser(global, userId, userUpdate);\n  if (!updatedUser) {\n    return global;\n  }\n\n  global = updateContactList(global, [updatedUser]);\n\n  return replaceUsers(global, {\n    ...byId,\n    [userId]: updatedUser,\n  });\n}\n\nexport function updateUsers<T extends GlobalState>(global: T, newById: Record<string, ApiUser>): T {\n  const updatedById = Object.keys(newById).reduce((acc: Record<string, ApiUser>, id) => {\n    const updatedUser = getUpdatedUser(global, id, newById[id]);\n    if (updatedUser) {\n      acc[id] = updatedUser;\n    }\n\n    return acc;\n  }, {});\n\n  global = replaceUsers(global, {\n    ...global.users.byId,\n    ...updatedById,\n  });\n\n  global = updateContactList(global, Object.values(updatedById));\n\n  return global;\n}\n\n// @optimization Allows to avoid redundant updates which cause a lot of renders\nexport function addUsers<T extends GlobalState>(global: T, newById: Record<string, ApiUser>): T {\n  const { byId } = global.users;\n  let isUpdated = false;\n\n  const addedById = Object.keys(newById).reduce<Record<string, ApiUser>>((acc, id) => {\n    const existingUser = byId[id];\n    const newUser = newById[id];\n\n    if (existingUser && !existingUser.isMin && (newUser.isMin || existingUser.accessHash === newUser.accessHash)) {\n      return acc;\n    }\n\n    const updatedUser = getUpdatedUser(global, id, newUser);\n    if (updatedUser) {\n      acc[id] = updatedUser;\n      if (!isUpdated) {\n        isUpdated = true;\n      }\n    }\n\n    return acc;\n  }, {});\n\n  if (!isUpdated) {\n    return global;\n  }\n\n  global = replaceUsers(global, {\n    ...byId,\n    ...addedById,\n  });\n\n  global = updateContactList(global, Object.values(addedById));\n\n  return global;\n}\n\n// @optimization Don't spread/unspread global for each element, do it in a batch\nfunction getUpdatedUser(global: GlobalState, userId: string, userUpdate: Partial<ApiUser>) {\n  const { byId } = global.users;\n  const user = byId[userId];\n  const omitProps: (keyof ApiUser)[] = [];\n\n  if (userUpdate.isMin && user && !user.isMin) {\n    return undefined; // Do not apply updates from min constructor\n  }\n\n  if (areDeepEqual(user?.usernames, userUpdate.usernames)) {\n    omitProps.push('usernames');\n  }\n\n  const updatedUser = {\n    ...user,\n    ...omit(userUpdate, omitProps),\n  } as ApiUser;\n\n  if (!updatedUser.id || !updatedUser.type) {\n    return undefined;\n  }\n\n  return omitUndefined(updatedUser);\n}\n\nexport function deleteContact<T extends GlobalState>(global: T, userId: string): T {\n  const { byId } = global.users;\n  const { userIds } = global.contactList || {};\n\n  global = {\n    ...global,\n    contactList: {\n      userIds: userIds ? userIds.filter((id) => id !== userId) : MEMO_EMPTY_ARRAY,\n    },\n  };\n\n  global = replaceUsers(global, {\n    ...byId,\n    [userId]: {\n      ...byId[userId],\n      isContact: undefined,\n    },\n  });\n\n  global = {\n    ...global,\n    stories: {\n      ...global.stories,\n      orderedPeerIds: {\n        active: global.stories.orderedPeerIds.active.filter((id) => id !== userId),\n        archived: global.stories.orderedPeerIds.archived.filter((id) => id !== userId),\n      },\n    },\n  };\n\n  return updateChat(global, userId, {\n    settings: undefined,\n  });\n}\n\nexport function updateUserSearch<T extends GlobalState>(\n  global: T,\n  searchStatePartial: Partial<TabState['userSearch']>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    userSearch: {\n      ...selectTabState(global, tabId).userSearch,\n      ...searchStatePartial,\n    },\n  }, tabId);\n}\n\nexport function updateUserSearchFetchingStatus<T extends GlobalState>(\n  global: T, newState: boolean,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateUserSearch(global, {\n    fetchingStatus: newState,\n  }, tabId);\n}\n\nexport function updateUserBlockedState<T extends GlobalState>(global: T, userId: string, isBlocked: boolean): T {\n  const { fullInfoById } = global.users;\n  const fullInfo = fullInfoById[userId];\n  if (!fullInfo) {\n    return global;\n  }\n\n  return updateUserFullInfo(global, userId, { isBlocked });\n}\n\nexport function replaceUserStatuses<T extends GlobalState>(global: T, newById: Record<string, ApiUserStatus>): T {\n  return {\n    ...global,\n    users: {\n      ...global.users,\n      statusesById: newById,\n    },\n  };\n}\n\nexport function updateUserFullInfo<T extends GlobalState>(\n  global: T, userId: string, fullInfo: Partial<ApiUserFullInfo>,\n): T {\n  const userFullInfo = global.users.fullInfoById[userId];\n\n  return {\n    ...global,\n    users: {\n      ...global.users,\n      fullInfoById: {\n        ...global.users.fullInfoById,\n        [userId]: {\n          ...userFullInfo,\n          ...fullInfo,\n        },\n      },\n    },\n  };\n}\n\nexport function updateUserCommonChats<T extends GlobalState>(\n  global: T, userId: string, commonChats: ApiUserCommonChats,\n): T {\n  return {\n    ...global,\n    users: {\n      ...global.users,\n      commonChatsById: {\n        ...global.users.commonChatsById,\n        [userId]: commonChats,\n      },\n    },\n  };\n}\n\n// @optimization Allows to avoid redundant updates which cause a lot of renders\nexport function addUserStatuses<T extends GlobalState>(global: T, newById: Record<string, ApiUserStatus>): T {\n  const { statusesById } = global.users;\n\n  global = replaceUserStatuses(global, {\n    ...statusesById,\n    ...newById,\n  });\n\n  return global;\n}\n\nexport function closeNewContactDialog<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    newContact: undefined,\n  }, tabId);\n}\n\nexport function updateMissingInvitedUsers<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  missingUsers: ApiMissingInvitedUser[],\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  if (!missingUsers.length) {\n    return updateTabState(global, {\n      inviteViaLinkModal: undefined,\n    }, tabId);\n  }\n\n  return updateTabState(global, {\n    inviteViaLinkModal: {\n      missingUsers,\n      chatId,\n    },\n  }, tabId);\n}\n\nexport function updateBotAppPermissions<T extends GlobalState>(\n  global: T,\n  botId: string,\n  permissions: BotAppPermissions,\n): T {\n  const { botAppPermissionsById } = global.users;\n\n  return {\n    ...global,\n    users: {\n      ...global.users,\n      botAppPermissionsById: {\n        ...botAppPermissionsById,\n        [botId]: {\n          ...botAppPermissionsById[botId],\n          ...permissions,\n        },\n      },\n    },\n  };\n}\n\nexport function replacePeerSavedGifts<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  gifts: ApiSavedStarGift[],\n  nextOffset?: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const tabState = selectTabState(global, tabId);\n\n  return updateTabState(global, {\n    savedGifts: {\n      ...tabState.savedGifts,\n      giftsByPeerId: {\n        ...tabState.savedGifts.giftsByPeerId,\n        [peerId]: {\n          gifts,\n          nextOffset,\n        },\n      },\n    },\n  }, tabId);\n}\n","import type { ApiGlobalMessageSearchType, ApiMessage } from '../../api/types';\nimport type { GlobalSearchContent } from '../../types';\nimport type { GlobalState, TabArgs, TabState } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { areSortedArraysEqual } from '../../util/iteratees';\nimport { getSearchResultKey } from '../../util/keys/searchResultKey';\nimport { selectTabState } from '../selectors';\nimport { updateTabState } from './tabs';\n\nexport function updateGlobalSearch<T extends GlobalState>(\n  global: T,\n  searchStatePartial: Partial<TabState['globalSearch']>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    globalSearch: {\n      ...selectTabState(global, tabId).globalSearch,\n      ...searchStatePartial,\n    },\n  }, tabId);\n}\n\nexport function updateGlobalSearchContent<T extends GlobalState>(\n  global: T,\n  currentContent: GlobalSearchContent | undefined,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateGlobalSearch(global, { currentContent }, tabId);\n}\n\nexport function updateGlobalSearchResults<T extends GlobalState>(\n  global: T,\n  newFoundMessages: ApiMessage[],\n  totalCount: number,\n  type: ApiGlobalMessageSearchType,\n  nextOffsetRate?: number,\n  nextOffsetId?: number,\n  nextOffsetPeerId?: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const { resultsByType } = selectTabState(global, tabId).globalSearch || {};\n  const newFoundMessagesById = newFoundMessages.reduce((result, message) => {\n    result[getSearchResultKey(message)] = message;\n\n    return result;\n  }, {} as Record<string, ApiMessage>);\n  const foundIdsForType = resultsByType?.[type]?.foundIds;\n\n  if (foundIdsForType !== undefined\n    && Object.keys(newFoundMessagesById).every(\n      (newId) => foundIdsForType.includes(getSearchResultKey(newFoundMessagesById[newId])),\n    )\n  ) {\n    global = updateGlobalSearchFetchingStatus(global, { messages: false }, tabId);\n    return updateGlobalSearch(global, {\n      resultsByType: {\n        ...(selectTabState(global, tabId).globalSearch || {}).resultsByType,\n        [type]: {\n          foundIds: foundIdsForType,\n          totalCount,\n          nextOffsetId,\n          nextOffsetRate,\n          nextOffsetPeerId,\n        },\n      },\n    }, tabId);\n  }\n\n  const prevFoundIds = foundIdsForType || [];\n  const newFoundIds = newFoundMessages\n    .map((message) => getSearchResultKey(message))\n    .filter((id) => !prevFoundIds.includes(id));\n  const foundIds = Array.prototype.concat(prevFoundIds, newFoundIds);\n  const foundOrPrevFoundIds = areSortedArraysEqual(prevFoundIds, foundIds) ? prevFoundIds : foundIds;\n\n  global = updateGlobalSearchFetchingStatus(global, { messages: false }, tabId);\n\n  return updateGlobalSearch(global, {\n    resultsByType: {\n      ...(selectTabState(global, tabId).globalSearch || {}).resultsByType,\n      [type]: {\n        totalCount,\n        nextOffsetId,\n        nextOffsetRate,\n        nextOffsetPeerId,\n        foundIds: foundOrPrevFoundIds,\n      },\n    },\n  }, tabId);\n}\n\nexport function updateGlobalSearchFetchingStatus<T extends GlobalState>(\n  global: T, newState: { chats?: boolean; messages?: boolean; botApps?: boolean },\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateGlobalSearch(global, {\n    fetchingStatus: {\n      ...selectTabState(global, tabId).globalSearch.fetchingStatus,\n      ...newState,\n    },\n  }, tabId);\n}\n","import type { ManagementProgress, ManagementState } from '../../types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { selectTabState } from '../selectors';\nimport { updateTabState } from './tabs';\n\nexport function updateManagementProgress<T extends GlobalState>(\n  global: T, progress: ManagementProgress,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    management: {\n      ...selectTabState(global, tabId).management,\n      progress,\n    },\n  }, tabId);\n}\n\nexport function updateManagement<T extends GlobalState>(\n  global: T, chatId: string, update: Partial<ManagementState>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const { management } = selectTabState(global, tabId);\n  return updateTabState(global, {\n    management: {\n      ...management,\n      byChatId: {\n        ...management.byChatId,\n        [chatId]: {\n          ...(management.byChatId[chatId] || {}),\n          ...update,\n        },\n      },\n    },\n  }, tabId);\n}\n","import type { ApiNotifyPeerType, ApiPeerNotifySettings } from '../../api/types';\nimport type {\n  ISettings, IThemeSettings,\n  ThemeKey,\n} from '../../types';\nimport type { GlobalState } from '../types';\n\nimport { updateUserBlockedState } from './users';\n\nexport function replaceSettings<T extends GlobalState>(global: T, newSettings?: Partial<ISettings>): T {\n  return {\n    ...global,\n    settings: {\n      ...global.settings,\n      byKey: {\n        ...global.settings.byKey,\n        ...newSettings,\n      },\n    },\n  };\n}\n\nexport function replaceThemeSettings<T extends GlobalState>(\n  global: T, theme: ThemeKey, newSettings?: Partial<IThemeSettings>,\n): T {\n  return {\n    ...global,\n    settings: {\n      ...global.settings,\n      themes: {\n        ...global.settings.themes,\n        [theme]: {\n          ...(global.settings.themes[theme] || {}),\n          ...newSettings,\n        },\n      },\n    },\n  };\n}\n\nexport function addNotifyExceptions<T extends GlobalState>(\n  global: T, notifyExceptionById: Record<string, ApiPeerNotifySettings>,\n): T {\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      notifyExceptionById: {\n        ...global.chats.notifyExceptionById,\n        ...notifyExceptionById,\n      },\n    },\n  };\n}\n\nexport function replaceNotifyExceptions<T extends GlobalState>(\n  global: T, notifyExceptionById: Record<string, ApiPeerNotifySettings>,\n): T {\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      notifyExceptionById,\n    },\n  };\n}\n\nexport function addNotifyException<T extends GlobalState>(\n  global: T, id: string, notifyException: ApiPeerNotifySettings,\n): T {\n  return {\n    ...global,\n    chats: {\n      ...global.chats,\n      notifyExceptionById: {\n        ...global.chats.notifyExceptionById,\n        [id]: notifyException,\n      },\n    },\n  };\n}\n\nexport function updateNotifyDefaults<T extends GlobalState>(\n  global: T, peerType: ApiNotifyPeerType, settings: Partial<ApiPeerNotifySettings>,\n): T {\n  return {\n    ...global,\n    settings: {\n      ...global.settings,\n      notifyDefaults: {\n        ...global.settings.notifyDefaults,\n        [peerType]: {\n          ...global.settings.notifyDefaults?.[peerType],\n          ...settings,\n        },\n      },\n    },\n  };\n}\n\nexport function addBlockedUser<T extends GlobalState>(global: T, contactId: string): T {\n  global = updateUserBlockedState(global, contactId, true);\n\n  return {\n    ...global,\n    blocked: {\n      ...global.blocked,\n      ids: [contactId, ...global.blocked.ids],\n      totalCount: global.blocked.totalCount + 1,\n    },\n  };\n}\n\nexport function removeBlockedUser<T extends GlobalState>(global: T, contactId: string): T {\n  global = updateUserBlockedState(global, contactId, false);\n\n  return {\n    ...global,\n    blocked: {\n      ...global.blocked,\n      ids: global.blocked.ids.filter((id) => id !== contactId),\n      totalCount: global.blocked.totalCount - 1,\n    },\n  };\n}\n","import type { GlobalState } from '../types';\n\nexport function updateTwoFaSettings<T extends GlobalState>(\n  global: T,\n  update: GlobalState['twoFaSettings'],\n): T {\n  return {\n    ...global,\n    twoFaSettings: {\n      ...global.twoFaSettings,\n      ...update,\n    },\n  };\n}\n","import type { GlobalState, TabState } from '../types';\n\nimport { INITIAL_GLOBAL_STATE, INITIAL_TAB_STATE } from '../initialState';\n\nexport function updatePasscodeSettings<T extends GlobalState>(\n  global: T,\n  update: GlobalState['passcode'],\n): T {\n  return {\n    ...global,\n    passcode: {\n      ...global.passcode,\n      ...update,\n    },\n  };\n}\n\nexport function clearPasscodeSettings<T extends GlobalState>(global: T): T {\n  return {\n    ...global,\n    passcode: {},\n  };\n}\n\nexport function clearGlobalForLockScreen<T extends GlobalState>(global: T, withTabState = true): T {\n  const {\n    theme,\n    shouldUseSystemTheme,\n    animationLevel,\n    language,\n  } = global.settings.byKey;\n\n  return {\n    ...INITIAL_GLOBAL_STATE,\n    passcode: global.passcode,\n    settings: {\n      ...INITIAL_GLOBAL_STATE.settings,\n      byKey: {\n        ...INITIAL_GLOBAL_STATE.settings.byKey,\n        theme,\n        shouldUseSystemTheme,\n        animationLevel,\n        language,\n      },\n    },\n    ...(withTabState && {\n      byTabId: Object.values(global.byTabId).reduce((acc, { id: tabId, isMasterTab }) => {\n        acc[tabId] = { ...INITIAL_TAB_STATE, isMasterTab, id: tabId };\n        return acc;\n      }, {} as Record<number, TabState>),\n    }),\n  } as T;\n}\n","import type {\n  ApiReceiptRegular,\n  ApiReceiptStars,\n  ApiStarsAmount,\n  ApiStarsSubscription,\n  ApiStarsTransaction,\n} from '../../api/types';\nimport type {\n  PaymentStep,\n  ShippingOption,\n  StarsSubscriptions,\n  StarsTransactionType,\n} from '../../types';\nimport type {\n  GlobalState, TabArgs, TabState,\n} from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { selectStarsPayment, selectTabState } from '../selectors';\nimport { updateTabState } from './tabs';\n\nexport function updatePayment<T extends GlobalState>(\n  global: T, update: Partial<TabState['payment']>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    payment: {\n      ...selectTabState(global, tabId).payment,\n      ...update,\n    },\n  }, tabId);\n}\n\nexport function updateStarsPayment<T extends GlobalState>(\n  global: T, update: Partial<TabState['starsPayment']>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const starPayment = selectStarsPayment(global, tabId);\n  if (!starPayment) {\n    return global;\n  }\n\n  return updateTabState(global, {\n    starsPayment: {\n      ...starPayment,\n      ...update,\n    },\n  }, tabId);\n}\n\nexport function updateShippingOptions<T extends GlobalState>(\n  global: T,\n  shippingOptions: ShippingOption[],\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n\n): T {\n  return updatePayment(global, { shippingOptions }, tabId);\n}\n\nexport function setRequestInfoId<T extends GlobalState>(\n  global: T, id: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updatePayment(global, { requestId: id }, tabId);\n}\n\nexport function setPaymentStep<T extends GlobalState>(\n  global: T, step: PaymentStep,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updatePayment(global, { step }, tabId);\n}\n\nexport function setStripeCardInfo<T extends GlobalState>(\n  global: T, cardInfo: { type: string; id: string },\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updatePayment(global, { stripeCredentials: { ...cardInfo } }, tabId);\n}\n\nexport function setSmartGlocalCardInfo<T extends GlobalState>(\n  global: T,\n  cardInfo: { type: string; token: string },\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updatePayment(global, { smartGlocalCredentials: { ...cardInfo } }, tabId);\n}\n\nexport function setConfirmPaymentUrl<T extends GlobalState>(\n  global: T, url?: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updatePayment(global, { confirmPaymentUrl: url }, tabId);\n}\n\nexport function setReceipt<T extends GlobalState>(\n  global: T,\n  receipt?: ApiReceiptRegular,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  if (!receipt) {\n    return updatePayment(global, { receipt: undefined }, tabId);\n  }\n\n  return updatePayment(global, {\n    receipt,\n  }, tabId);\n}\n\nexport function clearPayment<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    payment: {},\n  }, tabId);\n}\n\nexport function clearStarPayment<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    starsPayment: {},\n  }, tabId);\n}\n\nexport function closeInvoice<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  global = updatePayment(global, {\n    isPaymentModalOpen: undefined,\n    isExtendedMedia: undefined,\n  }, tabId);\n  return global;\n}\n\nexport function updateStarsBalance<T extends GlobalState>(\n  global: T, balance: ApiStarsAmount,\n): T {\n  return {\n    ...global,\n    stars: {\n      ...global.stars,\n      balance,\n    },\n  };\n}\n\nexport function appendStarsTransactions<T extends GlobalState>(\n  global: T,\n  type: StarsTransactionType,\n  transactions: ApiStarsTransaction[],\n  nextOffset?: string,\n): T {\n  const history = global.stars?.history;\n  if (!history) {\n    return global;\n  }\n\n  const newTypeObject = {\n    transactions: (history[type]?.transactions || []).concat(transactions),\n    nextOffset,\n  };\n\n  return {\n    ...global,\n    stars: {\n      ...global.stars,\n      history: {\n        ...history,\n        [type]: newTypeObject,\n      },\n    },\n  };\n}\n\nexport function appendStarsSubscriptions<T extends GlobalState>(\n  global: T,\n  subscriptions: ApiStarsSubscription[],\n  nextOffset?: string,\n): T {\n  if (!global.stars) {\n    return global;\n  }\n\n  const newObject = {\n    list: (global.stars.subscriptions?.list || []).concat(subscriptions),\n    nextOffset,\n  } satisfies StarsSubscriptions;\n\n  return {\n    ...global,\n    stars: {\n      ...global.stars,\n      subscriptions: newObject,\n    },\n  };\n}\n\nexport function updateStarsSubscriptionLoading<T extends GlobalState>(\n  global: T, isLoading: boolean,\n): T {\n  const subscriptions = global.stars?.subscriptions;\n  if (!subscriptions) {\n    return global;\n  }\n\n  return {\n    ...global,\n    stars: {\n      ...global.stars,\n      subscriptions: {\n        ...subscriptions,\n        isLoading,\n      },\n    },\n  };\n}\n\nexport function openStarsTransactionModal<T extends GlobalState>(\n  global: T, transaction: ApiStarsTransaction, ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    starsTransactionModal: {\n      transaction,\n    },\n  }, tabId);\n}\n\nexport function openStarsTransactionFromReceipt<T extends GlobalState>(\n  global: T, receipt: ApiReceiptStars, ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const transaction: ApiStarsTransaction = {\n    id: receipt.transactionId,\n    peer: {\n      type: 'peer',\n      id: receipt.botId,\n    },\n    stars: {\n      amount: receipt.totalAmount,\n      nanos: 0,\n    },\n    date: receipt.date,\n    title: receipt.title,\n    description: receipt.description,\n    photo: receipt.photo,\n  };\n\n  return openStarsTransactionModal(global, transaction, tabId);\n}\n","import type {\n  ApiChannelMonetizationStatistics,\n  ApiChannelStatistics, ApiGroupStatistics, ApiPostStatistics, StatisticsGraph,\n} from '../../api/types';\nimport type { GlobalState, TabArgs, TabState } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { selectTabState } from '../selectors';\nimport { updateTabState } from './tabs';\n\nexport function updateStatistics<T extends GlobalState>(\n  global: T, chatId: string, statistics: ApiChannelStatistics | ApiGroupStatistics,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    statistics: {\n      byChatId: {\n        ...selectTabState(global, tabId).statistics.byChatId,\n        [chatId]: statistics,\n      },\n    },\n  }, tabId);\n}\n\nexport function updateMessageStatistics<T extends GlobalState>(\n  global: T, statistics: ApiPostStatistics,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    statistics: {\n      ...selectTabState(global, tabId).statistics,\n      currentMessage: statistics,\n      currentStory: undefined,\n    },\n  }, tabId);\n}\n\nexport function updateStoryStatistics<T extends GlobalState>(\n  global: T, statistics: ApiPostStatistics,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    statistics: {\n      ...selectTabState(global, tabId).statistics,\n      currentStory: statistics,\n      currentMessage: undefined,\n    },\n  }, tabId);\n}\n\nexport function updateStatisticsGraph<T extends GlobalState>(\n  global: T, chatId: string, name: string, update: StatisticsGraph,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const { statistics } = selectTabState(global, tabId);\n  return updateTabState(global, {\n    statistics: {\n      ...statistics,\n      byChatId: {\n        ...statistics.byChatId,\n        [chatId]: {\n          ...(statistics.byChatId[chatId] || {}),\n          [name]: update,\n        },\n      },\n    },\n  }, tabId);\n}\n\nexport function updateChannelMonetizationStatistics<T extends GlobalState>(\n  global: T, statistics: ApiChannelMonetizationStatistics,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    statistics: {\n      ...selectTabState(global, tabId).statistics,\n      monetization: statistics,\n    },\n  }, tabId);\n}\n\nexport function updateVerifyMonetizationModal<T extends GlobalState>(\n  global: T, update: Partial<TabState['monetizationVerificationModal']>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const tabState = selectTabState(global, tabId);\n  if (!tabState.monetizationVerificationModal) {\n    return global;\n  }\n\n  return updateTabState(global, {\n    monetizationVerificationModal: {\n      ...tabState.monetizationVerificationModal,\n      ...update,\n    },\n  }, tabId);\n}\n","import type {\n  ApiChat, ApiChatFullInfo, ApiPeerPhotos, ApiPhoto, ApiUser, ApiUserFullInfo,\n} from '../../api/types';\nimport type { GlobalState } from '../types';\n\nimport { omit, uniqueByField } from '../../util/iteratees';\nimport { isChatChannel, isUserId } from '../helpers';\nimport {\n  selectChatFullInfo,\n  selectPeer,\n  selectPeerPhotos,\n  selectUserFullInfo,\n} from '../selectors';\nimport { updateChat, updateChatFullInfo } from './chats';\nimport { updateUser, updateUserFullInfo } from './users';\n\n// `type` has different types in ApiChat and ApiUser\ntype ApiPeerSharedFields = Omit<CommonProperties<ApiChat, ApiUser>, 'type'>;\ntype ApiPeerFullInfoSharedFields = CommonProperties<ApiChatFullInfo, ApiUserFullInfo>;\n\nexport function updatePeer<T extends GlobalState>(\n  global: T, peerId: string, peerUpdate: Partial<ApiPeerSharedFields>,\n) {\n  if (isUserId(peerId)) {\n    return updateUser(global, peerId, peerUpdate);\n  }\n\n  return updateChat(global, peerId, peerUpdate);\n}\n\nexport function updatePeerFullInfo<T extends GlobalState>(\n  global: T, peerId: string, peerFullInfoUpdate: Partial<ApiPeerFullInfoSharedFields>,\n) {\n  if (isUserId(peerId)) {\n    return updateUserFullInfo(global, peerId, peerFullInfoUpdate);\n  }\n\n  return updateChatFullInfo(global, peerId, peerFullInfoUpdate);\n}\n\nexport function updatePeerPhotosIsLoading<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  isLoading: boolean,\n) {\n  const profilePhotos = selectPeerPhotos(global, peerId);\n  if (!profilePhotos) {\n    return global;\n  }\n\n  return replacePeerPhotos(global, peerId, {\n    ...profilePhotos,\n    isLoading,\n  });\n}\n\nexport function replacePeerPhotos<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  value?: ApiPeerPhotos,\n) {\n  if (!value) {\n    return {\n      ...global,\n      peers: {\n        ...global.peers,\n        profilePhotosById: omit(global.peers.profilePhotosById, [peerId]),\n      },\n    };\n  }\n\n  return {\n    ...global,\n    peers: {\n      ...global.peers,\n      profilePhotosById: {\n        ...global.peers.profilePhotosById,\n        [peerId]: value,\n      },\n    },\n  };\n}\n\nexport function updatePeerPhotos<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  update: {\n    newPhotos: ApiPhoto[];\n    count: number;\n    nextOffset?: number;\n    fullInfo: ApiChatFullInfo | ApiUserFullInfo;\n    shouldInvalidateCache?: boolean;\n  },\n) {\n  const profilePhotos = selectPeerPhotos(global, peerId);\n\n  const {\n    newPhotos, count, nextOffset, fullInfo, shouldInvalidateCache,\n  } = update;\n  const currentPhotos = profilePhotos;\n  const profilePhoto = fullInfo.profilePhoto;\n  const fallbackPhoto = 'fallbackPhoto' in fullInfo ? fullInfo.fallbackPhoto : undefined;\n  const personalPhoto = 'personalPhoto' in fullInfo ? fullInfo.personalPhoto : undefined;\n\n  if (!currentPhotos || shouldInvalidateCache) {\n    // In some channels, last service message with photo change is deleted, so we need to patch it in\n    if (profilePhoto && profilePhoto.id !== newPhotos[0]?.id) {\n      newPhotos.unshift(profilePhoto);\n    }\n\n    if (personalPhoto && personalPhoto.id !== newPhotos[0]?.id) {\n      newPhotos.unshift(personalPhoto);\n    }\n\n    if (fallbackPhoto) {\n      newPhotos.push(fallbackPhoto);\n    }\n\n    return replacePeerPhotos(global, peerId, {\n      fallbackPhoto,\n      personalPhoto,\n      photos: newPhotos,\n      count,\n      nextOffset,\n      isLoading: false,\n    });\n  }\n\n  const hasFallbackPhoto = currentPhotos.photos[currentPhotos.photos.length - 1].id === fallbackPhoto?.id;\n  const currentPhotoArray = hasFallbackPhoto ? currentPhotos.photos.slice(0, -1) : currentPhotos.photos;\n\n  const photos = uniqueByField([...currentPhotoArray, ...newPhotos, fallbackPhoto].filter(Boolean), 'id');\n  return replacePeerPhotos(global, peerId, {\n    fallbackPhoto,\n    personalPhoto,\n    photos,\n    count,\n    nextOffset,\n    isLoading: false,\n  });\n}\n\nexport function deletePeerPhoto<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  photoId: string,\n  isFromActionMessage?: boolean,\n) {\n  const peer = selectPeer(global, peerId);\n  const profilePhotos = selectPeerPhotos(global, peerId);\n  if (!peer || !profilePhotos) {\n    return global;\n  }\n  const isChannel = 'title' in peer && isChatChannel(peer);\n\n  const userFullInfo = selectUserFullInfo(global, peerId);\n  const chatFullInfo = selectChatFullInfo(global, peerId);\n\n  const isAvatar = peer.avatarPhotoId === photoId && (!isChannel || isFromActionMessage);\n  const nextAvatarPhoto = isAvatar ? profilePhotos.photos[1] : undefined;\n\n  if (userFullInfo) {\n    const newFallbackPhoto = userFullInfo.fallbackPhoto?.id === photoId ? undefined : userFullInfo.fallbackPhoto;\n    const newPersonalPhoto = userFullInfo.personalPhoto?.id === photoId ? undefined : userFullInfo.personalPhoto;\n    const newProfilePhoto = userFullInfo.profilePhoto?.id === photoId ? nextAvatarPhoto : userFullInfo.profilePhoto;\n    global = updateUserFullInfo(global, peerId, {\n      fallbackPhoto: newFallbackPhoto,\n      personalPhoto: newPersonalPhoto,\n      profilePhoto: newProfilePhoto,\n    });\n  }\n\n  if (chatFullInfo) {\n    const newProfilePhoto = chatFullInfo.profilePhoto?.id === photoId ? nextAvatarPhoto : chatFullInfo.profilePhoto;\n    global = updateChatFullInfo(global, peerId, {\n      profilePhoto: newProfilePhoto,\n    });\n  }\n\n  const avatarPhotoId = isAvatar ? nextAvatarPhoto?.id : peer.avatarPhotoId;\n  const shouldKeepInPhotos = isAvatar && 'title' in peer && isChatChannel(peer);\n  const photos = shouldKeepInPhotos\n    ? profilePhotos.photos.filter((photo) => photo.id !== photoId) : profilePhotos.photos.slice();\n\n  global = updatePeer(global, peerId, {\n    avatarPhotoId,\n  });\n\n  global = replacePeerPhotos(global, peerId, avatarPhotoId ? {\n    ...profilePhotos,\n    photos,\n    count: profilePhotos.count - 1,\n  } : undefined);\n\n  return global;\n}\n","import type {\n  ApiPeerStories,\n  ApiReaction,\n  ApiStealthMode,\n  ApiStory,\n  ApiStoryDeleted,\n  ApiStorySkipped,\n  ApiStoryViews,\n  ApiTypeStory,\n  ApiTypeStoryView,\n} from '../../api/types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { compareFields, unique } from '../../util/iteratees';\nimport { getServerTime } from '../../util/serverTime';\nimport { isUserId, updateReactionCount } from '../helpers';\nimport {\n  selectIsChatWithSelf,\n  selectPeer, selectPeerStories, selectPeerStory, selectTabState, selectUser,\n} from '../selectors';\nimport { updatePeer } from './peers';\nimport { updateTabState } from './tabs';\n\nexport function addStories<T extends GlobalState>(global: T, newStoriesByPeerId: Record<string, ApiPeerStories>): T {\n  const updatedByPeerId = Object.entries(newStoriesByPeerId).reduce((acc, [peerId, newPeerStories]) => {\n    if (!acc[peerId]) {\n      acc[peerId] = newPeerStories;\n    } else {\n      acc[peerId].byId = { ...acc[peerId].byId, ...newPeerStories.byId };\n      acc[peerId].orderedIds = unique(newPeerStories.orderedIds.concat(acc[peerId].orderedIds));\n      acc[peerId].profileIds = unique(newPeerStories.profileIds.concat(acc[peerId].profileIds)).sort((a, b) => b - a);\n      acc[peerId].lastUpdatedAt = newPeerStories.lastUpdatedAt;\n      acc[peerId].lastReadId = newPeerStories.lastReadId;\n    }\n\n    return acc;\n  }, global.stories.byPeerId);\n\n  global = {\n    ...global,\n    stories: {\n      ...global.stories,\n      byPeerId: updatedByPeerId,\n    },\n  };\n\n  return updateOrderedStoriesPeerIds(global, Object.keys(newStoriesByPeerId));\n}\n\nexport function addStoriesForPeer<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  newStories: Record<number, ApiTypeStory>,\n  newPinnedIds?: number[],\n  addToArchive?: boolean,\n): T {\n  const {\n    byId, orderedIds, profileIds, archiveIds, pinnedIds,\n  } = global.stories.byPeerId[peerId] || {};\n  const deletedIds = Object.keys(newStories).filter((id) => 'isDeleted' in newStories[Number(id)]).map(Number);\n  const updatedById = { ...byId, ...newStories };\n  let updatedOrderedIds = [...(orderedIds || [])];\n  let updatedArchiveIds = [...(archiveIds || [])];\n  const updatedProfileIds = unique(\n    [...(profileIds || [])].concat(Object.values(newStories).reduce((ids, story) => {\n      if ('isInProfile' in story && story.isInProfile) {\n        ids.push(story.id);\n      }\n\n      return ids;\n    }, [] as number[])),\n  ).sort((a, b) => b - a).filter((storyId) => !deletedIds.includes(storyId));\n\n  updatedOrderedIds = unique(Object.entries(newStories).reduce((acc, [storyId, story]) => {\n    if ('expireDate' in story && story.expireDate && story.expireDate > getServerTime()) {\n      acc.push(Number(storyId));\n    }\n\n    return acc;\n  }, updatedOrderedIds)).filter((storyId) => !deletedIds.includes(storyId));\n\n  if (addToArchive && selectIsChatWithSelf(global, peerId)) {\n    updatedArchiveIds = unique(updatedArchiveIds.concat(Object.keys(newStories).map(Number)))\n      .sort((a, b) => b - a)\n      .filter((storyId) => !deletedIds.includes(storyId));\n  }\n\n  global = {\n    ...global,\n    stories: {\n      ...global.stories,\n      byPeerId: {\n        ...global.stories.byPeerId,\n        [peerId]: {\n          ...global.stories.byPeerId[peerId],\n          byId: updatedById,\n          orderedIds: updatedOrderedIds,\n          profileIds: updatedProfileIds,\n          pinnedIds: pinnedIds || newPinnedIds,\n          ...(addToArchive && { archiveIds: updatedArchiveIds }),\n        },\n      },\n    },\n  };\n\n  if (selectIsChatWithSelf(global, peerId)\n    || selectUser(global, peerId)?.isContact\n    || peerId === global.appConfig?.storyChangelogUserId) {\n    global = updatePeerLastUpdatedAt(global, peerId);\n    global = updateOrderedStoriesPeerIds(global, [peerId]);\n  }\n\n  return global;\n}\n\nexport function updateStoriesForPeer<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  peerStories: ApiPeerStories,\n): T {\n  return {\n    ...global,\n    stories: {\n      ...global.stories,\n      byPeerId: {\n        ...global.stories.byPeerId,\n        [peerId]: peerStories,\n      },\n    },\n  };\n}\n\nexport function updatePeerStoriesFullyLoaded<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  isFullyLoaded: boolean,\n  isArchive?: boolean,\n): T {\n  return {\n    ...global,\n    stories: {\n      ...global.stories,\n      byPeerId: {\n        ...global.stories.byPeerId,\n        [peerId]: {\n          ...global.stories.byPeerId[peerId],\n          [isArchive ? 'isArchiveFullyLoaded' : 'isFullyLoaded']: isFullyLoaded,\n        },\n      },\n    },\n  };\n}\n\nexport function updateLastReadStoryForPeer<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  lastReadId: number,\n): T {\n  const { orderedIds } = selectPeerStories(global, peerId) || {};\n  if (!orderedIds) {\n    return global;\n  }\n\n  if (lastReadId >= orderedIds[orderedIds.length - 1]) {\n    global = updatePeer(global, peerId, {\n      hasUnreadStories: false,\n    });\n  }\n\n  return {\n    ...global,\n    stories: {\n      ...global.stories,\n      byPeerId: {\n        ...global.stories.byPeerId,\n        [peerId]: {\n          ...global.stories.byPeerId[peerId],\n          lastReadId,\n        },\n      },\n    },\n  };\n}\n\nexport function updateLastViewedStoryForPeer<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  lastViewedId: number,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const { orderedIds } = selectPeerStories(global, peerId) || {};\n  if (!orderedIds || !orderedIds.includes(lastViewedId)) {\n    return global;\n  }\n\n  const { storyViewer } = selectTabState(global, tabId);\n\n  return updateTabState(global, {\n    storyViewer: {\n      ...storyViewer,\n      lastViewedByPeerIds: {\n        ...storyViewer.lastViewedByPeerIds,\n        [peerId]: lastViewedId,\n      },\n    },\n  }, tabId);\n}\n\nexport function updatePeersWithStories<T extends GlobalState>(\n  global: T,\n  storiesByPeerId: Record<string, ApiPeerStories>,\n): T {\n  Object.entries(storiesByPeerId).forEach(([peerId, { lastReadId, orderedIds }]) => {\n    const peer = selectPeer(global, peerId);\n    if (!peer) return;\n\n    global = updatePeer(global, peerId, {\n      hasStories: true,\n      hasUnreadStories: !lastReadId\n        || Boolean(lastReadId && lastReadId < (peer.maxStoryId || orderedIds[orderedIds.length - 1])),\n    });\n  });\n\n  return global;\n}\n\nexport function updateStoryViews<T extends GlobalState>(\n  global: T,\n  storyId: number,\n  views: ApiTypeStoryView[],\n  nextOffset?: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const tabState = selectTabState(global, tabId);\n  const { viewModal } = tabState.storyViewer;\n  const newViews = viewModal?.storyId === storyId && viewModal.views ? [\n    ...viewModal.views,\n    ...views,\n  ] : views;\n\n  global = updateStoryViewsLoading(global, false, tabId);\n\n  return updateTabState(global, {\n    storyViewer: {\n      ...tabState.storyViewer,\n      viewModal: {\n        ...viewModal,\n        storyId,\n        views: newViews,\n        nextOffset,\n        isLoading: false,\n      },\n    },\n  }, tabId);\n}\n\nexport function updateStoryViewsLoading<T extends GlobalState>(\n  global: T,\n  isLoading: boolean,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const tabState = selectTabState(global, tabId);\n  const { viewModal } = tabState.storyViewer;\n  if (!viewModal) return global;\n\n  return updateTabState(global, {\n    storyViewer: {\n      ...tabState.storyViewer,\n      viewModal: {\n        ...viewModal,\n        isLoading,\n      },\n    },\n  }, tabId);\n}\n\nexport function removePeerStory<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  storyId: number,\n): T {\n  const {\n    orderedIds, profileIds, lastReadId, byId,\n  } = selectPeerStories(global, peerId) || { orderedIds: [] as number[], profileIds: [] as number[] };\n\n  const newOrderedIds = orderedIds.filter((id) => id !== storyId);\n  const newProfileIds = profileIds.filter((id) => id !== storyId);\n  const lastStoryId = newOrderedIds.length ? orderedIds[orderedIds.length - 1] : undefined;\n\n  const previousStoryId = orderedIds[orderedIds.indexOf(storyId) - 1];\n  const newLastReadId = lastReadId === storyId ? previousStoryId : lastReadId;\n\n  const newById = {\n    ...byId,\n    [storyId]: { id: storyId, peerId, isDeleted: true } as ApiStoryDeleted,\n  };\n  const lastUpdatedAt = lastStoryId ? (newById[lastStoryId] as ApiStory | undefined)?.date : undefined;\n  const hasStories = Boolean(newOrderedIds.length);\n\n  global = updatePeer(global, peerId, {\n    hasStories,\n    hasUnreadStories: Boolean(hasStories && lastReadId && lastStoryId && lastReadId < lastStoryId),\n  });\n\n  global = updateStoriesForPeer(global, peerId, {\n    byId: newById,\n    orderedIds: newOrderedIds,\n    profileIds: newProfileIds,\n    lastUpdatedAt,\n    lastReadId: newLastReadId,\n  });\n\n  Object.values(global.byTabId).forEach((tab) => {\n    if (tab.storyViewer.lastViewedByPeerIds?.[peerId] === storyId) {\n      global = updateLastViewedStoryForPeer(global, peerId, previousStoryId, tab.id);\n    }\n  });\n\n  if (!hasStories) {\n    global = {\n      ...global,\n      stories: {\n        ...global.stories,\n        orderedPeerIds: {\n          active: global.stories.orderedPeerIds.active.filter((id) => id !== peerId),\n          archived: global.stories.orderedPeerIds.archived.filter((id) => id !== peerId),\n        },\n      },\n    };\n  }\n\n  return global;\n}\n\nexport function updateSentStoryReaction<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  storyId: number,\n  reaction: ApiReaction | undefined,\n): T {\n  const story = selectPeerStory(global, peerId, storyId);\n  if (!story || !('content' in story)) return global;\n\n  const { views } = story;\n  const reactionsCount = views?.reactionsCount || 0;\n  const hasReaction = views?.reactions?.some((r) => r.chosenOrder !== undefined);\n  const reactions = updateReactionCount(views?.reactions || [], [reaction].filter(Boolean));\n\n  const countDiff = !reaction ? -1 : hasReaction ? 0 : 1;\n  const newReactionsCount = reactionsCount + countDiff;\n\n  global = updatePeerStory(global, peerId, storyId, {\n    sentReaction: reaction,\n    views: {\n      ...views,\n      reactionsCount: newReactionsCount,\n      reactions,\n    },\n  });\n\n  return global;\n}\n\nexport function updatePeerStory<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  storyId: number,\n  storyUpdate: Partial<ApiStory>,\n): T {\n  const peerStories = selectPeerStories(global, peerId) || {\n    byId: {}, orderedIds: [], profileIds: [], archiveIds: [],\n  };\n\n  return {\n    ...global,\n    stories: {\n      ...global.stories,\n      byPeerId: {\n        ...global.stories.byPeerId,\n        [peerId]: {\n          ...peerStories,\n          byId: {\n            ...peerStories.byId,\n            [storyId]: {\n              ...peerStories.byId[storyId],\n              ...storyUpdate,\n            },\n          },\n        },\n      },\n    },\n  };\n}\n\nexport function updatePeerStoryViews<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  storyId: number,\n  viewsUpdate: Partial<ApiStoryViews>,\n): T {\n  const story = selectPeerStory(global, peerId, storyId);\n  if (!story || !('content' in story)) return global;\n\n  const { views } = story;\n\n  return updatePeerStory(global, peerId, storyId, {\n    views: {\n      ...views,\n      ...viewsUpdate,\n    },\n  });\n}\n\nexport function updatePeerProfileStory<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  storyId: number,\n  isInProfile?: boolean,\n): T {\n  const peerStories = selectPeerStories(global, peerId) || {\n    byId: {}, orderedIds: [], profileIds: [], archiveIds: [],\n  };\n\n  const newProfileIds = isInProfile\n    ? unique(peerStories.profileIds.concat(storyId)).sort((a, b) => b - a)\n    : peerStories.profileIds.filter((id) => storyId !== id);\n\n  return {\n    ...global,\n    stories: {\n      ...global.stories,\n      byPeerId: {\n        ...global.stories.byPeerId,\n        [peerId]: {\n          ...peerStories,\n          profileIds: newProfileIds,\n        },\n      },\n    },\n  };\n}\n\nexport function updatePeerStoriesHidden<T extends GlobalState>(global: T, peerId: string, areHidden: boolean) {\n  const peer = selectPeer(global, peerId);\n  if (!peer) return global;\n\n  const currentState = peer.areStoriesHidden;\n  if (currentState === areHidden) return global; // `updateOrderedStoriesPeerIds` is computationally expensive\n\n  global = updatePeer(global, peerId, {\n    areStoriesHidden: areHidden,\n  });\n\n  return updateOrderedStoriesPeerIds(global, [peerId]);\n}\n\nfunction updateOrderedStoriesPeerIds<T extends GlobalState>(global: T, updatePeerIds: string[]): T {\n  const { currentUserId, stories: { byPeerId, orderedPeerIds } } = global;\n\n  const allPeerIds = orderedPeerIds.active.concat(orderedPeerIds.archived).concat(updatePeerIds);\n  const newOrderedPeerIds = allPeerIds.reduce<{ active: string[]; archived: string[] }>((acc, peerId) => {\n    if (!byPeerId[peerId]?.orderedIds?.length) return acc;\n    const peer = selectPeer(global, peerId);\n\n    if (peer?.areStoriesHidden) {\n      acc.archived.push(peerId);\n    } else {\n      acc.active.push(peerId);\n    }\n\n    return acc;\n  }, { active: [], archived: [] });\n\n  function compare(peerIdA: string, peerIdB: string) {\n    const peerA = selectPeer(global, peerIdA)!;\n    const peerB = selectPeer(global, peerIdB)!;\n\n    const diffCurrentUser = compareFields(currentUserId === peerIdA, currentUserId === peerIdB);\n    if (diffCurrentUser) return diffCurrentUser;\n\n    const { lastUpdatedAt: luaA = 0, orderedIds: orderedA, lastReadId: lriA = 0 } = byPeerId[peerIdA] || {};\n    const hasUnreadA = lriA < orderedA?.[orderedA.length - 1];\n    const { lastUpdatedAt: luaB = 0, orderedIds: orderedB, lastReadId: lriB = 0 } = byPeerId[peerIdB] || {};\n    const hasUnreadB = lriB < orderedB?.[orderedB.length - 1];\n\n    const diffUnread = compareFields(hasUnreadA, hasUnreadB);\n    if (diffUnread) return diffUnread;\n\n    const diffPremium = compareFields('isPremium' in peerA, 'isPremium' in peerB);\n    if (diffPremium) return diffPremium;\n\n    const diffType = compareFields(isUserId(peerIdA), isUserId(peerIdB));\n    if (diffType) return diffType;\n\n    return compareFields(luaA, luaB);\n  }\n\n  newOrderedPeerIds.archived = unique(newOrderedPeerIds.archived)\n    .filter((peerId) => byPeerId[peerId]?.orderedIds?.length)\n    .sort(compare);\n  newOrderedPeerIds.active = unique(newOrderedPeerIds.active)\n    .filter((peerId) => byPeerId[peerId]?.orderedIds?.length)\n    .sort(compare);\n\n  return {\n    ...global,\n    stories: {\n      ...global.stories,\n      orderedPeerIds: newOrderedPeerIds,\n    },\n  };\n}\n\nfunction updatePeerLastUpdatedAt<T extends GlobalState>(global: T, peerId: string): T {\n  const peerStories = global.stories.byPeerId[peerId];\n  const lastUpdatedAt = peerStories.orderedIds.reduce<number | undefined>((acc, storyId) => {\n    const { date } = peerStories.byId[storyId] as ApiStorySkipped || {};\n    if (date && (!acc || acc < date)) {\n      acc = date;\n    }\n\n    return acc;\n  }, undefined);\n\n  return {\n    ...global,\n    stories: {\n      ...global.stories,\n      byPeerId: {\n        ...global.stories.byPeerId,\n        [peerId]: {\n          ...peerStories,\n          lastUpdatedAt,\n        },\n      },\n    },\n  };\n}\n\nexport function updateStealthMode<T extends GlobalState>(\n  global: T,\n  stealthMode: ApiStealthMode,\n): T {\n  return {\n    ...global,\n    stories: {\n      ...global.stories,\n      stealthMode,\n    },\n  };\n}\n","import type { ApiTopic } from '../../api/types';\nimport type { TopicsInfo } from '../../types';\nimport type { GlobalState } from '../types';\n\nimport { buildCollectionByKey, omit, unique } from '../../util/iteratees';\nimport {\n  selectChat, selectTopic, selectTopics,\n  selectTopicsInfo,\n} from '../selectors';\nimport { updateThread, updateThreadInfo } from './messages';\n\nfunction updateTopicsStore<T extends GlobalState>(\n  global: T, chatId: string, update: Partial<TopicsInfo>,\n) {\n  const info = global.chats.topicsInfoById[chatId] || {};\n\n  global = {\n    ...global,\n    chats: {\n      ...global.chats,\n      topicsInfoById: {\n        ...global.chats.topicsInfoById,\n        [chatId]: {\n          ...info,\n          ...update,\n        },\n      },\n    },\n  };\n\n  return global;\n}\n\nexport function updateListedTopicIds<T extends GlobalState>(\n  global: T, chatId: string, topicIds: number[],\n): T {\n  const listedIds = selectTopicsInfo(global, chatId)?.listedTopicIds || [];\n  return updateTopicsStore(global, chatId, {\n    listedTopicIds: unique([\n      ...listedIds,\n      ...topicIds,\n    ]),\n  });\n}\n\nexport function updateTopics<T extends GlobalState>(\n  global: T, chatId: string, topicsCount: number, topics: ApiTopic[],\n): T {\n  const oldTopics = selectTopics(global, chatId);\n  const newTopics = buildCollectionByKey(topics, 'id');\n\n  global = updateTopicsStore(global, chatId, {\n    topicsById: {\n      ...oldTopics,\n      ...newTopics,\n    },\n    totalCount: topicsCount,\n  });\n\n  topics.forEach((topic) => {\n    global = updateThread(global, chatId, topic.id, {\n      firstMessageId: topic.id,\n    });\n\n    global = updateThreadInfo(global, chatId, topic.id, {\n      lastMessageId: topic.lastMessageId,\n      threadId: topic.id,\n      chatId,\n    });\n  });\n\n  return global;\n}\n\nexport function updateTopic<T extends GlobalState>(\n  global: T, chatId: string, topicId: number, update: Partial<ApiTopic>,\n): T {\n  const chat = selectChat(global, chatId);\n\n  if (!chat) return global;\n\n  const topic = selectTopic(global, chatId, topicId);\n  const oldTopics = selectTopics(global, chatId);\n\n  const updatedTopic = {\n    ...topic,\n    ...update,\n  } as ApiTopic;\n\n  if (!updatedTopic.id) return global;\n\n  global = updateTopicsStore(global, chatId, {\n    topicsById: {\n      ...oldTopics,\n      [topicId]: updatedTopic,\n    },\n  });\n\n  global = updateThread(global, chatId, updatedTopic.id, {\n    firstMessageId: updatedTopic.id,\n  });\n\n  global = updateThreadInfo(global, chatId, updatedTopic.id, {\n    lastMessageId: updatedTopic.lastMessageId,\n    threadId: updatedTopic.id,\n    chatId,\n  });\n\n  return global;\n}\n\nexport function deleteTopic<T extends GlobalState>(\n  global: T, chatId: string, topicId: number,\n) {\n  const topics = selectTopics(global, chatId);\n  if (!topics) return global;\n\n  global = updateTopicsStore(global, chatId, {\n    topicsById: omit(topics, [topicId]),\n  });\n\n  return global;\n}\n\nexport function updateTopicLastMessageId<T extends GlobalState>(\n  global: T, chatId: string, threadId: number, lastMessageId: number,\n) {\n  return updateTopic(global, chatId, threadId, {\n    lastMessageId,\n  });\n}\n\nexport function replacePinnedTopicIds<T extends GlobalState>(\n  global: T, chatId: string, pinnedTopicIds: number[],\n) {\n  return updateTopicsStore(global, chatId, {\n    orderedPinnedTopicIds: pinnedTopicIds,\n  });\n}\n","import type { MediaContent } from '../../api/types';\nimport { ApiMessageEntityTypes } from '../../api/types';\n\nimport parseEmojiOnlyString from '../../util/emoji/parseEmojiOnlyString';\n\nexport function getEmojiOnlyCountForMessage(content: MediaContent, groupedId?: string): number | undefined {\n  if (!content.text) return undefined;\n  return (\n    !groupedId\n    && Object.keys(content).length === 1 // Only text is present\n    && !content.text.entities?.some((entity) => entity.type !== ApiMessageEntityTypes.CustomEmoji)\n    && parseEmojiOnlyString(content.text.text)\n  ) || undefined;\n}\n","import type {\n  ApiMessage, ApiPoll, ApiPollResult, ApiQuickReply, ApiSponsoredMessage, ApiThreadInfo,\n} from '../../api/types';\nimport type {\n  FocusDirection,\n  MessageList,\n  MessageListType,\n  ScrollTargetPosition,\n  TabThread,\n  Thread,\n  ThreadId,\n} from '../../types';\nimport type {\n  GlobalState, TabArgs, TabState,\n} from '../types';\nimport { MAIN_THREAD_ID } from '../../api/types';\n\nimport {\n  IS_MOCKED_CLIENT, IS_TEST, MESSAGE_LIST_SLICE, MESSAGE_LIST_VIEWPORT_LIMIT, TMP_CHAT_ID,\n} from '../../config';\nimport { areDeepEqual } from '../../util/areDeepEqual';\nimport { addTimestampEntities } from '../../util/dates/timestamp';\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport {\n  areSortedArraysEqual, excludeSortedArray, omit, omitUndefined, pick, pickTruthy, unique,\n} from '../../util/iteratees';\nimport { isLocalMessageId, type MessageKey } from '../../util/keys/messageKey';\nimport {\n  hasMessageTtl, isMediaLoadableInViewer, mergeIdRanges, orderHistoryIds, orderPinnedIds,\n} from '../helpers';\nimport { getEmojiOnlyCountForMessage } from '../helpers/getEmojiOnlyCountForMessage';\nimport {\n  selectChatMessage,\n  selectChatMessages,\n  selectChatScheduledMessages,\n  selectCurrentMessageIds,\n  selectCurrentMessageList,\n  selectListedIds,\n  selectMessageIdsByGroupId,\n  selectOutlyingLists,\n  selectPinnedIds,\n  selectPoll,\n  selectQuickReplyMessage,\n  selectScheduledIds,\n  selectScheduledMessage,\n  selectTabState,\n  selectThreadIdFromMessage,\n  selectThreadInfo,\n  selectViewportIds,\n} from '../selectors';\nimport { removeIdFromSearchResults } from './middleSearch';\nimport { updateTabState } from './tabs';\nimport { clearMessageTranslation } from './translations';\n\ntype MessageStoreSections = GlobalState['messages']['byChatId'][string];\n\nexport function updateCurrentMessageList<T extends GlobalState>(\n  global: T,\n  chatId: string | undefined,\n  threadId: ThreadId = MAIN_THREAD_ID,\n  type: MessageListType = 'thread',\n  shouldReplaceHistory?: boolean,\n  shouldReplaceLast?: boolean,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const { messageLists } = selectTabState(global, tabId);\n  let newMessageLists: MessageList[] = messageLists;\n  if (shouldReplaceHistory || (IS_TEST && !IS_MOCKED_CLIENT)) {\n    newMessageLists = chatId ? [{ chatId, threadId, type }] : [];\n  } else if (chatId) {\n    const current = messageLists[messageLists.length - 1];\n    if (current?.chatId === chatId && current.threadId === threadId && current.type === type) {\n      return global;\n    }\n\n    if (current && (current.chatId === TMP_CHAT_ID || shouldReplaceLast)) {\n      newMessageLists = [...messageLists.slice(0, -1), { chatId, threadId, type }];\n    } else {\n      const previous = messageLists[messageLists.length - 2];\n\n      if (previous?.chatId === chatId && previous.threadId === threadId && previous.type === type) {\n        newMessageLists = messageLists.slice(0, -1);\n      } else {\n        newMessageLists = [...messageLists, { chatId, threadId, type }];\n      }\n    }\n  } else {\n    newMessageLists = messageLists.slice(0, -1);\n  }\n\n  return updateTabState(global, {\n    messageLists: newMessageLists,\n  }, tabId);\n}\n\nfunction replaceChatMessages<T extends GlobalState>(global: T, chatId: string, newById: Record<number, ApiMessage>): T {\n  return updateMessageStore(global, chatId, {\n    byId: newById,\n  });\n}\n\nexport function updateTabThread<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId, threadUpdate: Partial<TabThread>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const tabState = selectTabState(global, tabId);\n  const current = tabState.tabThreads[chatId]?.[threadId] || {};\n\n  return updateTabState(global, {\n    tabThreads: {\n      ...tabState.tabThreads,\n      [chatId]: {\n        ...tabState.tabThreads[chatId],\n        [threadId]: {\n          ...current,\n          ...threadUpdate,\n        },\n      },\n    },\n  }, tabId);\n}\n\nexport function updateThread<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId, threadUpdate: Partial<Thread> | undefined,\n): T {\n  if (!threadUpdate) {\n    return updateMessageStore(global, chatId, {\n      threadsById: omit(global.messages.byChatId[chatId]?.threadsById, [threadId]),\n    });\n  }\n\n  const current = global.messages.byChatId[chatId];\n\n  return updateMessageStore(global, chatId, {\n    threadsById: {\n      ...(current?.threadsById),\n      [threadId]: {\n        ...(current?.threadsById[threadId]),\n        ...threadUpdate,\n      },\n    },\n  });\n}\n\nexport function updateMessageStore<T extends GlobalState>(\n  global: T, chatId: string, update: Partial<MessageStoreSections>,\n): T {\n  const current = global.messages.byChatId[chatId] || { byId: {}, threadsById: {} };\n\n  return {\n    ...global,\n    messages: {\n      ...global.messages,\n      byChatId: {\n        ...global.messages.byChatId,\n        [chatId]: {\n          ...current,\n          ...update,\n        },\n      },\n    },\n  };\n}\n\nexport function replaceTabThreadParam<T extends GlobalState, K extends keyof TabThread>(\n  global: T, chatId: string, threadId: ThreadId, paramName: K, newValue: TabThread[K] | undefined,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  if (paramName === 'viewportIds') {\n    global = replaceThreadParam(\n      global, chatId, threadId, 'lastViewportIds', newValue as number[] | undefined,\n    );\n  }\n  return updateTabThread(global, chatId, threadId, { [paramName]: newValue }, tabId);\n}\n\nexport function replaceThreadParam<T extends GlobalState, K extends keyof Thread>(\n  global: T, chatId: string, threadId: ThreadId, paramName: K, newValue: Thread[K] | undefined,\n) {\n  return updateThread(global, chatId, threadId, { [paramName]: newValue });\n}\n\nexport function addMessages<T extends GlobalState>(\n  global: T, messages: ApiMessage[],\n): T {\n  const addedByChatId = messages.reduce((messagesByChatId, message: ApiMessage) => {\n    if (!messagesByChatId[message.chatId]) {\n      messagesByChatId[message.chatId] = {};\n    }\n    messagesByChatId[message.chatId][message.id] = message;\n\n    return messagesByChatId;\n  }, {} as Record<string, Record<number, ApiMessage>>);\n\n  Object.keys(addedByChatId).forEach((chatId) => {\n    global = addChatMessagesById(global, chatId, addedByChatId[chatId]);\n  });\n\n  return global;\n}\n\nexport function replaceMessages<T extends GlobalState>(\n  global: T, messages: ApiMessage[],\n): T {\n  const updatedByChatId = messages.reduce((messagesByChatId, message: ApiMessage) => {\n    if (!messagesByChatId[message.chatId]) {\n      messagesByChatId[message.chatId] = {};\n    }\n    messagesByChatId[message.chatId][message.id] = message;\n\n    return messagesByChatId;\n  }, {} as Record<string, Record<number, ApiMessage>>);\n\n  Object.keys(updatedByChatId).forEach((chatId) => {\n    const currentById = selectChatMessages(global, chatId) || {};\n    const newById = {\n      ...currentById,\n      ...updatedByChatId[chatId],\n    };\n    global = replaceChatMessages(global, chatId, newById);\n  });\n\n  return global;\n}\n\nexport function addChatMessagesById<T extends GlobalState>(\n  global: T, chatId: string, newById: Record<number, ApiMessage>,\n): T {\n  const byId = selectChatMessages(global, chatId);\n\n  if (byId && Object.keys(newById).every((newId) => Boolean(byId[Number(newId)]))) {\n    return global;\n  }\n\n  return replaceChatMessages(global, chatId, {\n    ...newById,\n    ...byId,\n  });\n}\n\nexport function updateChatMessage<T extends GlobalState>(\n  global: T, chatId: string, messageId: number, messageUpdate: Partial<ApiMessage>, withDeepCheck = false,\n): T {\n  const byId = selectChatMessages(global, chatId) || {};\n  const message = byId[messageId];\n\n  if (withDeepCheck && message) {\n    const updateKeys = Object.keys(messageUpdate) as (keyof ApiMessage)[];\n    if (areDeepEqual(pick(message, updateKeys), messageUpdate)) {\n      return global;\n    }\n  }\n\n  if (message && messageUpdate.isMediaUnread === false && hasMessageTtl(message)) {\n    if (message.content.voice) {\n      messageUpdate.content = {\n        action: {\n          mediaType: 'action',\n          type: 'expired',\n          isVoice: true,\n        },\n      };\n    } else if (message.content.video?.isRound) {\n      messageUpdate.content = {\n        action: {\n          mediaType: 'action',\n          type: 'expired',\n          isRoundVideo: true,\n        },\n      };\n    }\n  }\n\n  let emojiOnlyCount = message?.emojiOnlyCount;\n  let text = message?.content?.text;\n  if (messageUpdate.content) {\n    emojiOnlyCount = getEmojiOnlyCountForMessage(\n      messageUpdate.content, message?.groupedId || messageUpdate.groupedId,\n    );\n    text = messageUpdate.content.text ? addTimestampEntities(messageUpdate.content.text) : text;\n  }\n\n  const updatedMessage = omitUndefined({\n    ...message,\n    ...messageUpdate,\n    emojiOnlyCount,\n    text,\n  });\n\n  if (!updatedMessage.id) {\n    return global;\n  }\n\n  return replaceChatMessages(global, chatId, {\n    ...byId,\n    [messageId]: updatedMessage,\n  });\n}\n\nexport function updateScheduledMessage<T extends GlobalState>(\n  global: T, chatId: string, messageId: number, messageUpdate: Partial<ApiMessage>,\n): T {\n  const message = selectScheduledMessage(global, chatId, messageId)!;\n\n  let emojiOnlyCount = message?.emojiOnlyCount;\n  let text = message?.content?.text;\n  if (messageUpdate.content) {\n    emojiOnlyCount = getEmojiOnlyCountForMessage(\n      messageUpdate.content, message?.groupedId || messageUpdate.groupedId,\n    );\n    text = messageUpdate.content.text ? addTimestampEntities(messageUpdate.content.text) : text;\n  }\n\n  const updatedMessage = {\n    ...message,\n    ...messageUpdate,\n    emojiOnlyCount,\n    text,\n  };\n\n  if (!updatedMessage.id) {\n    return global;\n  }\n\n  return updateScheduledMessages(global, chatId, {\n    [messageId]: updatedMessage,\n  });\n}\n\nexport function updateQuickReplyMessage<T extends GlobalState>(\n  global: T, messageId: number, messageUpdate: Partial<ApiMessage>,\n): T {\n  const message = selectQuickReplyMessage(global, messageId);\n  const updatedMessage = {\n    ...message,\n    ...messageUpdate,\n  };\n\n  if (!updatedMessage.id) {\n    return global;\n  }\n\n  return updateQuickReplyMessages(global, {\n    [messageId]: updatedMessage,\n  });\n}\n\nexport function deleteQuickReplyMessages<T extends GlobalState>(\n  global: T, messageIds: number[],\n): T {\n  const byId = global.quickReplies.messagesById;\n  const newById = omit(byId, messageIds);\n  return {\n    ...global,\n    quickReplies: {\n      ...global.quickReplies,\n      messagesById: newById,\n    },\n  };\n}\n\nexport function deleteChatMessages<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  messageIds: number[],\n): T {\n  const byId = selectChatMessages(global, chatId);\n  if (!byId) {\n    return global;\n  }\n\n  orderHistoryIds(messageIds);\n  const updatedThreads = new Map<ThreadId, number[]>();\n  updatedThreads.set(MAIN_THREAD_ID, messageIds);\n\n  const mediaIdsToRemove: number[] = [];\n  messageIds.forEach((messageId) => {\n    const message = byId[messageId];\n    if (!message) return;\n    if (isMediaLoadableInViewer(message)) {\n      mediaIdsToRemove.push(messageId);\n    }\n    const threadId = selectThreadIdFromMessage(global, message);\n    if (!threadId || threadId === MAIN_THREAD_ID) {\n      return;\n    }\n    const threadMessages = updatedThreads.get(threadId) || [];\n    threadMessages.push(messageId);\n    updatedThreads.set(threadId, threadMessages);\n    global = clearMessageTranslation(global, chatId, messageId);\n  });\n\n  const deletedForwardedPosts = Object.values(pickTruthy(byId, messageIds)).filter(\n    ({ forwardInfo }) => forwardInfo?.isLinkedChannelPost,\n  );\n\n  updatedThreads.forEach((threadMessageIds, threadId) => {\n    const threadInfo = selectThreadInfo(global, chatId, threadId);\n\n    let listedIds = selectListedIds(global, chatId, threadId);\n    let pinnedIds = selectPinnedIds(global, chatId, threadId);\n    let outlyingLists = selectOutlyingLists(global, chatId, threadId);\n    let newMessageCount = threadInfo?.messagesCount;\n\n    if (listedIds) {\n      listedIds = excludeSortedArray(listedIds, threadMessageIds);\n    }\n\n    if (outlyingLists) {\n      outlyingLists = outlyingLists.map((list) => excludeSortedArray(list, threadMessageIds));\n    }\n\n    if (pinnedIds) {\n      pinnedIds = excludeSortedArray(pinnedIds, orderPinnedIds(threadMessageIds));\n    }\n\n    const nonLocalMessageCount = threadMessageIds.filter((id) => !isLocalMessageId(id)).length;\n    if (newMessageCount !== undefined) {\n      newMessageCount -= nonLocalMessageCount;\n    }\n\n    Object.values(global.byTabId).forEach(({ id: tabId }) => {\n      const tabState = selectTabState(global, tabId);\n      const activeDownloadsInChat = Object.entries(tabState.activeDownloads).filter(\n        ([, { originChatId, originMessageId }]) => originChatId === chatId && originMessageId,\n      );\n\n      activeDownloadsInChat.forEach(([mediaHash, context]) => {\n        if (messageIds.includes(context.originMessageId!)) {\n          global = cancelMessageMediaDownload(global, [mediaHash], tabId);\n        }\n      });\n\n      mediaIdsToRemove.forEach((mediaId) => {\n        global = removeIdFromSearchResults(global, chatId, threadId, mediaId, tabId);\n      });\n\n      const viewportIds = selectViewportIds(global, chatId, threadId, tabId);\n      if (!viewportIds) return;\n\n      const newViewportIds = excludeSortedArray(viewportIds, messageIds);\n      global = replaceTabThreadParam(\n        global,\n        chatId,\n        threadId,\n        'viewportIds',\n        newViewportIds.length === 0 ? undefined : newViewportIds,\n        tabId,\n      );\n    });\n\n    global = replaceThreadParam(global, chatId, threadId, 'listedIds', listedIds);\n    global = replaceThreadParam(global, chatId, threadId, 'outlyingLists', outlyingLists);\n    global = replaceThreadParam(global, chatId, threadId, 'pinnedIds', pinnedIds);\n\n    if (threadInfo && newMessageCount !== undefined) {\n      global = updateThreadInfo(global, chatId, threadId, {\n        messagesCount: newMessageCount,\n      });\n    }\n  });\n\n  if (deletedForwardedPosts.length) {\n    Object.values(global.byTabId).forEach(({ id: tabId }) => {\n      const currentMessageList = selectCurrentMessageList(global, tabId);\n      const canDeleteCurrentThread = currentMessageList && currentMessageList.chatId === chatId\n        && currentMessageList.type === 'thread';\n      const currentThreadId = currentMessageList?.threadId;\n\n      deletedForwardedPosts.forEach((message) => {\n        const { fromChatId, fromMessageId } = message.forwardInfo!;\n        const originalPost = selectChatMessage(global, fromChatId!, fromMessageId!);\n\n        if (canDeleteCurrentThread && currentThreadId === message.id) {\n          global = updateCurrentMessageList(global, chatId, undefined, undefined, undefined, undefined, tabId);\n        }\n        if (originalPost) {\n          global = updateThread(global, fromChatId!, fromMessageId!, undefined);\n        }\n      });\n    });\n  }\n\n  const newById = omit(byId, messageIds);\n  global = replaceChatMessages(global, chatId, newById);\n\n  return global;\n}\n\nexport function deleteChatScheduledMessages<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  messageIds: number[],\n): T {\n  const byId = selectChatScheduledMessages(global, chatId);\n  if (!byId) {\n    return global;\n  }\n  const newById = omit(byId, messageIds);\n\n  let scheduledIds = selectScheduledIds(global, chatId, MAIN_THREAD_ID);\n  if (scheduledIds) {\n    messageIds.forEach((messageId) => {\n      if (scheduledIds!.includes(messageId)) {\n        scheduledIds = scheduledIds!.filter((id) => id !== messageId);\n      }\n    });\n    global = replaceThreadParam(global, chatId, MAIN_THREAD_ID, 'scheduledIds', scheduledIds);\n\n    Object.entries(global.messages.byChatId[chatId].threadsById).forEach(([threadId, thread]) => {\n      if (thread.scheduledIds) {\n        const newScheduledIds = thread.scheduledIds.filter((id) => !messageIds.includes(id));\n        global = replaceThreadParam(global, chatId, Number(threadId), 'scheduledIds', newScheduledIds);\n      }\n    });\n  }\n\n  global = {\n    ...global,\n    scheduledMessages: {\n      byChatId: {\n        ...global.scheduledMessages.byChatId,\n        [chatId]: {\n          byId: newById,\n        },\n      },\n    },\n  };\n\n  return global;\n}\n\nexport function updateListedIds<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  idsUpdate: number[],\n): T {\n  const listedIds = selectListedIds(global, chatId, threadId);\n  const newIds = listedIds?.length\n    ? idsUpdate.filter((id) => !listedIds.includes(id))\n    : idsUpdate;\n\n  if (listedIds && !newIds.length) {\n    return global;\n  }\n\n  return replaceThreadParam(global, chatId, threadId, 'listedIds', orderHistoryIds([\n    ...(listedIds || []),\n    ...newIds,\n  ]));\n}\n\nexport function removeOutlyingList<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  list: number[],\n): T {\n  const outlyingLists = selectOutlyingLists(global, chatId, threadId);\n  if (!outlyingLists) {\n    return global;\n  }\n\n  const newOutlyingLists = outlyingLists.filter((l) => l !== list);\n\n  return replaceThreadParam(global, chatId, threadId, 'outlyingLists', newOutlyingLists);\n}\n\nexport function updateOutlyingLists<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  idsUpdate: number[],\n): T {\n  if (!idsUpdate.length) return global;\n\n  const outlyingLists = selectOutlyingLists(global, chatId, threadId);\n\n  const newOutlyingLists = mergeIdRanges(outlyingLists || [], idsUpdate);\n\n  return replaceThreadParam(global, chatId, threadId, 'outlyingLists', newOutlyingLists);\n}\n\nexport function addViewportId<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  newId: number,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const viewportIds = selectViewportIds(global, chatId, threadId, tabId) || [];\n  if (viewportIds.includes(newId)) {\n    return global;\n  }\n\n  const newIds = orderHistoryIds([\n    ...(\n      viewportIds.length < MESSAGE_LIST_VIEWPORT_LIMIT\n        ? viewportIds\n        : viewportIds.slice(-(MESSAGE_LIST_SLICE / 2))\n    ),\n    newId,\n  ]);\n\n  return replaceTabThreadParam(global, chatId, threadId, 'viewportIds', newIds, tabId);\n}\n\nexport function safeReplaceViewportIds<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  newViewportIds: number[],\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const currentIds = selectViewportIds(global, chatId, threadId, tabId) || [];\n  const newIds = orderHistoryIds(newViewportIds);\n\n  return replaceTabThreadParam(\n    global,\n    chatId,\n    threadId,\n    'viewportIds',\n    areSortedArraysEqual(currentIds, newIds) ? currentIds : newIds,\n    tabId,\n  );\n}\n\nexport function safeReplacePinnedIds<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  newPinnedIds: number[],\n): T {\n  const currentIds = selectPinnedIds(global, chatId, threadId) || [];\n  const newIds = orderPinnedIds(newPinnedIds);\n\n  return replaceThreadParam(\n    global,\n    chatId,\n    threadId,\n    'pinnedIds',\n    areSortedArraysEqual(currentIds, newIds) ? currentIds : newIds,\n  );\n}\n\nexport function updateThreadInfo<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId, update: Partial<ApiThreadInfo> | undefined,\n  doNotUpdateLinked?: boolean,\n): T {\n  const newThreadInfo = {\n    ...(selectThreadInfo(global, chatId, threadId) as ApiThreadInfo),\n    ...update,\n  } as ApiThreadInfo;\n\n  if (!doNotUpdateLinked && !newThreadInfo.isCommentsInfo) {\n    const linkedUpdate = pick(newThreadInfo, ['messagesCount', 'lastMessageId', 'lastReadInboxMessageId']);\n    if (newThreadInfo.fromChannelId && newThreadInfo.fromMessageId) {\n      global = updateThreadInfo(\n        global, newThreadInfo.fromChannelId, newThreadInfo.fromMessageId, linkedUpdate, true,\n      );\n    }\n  }\n\n  return replaceThreadParam(global, chatId, threadId, 'threadInfo', newThreadInfo);\n}\n\nexport function updateThreadInfos<T extends GlobalState>(\n  global: T, updates: Partial<ApiThreadInfo>[],\n): T {\n  updates.forEach((update) => {\n    global = updateThreadInfo(\n      global,\n      update.isCommentsInfo ? update.originChannelId! : update.chatId!,\n      update.isCommentsInfo ? update.originMessageId! : update.threadId!,\n      update,\n    );\n  });\n\n  return global;\n}\n\nexport function updateScheduledMessages<T extends GlobalState>(\n  global: T, chatId: string, newById: Record<number, ApiMessage>,\n): T {\n  const current = global.scheduledMessages.byChatId[chatId] || { byId: {}, hash: 0 };\n\n  return {\n    ...global,\n    scheduledMessages: {\n      byChatId: {\n        ...global.scheduledMessages.byChatId,\n        [chatId]: {\n          ...current,\n          byId: {\n            ...current.byId,\n            ...newById,\n          },\n        },\n      },\n    },\n  };\n}\n\nexport function updateQuickReplyMessages<T extends GlobalState>(\n  global: T, update: Record<number, ApiMessage>,\n): T {\n  return {\n    ...global,\n    quickReplies: {\n      ...global.quickReplies,\n      messagesById: {\n        ...global.quickReplies.messagesById,\n        ...update,\n      },\n    },\n  };\n}\n\nexport function updateFocusedMessage<T extends GlobalState>(\n  {\n    global,\n    chatId,\n    messageId,\n    threadId = MAIN_THREAD_ID,\n    noHighlight = false,\n    isResizingContainer = false,\n    quote,\n    scrollTargetPosition,\n  }: {\n    global: T;\n    chatId?: string;\n    messageId?: number;\n    threadId?: ThreadId;\n    noHighlight?: boolean;\n    isResizingContainer?: boolean;\n    quote?: string;\n    scrollTargetPosition?: ScrollTargetPosition;\n  },\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    focusedMessage: {\n      ...selectTabState(global, tabId).focusedMessage,\n      chatId,\n      threadId,\n      messageId,\n      noHighlight,\n      isResizingContainer,\n      quote,\n      scrollTargetPosition,\n    },\n  }, tabId);\n}\n\nexport function updateSponsoredMessage<T extends GlobalState>(\n  global: T, chatId: string, message: ApiSponsoredMessage,\n): T {\n  return {\n    ...global,\n    messages: {\n      ...global.messages,\n      sponsoredByChatId: {\n        ...global.messages.sponsoredByChatId,\n        [chatId]: message,\n      },\n    },\n  };\n}\n\nexport function deleteSponsoredMessage<T extends GlobalState>(\n  global: T, chatId: string,\n): T {\n  const byChatId = global.messages.sponsoredByChatId;\n  if (!byChatId[chatId]) {\n    return global;\n  }\n\n  return {\n    ...global,\n    messages: {\n      ...global.messages,\n      sponsoredByChatId: omit(byChatId, [chatId]),\n    },\n  };\n}\n\nexport function updateFocusDirection<T extends GlobalState>(\n  global: T, direction?: FocusDirection,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    focusedMessage: {\n      ...selectTabState(global, tabId).focusedMessage,\n      direction,\n    },\n  }, tabId);\n}\n\nexport function enterMessageSelectMode<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  messageId?: number | number[],\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const messageIds = messageId ? Array.prototype.concat([], messageId) : [];\n\n  return updateTabState(global, {\n    selectedMessages: {\n      chatId,\n      messageIds,\n    },\n  }, tabId);\n}\n\nexport function toggleMessageSelection<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  messageListType: MessageListType,\n  messageId: number,\n  groupedId?: string,\n  childMessageIds?: number[],\n  withShift = false,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const { selectedMessages: oldSelectedMessages } = selectTabState(global, tabId);\n  if (groupedId) {\n    childMessageIds = selectMessageIdsByGroupId(global, chatId, groupedId);\n  }\n  const selectedMessageIds = childMessageIds || [messageId];\n  if (!oldSelectedMessages) {\n    return enterMessageSelectMode(global, chatId, selectedMessageIds, tabId);\n  }\n\n  const { messageIds } = oldSelectedMessages;\n\n  let newMessageIds;\n  const newSelectedMessageIds = selectedMessageIds.filter((id) => !messageIds.includes(id));\n  if (newSelectedMessageIds && !newSelectedMessageIds.length) {\n    newMessageIds = messageIds.filter((id) => !selectedMessageIds.includes(id));\n  } else if (withShift && messageIds.length) {\n    const viewportIds = selectCurrentMessageIds(global, chatId, threadId, messageListType, tabId)!;\n    const prevIndex = viewportIds.indexOf(messageIds[messageIds.length - 1]);\n    const currentIndex = viewportIds.indexOf(messageId);\n    const from = Math.min(prevIndex, currentIndex);\n    const to = Math.max(prevIndex, currentIndex);\n    const slice = viewportIds.slice(from, to + 1);\n    newMessageIds = unique([...messageIds, ...slice]);\n  } else {\n    newMessageIds = [...messageIds, ...newSelectedMessageIds];\n  }\n\n  if (!newMessageIds.length) {\n    return exitMessageSelectMode(global, tabId);\n  }\n\n  return updateTabState(global, {\n    selectedMessages: {\n      ...oldSelectedMessages,\n      messageIds: newMessageIds,\n    },\n  }, tabId);\n}\n\nexport function exitMessageSelectMode<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateTabState(global, {\n    selectedMessages: undefined,\n  }, tabId);\n}\n\nexport function updateThreadUnreadFromForwardedMessage<T extends GlobalState>(\n  global: T,\n  originMessage: ApiMessage,\n  chatId: string,\n  lastMessageId: number,\n  isDeleting?: boolean,\n): T {\n  const { channelPostId, fromChatId } = originMessage.forwardInfo || {};\n  if (channelPostId && fromChatId) {\n    const threadInfoOld = selectThreadInfo(global, chatId, channelPostId);\n    if (threadInfoOld) {\n      global = replaceThreadParam(global, chatId, channelPostId, 'threadInfo', {\n        ...threadInfoOld,\n        lastMessageId,\n        messagesCount: (threadInfoOld.messagesCount || 0) + (isDeleting ? -1 : 1),\n      });\n    }\n  }\n  return global;\n}\n\nexport function addActiveMediaDownload<T extends GlobalState>(\n  global: T,\n  mediaHash: string,\n  metadata: TabState['activeDownloads'][string],\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const tabState = selectTabState(global, tabId);\n\n  global = updateTabState(global, {\n    activeDownloads: {\n      ...tabState.activeDownloads,\n      [mediaHash]: metadata,\n    },\n  }, tabId);\n\n  return global;\n}\n\nexport function cancelMessageMediaDownload<T extends GlobalState>(\n  global: T,\n  mediaHashes: string[],\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const tabState = selectTabState(global, tabId);\n\n  const newActiveDownloads = omit(tabState.activeDownloads, mediaHashes);\n\n  global = updateTabState(global, {\n    activeDownloads: newActiveDownloads,\n  }, tabId);\n\n  return global;\n}\n\nexport function updateUploadByMessageKey<T extends GlobalState>(\n  global: T,\n  messageKey: MessageKey,\n  progress: number | undefined,\n) {\n  return {\n    ...global,\n    fileUploads: {\n      byMessageKey: progress !== undefined\n        ? {\n          ...global.fileUploads.byMessageKey,\n          [messageKey]: { progress },\n        }\n        : omit(global.fileUploads.byMessageKey, [messageKey]),\n    },\n  };\n}\n\nexport function updateQuickReplies<T extends GlobalState>(\n  global: T,\n  quickRepliesUpdate: Record<number, ApiQuickReply>,\n) {\n  return {\n    ...global,\n    quickReplies: {\n      ...global.quickReplies,\n      byId: {\n        ...global.quickReplies.byId,\n        ...quickRepliesUpdate,\n      },\n    },\n  };\n}\n\nexport function deleteQuickReply<T extends GlobalState>(\n  global: T,\n  quickReplyId: number,\n) {\n  return {\n    ...global,\n    quickReplies: {\n      ...global.quickReplies,\n      byId: omit(global.quickReplies.byId, [quickReplyId]),\n    },\n  };\n}\n\nexport function updatePoll<T extends GlobalState>(\n  global: T,\n  pollId: string,\n  pollUpdate: Partial<ApiPoll>,\n) {\n  const poll = selectPoll(global, pollId);\n\n  const oldResults = poll?.results;\n  let newResults = oldResults || pollUpdate.results;\n  if (poll && pollUpdate.results?.results) {\n    if (!poll.results || !pollUpdate.results.isMin) {\n      newResults = pollUpdate.results;\n    } else if (oldResults.results) {\n      // Update voters counts, but keep local `isChosen` values\n      newResults = {\n        ...pollUpdate.results,\n        results: pollUpdate.results.results.map((result) => ({\n          ...result,\n          isChosen: oldResults.results!.find((r) => r.option === result.option)?.isChosen,\n        })),\n        isMin: undefined,\n      };\n    }\n  }\n\n  const updatedPoll = {\n    ...poll,\n    ...pollUpdate,\n    results: newResults,\n  } satisfies ApiPoll;\n  if (!updatedPoll.id) {\n    return global;\n  }\n\n  return {\n    ...global,\n    messages: {\n      ...global.messages,\n      pollById: {\n        ...global.messages.pollById,\n        [pollId]: updatedPoll,\n      },\n    },\n  };\n}\n\nexport function updatePollVote<T extends GlobalState>(\n  global: T,\n  pollId: string,\n  peerId: string,\n  options: string[],\n) {\n  const poll = selectPoll(global, pollId);\n  if (!poll) {\n    return global;\n  }\n\n  const { recentVoterIds, totalVoters, results } = poll.results;\n  const newRecentVoterIds = recentVoterIds ? [...recentVoterIds] : [];\n  const newTotalVoters = totalVoters ? totalVoters + 1 : 1;\n  const newResults = results ? [...results] : [];\n\n  newRecentVoterIds.push(peerId);\n\n  options.forEach((option) => {\n    const targetOptionIndex = newResults.findIndex((result) => result.option === option);\n    const targetOption = newResults[targetOptionIndex];\n    const updatedOption: ApiPollResult = targetOption ? { ...targetOption } : { option, votersCount: 0 };\n\n    updatedOption.votersCount += 1;\n    if (peerId === global.currentUserId) {\n      updatedOption.isChosen = true;\n    }\n\n    if (targetOptionIndex) {\n      newResults[targetOptionIndex] = updatedOption;\n    } else {\n      newResults.push(updatedOption);\n    }\n  });\n\n  return updatePoll(global, pollId, {\n    results: {\n      ...poll.results,\n      recentVoterIds: newRecentVoterIds,\n      totalVoters: newTotalVoters,\n      results: newResults,\n    },\n  });\n}\n","import type { ApiMessage, ApiMessageSearchType } from '../../api/types';\nimport type {\n  ChatMediaSearchParams,\n  ChatMediaSearchSegment,\n  LoadingState,\n  MiddleSearchParams,\n  MiddleSearchResults,\n  SharedMediaType,\n  ThreadId,\n} from '../../types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport {\n  areSortedArraysEqual, areSortedArraysIntersecting, omit, unique,\n} from '../../util/iteratees';\nimport { buildChatThreadKey, isMediaLoadableInViewer } from '../helpers';\nimport { selectTabState } from '../selectors';\nimport { selectChatMediaSearch } from '../selectors/middleSearch';\nimport { updateTabState } from './tabs';\n\ninterface SharedMediaSearchParams {\n  currentType?: SharedMediaType;\n  resultsByType?: Partial<Record<SharedMediaType, {\n    totalCount?: number;\n    nextOffsetId: number;\n    foundIds: number[];\n  }>>;\n}\n\nfunction replaceMiddleSearch<T extends GlobalState>(\n  global: T,\n  chatThreadKey: string,\n  searchParams?: MiddleSearchParams,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const current = selectTabState(global, tabId).middleSearch.byChatThreadKey;\n  if (!searchParams) {\n    return updateTabState(global, {\n      middleSearch: {\n        byChatThreadKey: omit(current, [chatThreadKey]),\n      },\n    }, tabId);\n  }\n\n  const { type = 'chat', ...rest } = searchParams;\n  return updateTabState(global, {\n    middleSearch: {\n      byChatThreadKey: {\n        ...selectTabState(global, tabId).middleSearch.byChatThreadKey,\n        [chatThreadKey]: {\n          type,\n          ...rest,\n        },\n      },\n    },\n  }, tabId);\n}\n\nexport function updateMiddleSearch<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  update: Partial<MiddleSearchParams>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n  const currentSearch = selectTabState(global, tabId).middleSearch.byChatThreadKey[chatThreadKey];\n\n  const updated = {\n    type: 'chat',\n    ...currentSearch,\n    ...update,\n  } satisfies MiddleSearchParams;\n\n  if (!updated.isHashtag) {\n    updated.type = 'chat';\n  }\n\n  if (currentSearch && (currentSearch.type !== updated.type || currentSearch.savedTag !== updated.savedTag)) {\n    updated.results = undefined;\n  }\n\n  return replaceMiddleSearch(global, chatThreadKey, updated, tabId);\n}\n\nexport function resetMiddleSearch<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return replaceMiddleSearch(global, buildChatThreadKey(chatId, threadId), {\n    type: 'chat',\n  }, tabId);\n}\n\nfunction replaceMiddleSearchResults<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  results: MiddleSearchResults,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return updateMiddleSearch(global, chatId, threadId, {\n    results,\n    fetchingQuery: undefined,\n  }, tabId);\n}\n\nexport function updateMiddleSearchResults<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  update: MiddleSearchResults,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n  const { results } = selectTabState(global, tabId).middleSearch.byChatThreadKey[chatThreadKey] || {};\n  const prevQuery = (results?.query) || '';\n  if (update.query !== prevQuery) {\n    return replaceMiddleSearchResults(global, chatId, threadId, update, tabId);\n  }\n\n  const prevFoundIds = (results?.foundIds) || [];\n  const {\n    query, foundIds: newFoundIds, totalCount, nextOffsetId, nextOffsetPeerId, nextOffsetRate,\n  } = update;\n  const foundIds = unique(Array.prototype.concat(prevFoundIds, newFoundIds));\n  const foundOrPrevFoundIds = areSortedArraysEqual(prevFoundIds, foundIds) ? prevFoundIds : foundIds;\n\n  return replaceMiddleSearchResults(\n    global, chatId, threadId, {\n      query,\n      foundIds: foundOrPrevFoundIds,\n      totalCount,\n      nextOffsetId,\n      nextOffsetRate,\n      nextOffsetPeerId,\n    }, tabId,\n  );\n}\n\nexport function closeMiddleSearch<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return replaceMiddleSearch(global, chatThreadKey, undefined, tabId);\n}\n\nfunction replaceSharedMediaSearch<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  searchParams: SharedMediaSearchParams,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return updateTabState(global, {\n    sharedMediaSearch: {\n      byChatThreadKey: {\n        ...selectTabState(global, tabId).sharedMediaSearch.byChatThreadKey,\n        [chatThreadKey]: searchParams,\n      },\n    },\n  }, tabId);\n}\n\nexport function updateSharedMediaSearchType<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  currentType: SharedMediaType | undefined,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return replaceSharedMediaSearch(global, chatId, threadId, {\n    ...selectTabState(global, tabId).sharedMediaSearch.byChatThreadKey[chatThreadKey],\n    currentType,\n  }, tabId);\n}\n\nexport function replaceSharedMediaSearchResults<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  type: ApiMessageSearchType,\n  foundIds?: number[],\n  totalCount?: number,\n  nextOffsetId?: number,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return replaceSharedMediaSearch(global, chatId, threadId, {\n    ...selectTabState(global, tabId).sharedMediaSearch.byChatThreadKey[chatThreadKey],\n    resultsByType: {\n      ...(selectTabState(global, tabId).sharedMediaSearch.byChatThreadKey[chatThreadKey] || {}).resultsByType,\n      [type]: {\n        foundIds,\n        totalCount,\n        nextOffsetId,\n      },\n    },\n  }, tabId);\n}\n\nexport function updateSharedMediaSearchResults<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  type: SharedMediaType,\n  newFoundIds: number[],\n  totalCount?: number,\n  nextOffsetId?: number,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  const { resultsByType } = selectTabState(global, tabId).sharedMediaSearch.byChatThreadKey[chatThreadKey] || {};\n  const prevFoundIds = resultsByType?.[type] ? resultsByType[type]!.foundIds : [];\n  const foundIds = orderFoundIdsByDescending(unique(Array.prototype.concat(prevFoundIds, newFoundIds)));\n  const foundOrPrevFoundIds = areSortedArraysEqual(prevFoundIds, foundIds) ? prevFoundIds : foundIds;\n\n  return replaceSharedMediaSearchResults(\n    global,\n    chatId,\n    threadId,\n    type,\n    foundOrPrevFoundIds,\n    totalCount,\n    nextOffsetId,\n    tabId,\n  );\n}\n\nfunction orderFoundIdsByDescending(listedIds: number[]) {\n  return listedIds.sort((a, b) => b - a);\n}\n\nfunction orderFoundIdsByAscending(array: number[]) {\n  return array.sort((a, b) => a - b);\n}\n\nexport function mergeWithChatMediaSearchSegment(\n  foundIds: number[],\n  loadingState: LoadingState,\n  segment?: ChatMediaSearchSegment,\n)\n  : ChatMediaSearchSegment {\n  if (!segment) {\n    return {\n      foundIds,\n      loadingState,\n    };\n  }\n  const mergedFoundIds = orderFoundIdsByAscending(unique(Array.prototype.concat(segment.foundIds, foundIds)));\n  if (!areSortedArraysEqual(segment.foundIds, foundIds)) {\n    segment.foundIds = mergedFoundIds;\n  }\n  const mergedLoadingState : LoadingState = {\n    areAllItemsLoadedForwards: loadingState.areAllItemsLoadedForwards\n    || segment.loadingState.areAllItemsLoadedForwards,\n    areAllItemsLoadedBackwards: loadingState.areAllItemsLoadedBackwards\n    || segment.loadingState.areAllItemsLoadedBackwards,\n  };\n  segment.loadingState = mergedLoadingState;\n  return segment;\n}\n\nfunction mergeChatMediaSearchSegments(currentSegment: ChatMediaSearchSegment, segments: ChatMediaSearchSegment[]) {\n  return segments.reduce((acc, segment) => {\n    const hasIntersection = areSortedArraysIntersecting(segment.foundIds, currentSegment.foundIds);\n    if (hasIntersection) {\n      currentSegment = mergeWithChatMediaSearchSegment(\n        currentSegment.foundIds,\n        currentSegment.loadingState,\n        segment,\n      );\n    } else {\n      acc.push(segment);\n    }\n    return acc;\n  }, [] as ChatMediaSearchSegment[]);\n}\n\nexport function updateChatMediaSearchResults<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  currentSegment: ChatMediaSearchSegment,\n  searchParams: ChatMediaSearchParams,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const segments = mergeChatMediaSearchSegments(currentSegment, searchParams.segments);\n\n  return replaceChatMediaSearchResults(\n    global,\n    chatId,\n    threadId,\n    currentSegment,\n    segments,\n    tabId,\n  );\n}\n\nfunction removeIdFromSegment(id: number, segment: ChatMediaSearchSegment): ChatMediaSearchSegment {\n  const foundIds = segment.foundIds.filter((foundId) => foundId !== id);\n\n  return {\n    ...segment,\n    foundIds,\n  };\n}\n\nfunction removeIdsFromChatMediaSearchParams(\n  id: number,\n  searchParams: ChatMediaSearchParams,\n): ChatMediaSearchParams {\n  const currentSegment = removeIdFromSegment(id, searchParams.currentSegment);\n  const segments = searchParams.segments.map((segment) => removeIdFromSegment(id, segment));\n\n  return {\n    ...searchParams,\n    currentSegment,\n    segments,\n  };\n}\n\nexport function removeIdFromSearchResults<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  id: number,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const searchParams = selectChatMediaSearch(global, chatId, threadId, tabId);\n  if (!searchParams) return global;\n\n  const updatedSearchParams = removeIdsFromChatMediaSearchParams(id, searchParams);\n\n  return replaceChatMediaSearch(\n    global,\n    chatId,\n    threadId,\n    updatedSearchParams,\n    tabId,\n  );\n}\n\nfunction resetForwardsLoadingStateInParams(\n  searchParams: ChatMediaSearchParams,\n) {\n  searchParams.currentSegment.loadingState.areAllItemsLoadedForwards = false;\n  searchParams.segments.forEach((segment) => {\n    segment.loadingState.areAllItemsLoadedForwards = false;\n  });\n}\n\nexport function updateChatMediaLoadingState<T extends GlobalState>(\n  global: T,\n  newMessage: ApiMessage,\n  chatId: string,\n  threadId: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  if (!isMediaLoadableInViewer(newMessage)) {\n    return global;\n  }\n  const searchParams = selectChatMediaSearch(global, chatId, threadId, tabId);\n  if (!searchParams) return global;\n  resetForwardsLoadingStateInParams(searchParams);\n\n  return replaceChatMediaSearch(\n    global,\n    chatId,\n    threadId,\n    searchParams,\n    tabId,\n  );\n}\n\nexport function initializeChatMediaSearchResults<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const loadingState: LoadingState = {\n    areAllItemsLoadedForwards: false,\n    areAllItemsLoadedBackwards: false,\n  };\n  const currentSegment: ChatMediaSearchSegment = {\n    foundIds: [],\n    loadingState,\n  };\n  const segments: ChatMediaSearchSegment[] = [];\n\n  const isLoading = false;\n\n  return replaceChatMediaSearch(global, chatId, threadId, {\n    currentSegment,\n    segments,\n    isLoading,\n  }, tabId);\n}\n\nexport function setChatMediaSearchLoading<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  isLoading: boolean,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n  const searchParams = selectTabState(global, tabId).chatMediaSearch.byChatThreadKey[chatThreadKey];\n\n  if (!searchParams) {\n    return global;\n  }\n\n  return replaceChatMediaSearch(global, chatId, threadId, {\n    ...searchParams,\n    isLoading,\n  }, tabId);\n}\n\nexport function replaceChatMediaSearchResults<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  currentSegment: ChatMediaSearchSegment,\n  segments: ChatMediaSearchSegment[],\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return replaceChatMediaSearch(global, chatId, threadId, {\n    ...selectTabState(global, tabId).chatMediaSearch.byChatThreadKey[chatThreadKey],\n    currentSegment,\n    segments,\n  }, tabId);\n}\n\nfunction replaceChatMediaSearch<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  searchParams: ChatMediaSearchParams,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return updateTabState(global, {\n    chatMediaSearch: {\n      byChatThreadKey: {\n        ...selectTabState(global, tabId).chatMediaSearch.byChatThreadKey,\n        [chatThreadKey]: searchParams,\n      },\n    },\n  }, tabId);\n}\n","import type { GlobalState, TabArgs, TabState } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\n\nexport function updateTabState<T extends GlobalState>(\n  global: T,\n  tabStatePartial: Partial<TabState>,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): T {\n  return {\n    ...global,\n    byTabId: {\n      ...global.byTabId,\n      [tabId]: {\n        ...global.byTabId[tabId],\n        ...tabStatePartial,\n      },\n    },\n  };\n}\n","import type { ApiFormattedText } from '../../api/types';\nimport type { TranslatedMessage } from '../../types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { omit } from '../../util/iteratees';\nimport { selectMessageTranslations, selectTabState } from '../selectors';\nimport { updateTabState } from './tabs';\n\nexport function updateMessageTranslation<T extends GlobalState>(\n  global: T, chatId: string, messageId: number, toLanguageCode: string, translation: Partial<TranslatedMessage>,\n) {\n  const translatedMessages = selectMessageTranslations(global, chatId, toLanguageCode);\n\n  return {\n    ...global,\n    translations: {\n      ...global.translations,\n      byChatId: {\n        ...global.translations.byChatId,\n        [chatId]: {\n          ...global.translations.byChatId[chatId],\n          byLangCode: {\n            ...global.translations.byChatId[chatId]?.byLangCode,\n            [toLanguageCode]: {\n              ...translatedMessages,\n              [messageId]: {\n                ...translatedMessages[messageId],\n                ...translation,\n              },\n            },\n          },\n        },\n      },\n    },\n  };\n}\n\nexport function clearMessageTranslation<T extends GlobalState>(\n  global: T, chatId: string, messageId: number,\n) {\n  const chatTranslations = global.translations.byChatId[chatId];\n  if (!chatTranslations) return global;\n\n  const { byLangCode } = chatTranslations;\n  const newByLangCode = Object.keys(byLangCode).reduce((acc, langCode) => {\n    const newTranslatedMessages = omit(byLangCode[langCode], [messageId]);\n    if (Object.keys(newTranslatedMessages).length) {\n      acc[langCode] = newTranslatedMessages;\n    }\n\n    return acc;\n  }, {} as Record<string, Record<number, TranslatedMessage>>);\n\n  return {\n    ...global,\n    translations: {\n      ...global.translations,\n      byChatId: {\n        ...global.translations.byChatId,\n        [chatId]: {\n          ...chatTranslations,\n          byLangCode: newByLangCode,\n        },\n      },\n    },\n  };\n}\n\nexport function updateMessageTranslations<T extends GlobalState>(\n  global: T, chatId: string, messageIds: number[], toLanguageCode: string, translations: ApiFormattedText[],\n) {\n  messageIds.forEach((messageId, index) => {\n    global = updateMessageTranslation(global, chatId, messageId, toLanguageCode, {\n      text: translations[index],\n      isPending: false,\n    });\n  });\n\n  return global;\n}\n\nexport function updateRequestedChatTranslation<T extends GlobalState>(\n  global: T, chatId: string, toLanguageCode?: string, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const tabState = selectTabState(global, tabId);\n  global = updateTabState(global, {\n    requestedTranslations: {\n      ...tabState.requestedTranslations,\n      byChatId: {\n        ...tabState.requestedTranslations.byChatId,\n        [chatId]: {\n          toLanguage: toLanguageCode,\n        },\n      },\n    },\n  }, tabId);\n\n  return global;\n}\n\nexport function removeRequestedChatTranslation<T extends GlobalState>(\n  global: T, chatId: string, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const tabState = selectTabState(global, tabId);\n\n  global = updateTabState(global, {\n    requestedTranslations: {\n      ...tabState.requestedTranslations,\n      byChatId: omit(tabState.requestedTranslations.byChatId, [chatId]),\n    },\n  }, tabId);\n\n  return global;\n}\n\nexport function updateRequestedMessageTranslation<T extends GlobalState>(\n  global: T, chatId: string, messageId: number, toLanguageCode: string, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const tabState = selectTabState(global, tabId);\n  global = updateTabState(global, {\n    requestedTranslations: {\n      ...tabState.requestedTranslations,\n      byChatId: {\n        ...tabState.requestedTranslations.byChatId,\n        [chatId]: {\n          ...tabState.requestedTranslations.byChatId[chatId],\n          manualMessages: {\n            ...tabState.requestedTranslations.byChatId[chatId]?.manualMessages,\n            [messageId]: toLanguageCode,\n          },\n        },\n      },\n    },\n  }, tabId);\n\n  return global;\n}\n\nexport function removeRequestedMessageTranslation<T extends GlobalState>(\n  global: T, chatId: string, messageId: number, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const tabState = selectTabState(global, tabId);\n\n  const manualMessages = tabState.requestedTranslations.byChatId[chatId]?.manualMessages;\n  if (!manualMessages) return global;\n\n  const newManualMessages = omit(manualMessages, [messageId]);\n\n  global = updateTabState(global, {\n    requestedTranslations: {\n      ...tabState.requestedTranslations,\n      byChatId: {\n        ...tabState.requestedTranslations.byChatId,\n        [chatId]: {\n          ...tabState.requestedTranslations.byChatId[chatId],\n          manualMessages: newManualMessages,\n        },\n      },\n    },\n  }, tabId);\n\n  return global;\n}\n","import type {\n  ApiChat, ApiChatFullInfo, ApiChatType,\n} from '../../api/types';\nimport type { ChatListType } from '../../types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport {\n  ALL_FOLDER_ID, ARCHIVED_FOLDER_ID, MEMBERS_LOAD_SLICE, SAVED_FOLDER_ID, SERVICE_NOTIFICATIONS_USER_ID,\n} from '../../config';\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { IS_TRANSLATION_SUPPORTED } from '../../util/windowEnvironment';\nimport {\n  getHasAdminRight,\n  getPrivateChatUserId,\n  isChatChannel,\n  isChatSuperGroup,\n  isHistoryClearMessage,\n  isUserBot,\n  isUserId,\n  isUserOnline,\n} from '../helpers';\nimport { selectTabState } from './tabs';\nimport {\n  selectBot, selectIsCurrentUserPremium, selectUser, selectUserFullInfo,\n} from './users';\n\nexport function selectChat<T extends GlobalState>(global: T, chatId: string): ApiChat | undefined {\n  return global.chats.byId[chatId];\n}\n\nexport function selectChatFullInfo<T extends GlobalState>(global: T, chatId: string): ApiChatFullInfo | undefined {\n  return global.chats.fullInfoById[chatId];\n}\n\nexport function selectPeerFullInfo<T extends GlobalState>(global: T, peerId: string) {\n  if (isUserId(peerId)) return selectUserFullInfo(global, peerId);\n  return selectChatFullInfo(global, peerId);\n}\n\nexport function selectChatListLoadingParameters<T extends GlobalState>(\n  global: T, listType: ChatListType,\n) {\n  return global.chats.loadingParameters[listType];\n}\n\nexport function selectChatUser<T extends GlobalState>(global: T, chat: ApiChat) {\n  const userId = getPrivateChatUserId(chat);\n  if (!userId) {\n    return false;\n  }\n\n  return selectUser(global, userId);\n}\n\nexport function selectIsChatWithSelf<T extends GlobalState>(global: T, chatId: string) {\n  return chatId === global.currentUserId;\n}\n\nexport function selectIsChatWithBot<T extends GlobalState>(global: T, chat: ApiChat) {\n  const user = selectChatUser(global, chat);\n  return user && isUserBot(user);\n}\n\nexport function selectSupportChat<T extends GlobalState>(global: T) {\n  return Object.values(global.chats.byId).find(({ isSupport }: ApiChat) => isSupport);\n}\n\nexport function selectChatOnlineCount<T extends GlobalState>(global: T, chat: ApiChat) {\n  const fullInfo = selectChatFullInfo(global, chat.id);\n  if (isUserId(chat.id) || isChatChannel(chat) || !fullInfo) {\n    return undefined;\n  }\n\n  if (!fullInfo.members || fullInfo.members.length === MEMBERS_LOAD_SLICE) {\n    return fullInfo.onlineCount;\n  }\n\n  return fullInfo.members.reduce((onlineCount, { userId }) => {\n    if (\n      !selectIsChatWithSelf(global, userId)\n      && global.users.byId[userId]\n      && isUserOnline(global.users.byId[userId], global.users.statusesById[userId])\n    ) {\n      return onlineCount + 1;\n    }\n\n    return onlineCount;\n  }, 0);\n}\n\nexport function selectIsTrustedBot<T extends GlobalState>(global: T, botId: string) {\n  return global.trustedBotIds.includes(botId);\n}\n\nexport function selectChatType<T extends GlobalState>(global: T, chatId: string) : ApiChatType | undefined {\n  const bot = selectBot(global, chatId);\n  if (bot) {\n    return 'bots';\n  }\n\n  const user = selectUser(global, chatId);\n  if (user) {\n    return 'users';\n  }\n\n  const chat = selectChat(global, chatId);\n  if (!chat) return undefined;\n\n  if (isChatChannel(chat)) {\n    return 'channels';\n  }\n\n  return 'chats';\n}\n\nexport function selectIsChatBotNotStarted<T extends GlobalState>(global: T, chatId: string) {\n  const bot = selectBot(global, chatId);\n  if (!bot) {\n    return false;\n  }\n\n  const lastMessage = selectChatLastMessage(global, chatId);\n  if (lastMessage && isHistoryClearMessage(lastMessage)) {\n    return true;\n  }\n\n  return Boolean(!lastMessage);\n}\n\nexport function selectAreActiveChatsLoaded<T extends GlobalState>(global: T): boolean {\n  return Boolean(global.chats.listIds.active);\n}\n\nexport function selectIsChatListed<T extends GlobalState>(\n  global: T, chatId: string, type?: ChatListType,\n): boolean {\n  const { listIds } = global.chats;\n  if (type) {\n    const targetList = listIds[type];\n    return Boolean(targetList && targetList.includes(chatId));\n  }\n\n  return Object.values(listIds).some((list) => list && list.includes(chatId));\n}\n\nexport function selectChatListType<T extends GlobalState>(\n  global: T, chatId: string,\n): 'active' | 'archived' | undefined {\n  const chat = selectChat(global, chatId);\n  if (!chat || !selectIsChatListed(global, chatId)) {\n    return undefined;\n  }\n\n  return chat.folderId === ARCHIVED_FOLDER_ID ? 'archived' : 'active';\n}\n\nexport function selectChatFolder<T extends GlobalState>(global: T, folderId: number) {\n  return global.chatFolders.byId[folderId];\n}\n\nexport function selectTotalChatCount<T extends GlobalState>(global: T, listType: 'active' | 'archived'): number {\n  const { totalCount } = global.chats;\n  const allChatsCount = totalCount.all;\n  const archivedChatsCount = totalCount.archived || 0;\n\n  if (listType === 'archived') {\n    return archivedChatsCount;\n  }\n\n  return allChatsCount ? allChatsCount - archivedChatsCount : 0;\n}\n\nexport function selectIsChatPinned<T extends GlobalState>(\n  global: T, chatId: string, folderId = ALL_FOLDER_ID,\n): boolean {\n  const { active, archived, saved } = global.chats.orderedPinnedIds;\n\n  if (folderId === ALL_FOLDER_ID) {\n    return Boolean(active?.includes(chatId));\n  }\n\n  if (folderId === ARCHIVED_FOLDER_ID) {\n    return Boolean(archived?.includes(chatId));\n  }\n\n  if (folderId === SAVED_FOLDER_ID) {\n    return Boolean(saved?.includes(chatId));\n  }\n\n  const { byId: chatFoldersById } = global.chatFolders;\n\n  const { pinnedChatIds } = chatFoldersById[folderId] || {};\n  return Boolean(pinnedChatIds?.includes(chatId));\n}\n\n// Slow, not to be used in `withGlobal`\nexport function selectChatByUsername<T extends GlobalState>(global: T, username: string) {\n  const usernameLowered = username.toLowerCase();\n  return Object.values(global.chats.byId).find(\n    (chat) => chat.usernames?.some((c) => c.username.toLowerCase() === usernameLowered),\n  );\n}\n\nexport function selectIsServiceChatReady<T extends GlobalState>(global: T) {\n  return Boolean(selectChat(global, SERVICE_NOTIFICATIONS_USER_ID));\n}\n\nexport function selectSendAs<T extends GlobalState>(global: T, chatId: string) {\n  const chat = selectChat(global, chatId);\n  if (!chat) return undefined;\n\n  const id = selectChatFullInfo(global, chatId)?.sendAsId;\n  if (!id) return undefined;\n\n  return selectUser(global, id) || selectChat(global, id);\n}\n\nexport function selectRequestedDraft<T extends GlobalState>(\n  global: T, chatId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { requestedDraft } = selectTabState(global, tabId);\n  if (requestedDraft?.chatId === chatId && !requestedDraft.files?.length) {\n    return requestedDraft.text;\n  }\n  return undefined;\n}\n\nexport function selectRequestedDraftFiles<T extends GlobalState>(\n  global: T, chatId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { requestedDraft } = selectTabState(global, tabId);\n  if (requestedDraft?.chatId === chatId) {\n    return requestedDraft.files;\n  }\n  return undefined;\n}\n\nexport function filterChatIdsByType<T extends GlobalState>(\n  global: T, chatIds: string[], filter: readonly ApiChatType[],\n) {\n  return chatIds.filter((id) => {\n    const type = selectChatType(global, id);\n    if (!type) {\n      return false;\n    }\n    return filter.includes(type);\n  });\n}\n\nexport function selectCanInviteToChat<T extends GlobalState>(global: T, chatId: string) {\n  const chat = selectChat(global, chatId);\n  if (!chat) return false;\n\n  // https://github.com/TelegramMessenger/Telegram-iOS/blob/5126be83b3b9578fb014eb52ca553da9e7a8b83a/submodules/TelegramCore/Sources/TelegramEngine/Peers/Communities.swift#L6\n  return !chat.migratedTo && Boolean(!isUserId(chatId) && ((isChatChannel(chat) || isChatSuperGroup(chat)) ? (\n    chat.isCreator || getHasAdminRight(chat, 'inviteUsers')\n    || (chat.usernames?.length && !chat.isJoinRequest)\n  ) : (chat.isCreator || getHasAdminRight(chat, 'inviteUsers'))));\n}\n\nexport function selectCanShareFolder<T extends GlobalState>(global: T, folderId: number) {\n  const folder = selectChatFolder(global, folderId);\n  if (!folder) return false;\n\n  const {\n    bots, groups, channels, contacts, nonContacts, includedChatIds, pinnedChatIds,\n    excludeArchived, excludeMuted, excludeRead, excludedChatIds,\n  } = folder;\n\n  return !bots && !groups && !channels && !contacts && !nonContacts\n    && !excludeArchived && !excludeMuted && !excludeRead && !excludedChatIds?.length\n    && (pinnedChatIds?.length || includedChatIds.length)\n    && folder.includedChatIds.concat(folder.pinnedChatIds || []).some((chatId) => {\n      return selectCanInviteToChat(global, chatId);\n    });\n}\n\nexport function selectShouldDetectChatLanguage<T extends GlobalState>(\n  global: T, chatId: string,\n) {\n  const chat = selectChat(global, chatId);\n  if (!chat) return false;\n  const { canTranslateChats } = global.settings.byKey;\n\n  const isPremium = selectIsCurrentUserPremium(global);\n  const isSavedMessages = selectIsChatWithSelf(global, chatId);\n\n  return IS_TRANSLATION_SUPPORTED && canTranslateChats && isPremium && !isSavedMessages;\n}\n\nexport function selectCanTranslateChat<T extends GlobalState>(\n  global: T, chatId: string, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const chat = selectChat(global, chatId);\n  if (!chat) return false;\n\n  const requestedTranslation = selectRequestedChatTranslationLanguage(global, chatId, tabId);\n  if (requestedTranslation) return true; // Prevent translation dropping on reevaluation\n\n  const isLanguageDetectable = selectShouldDetectChatLanguage(global, chatId);\n  const detectedLanguage = chat.detectedLanguage;\n\n  const { doNotTranslate } = global.settings.byKey;\n\n  return Boolean(isLanguageDetectable && detectedLanguage && !doNotTranslate.includes(detectedLanguage));\n}\n\nexport function selectRequestedChatTranslationLanguage<T extends GlobalState>(\n  global: T, chatId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { requestedTranslations } = selectTabState(global, tabId);\n\n  return requestedTranslations.byChatId[chatId]?.toLanguage;\n}\n\nexport function selectSimilarChannelIds<T extends GlobalState>(\n  global: T,\n  chatId: string,\n) {\n  return global.chats.similarChannelsById[chatId];\n}\n\nexport function selectSimilarBotsIds<T extends GlobalState>(\n  global: T,\n  chatId: string,\n) {\n  return global.chats.similarBotsById[chatId];\n}\n\nexport function selectChatLastMessageId<T extends GlobalState>(\n  global: T, chatId: string, listType: 'all' | 'saved' = 'all',\n) {\n  return global.chats.lastMessageIds[listType]?.[chatId];\n}\n\nexport function selectChatLastMessage<T extends GlobalState>(\n  global: T, chatId: string, listType: 'all' | 'saved' = 'all',\n) {\n  const id = selectChatLastMessageId(global, chatId, listType);\n  if (!id) return undefined;\n\n  const realChatId = listType === 'saved' ? global.currentUserId! : chatId;\n  return global.messages.byChatId[realChatId]?.byId[id];\n}\n","import type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport {\n  getCanAddContact,\n  isAnonymousForwardsChat,\n  isChatAdmin, isChatGroup, isUserBot, isUserId,\n} from '../helpers';\nimport { selectChat, selectIsChatWithSelf } from './chats';\nimport { selectCurrentMessageList } from './messages';\nimport { selectTabState } from './tabs';\nimport { selectBot, selectUser } from './users';\n\nexport function selectManagement<T extends GlobalState>(\n  global: T, chatId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).management.byChatId[chatId];\n}\n\nexport function selectCurrentManagement<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n  if (!chatId || !threadId) {\n    return undefined;\n  }\n\n  const currentManagement = selectTabState(global, tabId).management.byChatId[chatId];\n  if (!currentManagement?.isActive) {\n    return undefined;\n  }\n\n  return currentManagement;\n}\n\nexport function selectCurrentManagementType<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n\n  if (!chatId || !threadId) {\n    return undefined;\n  }\n\n  const chatBot = selectBot(global, chatId);\n  if (chatBot) {\n    return 'bot';\n  }\n\n  if (isUserId(chatId)) {\n    return 'user';\n  }\n\n  const chat = selectChat(global, chatId);\n  if (!chat) {\n    return undefined;\n  }\n\n  if (isChatGroup(chat)) {\n    return 'group';\n  }\n\n  return 'channel';\n}\n\nexport function selectCanManage<T extends GlobalState>(\n  global: T,\n  chatId: string,\n) {\n  const chat = selectChat(global, chatId);\n  if (!chat || chat.isRestricted) return false;\n\n  const isPrivate = isUserId(chat.id);\n  const user = isPrivate ? selectUser(global, chatId) : undefined;\n  const canAddContact = user && getCanAddContact(user);\n\n  const isBot = user && isUserBot(user);\n  return Boolean(\n    !canAddContact\n    && chat\n    && !selectIsChatWithSelf(global, chat.id)\n    && !isAnonymousForwardsChat(chat.id)\n    // chat.isCreator is for Basic Groups\n    && (isUserId(chat.id) || ((isChatAdmin(chat) || chat.isCreator) && !chat.isNotJoined))\n    && !isBot,\n  );\n}\n","import type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { selectChatFullInfo } from './chats';\nimport { selectCurrentMessageList } from './messages';\nimport { selectTabState } from './tabs';\n\nexport function selectStatistics<T extends GlobalState>(\n  global: T, chatId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).statistics.byChatId[chatId];\n}\n\nexport function selectIsStatisticsShown<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  if (!selectTabState(global, tabId).isStatisticsShown) {\n    return false;\n  }\n\n  const { chatId: currentChatId } = selectCurrentMessageList(global, tabId) || {};\n\n  return currentChatId ? selectChatFullInfo(global, currentChatId)?.canViewStatistics : undefined;\n}\n","import type { ApiMessage, ApiSponsoredMessage } from '../../api/types';\nimport type { PerformanceTypeKey } from '../../types';\nimport type { GlobalState, TabArgs } from '../types';\nimport { NewChatMembersProgress, RightColumnContent } from '../../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { IS_SNAP_EFFECT_SUPPORTED } from '../../util/windowEnvironment';\nimport { getMessageVideo, getMessageWebPageVideo } from '../helpers/messageMedia';\nimport { selectCurrentManagement } from './management';\nimport { selectIsStatisticsShown } from './statistics';\nimport { selectTabState } from './tabs';\n\nexport function selectIsMediaViewerOpen<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const {\n    mediaViewer: {\n      chatId,\n      messageId,\n      isAvatarView,\n      standaloneMedia,\n      isSponsoredMessage,\n    },\n  } = selectTabState(global, tabId);\n  return Boolean(standaloneMedia || (chatId && (isAvatarView || messageId || isSponsoredMessage)));\n}\n\nexport function selectRightColumnContentKey<T extends GlobalState>(\n  global: T,\n  isMobile?: boolean,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const tabState = selectTabState(global, tabId);\n\n  return tabState.editTopicPanel ? (\n    RightColumnContent.EditTopic\n  ) : tabState.createTopicPanel ? (\n    RightColumnContent.CreateTopic\n  ) : tabState.pollResults.messageId ? (\n    RightColumnContent.PollResults\n  ) : selectCurrentManagement(global, tabId) ? (\n    RightColumnContent.Management\n  ) : tabState.isStatisticsShown && tabState.statistics.currentMessageId ? (\n    RightColumnContent.MessageStatistics\n  ) : tabState.isStatisticsShown && tabState.statistics.currentStoryId ? (\n    RightColumnContent.StoryStatistics\n  ) : selectIsStatisticsShown(global, tabId) ? (\n    RightColumnContent.Statistics\n  ) : tabState.boostStatistics ? (\n    RightColumnContent.BoostStatistics\n  ) : tabState.monetizationStatistics ? (\n    RightColumnContent.MonetizationStatistics\n  ) : tabState.stickerSearch.query !== undefined ? (\n    RightColumnContent.StickerSearch\n  ) : tabState.gifSearch.query !== undefined ? (\n    RightColumnContent.GifSearch\n  ) : tabState.newChatMembersProgress !== NewChatMembersProgress.Closed ? (\n    RightColumnContent.AddingMembers\n  ) : tabState.isChatInfoShown && tabState.messageLists.length ? (\n    RightColumnContent.ChatInfo\n  ) : undefined;\n}\n\nexport function selectIsRightColumnShown<T extends GlobalState>(\n  global: T,\n  isMobile?: boolean,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectRightColumnContentKey(global, isMobile, tabId) !== undefined;\n}\n\nexport function selectTheme<T extends GlobalState>(global: T) {\n  const { theme } = global.settings.byKey;\n\n  return theme;\n}\n\nexport function selectIsForumPanelOpen<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const tabState = selectTabState(global, tabId);\n\n  return Boolean(tabState.forumPanelChatId) && (\n    tabState.globalSearch.query === undefined || Boolean(tabState.globalSearch.isClosing)\n  );\n}\n\nexport function selectIsForumPanelClosed<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return !selectIsForumPanelOpen(global, tabId);\n}\n\nexport function selectIsReactionPickerOpen<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { reactionPicker } = selectTabState(global, tabId);\n  return Boolean(reactionPicker?.position);\n}\n\nexport function selectPerformanceSettings<T extends GlobalState>(global: T) {\n  return global.settings.performance;\n}\n\nexport function selectPerformanceSettingsValue<T extends GlobalState>(\n  global: T,\n  key: PerformanceTypeKey,\n) {\n  return global.settings.performance[key];\n}\n\nexport function selectCanAutoPlayMedia<T extends GlobalState>(global: T, message: ApiMessage | ApiSponsoredMessage) {\n  const video = getMessageVideo(message) || getMessageWebPageVideo(message);\n  if (!video) {\n    return undefined;\n  }\n\n  const canAutoPlayVideos = selectPerformanceSettingsValue(global, 'autoplayVideos');\n  const canAutoPlayGifs = selectPerformanceSettingsValue(global, 'autoplayGifs');\n\n  const asGif = video.isGif || video.isRound;\n\n  return (canAutoPlayVideos && !asGif) || (canAutoPlayGifs && asGif);\n}\n\nexport function selectShouldLoopStickers<T extends GlobalState>(global: T) {\n  return selectPerformanceSettingsValue(global, 'loopAnimatedStickers');\n}\n\nexport function selectCanPlayAnimatedEmojis<T extends GlobalState>(global: T) {\n  return selectPerformanceSettingsValue(global, 'animatedEmoji');\n}\n\nexport function selectCanAnimateInterface<T extends GlobalState>(global: T) {\n  return selectPerformanceSettingsValue(global, 'pageTransitions');\n}\n\nexport function selectIsContextMenuTranslucent<T extends GlobalState>(global: T) {\n  return selectPerformanceSettingsValue(global, 'contextMenuBlur');\n}\n\nexport function selectIsSynced<T extends GlobalState>(global: T) {\n  return global.isSynced;\n}\n\nexport function selectCanAnimateSnapEffect<T extends GlobalState>(global: T) {\n  return IS_SNAP_EFFECT_SUPPORTED && selectPerformanceSettingsValue(global, 'snapEffect');\n}\n\nexport function selectWebApp<T extends GlobalState>(\n  global: T, key: string, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).webApps.openedWebApps[key];\n}\n\nexport function selectActiveWebApp<T extends GlobalState>(\n  global: T, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const activeWebAppKey = selectTabState(global, tabId).webApps.activeWebAppKey;\n  if (!activeWebAppKey) return undefined;\n\n  return selectWebApp(global, activeWebAppKey, tabId);\n}\n","import type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { selectTabState } from './tabs';\n\nexport function selectCurrentGlobalSearchQuery<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).globalSearch.query;\n}\n","import type { GlobalState, TabArgs } from '../types';\n\nimport { DEFAULT_GIFT_PROFILE_FILTER_OPTIONS } from '../../config';\nimport arePropsShallowEqual from '../../util/arePropsShallowEqual';\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport {\n  getHasAdminRight, isChatAdmin, isChatChannel,\n} from '../helpers';\nimport { selectChat } from './chats';\nimport { selectTabState } from './tabs';\nimport { selectUser } from './users';\n\nexport function selectPaymentInputInvoice<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).payment.inputInvoice;\n}\n\nexport function selectPaymentForm<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).payment.form;\n}\n\nexport function selectStarsPayment<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).starsPayment;\n}\n\nexport function selectPaymentRequestId<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).payment.requestId;\n}\n\nexport function selectProviderPublishableKey<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).payment.form?.nativeParams.publishableKey;\n}\n\nexport function selectProviderPublicToken<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).payment.form?.nativeParams.publicToken;\n}\n\nexport function selectStripeCredentials<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).payment.stripeCredentials;\n}\n\nexport function selectSmartGlocalCredentials<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).payment.smartGlocalCredentials;\n}\n\nexport function selectCanUseGiftProfileAdminFilter<T extends GlobalState>(\n  global: T, peerId: string,\n) {\n  const chat = selectChat(global, peerId);\n  return chat && isChatChannel(chat) && isChatAdmin(chat) && getHasAdminRight(chat, 'postMessages');\n}\n\nexport function selectCanUseGiftProfileFilter<T extends GlobalState>(\n  global: T, peerId: string,\n) {\n  const chat = selectChat(global, peerId);\n  const user = selectUser(global, peerId);\n  return Boolean(user) || (chat && isChatChannel(chat));\n}\n\nexport function selectGiftProfileFilter<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectCanUseGiftProfileFilter(global, peerId) ? selectTabState(global, tabId).savedGifts.filter : undefined;\n}\n\nexport function selectIsGiftProfileFilterDefault<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return arePropsShallowEqual(selectTabState(global, tabId).savedGifts.filter, DEFAULT_GIFT_PROFILE_FILTER_OPTIONS);\n}\n","import type { GlobalState } from '../types';\n\nexport function selectNotifyDefaults<T extends GlobalState>(global: T) {\n  return global.settings.notifyDefaults;\n}\n\nexport function selectNotifyException<T extends GlobalState>(global: T, chatId: string) {\n  return global.chats.notifyExceptionById?.[chatId];\n}\n\nexport function selectLanguageCode<T extends GlobalState>(global: T) {\n  return global.settings.byKey.language.replace('-raw', '');\n}\n\nexport function selectCanSetPasscode<T extends GlobalState>(global: T) {\n  return global.authRememberMe;\n}\n\nexport function selectTranslationLanguage<T extends GlobalState>(global: T) {\n  return global.settings.byKey.translationLanguage || selectLanguageCode(global);\n}\n\nexport function selectNewNoncontactPeersRequirePremium<T extends GlobalState>(global: T) {\n  return global.settings.byKey.shouldNewNonContactPeersRequirePremium;\n}\n\nexport function selectShouldHideReadMarks<T extends GlobalState>(global: T) {\n  return global.settings.byKey.shouldHideReadMarks;\n}\n\nexport function selectSettingsKeys<T extends GlobalState>(global: T) {\n  return global.settings.byKey;\n}\n","import type {\n  ApiChat,\n  ApiInputMessageReplyInfo,\n  ApiMessage,\n  ApiMessageEntityCustomEmoji,\n  ApiMessageForwardInfo,\n  ApiMessageOutgoingStatus,\n  ApiPeer, ApiSponsoredMessage,\n  ApiStickerSetInfo,\n} from '../../api/types';\nimport type {\n  ChatTranslatedMessages,\n  MessageListType,\n  TabThread,\n  Thread,\n  ThreadId,\n} from '../../types';\nimport type { IAllowedAttachmentOptions } from '../helpers';\nimport type {\n  GlobalState, TabArgs,\n} from '../types';\nimport { ApiMessageEntityTypes, MAIN_THREAD_ID } from '../../api/types';\n\nimport {\n  ANONYMOUS_USER_ID, API_GENERAL_ID_LIMIT, GENERAL_TOPIC_ID, SERVICE_NOTIFICATIONS_USER_ID,\n} from '../../config';\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { findLast } from '../../util/iteratees';\nimport { getMessageKey, isLocalMessageId } from '../../util/keys/messageKey';\nimport { MEMO_EMPTY_ARRAY } from '../../util/memo';\nimport { getServerTime } from '../../util/serverTime';\nimport { IS_TRANSLATION_SUPPORTED } from '../../util/windowEnvironment';\nimport {\n  canSendReaction,\n  getAllowedAttachmentOptions,\n  getCanPostInChat,\n  getHasAdminRight,\n  getIsSavedDialog,\n  getMessageAudio,\n  getMessageDocument,\n  getMessageLink,\n  getMessagePaidMedia,\n  getMessagePhoto,\n  getMessageVideo,\n  getMessageVoice,\n  getMessageWebPagePhoto,\n  getMessageWebPageVideo,\n  getSendingState,\n  getTimestampableMedia,\n  hasMessageTtl,\n  isActionMessage,\n  isChatBasicGroup,\n  isChatChannel,\n  isChatGroup,\n  isChatSuperGroup,\n  isCommonBoxChat,\n  isExpiredMessage,\n  isForwardedMessage,\n  isMessageDocumentSticker,\n  isMessageFailed,\n  isMessageLocal,\n  isMessageTranslatable,\n  isOwnMessage,\n  isServiceNotificationMessage,\n  isUserId,\n  isUserRightBanned,\n} from '../helpers';\nimport { getMessageReplyInfo } from '../helpers/replies';\nimport {\n  selectChat,\n  selectChatFullInfo,\n  selectChatLastMessageId,\n  selectIsChatWithSelf,\n  selectRequestedChatTranslationLanguage,\n} from './chats';\nimport { selectPeer } from './peers';\nimport { selectPeerStory } from './stories';\nimport { selectIsStickerFavorite } from './symbols';\nimport { selectTabState } from './tabs';\nimport { selectTopic } from './topics';\nimport {\n  selectBot, selectIsCurrentUserPremium, selectUser, selectUserStatus,\n} from './users';\n\nexport function selectCurrentMessageList<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageLists } = selectTabState(global, tabId);\n\n  if (messageLists.length) {\n    return messageLists[messageLists.length - 1];\n  }\n\n  return undefined;\n}\n\nexport function selectCurrentChat<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { chatId } = selectCurrentMessageList(global, tabId) || {};\n\n  return chatId ? selectChat(global, chatId) : undefined;\n}\n\nexport function selectChatMessages<T extends GlobalState>(global: T, chatId: string) {\n  return global.messages.byChatId[chatId]?.byId;\n}\n\nexport function selectChatScheduledMessages<T extends GlobalState>(global: T, chatId: string) {\n  return global.scheduledMessages.byChatId[chatId]?.byId;\n}\n\nexport function selectTabThreadParam<T extends GlobalState, K extends keyof TabThread>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  key: K,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).tabThreads[chatId]?.[threadId]?.[key];\n}\n\nexport function selectThreadParam<T extends GlobalState, K extends keyof Thread>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  key: K,\n) {\n  return selectThread(global, chatId, threadId)?.[key];\n}\n\nexport function selectThread<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n) {\n  const messageInfo = global.messages.byChatId[chatId];\n  if (!messageInfo) {\n    return undefined;\n  }\n\n  const thread = messageInfo.threadsById[threadId];\n  if (!thread) {\n    return undefined;\n  }\n\n  return thread;\n}\n\nexport function selectListedIds<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'listedIds');\n}\n\nexport function selectOutlyingListByMessageId<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId, messageId: number,\n) {\n  const outlyingLists = selectOutlyingLists(global, chatId, threadId);\n  if (!outlyingLists) {\n    return undefined;\n  }\n\n  return outlyingLists.find((list) => {\n    return list[0] <= messageId && list[list.length - 1] >= messageId;\n  });\n}\n\nexport function selectOutlyingLists<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId,\n) {\n  return selectThreadParam(global, chatId, threadId, 'outlyingLists');\n}\n\nexport function selectCurrentMessageIds<T extends GlobalState>(\n  global: T,\n  chatId: string, threadId: ThreadId, messageListType: MessageListType,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  switch (messageListType) {\n    case 'thread':\n      return selectViewportIds(global, chatId, threadId, tabId);\n    case 'pinned':\n      return selectPinnedIds(global, chatId, threadId);\n    case 'scheduled':\n      return selectScheduledIds(global, chatId, threadId);\n  }\n\n  return undefined;\n}\n\nexport function selectViewportIds<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabThreadParam(global, chatId, threadId, 'viewportIds', tabId);\n}\n\nexport function selectPinnedIds<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'pinnedIds');\n}\n\nexport function selectScheduledIds<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'scheduledIds');\n}\n\nexport function selectScrollOffset<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabThreadParam(global, chatId, threadId, 'scrollOffset', tabId);\n}\n\nexport function selectLastScrollOffset<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'lastScrollOffset');\n}\n\nexport function selectEditingId<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'editingId');\n}\n\nexport function selectEditingDraft<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'editingDraft');\n}\n\nexport function selectEditingScheduledId<T extends GlobalState>(global: T, chatId: string) {\n  return selectThreadParam(global, chatId, MAIN_THREAD_ID, 'editingScheduledId');\n}\n\nexport function selectEditingScheduledDraft<T extends GlobalState>(global: T, chatId: string) {\n  return selectThreadParam(global, chatId, MAIN_THREAD_ID, 'editingScheduledDraft');\n}\n\nexport function selectDraft<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'draft');\n}\n\nexport function selectNoWebPage<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'noWebPage');\n}\n\nexport function selectThreadInfo<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'threadInfo');\n}\n\nexport function selectFirstMessageId<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectThreadParam(global, chatId, threadId, 'firstMessageId');\n}\n\nexport function selectReplyStack<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabThreadParam(global, chatId, threadId, 'replyStack', tabId);\n}\n\nexport function selectThreadMessagesCount(global: GlobalState, chatId: string, threadId: ThreadId) {\n  const chat = selectChat(global, chatId);\n  const threadInfo = selectThreadInfo(global, chatId, threadId);\n  if (!chat || !threadInfo || threadInfo.messagesCount === undefined) return undefined;\n  // In forum topics first message is ignored, but not in General\n  if (chat.isForum && threadId !== GENERAL_TOPIC_ID) return threadInfo.messagesCount - 1;\n  return threadInfo.messagesCount;\n}\n\nexport function selectThreadByMessage<T extends GlobalState>(global: T, message: ApiMessage) {\n  const threadId = selectThreadIdFromMessage(global, message);\n  if (!threadId || threadId === MAIN_THREAD_ID) {\n    return undefined;\n  }\n\n  return global.messages.byChatId[message.chatId].threadsById[threadId];\n}\n\nexport function selectIsMessageInCurrentMessageList<T extends GlobalState>(\n  global: T, chatId: string, message: ApiMessage,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const currentMessageList = selectCurrentMessageList(global, tabId);\n  if (!currentMessageList) {\n    return false;\n  }\n\n  const { threadInfo } = selectThreadByMessage(global, message) || {};\n  return (\n    chatId === currentMessageList.chatId\n    && (\n      (currentMessageList.threadId === MAIN_THREAD_ID)\n      || (threadInfo && currentMessageList.threadId === threadInfo.threadId)\n    )\n  );\n}\n\nexport function selectIsViewportNewest<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const viewportIds = selectViewportIds(global, chatId, threadId, tabId);\n  if (!viewportIds || !viewportIds.length) {\n    return true;\n  }\n\n  const isSavedDialog = getIsSavedDialog(chatId, threadId, global.currentUserId);\n\n  let lastMessageId: number;\n\n  if (threadId === MAIN_THREAD_ID) {\n    const id = selectChatLastMessageId(global, chatId);\n    if (!id) {\n      return true;\n    }\n    lastMessageId = id;\n  } else if (isSavedDialog) {\n    const id = selectChatLastMessageId(global, String(threadId), 'saved');\n    if (!id) {\n      return true;\n    }\n    lastMessageId = id;\n  } else {\n    const threadInfo = selectThreadInfo(global, chatId, threadId);\n    if (!threadInfo || !threadInfo.lastMessageId) {\n      if (!threadInfo?.threadId) return undefined;\n      // No messages in thread, except for the thread message itself\n      lastMessageId = Number(threadInfo?.threadId);\n    } else {\n      lastMessageId = threadInfo.lastMessageId;\n    }\n  }\n\n  // Edge case: outgoing `lastMessage` is updated with a delay to optimize animation\n  if (isLocalMessageId(lastMessageId) && !selectChatMessage(global, chatId, lastMessageId)) {\n    return true;\n  }\n\n  return viewportIds[viewportIds.length - 1] >= lastMessageId;\n}\n\nexport function selectChatMessage<T extends GlobalState>(global: T, chatId: string, messageId: number) {\n  const chatMessages = selectChatMessages(global, chatId);\n\n  return chatMessages ? chatMessages[messageId] : undefined;\n}\n\nexport function selectScheduledMessage<T extends GlobalState>(global: T, chatId: string, messageId: number) {\n  const chatMessages = selectChatScheduledMessages(global, chatId);\n\n  return chatMessages ? chatMessages[messageId] : undefined;\n}\n\nexport function selectQuickReplyMessage<T extends GlobalState>(global: T, messageId: number) {\n  return global.quickReplies.messagesById[messageId];\n}\n\nexport function selectEditingMessage<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId, messageListType: MessageListType,\n) {\n  if (messageListType === 'scheduled') {\n    const messageId = selectEditingScheduledId(global, chatId);\n    return messageId ? selectScheduledMessage(global, chatId, messageId) : undefined;\n  } else {\n    const messageId = selectEditingId(global, chatId, threadId);\n    return messageId ? selectChatMessage(global, chatId, messageId) : undefined;\n  }\n}\n\nexport function selectFocusedMessageId<T extends GlobalState>(\n  global: T, chatId: string, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { chatId: focusedChatId, messageId } = selectTabState(global, tabId).focusedMessage || {};\n\n  return focusedChatId === chatId ? messageId : undefined;\n}\n\nexport function selectIsMessageFocused<T extends GlobalState>(\n  global: T, message: ApiMessage, currentThreadId: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const focusedId = selectFocusedMessageId(global, message.chatId, tabId);\n  const threadId = selectTabState(global, tabId).focusedMessage?.threadId;\n\n  if (currentThreadId !== threadId) return false;\n\n  return focusedId ? focusedId === message.id || focusedId === message.previousLocalId : false;\n}\n\nexport function selectIsMessageUnread<T extends GlobalState>(global: T, message: ApiMessage) {\n  const { lastReadOutboxMessageId } = selectChat(global, message.chatId) || {};\n  return isMessageLocal(message) || !lastReadOutboxMessageId || lastReadOutboxMessageId < message.id;\n}\n\nexport function selectOutgoingStatus<T extends GlobalState>(\n  global: T, message: ApiMessage, isScheduledList = false,\n): ApiMessageOutgoingStatus {\n  if (!selectIsMessageUnread(global, message) && !isScheduledList) {\n    return 'read';\n  }\n\n  return getSendingState(message);\n}\n\nexport function selectSender<T extends GlobalState>(global: T, message: ApiMessage): ApiPeer | undefined {\n  const { senderId } = message;\n  const chat = selectChat(global, message.chatId);\n  const currentUser = selectUser(global, global.currentUserId!);\n  if (!senderId) {\n    return message.isOutgoing ? currentUser : chat;\n  }\n\n  if (chat && isChatChannel(chat) && !chat.areProfilesShown) return chat;\n\n  return selectPeer(global, senderId);\n}\n\nexport function getSendersFromSelectedMessages<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  messageIds: number[],\n) {\n  return messageIds.map((id) => {\n    const message = selectChatMessage(global, chatId, id);\n    return message && selectSender(global, message);\n  }).filter(Boolean);\n}\n\nexport function selectSenderFromMessage<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  messageId: number,\n): ApiPeer | undefined {\n  const message = selectChatMessage(global, chatId, messageId);\n\n  return message && selectSender(global, message);\n}\n\nexport function selectSenderFromHeader<T extends GlobalState>(\n  global: T,\n  header: ApiMessageForwardInfo,\n) {\n  const { fromId } = header;\n  if (fromId) {\n    return selectPeer(global, fromId);\n  }\n\n  return undefined;\n}\n\nexport function selectForwardedSender<T extends GlobalState>(\n  global: T, message: ApiMessage,\n): ApiPeer | undefined {\n  const isStoryForward = Boolean(message.content.storyData);\n  if (isStoryForward) {\n    const peerId = message.content.storyData!.peerId;\n    return selectPeer(global, peerId);\n  }\n\n  const { forwardInfo } = message;\n  if (!forwardInfo) {\n    return undefined;\n  }\n\n  if (forwardInfo.isChannelPost && forwardInfo.fromChatId) {\n    return selectChat(global, forwardInfo.fromChatId);\n  }\n\n  if (forwardInfo.hiddenUserName) {\n    return undefined;\n  }\n\n  if (forwardInfo.fromId) {\n    return selectPeer(global, forwardInfo.fromId);\n  }\n\n  if (forwardInfo.savedFromPeerId) {\n    return selectPeer(global, forwardInfo.savedFromPeerId);\n  }\n\n  return undefined;\n}\n\nexport function selectPoll<T extends GlobalState>(global: T, pollId: string) {\n  return global.messages.pollById[pollId];\n}\n\nexport function selectPollFromMessage<T extends GlobalState>(global: T, message: ApiMessage) {\n  if (!message.content.pollId) return undefined;\n  return selectPoll(global, message.content.pollId);\n}\n\nexport function selectTopicFromMessage<T extends GlobalState>(global: T, message: ApiMessage) {\n  const { chatId } = message;\n  const chat = selectChat(global, chatId);\n  if (!chat?.isForum) return undefined;\n\n  const threadId = selectThreadIdFromMessage(global, message);\n  return selectTopic(global, chatId, threadId);\n}\n\nconst MAX_MESSAGES_TO_DELETE_OWNER_TOPIC = 10;\nexport function selectCanDeleteOwnerTopic<T extends GlobalState>(global: T, chatId: string, topicId: number) {\n  const topic = selectTopic(global, chatId, topicId);\n  if (topic && !topic.isOwner) return false;\n\n  const thread = selectThread(global, chatId, topicId);\n  if (!thread) return false;\n\n  const { listedIds } = thread;\n  if (!listedIds\n    // Plus one for root message\n    || listedIds.length + 1 >= MAX_MESSAGES_TO_DELETE_OWNER_TOPIC) {\n    return false;\n  }\n\n  const hasNotOutgoingMessages = listedIds.some((messageId) => {\n    const message = selectChatMessage(global, chatId, messageId);\n    return !message || !message.isOutgoing;\n  });\n\n  return !hasNotOutgoingMessages;\n}\n\nexport function selectCanDeleteTopic<T extends GlobalState>(global: T, chatId: string, topicId: number) {\n  const chat = selectChat(global, chatId);\n  if (!chat) return false;\n\n  if (topicId === GENERAL_TOPIC_ID) return false;\n\n  return chat.isCreator\n    || getHasAdminRight(chat, 'deleteMessages')\n    || (chat.isForum\n      && selectCanDeleteOwnerTopic(global, chat.id, topicId));\n}\n\nexport function selectSavedDialogIdFromMessage<T extends GlobalState>(\n  global: T, message: ApiMessage,\n): string | undefined {\n  const {\n    chatId, senderId, forwardInfo, savedPeerId,\n  } = message;\n\n  if (savedPeerId) return savedPeerId;\n\n  if (chatId !== global.currentUserId) {\n    return undefined;\n  }\n\n  if (forwardInfo?.savedFromPeerId) {\n    return forwardInfo.savedFromPeerId;\n  }\n\n  if (forwardInfo?.fromId) {\n    return forwardInfo.fromId;\n  }\n\n  if (forwardInfo?.hiddenUserName) {\n    return ANONYMOUS_USER_ID;\n  }\n\n  return senderId;\n}\n\nexport function selectThreadIdFromMessage<T extends GlobalState>(global: T, message: ApiMessage): ThreadId {\n  const savedDialogId = selectSavedDialogIdFromMessage(global, message);\n  if (savedDialogId) {\n    return savedDialogId;\n  }\n\n  const chat = selectChat(global, message.chatId);\n  const { content } = message;\n  const { replyToMsgId, replyToTopId, isForumTopic } = getMessageReplyInfo(message) || {};\n  if ('action' in content && content.action?.type === 'topicCreate') {\n    return message.id;\n  }\n\n  if (!chat?.isForum) {\n    if (chat && isChatBasicGroup(chat)) return MAIN_THREAD_ID;\n\n    if (chat && isChatSuperGroup(chat)) {\n      return replyToTopId || replyToMsgId || MAIN_THREAD_ID;\n    }\n    return MAIN_THREAD_ID;\n  }\n  if (!isForumTopic) return GENERAL_TOPIC_ID;\n  return replyToTopId || replyToMsgId || GENERAL_TOPIC_ID;\n}\n\nexport function selectCanReplyToMessage<T extends GlobalState>(global: T, message: ApiMessage, threadId: ThreadId) {\n  const chat = selectChat(global, message.chatId);\n  if (!chat || chat.isRestricted || chat.isForbidden) return false;\n\n  const isLocal = isMessageLocal(message);\n  const isServiceNotification = isServiceNotificationMessage(message);\n\n  if (isLocal || isServiceNotification) return false;\n\n  const threadInfo = selectThreadInfo(global, message.chatId, threadId);\n  const isMessageThread = Boolean(!threadInfo?.isCommentsInfo && threadInfo?.fromChannelId);\n  const chatFullInfo = selectChatFullInfo(global, chat.id);\n  const topic = selectTopic(global, chat.id, threadId);\n  const canPostInChat = getCanPostInChat(chat, topic, isMessageThread, chatFullInfo);\n  if (!canPostInChat) return false;\n\n  const messageTopic = selectTopicFromMessage(global, message);\n  return !messageTopic || !messageTopic.isClosed || messageTopic.isOwner || getHasAdminRight(chat, 'manageTopics');\n}\n\nexport function selectCanForwardMessage<T extends GlobalState>(global: T, message: ApiMessage) {\n  const isLocal = isMessageLocal(message);\n  const isServiceNotification = isServiceNotificationMessage(message);\n  const isAction = isActionMessage(message);\n  const hasTtl = hasMessageTtl(message);\n  const { content } = message;\n  const story = content.storyData\n    ? selectPeerStory(global, content.storyData.peerId, content.storyData.id)\n    : (content.webPage?.story\n      ? selectPeerStory(global, content.webPage.story.peerId, content.webPage.story.id)\n      : undefined\n    );\n  const isChatProtected = selectIsChatProtected(global, message.chatId);\n  const isStoryForwardForbidden = story && ('isDeleted' in story || ('noForwards' in story && story.noForwards));\n  const canForward = (\n    !isLocal && !isAction && !isChatProtected && !isStoryForwardForbidden\n    && (message.isForwardingAllowed || isServiceNotification) && !hasTtl\n  );\n\n  return canForward;\n}\n\n// This selector is slow and not to be used within lists (e.g. Message component)\nexport function selectAllowedMessageActionsSlow<T extends GlobalState>(\n  global: T, message: ApiMessage, threadId: ThreadId,\n) {\n  const chat = selectChat(global, message.chatId);\n  if (!chat || chat.isRestricted) {\n    return {};\n  }\n\n  const isPrivate = isUserId(chat.id);\n  const isChatWithSelf = selectIsChatWithSelf(global, message.chatId);\n  const isBasicGroup = isChatBasicGroup(chat);\n  const isSuperGroup = isChatSuperGroup(chat);\n  const isChannel = isChatChannel(chat);\n  const isBotChat = Boolean(selectBot(global, chat.id));\n  const isLocal = isMessageLocal(message);\n  const isFailed = isMessageFailed(message);\n  const isServiceNotification = isServiceNotificationMessage(message);\n  const isOwn = isOwnMessage(message);\n  const isForwarded = isForwardedMessage(message);\n  const isAction = isActionMessage(message);\n  const hasTtl = hasMessageTtl(message);\n  const { content } = message;\n  const isDocumentSticker = isMessageDocumentSticker(message);\n  const isBoostMessage = message.content.action?.type === 'boostApply';\n\n  const hasChatPinPermission = (chat.isCreator\n    || (!isChannel && !isUserRightBanned(chat, 'pinMessages'))\n    || getHasAdminRight(chat, 'pinMessages'));\n\n  const hasPinPermission = isPrivate || hasChatPinPermission;\n\n  // https://github.com/telegramdesktop/tdesktop/blob/335095a332607c41a8d20b47e61f5bbd66366d4b/Telegram/SourceFiles/data/data_peer.cpp#L653\n  const canEditMessagesIndefinitely = (() => {\n    if (isPrivate) return isChatWithSelf;\n    if (isBasicGroup) return false;\n    if (isSuperGroup) return hasChatPinPermission;\n    if (isChannel) return chat.isCreator || getHasAdminRight(chat, 'editMessages');\n    return false;\n  })();\n\n  const isMessageEditable = (\n    (\n      canEditMessagesIndefinitely\n      || getServerTime() - message.date < (global.config?.editTimeLimit || Infinity)\n    ) && !(\n      content.sticker || content.contact || content.pollId || content.action\n      || (content.video?.isRound) || content.location || content.invoice || content.giveaway || content.giveawayResults\n      || isDocumentSticker\n    )\n    && !isForwarded\n    && !message.viaBotId\n    && !chat.isForbidden\n  );\n\n  const isSavedDialog = getIsSavedDialog(chat.id, threadId, global.currentUserId);\n\n  const canReply = selectCanReplyToMessage(global, message, threadId);\n  const canReplyGlobally = canReply || (!isSavedDialog && !isLocal && !isServiceNotification\n    && (isSuperGroup || isBasicGroup || isChatChannel(chat)));\n\n  let canPin = !isLocal && !isServiceNotification && !isAction && hasPinPermission && !isSavedDialog;\n  let canUnpin = false;\n\n  const pinnedMessageIds = selectPinnedIds(global, chat.id, threadId);\n\n  if (canPin) {\n    canUnpin = Boolean(pinnedMessageIds && pinnedMessageIds.includes(message.id));\n    canPin = !canUnpin;\n  }\n\n  const canNotDeleteBoostMessage = isBoostMessage && isOwn\n    && !chat.isCreator && !getHasAdminRight(chat, 'deleteMessages');\n\n  const canDelete = (!isLocal || isFailed) && !isServiceNotification && !canNotDeleteBoostMessage && (\n    isPrivate\n    || isOwn\n    || isBasicGroup\n    || chat.isCreator\n    || getHasAdminRight(chat, 'deleteMessages')\n  );\n\n  const canReport = !isPrivate && !isOwn;\n\n  const canDeleteForAll = canDelete && !chat.isForbidden && (\n    (isPrivate && !isChatWithSelf && !isBotChat)\n    || (isBasicGroup && (\n      isOwn || getHasAdminRight(chat, 'deleteMessages') || chat.isCreator\n    ))\n  );\n\n  const hasMessageEditRight = isOwn || (isChannel && (chat.isCreator || getHasAdminRight(chat, 'editMessages')));\n\n  const canEdit = !isLocal && !isAction && isMessageEditable && hasMessageEditRight;\n\n  const hasSticker = Boolean(message.content.sticker);\n  const hasFavoriteSticker = hasSticker && selectIsStickerFavorite(global, message.content.sticker!);\n  const canFaveSticker = !isAction && hasSticker && !hasFavoriteSticker;\n  const canUnfaveSticker = !isAction && hasFavoriteSticker;\n  const canCopy = !isAction;\n  const canCopyLink = !isLocal && !isAction && (isChannel || isSuperGroup);\n  const canSelect = !isLocal && !isAction;\n\n  const canDownload = Boolean(content.webPage?.document || content.webPage?.video || content.webPage?.photo\n      || content.audio || content.voice || content.photo || content.video || content.document || content.sticker)\n    && !hasTtl;\n\n  const canSaveGif = message.content.video?.isGif;\n\n  const poll = content.pollId ? selectPoll(global, content.pollId) : undefined;\n  const canRevote = !poll?.summary.closed && !poll?.summary.quiz && poll?.results.results?.some((r) => r.isChosen);\n  const canClosePoll = hasMessageEditRight && poll && !poll.summary.closed && !isForwarded;\n\n  const noOptions = [\n    canReply,\n    canReplyGlobally,\n    canEdit,\n    canPin,\n    canUnpin,\n    canReport,\n    canDelete,\n    canDeleteForAll,\n    canFaveSticker,\n    canUnfaveSticker,\n    canCopy,\n    canCopyLink,\n    canSelect,\n    canDownload,\n    canSaveGif,\n    canRevote,\n    canClosePoll,\n  ].every((ability) => !ability);\n\n  return {\n    noOptions,\n    canReply,\n    canReplyGlobally,\n    canEdit,\n    canPin,\n    canUnpin,\n    canReport,\n    canDelete,\n    canDeleteForAll,\n    canFaveSticker,\n    canUnfaveSticker,\n    canCopy,\n    canCopyLink,\n    canSelect,\n    canDownload,\n    canSaveGif,\n    canRevote,\n    canClosePoll,\n  };\n}\n\nexport function selectCanDeleteMessages<T extends GlobalState>(\n  global: T,\n  chatId: string,\n  threadId: ThreadId,\n  messageIds: number[],\n) {\n  const chatMessages = selectChatMessages(global, chatId);\n\n  if (messageIds.length > API_GENERAL_ID_LIMIT) {\n    return {};\n  }\n\n  const messageActions = messageIds\n    .map((id) => chatMessages[id] && selectAllowedMessageActionsSlow(global, chatMessages[id], threadId))\n    .filter(Boolean);\n\n  return {\n    canDelete: messageActions.every((actions) => actions.canDelete),\n    canDeleteForAll: messageActions.every((actions) => actions.canDeleteForAll),\n  };\n}\n\nexport function selectCanDeleteSelectedMessages<T extends GlobalState>(\n  global: T,\n  messageIds?: number[],\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageIds: selectedMessageIds } = selectTabState(global, tabId).selectedMessages || {};\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n  const messageIdList = messageIds?.length ? messageIds : selectedMessageIds;\n  if (!chatId || !threadId || !messageIdList) {\n    return {};\n  }\n\n  return selectCanDeleteMessages(global, chatId, threadId, messageIdList);\n}\n\nexport function selectCanReportSelectedMessages<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageIds: selectedMessageIds } = selectTabState(global, tabId).selectedMessages || {};\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n  const chatMessages = chatId && selectChatMessages(global, chatId);\n  if (!chatMessages || !selectedMessageIds || !threadId) {\n    return false;\n  }\n\n  const messageActions = selectedMessageIds\n    .map((id) => chatMessages[id] && selectAllowedMessageActionsSlow(global, chatMessages[id], threadId))\n    .filter(Boolean);\n\n  return messageActions.every((actions) => actions.canReport);\n}\n\nexport function selectCanDownloadSelectedMessages<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageIds: selectedMessageIds } = selectTabState(global, tabId).selectedMessages || {};\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n  const chatMessages = chatId && selectChatMessages(global, chatId);\n  if (!chatMessages || !selectedMessageIds || !threadId) {\n    return false;\n  }\n\n  const messageActions = selectedMessageIds\n    .map((id) => chatMessages[id] && selectAllowedMessageActionsSlow(global, chatMessages[id], threadId))\n    .filter(Boolean);\n\n  return messageActions.some((actions) => actions.canDownload);\n}\n\nexport function selectActiveDownloads<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).activeDownloads;\n}\n\nexport function selectUploadProgress<T extends GlobalState>(global: T, message: ApiMessage) {\n  return global.fileUploads.byMessageKey[getMessageKey(message)]?.progress;\n}\n\nexport function selectRealLastReadId<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  if (threadId === MAIN_THREAD_ID) {\n    const chat = selectChat(global, chatId);\n    if (!chat) {\n      return undefined;\n    }\n\n    // `lastReadInboxMessageId` is empty for new chats\n    if (!chat.lastReadInboxMessageId) {\n      return undefined;\n    }\n\n    const lastMessageId = selectChatLastMessageId(global, chatId);\n\n    if (!lastMessageId || chat.unreadCount) {\n      return chat.lastReadInboxMessageId;\n    }\n\n    return lastMessageId;\n  } else {\n    const threadInfo = selectThreadInfo(global, chatId, threadId);\n    if (!threadInfo) {\n      return undefined;\n    }\n\n    if (!threadInfo.lastReadInboxMessageId) {\n      return Number(threadInfo.threadId);\n    }\n\n    // Some previously read messages may be deleted\n    return Math.min(threadInfo.lastReadInboxMessageId, threadInfo.lastMessageId || Infinity);\n  }\n}\n\nexport function selectFirstUnreadId<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId,\n) {\n  const chat = selectChat(global, chatId);\n\n  if (threadId === MAIN_THREAD_ID) {\n    if (!chat) {\n      return undefined;\n    }\n  } else {\n    const threadInfo = selectThreadInfo(global, chatId, threadId);\n    if (!threadInfo\n      || (threadInfo.lastMessageId !== undefined && threadInfo.lastMessageId === threadInfo.lastReadInboxMessageId)) {\n      return undefined;\n    }\n  }\n\n  const outlyingLists = selectOutlyingLists(global, chatId, threadId);\n  const listedIds = selectListedIds(global, chatId, threadId);\n  const byId = selectChatMessages(global, chatId);\n  if (!byId || !(outlyingLists?.length || listedIds)) {\n    return undefined;\n  }\n\n  const lastReadId = selectRealLastReadId(global, chatId, threadId);\n  if (!lastReadId && chat && chat.isNotJoined) {\n    return undefined;\n  }\n\n  const lastReadServiceNotificationId = chatId === SERVICE_NOTIFICATIONS_USER_ID\n    ? global.serviceNotifications.reduce((max, notification) => {\n      return !notification.isUnread && notification.id > max ? notification.id : max;\n    }, -1)\n    : -1;\n\n  function findAfterLastReadId(listIds: number[]) {\n    return listIds.find((id) => {\n      return (\n        (!lastReadId || id > lastReadId)\n        && byId[id]\n        && (!byId[id].isOutgoing || byId[id].isFromScheduled)\n        && id > lastReadServiceNotificationId\n      );\n    });\n  }\n\n  if (outlyingLists?.length) {\n    const found = outlyingLists.map((list) => findAfterLastReadId(list)).filter(Boolean)[0];\n    if (found) {\n      return found;\n    }\n  }\n\n  if (listedIds) {\n    const found = findAfterLastReadId(listedIds);\n    if (found) {\n      return found;\n    }\n  }\n\n  return undefined;\n}\n\nexport function selectIsForwardModalOpen<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { isShareMessageModalShown } = selectTabState(global, tabId);\n  return Boolean(isShareMessageModalShown);\n}\n\nexport function selectCommonBoxChatId<T extends GlobalState>(global: T, messageId: number) {\n  const fromLastMessage = Object.values(global.chats.byId).find((chat) => (\n    isCommonBoxChat(chat) && selectChatLastMessageId(global, chat.id) === messageId\n  ));\n  if (fromLastMessage) {\n    return fromLastMessage.id;\n  }\n\n  const { byChatId } = global.messages;\n  return Object.keys(byChatId).find((chatId) => {\n    const chat = selectChat(global, chatId);\n    return chat && isCommonBoxChat(chat) && byChatId[chat.id].byId[messageId];\n  });\n}\n\nexport function selectIsInSelectMode<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { selectedMessages } = selectTabState(global, tabId);\n\n  return Boolean(selectedMessages);\n}\n\nexport function selectIsMessageSelected<T extends GlobalState>(\n  global: T, messageId: number,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageIds } = selectTabState(global, tabId).selectedMessages || {};\n  if (!messageIds) {\n    return false;\n  }\n\n  return messageIds.includes(messageId);\n}\n\nexport function selectForwardedMessageIdsByGroupId<T extends GlobalState>(\n  global: T, chatId: string, groupedId: string,\n) {\n  const chatMessages = selectChatMessages(global, chatId);\n  if (!chatMessages) {\n    return undefined;\n  }\n\n  return Object.values(chatMessages)\n    .filter((message) => message.groupedId === groupedId && message.forwardInfo)\n    .map(({ forwardInfo }) => forwardInfo!.fromMessageId);\n}\n\nexport function selectMessageIdsByGroupId<T extends GlobalState>(global: T, chatId: string, groupedId: string) {\n  const chatMessages = selectChatMessages(global, chatId);\n  if (!chatMessages) {\n    return undefined;\n  }\n\n  return Object.keys(chatMessages)\n    .map(Number)\n    .filter((id) => chatMessages[id].groupedId === groupedId);\n}\n\nexport function selectIsDocumentGroupSelected<T extends GlobalState>(\n  global: T, chatId: string, groupedId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageIds: selectedIds } = selectTabState(global, tabId).selectedMessages || {};\n  if (!selectedIds) {\n    return false;\n  }\n\n  const groupIds = selectMessageIdsByGroupId(global, chatId, groupedId);\n  return groupIds && groupIds.every((id) => selectedIds.includes(id));\n}\n\nexport function selectSelectedMessagesCount<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageIds } = selectTabState(global, tabId).selectedMessages || {};\n\n  return messageIds ? messageIds.length : 0;\n}\n\nexport function selectNewestMessageWithBotKeyboardButtons<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId = MAIN_THREAD_ID,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n): ApiMessage | undefined {\n  const chat = selectChat(global, chatId);\n  if (!chat) {\n    return undefined;\n  }\n\n  const chatMessages = selectChatMessages(global, chatId);\n  const viewportIds = selectViewportIds(global, chatId, threadId, tabId);\n  if (!chatMessages || !viewportIds) {\n    return undefined;\n  }\n\n  const messageId = findLast(viewportIds, (id) => {\n    const message = chatMessages[id];\n    return message && selectShouldDisplayReplyKeyboard(global, message);\n  });\n\n  const replyHideMessageId = findLast(viewportIds, (id) => {\n    const message = chatMessages[id];\n    return message && selectShouldHideReplyKeyboard(global, message);\n  });\n\n  if (messageId && replyHideMessageId && replyHideMessageId > messageId) {\n    return undefined;\n  }\n\n  return messageId ? chatMessages[messageId] : undefined;\n}\n\nfunction selectShouldHideReplyKeyboard<T extends GlobalState>(global: T, message: ApiMessage) {\n  const {\n    shouldHideKeyboardButtons,\n    isHideKeyboardSelective,\n    isMentioned,\n  } = message;\n  if (!shouldHideKeyboardButtons) return false;\n\n  const replyToMessageId = getMessageReplyInfo(message)?.replyToMsgId;\n\n  if (isHideKeyboardSelective) {\n    if (isMentioned) return true;\n    if (!replyToMessageId) return false;\n\n    const replyMessage = selectChatMessage(global, message.chatId, replyToMessageId);\n    return Boolean(replyMessage?.senderId === global.currentUserId);\n  }\n  return true;\n}\n\nfunction selectShouldDisplayReplyKeyboard<T extends GlobalState>(global: T, message: ApiMessage) {\n  const {\n    keyboardButtons,\n    shouldHideKeyboardButtons,\n    isKeyboardSelective,\n    isMentioned,\n  } = message;\n  if (!keyboardButtons || shouldHideKeyboardButtons) return false;\n\n  const replyToMessageId = getMessageReplyInfo(message)?.replyToMsgId;\n\n  if (isKeyboardSelective) {\n    if (isMentioned) return true;\n    if (!replyToMessageId) return false;\n\n    const replyMessage = selectChatMessage(global, message.chatId, replyToMessageId);\n    return Boolean(replyMessage?.senderId === global.currentUserId);\n  }\n\n  return true;\n}\n\nexport function selectCanAutoLoadMedia<T extends GlobalState>(\n  global: T, message: ApiMessage | ApiSponsoredMessage,\n) {\n  const chat = selectChat(global, message.chatId);\n  if (!chat) {\n    return undefined;\n  }\n\n  const sender = 'id' in message ? selectSender(global, message) : undefined;\n\n  const isPhoto = Boolean(getMessagePhoto(message) || getMessageWebPagePhoto(message));\n  const isVideo = Boolean(getMessageVideo(message) || getMessageWebPageVideo(message));\n  const isFile = Boolean(getMessageAudio(message) || getMessageVoice(message) || getMessageDocument(message));\n\n  const {\n    canAutoLoadPhotoFromContacts,\n    canAutoLoadPhotoInPrivateChats,\n    canAutoLoadPhotoInGroups,\n    canAutoLoadPhotoInChannels,\n    canAutoLoadVideoFromContacts,\n    canAutoLoadVideoInPrivateChats,\n    canAutoLoadVideoInGroups,\n    canAutoLoadVideoInChannels,\n    canAutoLoadFileFromContacts,\n    canAutoLoadFileInPrivateChats,\n    canAutoLoadFileInGroups,\n    canAutoLoadFileInChannels,\n  } = global.settings.byKey;\n\n  if (isPhoto) {\n    return canAutoLoadMedia({\n      global,\n      chat,\n      sender,\n      canAutoLoadMediaFromContacts: canAutoLoadPhotoFromContacts,\n      canAutoLoadMediaInPrivateChats: canAutoLoadPhotoInPrivateChats,\n      canAutoLoadMediaInGroups: canAutoLoadPhotoInGroups,\n      canAutoLoadMediaInChannels: canAutoLoadPhotoInChannels,\n    });\n  }\n\n  if (isVideo) {\n    return canAutoLoadMedia({\n      global,\n      chat,\n      sender,\n      canAutoLoadMediaFromContacts: canAutoLoadVideoFromContacts,\n      canAutoLoadMediaInPrivateChats: canAutoLoadVideoInPrivateChats,\n      canAutoLoadMediaInGroups: canAutoLoadVideoInGroups,\n      canAutoLoadMediaInChannels: canAutoLoadVideoInChannels,\n    });\n  }\n\n  if (isFile) {\n    return canAutoLoadMedia({\n      global,\n      chat,\n      sender,\n      canAutoLoadMediaFromContacts: canAutoLoadFileFromContacts,\n      canAutoLoadMediaInPrivateChats: canAutoLoadFileInPrivateChats,\n      canAutoLoadMediaInGroups: canAutoLoadFileInGroups,\n      canAutoLoadMediaInChannels: canAutoLoadFileInChannels,\n    });\n  }\n\n  return true;\n}\n\nfunction canAutoLoadMedia<T extends GlobalState>({\n  global,\n  chat,\n  sender,\n  canAutoLoadMediaFromContacts,\n  canAutoLoadMediaInPrivateChats,\n  canAutoLoadMediaInGroups,\n  canAutoLoadMediaInChannels,\n}: {\n  global: T;\n  chat: ApiChat;\n  canAutoLoadMediaFromContacts: boolean;\n  canAutoLoadMediaInPrivateChats: boolean;\n  canAutoLoadMediaInGroups: boolean;\n  canAutoLoadMediaInChannels: boolean;\n  sender?: ApiPeer;\n}) {\n  const isMediaFromContact = Boolean(sender && (\n    selectIsChatWithSelf(global, sender.id) || selectUser(global, sender.id)?.isContact\n  ));\n\n  return Boolean(\n    (isMediaFromContact && canAutoLoadMediaFromContacts)\n    || (!isMediaFromContact && canAutoLoadMediaInPrivateChats && isUserId(chat.id))\n    || (canAutoLoadMediaInGroups && isChatGroup(chat))\n    || (canAutoLoadMediaInChannels && isChatChannel(chat)),\n  );\n}\n\nexport function selectLastServiceNotification<T extends GlobalState>(global: T) {\n  const { serviceNotifications } = global;\n  const maxId = Math.max(...serviceNotifications.map(({ id }) => id));\n\n  return serviceNotifications.find(({ id, isDeleted }) => !isDeleted && id === maxId);\n}\n\nexport function selectIsMessageProtected<T extends GlobalState>(global: T, message?: ApiMessage) {\n  return Boolean(message && (\n    message.isProtected || selectIsChatProtected(global, message.chatId) || hasMessageTtl(message)\n    || getMessagePaidMedia(message)\n  ));\n}\n\nexport function selectIsChatProtected<T extends GlobalState>(global: T, chatId: string) {\n  return selectChat(global, chatId)?.isProtected || false;\n}\n\nexport function selectHasProtectedMessage<T extends GlobalState>(global: T, chatId: string, messageIds?: number[]) {\n  if (selectChat(global, chatId)?.isProtected) {\n    return true;\n  }\n\n  if (!messageIds) {\n    return false;\n  }\n\n  const messages = selectChatMessages(global, chatId);\n\n  return messageIds.some((messageId) => messages[messageId]?.isProtected);\n}\n\nexport function selectCanForwardMessages<T extends GlobalState>(global: T, chatId: string, messageIds?: number[]) {\n  if (selectChat(global, chatId)?.isProtected) {\n    return false;\n  }\n\n  if (!messageIds) {\n    return false;\n  }\n\n  const messages = selectChatMessages(global, chatId);\n\n  return messageIds\n    .map((id) => messages[id])\n    .every((message) => message && !hasMessageTtl(message)\n      && (message.isForwardingAllowed || isServiceNotificationMessage(message)));\n}\n\nexport function selectSponsoredMessage<T extends GlobalState>(global: T, chatId: string) {\n  const message = global.messages.sponsoredByChatId[chatId];\n\n  return message && message.expiresAt >= Math.round(Date.now() / 1000) ? message : undefined;\n}\n\nexport function selectDefaultReaction<T extends GlobalState>(global: T, chatId: string) {\n  if (chatId === SERVICE_NOTIFICATIONS_USER_ID) return undefined;\n\n  const isPrivate = isUserId(chatId);\n  const defaultReaction = global.config?.defaultReaction;\n  if (!defaultReaction) {\n    return undefined;\n  }\n\n  if (isPrivate) {\n    return defaultReaction;\n  }\n\n  const chatReactions = selectChatFullInfo(global, chatId)?.enabledReactions;\n  if (!chatReactions || !canSendReaction(defaultReaction, chatReactions)) {\n    return undefined;\n  }\n\n  return defaultReaction;\n}\n\nexport function selectMaxUserReactions<T extends GlobalState>(global: T): number {\n  const isPremium = selectIsCurrentUserPremium(global);\n  const { maxUserReactionsPremium = 3, maxUserReactionsDefault = 1 } = global.appConfig || {};\n  return isPremium ? maxUserReactionsPremium : maxUserReactionsDefault;\n}\n\n// Slow, not to be used in `withGlobal`\nexport function selectVisibleUsers<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n  if (!chatId || !threadId) {\n    return undefined;\n  }\n\n  const messageIds = selectTabThreadParam(global, chatId, threadId, 'viewportIds', tabId);\n  if (!messageIds) {\n    return undefined;\n  }\n\n  return messageIds.map((messageId) => {\n    const { senderId } = selectChatMessage(global, chatId, messageId) || {};\n    return senderId ? selectUser(global, senderId) : undefined;\n  }).filter(Boolean);\n}\n\nexport function selectShouldSchedule<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectCurrentMessageList(global, tabId)?.type === 'scheduled';\n}\n\nexport function selectCanScheduleUntilOnline<T extends GlobalState>(global: T, id: string) {\n  const isChatWithSelf = selectIsChatWithSelf(global, id);\n  const chatBot = selectBot(global, id);\n  return Boolean(\n    !isChatWithSelf && !chatBot && isUserId(id) && selectUserStatus(global, id)?.wasOnline,\n  );\n}\n\nexport function selectCustomEmojis(message: ApiMessage) {\n  const entities = message.content.text?.entities;\n  return entities?.filter((entity): entity is ApiMessageEntityCustomEmoji => (\n    entity.type === ApiMessageEntityTypes.CustomEmoji\n  ));\n}\n\nexport function selectMessageCustomEmojiSets<T extends GlobalState>(\n  global: T, message: ApiMessage,\n): ApiStickerSetInfo[] | undefined {\n  const customEmojis = selectCustomEmojis(message);\n  if (!customEmojis) return MEMO_EMPTY_ARRAY;\n  const documents = customEmojis.map((entity) => global.customEmojis.byId[entity.documentId]);\n  // If some emoji still loading, do not return empty array\n  if (!documents.every(Boolean)) return undefined;\n  const sets = documents.map((doc) => doc.stickerSetInfo);\n\n  return sets.reduce((acc, set) => {\n    if ('shortName' in set) {\n      if (acc.some((s) => 'shortName' in s && s.shortName === set.shortName)) {\n        return acc;\n      }\n    }\n\n    if ('id' in set) {\n      if (acc.some((s) => 'id' in s && s.id === set.id)) {\n        return acc;\n      }\n    }\n    acc.push(set); // Optimization\n    return acc;\n  }, [] as ApiStickerSetInfo[]);\n}\n\nexport function selectForwardsContainVoiceMessages<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageIds, fromChatId } = selectTabState(global, tabId).forwardMessages;\n  if (!messageIds) return false;\n  const chatMessages = selectChatMessages(global, fromChatId!);\n  return messageIds.some((messageId) => {\n    const message = chatMessages[messageId];\n    return Boolean(message.content.voice) || Boolean(message.content.video?.isRound);\n  });\n}\n\nexport function selectChatTranslations<T extends GlobalState>(\n  global: T, chatId: string,\n): ChatTranslatedMessages {\n  return global.translations.byChatId[chatId];\n}\n\nexport function selectMessageTranslations<T extends GlobalState>(\n  global: T, chatId: string, toLanguageCode: string,\n) {\n  return selectChatTranslations(global, chatId)?.byLangCode[toLanguageCode] || {};\n}\n\nexport function selectRequestedMessageTranslationLanguage<T extends GlobalState>(\n  global: T, chatId: string, messageId: number, ...[tabId = getCurrentTabId()]: TabArgs<T>\n): string | undefined {\n  const requestedInChat = selectTabState(global, tabId).requestedTranslations.byChatId[chatId];\n  return requestedInChat?.toLanguage || requestedInChat?.manualMessages?.[messageId];\n}\nexport function selectReplyCanBeSentToChat<T extends GlobalState>(\n  global: T,\n  toChatId: string,\n  fromChatId: string,\n  replyInfo: ApiInputMessageReplyInfo,\n) {\n  if (!replyInfo.replyToMsgId) return false;\n  const fromRealChatId = replyInfo?.replyToPeerId ?? fromChatId;\n  if (toChatId === fromRealChatId) return true;\n  const chatMessages = selectChatMessages(global, fromRealChatId!);\n  const message = chatMessages[replyInfo.replyToMsgId];\n\n  return !isExpiredMessage(message);\n}\nexport function selectForwardsCanBeSentToChat<T extends GlobalState>(\n  global: T,\n  toChatId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { messageIds, storyId, fromChatId } = selectTabState(global, tabId).forwardMessages;\n  const chat = selectChat(global, toChatId);\n  if ((!messageIds && !storyId) || !chat) return false;\n\n  if (storyId) {\n    return true;\n  }\n\n  const chatFullInfo = selectChatFullInfo(global, toChatId);\n  const chatMessages = selectChatMessages(global, fromChatId!);\n  const options = getAllowedAttachmentOptions(chat, chatFullInfo);\n  return !messageIds!.some((messageId) => сheckMessageSendingDenied(chatMessages[messageId], options));\n}\nfunction сheckMessageSendingDenied(message: ApiMessage, options: IAllowedAttachmentOptions) {\n  const isVoice = message.content.voice;\n  const isRoundVideo = message.content.video?.isRound;\n  const isPhoto = message.content.photo;\n  const isGif = message.content.video?.isGif;\n  const isVideo = message.content.video && !isRoundVideo && !isGif;\n  const isAudio = message.content.audio;\n  const isDocument = message.content.document;\n  const isSticker = message.content.sticker;\n  const isPlainText = message.content.text\n    && !isVoice && !isRoundVideo && !isSticker && !isDocument && !isAudio && !isVideo && !isPhoto && !isGif;\n\n  return (isVoice && !options.canSendVoices)\n    || (isRoundVideo && !options.canSendRoundVideos)\n    || (isSticker && !options.canSendStickers)\n    || (isDocument && !options.canSendDocuments)\n    || (isAudio && !options.canSendAudios)\n    || (isVideo && !options.canSendVideos)\n    || (isPhoto && !options.canSendPhotos)\n    || (isGif && !options.canSendGifs)\n    || (isPlainText && !options.canSendPlainText);\n}\n\nexport function selectCanTranslateMessage<T extends GlobalState>(\n  global: T, message: ApiMessage, detectedLanguage?: string, ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { canTranslate: isTranslationEnabled, doNotTranslate } = global.settings.byKey;\n\n  const canTranslateLanguage = !detectedLanguage || !doNotTranslate.includes(detectedLanguage);\n\n  const isTranslatable = isMessageTranslatable(message);\n\n  // Separate translations are disabled when chat translation enabled\n  const chatRequestedLanguage = selectRequestedChatTranslationLanguage(global, message.chatId, tabId);\n\n  return IS_TRANSLATION_SUPPORTED && isTranslationEnabled && canTranslateLanguage && isTranslatable\n    && !chatRequestedLanguage;\n}\n\nexport function selectTopicLink<T extends GlobalState>(\n  global: T, chatId: string, topicId?: ThreadId,\n) {\n  const chat = selectChat(global, chatId);\n  if (!chat || !chat?.isForum) {\n    return undefined;\n  }\n\n  return getMessageLink(chat, topicId);\n}\n\nexport function selectMessageReplyInfo<T extends GlobalState>(\n  global: T, chatId: string, threadId: ThreadId, additionalReplyInfo?: ApiInputMessageReplyInfo,\n) {\n  const chat = selectChat(global, chatId);\n  if (!chat) return undefined;\n  const isMainThread = threadId === MAIN_THREAD_ID;\n  if (!additionalReplyInfo && isMainThread) return undefined;\n\n  const replyInfo: ApiInputMessageReplyInfo = {\n    type: 'message',\n    ...additionalReplyInfo,\n    replyToMsgId: additionalReplyInfo?.replyToMsgId || Number(threadId),\n    replyToTopId: additionalReplyInfo?.replyToTopId || (!isMainThread ? Number(threadId) : undefined),\n  };\n\n  return replyInfo;\n}\n\nexport function selectReplyMessage<T extends GlobalState>(global: T, message: ApiMessage) {\n  const { replyToMsgId, replyToPeerId } = getMessageReplyInfo(message) || {};\n  const replyMessage = replyToMsgId\n    ? selectChatMessage(global, replyToPeerId || message.chatId, replyToMsgId) : undefined;\n\n  return replyMessage;\n}\n\nexport function selectMessageTimestampableDuration<T extends GlobalState>(\n  global: T, message: ApiMessage, noReplies?: boolean,\n) {\n  const replyMessage = !noReplies ? selectReplyMessage(global, message) : undefined;\n\n  const timestampableMedia = getTimestampableMedia(message);\n  const replyTimestampableMedia = replyMessage && getTimestampableMedia(replyMessage);\n\n  return timestampableMedia?.duration || replyTimestampableMedia?.duration;\n}\n\nexport function selectMessageLastPlaybackTimestamp<T extends GlobalState>(\n  global: T, chatId: string, messageId: number,\n) {\n  return global.messages.playbackByChatId[chatId]?.byId[messageId];\n}\n","import type { ThreadId } from '../../types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { buildChatThreadKey } from '../helpers/middleSearch';\nimport { selectCurrentMessageList } from './messages';\nimport { selectTabState } from './tabs';\n\nexport function selectCurrentMiddleSearch<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n  if (!chatId || !threadId) {\n    return undefined;\n  }\n\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return selectTabState(global, tabId).middleSearch.byChatThreadKey[chatThreadKey];\n}\n\nexport function selectCurrentSharedMediaSearch<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n  if (!chatId || !threadId) {\n    return undefined;\n  }\n\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return selectTabState(global, tabId).sharedMediaSearch.byChatThreadKey[chatThreadKey];\n}\n\nexport function selectCurrentChatMediaSearch<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { chatId, threadId } = selectCurrentMessageList(global, tabId) || {};\n  if (!chatId || !threadId) {\n    return undefined;\n  }\n\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return selectTabState(global, tabId).chatMediaSearch.byChatThreadKey[chatThreadKey];\n}\n\nexport function selectChatMediaSearch<T extends GlobalState>(\n  global: T, chatId?: string, threadId?: ThreadId,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  if (!chatId || !threadId) {\n    return undefined;\n  }\n\n  const chatThreadKey = buildChatThreadKey(chatId, threadId);\n\n  return selectTabState(global, tabId).chatMediaSearch.byChatThreadKey[chatThreadKey];\n}\n","import type { ApiPeer, ApiSavedGifts } from '../../api/types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport { SERVICE_NOTIFICATIONS_USER_ID } from '../../config';\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { isDeletedUser } from '../helpers';\nimport { selectChat, selectChatFullInfo } from './chats';\nimport { selectTabState } from './tabs';\nimport { selectBot, selectUser } from './users';\n\nexport function selectPeer<T extends GlobalState>(global: T, peerId: string): ApiPeer | undefined {\n  return selectUser(global, peerId) || selectChat(global, peerId);\n}\n\nexport function selectPeerPhotos<T extends GlobalState>(global: T, peerId: string) {\n  return global.peers.profilePhotosById[peerId];\n}\n\nexport function selectCanGift<T extends GlobalState>(global: T, peerId: string) {\n  const bot = selectBot(global, peerId);\n  const user = selectUser(global, peerId);\n\n  if (user) {\n    return !bot && peerId !== SERVICE_NOTIFICATIONS_USER_ID && !isDeletedUser(user);\n  }\n\n  return selectChatFullInfo(global, peerId)?.areStarGiftsAvailable;\n}\n\nexport function selectPeerSavedGifts<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) : ApiSavedGifts {\n  return selectTabState(global, tabId).savedGifts.giftsByPeerId[peerId];\n}\n","import type { ApiPeerStories, ApiTypeStory } from '../../api/types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { selectPeer } from './peers';\nimport { selectTabState } from './tabs';\n\nexport function selectCurrentViewedStory<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { storyViewer: { peerId, storyId } } = selectTabState(global, tabId);\n\n  return { peerId, storyId };\n}\n\nexport function selectIsStoryViewerOpen<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  const { peerId, storyId } = selectCurrentViewedStory(global, tabId);\n\n  return Boolean(peerId) && Boolean(storyId);\n}\n\nexport function selectPeerStories<T extends GlobalState>(\n  global: T, peerId: string,\n): ApiPeerStories | undefined {\n  return global.stories.byPeerId[peerId];\n}\n\nexport function selectPeerStory<T extends GlobalState>(\n  global: T, peerId: string, storyId: number,\n): ApiTypeStory | undefined {\n  return selectPeerStories(global, peerId)?.byId[storyId];\n}\n\nexport function selectPinnedStories<T extends GlobalState>(\n  global: T, peerId: string,\n) {\n  const stories = selectPeerStories(global, peerId);\n  if (!stories?.pinnedIds?.length) return undefined;\n  return stories.pinnedIds.map((id) => stories.byId[id]).filter((s) => (\n    s && 'isInProfile' in s && s.isInProfile\n  ));\n}\n\nexport function selectPeerFirstUnreadStoryId<T extends GlobalState>(\n  global: T, peerId: string,\n) {\n  const peerStories = selectPeerStories(global, peerId);\n  if (!peerStories) {\n    return undefined;\n  }\n\n  if (!peerStories.lastReadId) {\n    return peerStories.orderedIds?.[0];\n  }\n\n  const lastReadIndex = peerStories.orderedIds.findIndex((id) => id === peerStories.lastReadId);\n\n  return peerStories.orderedIds?.[lastReadIndex + 1];\n}\n\nexport function selectPeerFirstStoryId<T extends GlobalState>(\n  global: T, peerId: string,\n) {\n  return selectPeerStories(global, peerId)?.orderedIds?.[0];\n}\n\nexport function selectStoryListForViewer<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  storyId?: number,\n  isSingleStory?: boolean,\n  isSinglePeer?: boolean,\n  isPrivate?: boolean,\n  isArchive?: boolean,\n): {\n    peerIds: string[];\n    storyIdsByPeerId: Record<string, number[]>;\n  } | undefined {\n  const currentStoryId = storyId\n    || selectPeerFirstUnreadStoryId(global, peerId)\n    || selectPeerFirstStoryId(global, peerId);\n  if (!currentStoryId) {\n    return undefined;\n  }\n\n  if (isSingleStory) {\n    return {\n      peerIds: [peerId],\n      storyIdsByPeerId: { [peerId]: [currentStoryId] },\n    };\n  }\n\n  const peer = selectPeer(global, peerId);\n  const story = selectPeerStory(global, peerId, currentStoryId);\n  if (!peer || !story) {\n    return undefined;\n  }\n\n  const isUnread = (global.stories.byPeerId[peerId].lastReadId || 0) < story.id;\n\n  if (isSinglePeer) {\n    const storyIds = getPeerStoryIdsForViewer(global, peerId, isUnread, isArchive, isPrivate);\n\n    return storyIds?.length\n      ? { peerIds: [peerId], storyIdsByPeerId: { [peerId]: storyIds } }\n      : undefined;\n  }\n\n  const { orderedPeerIds: { active, archived } } = global.stories;\n  const orderedPeerIds = (peer.areStoriesHidden ? archived : active) ?? [];\n  const peerIds: string[] = [];\n  const storyIdsByPeerId: Record<string, number[]> = {};\n\n  for (const currentPeerId of orderedPeerIds) {\n    const storyIds = getPeerStoryIdsForViewer(global, currentPeerId, isUnread, isArchive, isPrivate);\n    if (storyIds?.length) {\n      peerIds.push(currentPeerId);\n      storyIdsByPeerId[currentPeerId] = storyIds;\n    }\n  }\n\n  return peerIds.length ? { peerIds, storyIdsByPeerId } : undefined;\n}\n\nfunction getPeerStoryIdsForViewer<T extends GlobalState>(\n  global: T,\n  peerId: string,\n  isUnread?: boolean,\n  isArchive?: boolean,\n  isPrivate?: boolean,\n): number[] | undefined {\n  const peerStories = selectPeerStories(global, peerId);\n  const storySourceProp = isArchive ? 'archiveIds' : isPrivate ? 'profileIds' : 'orderedIds';\n  const storyIds = peerStories?.[storySourceProp];\n\n  if (!peerStories || !storyIds?.length) {\n    return undefined;\n  }\n\n  if (!peerStories.lastReadId || !isUnread) {\n    return storyIds.slice();\n  }\n\n  const lastReadIndex = storyIds.indexOf(peerStories.lastReadId);\n  return (storyIds.length > lastReadIndex + 1)\n    ? storyIds.slice(lastReadIndex + 1)\n    : undefined;\n}\n","import type { ApiSticker, ApiStickerSet, ApiStickerSetInfo } from '../../api/types';\nimport type { GlobalState, TabArgs } from '../types';\n\nimport { RESTRICTED_EMOJI_SET_ID } from '../../config';\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\nimport { selectTabState } from './tabs';\nimport { selectIsCurrentUserPremium } from './users';\n\n// https://github.com/DrKLO/Telegram/blob/c319639e9a4dff2f22da6762dcebd12d49f5afa1/TMessagesProj/src/main/java/org/telegram/ui/Components/Premium/boosts/cells/msg/GiveawayMessageCell.java#L59\nconst MONTH_EMOTICON: Record<number, string> = {\n  1: `${1}\\u{FE0F}\\u20E3`,\n  3: `${2}\\u{FE0F}\\u20E3`,\n  6: `${3}\\u{FE0F}\\u20E3`,\n  12: `${4}\\u{FE0F}\\u20E3`,\n  24: `${5}\\u{FE0F}\\u20E3`,\n};\n\nconst STAR_EMOTICON: Record<number, string> = {\n  1000: `${2}\\u{FE0F}\\u20E3`,\n  2500: `${3}\\u{FE0F}\\u20E3`,\n  5000: `${4}\\u{FE0F}\\u20E3`,\n};\n\nexport function selectIsStickerFavorite<T extends GlobalState>(global: T, sticker: ApiSticker) {\n  const { stickers } = global.stickers.favorite;\n  return stickers && stickers.some(({ id }) => id === sticker.id);\n}\n\nexport function selectCurrentStickerSearch<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).stickerSearch;\n}\n\nexport function selectCurrentGifSearch<T extends GlobalState>(\n  global: T,\n  ...[tabId = getCurrentTabId()]: TabArgs<T>\n) {\n  return selectTabState(global, tabId).gifSearch;\n}\n\nexport function selectStickerSet<T extends GlobalState>(global: T, id: string | ApiStickerSetInfo) {\n  if (typeof id === 'string') {\n    return global.stickers.setsById[id];\n  }\n\n  if ('id' in id) {\n    return global.stickers.setsById[id.id];\n  }\n\n  if ('isMissing' in id) return undefined;\n\n  return Object.values(global.stickers.setsById).find(({ shortName }) => (\n    shortName.toLowerCase() === id.shortName.toLowerCase()\n  ));\n}\n\nexport function selectStickersForEmoji<T extends GlobalState>(global: T, emoji: string) {\n  const addedSets = global.stickers.added.setIds;\n  let stickersForEmoji: ApiSticker[] = [];\n  // Favorites\n  global.stickers.favorite.stickers.forEach((sticker) => {\n    if (sticker.emoji === emoji) stickersForEmoji.push(sticker);\n  });\n\n  // Added sets\n  addedSets?.forEach((id) => {\n    const packs = global.stickers.setsById[id].packs;\n    if (!packs) {\n      return;\n    }\n\n    stickersForEmoji = stickersForEmoji.concat(packs[emoji] || [], packs[cleanEmoji(emoji)] || []);\n  });\n  return stickersForEmoji;\n}\n\nexport function selectCustomEmojiForEmoji<T extends GlobalState>(global: T, emoji: string) {\n  const isCurrentUserPremium = selectIsCurrentUserPremium(global);\n  const addedCustomSets = global.customEmojis.added.setIds;\n  let customEmojiForEmoji: ApiSticker[] = [];\n\n  // Added sets\n  addedCustomSets?.forEach((id) => {\n    const packs = global.stickers.setsById[id].packs;\n    if (!packs) {\n      return;\n    }\n\n    customEmojiForEmoji = customEmojiForEmoji.concat(packs[emoji] || [], packs[cleanEmoji(emoji)] || []);\n  });\n  return isCurrentUserPremium ? customEmojiForEmoji : customEmojiForEmoji.filter(({ isFree }) => isFree);\n}\n\n// Slow, not to be used in `withGlobal`\nexport function selectCustomEmojiForEmojis<T extends GlobalState>(global: T, emojis: string[]) {\n  const isCurrentUserPremium = selectIsCurrentUserPremium(global);\n  const addedCustomSets = global.customEmojis.added.setIds;\n  let customEmojiForEmoji: ApiSticker[] = [];\n\n  // Added sets\n  addedCustomSets?.forEach((id) => {\n    const packs = global.stickers.setsById[id].packs;\n    if (!packs) {\n      return;\n    }\n    const customEmojis = Object.entries(packs).filter(([emoji]) => (\n      emojis.includes(emoji) || emojis.includes(cleanEmoji(emoji))\n    )).flatMap(([, stickers]) => stickers);\n    customEmojiForEmoji = customEmojiForEmoji.concat(customEmojis);\n  });\n  return isCurrentUserPremium ? customEmojiForEmoji : customEmojiForEmoji.filter(({ isFree }) => isFree);\n}\n\nexport function selectIsSetPremium(stickerSet: Pick<ApiStickerSet, 'stickers' | 'isEmoji'>) {\n  return stickerSet.isEmoji && stickerSet.stickers?.some((sticker) => !sticker.isFree);\n}\n\nfunction cleanEmoji(emoji: string) {\n  // Some emojis (❤️ for example) with a service symbol 'VARIATION SELECTOR-16' are not recognized as animated\n  return emoji.replace('\\ufe0f', '');\n}\n\nexport function selectAnimatedEmoji<T extends GlobalState>(global: T, emoji: string) {\n  const { animatedEmojis } = global;\n  if (!animatedEmojis || !animatedEmojis.stickers) {\n    return undefined;\n  }\n\n  const cleanedEmoji = cleanEmoji(emoji);\n\n  return animatedEmojis.stickers.find((sticker) => sticker.emoji === emoji || sticker.emoji === cleanedEmoji);\n}\n\nexport function selectRestrictedEmoji<T extends GlobalState>(global: T, emoji: string) {\n  const { restrictedEmoji } = global;\n  if (!restrictedEmoji || !restrictedEmoji.stickers) {\n    return undefined;\n  }\n\n  const cleanedEmoji = cleanEmoji(emoji);\n\n  return restrictedEmoji.stickers.find((sticker) => {\n    if (!sticker.emoji) return undefined;\n    const cleanedStickerEmoji = cleanEmoji(sticker.emoji);\n    return cleanedStickerEmoji === cleanedEmoji;\n  });\n}\n\nexport function selectAnimatedEmojiEffect<T extends GlobalState>(global: T, emoji: string) {\n  const { animatedEmojiEffects } = global;\n  if (!animatedEmojiEffects || !animatedEmojiEffects.stickers) {\n    return undefined;\n  }\n\n  const cleanedEmoji = cleanEmoji(emoji);\n\n  return animatedEmojiEffects.stickers.find((sticker) => sticker.emoji === emoji || sticker.emoji === cleanedEmoji);\n}\n\nexport function selectAnimatedEmojiSound<T extends GlobalState>(global: T, emoji: string) {\n  return global?.appConfig?.emojiSounds[cleanEmoji(emoji)];\n}\n\nexport function selectIsAlwaysHighPriorityEmoji<T extends GlobalState>(\n  global: T, stickerSet: ApiStickerSetInfo | ApiStickerSet,\n) {\n  if (!('id' in stickerSet)) return false;\n  return stickerSet.id === global.appConfig?.defaultEmojiStatusesStickerSetId\n    || stickerSet.id === RESTRICTED_EMOJI_SET_ID;\n}\n\nexport function selectGiftStickerForDuration<T extends GlobalState>(global: T, duration = 1) {\n  const stickers = global.premiumGifts?.stickers;\n  if (!stickers) return undefined;\n  const emoji = MONTH_EMOTICON[duration];\n  return stickers.find((sticker) => sticker.emoji === emoji) || stickers[0];\n}\n\nexport function selectGiftStickerForStars<T extends GlobalState>(global: T, starCount?: number) {\n  const stickers = global.premiumGifts?.stickers;\n\n  if (!stickers || !starCount) return undefined;\n\n  let emoji;\n  if (starCount <= 1000) {\n    emoji = STAR_EMOTICON[1000];\n  } else if (starCount < 2500) {\n    emoji = STAR_EMOTICON[2500];\n  } else {\n    emoji = STAR_EMOTICON[5000];\n  }\n\n  return stickers.find((sticker) => sticker.emoji === emoji) || stickers[0];\n}\n","import type {\n  GlobalState, TabArgs,\n  TabState,\n} from '../types';\n\nimport { getCurrentTabId } from '../../util/establishMultitabRole';\n\nexport function selectTabState<T extends GlobalState>(\n  global: T, ...[tabId = getCurrentTabId()]: TabArgs<T>\n): TabState {\n  return global.byTabId[tabId];\n}\n","import type { ThreadId, TopicsInfo } from '../../types';\nimport type { GlobalState } from '../types';\n\nexport function selectTopicsInfo<T extends GlobalState>(global: T, chatId: string): TopicsInfo | undefined {\n  return global.chats.topicsInfoById[chatId];\n}\n\nexport function selectTopics<T extends GlobalState>(global: T, chatId: string) {\n  return selectTopicsInfo(global, chatId)?.topicsById;\n}\n\nexport function selectTopic<T extends GlobalState>(global: T, chatId: string, threadId: ThreadId) {\n  return selectTopicsInfo(global, chatId)?.topicsById?.[threadId];\n}\n","import type {\n  ApiUser, ApiUserCommonChats,\n  ApiUserFullInfo, ApiUserStatus,\n} from '../../api/types';\nimport type { BotAppPermissions } from '../../types';\nimport type { GlobalState } from '../types';\n\nimport { isUserBot } from '../helpers';\n\nexport function selectUser<T extends GlobalState>(global: T, userId: string): ApiUser | undefined {\n  return global.users.byId[userId];\n}\n\nexport function selectUserStatus<T extends GlobalState>(global: T, userId: string): ApiUserStatus | undefined {\n  return global.users.statusesById[userId];\n}\n\nexport function selectUserFullInfo<T extends GlobalState>(global: T, userId: string): ApiUserFullInfo | undefined {\n  return global.users.fullInfoById[userId];\n}\n\nexport function selectUserCommonChats<T extends GlobalState>(\n  global: T, userId: string,\n): ApiUserCommonChats | undefined {\n  return global.users.commonChatsById[userId];\n}\n\nexport function selectIsUserBlocked<T extends GlobalState>(global: T, userId: string) {\n  return selectUserFullInfo(global, userId)?.isBlocked;\n}\n\nexport function selectIsCurrentUserPremium<T extends GlobalState>(global: T) {\n  if (!global.currentUserId) return false;\n\n  return Boolean(global.users.byId[global.currentUserId].isPremium);\n}\n\nexport function selectIsPremiumPurchaseBlocked<T extends GlobalState>(global: T) {\n  return global.appConfig?.isPremiumPurchaseBlocked ?? true;\n}\n\nexport function selectIsGiveawayGiftsPurchaseAvailable<T extends GlobalState>(global: T) {\n  return global.appConfig?.isGiveawayGiftsPurchaseAvailable ?? true;\n}\n\n/**\n * Slow, not to be used in `withGlobal`\n */\nexport function selectUserByPhoneNumber<T extends GlobalState>(global: T, phoneNumber: string) {\n  const phoneNumberCleaned = phoneNumber.replace(/[^0-9]/g, '');\n\n  return Object.values(global.users.byId).find((user) => user?.phoneNumber === phoneNumberCleaned);\n}\n\nexport function selectBot<T extends GlobalState>(global: T, userId: string): ApiUser | undefined {\n  const user = selectUser(global, userId);\n  if (!user || !isUserBot(user)) {\n    return undefined;\n  }\n\n  return user;\n}\n\nexport function selectBotAppPermissions<T extends GlobalState>(\n  global: T, userId: string,\n): BotAppPermissions | undefined {\n  return global.users.botAppPermissionsById[userId];\n}\n","import {\n  useEffect,\n  useRef,\n  useState,\n} from '../../lib/teact/teact';\n\nimport { VIEW_TRANSITION_CLASS_NAME } from '../../config';\nimport { requestMutation, requestNextMutation } from '../../lib/fasterdom/fasterdom';\nimport Deferred from '../../util/Deferred';\nimport { IS_VIEW_TRANSITION_SUPPORTED } from '../../util/windowEnvironment';\n\ntype TransitionFunction = () => Promise<void> | void;\n\ntype TransitionState = 'idle' | 'capturing-old' | 'capturing-new' | 'animating' | 'skipped';\ninterface ViewTransitionController {\n  transitionState: TransitionState;\n  shouldApplyVtn?: boolean;\n  startViewTransition: (domUpdateCallback?: TransitionFunction) => PromiseLike<void> | void;\n}\n\nlet hasActiveTransition = false;\nexport function hasActiveViewTransition(): boolean {\n  return hasActiveTransition;\n}\n\nexport function useViewTransition(): ViewTransitionController {\n  const domUpdaterFn = useRef<TransitionFunction>();\n  const [transitionState, setTransitionState] = useState<TransitionState>('idle');\n\n  useEffect(() => {\n    if (transitionState !== 'capturing-old') return;\n\n    const transition = document.startViewTransition(async () => {\n      setTransitionState('capturing-new');\n      if (domUpdaterFn.current) await domUpdaterFn.current();\n      const deferred = new Deferred<void>();\n      requestNextMutation(() => {\n        deferred.resolve();\n      });\n      return deferred.promise;\n    });\n\n    transition.finished.then(() => {\n      setTransitionState('idle');\n      requestMutation(() => {\n        document.body.classList.remove(VIEW_TRANSITION_CLASS_NAME);\n      });\n      hasActiveTransition = false;\n    });\n\n    transition.ready.then(() => {\n      setTransitionState('animating');\n    }).catch((e) => {\n      // eslint-disable-next-line no-console\n      console.error(e);\n      setTransitionState('skipped');\n      requestMutation(() => {\n        document.body.classList.remove(VIEW_TRANSITION_CLASS_NAME);\n      });\n      hasActiveTransition = false;\n    });\n  }, [transitionState]);\n\n  function startViewTransition(updateCallback?: TransitionFunction): PromiseLike<void> | void {\n    // Fallback: simply run the callback immediately if view transitions aren't supported.\n    if (!IS_VIEW_TRANSITION_SUPPORTED) {\n      if (updateCallback) updateCallback();\n      return;\n    }\n\n    domUpdaterFn.current = updateCallback;\n    setTransitionState('capturing-old');\n    requestMutation(() => {\n      document.body.classList.add(VIEW_TRANSITION_CLASS_NAME);\n    });\n    hasActiveTransition = true;\n  }\n\n  return {\n    shouldApplyVtn: transitionState === 'capturing-old'\n      || transitionState === 'capturing-new' || transitionState === 'animating',\n    transitionState,\n    startViewTransition,\n  };\n}\n","import type { GlobalState } from '../../global/types';\n\nimport useDerivedState from '../useDerivedState';\nimport useSelectorSignal from './useSelectorSignal';\n\ntype Selector<T extends unknown> = (global: GlobalState) => T;\n\nexport default function useSelector<T extends unknown>(selector: Selector<T>) {\n  const selectorSignal = useSelectorSignal(selector);\n  return useDerivedState(selectorSignal);\n}\n","import { addCallback } from '../../lib/teact/teactn';\nimport { getGlobal } from '../../global';\n\nimport type { GlobalState } from '../../global/types';\nimport type { Signal, SignalSetter } from '../../util/signals';\n\nimport { createSignal } from '../../util/signals';\nimport useSyncEffect from '../useSyncEffect';\n\n/*\n  This hook is a more performant variation of the standard React `useSelector` hook. It allows to:\n  a) Avoid multiple subscriptions to global updates by leveraging a single selector reference.\n  b) Return a signal instead of forcing a component update right away.\n */\n\ntype Selector<T extends unknown> = (global: GlobalState) => T;\n\ninterface State<T extends unknown> {\n  clientsCount: number;\n  getter: Signal<T>;\n  setter: SignalSetter;\n}\n\nconst bySelector = new Map<Selector<unknown>, State<unknown>>();\n\naddCallback((global: GlobalState) => {\n  for (const [selector, { setter }] of bySelector) {\n    setter(selector(global));\n  }\n});\n\nfunction useSelectorSignal<T extends unknown>(selector: Selector<T>): Signal<T> {\n  let state = bySelector.get(selector);\n  if (!state) {\n    const [getter, setter] = createSignal(selector(getGlobal()));\n    state = { clientsCount: 0, getter, setter };\n    bySelector.set(selector, state);\n  }\n\n  useSyncEffect(() => {\n    const state2 = bySelector.get(selector)!;\n\n    state2.clientsCount++;\n\n    return () => {\n      state2.clientsCount--;\n\n      if (!state2.clientsCount) {\n        bySelector.delete(selector);\n      }\n    };\n  }, [selector]);\n\n  return state.getter as Signal<T>;\n}\n\nexport default useSelectorSignal;\n","import type { RefObject } from 'react';\nimport {\n  useEffect, useLayoutEffect, useRef, useState,\n} from '../../lib/teact/teact';\n\nimport { requestForcedReflow, requestMeasure, requestMutation } from '../../lib/fasterdom/fasterdom';\nimport calcTextLineHeightAndCount from '../../util/element/calcTextLineHeightAndCount';\nimport useDebouncedCallback from '../useDebouncedCallback';\nimport useLastCallback from '../useLastCallback';\nimport useWindowSize from '../window/useWindowSize';\n\nconst WINDOW_RESIZE_LINE_RECALC_DEBOUNCE = 200;\n\nexport default function useCollapsibleLines<T extends HTMLElement, C extends HTMLElement>(\n  ref: RefObject<T>,\n  maxLinesBeforeCollapse: number,\n  cutoutRef?: RefObject<C>,\n  isDisabled?: boolean,\n) {\n  const isFirstRenderRef = useRef(true);\n  const cutoutHeightRef = useRef<number | undefined>();\n  const [isCollapsible, setIsCollapsible] = useState(!isDisabled);\n  const [isCollapsed, setIsCollapsed] = useState(isCollapsible);\n\n  useLayoutEffect(() => {\n    const element = (cutoutRef || ref).current;\n    if (isDisabled || !element || isFirstRenderRef.current) return;\n\n    requestMutation(() => {\n      element.style.maxHeight = isCollapsed ? `${cutoutHeightRef.current}px` : '';\n    });\n  }, [cutoutRef, isCollapsed, isDisabled, ref]);\n\n  const recalculateTextLines = useLastCallback(() => {\n    if (isDisabled || !ref.current) {\n      return;\n    }\n    const element = ref.current;\n\n    const { lineHeight, totalLines } = calcTextLineHeightAndCount(element);\n    if (totalLines > maxLinesBeforeCollapse) {\n      cutoutHeightRef.current = lineHeight * maxLinesBeforeCollapse;\n      setIsCollapsible(true);\n    } else {\n      setIsCollapsible(false);\n      setIsCollapsed(false);\n    }\n  });\n\n  const debouncedRecalcTextLines = useDebouncedCallback(\n    () => requestMeasure(recalculateTextLines),\n    [recalculateTextLines],\n    WINDOW_RESIZE_LINE_RECALC_DEBOUNCE,\n  );\n\n  useLayoutEffect(() => {\n    if (!isDisabled && isFirstRenderRef.current) {\n      requestForcedReflow(() => {\n        recalculateTextLines();\n\n        return () => {\n          isFirstRenderRef.current = false;\n          const element = (cutoutRef || ref).current;\n          if (!element) return;\n          element.style.maxHeight = cutoutHeightRef.current ? `${cutoutHeightRef.current}px` : '';\n        };\n      });\n    }\n  }, [cutoutRef, isDisabled, recalculateTextLines, ref]);\n\n  // Parent resize is triggered on every collapse/expand, so we do recalculation only on window resize to save resources\n  const { width: windowWidth } = useWindowSize();\n  useEffect(() => {\n    if (!isDisabled) {\n      if (isFirstRenderRef.current) return;\n\n      debouncedRecalcTextLines();\n    } else {\n      setIsCollapsible(false);\n      setIsCollapsed(false);\n    }\n  }, [debouncedRecalcTextLines, isDisabled, windowWidth]);\n\n  return {\n    isCollapsed,\n    isCollapsible,\n    setIsCollapsed,\n  };\n}\n","import React, { useEffect } from '../../lib/teact/teact';\n\nimport { SVG_NAMESPACE } from '../../config';\nimport { addSvgDefinition, removeSvgDefinition } from '../../util/svgController';\nimport { hexToRgb } from '../../util/switchTheme';\n\nconst SVG_MAP = new Map<string, SvgColorFilter>();\n\nclass SvgColorFilter {\n  public filterId: string;\n\n  private referenceCount = 0;\n\n  constructor(public color: string) {\n    this.filterId = `color-filter-${color.slice(1)}`;\n\n    const rgbColor = hexToRgb(color);\n    addSvgDefinition(\n      <filter color-interpolation-filters=\"sRGB\" xmlns={SVG_NAMESPACE}>\n        <feColorMatrix\n          type=\"matrix\"\n          values={`0 0 0 0 ${rgbColor.r / 255} 0 0 0 0 ${rgbColor.g / 255} 0 0 0 0 ${rgbColor.b / 255} 0 0 0 1 0`}\n        />\n      </filter>,\n      this.filterId,\n    );\n  }\n\n  public getFilterId() {\n    this.referenceCount += 1;\n    return this.filterId;\n  }\n\n  public removeReference() {\n    this.referenceCount -= 1;\n    if (this.referenceCount === 0) {\n      removeSvgDefinition(this.filterId);\n    }\n  }\n\n  public isUsed() {\n    return this.referenceCount > 0;\n  }\n}\n\nexport default function useColorFilter(color?: string, asValue?: boolean) {\n  useEffect(() => {\n    if (!color) return undefined;\n\n    return () => {\n      const colorFilter = SVG_MAP.get(color);\n      if (colorFilter) {\n        colorFilter.removeReference();\n        if (!colorFilter.isUsed()) {\n          SVG_MAP.delete(colorFilter.color);\n        }\n      }\n    };\n  }, [color]);\n\n  if (!color) return undefined;\n\n  if (SVG_MAP.has(color)) {\n    const svg = SVG_MAP.get(color)!;\n    return prepareStyle(svg.getFilterId(), asValue);\n  }\n\n  const svg = new SvgColorFilter(color);\n  SVG_MAP.set(color, svg);\n\n  return prepareStyle(svg.getFilterId(), asValue);\n}\n\nfunction prepareStyle(filterId: string, asValue?: boolean) {\n  if (asValue) {\n    return `url(#${filterId})`;\n  }\n\n  return `filter: url(#${filterId});`;\n}\n","import { useEffect, useLayoutEffect, useState } from '../../lib/teact/teact';\n\nimport useLastCallback from '../useLastCallback';\nimport useResizeObserver from '../useResizeObserver';\n\nconst UPDATE_DEBOUNCE = 50; // ms\n\n/**\n * @param property animateable property\n */\nexport default function useStyleObserver(\n  ref: React.RefObject<HTMLElement>,\n  property: string,\n  debounce = UPDATE_DEBOUNCE,\n  isDisabled?: boolean,\n) {\n  const [value, setValue] = useState<string | undefined>();\n\n  const updateValue = useLastCallback(() => {\n    if (!ref.current || isDisabled) {\n      setValue(undefined);\n      return;\n    }\n\n    const computedValue = getComputedStyle(ref.current).getPropertyValue(property).trim();\n    setValue(computedValue);\n  });\n\n  // Element does not receive `transitionend` event if parent has `display: none`.\n  // We will receive `resize` event when parent is shown again.\n  useResizeObserver(ref, updateValue, isDisabled);\n\n  useLayoutEffect(() => {\n    const el = ref.current;\n    if (!el || isDisabled) {\n      return undefined;\n    }\n\n    el.style.setProperty('transition', `${debounce}ms ${property} linear`, 'important');\n\n    return () => {\n      el.style.removeProperty('transition');\n    };\n  }, [debounce, isDisabled, property, ref]);\n\n  useEffect(() => {\n    const el = ref.current;\n    if (!el) {\n      return undefined;\n    }\n\n    updateValue();\n\n    if (isDisabled) {\n      return undefined;\n    }\n\n    function handleTransitionEnd(e: TransitionEvent) {\n      if (e.propertyName !== property) return;\n      updateValue();\n    }\n\n    el.addEventListener('transitionend', handleTransitionEnd);\n\n    return () => {\n      el.removeEventListener('transitionend', handleTransitionEnd);\n    };\n  }, [isDisabled, property, ref, updateValue]);\n\n  return value;\n}\n","import { useMemo } from '../../lib/teact/teact';\n\nimport { prepareHexColor } from '../../util/themeStyle';\nimport useStyleObserver from '../element/useStyleObserver';\n\nconst DEBOUNCE = 50; // ms\n\n// Style observer that returns hex color value of the property\nexport default function useDynamicColorListener(\n  ref: React.RefObject<HTMLElement>,\n  property = 'color',\n  isDisabled?: boolean,\n) {\n  const value = useStyleObserver(ref, property, DEBOUNCE, isDisabled);\n  const hexColor = useMemo(() => (value ? prepareHexColor(value) : undefined), [value]);\n\n  return hexColor;\n}\n","import { useEffect } from '../lib/teact/teact';\n\nimport {\n  MIN_SCREEN_WIDTH_FOR_STATIC_LEFT_COLUMN,\n  MOBILE_SCREEN_LANDSCAPE_MAX_HEIGHT,\n  MOBILE_SCREEN_LANDSCAPE_MAX_WIDTH,\n  MOBILE_SCREEN_MAX_WIDTH,\n} from '../config';\nimport { createCallbackManager } from '../util/callbacks';\nimport { IS_IOS } from '../util/windowEnvironment';\nimport { updateSizes } from '../util/windowSize';\nimport useForceUpdate from './useForceUpdate';\n\ntype MediaQueryCacheKey = 'mobile' | 'tablet' | 'landscape' | 'touch';\n\nconst mediaQueryCache = new Map<MediaQueryCacheKey, MediaQueryList>();\nconst callbacks = createCallbackManager();\n\nlet isMobile: boolean | undefined;\nlet isTablet: boolean | undefined;\nlet isLandscape: boolean | undefined;\nlet isTouchScreen: boolean | undefined;\n\nexport function getIsMobile() {\n  return isMobile;\n}\n\nexport function getIsTablet() {\n  return isTablet;\n}\n\nexport function getIsWebAppsFullscreenSupported() {\n  return !getIsMobile();\n}\n\nfunction handleMediaQueryChange() {\n  isMobile = mediaQueryCache.get('mobile')?.matches || false;\n  isTablet = !isMobile && (mediaQueryCache.get('tablet')?.matches || false);\n  isLandscape = mediaQueryCache.get('landscape')?.matches || false;\n  isTouchScreen = mediaQueryCache.get('touch')?.matches || false;\n  updateSizes();\n  callbacks.runCallbacks();\n}\n\nfunction initMediaQueryCache() {\n  const mobileQuery = window.matchMedia(`(max-width: ${MOBILE_SCREEN_MAX_WIDTH}px), \\\n  (max-width: ${MOBILE_SCREEN_LANDSCAPE_MAX_WIDTH}px and max-height: ${MOBILE_SCREEN_LANDSCAPE_MAX_HEIGHT}px)`);\n  mediaQueryCache.set('mobile', mobileQuery);\n  mobileQuery.addEventListener('change', handleMediaQueryChange);\n\n  const tabletQuery = window.matchMedia(`(max-width: ${MIN_SCREEN_WIDTH_FOR_STATIC_LEFT_COLUMN}px)`);\n  mediaQueryCache.set('tablet', tabletQuery);\n  tabletQuery.addEventListener('change', handleMediaQueryChange);\n\n  const landscapeQuery = window.matchMedia(\n    IS_IOS\n      ? '(orientation: landscape)'\n      // Source: https://web.archive.org/web/20160509220835/http://blog.abouthalf.com/development/orientation-media-query-challenges-in-android-browsers/\n      // Feature is marked as deprecated now, but it is still supported\n      // https://developer.mozilla.org/en-US/docs/Web/CSS/@media/device-aspect-ratio#browser_compatibility\n      : 'screen and (min-device-aspect-ratio: 1/1) and (orientation: landscape)',\n  );\n  mediaQueryCache.set('landscape', landscapeQuery);\n  landscapeQuery.addEventListener('change', handleMediaQueryChange);\n\n  const isTouchScreenQuery = window.matchMedia('(pointer: coarse)');\n  mediaQueryCache.set('touch', isTouchScreenQuery);\n  isTouchScreenQuery.addEventListener('change', handleMediaQueryChange);\n}\n\ninitMediaQueryCache();\nhandleMediaQueryChange();\n\nexport default function useAppLayout() {\n  const forceUpdate = useForceUpdate();\n\n  useEffect(() => callbacks.addCallback(forceUpdate), [forceUpdate]);\n\n  return {\n    isMobile,\n    isTablet,\n    isLandscape,\n    isDesktop: !isMobile && !isTablet,\n    isTouchScreen,\n  };\n}\n","import { useEffect, useState } from '../lib/teact/teact';\n\nconst useAsync = <T>(fn: () => Promise<T>, deps: any[], defaultValue?: T) => {\n  const [isLoading, setIsLoading] = useState<boolean>(false);\n  const [error, setError] = useState<Error | undefined>();\n  const [result, setResult] = useState<T | undefined>(defaultValue);\n  useEffect(() => {\n    setIsLoading(true);\n    let wasCancelled = false;\n    fn().then((res) => {\n      if (wasCancelled) return;\n      setIsLoading(false);\n      setResult(res);\n    }, (err) => {\n      if (wasCancelled) return;\n      setIsLoading(false);\n      setError(err);\n    });\n    return () => {\n      wasCancelled = true;\n    };\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  }, deps);\n  return { isLoading, error, result };\n};\n\nexport default useAsync;\n","import type React from '../lib/teact/teact';\nimport { useMemo, useState } from '../lib/teact/teact';\n\nimport { areDeepEqual } from '../util/areDeepEqual';\nimport { isSafariPatchInProgress } from '../util/patchSafariProgressiveAudio';\nimport { debounce } from '../util/schedulers';\nimport useLastCallback from './useLastCallback';\n\ntype BufferingEvent = (e: Event | React.SyntheticEvent<HTMLMediaElement>) => void;\n\nconst MIN_READY_STATE = 3;\n// Avoid flickering when re-mounting previously buffered video\nconst DEBOUNCE = 200;\nconst MIN_ALLOWED_MEDIA_DURATION = 0.1; // Some video emojis have weird duration of 0.04 causing extreme amount of events\n\n/**\n * Time range relative to the duration [0, 1]\n */\nexport type BufferedRange = { start: number; end: number };\n\nconst useBuffering = (noInitiallyBuffered = false, onTimeUpdate?: AnyToVoidFunction, onBroken?: AnyToVoidFunction) => {\n  const [isBuffered, setIsBuffered] = useState(!noInitiallyBuffered);\n  const [isReady, setIsReady] = useState(false);\n  const [bufferedProgress, setBufferedProgress] = useState(0);\n  const [bufferedRanges, setBufferedRanges] = useState<BufferedRange[]>([]);\n\n  const setIsBufferedDebounced = useMemo(() => {\n    return debounce(setIsBuffered, DEBOUNCE, false, true);\n  }, []);\n\n  const handleBuffering = useLastCallback<BufferingEvent>((e) => {\n    const media = e.currentTarget as HTMLMediaElement;\n\n    if (media.duration < MIN_ALLOWED_MEDIA_DURATION) {\n      onBroken?.();\n      return;\n    }\n\n    if (e.type === 'timeupdate') {\n      onTimeUpdate?.(e);\n    }\n\n    if (!isSafariPatchInProgress(media)) {\n      if (media.buffered.length) {\n        const ranges = getTimeRanges(media.buffered, media.duration);\n        const bufferedLength = ranges.reduce((acc, { start, end }) => acc + end - start, 0);\n        setBufferedProgress(bufferedLength / media.duration);\n        setBufferedRanges((currentRanges) => {\n          return areDeepEqual(currentRanges, ranges) ? currentRanges : ranges;\n        });\n      }\n\n      setIsBufferedDebounced(media.readyState >= MIN_READY_STATE || media.currentTime > 0);\n      setIsReady((current) => current || media.readyState > MIN_READY_STATE);\n    }\n  });\n\n  const bufferingHandlers = {\n    onPLay: handleBuffering,\n    onLoadedData: handleBuffering,\n    onPlaying: handleBuffering,\n    onLoadStart: handleBuffering, // Needed for Safari to start\n    onPause: handleBuffering, // Needed for Chrome when seeking\n    onTimeUpdate: handleBuffering, // Needed for audio buffering progress\n    onProgress: handleBuffering, // Needed for video buffering progress\n  };\n\n  return {\n    isReady,\n    isBuffered,\n    bufferedProgress,\n    bufferedRanges,\n    bufferingHandlers,\n    checkBuffering(element: HTMLMediaElement) {\n      setIsBufferedDebounced(element.readyState >= MIN_READY_STATE);\n    },\n  };\n};\n\nfunction getTimeRanges(ranges: TimeRanges, duration: number) {\n  const result: BufferedRange[] = [];\n  for (let i = 0; i < ranges.length; i++) {\n    result.push({\n      start: ranges.start(i) / duration,\n      end: ranges.end(i) / duration,\n    });\n  }\n  return result;\n}\n\nexport default useBuffering;\n","import {\n  useEffect, useMemo, useState,\n} from '../lib/teact/teact';\n\nimport { round } from '../util/math';\nimport useLastCallback from './useLastCallback';\nimport useResizeObserver from './useResizeObserver';\nimport useSharedIntersectionObserver from './useSharedIntersectionObserver';\nimport useThrottledCallback from './useThrottledCallback';\n\nconst THROTTLE_MS = 150;\n\nexport default function useCoordsInSharedCanvas(\n  containerRef: React.RefObject<HTMLDivElement>,\n  sharedCanvasRef?: React.RefObject<HTMLCanvasElement>,\n) {\n  const [x, setX] = useState<number>();\n  const [y, setY] = useState<number>();\n\n  const recalculate = useLastCallback(() => {\n    const container = containerRef.current;\n    const canvas = sharedCanvasRef?.current;\n    if (!container || !canvas) {\n      return;\n    }\n\n    // Wait until elements are properly mounted\n    if (!canvas.offsetWidth || !canvas.offsetHeight) {\n      return;\n    }\n\n    const target = container.classList.contains('sticker-set-cover') || container.classList.contains('sticker-reaction')\n      ? container\n      : container.querySelector('img')!;\n    if (!target) {\n      return;\n    }\n\n    const targetBounds = target.getBoundingClientRect();\n    const canvasBounds = canvas.getBoundingClientRect();\n\n    // Factor coords are used to support rendering while being rescaled (e.g. message appearance animation)\n    setX(round((targetBounds.left - canvasBounds.left) / canvasBounds.width, 4) || 0);\n    setY(round((targetBounds.top - canvasBounds.top) / canvasBounds.height, 4) || 0);\n  });\n\n  useEffect(recalculate, [recalculate]);\n\n  const throttledRecalculate = useThrottledCallback(recalculate, [recalculate], THROTTLE_MS);\n  useResizeObserver(sharedCanvasRef, throttledRecalculate);\n  useSharedIntersectionObserver(sharedCanvasRef, throttledRecalculate);\n\n  return useMemo(() => (x !== undefined && y !== undefined ? { x, y } : undefined), [x, y]);\n}\n","import usePreviousDeprecated from './usePreviousDeprecated';\n\nexport default function useCurrentOrPrev<T extends any>(\n  current: T, shouldSkipUndefined = false, shouldForceCurrent = false,\n): T | undefined {\n  const prev = usePreviousDeprecated(current, shouldSkipUndefined);\n\n  // eslint-disable-next-line no-null/no-null\n  return shouldForceCurrent || (current !== null && current !== undefined) ? current : prev;\n}\n","import { useCallback, useMemo } from '../lib/teact/teact';\n\nimport { debounce } from '../util/schedulers';\n\nexport default function useDebouncedCallback<T extends AnyToVoidFunction>(\n  fn: T,\n  deps: any[],\n  ms: number,\n  noFirst = false,\n  noLast = false,\n) {\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  const fnMemo = useCallback(fn, deps);\n\n  return useMemo(() => {\n    return debounce(fnMemo, ms, !noFirst, !noLast);\n  }, [fnMemo, ms, noFirst, noLast]);\n}\n","import { useSignal } from '../lib/teact/teact';\n\nimport type { Signal } from '../util/signals';\n\nimport { useSignalEffect } from './useSignalEffect';\nimport { useStateRef } from './useStateRef';\nimport useSyncEffect from './useSyncEffect';\n\ntype SyncResolver<T> = () => T;\ntype AsyncResolver<T> = (setter: (newValue: T) => void) => void;\ntype Resolver<T> =\n  SyncResolver<T>\n  | AsyncResolver<T>;\n\nfunction useDerivedSignal<T>(resolver: SyncResolver<T>, dependencies: readonly any[]): Signal<T>;\nfunction useDerivedSignal<T>(resolver: AsyncResolver<T>, dependencies: readonly any[], isAsync: true): Signal<T>;\nfunction useDerivedSignal<T>(dependency: T): Signal<T>;\n\nfunction useDerivedSignal<T>(resolverOrDependency: Resolver<T> | T, dependencies?: readonly any[], isAsync = false) {\n  const resolver = dependencies ? resolverOrDependency as Resolver<T> : () => (resolverOrDependency as T);\n  dependencies ??= [resolverOrDependency];\n\n  const [getValue, setValue] = useSignal<T>();\n  const resolverRef = useStateRef(resolver);\n\n  function runCurrentResolver() {\n    const currentResolver = resolverRef.current;\n    if (isAsync) {\n      (currentResolver as AsyncResolver<T>)(setValue);\n    } else {\n      setValue((currentResolver as SyncResolver<T>)());\n    }\n  }\n\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  useSyncEffect(runCurrentResolver, dependencies);\n\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  useSignalEffect(runCurrentResolver, dependencies);\n\n  return getValue as Signal<T>;\n}\n\nexport default useDerivedSignal;\n","import { useRef } from '../lib/teact/teact';\n\nimport type { Signal } from '../util/signals';\n\nimport useForceUpdate from './useForceUpdate';\nimport { useSignalEffect } from './useSignalEffect';\nimport { useStateRef } from './useStateRef';\nimport useSyncEffect from './useSyncEffect';\n\ntype SyncResolver<T> = () => T;\ntype AsyncResolver<T> = (setter: (newValue: T) => void) => void;\ntype Resolver<T> =\n  SyncResolver<T>\n  | AsyncResolver<T>;\n\nfunction useDerivedState<T>(resolver: SyncResolver<T>, dependencies: readonly any[]): T;\nfunction useDerivedState<T>(resolver: AsyncResolver<T>, dependencies: readonly any[], isAsync: true): T;\nfunction useDerivedState<T>(signal: Signal<T>): T;\n\nfunction useDerivedState<T>(resolverOrSignal: Resolver<T> | T, dependencies?: readonly any[], isAsync = false) {\n  const resolver = dependencies ? resolverOrSignal as Resolver<T> : () => ((resolverOrSignal as Signal<T>)());\n  dependencies ??= [resolverOrSignal];\n\n  const valueRef = useRef<T>();\n  const forceUpdate = useForceUpdate();\n  const resolverRef = useStateRef(resolver);\n\n  function runCurrentResolver(isSync = false) {\n    const currentResolver = resolverRef.current;\n    if (isAsync) {\n      (currentResolver as AsyncResolver<T>)((newValue) => {\n        if (valueRef.current !== newValue) {\n          valueRef.current = newValue;\n          forceUpdate();\n        }\n      });\n    } else {\n      const newValue = (currentResolver as SyncResolver<T>)();\n      if (valueRef.current !== newValue) {\n        valueRef.current = newValue;\n\n        if (!isSync) {\n          forceUpdate();\n        }\n      }\n    }\n  }\n\n  useSyncEffect(() => {\n    runCurrentResolver(true);\n    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  }, dependencies);\n\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  useSignalEffect(runCurrentResolver, dependencies);\n\n  return valueRef.current as T;\n}\n\nexport default useDerivedState;\n","import { useEffect } from '../lib/teact/teact';\n\nfunction useEffectOnce(effect: React.EffectCallback) {\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  useEffect(effect, []);\n}\n\nexport default useEffectOnce;\n","import { useEffect, useRef } from '../lib/teact/teact';\n\nconst useEffectWithPrevDeps = <const T extends readonly any[]>(\n  cb: (args: T | readonly []) => void, dependencies: T, debugKey?: string,\n) => {\n  const prevDepsRef = useRef<T>();\n\n  return useEffect(() => {\n    const prevDeps = prevDepsRef.current;\n    prevDepsRef.current = dependencies;\n\n    return cb(prevDeps || []);\n    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  }, dependencies, debugKey);\n};\n\nexport default useEffectWithPrevDeps;\n","import type { RefObject } from 'react';\nimport { useEffect, useRef } from '../lib/teact/teact';\n\nimport { IS_ELECTRON, IS_MAC_OS } from '../util/windowEnvironment';\n\nconst DRAG_DISTANCE_THRESHOLD = 5;\n\nconst useElectronDrag = (ref: RefObject<HTMLDivElement>) => {\n  const isDragging = useRef(false);\n\n  const x = useRef(window.screenX);\n  const y = useRef(window.screenY);\n  const distance = useRef(0);\n\n  useEffect(() => {\n    const element: HTMLDivElement | null = ref.current;\n    if (!element || !(IS_ELECTRON && IS_MAC_OS)) return undefined;\n\n    const handleClick = (event: MouseEvent) => {\n      distance.current = 0;\n\n      if (isDragging.current) {\n        event.preventDefault();\n        event.stopPropagation();\n        isDragging.current = false;\n      }\n    };\n\n    const handleMousedown = (event: MouseEvent) => {\n      if (isDragging.current) {\n        event.preventDefault();\n        event.stopPropagation();\n      }\n    };\n\n    const handleDrag = (event: MouseEvent) => {\n      if (event.buttons === 1) {\n        distance.current += Math.sqrt((x.current - window.screenX) ** 2 + (y.current - window.screenY) ** 2);\n\n        x.current = window.screenX;\n        y.current = window.screenY;\n\n        if (!isDragging.current && distance.current > DRAG_DISTANCE_THRESHOLD) {\n          isDragging.current = true;\n        }\n      }\n    };\n\n    const handleDoubleClick = (event: MouseEvent) => {\n      if (event.currentTarget === event.target) {\n        window.electron?.handleDoubleClick();\n      }\n    };\n\n    element.addEventListener('click', handleClick);\n    element.addEventListener('mousedown', handleMousedown);\n    element.addEventListener('mousemove', handleDrag);\n    element.addEventListener('dblclick', handleDoubleClick);\n\n    return () => {\n      element.removeEventListener('click', handleClick);\n      element.removeEventListener('mouseup', handleMousedown);\n      element.removeEventListener('mousemove', handleDrag);\n      element.removeEventListener('dblclick', handleDoubleClick);\n    };\n  }, [ref]);\n};\n\nexport default useElectronDrag;\n","import { useCallback, useState } from '../lib/teact/teact';\n\nconst useFlag = (initial = false, debugKey?: string): [boolean, NoneToVoidFunction, NoneToVoidFunction] => {\n  const [value, setValue] = useState(initial, debugKey);\n\n  const setTrue = useCallback(() => {\n    setValue(true);\n  }, []);\n\n  const setFalse = useCallback(() => {\n    setValue(false);\n  }, []);\n\n  return [value, setTrue, setFalse];\n};\n\nexport default useFlag;\n","import { useCallback, useState } from '../lib/teact/teact';\n\nconst useForceUpdate = () => {\n  const [, setTrigger] = useState<boolean>(false);\n\n  return useCallback(() => {\n    setTrigger((trigger) => !trigger);\n  }, []);\n};\n\nexport default useForceUpdate;\n","import {\n  getIsHeavyAnimating,\n  useCallback, useEffect, useMemo, useRef,\n} from '../lib/teact/teact';\n\nimport { createCallbackManager } from '../util/callbacks';\nimport useLastCallback from './useLastCallback';\n\nexport const startCallbacks = createCallbackManager();\nexport const endCallbacks = createCallbackManager();\n\ngetIsHeavyAnimating.subscribe(() => {\n  if (getIsHeavyAnimating()) {\n    startCallbacks.runCallbacks();\n  } else {\n    endCallbacks.runCallbacks();\n  }\n});\n\nexport default function useHeavyAnimation(\n  onStart?: AnyToVoidFunction,\n  onEnd?: AnyToVoidFunction,\n  isDisabled = false,\n) {\n  const lastOnStart = useLastCallback(onStart);\n  const lastOnEnd = useLastCallback(onEnd);\n\n  useEffect(() => {\n    if (isDisabled) {\n      return undefined;\n    }\n\n    if (getIsHeavyAnimating()) {\n      lastOnStart();\n    }\n\n    startCallbacks.addCallback(lastOnStart);\n    endCallbacks.addCallback(lastOnEnd);\n\n    return () => {\n      endCallbacks.removeCallback(lastOnEnd);\n      startCallbacks.removeCallback(lastOnStart);\n    };\n  }, [isDisabled, lastOnEnd, lastOnStart]);\n}\n\n// TODO → `onFullyIdle`?\nexport function useThrottleForHeavyAnimation<T extends AnyToVoidFunction>(afterHeavyAnimation: T, deps: unknown[]) {\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  const fnMemo = useCallback(afterHeavyAnimation, deps);\n\n  const isScheduledRef = useRef(false);\n\n  return useMemo(() => {\n    return (...args: Parameters<T>) => {\n      if (!isScheduledRef.current) {\n        if (!getIsHeavyAnimating()) {\n          fnMemo(...args);\n          return;\n        }\n\n        isScheduledRef.current = true;\n\n        const removeCallback = endCallbacks.addCallback(() => {\n          fnMemo(...args);\n          removeCallback();\n          isScheduledRef.current = false;\n        });\n      }\n    };\n  }, [fnMemo]);\n}\n","import { useCallback, useRef } from '../lib/teact/teact';\nimport { getActions } from '../global';\n\nimport { IS_TEST } from '../config';\nimport { requestMeasure } from '../lib/fasterdom/fasterdom';\nimport { IS_IOS } from '../util/windowEnvironment';\nimport useEffectOnce from './useEffectOnce';\nimport useLastCallback from './useLastCallback';\nimport useSyncEffect from './useSyncEffect';\n\nconst PATH_BASE = `${window.location.pathname}${window.location.search}`;\n// Carefully selected by swiping and observing visual changes\n// TODO: may be different on other devices such as iPad, maybe take dpi into account?\nconst SAFARI_EDGE_BACK_GESTURE_LIMIT = 300;\nconst SAFARI_EDGE_BACK_GESTURE_DURATION = 350;\n\ntype HistoryRecord = {\n  index: number;\n  // Should this record be replaced by the next record (for example Menu)\n  shouldBeReplaced?: boolean;\n  // Mark this record as replaced by the next record. Only used to check if needed to perform effectBack\n  markReplaced?: VoidFunction;\n  onBack?: VoidFunction;\n  // Set if the element is closed in the UI, but not in the real history\n  isClosed?: boolean;\n};\n\ntype HistoryOperationGo = {\n  type: 'go';\n  delta: number;\n};\n\ntype HistoryOperationState = {\n  type: 'pushState' | 'replaceState';\n  data: any;\n  hash?: string;\n};\n\ntype HistoryOperation = HistoryOperationGo | HistoryOperationState;\n\n// Needed to dismiss any 'trashed' history records from the previous page reloads.\nconst historyUniqueSessionId = Number(new Date());\n// Reflects real history state, but also contains information on which records should be replaced by the next record and\n// which records are deferred to close on the next operation\nlet historyState: HistoryRecord[];\n// Reflects current real history index\nlet historyCursor: number;\n// If we alter real history programmatically, the popstate event will be fired, which we don't need\nlet isAlteringHistory = false;\n// Unfortunately Safari doesn't really like when there's 2+ consequent history operations in one frame, so we need\n// to delay them to the next raf\nlet deferredHistoryOperations: HistoryOperation[] = [];\nlet deferredPopstateOperations: HistoryOperationState[] = [];\nlet isSafariGestureAnimation = false;\n\n// Do not remove: used for history unit tests\nif (IS_TEST) {\n  (window as any).TEST_getHistoryState = () => historyState;\n  (window as any).TEST_getHistoryCursor = () => historyCursor;\n}\n\nfunction handleTouchStart(event: TouchEvent) {\n  const x = event.touches[0].pageX;\n\n  if (x <= SAFARI_EDGE_BACK_GESTURE_LIMIT || x >= window.innerWidth - SAFARI_EDGE_BACK_GESTURE_LIMIT) {\n    isSafariGestureAnimation = true;\n  }\n}\n\nfunction handleTouchEnd() {\n  if (!isSafariGestureAnimation) {\n    return;\n  }\n\n  setTimeout(() => {\n    isSafariGestureAnimation = false;\n  }, SAFARI_EDGE_BACK_GESTURE_DURATION);\n}\n\nif (IS_IOS) {\n  window.addEventListener('touchstart', handleTouchStart);\n  window.addEventListener('touchend', handleTouchEnd);\n  window.addEventListener('popstate', handleTouchEnd);\n}\n\nfunction applyDeferredHistoryOperations() {\n  const goOperations = deferredHistoryOperations.filter((op) => op.type === 'go') as HistoryOperationGo[];\n  const stateOperations = deferredHistoryOperations.filter((op) => op.type !== 'go') as HistoryOperationState[];\n  const goCount = goOperations.reduce((acc, op) => acc + op.delta, 0);\n\n  deferredHistoryOperations = [];\n\n  if (goCount) {\n    window.history.go(goCount);\n\n    // If we have some `state` operations after the `go` operations, we need to wait until the popstate event\n    // so the order of operations is correctly preserved\n    if (stateOperations.length) {\n      deferredPopstateOperations.push(...stateOperations);\n      return;\n    }\n  }\n\n  processStateOperations(stateOperations);\n}\n\nfunction processStateOperations(stateOperations: HistoryOperationState[]) {\n  stateOperations.forEach((op) => window.history[op.type](op.data, '', op.hash));\n}\n\nfunction deferHistoryOperation(historyOperation: HistoryOperation) {\n  if (!deferredHistoryOperations.length) {\n    requestMeasure(applyDeferredHistoryOperations);\n  }\n\n  deferredHistoryOperations.push(historyOperation);\n}\n\n// Resets history to the `root` state\nfunction resetHistory() {\n  historyCursor = 0;\n  historyState = [{\n    index: 0,\n    onBack: () => window.history.back(),\n  }];\n\n  window.history.replaceState({ index: 0, historyUniqueSessionId }, '', PATH_BASE);\n}\n\nresetHistory();\n\nfunction cleanupClosed(alreadyClosedCount = 1) {\n  let countClosed = alreadyClosedCount;\n  for (let i = historyCursor - 1; i > 0; i--) {\n    if (!historyState[i].isClosed) break;\n    countClosed++;\n  }\n  if (countClosed) {\n    isAlteringHistory = true;\n    deferHistoryOperation({\n      type: 'go',\n      delta: -countClosed,\n    });\n  }\n  return countClosed;\n}\n\nfunction cleanupTrashedState() {\n  // Navigation to previous page reload, state of which was trashed by reload\n  let isAnimationDisabled = false;\n  for (let i = historyState.length - 1; i > 0; i--) {\n    if (historyState[i].isClosed) {\n      continue;\n    }\n    // TODO[history]: probably we should not call this inside the loop\n    if (!isAnimationDisabled && isSafariGestureAnimation) {\n      getActions().disableHistoryAnimations();\n      isAnimationDisabled = true;\n    }\n    historyState[i].onBack?.();\n  }\n\n  resetHistory();\n}\n\nwindow.addEventListener('popstate', ({ state }: PopStateEvent) => {\n  if (isAlteringHistory) {\n    isAlteringHistory = false;\n    if (deferredPopstateOperations.length) {\n      processStateOperations(deferredPopstateOperations);\n      deferredPopstateOperations = [];\n    }\n    return;\n  }\n\n  if (!state) {\n    cleanupTrashedState();\n\n    if (!window.location.hash) {\n      return;\n    }\n    return;\n  }\n\n  const { index, historyUniqueSessionId: previousUniqueSessionId } = state;\n  if (previousUniqueSessionId !== historyUniqueSessionId) {\n    cleanupTrashedState();\n    return;\n  }\n\n  // New real history state matches the old virtual one. Not possible in theory, but in practice we have Safari\n  if (index === historyCursor) {\n    return;\n  }\n\n  if (index < historyCursor) {\n    // Navigating back\n    let alreadyClosedCount = 0;\n    let isAnimationDisabled = false;\n    for (let i = historyCursor; i > index - alreadyClosedCount; i--) {\n      if (historyState[i].isClosed) {\n        alreadyClosedCount++;\n        continue;\n      }\n      // TODO[history]: probably we should not call this inside the loop\n      if (!isAnimationDisabled && isSafariGestureAnimation) {\n        getActions().disableHistoryAnimations();\n        isAnimationDisabled = true;\n      }\n      historyState[i].onBack?.();\n    }\n\n    const countClosed = cleanupClosed(alreadyClosedCount);\n    historyCursor += index - historyCursor - countClosed;\n\n    // Can happen when we have deferred a real back for some element (for example Menu), closed via UI,\n    // pressed back button and caused a pushState.\n    if (historyCursor < 0) {\n      historyCursor = 0;\n    }\n  } else if (index > historyCursor) {\n    // Forward navigation is not yet supported\n    isAlteringHistory = true;\n    deferHistoryOperation({\n      type: 'go',\n      delta: -(index - historyCursor),\n    });\n  }\n});\n\nexport default function useHistoryBack({\n  isActive,\n  shouldBeReplaced,\n  shouldResetUrlHash,\n  hash,\n  onBack,\n}: {\n  isActive?: boolean;\n  shouldBeReplaced?: boolean;\n  hash?: string;\n  shouldResetUrlHash?: boolean;\n  onBack: VoidFunction;\n}) {\n  const lastOnBack = useLastCallback(onBack);\n\n  // Active index of the record\n  const indexRef = useRef<number>();\n  const wasReplaced = useRef(false);\n\n  const isFirstRender = useRef(true);\n\n  const pushState = useCallback((forceReplace = false) => {\n    // Check if the old state should be replaced\n    const shouldReplace = forceReplace || historyState[historyCursor].shouldBeReplaced;\n    indexRef.current = shouldReplace ? historyCursor : ++historyCursor;\n\n    historyCursor = indexRef.current;\n\n    // Mark the previous record as replaced so effectBack doesn't perform back operation on the new record\n    const previousRecord = historyState[indexRef.current];\n    if (previousRecord && !previousRecord.isClosed) {\n      previousRecord.markReplaced?.();\n    }\n\n    historyState[indexRef.current] = {\n      index: indexRef.current,\n      onBack: lastOnBack,\n      shouldBeReplaced,\n      markReplaced: () => {\n        wasReplaced.current = true;\n      },\n    };\n\n    deferHistoryOperation({\n      type: shouldReplace ? 'replaceState' : 'pushState',\n      data: {\n        index: indexRef.current,\n        historyUniqueSessionId,\n      },\n      // Space is a hack to make the browser completely remove the hash\n      hash: hash ? `#${hash}` : (shouldResetUrlHash ? ' ' : undefined),\n    });\n  }, [hash, shouldBeReplaced, shouldResetUrlHash]);\n\n  const processBack = useCallback(() => {\n    // Only process back on open records\n    if (indexRef.current && historyState[indexRef.current] && !wasReplaced.current) {\n      historyState[indexRef.current].isClosed = true;\n      wasReplaced.current = true;\n      if (indexRef.current === historyCursor && !shouldBeReplaced) {\n        historyCursor -= cleanupClosed();\n      }\n    }\n  }, [shouldBeReplaced]);\n\n  // Process back navigation when element is unmounted\n  useEffectOnce(() => {\n    isFirstRender.current = false;\n    return () => {\n      if (!isActive || wasReplaced.current) return;\n      processBack();\n    };\n  });\n\n  useSyncEffect(([prevIsActive]) => {\n    if (prevIsActive === isActive) return;\n    if (isFirstRender.current && !isActive) return;\n\n    if (isActive) {\n      pushState();\n    } else {\n      processBack();\n    }\n  }, [isActive, processBack, pushState]);\n}\n","import type { RefObject } from 'react';\nimport { useEffect, useRef, useState } from '../lib/teact/teact';\n\nimport type { Scheduler } from '../util/schedulers';\n\nimport { type CallbackManager, createCallbackManager } from '../util/callbacks';\nimport {\n  debounce, throttle, throttleWith,\n} from '../util/schedulers';\nimport useHeavyAnimation from './useHeavyAnimation';\nimport useLastCallback from './useLastCallback';\n\ntype TargetCallback = (entry: IntersectionObserverEntry) => void;\ntype RootCallback = (entries: IntersectionObserverEntry[]) => void;\ntype ObserveCleanup = NoneToVoidFunction;\nexport type ObserveFn = (target: HTMLElement, targetCallback?: TargetCallback) => ObserveCleanup;\n\ninterface IntersectionController {\n  observer: IntersectionObserver;\n  addCallback: (element: HTMLElement, callback: TargetCallback) => void;\n  removeCallback: (element: HTMLElement, callback: TargetCallback) => void;\n  destroy: NoneToVoidFunction;\n}\n\ninterface Response {\n  observe: ObserveFn;\n  freeze: NoneToVoidFunction;\n  unfreeze: NoneToVoidFunction;\n}\n\nexport function useIntersectionObserver({\n  rootRef,\n  throttleMs,\n  throttleScheduler,\n  debounceMs,\n  shouldSkipFirst,\n  margin,\n  threshold,\n  isDisabled,\n}: {\n  rootRef: RefObject<HTMLDivElement>;\n  throttleMs?: number;\n  throttleScheduler?: Scheduler;\n  debounceMs?: number;\n  shouldSkipFirst?: boolean;\n  margin?: number;\n  threshold?: number | number[];\n  isDisabled?: boolean;\n}, rootCallback?: RootCallback): Response {\n  const controllerRef = useRef<IntersectionController>();\n  const rootCallbackRef = useRef<RootCallback>();\n  const freezeFlagsRef = useRef(0);\n  const onUnfreezeRef = useRef<NoneToVoidFunction>();\n\n  rootCallbackRef.current = rootCallback;\n\n  const freeze = useLastCallback(() => {\n    freezeFlagsRef.current++;\n  });\n\n  const unfreeze = useLastCallback(() => {\n    if (!freezeFlagsRef.current) {\n      return;\n    }\n\n    freezeFlagsRef.current--;\n\n    if (!freezeFlagsRef.current && onUnfreezeRef.current) {\n      onUnfreezeRef.current();\n      onUnfreezeRef.current = undefined;\n    }\n  });\n\n  useHeavyAnimation(freeze, unfreeze);\n\n  useEffect(() => {\n    if (isDisabled) {\n      return undefined;\n    }\n\n    return () => {\n      if (controllerRef.current) {\n        controllerRef.current.observer.disconnect();\n        controllerRef.current.destroy();\n        controllerRef.current = undefined;\n      }\n    };\n  }, [isDisabled]);\n\n  function initController() {\n    const callbacks = new Map<HTMLElement, CallbackManager<TargetCallback>>();\n    const entriesAccumulator = new Map<Element, IntersectionObserverEntry>();\n\n    let observerCallback: typeof observerCallbackSync;\n    if (typeof throttleScheduler === 'function') {\n      observerCallback = throttleWith(throttleScheduler, observerCallbackSync);\n    } else if (throttleMs) {\n      observerCallback = throttle(observerCallbackSync, throttleMs, !shouldSkipFirst);\n    } else if (debounceMs) {\n      observerCallback = debounce(observerCallbackSync, debounceMs, !shouldSkipFirst);\n    } else {\n      observerCallback = observerCallbackSync;\n    }\n\n    function observerCallbackSync() {\n      if (freezeFlagsRef.current) {\n        onUnfreezeRef.current = observerCallback;\n        return;\n      }\n\n      const entries = Array.from(entriesAccumulator.values());\n\n      entries.forEach((entry: IntersectionObserverEntry) => {\n        const callbackManager = callbacks.get(entry.target as HTMLElement);\n        callbackManager?.runCallbacks(entry);\n      });\n\n      if (rootCallbackRef.current) {\n        rootCallbackRef.current(entries);\n      }\n\n      entriesAccumulator.clear();\n    }\n\n    function addCallback(element: HTMLElement, callback: TargetCallback) {\n      if (!callbacks.get(element)) {\n        callbacks.set(element, createCallbackManager<TargetCallback>());\n      }\n\n      const callbackManager = callbacks.get(element)!;\n      callbackManager.addCallback(callback);\n    }\n\n    function removeCallback(element: HTMLElement, callback: TargetCallback) {\n      const callbackManager = callbacks.get(element);\n      if (!callbackManager) return;\n      callbackManager.removeCallback(callback);\n\n      if (!callbackManager.hasCallbacks()) {\n        callbacks.delete(element);\n      }\n    }\n\n    const observer = new IntersectionObserver(\n      (entries) => {\n        entries.forEach((entry) => {\n          entriesAccumulator.set(entry.target, entry);\n        });\n\n        if (freezeFlagsRef.current) {\n          onUnfreezeRef.current = observerCallback;\n        } else {\n          observerCallback();\n        }\n      },\n      {\n        root: rootRef.current,\n        rootMargin: margin ? `${margin}px` : undefined,\n        threshold,\n      },\n    );\n\n    function destroy() {\n      callbacks.clear();\n      observer.disconnect();\n      entriesAccumulator.clear();\n    }\n\n    controllerRef.current = {\n      observer,\n      addCallback,\n      removeCallback,\n      destroy,\n    };\n  }\n\n  const observe = useLastCallback((target, targetCallback) => {\n    if (!controllerRef.current) {\n      initController();\n    }\n\n    const controller = controllerRef.current!;\n    controller.observer.observe(target);\n\n    if (targetCallback) {\n      controller.addCallback(target, targetCallback);\n    }\n\n    return () => {\n      if (targetCallback) {\n        controller.removeCallback(target, targetCallback);\n      }\n\n      controller.observer.unobserve(target);\n    };\n  });\n\n  return { observe, freeze, unfreeze };\n}\n\nexport function useOnIntersect(\n  targetRef: RefObject<HTMLDivElement>, observe?: ObserveFn, callback?: TargetCallback,\n) {\n  const lastCallback = useLastCallback(callback);\n\n  useEffect(() => {\n    return observe ? observe(targetRef.current!, lastCallback) : undefined;\n  }, [lastCallback, observe, targetRef]);\n}\n\nexport function useIsIntersecting(\n  targetRef: RefObject<HTMLDivElement>, observe?: ObserveFn, callback?: TargetCallback,\n) {\n  const [isIntersecting, setIsIntersecting] = useState(!observe);\n\n  useOnIntersect(targetRef, observe, (entry) => {\n    setIsIntersecting(entry.isIntersecting);\n\n    if (callback) {\n      callback(entry);\n    }\n  });\n\n  return isIntersecting;\n}\n","import type { RefObject } from 'react';\nimport { useEffect, useState } from '../lib/teact/teact';\n\nimport { requestMeasure, requestMutation } from '../lib/fasterdom/fasterdom';\nimport useLastCallback from './useLastCallback';\n\nconst useKeyboardListNavigation = (\n  elementRef: RefObject<HTMLElement>,\n  isOpen: boolean,\n  onSelectWithEnter?: (index: number) => void,\n  itemSelector?: string,\n  noCaptureFocus?: boolean,\n) => {\n  const [focusedIndex, setFocusedIndex] = useState(-1);\n\n  useEffect(() => {\n    setFocusedIndex(-1);\n\n    const element = elementRef.current;\n    if (isOpen && element && !noCaptureFocus) {\n      requestMutation(() => { element.tabIndex = -1; });\n      requestMeasure(() => element.focus());\n    }\n  }, [elementRef, isOpen, noCaptureFocus]);\n\n  return useLastCallback((e: React.KeyboardEvent<any>) => {\n    const element = elementRef.current;\n\n    if (!element) {\n      return;\n    }\n\n    if (e.keyCode === 13 && onSelectWithEnter) {\n      onSelectWithEnter(focusedIndex);\n      return;\n    }\n\n    if (e.keyCode !== 38 && e.keyCode !== 40) {\n      return;\n    }\n\n    const focusedElement = document.activeElement;\n    const elementChildren = Array.from(itemSelector ? element.querySelectorAll(itemSelector) : element.children);\n\n    let newIndex = (focusedElement && elementChildren.indexOf(focusedElement)) || focusedIndex;\n\n    if (e.keyCode === 38 && newIndex > 0) {\n      newIndex--;\n    } else if (e.keyCode === 40 && newIndex < elementChildren.length - 1) {\n      newIndex++;\n    } else if (elementChildren.length === 1) {\n      newIndex = 0;\n    } else {\n      return;\n    }\n\n    const item = elementChildren[newIndex] as HTMLElement;\n    if (item) {\n      setFocusedIndex(newIndex);\n      item.focus();\n    }\n  });\n};\n\nexport default useKeyboardListNavigation;\n","import {\n  addLocalizationCallback,\n  getTranslationFn,\n  type LangFn,\n} from '../util/localization';\nimport useEffectOnce from './useEffectOnce';\nimport useForceUpdate from './useForceUpdate';\n\nconst useLang = (): LangFn => {\n  const forceUpdate = useForceUpdate();\n\n  useEffectOnce(() => {\n    return addLocalizationCallback(forceUpdate);\n  });\n\n  return getTranslationFn();\n};\n\nexport default useLang;\n","import { useCallback } from '../lib/teact/teact';\n\nimport { useStateRef } from './useStateRef';\n\nexport default function useLastCallback<T extends AnyFunction>(callback?: T) {\n  const ref = useStateRef(callback);\n\n  // No need for ref dependency\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  return useCallback((...args: Parameters<T>) => ref.current?.(...args), []) as T;\n}\n","import { useEffect } from '../lib/teact/teact';\n\nimport { ApiMediaFormat } from '../api/types';\n\nimport { selectIsSynced } from '../global/selectors';\nimport * as mediaLoader from '../util/mediaLoader';\nimport useSelector from './data/useSelector';\nimport useForceUpdate from './useForceUpdate';\n\nconst useMedia = (\n  mediaHash: string | false | undefined,\n  noLoad = false,\n  mediaFormat = ApiMediaFormat.BlobUrl,\n  delay?: number | false,\n) => {\n  const mediaData = mediaHash ? mediaLoader.getFromMemory(mediaHash) : undefined;\n  const forceUpdate = useForceUpdate();\n  const isSynced = useSelector(selectIsSynced);\n\n  useEffect(() => {\n    if (!noLoad && mediaHash && !mediaData) {\n      const startedAt = Date.now();\n\n      mediaLoader.fetch(mediaHash, mediaFormat).then(() => {\n        const spentTime = Date.now() - startedAt;\n        if (!delay || spentTime >= delay) {\n          forceUpdate();\n        } else {\n          setTimeout(forceUpdate, delay - spentTime);\n        }\n      });\n    }\n  }, [noLoad, mediaHash, mediaData, mediaFormat, delay, isSynced]);\n\n  return mediaData;\n};\n\nexport default useMedia;\n","import useShowTransition, { type HookParams } from './useShowTransition';\n\nexport default function useMediaTransition<RefType extends HTMLElement = HTMLDivElement>(\n  mediaData?: unknown,\n  options?: Partial<HookParams<RefType>>,\n) {\n  const isMediaReady = Boolean(mediaData);\n\n  const { ref } = useShowTransition<RefType>({\n    isOpen: isMediaReady,\n    noMountTransition: isMediaReady,\n    className: 'slow',\n    ...options,\n  });\n\n  return ref;\n}\n","import useShowTransitionDeprecated from './useShowTransitionDeprecated';\n\nexport default function useMediaTransitionDeprecated(mediaData?: unknown) {\n  const isMediaReady = Boolean(mediaData);\n  const { transitionClassNames } = useShowTransitionDeprecated(isMediaReady, undefined, isMediaReady, 'slow');\n\n  return transitionClassNames;\n}\n","import { useEffect } from '../lib/teact/teact';\n\nimport type { BundleModules, Bundles } from '../util/moduleLoader';\n\nimport { addLoadListener, getModuleFromMemory, loadModule } from '../util/moduleLoader';\nimport useForceUpdate from './useForceUpdate';\n\nconst useModuleLoader = <B extends Bundles, M extends BundleModules<B>>(\n  bundleName: B, moduleName: M, noLoad = false, autoUpdate = false,\n) => {\n  const module = getModuleFromMemory(bundleName, moduleName);\n  const forceUpdate = useForceUpdate();\n\n  useEffect(() => {\n    if (!autoUpdate) {\n      return undefined;\n    }\n\n    return addLoadListener(forceUpdate);\n  }, [autoUpdate, forceUpdate]);\n\n  useEffect(() => {\n    if (!noLoad && !module) {\n      loadModule(bundleName).then(forceUpdate);\n    }\n  }, [bundleName, forceUpdate, module, moduleName, noLoad]);\n\n  return module;\n};\n\nexport default useModuleLoader;\n","import * as langProvider from '../util/oldLangProvider';\nimport useEffectOnce from './useEffectOnce';\nimport useForceUpdate from './useForceUpdate';\n\nexport type OldLangFn = langProvider.LangFn;\n/**\n * @deprecated\n */\nconst useOldLang = (): OldLangFn => {\n  const forceUpdate = useForceUpdate();\n\n  useEffectOnce(() => {\n    return langProvider.addCallback(forceUpdate);\n  });\n\n  return langProvider.getTranslationFn();\n};\n\nexport default useOldLang;\n","import { useRef } from '../lib/teact/teact';\n\n/**\n * @deprecated\n */\nfunction usePreviousDeprecated<T extends any>(next: T): T | undefined;\nfunction usePreviousDeprecated<T extends any>(next: T, shouldSkipUndefined: true): Exclude<T, undefined> | undefined;\n// eslint-disable-next-line max-len\nfunction usePreviousDeprecated<T extends any>(next: T, shouldSkipUndefined?: boolean): Exclude<T, undefined> | undefined;\nfunction usePreviousDeprecated<T extends any>(next: T, shouldSkipUndefined?: boolean) {\n  const ref = useRef<T>();\n  const { current } = ref;\n  if (!shouldSkipUndefined || next !== undefined) {\n    ref.current = next;\n  }\n\n  return current;\n}\n\nexport default usePreviousDeprecated;\n","import { useEffect } from '../lib/teact/teact';\n\nimport { createCallbackManager } from '../util/callbacks';\nimport useLastCallback from './useLastCallback';\n\nconst startCallbacks = createCallbackManager();\nconst endCallbacks = createCallbackManager();\n\nlet timeout: number | undefined;\nlet isActive = false;\n\nconst usePriorityPlaybackCheck = (\n  onStart?: AnyToVoidFunction,\n  onEnd?: AnyToVoidFunction,\n  isDisabled = false,\n) => {\n  const lastOnStart = useLastCallback(onStart);\n  const lastOnEnd = useLastCallback(onEnd);\n\n  useEffect(() => {\n    if (isDisabled) {\n      return undefined;\n    }\n\n    if (isActive) {\n      lastOnStart();\n    }\n\n    startCallbacks.addCallback(lastOnStart);\n    endCallbacks.addCallback(lastOnEnd);\n\n    return () => {\n      endCallbacks.removeCallback(lastOnEnd);\n      startCallbacks.removeCallback(lastOnStart);\n    };\n  }, [isDisabled, lastOnStart, lastOnEnd]);\n};\n\nexport function isPriorityPlaybackActive() {\n  return isActive;\n}\n\nexport function dispatchPriorityPlaybackEvent() {\n  if (!isActive) {\n    isActive = true;\n    startCallbacks.runCallbacks();\n  }\n\n  if (timeout) {\n    clearTimeout(timeout);\n    timeout = undefined;\n  }\n\n  // Race condition may happen if another `dispatchPriorityPlaybackEvent` is called before `onEnd`\n  function onEnd() {\n    if (timeout) {\n      clearTimeout(timeout);\n      timeout = undefined;\n    }\n\n    isActive = false;\n    endCallbacks.runCallbacks();\n  }\n\n  return onEnd;\n}\n\nexport default usePriorityPlaybackCheck;\n","import { useEffect } from '../lib/teact/teact';\n\nimport type { CallbackManager } from '../util/callbacks';\n\nimport { createCallbackManager } from '../util/callbacks';\nimport { useStateRef } from './useStateRef';\n\nconst elementObserverMap = new Map<HTMLElement, [ResizeObserver, CallbackManager]>();\n\nexport default function useResizeObserver(\n  ref: React.RefObject<HTMLElement> | undefined,\n  onResize: (entry: ResizeObserverEntry) => void,\n  isDisabled = false,\n) {\n  const onResizeRef = useStateRef(onResize);\n\n  useEffect(() => {\n    const el = ref?.current;\n    if (!el || isDisabled) {\n      return undefined;\n    }\n\n    const callback: ResizeObserverCallback = ([entry]) => {\n      // Ignore updates when element is not properly mounted (`display: none`)\n      if (entry.contentRect.width === 0 && entry.contentRect.height === 0) {\n        return;\n      }\n\n      onResizeRef.current(entry);\n    };\n\n    let [observer, callbackManager] = elementObserverMap.get(el) || [undefined, undefined];\n    if (!observer) {\n      callbackManager = createCallbackManager();\n      observer = new ResizeObserver(callbackManager.runCallbacks);\n      elementObserverMap.set(el, [observer, callbackManager]);\n      observer.observe(el);\n    }\n    callbackManager!.addCallback(callback);\n\n    return () => {\n      callbackManager!.removeCallback(callback);\n      if (!callbackManager!.hasCallbacks()) {\n        observer!.unobserve(el);\n        observer!.disconnect();\n        elementObserverMap.delete(el);\n      }\n    };\n  }, [isDisabled, onResizeRef, ref]);\n}\n","import { getIsHeavyAnimating, useEffect } from '../lib/teact/teact';\n\nimport type { CallbackManager } from '../util/callbacks';\n\nimport { requestMeasure } from '../lib/fasterdom/fasterdom';\nimport { createCallbackManager } from '../util/callbacks';\nimport useLastCallback from './useLastCallback';\n\nconst elementObserverMap = new Map<HTMLElement, [IntersectionObserver, CallbackManager]>();\n\nexport default function useSharedIntersectionObserver(\n  refOrElement: React.RefObject<HTMLElement> | HTMLElement | undefined,\n  onIntersectionChange: (entry: IntersectionObserverEntry) => void,\n  isDisabled = false,\n) {\n  const onIntersectionChangeLast = useLastCallback(onIntersectionChange);\n\n  useEffect(() => {\n    const el = refOrElement && 'current' in refOrElement ? refOrElement.current : refOrElement;\n    if (!el || isDisabled) {\n      return undefined;\n    }\n\n    const entriesAccumulator = new Map<Element, IntersectionObserverEntry>();\n\n    function flush() {\n      for (const entry of entriesAccumulator.values()) {\n        // Ignore updates when element is not properly mounted (`display: none`)\n        if (!(entry.target as HTMLElement).offsetParent) {\n          continue;\n        }\n\n        onIntersectionChangeLast(entry);\n      }\n\n      entriesAccumulator.clear();\n    }\n\n    const callback: IntersectionObserverCallback = ([entry]) => {\n      entriesAccumulator.set(entry.target, entry);\n\n      if (!getIsHeavyAnimating()) {\n        flush();\n      } else {\n        getIsHeavyAnimating.once(() => {\n          requestMeasure(flush);\n        });\n      }\n    };\n\n    let [observer, callbackManager] = elementObserverMap.get(el) || [undefined, undefined];\n    if (!observer) {\n      callbackManager = createCallbackManager();\n      observer = new IntersectionObserver(callbackManager.runCallbacks);\n      elementObserverMap.set(el, [observer, callbackManager]);\n      observer.observe(el);\n    }\n    callbackManager!.addCallback(callback);\n\n    return () => {\n      callbackManager!.removeCallback(callback);\n      if (!callbackManager!.hasCallbacks()) {\n        observer!.unobserve(el);\n        observer!.disconnect();\n        elementObserverMap.delete(el);\n      }\n    };\n  }, [isDisabled, refOrElement]);\n}\n","import { useRef } from '../lib/teact/teact';\n\nimport useSyncEffect from './useSyncEffect';\n\nconst useLayoutEffectWithPrevDeps = <const T extends readonly any[]>(\n  cb: (args: T | readonly []) => void, dependencies: T,\n) => {\n  const prevDepsRef = useRef<T>();\n\n  return useSyncEffect(() => {\n    const prevDeps = prevDepsRef.current;\n    prevDepsRef.current = dependencies;\n\n    return cb(prevDeps || []);\n    // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  }, dependencies);\n};\n\nexport default useLayoutEffectWithPrevDeps;\n","import type { RefObject } from '../lib/teact/teact';\nimport { useLayoutEffect, useRef, useSignal } from '../lib/teact/teact';\nimport { addExtraClass, toggleExtraClass } from '../lib/teact/teact-dom';\n\nimport type { Signal } from '../util/signals';\n\nimport { requestMeasure } from '../lib/fasterdom/fasterdom';\nimport useDerivedSignal from './useDerivedSignal';\nimport useDerivedState from './useDerivedState';\nimport useLastCallback from './useLastCallback';\nimport { useStateRef } from './useStateRef';\nimport useSyncEffect from './useSyncEffect';\nimport useSyncEffectWithPrevDeps from './useSyncEffectWithPrevDeps';\n\nconst CLOSE_DURATION = 350;\n\ntype BaseHookParams<RefType extends HTMLElement> = {\n  isOpen: boolean | undefined;\n  ref?: RefObject<RefType | null>;\n  noMountTransition?: boolean;\n  noOpenTransition?: boolean;\n  noCloseTransition?: boolean;\n  closeDuration?: number;\n  className?: string | false;\n  prefix?: string;\n  shouldForceOpen?: boolean;\n  onCloseAnimationEnd?: NoneToVoidFunction;\n};\n\nexport type HookParams<RefType extends HTMLElement> = BaseHookParams<RefType> & {\n  withShouldRender?: never;\n};\n\ntype HookParamsWithShouldRender<RefType extends HTMLElement> = BaseHookParams<RefType> & {\n  withShouldRender: true;\n};\n\ntype HookResult<RefType extends HTMLElement> = {\n  ref: RefObject<RefType | null>;\n  getIsClosing: Signal<boolean>;\n};\n\ntype HookResultWithShouldRender<RefType extends HTMLElement> = HookResult<RefType> & {\n  shouldRender: boolean;\n};\n\ntype State =\n  'closed'\n  | 'scheduled-open'\n  | 'open'\n  | 'closing';\n\nexport default function useShowTransition<RefType extends HTMLElement = HTMLDivElement>(\n  params: HookParams<RefType>\n): HookResult<RefType>;\nexport default function useShowTransition<RefType extends HTMLElement = HTMLDivElement>(\n  params: HookParamsWithShouldRender<RefType>\n): HookResultWithShouldRender<RefType>;\nexport default function useShowTransition<RefType extends HTMLElement = HTMLDivElement>(\n  params: HookParams<RefType> | HookParamsWithShouldRender<RefType>,\n): HookResult<RefType> | HookResultWithShouldRender<RefType> {\n  const {\n    isOpen,\n    noMountTransition = false,\n    noOpenTransition = false,\n    noCloseTransition = false,\n    closeDuration = CLOSE_DURATION,\n    className = 'fast',\n    prefix = '',\n    shouldForceOpen,\n    onCloseAnimationEnd,\n  } = params;\n\n  // eslint-disable-next-line no-null/no-null\n  const localRef = useRef<RefType>(null);\n  const ref = params.ref || localRef;\n  const closingTimeoutRef = useRef<number>();\n  const [getState, setState] = useSignal<State | undefined>();\n  const optionsRef = useStateRef({\n    closeDuration, noMountTransition, noOpenTransition, noCloseTransition,\n  });\n  const onCloseEndLast = useLastCallback(onCloseAnimationEnd);\n\n  useSyncEffectWithPrevDeps(([prevIsOpen]) => {\n    const options = optionsRef.current;\n\n    if (shouldForceOpen) {\n      setState('open');\n      return;\n    }\n\n    if (isOpen) {\n      if (closingTimeoutRef.current) {\n        clearTimeout(closingTimeoutRef.current);\n        closingTimeoutRef.current = undefined;\n      }\n\n      if (options.noOpenTransition || (prevIsOpen === undefined && options.noMountTransition)) {\n        setState('open');\n      } else {\n        setState('scheduled-open');\n        requestMeasure(() => {\n          setState('open');\n        });\n      }\n    } else if (prevIsOpen === undefined || options.noCloseTransition) {\n      setState('closed');\n    } else {\n      setState('closing');\n\n      closingTimeoutRef.current = window.setTimeout(() => {\n        setState('closed');\n        onCloseEndLast();\n      }, options.closeDuration);\n    }\n  }, [isOpen, shouldForceOpen]);\n\n  const applyClassNames = useLastCallback(() => {\n    const element = ref.current;\n    if (!element) return;\n\n    if (className !== false) {\n      addExtraClass(element, 'opacity-transition');\n      addExtraClass(element, className);\n    }\n\n    const state = getState();\n    const shouldRender = state !== 'closed';\n    const hasOpenClass = state === 'open';\n    const isClosing = state === 'closing';\n\n    toggleExtraClass(element, `${prefix}shown`, shouldRender);\n    toggleExtraClass(element, `${prefix}not-shown`, !shouldRender);\n    toggleExtraClass(element, `${prefix}open`, hasOpenClass);\n    toggleExtraClass(element, `${prefix}not-open`, !hasOpenClass);\n    toggleExtraClass(element, `${prefix}closing`, isClosing);\n  });\n\n  // Workaround for Chrome causing forced reflow in the middle of mutation phase when unmounting a focused element.\n  // Due to such forced reflow setting initial class names in the first layout effect causes transitions to start.\n  useSyncEffect(() => {\n    ref.onChange = () => {\n      ref.onChange = undefined;\n      applyClassNames();\n    };\n  }, [applyClassNames, ref]);\n\n  useLayoutEffect(applyClassNames, [applyClassNames, getState]);\n\n  const withShouldRender = 'withShouldRender' in params && params.withShouldRender;\n  const shouldRender = useDerivedState(\n    () => (withShouldRender && getState() !== 'closed'),\n    [withShouldRender, getState],\n  );\n\n  const getIsClosing = useDerivedSignal(() => getState() === 'closing', [getState]);\n\n  if (withShouldRender) {\n    return { ref, shouldRender, getIsClosing };\n  }\n\n  return { ref, getIsClosing };\n}\n","import { useRef, useState } from '../lib/teact/teact';\n\nimport buildClassName from '../util/buildClassName';\n\nconst CLOSE_DURATION = 350;\n\nconst useShowTransitionDeprecated = (\n  isOpen = false,\n  onCloseTransitionEnd?: () => void,\n  noFirstOpenTransition = false,\n  className: string | false = 'fast',\n  noCloseTransition = false,\n  closeDuration = CLOSE_DURATION,\n  noOpenTransition = false,\n) => {\n  const [isClosed, setIsClosed] = useState(!isOpen);\n  const closeTimeoutRef = useRef<number>();\n  // СSS class should be added in a separate tick to turn on CSS transition.\n  const [hasOpenClassName, setHasOpenClassName] = useState(isOpen && noFirstOpenTransition);\n\n  if (isOpen) {\n    setIsClosed(false);\n    setHasOpenClassName(true);\n\n    if (closeTimeoutRef.current) {\n      window.clearTimeout(closeTimeoutRef.current);\n\n      closeTimeoutRef.current = undefined;\n    }\n  } else {\n    setHasOpenClassName(false);\n\n    if (!isClosed && !closeTimeoutRef.current) {\n      const exec = () => {\n        setIsClosed(true);\n\n        if (onCloseTransitionEnd) {\n          onCloseTransitionEnd();\n        }\n\n        closeTimeoutRef.current = undefined;\n      };\n\n      if (noCloseTransition) {\n        exec();\n      } else {\n        closeTimeoutRef.current = window.setTimeout(exec, closeDuration);\n      }\n    }\n  }\n\n  // `noCloseTransition`, when set to true, should remove the open class immediately\n  const shouldHaveOpenClassName = (hasOpenClassName && !(noCloseTransition && !isOpen)) || (noOpenTransition && isOpen);\n  const isClosing = Boolean(closeTimeoutRef.current);\n  const shouldRender = isOpen || isClosing;\n  const transitionClassNames = buildClassName(\n    className && 'opacity-transition',\n    className,\n    shouldHaveOpenClassName && 'open',\n    !shouldHaveOpenClassName && 'not-open',\n    shouldRender && 'shown',\n    !shouldRender && 'not-shown',\n    isClosing && 'closing',\n  );\n\n  return {\n    shouldRender,\n    transitionClassNames,\n    hasShownClass: shouldRender,\n    hasOpenClass: shouldHaveOpenClassName,\n    isClosing,\n  };\n};\n\nexport default useShowTransitionDeprecated;\n","import { useRef, useUnmountCleanup } from '../lib/teact/teact';\n\nimport { cleanupEffect, isSignal } from '../util/signals';\n\nexport function useSignalEffect(effect: NoneToVoidFunction, dependencies: readonly any[]) {\n  // The is extracted from `useEffectOnce` to run before all effects\n  const isFirstRun = useRef(true);\n  if (isFirstRun.current) {\n    isFirstRun.current = false;\n\n    dependencies?.forEach((dependency) => {\n      if (isSignal(dependency)) {\n        dependency.subscribe(effect);\n      }\n    });\n  }\n\n  useUnmountCleanup(() => {\n    cleanupEffect(effect);\n  });\n}\n","import { useRef } from '../lib/teact/teact';\n\n// Allows to use state value as \"silent\" dependency in hooks (not causing updates).\n// Also useful for state values that update frequently (such as controlled input value).\nexport function useStateRef<T>(value: T) {\n  const ref = useRef<T>(value);\n  ref.current = value;\n  return ref;\n}\n","import { useRef, useUnmountCleanup } from '../lib/teact/teact';\n\nimport usePreviousDeprecated from './usePreviousDeprecated';\n\nexport default function useSyncEffect<const T extends readonly any[]>(\n  effect: (args: T | readonly []) => NoneToVoidFunction | void,\n  dependencies: T,\n) {\n  const prevDeps = usePreviousDeprecated<T>(dependencies);\n  const cleanupRef = useRef<NoneToVoidFunction>();\n\n  if (!prevDeps || dependencies.some((d, i) => d !== prevDeps[i])) {\n    cleanupRef.current?.();\n    cleanupRef.current = effect(prevDeps || []) ?? undefined;\n  }\n\n  useUnmountCleanup(() => {\n    cleanupRef.current?.();\n  });\n}\n","import { useCallback, useMemo } from '../lib/teact/teact';\n\nimport type { Scheduler } from '../util/schedulers';\n\nimport { throttle, throttleWith } from '../util/schedulers';\n\nexport default function useThrottledCallback<T extends AnyToVoidFunction>(\n  fn: T,\n  deps: any[],\n  msOrSchedulerFn: number | Scheduler,\n  noFirst = false,\n) {\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  const fnMemo = useCallback(fn, deps);\n\n  return useMemo(() => {\n    if (typeof msOrSchedulerFn === 'number') {\n      return throttle(fnMemo, msOrSchedulerFn, !noFirst);\n    } else {\n      return throttleWith(msOrSchedulerFn, fnMemo);\n    }\n  }, [fnMemo, msOrSchedulerFn, noFirst]);\n}\n","import { useMemo } from '../lib/teact/teact';\nimport { getGlobal } from '../global';\n\nimport type { ApiThumbnail, MediaContainer } from '../api/types';\n\nimport { getMessageMediaThumbDataUri } from '../global/helpers';\nimport { selectTheme } from '../global/selectors';\n\nexport default function useThumbnail(media?: MediaContainer | ApiThumbnail) {\n  const isMediaContainer = media && 'content' in media;\n  const thumbDataUri = isMediaContainer ? getMessageMediaThumbDataUri(media) : media?.dataUri;\n\n  // TODO Find a way to update thumbnail on theme change\n  const theme = selectTheme(getGlobal());\n\n  const dataUri = useMemo(() => {\n    const uri = thumbDataUri;\n    if (!uri || theme !== 'dark') return uri;\n\n    return uri.replace('<svg', '<svg fill=\"white\"');\n  }, [thumbDataUri, theme]);\n\n  return dataUri;\n}\n","import { useRef } from '../lib/teact/teact';\n\nimport generateUniqueId from '../util/generateUniqueId';\n\nexport default function useUniqueId() {\n  const idRef = useRef<string>();\n\n  if (!idRef.current) {\n    idRef.current = generateUniqueId();\n  }\n\n  return idRef.current;\n}\n","import type { RefObject } from 'react';\nimport { resolveEventType } from '../lib/teact/dom-events';\nimport { onFullyIdle, useLayoutEffect } from '../lib/teact/teact';\n\nimport unloadVideo from '../util/browser/unloadVideo';\nimport { useStateRef } from './useStateRef';\n\n// Fix memory leak when unmounting video element\nexport default function useVideoCleanup(videoRef: RefObject<HTMLVideoElement>, handlers?: Record<string, AnyFunction>) {\n  const handlersRef = useStateRef(handlers);\n\n  useLayoutEffect(() => {\n    const videoEl = videoRef.current;\n    if (!videoEl) return undefined;\n\n    return () => {\n      // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n      const handlers2 = handlersRef.current;\n      if (handlers2) {\n        Object.entries(handlers2).forEach(([key, value]) => {\n          videoEl.removeEventListener(resolveEventType(key, videoEl), value, false);\n        });\n      }\n\n      // It may be slow (specifically on iOS), so we postpone it after unmounting\n      onFullyIdle(() => {\n        unloadVideo(videoEl);\n      });\n    };\n  }, [handlersRef, videoRef]);\n}\n","import type { RefObject } from 'react';\nimport { useEffect } from '../lib/teact/teact';\n\nimport { hasActiveViewTransition } from './animations/useViewTransition';\n\nconst BACKDROP_CLASSNAME = 'backdrop';\n\n// This effect implements closing menus by clicking outside of them\n// without adding extra elements to the DOM\nexport default function useVirtualBackdrop(\n  isOpen: boolean,\n  containerRef: RefObject<HTMLElement>,\n  onClose?: () => void | undefined,\n  ignoreRightClick?: boolean,\n  excludedClosestSelector?: string,\n) {\n  useEffect(() => {\n    if (!isOpen || !onClose) {\n      return undefined;\n    }\n\n    const handleEvent = (e: MouseEvent) => {\n      const container = containerRef.current;\n      const target = e.target as HTMLElement | null;\n      if (!container || !target || (ignoreRightClick && e.button === 2) || hasActiveViewTransition()) {\n        return;\n      }\n\n      if ((\n        !container.contains(e.target as Node | null)\n        || target.classList.contains(BACKDROP_CLASSNAME)\n      ) && !(excludedClosestSelector && (\n        target.matches(excludedClosestSelector) || target.closest(excludedClosestSelector)\n      ))) {\n        e.preventDefault();\n        e.stopPropagation();\n        onClose?.();\n      }\n    };\n\n    document.addEventListener('mousedown', handleEvent);\n\n    return () => {\n      document.removeEventListener('mousedown', handleEvent);\n    };\n  }, [excludedClosestSelector, ignoreRightClick, isOpen, containerRef, onClose]);\n}\n","import { useEffect } from '../../lib/teact/teact';\n\nimport { createCallbackManager } from '../../util/callbacks';\nimport useLastCallback from '../useLastCallback';\n\nconst blurCallbacks = createCallbackManager();\nconst focusCallbacks = createCallbackManager();\n\nlet isFocused = document.hasFocus();\n\nwindow.addEventListener('blur', () => {\n  if (!isFocused) {\n    return;\n  }\n\n  isFocused = false;\n  blurCallbacks.runCallbacks();\n});\n\nwindow.addEventListener('focus', () => {\n  isFocused = true;\n  focusCallbacks.runCallbacks();\n});\n\nexport default function useBackgroundMode(\n  onBlur?: AnyToVoidFunction,\n  onFocus?: AnyToVoidFunction,\n  isDisabled = false,\n) {\n  const lastOnBlur = useLastCallback(onBlur);\n  const lastOnFocus = useLastCallback(onFocus);\n\n  useEffect(() => {\n    if (isDisabled) {\n      return undefined;\n    }\n\n    if (!isFocused) {\n      lastOnBlur();\n    }\n\n    blurCallbacks.addCallback(lastOnBlur);\n    focusCallbacks.addCallback(lastOnFocus);\n\n    return () => {\n      focusCallbacks.removeCallback(lastOnFocus);\n      blurCallbacks.removeCallback(lastOnBlur);\n    };\n  }, [isDisabled, lastOnBlur, lastOnFocus]);\n}\n\nexport function isBackgroundModeActive() {\n  return !isFocused;\n}\n","import { useState } from '../../lib/teact/teact';\n\nimport { createCallbackManager } from '../../util/callbacks';\nimport useEffectOnce from '../useEffectOnce';\n\nconst callbacks = createCallbackManager();\n\nfunction createListener() {\n  window.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`)\n    .addEventListener('change', callbacks.runCallbacks, { once: true });\n}\n\nexport default function useDevicePixelRatio() {\n  const [dpr, setDpr] = useState(window.devicePixelRatio);\n\n  useEffectOnce(() => {\n    return callbacks.addCallback(() => {\n      setDpr(window.devicePixelRatio);\n    });\n  });\n\n  return dpr;\n}\n\ncreateListener();\n\n// Set up new listener for the next `devicePixelRatio` change\ncallbacks.addCallback(createListener);\n","import { useEffect, useMemo, useState } from '../../lib/teact/teact';\n\nimport { throttle } from '../../util/schedulers';\nimport windowSize from '../../util/windowSize';\nimport useDebouncedCallback from '../useDebouncedCallback';\n\nconst THROTTLE = 250;\n\nexport default function useWindowSize() {\n  const { width: initialWidth, height: initialHeight } = windowSize.get();\n  const [width, setWidth] = useState(initialWidth);\n  const [height, setHeight] = useState(initialHeight);\n  const [isResizing, setIsResizing] = useState(false);\n  const setIsResizingDebounced = useDebouncedCallback(setIsResizing, [setIsResizing], THROTTLE, true);\n\n  useEffect(() => {\n    const throttledSetIsResizing = throttle(() => {\n      setIsResizing(true);\n    }, THROTTLE, true);\n\n    const throttledSetSize = throttle(() => {\n      const { width: newWidth, height: newHeight } = windowSize.get();\n      setWidth(newWidth);\n      setHeight(newHeight);\n      setIsResizingDebounced(false);\n    }, THROTTLE, false);\n\n    const handleResize = () => {\n      throttledSetIsResizing();\n      throttledSetSize();\n    };\n\n    window.addEventListener('resize', handleResize);\n\n    return () => {\n      window.removeEventListener('resize', handleResize);\n    };\n  }, [setIsResizingDebounced]);\n\n  return useMemo(() => ({ width, height, isResizing }), [height, isResizing, width]);\n}\n","import safeExec from '../../util/safeExec';\nimport { fastRaf, throttleWith } from '../../util/schedulers';\nimport { setPhase } from './stricterdom';\n\nlet pendingMeasureTasks: NoneToVoidFunction[] = [];\nlet pendingMutationTasks: NoneToVoidFunction[] = [];\nlet pendingForceReflowTasks: (() => NoneToVoidFunction | void)[] = [];\n\nconst runUpdatePassOnRaf = throttleWithRafFallback(() => {\n  const currentMeasureTasks = pendingMeasureTasks;\n  pendingMeasureTasks = [];\n  currentMeasureTasks.forEach((task) => {\n    safeExec(task);\n  });\n\n  // We use promises to provide correct order for Mutation Observer callback microtasks\n  Promise.resolve()\n    .then(() => {\n      setPhase('mutate');\n\n      const currentMutationTasks = pendingMutationTasks;\n      pendingMutationTasks = [];\n\n      currentMutationTasks.forEach((task) => {\n        safeExec(task);\n      });\n    })\n    .then(() => {\n      setPhase('measure');\n\n      const pendingForceReflowMutationTasks: NoneToVoidFunction[] = [];\n      // Will include tasks created during the loop\n      for (const task of pendingForceReflowTasks) {\n        safeExec(() => {\n          const mutationTask = task();\n          if (mutationTask) {\n            pendingForceReflowMutationTasks.push(mutationTask);\n          }\n        });\n      }\n      pendingForceReflowTasks = [];\n\n      return pendingForceReflowMutationTasks;\n    })\n    .then((pendingForceReflowMutationTasks) => {\n      setPhase('mutate');\n\n      // Will include tasks created during the loop\n      for (const task of pendingForceReflowMutationTasks) {\n        safeExec(task);\n      }\n    })\n    .then(() => {\n      setPhase('measure');\n    });\n});\n\nexport function requestMeasure(cb: NoneToVoidFunction) {\n  pendingMeasureTasks.push(cb);\n  runUpdatePassOnRaf();\n}\n\nexport function requestMutation(cb: NoneToVoidFunction) {\n  pendingMutationTasks.push(cb);\n  runUpdatePassOnRaf();\n}\n\nexport function requestNextMutation(cb: () => (NoneToVoidFunction | void)) {\n  requestMeasure(() => {\n    requestMutation(cb);\n  });\n}\n\nexport function requestForcedReflow(cb: () => (NoneToVoidFunction | void)) {\n  pendingForceReflowTasks.push(cb);\n  runUpdatePassOnRaf();\n}\n\nfunction throttleWithRafFallback<F extends AnyToVoidFunction>(fn: F) {\n  return throttleWith((throttledFn: NoneToVoidFunction) => {\n    fastRaf(throttledFn, true);\n  }, fn);\n}\n\nexport * from './stricterdom';\n","// https://gist.github.com/paulirish/5d52fb081b3570c81e3a\n\nexport default {\n  Element: {\n    props: [\n      'clientLeft', 'clientTop', 'clientWidth', 'clientHeight',\n      'scrollWidth', 'scrollHeight', 'scrollLeft', 'scrollTop',\n    ] as const,\n    methods: [\n      'getClientRects', 'getBoundingClientRect',\n      'scrollBy', 'scrollTo', 'scrollIntoView', 'scrollIntoViewIfNeeded',\n    ] as const,\n  },\n  HTMLElement: {\n    props: [\n      'offsetLeft', 'offsetTop', 'offsetWidth', 'offsetHeight', 'offsetParent',\n      'innerText',\n    ] as const,\n    methods: ['focus'] as const,\n  },\n  window: {\n    props: [\n      'scrollX', 'scrollY',\n      'innerHeight', 'innerWidth',\n    ] as const,\n    methods: ['getComputedStyle'] as const,\n  },\n  VisualViewport: {\n    props: [\n      'height', 'width', 'offsetTop', 'offsetLeft',\n    ] as const,\n  },\n  Document: {\n    props: ['scrollingElement'] as const,\n    methods: ['elementFromPoint'] as const,\n  },\n  HTMLInputElement: {\n    methods: ['select'] as const,\n  },\n  MouseEvent: {\n    props: ['layerX', 'layerY', 'offsetX', 'offsetY'] as const,\n  },\n  Range: {\n    methods: ['getClientRects', 'getBoundingClientRect'] as const,\n  },\n};\n","import LAYOUT_CAUSES from './layoutCauses';\n\ntype Entities = keyof typeof LAYOUT_CAUSES;\ntype Phase =\n  'measure'\n  | 'mutate';\ntype ErrorHandler = (error: Error) => any;\n\n// eslint-disable-next-line no-console\nconst DEFAULT_ERROR_HANDLER = console.error;\n\nlet onError: ErrorHandler = DEFAULT_ERROR_HANDLER;\n\nconst nativeMethods = new Map<string, AnyFunction>();\n\nlet phase: Phase = 'measure';\nlet isStrict = false;\nlet observer: MutationObserver | undefined;\n\nexport function setPhase(newPhase: Phase) {\n  phase = newPhase;\n}\n\nexport function getPhase() {\n  return phase;\n}\n\nexport function enableStrict() {\n  if (isStrict) return;\n\n  isStrict = true;\n  setupLayoutDetectors();\n  setupMutationObserver();\n}\n\nexport function disableStrict() {\n  if (!isStrict) return;\n\n  clearMutationObserver();\n  clearLayoutDetectors();\n  isStrict = false;\n}\n\nexport function forceMeasure(cb: () => any) {\n  if (phase !== 'mutate') {\n    throw new Error('The current phase is \\'measure\\'');\n  }\n\n  phase = 'measure';\n  const result = cb();\n  phase = 'mutate';\n\n  return result;\n}\n\nconst forcedMutationAllowedFor = new Set<Node>();\n\nexport function forceMutation(cb: () => any, nodes: Node | Node[]) {\n  if (phase !== 'measure') {\n    throw new Error('The current phase is \\'mutate\\'');\n  }\n\n  if (isStrict) {\n    if (Array.isArray(nodes)) {\n      nodes.forEach((node) => {\n        forcedMutationAllowedFor.add(node);\n      });\n    } else {\n      forcedMutationAllowedFor.add(nodes);\n    }\n  }\n\n  return cb();\n}\n\nexport function setHandler(handler?: ErrorHandler) {\n  onError = handler || DEFAULT_ERROR_HANDLER;\n}\n\nfunction setupLayoutDetectors() {\n  Object.entries(LAYOUT_CAUSES).forEach(([name, causes]) => {\n    const entity = window[name as Entities];\n    if (!entity) return;\n    const prototype = typeof entity === 'object' ? entity : entity.prototype;\n\n    if ('props' in causes) {\n      causes.props.forEach((prop) => {\n        const nativeGetter = Object.getOwnPropertyDescriptor(prototype, prop)?.get;\n        if (!nativeGetter) {\n          return;\n        }\n\n        nativeMethods.set(`${name}#${prop}`, nativeGetter);\n\n        Object.defineProperty(prototype, prop, {\n          get() {\n            onMeasure(prop);\n\n            return nativeGetter.call(this);\n          },\n        });\n      });\n    }\n\n    if ('methods' in causes) {\n      causes.methods.forEach((method) => {\n        const nativeMethod = (prototype as any)[method]!;\n        nativeMethods.set(`${name}#${method}`, nativeMethod);\n\n        // eslint-disable-next-line func-names\n        (prototype as any)[method] = function (...args: any[]) {\n          onMeasure(method);\n\n          return nativeMethod.apply(this, args);\n        };\n      });\n    }\n  });\n}\n\nfunction clearLayoutDetectors() {\n  Object.entries(LAYOUT_CAUSES).forEach(([name, causes]) => {\n    const entity = window[name as Entities];\n    if (!entity) return;\n    const prototype = typeof entity === 'object' ? entity : entity.prototype;\n\n    if ('props' in causes) {\n      causes.props.forEach((prop) => {\n        const nativeGetter = nativeMethods.get(`${name}#${prop}`);\n        if (!nativeGetter) {\n          return;\n        }\n\n        Object.defineProperty(prototype, prop, { get: nativeGetter });\n      });\n    }\n\n    if ('methods' in causes) {\n      causes.methods.forEach((method) => {\n        (prototype as any)[method] = nativeMethods.get(`${name}#${method}`)!;\n      });\n    }\n  });\n\n  nativeMethods.clear();\n}\n\nfunction setupMutationObserver() {\n  observer = new MutationObserver((mutations) => {\n    if (phase !== 'mutate') {\n      mutations.forEach(({ target, type, attributeName }) => {\n        if (!document.contains(target)) {\n          return;\n        }\n\n        if (forcedMutationAllowedFor.has(target)) {\n          return;\n        }\n\n        if (type === 'childList' && target instanceof HTMLElement && target.contentEditable) {\n          return;\n        }\n\n        if (attributeName?.startsWith('data-')) {\n          return;\n        }\n\n        // eslint-disable-next-line no-console\n        onError(new Error(`Unexpected mutation detected: \\`${type === 'attributes' ? attributeName : type}\\``));\n      });\n    }\n\n    forcedMutationAllowedFor.clear();\n  });\n\n  observer.observe(document.body, {\n    childList: true,\n    attributes: true,\n    subtree: true,\n    characterData: false,\n  });\n}\n\nfunction clearMutationObserver() {\n  observer?.disconnect();\n  observer = undefined;\n}\n\nfunction onMeasure(propName: string) {\n  if (phase !== 'measure') {\n    onError(new Error(`Unexpected measurement detected: \\`${propName}\\``));\n  }\n}\n","type RLottieClass = typeof import('./RLottie').default;\n\nlet promise: Promise<RLottieClass>;\nlet RLottie: RLottieClass;\n\n// Time for the main interface to completely load\nconst LOTTIE_LOAD_DELAY = 3000;\n\nexport async function ensureRLottie() {\n  if (!promise) {\n    promise = import('./RLottie').then((module) => module.default);\n    RLottie = await promise;\n  }\n\n  return promise;\n}\n\nexport function getRLottie() {\n  return RLottie;\n}\n\nsetTimeout(ensureRLottie, LOTTIE_LOAD_DELAY);\n","import { DEBUG } from '../../config';\n\ntype Handler = (e: Event) => void;\ntype DelegationRegistry = Map<Element, Handler>;\n\nconst NON_BUBBLEABLE_EVENTS = new Set(['scroll', 'mouseenter', 'mouseleave', 'load', 'error']);\n\nconst documentEventCounters: Record<string, number> = {};\nconst delegationRegistryByEventType: Record<string, DelegationRegistry> = {};\nconst delegatedEventTypesByElement = new Map<Element, Set<string>>();\n\nexport function addEventListener(element: Element, propName: string, handler: Handler, asCapture = false) {\n  const eventType = resolveEventType(propName, element);\n  if (canUseEventDelegation(eventType, element, asCapture)) {\n    addDelegatedListener(eventType, element, handler);\n  } else {\n    element.addEventListener(eventType, handler, asCapture);\n  }\n}\n\nexport function removeEventListener(element: Element, propName: string, handler: Handler, asCapture = false) {\n  const eventType = resolveEventType(propName, element);\n  if (canUseEventDelegation(eventType, element, asCapture)) {\n    removeDelegatedListener(eventType, element);\n  } else {\n    element.removeEventListener(eventType, handler, asCapture);\n  }\n}\n\nexport function resolveEventType(propName: string, element: Element) {\n  const eventType = propName\n    .replace(/^on/, '')\n    .replace(/Capture$/, '').toLowerCase();\n\n  if (eventType === 'change' && element.tagName !== 'SELECT') {\n    // React behavior repeated here.\n    // https://stackoverflow.com/questions/38256332/in-react-whats-the-difference-between-onchange-and-oninput\n    return 'input';\n  }\n\n  if (eventType === 'doubleclick') {\n    return 'dblclick';\n  }\n\n  // Replace focus/blur by their \"bubbleable\" versions\n  if (eventType === 'focus') {\n    return 'focusin';\n  }\n\n  if (eventType === 'blur') {\n    return 'focusout';\n  }\n\n  return eventType;\n}\n\nfunction canUseEventDelegation(realEventType: string, element: Element, asCapture: boolean) {\n  return (\n    !asCapture\n    && !NON_BUBBLEABLE_EVENTS.has(realEventType)\n    && element.tagName !== 'VIDEO'\n    && element.tagName !== 'IFRAME'\n  );\n}\n\nfunction addDelegatedListener(eventType: string, element: Element, handler: Handler) {\n  if (!documentEventCounters[eventType]) {\n    documentEventCounters[eventType] = 0;\n    document.addEventListener(eventType, handleEvent);\n  }\n\n  resolveDelegationRegistry(eventType).set(element, handler);\n  resolveDelegatedEventTypes(element).add(eventType);\n  documentEventCounters[eventType]++;\n}\n\nfunction removeDelegatedListener(eventType: string, element: Element) {\n  documentEventCounters[eventType]--;\n  if (!documentEventCounters[eventType]) {\n    // Synchronous deletion on 0 will cause perf degradation in the case of 1 element\n    // which is not a real case, so it's ok to do it this way\n    document.removeEventListener(eventType, handleEvent);\n  }\n\n  delegationRegistryByEventType[eventType].delete(element);\n  delegatedEventTypesByElement.get(element)!.delete(eventType);\n}\n\nexport function removeAllDelegatedListeners(element: Element) {\n  const eventTypes = delegatedEventTypesByElement.get(element);\n  if (!eventTypes) {\n    return;\n  }\n\n  eventTypes.forEach((eventType) => removeDelegatedListener(eventType, element));\n  delegatedEventTypesByElement.delete(element);\n}\n\nfunction handleEvent(realEvent: Event) {\n  const events = delegationRegistryByEventType[realEvent.type];\n\n  if (events) {\n    let furtherCallsPrevented = false;\n    let current: Element = realEvent.target as Element;\n\n    const stopPropagation = () => {\n      furtherCallsPrevented = true;\n    };\n\n    const preventDefault = () => {\n      realEvent.preventDefault();\n    };\n\n    // Proxy is a simplest way to provide an access to the event property\n    const event = new Proxy(realEvent, {\n      get(target, p) {\n        if (p === 'currentTarget') {\n          return current;\n        }\n        if (p === 'stopPropagation' || p === 'stopImmediatePropagation') {\n          return stopPropagation;\n        }\n        if (p === 'preventDefault') {\n          // \"this\" is changed to proxy and one can't call methods via it\n          return preventDefault;\n        }\n        return Reflect.get(target, p);\n      },\n    });\n\n    // This can also be limited by teact root\n    while (current && current !== document.body) {\n      const handler = events.get(current);\n      if (handler) {\n        handler(event);\n        if (furtherCallsPrevented) {\n          return;\n        }\n      }\n\n      current = current.parentNode as Element;\n    }\n  }\n}\n\nfunction resolveDelegationRegistry(eventType: string) {\n  if (!delegationRegistryByEventType[eventType]) {\n    delegationRegistryByEventType[eventType] = new Map();\n  }\n\n  return delegationRegistryByEventType[eventType];\n}\n\nfunction resolveDelegatedEventTypes(element: Element) {\n  const existing = delegatedEventTypesByElement.get(element);\n  if (existing) {\n    return existing;\n  }\n\n  const newSet = new Set<string>();\n  delegatedEventTypesByElement.set(element, newSet);\n\n  return newSet;\n}\n\nif (DEBUG) {\n  document.addEventListener('dblclick', () => {\n    const documentListenersCount = Object.keys(documentEventCounters).length;\n    const delegatedHandlersCount1 = Object.values(documentEventCounters)\n      .reduce((acc, counter) => acc + counter, 0);\n    const delegationRegistriesCount = Object.keys(delegationRegistryByEventType).length;\n    const delegatedHandlersCount2 = Object.values(delegationRegistryByEventType)\n      .reduce((acc, delegationRegistry) => acc + delegationRegistry.size, 0);\n    const delegationElementsCount = delegatedEventTypesByElement.size;\n    const delegatedEventTypesCount = Array.from(delegatedEventTypesByElement.values())\n      .reduce((acc, eventTypes) => acc + eventTypes.size, 0);\n\n    // eslint-disable-next-line no-console\n    console.warn('DELEGATED EVENTS STATS', {\n      delegatedHandlersCount1,\n      delegatedHandlersCount2,\n      delegatedEventTypesCount,\n      delegationRegistriesCount,\n      delegationElementsCount,\n      documentListenersCount,\n    });\n  });\n}\n","import { onIdle, throttleWith } from '../../util/schedulers';\nimport { createSignal } from '../../util/signals';\nimport { requestMeasure } from '../fasterdom/fasterdom';\n\nconst AUTO_END_TIMEOUT = 1000;\n\nlet counter = 0;\nlet counterBlocking = 0;\n\nconst [getIsAnimating, setIsAnimating] = createSignal(false);\nconst [getIsBlockingAnimating, setIsBlockingAnimating] = createSignal(false);\n\nexport const getIsHeavyAnimating = getIsAnimating;\nexport { getIsBlockingAnimating };\n\nexport function beginHeavyAnimation(duration = AUTO_END_TIMEOUT, isBlocking = false) {\n  counter++;\n\n  if (counter === 1) {\n    setIsAnimating(true);\n  }\n\n  if (isBlocking) {\n    counterBlocking++;\n\n    if (counterBlocking === 1) {\n      setIsBlockingAnimating(true);\n    }\n  }\n\n  const timeout = window.setTimeout(onEnd, duration);\n\n  let hasEnded = false;\n\n  function onEnd() {\n    if (hasEnded) return;\n    hasEnded = true;\n\n    clearTimeout(timeout);\n\n    counter--;\n\n    if (counter === 0) {\n      setIsAnimating(false);\n    }\n\n    if (isBlocking) {\n      counterBlocking--;\n\n      if (counterBlocking === 0) {\n        setIsBlockingAnimating(false);\n      }\n    }\n  }\n\n  return onEnd;\n}\n\nexport function onFullyIdle(cb: NoneToVoidFunction) {\n  onIdle(() => {\n    if (getIsAnimating()) {\n      requestMeasure(() => {\n        onFullyIdle(cb);\n      });\n    } else {\n      cb();\n    }\n  });\n}\n\nexport function throttleWithFullyIdle<F extends AnyToVoidFunction>(fn: F) {\n  return throttleWith(onFullyIdle, fn);\n}\n","import type { ChangeEvent } from 'react';\n\nimport type { Signal } from '../../util/signals';\nimport type {\n  VirtualElement,\n  VirtualElementChildren,\n  VirtualElementComponent,\n  VirtualElementFragment,\n  VirtualElementParent,\n  VirtualElementReal,\n  VirtualElementTag,\n} from './teact';\n\nimport { DEBUG } from '../../config';\nimport { unique } from '../../util/iteratees';\nimport { addEventListener, removeAllDelegatedListeners, removeEventListener } from './dom-events';\nimport {\n  captureImmediateEffects,\n  hasElementChanged,\n  isParentElement,\n  mountComponent,\n  MountState,\n  renderComponent,\n  unmountComponent,\n  VirtualType,\n} from './teact';\n\ninterface VirtualDomHead {\n  children: [VirtualElement] | [];\n}\n\ninterface SelectionState {\n  selectionStart: number | null;\n  selectionEnd: number | null;\n  isCaretAtEnd: boolean;\n}\n\ntype CurrentContext = Record<string, Signal<unknown>>;\n\ntype DOMElement = HTMLElement | SVGElement;\n\nconst SVG_NAMESPACE = 'http://www.w3.org/2000/svg';\nconst HTML_NAMESPACE = 'http://www.w3.org/1999/xhtml';\n\nconst FILTERED_ATTRIBUTES = new Set(['key', 'ref', 'teactFastList', 'teactOrderKey']);\nconst HTML_ATTRIBUTES = new Set(['dir', 'role', 'form']);\nconst CONTROLLABLE_TAGS = ['INPUT', 'TEXTAREA', 'SELECT'];\nconst MAPPED_ATTRIBUTES: { [k: string]: string } = {\n  autoCapitalize: 'autocapitalize',\n  autoComplete: 'autocomplete',\n  autoCorrect: 'autocorrect',\n  autoPlay: 'autoplay',\n  spellCheck: 'spellcheck',\n};\nconst INDEX_KEY_PREFIX = '__indexKey#';\n\nconst headsByElement = new WeakMap<Element, VirtualDomHead>();\nconst extraClasses = new WeakMap<Element, Set<string>>();\nconst extraStyles = new WeakMap<Element, Record<string, string>>();\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nlet DEBUG_virtualTreeSize = 1;\n\nfunction render($element: VirtualElement | undefined, parentEl: HTMLElement) {\n  if (!headsByElement.has(parentEl)) {\n    headsByElement.set(parentEl, { children: [] });\n  }\n\n  const runImmediateEffects = captureImmediateEffects();\n  const $head = headsByElement.get(parentEl)!;\n  const $renderedChild = renderWithVirtual(parentEl, $head.children[0], $element, $head, {}, 0);\n  runImmediateEffects?.();\n\n  $head.children = $renderedChild ? [$renderedChild] : [];\n\n  if (process.env.APP_ENV === 'perf') {\n    DEBUG_virtualTreeSize = 0;\n    DEBUG_addToVirtualTreeSize($head);\n\n    return DEBUG_virtualTreeSize;\n  }\n\n  return undefined;\n}\n\nfunction renderWithVirtual<T extends VirtualElement | undefined>(\n  parentEl: DOMElement,\n  $current: VirtualElement | undefined,\n  $new: T,\n  $parent: VirtualElementParent | VirtualDomHead,\n  currentContext: CurrentContext,\n  index: number,\n  options: {\n    skipComponentUpdate?: boolean;\n    nextSibling?: ChildNode;\n    forceMoveToEnd?: boolean;\n    fragment?: DocumentFragment;\n    namespace?: string;\n  } = {},\n): T {\n  const { skipComponentUpdate, fragment } = options;\n  let { nextSibling, namespace } = options;\n\n  const isCurrentComponent = $current?.type === VirtualType.Component;\n  const isNewComponent = $new?.type === VirtualType.Component;\n  const $newAsReal = $new as VirtualElementReal;\n\n  const isCurrentFragment = !isCurrentComponent && $current?.type === VirtualType.Fragment;\n  const isNewFragment = !isNewComponent && $new?.type === VirtualType.Fragment;\n\n  if ($new?.type === VirtualType.Tag) {\n    if ($new.tag === 'svg') namespace = SVG_NAMESPACE;\n    if ($new.props.xmlns) namespace = $new.props.xmlns;\n  }\n\n  if (\n    !skipComponentUpdate\n    && isCurrentComponent && isNewComponent\n    && !hasElementChanged($current!, $new!)\n  ) {\n    $new = updateComponent($current, $new as VirtualElementComponent) as typeof $new;\n  }\n\n  // Parent element may have changed, so we need to update the listener closure.\n  if (\n    !skipComponentUpdate\n    && isNewComponent\n    && ($new as VirtualElementComponent).componentInstance.mountState === MountState.Mounted\n  ) {\n    setupComponentUpdateListener(parentEl, $new as VirtualElementComponent, $parent, currentContext, index);\n  }\n\n  if ($current === $new) {\n    return $new;\n  }\n\n  if (DEBUG && $new) {\n    const newTarget = 'target' in $new && $new.target;\n    if (newTarget && (!$current || ('target' in $current && newTarget !== $current.target))) {\n      throw new Error('[Teact] Cached virtual element was moved within tree');\n    }\n  }\n\n  if (!$current && $new) {\n    if (isNewComponent || isNewFragment) {\n      if (isNewComponent) {\n        $new = initComponent(\n          parentEl, $new as VirtualElementComponent, $parent, currentContext, index,\n        ) as unknown as typeof $new;\n        currentContext = ($new as VirtualElementComponent).componentInstance.context ?? currentContext;\n      }\n\n      mountChildren(parentEl, $new as VirtualElementComponent | VirtualElementFragment, currentContext, {\n        nextSibling, fragment, namespace,\n      });\n    } else {\n      const canSetTextContent = !fragment\n        && !nextSibling\n        && $newAsReal.type === VirtualType.Text\n        && $parent.children.length === 1\n        && !parentEl.firstChild;\n\n      if (canSetTextContent) {\n        parentEl.textContent = $newAsReal.value;\n        $newAsReal.target = parentEl.firstChild!;\n      } else {\n        const node = createNode($newAsReal, currentContext, namespace);\n        $newAsReal.target = node;\n        insertBefore(fragment || parentEl, node, nextSibling);\n\n        if ($newAsReal.type === VirtualType.Tag) {\n          setElementRef($newAsReal, node as DOMElement);\n        }\n      }\n    }\n  } else if ($current && !$new) {\n    remount(parentEl, $current, currentContext, undefined);\n  } else if ($current && $new) {\n    if (hasElementChanged($current, $new)) {\n      if (!nextSibling) {\n        nextSibling = getNextSibling($current);\n      }\n\n      if (isNewComponent || isNewFragment) {\n        if (isNewComponent) {\n          $new = initComponent(\n            parentEl, $new as VirtualElementComponent, $parent, currentContext, index,\n          ) as unknown as typeof $new;\n          currentContext = ($new as VirtualElementComponent).componentInstance.context ?? currentContext;\n        }\n\n        remount(parentEl, $current, currentContext, undefined);\n        mountChildren(parentEl, $new as VirtualElementComponent | VirtualElementFragment, currentContext, {\n          nextSibling, fragment, namespace,\n        });\n      } else {\n        const node = createNode($newAsReal, currentContext, namespace);\n        $newAsReal.target = node;\n        remount(parentEl, $current, currentContext, node, nextSibling);\n\n        if ($newAsReal.type === VirtualType.Tag) {\n          setElementRef($newAsReal, node as DOMElement);\n        }\n      }\n    } else {\n      const isComponent = isCurrentComponent && isNewComponent;\n      const isFragment = isCurrentFragment && isNewFragment;\n\n      if (isComponent || isFragment) {\n        renderChildren(\n          $current,\n          $new as VirtualElementComponent | VirtualElementFragment,\n          currentContext,\n          parentEl,\n          nextSibling,\n          options.forceMoveToEnd,\n        );\n      } else {\n        const $currentAsReal = $current as VirtualElementReal;\n        const currentTarget = $currentAsReal.target!;\n\n        $newAsReal.target = currentTarget;\n        $currentAsReal.target = undefined; // Help GC\n\n        const isTag = $current.type === VirtualType.Tag;\n        if (isTag) {\n          const $newAsTag = $new as VirtualElementTag;\n\n          setElementRef($current, undefined);\n          setElementRef($newAsTag, currentTarget as DOMElement);\n\n          if (nextSibling || options.forceMoveToEnd) {\n            insertBefore(parentEl, currentTarget, nextSibling);\n          }\n\n          updateAttributes($current, $newAsTag, currentTarget as DOMElement, namespace);\n          renderChildren(\n            $current, $newAsTag, currentContext, currentTarget as DOMElement, undefined, undefined, namespace,\n          );\n        }\n      }\n    }\n  }\n\n  return $new;\n}\n\nfunction initComponent(\n  parentEl: DOMElement,\n  $element: VirtualElementComponent,\n  $parent: VirtualElementParent | VirtualDomHead,\n  currentContext: CurrentContext,\n  index: number,\n) {\n  const { componentInstance } = $element;\n\n  $element.componentInstance.context = currentContext;\n\n  if (componentInstance.mountState === MountState.Unmounted) {\n    $element = mountComponent(componentInstance);\n    setupComponentUpdateListener(parentEl, $element, $parent, currentContext, index);\n  }\n\n  return $element;\n}\n\nfunction updateComponent($current: VirtualElementComponent, $new: VirtualElementComponent) {\n  $current.componentInstance.props = $new.componentInstance.props;\n\n  return renderComponent($current.componentInstance);\n}\n\nfunction setupComponentUpdateListener(\n  parentEl: DOMElement,\n  $element: VirtualElementComponent,\n  $parent: VirtualElementParent | VirtualDomHead,\n  currentContext: CurrentContext,\n  index: number,\n) {\n  const { componentInstance } = $element;\n\n  componentInstance.onUpdate = () => {\n    $parent.children[index] = renderWithVirtual(\n      parentEl,\n      $parent.children[index],\n      componentInstance.$element,\n      $parent,\n      currentContext,\n      index,\n      { skipComponentUpdate: true },\n    );\n  };\n}\n\nfunction mountChildren(\n  parentEl: DOMElement,\n  $element: VirtualElementComponent | VirtualElementFragment,\n  currentContext: CurrentContext,\n  options: {\n    nextSibling?: ChildNode;\n    fragment?: DocumentFragment;\n    namespace?: string;\n  },\n) {\n  const { children } = $element;\n  for (let i = 0, l = children.length; i < l; i++) {\n    const $child = children[i];\n    const $renderedChild = renderWithVirtual(parentEl, undefined, $child, $element, currentContext, i, options);\n    if ($renderedChild !== $child) {\n      children[i] = $renderedChild;\n    }\n  }\n}\n\nfunction unmountChildren(\n  parentEl: DOMElement, $element: VirtualElementComponent | VirtualElementFragment, currentContext: CurrentContext,\n) {\n  for (const $child of $element.children) {\n    renderWithVirtual(parentEl, $child, undefined, $element, currentContext, -1);\n  }\n}\n\nfunction createNode($element: VirtualElementReal, currentContext: CurrentContext, namespace = HTML_NAMESPACE): Node {\n  if ($element.type === VirtualType.Empty) {\n    return document.createTextNode('');\n  }\n\n  if ($element.type === VirtualType.Text) {\n    return document.createTextNode($element.value);\n  }\n\n  const { tag, props, children } = $element;\n  const element = document.createElementNS(namespace, tag) as DOMElement;\n\n  processControlled(tag, props);\n\n  // eslint-disable-next-line no-restricted-syntax\n  for (const key in props) {\n    if (!props.hasOwnProperty(key)) continue;\n\n    if (props[key] !== undefined) {\n      setAttribute(element, key, props[key], namespace);\n    }\n  }\n\n  processUncontrolledOnMount(element, props);\n\n  for (let i = 0, l = children.length; i < l; i++) {\n    const $child = children[i];\n    const $renderedChild = renderWithVirtual(element, undefined, $child, $element, currentContext, i, { namespace });\n    if ($renderedChild !== $child) {\n      children[i] = $renderedChild;\n    }\n  }\n\n  return element;\n}\n\nfunction remount(\n  parentEl: DOMElement,\n  $current: VirtualElement,\n  currentContext: CurrentContext,\n  node: Node | undefined,\n  componentNextSibling?: ChildNode,\n) {\n  const isComponent = $current.type === VirtualType.Component;\n  const isFragment = !isComponent && $current.type === VirtualType.Fragment;\n\n  if (isComponent || isFragment) {\n    if (isComponent) {\n      unmountComponent($current.componentInstance);\n    }\n\n    unmountChildren(parentEl, $current, currentContext);\n\n    if (node) {\n      insertBefore(parentEl, node, componentNextSibling);\n    }\n  } else {\n    if (node) {\n      parentEl.replaceChild(node, $current.target!);\n    } else {\n      parentEl.removeChild($current.target!);\n    }\n\n    unmountRealTree($current);\n  }\n}\n\nfunction unmountRealTree($element: VirtualElement) {\n  if ($element.type === VirtualType.Component) {\n    unmountComponent($element.componentInstance);\n  } else if ($element.type !== VirtualType.Fragment) {\n    if ($element.type === VirtualType.Tag) {\n      extraClasses.delete($element.target!);\n      setElementRef($element, undefined);\n      removeAllDelegatedListeners($element.target!);\n    }\n\n    $element.target = undefined; // Help GC\n\n    if ($element.type !== VirtualType.Tag) {\n      return;\n    }\n  }\n\n  for (const $child of $element.children) {\n    unmountRealTree($child);\n  }\n}\n\nfunction insertBefore(parentEl: DOMElement | DocumentFragment, node: Node, nextSibling?: ChildNode) {\n  if (nextSibling) {\n    parentEl.insertBefore(node, nextSibling);\n  } else {\n    parentEl.appendChild(node);\n  }\n}\n\nfunction getNextSibling($current: VirtualElement): ChildNode | undefined {\n  if ($current.type === VirtualType.Component || $current.type === VirtualType.Fragment) {\n    const lastChild = $current.children[$current.children.length - 1];\n    return getNextSibling(lastChild);\n  }\n\n  return $current.target!.nextSibling || undefined;\n}\n\nfunction renderChildren(\n  $current: VirtualElementParent,\n  $new: VirtualElementParent,\n  currentContext: CurrentContext,\n  currentEl: DOMElement,\n  nextSibling?: ChildNode,\n  forceMoveToEnd = false,\n  namespace?: string,\n) {\n  if (DEBUG) {\n    DEBUG_checkKeyUniqueness($new.children);\n  }\n\n  if (('props' in $new) && $new.props.teactFastList) {\n    renderFastListChildren($current, $new, currentContext, currentEl);\n    return;\n  }\n\n  const currentChildren = $current.children;\n  const newChildren = $new.children;\n\n  const currentChildrenLength = currentChildren.length;\n  const newChildrenLength = newChildren.length;\n  const maxLength = Math.max(currentChildrenLength, newChildrenLength);\n\n  const fragment = newChildrenLength > currentChildrenLength ? document.createDocumentFragment() : undefined;\n  const lastCurrentChild = $current.children[currentChildrenLength - 1];\n  const fragmentNextSibling = fragment && (\n    nextSibling || (lastCurrentChild ? getNextSibling(lastCurrentChild) : undefined)\n  );\n\n  for (let i = 0; i < maxLength; i++) {\n    const $renderedChild = renderWithVirtual(\n      currentEl,\n      currentChildren[i],\n      newChildren[i],\n      $new,\n      currentContext,\n      i,\n      i >= currentChildrenLength ? { fragment, namespace } : { nextSibling, forceMoveToEnd, namespace },\n    );\n\n    if ($renderedChild && $renderedChild !== newChildren[i]) {\n      newChildren[i] = $renderedChild;\n    }\n  }\n\n  if (fragment) {\n    insertBefore(currentEl, fragment, fragmentNextSibling);\n  }\n}\n\n// This function allows to prepend/append a bunch of new DOM nodes to the top/bottom of preserved ones.\n// It also allows to selectively move particular preserved nodes within their DOM list.\nfunction renderFastListChildren(\n  $current: VirtualElementParent, $new: VirtualElementParent, currentContext: CurrentContext, currentEl: DOMElement,\n) {\n  const currentChildren = $current.children;\n  const newChildren = $new.children;\n\n  const newKeys = new Set();\n  for (const $newChild of newChildren) {\n    const key = 'props' in $newChild ? $newChild.props.key : undefined;\n\n    if (DEBUG && isParentElement($newChild)) {\n      // eslint-disable-next-line no-null/no-null\n      if (key === undefined || key === null) {\n        // eslint-disable-next-line no-console\n        console.warn('Missing `key` in `teactFastList`');\n      }\n\n      if ($newChild.type === VirtualType.Fragment) {\n        throw new Error('[Teact] Fragment can not be child of container with `teactFastList`');\n      }\n    }\n\n    newKeys.add(key);\n  }\n\n  // Build a collection of old children that also remain in the new list\n  let currentRemainingIndex = 0;\n  const remainingByKey: Record<string, { $element: VirtualElement; index: number; orderKey?: number }> = {};\n  for (let i = 0, l = currentChildren.length; i < l; i++) {\n    const $currentChild = currentChildren[i];\n\n    let key = 'props' in $currentChild ? $currentChild.props.key : undefined;\n    // eslint-disable-next-line no-null/no-null\n    const isKeyPresent = key !== undefined && key !== null;\n\n    // First we process removed children\n    if (isKeyPresent && !newKeys.has(key)) {\n      renderWithVirtual(currentEl, $currentChild, undefined, $new, currentContext, -1);\n\n      continue;\n    } else if (!isKeyPresent) {\n      const $newChild = newChildren[i];\n      const newChildKey = ($newChild && 'props' in $newChild) ? $newChild.props.key : undefined;\n      // If a non-key element remains at the same index we preserve it with a virtual `key`\n      if ($newChild && !newChildKey) {\n        key = `${INDEX_KEY_PREFIX}${i}`;\n        // Otherwise, we just remove it\n      } else {\n        renderWithVirtual(currentEl, $currentChild, undefined, $new, currentContext, -1);\n\n        continue;\n      }\n    }\n\n    // Then we build up info about remaining children\n    remainingByKey[key] = {\n      $element: $currentChild,\n      index: currentRemainingIndex++,\n      orderKey: 'props' in $currentChild ? $currentChild.props.teactOrderKey : undefined,\n    };\n  }\n\n  let fragmentIndex: number | undefined;\n  let fragmentSize: number | undefined;\n\n  let currentPreservedIndex = 0;\n\n  for (let i = 0, l = newChildren.length; i < l; i++) {\n    const $newChild = newChildren[i];\n    const key = 'props' in $newChild ? $newChild.props.key : `${INDEX_KEY_PREFIX}${i}`;\n    const currentChildInfo = remainingByKey[key];\n\n    if (!currentChildInfo) {\n      if (fragmentSize === undefined) {\n        fragmentIndex = i;\n        fragmentSize = 0;\n      }\n\n      fragmentSize++;\n      continue;\n    }\n\n    // This prepends new children to the top\n    if (fragmentSize) {\n      renderFragment(fragmentIndex!, fragmentSize, currentEl, $new, currentContext);\n      fragmentSize = undefined;\n      fragmentIndex = undefined;\n    }\n\n    // Now we check if a preserved node was moved within preserved list\n    const newOrderKey = 'props' in $newChild ? $newChild.props.teactOrderKey : undefined;\n    // That is indicated by a changed `teactOrderKey` value\n    const shouldMoveNode = (\n      currentChildInfo.index !== currentPreservedIndex && (!newOrderKey || currentChildInfo.orderKey !== newOrderKey)\n    );\n    const isMovingDown = shouldMoveNode && currentPreservedIndex > currentChildInfo.index;\n\n    if (!shouldMoveNode || isMovingDown) {\n      currentPreservedIndex++;\n    }\n\n    const nextSibling = currentEl.childNodes[isMovingDown ? i + 1 : i];\n    const options = shouldMoveNode ? (nextSibling ? { nextSibling } : { forceMoveToEnd: true }) : undefined;\n\n    const $renderedChild = renderWithVirtual(\n      currentEl, currentChildInfo.$element, $newChild, $new, currentContext, i, options,\n    );\n    if ($renderedChild !== $newChild) {\n      newChildren[i] = $renderedChild;\n    }\n  }\n\n  // This appends new children to the bottom\n  if (fragmentSize) {\n    renderFragment(fragmentIndex!, fragmentSize, currentEl, $new, currentContext);\n  }\n}\n\nfunction renderFragment(\n  fragmentIndex: number,\n  fragmentSize: number,\n  parentEl: DOMElement,\n  $parent: VirtualElementParent,\n  currentContext: CurrentContext,\n) {\n  const nextSibling = parentEl.childNodes[fragmentIndex];\n\n  if (fragmentSize === 1) {\n    const $child = $parent.children[fragmentIndex];\n    const $renderedChild = renderWithVirtual(\n      parentEl, undefined, $child, $parent, currentContext, fragmentIndex, { nextSibling },\n    );\n    if ($renderedChild !== $child) {\n      $parent.children[fragmentIndex] = $renderedChild;\n    }\n\n    return;\n  }\n\n  const fragment = document.createDocumentFragment();\n\n  for (let i = fragmentIndex; i < fragmentIndex + fragmentSize; i++) {\n    const $child = $parent.children[i];\n    const $renderedChild = renderWithVirtual(parentEl, undefined, $child, $parent, currentContext, i, { fragment });\n    if ($renderedChild !== $child) {\n      $parent.children[i] = $renderedChild;\n    }\n  }\n\n  insertBefore(parentEl, fragment, nextSibling);\n}\n\nfunction setElementRef($element: VirtualElementTag, element: DOMElement | undefined) {\n  const { ref } = $element.props;\n\n  if (typeof ref === 'object') {\n    ref.current = element;\n    ref.onChange?.();\n  } else if (typeof ref === 'function') {\n    ref(element);\n  }\n}\n\nfunction processControlled(tag: string, props: AnyLiteral) {\n  // TODO Remove after tests\n  if (!props.teactExperimentControlled) {\n    return;\n  }\n\n  const isValueControlled = props.value !== undefined;\n  const isCheckedControlled = props.checked !== undefined;\n  const isControlled = (isValueControlled || isCheckedControlled) && CONTROLLABLE_TAGS.includes(tag.toUpperCase());\n  if (!isControlled) {\n    return;\n  }\n\n  const {\n    value, checked, onInput, onChange,\n  } = props;\n\n  props.onChange = undefined;\n  props.onInput = (e: ChangeEvent<HTMLInputElement>) => {\n    onInput?.(e);\n    onChange?.(e);\n\n    if (value !== undefined && value !== e.currentTarget.value) {\n      const { selectionStart, selectionEnd } = e.currentTarget;\n      const isCaretAtEnd = selectionStart === selectionEnd && selectionEnd === e.currentTarget.value.length;\n\n      e.currentTarget.value = value;\n\n      if (typeof selectionStart === 'number' && typeof selectionEnd === 'number') {\n        e.currentTarget.setSelectionRange(selectionStart, selectionEnd);\n\n        const selectionState: SelectionState = { selectionStart, selectionEnd, isCaretAtEnd };\n        // eslint-disable-next-line no-underscore-dangle\n        e.currentTarget.dataset.__teactSelectionState = JSON.stringify(selectionState);\n      }\n    }\n\n    if (checked !== undefined) {\n      e.currentTarget.checked = checked;\n    }\n  };\n}\n\nfunction processUncontrolledOnMount(element: DOMElement, props: AnyLiteral) {\n  if (!CONTROLLABLE_TAGS.includes(element.tagName)) {\n    return;\n  }\n\n  if (props.defaultValue) {\n    setAttribute(element, 'value', props.defaultValue);\n  }\n\n  if (props.defaultChecked) {\n    setAttribute(element, 'checked', props.defaultChecked);\n  }\n}\n\nfunction updateAttributes(\n  $current: VirtualElementTag, $new: VirtualElementTag, element: DOMElement, namespace?: string,\n) {\n  processControlled(element.tagName, $new.props);\n\n  const currentEntries = Object.entries($current.props);\n  const newEntries = Object.entries($new.props);\n\n  for (const [key, currentValue] of currentEntries) {\n    const newValue = $new.props[key];\n\n    if (\n      currentValue !== undefined\n      && (\n        newValue === undefined\n        || (currentValue !== newValue && key.startsWith('on'))\n      )\n    ) {\n      removeAttribute(element, key, currentValue);\n    }\n  }\n\n  for (const [key, newValue] of newEntries) {\n    const currentValue = $current.props[key];\n\n    if (newValue !== undefined && newValue !== currentValue) {\n      setAttribute(element, key, newValue, namespace);\n    }\n  }\n}\n\nfunction setAttribute(element: DOMElement, key: string, value: any, namespace?: string) {\n  if (key === 'className') {\n    updateClassName(element, value, namespace);\n  } else if (key === 'value') {\n    const inputEl = element as HTMLInputElement;\n\n    if (inputEl.value !== value) {\n      inputEl.value = value;\n\n      // eslint-disable-next-line no-underscore-dangle\n      const selectionStateJson = inputEl.dataset.__teactSelectionState;\n      if (selectionStateJson) {\n        const { selectionStart, selectionEnd, isCaretAtEnd } = JSON.parse(selectionStateJson) as SelectionState;\n\n        if (isCaretAtEnd) {\n          const length = inputEl.value.length;\n          inputEl.setSelectionRange(length, length);\n        } else if (typeof selectionStart === 'number' && typeof selectionEnd === 'number') {\n          inputEl.setSelectionRange(selectionStart, selectionEnd);\n        }\n      }\n    }\n  } else if (key === 'style') {\n    updateStyle(element, value);\n  } else if (key === 'dangerouslySetInnerHTML') {\n    // eslint-disable-next-line no-underscore-dangle\n    element.innerHTML = value.__html;\n  } else if (key.startsWith('on')) {\n    addEventListener(element, key, value, key.endsWith('Capture'));\n  } else if (\n    namespace === SVG_NAMESPACE || key.startsWith('data-') || key.startsWith('aria-') || HTML_ATTRIBUTES.has(key)\n  ) {\n    element.setAttribute(key, value);\n  } else if (!FILTERED_ATTRIBUTES.has(key)) {\n    (element as any)[MAPPED_ATTRIBUTES[key] || key] = value;\n  }\n}\n\nfunction removeAttribute(element: DOMElement, key: string, value: any) {\n  if (key === 'className') {\n    updateClassName(element, '');\n  } else if (key === 'value') {\n    (element as HTMLInputElement).value = '';\n  } else if (key === 'style') {\n    updateStyle(element, '');\n  } else if (key === 'dangerouslySetInnerHTML') {\n    element.innerHTML = '';\n  } else if (key.startsWith('on')) {\n    removeEventListener(element, key, value, key.endsWith('Capture'));\n  } else if (!FILTERED_ATTRIBUTES.has(key)) {\n    element.removeAttribute(key);\n  }\n}\n\nfunction updateClassName(element: DOMElement, value: string, namespace?: string) {\n  if (namespace === SVG_NAMESPACE) {\n    element.setAttribute('class', value);\n    return;\n  }\n\n  const htmlElement = element as HTMLElement;\n  const extra = extraClasses.get(element);\n  if (!extra) {\n    htmlElement.className = value;\n    return;\n  }\n\n  const extraArray = Array.from(extra);\n  if (value) {\n    extraArray.push(value);\n  }\n\n  htmlElement.className = extraArray.join(' ');\n}\n\nfunction updateStyle(element: DOMElement, value: string) {\n  element.style.cssText = value;\n\n  const extraObject = extraStyles.get(element);\n  if (extraObject) {\n    applyExtraStyles(element);\n  }\n}\n\nexport function addExtraClass(element: DOMElement, className: string) {\n  element.classList.add(className);\n\n  const classList = extraClasses.get(element);\n  if (classList) {\n    classList.add(className);\n  } else {\n    extraClasses.set(element, new Set([className]));\n  }\n}\n\nexport function removeExtraClass(element: DOMElement, className: string) {\n  element.classList.remove(className);\n\n  const classList = extraClasses.get(element);\n  if (classList) {\n    classList.delete(className);\n\n    if (!classList.size) {\n      extraClasses.delete(element);\n    }\n  }\n}\n\nexport function toggleExtraClass(element: DOMElement, className: string, force?: boolean) {\n  if (force === true) {\n    addExtraClass(element, className);\n  } else if (force === false) {\n    removeExtraClass(element, className);\n  } else if (extraClasses.get(element)?.has(className)) {\n    removeExtraClass(element, className);\n  } else {\n    addExtraClass(element, className);\n  }\n}\n\nexport function setExtraStyles(element: DOMElement, styles: Partial<CSSStyleDeclaration> & AnyLiteral) {\n  extraStyles.set(element, styles);\n  applyExtraStyles(element);\n}\n\nfunction applyExtraStyles(element: DOMElement) {\n  const standardStyles = Object.entries(extraStyles.get(element)!).reduce<Record<string, string>>(\n    (acc, [prop, value]) => {\n      if (prop.startsWith('--')) {\n        element.style.setProperty(prop, value);\n      } else {\n        acc[prop] = value;\n      }\n\n      return acc;\n    },\n    {},\n  );\n\n  Object.assign(element.style, standardStyles);\n}\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nfunction DEBUG_addToVirtualTreeSize($current: VirtualElementParent | VirtualDomHead) {\n  DEBUG_virtualTreeSize += $current.children.length;\n\n  $current.children.forEach(($child) => {\n    if (isParentElement($child)) {\n      DEBUG_addToVirtualTreeSize($child);\n    }\n  });\n}\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nfunction DEBUG_checkKeyUniqueness(children: VirtualElementChildren) {\n  const firstChild = children[0];\n  if (firstChild && 'props' in firstChild && firstChild.props.key !== undefined) {\n    const keys = children.reduce((acc: any[], child) => {\n      if ('props' in child && child.props.key) {\n        acc.push(child.props.key);\n      }\n\n      return acc;\n    }, []);\n\n    if (keys.length !== unique(keys).length) {\n      // eslint-disable-next-line no-console\n      console.warn('[Teact] Duplicated keys:', keys.filter((e, i, a) => a.indexOf(e) !== i), children);\n      throw new Error('[Teact] Children keys are not unique');\n    }\n  }\n}\n\nconst TeactDOM = { render };\nexport default TeactDOM;\n","import { throttle } from './schedulers';\n\nconst KEYS_TO_IGNORE = new Set([\n  'TeactMemoWrapper renders',\n  'TeactNContainer renders',\n  'Button renders',\n]);\nconst MIN_RENDERS_TO_SHOW = 5;\nconst MIN_DURATION_TO_SHOW = 2;\nconst BG_GREEN = ' style=\"background: lightgreen\"';\n\nlet counters: Record<string, {\n  value: number;\n  lastUpdateAt: number;\n}> = {};\n\nconst renderCountersThrottled = throttle(renderCounters, 500, false);\n\nlet loggerEl: HTMLDivElement;\n\nexport function debugToOverlay(text: string) {\n  if (!loggerEl) {\n    setupOverlay();\n  }\n\n  const date = new Date();\n  const dateFormatted = `${date.toLocaleTimeString()}.${date.getMilliseconds()}`;\n  const wasAtBottom = loggerEl.scrollTop + 10 >= loggerEl.scrollHeight - loggerEl.offsetHeight;\n\n  loggerEl.innerHTML += `${dateFormatted}: ${text}<br/>`;\n\n  if (wasAtBottom) {\n    loggerEl.scrollTop = loggerEl.scrollHeight;\n  }\n}\n\nexport function incrementOverlayCounter(key: string, value = 1) {\n  const now = Date.now();\n  if (!counters[key]) {\n    counters[key] = { value, lastUpdateAt: now };\n  } else {\n    counters[key].value += value;\n    counters[key].lastUpdateAt = now;\n  }\n\n  renderCountersThrottled();\n}\n\nexport function renderCounters() {\n  if (!loggerEl) {\n    setupOverlay();\n  }\n\n  const halfSecondAgo = Date.now() - 500;\n  const [maxRenders, maxDuration] = Object.entries(counters).reduce((acc, [key, { value }]) => {\n    if (KEYS_TO_IGNORE.has(key)) {\n      return acc;\n    }\n\n    if (key.includes('renders') && value > acc[0]) {\n      acc[0] = value;\n    }\n\n    if (key.includes('duration') && value > acc[1]) {\n      acc[1] = value;\n    }\n\n    return acc;\n  }, [0, 0]);\n\n  loggerEl.innerHTML = Object\n    .entries(counters)\n    .filter(([key, { value }]) => (\n      (!KEYS_TO_IGNORE.has(key)) && (\n        (key.includes('renders') && value > MIN_RENDERS_TO_SHOW)\n        || (key.includes('duration') && value > MIN_DURATION_TO_SHOW)\n      )\n    ))\n    .sort((a, b) => (\n      b[1].lastUpdateAt - a[1].lastUpdateAt\n    ))\n    .map(([key, { value, lastUpdateAt }]) => ([\n      `<div style=\"background: #ff0000${factorToHex(value / (key.includes('renders') ? maxRenders : maxDuration))}\">`,\n      `  <span${lastUpdateAt > halfSecondAgo ? BG_GREEN : ''}>${key}: ${Math.round(value)}</span>`,\n      '</div>',\n    ].join('\\n')))\n    .join('\\n');\n}\n\nfunction setupOverlay() {\n  loggerEl = document.createElement('div');\n  loggerEl.style.cssText = 'position: absolute; left: 0; bottom: 25px; z-index: 9998; width: 260px; height: 200px;'\n    + ' border: 1px solid #555; background: rgba(255, 255, 255, 0.9); overflow: auto; font-size: 10px;';\n  document.body.appendChild(loggerEl);\n\n  const clearEl = document.createElement('a');\n  clearEl.style.cssText = 'position: absolute; left: 222px; bottom: 198px; z-index: 9999; font-size: 20px; '\n    + 'cursor: pointer;';\n  clearEl.innerText = '🔄';\n  clearEl.addEventListener('click', () => {\n    counters = {};\n    renderCountersThrottled();\n  });\n  document.body.appendChild(clearEl);\n}\n\nfunction factorToHex(factor: number) {\n  return Math.round(255 * factor).toString(16).padStart(2, '0');\n}\n","import type { ReactElement } from 'react';\n\nimport { DEBUG, DEBUG_MORE } from '../../config';\nimport { logUnequalProps } from '../../util/arePropsShallowEqual';\nimport { incrementOverlayCounter } from '../../util/debugOverlay';\nimport { orderBy } from '../../util/iteratees';\nimport safeExec from '../../util/safeExec';\nimport { throttleWith } from '../../util/schedulers';\nimport { createSignal, isSignal, type Signal } from '../../util/signals';\nimport { requestMeasure, requestMutation } from '../fasterdom/fasterdom';\nimport { getIsBlockingAnimating } from './heavyAnimation';\n\nexport { getIsHeavyAnimating, beginHeavyAnimation, onFullyIdle } from './heavyAnimation';\n\nexport type Props = AnyLiteral;\nexport type FC<P extends Props = any> = (props: P) => any;\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport type FC_withDebug =\n  FC\n  & { DEBUG_contentComponentName?: string };\n\nexport enum VirtualType {\n  Empty,\n  Text,\n  Tag,\n  Component,\n  Fragment,\n}\n\ninterface VirtualElementEmpty {\n  type: VirtualType.Empty;\n  target?: Node;\n}\n\ninterface VirtualElementText {\n  type: VirtualType.Text;\n  target?: Node;\n  value: string;\n}\n\nexport interface VirtualElementTag {\n  type: VirtualType.Tag;\n  target?: HTMLElement | SVGElement;\n  tag: string;\n  props: Props;\n  children: VirtualElementChildren;\n}\n\nexport interface VirtualElementComponent {\n  type: VirtualType.Component;\n  componentInstance: ComponentInstance;\n  props: Props;\n  children: VirtualElementChildren;\n}\n\nexport interface VirtualElementFragment {\n  type: VirtualType.Fragment;\n  children: VirtualElementChildren;\n}\n\nexport type StateHookSetter<T> = (newValue: ((current: T) => T) | T) => void;\n\nexport interface RefObject<T = any> {\n  current: T;\n  onChange?: NoneToVoidFunction;\n}\n\nexport enum MountState {\n  Mounting,\n  Mounted,\n  Unmounted,\n}\n\ninterface ComponentInstance {\n  id: number;\n  $element: VirtualElementComponent;\n  Component: FC;\n  name: string;\n  props: Props;\n  renderedValue?: any;\n  mountState: MountState;\n  context?: Record<string, Signal<unknown>>;\n  hooks?: {\n    state?: {\n      cursor: number;\n      byCursor: {\n        value: any;\n        nextValue: any;\n        setter: StateHookSetter<any>;\n      }[];\n    };\n    effects?: {\n      cursor: number;\n      byCursor: {\n        dependencies?: readonly any[];\n        schedule?: NoneToVoidFunction;\n        cleanup?: NoneToVoidFunction;\n        releaseSignals?: NoneToVoidFunction;\n      }[];\n    };\n    memos?: {\n      cursor: number;\n      byCursor: {\n        value: any;\n        dependencies: any[];\n      }[];\n    };\n    refs?: {\n      cursor: number;\n      byCursor: RefObject[];\n    };\n  };\n  prepareForFrame?: () => void;\n  forceUpdate?: () => void;\n  onUpdate?: () => void;\n}\n\nexport type VirtualElement =\n  VirtualElementEmpty\n  | VirtualElementText\n  | VirtualElementTag\n  | VirtualElementComponent\n  | VirtualElementFragment;\nexport type VirtualElementParent =\n  VirtualElementTag\n  | VirtualElementComponent\n  | VirtualElementFragment;\nexport type VirtualElementChildren = VirtualElement[];\nexport type VirtualElementReal = Exclude<VirtualElement, VirtualElementComponent | VirtualElementFragment>;\n\n// Compatibility with JSX types\nexport type TeactNode =\n  ReactElement\n  | string\n  | number\n  | boolean\n  | TeactNode[];\n\ntype Effect = () => (NoneToVoidFunction | void);\ntype EffectCleanup = NoneToVoidFunction;\n\nexport type Context<T> = {\n  defaultValue?: T;\n  contextId: string;\n  Provider: FC<{ value: T; children: TeactNode }>;\n};\n\nconst Fragment = Symbol('Fragment');\n\nconst DEBUG_RENDER_THRESHOLD = 7;\nconst DEBUG_EFFECT_THRESHOLD = 7;\nconst DEBUG_SILENT_RENDERS_FOR = new Set(['TeactMemoWrapper', 'TeactNContainer', 'Button', 'ListItem', 'MenuItem']);\n\nlet contextCounter = 0;\n\nlet lastComponentId = 0;\nlet renderingInstance: ComponentInstance;\n\nexport function isParentElement($element: VirtualElement): $element is VirtualElementParent {\n  return (\n    $element.type === VirtualType.Tag\n    || $element.type === VirtualType.Component\n    || $element.type === VirtualType.Fragment\n  );\n}\n\nfunction createElement(\n  source: string | FC | typeof Fragment,\n  props: Props,\n  ...children: any[]\n): VirtualElementParent | VirtualElementChildren {\n  if (source === Fragment) {\n    return buildFragmentElement(children);\n  } else if (typeof source === 'function') {\n    return createComponentInstance(source, props || {}, children);\n  } else {\n    return buildTagElement(source, props || {}, children);\n  }\n}\n\nfunction buildFragmentElement(children: any[]): VirtualElementFragment {\n  return {\n    type: VirtualType.Fragment,\n    children: buildChildren(children, true),\n  };\n}\n\nfunction createComponentInstance(Component: FC, props: Props, children: any[]): VirtualElementComponent {\n  if (children?.length) {\n    props.children = children.length === 1 ? children[0] : children;\n  }\n\n  const componentInstance: ComponentInstance = {\n    id: -1,\n    $element: undefined as unknown as VirtualElementComponent,\n    Component,\n    name: Component.name,\n    props,\n    mountState: MountState.Unmounted,\n  };\n\n  componentInstance.$element = buildComponentElement(componentInstance);\n\n  return componentInstance.$element;\n}\n\nfunction buildComponentElement(\n  componentInstance: ComponentInstance,\n  children?: VirtualElementChildren,\n): VirtualElementComponent {\n  return {\n    type: VirtualType.Component,\n    componentInstance,\n    props: componentInstance.props,\n    children: children ? buildChildren(children, true) : [],\n  };\n}\n\nfunction buildTagElement(tag: string, props: Props, children: any[]): VirtualElementTag {\n  return {\n    type: VirtualType.Tag,\n    tag,\n    props,\n    children: buildChildren(children),\n  };\n}\n\nfunction buildChildren(children: any[], noEmpty = false): VirtualElement[] {\n  const cleanChildren = dropEmptyTail(children, noEmpty);\n  const newChildren = [];\n\n  for (let i = 0, l = cleanChildren.length; i < l; i++) {\n    const child = cleanChildren[i];\n    if (Array.isArray(child)) {\n      newChildren.push(...buildChildren(child, noEmpty));\n    } else {\n      newChildren.push(buildChildElement(child));\n    }\n  }\n\n  return newChildren;\n}\n\n// We only need placeholders in the middle of collection (to ensure other elements order).\nfunction dropEmptyTail(children: any[], noEmpty = false) {\n  let i = children.length - 1;\n\n  for (; i >= 0; i--) {\n    if (!isEmptyPlaceholder(children[i])) {\n      break;\n    }\n  }\n\n  if (i === children.length - 1) {\n    return children;\n  }\n\n  if (i === -1 && noEmpty) {\n    return children.slice(0, 1);\n  }\n\n  return children.slice(0, i + 1);\n}\n\nfunction isEmptyPlaceholder(child: any) {\n  return !child && child !== 0;\n}\n\nfunction buildChildElement(child: any): VirtualElement {\n  if (isEmptyPlaceholder(child)) {\n    return { type: VirtualType.Empty };\n  } else if (isParentElement(child)) {\n    return child;\n  } else {\n    return {\n      type: VirtualType.Text,\n      value: String(child),\n    };\n  }\n}\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nconst DEBUG_components: AnyLiteral = { TOTAL: { name: 'TOTAL', renders: 0 } };\n// eslint-disable-next-line @typescript-eslint/naming-convention\nconst DEBUG_memos: Record<string, { key: string; calls: number; misses: number; hitRate: number }> = {};\nconst DEBUG_MEMOS_CALLS_THRESHOLD = 20;\n\ndocument.addEventListener('dblclick', () => {\n  // eslint-disable-next-line no-console\n  console.warn('COMPONENTS', orderBy(\n    Object\n      .values(DEBUG_components)\n      .map(({ avgRenderTime, ...state }) => {\n        return { ...state, ...(avgRenderTime !== undefined && { avgRenderTime: Number(avgRenderTime.toFixed(2)) }) };\n      }),\n    'renders',\n    'desc',\n  ));\n\n  // eslint-disable-next-line no-console\n  console.warn('MEMOS', orderBy(\n    Object\n      .values(DEBUG_memos)\n      .filter(({ calls }) => calls >= DEBUG_MEMOS_CALLS_THRESHOLD)\n      .map((state) => ({ ...state, hitRate: Number(state.hitRate.toFixed(2)) })),\n    'hitRate',\n    'asc',\n  ));\n});\n\nlet instancesPendingUpdate = new Set<ComponentInstance>();\nlet idsToExcludeFromUpdate = new Set<number>();\nlet pendingEffects = new Map<string, Effect>();\nlet pendingCleanups = new Map<string, EffectCleanup>();\nlet pendingLayoutEffects = new Map<string, Effect>();\nlet pendingLayoutCleanups = new Map<string, EffectCleanup>();\nlet areImmediateEffectsCaptured = false;\n\n/*\n  Order:\n  - component effect cleanups\n  - component effects\n  - measure tasks\n  - mutation tasks\n  - component updates\n  - component layout effect cleanups\n  - component layout effects\n  - forced layout measure tasks\n  - forced layout mutation tasks\n */\n\nconst runUpdatePassOnRaf = throttleWith(requestMeasure, () => {\n  if (getIsBlockingAnimating()) {\n    getIsBlockingAnimating.once(runUpdatePassOnRaf);\n    return;\n  }\n\n  const runImmediateEffects = captureImmediateEffects();\n\n  idsToExcludeFromUpdate = new Set();\n  const instancesToUpdate = Array\n    .from(instancesPendingUpdate)\n    .sort((a, b) => a.id - b.id);\n  instancesPendingUpdate = new Set();\n\n  const currentCleanups = pendingCleanups;\n  pendingCleanups = new Map();\n  currentCleanups.forEach((cb) => cb());\n\n  const currentEffects = pendingEffects;\n  pendingEffects = new Map();\n  currentEffects.forEach((cb) => cb());\n\n  requestMutation(() => {\n    instancesToUpdate.forEach(prepareComponentForFrame);\n    instancesToUpdate.forEach((instance) => {\n      if (idsToExcludeFromUpdate!.has(instance.id)) {\n        return;\n      }\n\n      forceUpdateComponent(instance);\n    });\n\n    runImmediateEffects?.();\n  });\n});\n\nexport function captureImmediateEffects() {\n  if (areImmediateEffectsCaptured) {\n    return undefined;\n  }\n\n  areImmediateEffectsCaptured = true;\n  return runCapturedImmediateEffects;\n}\n\nfunction runCapturedImmediateEffects() {\n  const currentLayoutCleanups = pendingLayoutCleanups;\n  pendingLayoutCleanups = new Map();\n  currentLayoutCleanups.forEach((cb) => cb());\n\n  const currentLayoutEffects = pendingLayoutEffects;\n  pendingLayoutEffects = new Map();\n  currentLayoutEffects.forEach((cb) => cb());\n\n  areImmediateEffectsCaptured = false;\n}\n\nexport function renderComponent(componentInstance: ComponentInstance) {\n  idsToExcludeFromUpdate.add(componentInstance.id);\n\n  const { Component, props } = componentInstance;\n  let newRenderedValue: any;\n\n  safeExec(() => {\n    renderingInstance = componentInstance;\n    if (componentInstance.hooks) {\n      if (componentInstance.hooks.state) {\n        componentInstance.hooks.state.cursor = 0;\n      }\n      if (componentInstance.hooks.effects) {\n        componentInstance.hooks.effects.cursor = 0;\n      }\n      if (componentInstance.hooks.memos) {\n        componentInstance.hooks.memos.cursor = 0;\n      }\n      if (componentInstance.hooks.refs) {\n        componentInstance.hooks.refs.cursor = 0;\n      }\n    }\n\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    let DEBUG_startAt: number | undefined;\n    if (DEBUG) {\n      const componentName = DEBUG_resolveComponentName(Component);\n      if (!DEBUG_components[componentName]) {\n        DEBUG_components[componentName] = {\n          name: componentName,\n          renders: 0,\n          avgRenderTime: 0,\n        };\n      }\n\n      if (DEBUG_MORE) {\n        if (!DEBUG_SILENT_RENDERS_FOR.has(componentName)) {\n          // eslint-disable-next-line no-console\n          console.log(`[Teact] Render ${componentName}`);\n        }\n      }\n\n      DEBUG_startAt = performance.now();\n    }\n\n    newRenderedValue = Component(props);\n\n    if (DEBUG) {\n      const duration = performance.now() - DEBUG_startAt!;\n      const componentName = DEBUG_resolveComponentName(Component);\n      if (duration > DEBUG_RENDER_THRESHOLD) {\n        // eslint-disable-next-line no-console\n        console.warn(`[Teact] Slow component render: ${componentName}, ${Math.round(duration)} ms`);\n      }\n\n      const { renders, avgRenderTime } = DEBUG_components[componentName];\n      DEBUG_components[componentName].avgRenderTime = (avgRenderTime * renders + duration) / (renders + 1);\n      DEBUG_components[componentName].renders++;\n      DEBUG_components.TOTAL.renders++;\n\n      if (DEBUG_MORE) {\n        incrementOverlayCounter(`${componentName} renders`);\n        incrementOverlayCounter(`${componentName} duration`, duration);\n      }\n    }\n  }, {\n    rescue: () => {\n      // eslint-disable-next-line no-console\n      console.error(`[Teact] Error while rendering component ${componentInstance.name}`, componentInstance);\n\n      newRenderedValue = componentInstance.renderedValue;\n    },\n  });\n\n  if (componentInstance.mountState === MountState.Mounted && newRenderedValue === componentInstance.renderedValue) {\n    return componentInstance.$element;\n  }\n\n  componentInstance.renderedValue = newRenderedValue;\n  const children = Array.isArray(newRenderedValue) ? newRenderedValue : [newRenderedValue];\n  componentInstance.$element = buildComponentElement(componentInstance, children);\n\n  return componentInstance.$element;\n}\n\nexport function hasElementChanged($old: VirtualElement, $new: VirtualElement) {\n  if (typeof $old !== typeof $new) {\n    return true;\n  } else if ($old.type !== $new.type) {\n    return true;\n  } else if ($old.type === VirtualType.Text && $new.type === VirtualType.Text) {\n    return $old.value !== $new.value;\n  } else if ($old.type === VirtualType.Tag && $new.type === VirtualType.Tag) {\n    return ($old.tag !== $new.tag) || ($old.props.key !== $new.props.key);\n  } else if ($old.type === VirtualType.Component && $new.type === VirtualType.Component) {\n    return (\n      $old.componentInstance.Component !== $new.componentInstance.Component\n    ) || (\n      $old.props.key !== $new.props.key\n    );\n  }\n\n  return false;\n}\n\nexport function mountComponent(componentInstance: ComponentInstance) {\n  componentInstance.id = ++lastComponentId;\n  componentInstance.mountState = MountState.Mounting;\n  renderComponent(componentInstance);\n  componentInstance.mountState = MountState.Mounted;\n  return componentInstance.$element;\n}\n\nexport function unmountComponent(componentInstance: ComponentInstance) {\n  if (componentInstance.mountState === MountState.Unmounted) {\n    return;\n  }\n\n  idsToExcludeFromUpdate.add(componentInstance.id);\n\n  if (componentInstance.hooks?.effects) {\n    for (const effect of componentInstance.hooks.effects.byCursor) {\n      if (effect.cleanup) {\n        safeExec(effect.cleanup);\n      }\n\n      effect.cleanup = undefined;\n      effect.releaseSignals?.();\n    }\n  }\n\n  componentInstance.mountState = MountState.Unmounted;\n\n  helpGc(componentInstance);\n}\n\n// We need to remove all references to DOM objects. We also clean all other references, just in case\nfunction helpGc(componentInstance: ComponentInstance) {\n  const {\n    effects, state, memos, refs,\n  } = componentInstance.hooks || {};\n\n  if (effects) {\n    for (const hook of effects.byCursor) {\n      hook.schedule = undefined as any;\n      hook.cleanup = undefined as any;\n      hook.releaseSignals = undefined as any;\n      hook.dependencies = undefined;\n    }\n  }\n\n  if (state) {\n    for (const hook of state.byCursor) {\n      hook.value = undefined;\n      hook.nextValue = undefined;\n      hook.setter = undefined as any;\n    }\n  }\n\n  if (memos) {\n    for (const hook of memos.byCursor) {\n      hook.value = undefined as any;\n      hook.dependencies = undefined as any;\n    }\n  }\n\n  if (refs) {\n    for (const hook of refs.byCursor) {\n      hook.current = undefined as any;\n      hook.onChange = undefined as any;\n    }\n  }\n\n  componentInstance.hooks = undefined as any;\n  componentInstance.$element = undefined as any;\n  componentInstance.renderedValue = undefined;\n  componentInstance.onUpdate = undefined;\n}\n\nfunction prepareComponentForFrame(componentInstance: ComponentInstance) {\n  if (componentInstance.mountState === MountState.Unmounted) {\n    return;\n  }\n\n  if (componentInstance.hooks?.state) {\n    for (const hook of componentInstance.hooks.state.byCursor) {\n      hook.value = hook.nextValue;\n    }\n  }\n}\n\nfunction forceUpdateComponent(componentInstance: ComponentInstance) {\n  if (componentInstance.mountState === MountState.Unmounted || !componentInstance.onUpdate) {\n    return;\n  }\n\n  const currentElement = componentInstance.$element;\n\n  renderComponent(componentInstance);\n\n  if (componentInstance.$element !== currentElement) {\n    componentInstance.onUpdate();\n  }\n}\n\nexport function useState<T>(): [T | undefined, StateHookSetter<T | undefined>];\nexport function useState<T>(initial: T, debugKey?: string): [T, StateHookSetter<T>];\nexport function useState<T>(initial?: T, debugKey?: string): [T, StateHookSetter<T>] {\n  if (!renderingInstance.hooks) {\n    renderingInstance.hooks = {};\n  }\n  if (!renderingInstance.hooks.state) {\n    renderingInstance.hooks.state = { cursor: 0, byCursor: [] };\n  }\n\n  const { cursor, byCursor } = renderingInstance.hooks.state;\n  const componentInstance = renderingInstance;\n\n  if (byCursor[cursor] === undefined) {\n    byCursor[cursor] = {\n      value: initial,\n      nextValue: initial,\n      setter: (newValue: ((current: T) => T) | T) => {\n        if (componentInstance.mountState === MountState.Unmounted) {\n          return;\n        }\n\n        if (typeof newValue === 'function') {\n          newValue = (newValue as (current: T) => T)(byCursor[cursor].nextValue);\n        }\n\n        if (byCursor[cursor].nextValue === newValue) {\n          return;\n        }\n\n        byCursor[cursor].nextValue = newValue;\n\n        instancesPendingUpdate.add(componentInstance);\n        runUpdatePassOnRaf();\n\n        if (DEBUG_MORE) {\n          // eslint-disable-next-line no-console\n          console.log(\n            '[Teact.useState]',\n            DEBUG_resolveComponentName(componentInstance.Component),\n            `State update at cursor #${cursor}${debugKey ? ` (${debugKey})` : ''}, next value: `,\n            byCursor[cursor].nextValue,\n          );\n        }\n      },\n    };\n  }\n\n  renderingInstance.hooks.state.cursor++;\n\n  return [\n    byCursor[cursor].value,\n    byCursor[cursor].setter,\n  ];\n}\n\nfunction useEffectBase(\n  isLayout: boolean,\n  effect: Effect,\n  dependencies?: readonly any[],\n  debugKey?: string,\n) {\n  if (!renderingInstance.hooks) {\n    renderingInstance.hooks = {};\n  }\n\n  if (!renderingInstance.hooks.effects) {\n    renderingInstance.hooks.effects = { cursor: 0, byCursor: [] };\n  }\n\n  const { cursor, byCursor } = renderingInstance.hooks.effects;\n  const effectConfig = byCursor[cursor];\n  const componentInstance = renderingInstance;\n\n  function schedule() {\n    scheduleEffect(componentInstance, cursor, effect, isLayout);\n  }\n\n  if (dependencies && effectConfig?.dependencies) {\n    if (dependencies.some((dependency, i) => dependency !== effectConfig.dependencies![i])) {\n      if (DEBUG && debugKey) {\n        const causedBy = dependencies.reduce((res, newValue, i) => {\n          const prevValue = effectConfig.dependencies![i];\n          if (newValue !== prevValue) {\n            res.push(`${i}: ${prevValue} => ${newValue}`);\n          }\n\n          return res;\n        }, []);\n\n        // eslint-disable-next-line no-console\n        console.log(`[Teact] Effect \"${debugKey}\" caused by dependencies.`, causedBy.join(', '));\n      }\n\n      schedule();\n    }\n  } else {\n    if (debugKey) {\n      // eslint-disable-next-line no-console\n      console.log(`[Teact] Effect \"${debugKey}\" caused by missing dependencies.`);\n    }\n\n    schedule();\n  }\n\n  function setupSignals() {\n    const cleanups = dependencies?.filter(isSignal).map((signal, i) => signal.subscribe(() => {\n      if (debugKey) {\n        // eslint-disable-next-line no-console\n        console.log(`[Teact] Effect \"${debugKey}\" caused by signal #${i} new value:`, signal());\n      }\n\n      byCursor[cursor].schedule!();\n    }));\n\n    if (!cleanups?.length) {\n      return undefined;\n    }\n\n    return () => {\n      for (const cleanup of cleanups) {\n        cleanup();\n      }\n    };\n  }\n\n  if (effectConfig) effectConfig.schedule = undefined; // Help GC\n\n  byCursor[cursor] = {\n    ...effectConfig,\n    dependencies,\n    schedule,\n  };\n\n  if (!effectConfig) {\n    byCursor[cursor].releaseSignals = setupSignals();\n  }\n\n  renderingInstance.hooks.effects.cursor++;\n}\n\nfunction scheduleEffect(\n  componentInstance: ComponentInstance,\n  cursor: number,\n  effect: Effect,\n  isLayout: boolean,\n) {\n  const { byCursor } = componentInstance.hooks!.effects!;\n  const cleanup = byCursor[cursor]?.cleanup;\n  const cleanupsContainer = isLayout ? pendingLayoutCleanups : pendingCleanups;\n  const effectsContainer = isLayout ? pendingLayoutEffects : pendingEffects;\n  const effectId = `${componentInstance.id}_${cursor}`;\n\n  if (cleanup) {\n    const runEffectCleanup = () => safeExec(() => {\n      if (componentInstance.mountState === MountState.Unmounted) {\n        return;\n      }\n\n      // eslint-disable-next-line @typescript-eslint/naming-convention\n      let DEBUG_startAt: number | undefined;\n      if (DEBUG) {\n        DEBUG_startAt = performance.now();\n      }\n\n      cleanup();\n\n      if (DEBUG) {\n        const duration = performance.now() - DEBUG_startAt!;\n        const componentName = DEBUG_resolveComponentName(componentInstance.Component);\n        if (duration > DEBUG_EFFECT_THRESHOLD) {\n          // eslint-disable-next-line no-console\n          console.warn(\n            `[Teact] Slow cleanup at effect cursor #${cursor}: ${componentName}, ${Math.round(duration)} ms`,\n          );\n        }\n      }\n    }, {\n      rescue: () => {\n        // eslint-disable-next-line no-console, max-len\n        console.error(`[Teact] Error in effect cleanup at cursor #${cursor} in ${componentInstance.name}`,\n          componentInstance);\n      },\n      always: () => {\n        byCursor[cursor].cleanup = undefined;\n      },\n    });\n\n    cleanupsContainer.set(effectId, runEffectCleanup);\n  }\n\n  const runEffect = () => safeExec(() => {\n    if (componentInstance.mountState === MountState.Unmounted) {\n      return;\n    }\n\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    let DEBUG_startAt: number | undefined;\n    if (DEBUG) {\n      DEBUG_startAt = performance.now();\n    }\n\n    const result = effect();\n    if (typeof result === 'function') {\n      byCursor[cursor].cleanup = result;\n    }\n\n    if (DEBUG) {\n      const duration = performance.now() - DEBUG_startAt!;\n      const componentName = DEBUG_resolveComponentName(componentInstance.Component);\n      if (duration > DEBUG_EFFECT_THRESHOLD) {\n        // eslint-disable-next-line no-console\n        console.warn(`[Teact] Slow effect at cursor #${cursor}: ${componentName}, ${Math.round(duration)} ms`);\n      }\n    }\n  }, {\n    rescue: () => {\n      // eslint-disable-next-line no-console\n      console.error(`[Teact] Error in effect at cursor #${cursor} in ${componentInstance.name}`, componentInstance);\n    },\n  });\n\n  effectsContainer.set(effectId, runEffect);\n\n  runUpdatePassOnRaf();\n}\n\nexport function useEffect(effect: Effect, dependencies?: readonly any[], debugKey?: string) {\n  return useEffectBase(false, effect, dependencies, debugKey);\n}\n\nexport function useLayoutEffect(effect: Effect, dependencies?: readonly any[], debugKey?: string) {\n  return useEffectBase(true, effect, dependencies, debugKey);\n}\n\nexport function useUnmountCleanup(cleanup: NoneToVoidFunction) {\n  if (!renderingInstance.hooks) {\n    renderingInstance.hooks = {};\n  }\n\n  if (!renderingInstance.hooks.effects) {\n    renderingInstance.hooks.effects = { cursor: 0, byCursor: [] };\n  }\n\n  const { cursor, byCursor } = renderingInstance.hooks.effects;\n\n  if (!byCursor[cursor]) {\n    byCursor[cursor] = {\n      cleanup,\n    };\n  }\n\n  renderingInstance.hooks.effects.cursor++;\n}\n\nexport function useMemo<T extends any>(\n  resolver: () => T,\n  dependencies: any[],\n  debugKey?: string,\n  debugHitRateKey?: string,\n): T {\n  if (!renderingInstance.hooks) {\n    renderingInstance.hooks = {};\n  }\n  if (!renderingInstance.hooks.memos) {\n    renderingInstance.hooks.memos = { cursor: 0, byCursor: [] };\n  }\n\n  const { cursor, byCursor } = renderingInstance.hooks.memos;\n  let { value } = byCursor[cursor] || {};\n\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  let DEBUG_state: typeof DEBUG_memos[string] | undefined;\n  if (DEBUG && debugHitRateKey) {\n    const instanceKey = `${debugHitRateKey}#${renderingInstance.id}`;\n\n    DEBUG_state = DEBUG_memos[instanceKey];\n    if (!DEBUG_state) {\n      DEBUG_state = {\n        key: instanceKey, calls: 0, misses: 0, hitRate: 0,\n      };\n      DEBUG_memos[instanceKey] = DEBUG_state;\n    }\n\n    DEBUG_state.calls++;\n    DEBUG_state.hitRate = (DEBUG_state.calls - DEBUG_state.misses) / DEBUG_state.calls;\n  }\n\n  if (\n    byCursor[cursor] === undefined\n    || dependencies.length !== byCursor[cursor].dependencies.length\n    || dependencies.some((dependency, i) => dependency !== byCursor[cursor].dependencies[i])\n  ) {\n    if (DEBUG) {\n      if (debugKey) {\n        const msg = `[Teact.useMemo] ${renderingInstance.name} (${debugKey}): Update is caused by:`;\n        if (!byCursor[cursor]) {\n          // eslint-disable-next-line no-console\n          console.log(`${msg} [first render]`);\n        } else {\n          logUnequalProps(byCursor[cursor].dependencies, dependencies, msg, debugKey);\n        }\n      }\n\n      if (DEBUG_state) {\n        DEBUG_state.misses++;\n        DEBUG_state.hitRate = (DEBUG_state.calls - DEBUG_state.misses) / DEBUG_state.calls;\n\n        if (\n          DEBUG_state.calls % 10 === 0\n          && DEBUG_state.calls >= DEBUG_MEMOS_CALLS_THRESHOLD\n          && DEBUG_state.hitRate < 0.25\n        ) {\n          // eslint-disable-next-line no-console\n          console.warn(\n            // eslint-disable-next-line max-len\n            `[Teact] ${DEBUG_state.key}: Hit rate is ${DEBUG_state.hitRate.toFixed(2)} for ${DEBUG_state.calls} calls`,\n          );\n        }\n      }\n    }\n\n    value = resolver();\n  }\n\n  byCursor[cursor] = {\n    value,\n    dependencies,\n  };\n\n  renderingInstance.hooks.memos.cursor++;\n\n  return value;\n}\n\nexport function useCallback<F extends AnyFunction>(newCallback: F, dependencies: any[], debugKey?: string): F {\n  // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n  return useMemo(() => newCallback, dependencies, debugKey);\n}\n\nexport function useRef<T>(initial: T): RefObject<T>;\nexport function useRef<T>(): RefObject<T | undefined>; // TT way (empty is `undefined`)\nexport function useRef<T>(initial: null): RefObject<T | null>; // React way (empty is `null`)\n// eslint-disable-next-line no-null/no-null\nexport function useRef<T>(initial?: T | null) {\n  if (!renderingInstance.hooks) {\n    renderingInstance.hooks = {};\n  }\n  if (!renderingInstance.hooks.refs) {\n    renderingInstance.hooks.refs = { cursor: 0, byCursor: [] };\n  }\n\n  const { cursor, byCursor } = renderingInstance.hooks.refs;\n  if (!byCursor[cursor]) {\n    byCursor[cursor] = {\n      current: initial,\n    };\n  }\n\n  renderingInstance.hooks.refs.cursor++;\n\n  return byCursor[cursor];\n}\n\nexport function createContext<T>(defaultValue?: T): Context<T> {\n  const contextId = String(contextCounter++);\n\n  function TeactContextProvider(props: { value: T; children: TeactNode }) {\n    const [getValue, setValue] = useSignal(props.value ?? defaultValue);\n    // Create a new object to avoid mutations in the parent context\n    renderingInstance.context = { ...renderingInstance.context };\n\n    renderingInstance.context[contextId] = getValue;\n    setValue(props.value);\n    return props.children;\n  }\n\n  TeactContextProvider.DEBUG_contentComponentName = contextId;\n\n  const context = {\n    defaultValue,\n    contextId,\n    Provider: TeactContextProvider,\n  };\n\n  return context;\n}\n\nexport function useContextSignal<T>(context: Context<T>) {\n  const [getDefaultValue] = useSignal(context.defaultValue);\n\n  return renderingInstance.context?.[context.contextId] || getDefaultValue;\n}\n\nexport function useSignal<T>(initial?: T) {\n  const signalRef = useRef<ReturnType<typeof createSignal<T>>>();\n  signalRef.current ??= createSignal<T>(initial);\n  return signalRef.current;\n}\n\nexport function memo<T extends FC_withDebug>(Component: T, debugKey?: string) {\n  function TeactMemoWrapper(props: Props) {\n    return useMemo(\n      () => createElement(Component, props),\n      // eslint-disable-next-line react-hooks-static-deps/exhaustive-deps\n      Object.values(props),\n      debugKey,\n      DEBUG_MORE ? DEBUG_resolveComponentName(renderingInstance.Component) : undefined,\n    );\n  }\n\n  TeactMemoWrapper.DEBUG_contentComponentName = DEBUG_resolveComponentName(Component);\n\n  return TeactMemoWrapper as T;\n}\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nexport function DEBUG_resolveComponentName(Component: FC_withDebug) {\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  const { name, DEBUG_contentComponentName } = Component;\n\n  if (name === 'TeactNContainer') {\n    return `container>${DEBUG_contentComponentName}`;\n  }\n\n  if (name === 'TeactMemoWrapper') {\n    return `memo>${DEBUG_contentComponentName}`;\n  }\n\n  if (name === 'TeactContextProvider') {\n    return `context>id${DEBUG_contentComponentName}`;\n  }\n\n  return name + (DEBUG_contentComponentName ? `>${DEBUG_contentComponentName}` : '');\n}\n\nexport default {\n  createElement,\n  Fragment,\n};\n","import type { FC, FC_withDebug, Props } from './teact';\n\nimport { DEBUG, DEBUG_MORE } from '../../config';\nimport arePropsShallowEqual, { logUnequalProps } from '../../util/arePropsShallowEqual';\nimport { handleError } from '../../util/handleError';\nimport { orderBy } from '../../util/iteratees';\nimport { throttleWithTickEnd } from '../../util/schedulers';\nimport React, { DEBUG_resolveComponentName, getIsHeavyAnimating, useUnmountCleanup } from './teact';\n\nimport useForceUpdate from '../../hooks/useForceUpdate';\nimport useUniqueId from '../../hooks/useUniqueId';\n\nexport default React;\n\ninterface Container {\n  mapStateToProps: MapStateToProps<any>;\n  activationFn?: ActivationFn<any>;\n  stuckTo?: any;\n  ownProps: Props;\n  mappedProps?: Props;\n  forceUpdate: Function;\n  DEBUG_updates: number;\n  DEBUG_componentName: string;\n}\n\ntype GlobalState =\n  AnyLiteral\n  & { DEBUG_randomId?: number };\ntype ActionNames = string;\ntype ActionPayload = any;\n\nexport interface ActionOptions {\n  forceOnHeavyAnimation?: boolean;\n  // Workaround for iOS gesture history navigation\n  forceSyncOnIOs?: boolean;\n  forceOutdated?: boolean;\n}\n\ntype Actions = Record<ActionNames, (payload?: ActionPayload, options?: ActionOptions) => void>;\n\ntype ActionHandler = (\n  global: GlobalState,\n  actions: Actions,\n  payload: any,\n) => GlobalState | void | Promise<void>;\n\ntype MapStateToProps<OwnProps = undefined> = (global: GlobalState, ownProps: OwnProps) => AnyLiteral;\ntype StickToFirstFn = (value: any) => boolean;\ntype ActivationFn<OwnProps = undefined> = (\n  global: GlobalState, ownProps: OwnProps, stickToFirst: StickToFirstFn,\n) => boolean;\n\nlet currentGlobal = {\n  isInited: false,\n} as GlobalState;\n\n// eslint-disable-next-line @typescript-eslint/naming-convention\nlet DEBUG_currentRandomId: number | undefined;\n// eslint-disable-next-line @typescript-eslint/naming-convention\nconst DEBUG_invalidateGlobalOnTickEnd = throttleWithTickEnd(() => {\n  DEBUG_currentRandomId = Math.random();\n});\n\nconst actionHandlers: Record<string, ActionHandler[]> = {};\nconst callbacks: Function[] = [updateContainers];\nconst actions = {} as Actions;\nconst containers = new Map<string, Container>();\n\nconst runCallbacksThrottled = throttleWithTickEnd(runCallbacks);\n\nlet forceOnHeavyAnimation = true;\n\nfunction runCallbacks() {\n  if (forceOnHeavyAnimation) {\n    forceOnHeavyAnimation = false;\n  } else if (getIsHeavyAnimating()) {\n    getIsHeavyAnimating.once(runCallbacksThrottled);\n    return;\n  }\n\n  callbacks.forEach((cb) => cb(currentGlobal));\n}\n\nexport function setUntypedGlobal(newGlobal?: GlobalState, options?: ActionOptions) {\n  if (typeof newGlobal === 'object' && newGlobal !== currentGlobal) {\n    if (DEBUG) {\n      if (\n        !options?.forceOutdated\n        && newGlobal.DEBUG_randomId && newGlobal.DEBUG_randomId !== DEBUG_currentRandomId\n      ) {\n        throw new Error('[TeactN.setGlobal] Attempt to set an outdated global');\n      }\n\n      DEBUG_currentRandomId = Math.random();\n    }\n\n    currentGlobal = newGlobal;\n\n    if (options?.forceSyncOnIOs) {\n      forceOnHeavyAnimation = true;\n      runCallbacks();\n    } else {\n      if (options?.forceOnHeavyAnimation) {\n        forceOnHeavyAnimation = true;\n      }\n\n      runCallbacksThrottled();\n    }\n  }\n}\n\nexport function getUntypedGlobal() {\n  if (DEBUG) {\n    currentGlobal = {\n      ...currentGlobal,\n      DEBUG_randomId: DEBUG_currentRandomId,\n    };\n    DEBUG_invalidateGlobalOnTickEnd();\n  }\n\n  return currentGlobal;\n}\n\nexport function getUntypedActions() {\n  return actions;\n}\n\nexport function forceOnHeavyAnimationOnce() {\n  forceOnHeavyAnimation = true;\n}\n\nlet actionQueue: NoneToVoidFunction[] = [];\n\nfunction handleAction(name: string, payload?: ActionPayload, options?: ActionOptions) {\n  actionQueue.push(() => {\n    actionHandlers[name]?.forEach((handler) => {\n      const response = handler(DEBUG ? getUntypedGlobal() : currentGlobal, actions, payload);\n      if (!response || typeof response.then === 'function') {\n        return;\n      }\n\n      // eslint-disable-next-line eslint-multitab-tt/set-global-only-variable\n      setUntypedGlobal(response as GlobalState, options);\n    });\n  });\n\n  if (actionQueue.length === 1) {\n    try {\n      while (actionQueue.length) {\n        actionQueue[0]();\n        actionQueue.shift();\n      }\n    } finally {\n      actionQueue = [];\n    }\n  }\n}\n\nfunction updateContainers() {\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  let DEBUG_startAt: number | undefined;\n  if (DEBUG) {\n    DEBUG_startAt = performance.now();\n  }\n\n  // eslint-disable-next-line no-restricted-syntax\n  for (const container of containers.values()) {\n    const {\n      mapStateToProps, ownProps, mappedProps, forceUpdate,\n    } = container;\n\n    if (!activateContainer(container, currentGlobal, ownProps)) {\n      continue;\n    }\n\n    let newMappedProps;\n\n    try {\n      newMappedProps = mapStateToProps(currentGlobal, ownProps);\n    } catch (err: any) {\n      handleError(err);\n\n      return;\n    }\n\n    if (DEBUG) {\n      if (Object.values(newMappedProps).some(Number.isNaN)) {\n        // eslint-disable-next-line no-console\n        console.warn(\n          // eslint-disable-next-line max-len\n          `[TeactN] Some of \\`${container.DEBUG_componentName}\\` mappers contain NaN values. This may cause redundant updates because of incorrect equality check.`,\n        );\n      }\n    }\n\n    if (Object.keys(newMappedProps).length && !arePropsShallowEqual(mappedProps!, newMappedProps)) {\n      if (DEBUG_MORE) {\n        logUnequalProps(\n          mappedProps!,\n          newMappedProps,\n          `[TeactN] Will update ${container.DEBUG_componentName} caused by:`,\n        );\n      }\n\n      container.mappedProps = newMappedProps;\n      container.DEBUG_updates++;\n\n      forceUpdate();\n    }\n  }\n\n  if (DEBUG) {\n    const updateTime = performance.now() - DEBUG_startAt!;\n    if (updateTime > 7) {\n      // eslint-disable-next-line no-console\n      console.warn(`[TeactN] Slow containers update: ${Math.round(updateTime)} ms`);\n    }\n  }\n}\n\nexport function addUntypedActionHandler(name: ActionNames, handler: ActionHandler) {\n  if (!actionHandlers[name]) {\n    actionHandlers[name] = [];\n\n    actions[name] = (payload?: ActionPayload, options?: ActionOptions) => {\n      handleAction(name, payload, options);\n    };\n  }\n\n  actionHandlers[name].push(handler);\n}\n\nexport function addCallback(cb: Function) {\n  callbacks.push(cb);\n}\n\nexport function removeCallback(cb: Function) {\n  const index = callbacks.indexOf(cb);\n  if (index !== -1) {\n    callbacks.splice(index, 1);\n  }\n}\n\nexport function withUntypedGlobal<OwnProps extends AnyLiteral>(\n  mapStateToProps: MapStateToProps<OwnProps> = () => ({}),\n  activationFn?: ActivationFn<OwnProps>,\n) {\n  return (Component: FC) => {\n    function TeactNContainer(props: OwnProps) {\n      const id = useUniqueId();\n      const forceUpdate = useForceUpdate();\n\n      useUnmountCleanup(() => {\n        containers.delete(id);\n      });\n\n      let container = containers.get(id)!;\n      if (!container) {\n        container = {\n          mapStateToProps,\n          activationFn,\n          ownProps: props,\n          forceUpdate,\n          DEBUG_updates: 0,\n          DEBUG_componentName: Component.name,\n        };\n\n        containers.set(id, container);\n      }\n\n      if (!container.mappedProps || (\n        !arePropsShallowEqual(container.ownProps, props) && activateContainer(container, currentGlobal, props)\n      )) {\n        try {\n          container.mappedProps = mapStateToProps(currentGlobal, props);\n        } catch (err: any) {\n          handleError(err);\n        }\n      }\n\n      container.ownProps = props;\n\n      // eslint-disable-next-line react/jsx-props-no-spreading\n      return <Component {...container.mappedProps} {...props} />;\n    }\n\n    (TeactNContainer as FC_withDebug).DEBUG_contentComponentName = DEBUG_resolveComponentName(Component);\n\n    return TeactNContainer;\n  };\n}\n\nfunction activateContainer(container: Container, global: GlobalState, props: Props) {\n  const { activationFn, stuckTo } = container;\n  if (!activationFn) {\n    return true;\n  }\n\n  return activationFn(global, props, (stickTo: any) => {\n    if (stickTo && !stuckTo) {\n      container.stuckTo = stickTo;\n    }\n\n    return stickTo && (!stuckTo || stuckTo === stickTo);\n  });\n}\n\nexport function typify<\n  ProjectGlobalState,\n  ActionPayloads,\n>() {\n  type ProjectActionNames = keyof ActionPayloads;\n\n  // When payload is allowed to be `undefined` we consider it optional\n  type ProjectActions = {\n    [ActionName in ProjectActionNames]:\n    (undefined extends ActionPayloads[ActionName] ? (\n      (payload?: ActionPayloads[ActionName], options?: ActionOptions) => void\n    ) : (\n      (payload: ActionPayloads[ActionName], options?: ActionOptions) => void\n    ))\n  };\n\n  type ActionHandlers = {\n    [ActionName in keyof ActionPayloads]: (\n      global: ProjectGlobalState,\n      actions: ProjectActions,\n      payload: ActionPayloads[ActionName],\n    ) => ProjectGlobalState | void | Promise<void>;\n  };\n\n  return {\n    getGlobal: getUntypedGlobal as <T extends ProjectGlobalState>() => T,\n    setGlobal: setUntypedGlobal as (state: ProjectGlobalState, options?: ActionOptions) => void,\n    getActions: getUntypedActions as () => ProjectActions,\n    addActionHandler: addUntypedActionHandler as <ActionName extends ProjectActionNames>(\n      name: ActionName,\n      handler: ActionHandlers[ActionName],\n    ) => void,\n    withGlobal: withUntypedGlobal as <OwnProps extends AnyLiteral>(\n      mapStateToProps: (global: ProjectGlobalState, ownProps: OwnProps) => AnyLiteral,\n      activationFn?: (global: ProjectGlobalState, ownProps: OwnProps, stickToFirst: StickToFirstFn) => boolean,\n    ) => (Component: FC) => FC<OwnProps>,\n  };\n}\n\nif (DEBUG) {\n  (window as any).getGlobal = getUntypedGlobal;\n  (window as any).setGlobal = setUntypedGlobal;\n\n  document.addEventListener('dblclick', () => {\n    // eslint-disable-next-line no-console\n    console.warn(\n      'GLOBAL CONTAINERS',\n      orderBy(\n        Array.from(containers.values())\n          .map(({ DEBUG_componentName, DEBUG_updates }) => ({ DEBUG_componentName, DEBUG_updates })),\n        'DEBUG_updates',\n        'desc',\n      ),\n    );\n  });\n}\n","// Copyright Twitter Inc. Licensed under MIT\n// https://github.com/twitter/twemoji-parser/blob/master/LICENSE.md\n// Emoji 15.0.2 support was taken here https://github.com/mei23/twemoji-parser\n// Version 3d4dedc 15.12.2023\n\nconst vs16RegExp = /\\uFE0F/g;\n// avoid using a string literal like `\\u200D` here because minifiers expand it inline\nconst zeroWidthJoiner = String.fromCharCode(0x200d);\n\nexport function removeVS16s(rawEmoji) {\n  return rawEmoji.indexOf(zeroWidthJoiner) < 0 ? rawEmoji.replace(vs16RegExp, '') : rawEmoji;\n}\n\n// Default Twemoji regex was modified here.\n// An exception for ascii emoji has been added to the beginning of the regular string: 🅰🅱🅾🅿.\n// UTF-16 endcoding are `\\ud83c\\udd70`, `\\ud83c\\udd71`, `\\ud83c\\udd7e` and `\\ud83c\\udd7f`.\n// These emojis in the graphic version must end with the `\\ufe0f` symbol.\n// Therefore, they should be excluded from the regular expression.\n// You must remove next substring `\\udd70\\udd71\\udd7e\\udd7f` from the middle of the regex on every update.\n\n// This file is generated by source/emoji/scripts/generate.sh\n// eslint-disable-next-line max-len\nexport default /(?:\\ud83c[\\udd70\\udd71\\udd7e\\udd7f]\\ufe0f)|(?:\\ud83d\\udc68\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83e\\uddd1\\ud83c[\\udffc-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83e\\uddd1\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83e\\uddd1\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83e\\uddd1\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83e\\uddd1\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udffe]|\\ud83d\\udc68\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffb\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffc-\\udfff]|\\ud83d\\udc68\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffc\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83d\\udc68\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffd\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83d\\udc68\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udffe\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83d\\udc68\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\ud83c\\udfff\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udffe]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffc-\\udfff]|\\ud83d\\udc69\\ud83c\\udffb\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc69\\ud83c[\\udffc-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83d\\udc69\\ud83c\\udffc\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc69\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83d\\udc69\\ud83c\\udffd\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc69\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83d\\udc69\\ud83c\\udffe\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc68\\ud83c[\\udffb-\\udffe]|\\ud83d\\udc69\\ud83c\\udfff\\u200d\\ud83e\\udd1d\\u200d\\ud83d\\udc69\\ud83c[\\udffb-\\udffe]|\\ud83e\\uddd1\\ud83c\\udffb\\u200d\\u2764\\ufe0f\\u200d\\ud83e\\uddd1\\ud83c[\\udffc-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffb\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffc\\u200d\\u2764\\ufe0f\\u200d\\ud83e\\uddd1\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffc\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffd\\u200d\\u2764\\ufe0f\\u200d\\ud83e\\uddd1\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83e\\uddd1\\ud83c\\udffd\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udfff]|\\ud83e\\uddd1\\ud83c\\udffe\\u200d\\u2764\\ufe0f\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83e\\uddd1\\ud83c\\udffe\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udfff]|\\ud83e\\uddd1\\ud83c\\udfff\\u200d\\u2764\\ufe0f\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udffe]|\\ud83e\\uddd1\\ud83c\\udfff\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc68\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d\\udc68|\\ud83d\\udc69\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc8b\\u200d\\ud83d[\\udc68\\udc69]|\\ud83e\\udef1\\ud83c\\udffb\\u200d\\ud83e\\udef2\\ud83c[\\udffc-\\udfff]|\\ud83e\\udef1\\ud83c\\udffc\\u200d\\ud83e\\udef2\\ud83c[\\udffb\\udffd-\\udfff]|\\ud83e\\udef1\\ud83c\\udffd\\u200d\\ud83e\\udef2\\ud83c[\\udffb\\udffc\\udffe\\udfff]|\\ud83e\\udef1\\ud83c\\udffe\\u200d\\ud83e\\udef2\\ud83c[\\udffb-\\udffd\\udfff]|\\ud83e\\udef1\\ud83c\\udfff\\u200d\\ud83e\\udef2\\ud83c[\\udffb-\\udffe]|\\ud83d\\udc68\\u200d\\u2764\\ufe0f\\u200d\\ud83d\\udc68|\\ud83d\\udc69\\u200d\\u2764\\ufe0f\\u200d\\ud83d[\\udc68\\udc69]|\\ud83e\\uddd1\\u200d\\ud83e\\udd1d\\u200d\\ud83e\\uddd1|\\ud83d\\udc6b\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc6c\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc6d\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc8f\\ud83c[\\udffb-\\udfff]|\\ud83d\\udc91\\ud83c[\\udffb-\\udfff]|\\ud83e\\udd1d\\ud83c[\\udffb-\\udfff]|\\ud83d[\\udc6b-\\udc6d\\udc8f\\udc91]|\\ud83e\\udd1d)|(?:\\ud83c\\udfc3|\\ud83d\\udeb6|\\ud83e\\uddce)(?:\\ud83c[\\udffb-\\udfff])?(?:\\u200d[\\u2640\\u2642]\\ufe0f)?(?:\\u200d\\u27a1\\ufe0f)|(?:\\ud83d[\\udc68\\udc69]|\\ud83e\\uddd1)(?:\\ud83c[\\udffb-\\udfff])?\\u200d(?:\\ud83e[\\uddaf\\uddbc\\uddbd])(?:\\u200d\\u27a1\\ufe0f)|(?:\\ud83d[\\udc68\\udc69]|\\ud83e\\uddd1)(?:\\ud83c[\\udffb-\\udfff])?\\u200d(?:\\u2695\\ufe0f|\\u2696\\ufe0f|\\u2708\\ufe0f|\\ud83c[\\udf3e\\udf73\\udf7c\\udf84\\udf93\\udfa4\\udfa8\\udfeb\\udfed]|\\ud83d[\\udcbb\\udcbc\\udd27\\udd2c\\ude80\\ude92]|\\ud83e[\\uddaf\\uddaf-\\uddb3\\uddbc\\uddbc\\uddbd\\uddbd])|(?:\\ud83c[\\udfcb\\udfcc]|\\ud83d[\\udd74\\udd75]|\\u26f9)((?:\\ud83c[\\udffb-\\udfff]|\\ufe0f)\\u200d[\\u2640\\u2642]\\ufe0f)|(?:\\ud83c[\\udfc3\\udfc3\\udfc4\\udfca]|\\ud83d[\\udc6e\\udc70\\udc71\\udc73\\udc77\\udc81\\udc82\\udc86\\udc87\\ude45-\\ude47\\ude4b\\ude4d\\ude4e\\udea3\\udeb4-\\udeb6\\udeb6]|\\ud83e[\\udd26\\udd35\\udd37-\\udd39\\udd3d\\udd3e\\uddb8\\uddb9\\uddcd\\uddce\\uddce\\uddcf\\uddd4\\uddd6-\\udddd])(?:\\ud83c[\\udffb-\\udfff])?\\u200d[\\u2640\\u2642]\\ufe0f|(?:\\ud83d\\udc68\\u200d\\ud83d\\udc68\\u200d\\ud83d\\udc66\\u200d\\ud83d\\udc66|\\ud83d\\udc68\\u200d\\ud83d\\udc68\\u200d\\ud83d\\udc67\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc68\\u200d\\ud83d\\udc69\\u200d\\ud83d\\udc66\\u200d\\ud83d\\udc66|\\ud83d\\udc68\\u200d\\ud83d\\udc69\\u200d\\ud83d\\udc67\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc69\\u200d\\ud83d\\udc69\\u200d\\ud83d\\udc66\\u200d\\ud83d\\udc66|\\ud83d\\udc69\\u200d\\ud83d\\udc69\\u200d\\ud83d\\udc67\\u200d\\ud83d[\\udc66\\udc67]|\\ud83e\\uddd1\\u200d\\ud83e\\uddd1\\u200d\\ud83e\\uddd2\\u200d\\ud83e\\uddd2|\\ud83d\\udc68\\u200d\\ud83d\\udc66\\u200d\\ud83d\\udc66|\\ud83d\\udc68\\u200d\\ud83d\\udc67\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc68\\u200d\\ud83d\\udc68\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc68\\u200d\\ud83d\\udc69\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc69\\u200d\\ud83d\\udc66\\u200d\\ud83d\\udc66|\\ud83d\\udc69\\u200d\\ud83d\\udc67\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc69\\u200d\\ud83d\\udc69\\u200d\\ud83d[\\udc66\\udc67]|\\ud83e\\uddd1\\u200d\\ud83e\\uddd1\\u200d\\ud83e\\uddd2|\\ud83e\\uddd1\\u200d\\ud83e\\uddd2\\u200d\\ud83e\\uddd2|\\ud83c\\udff3\\ufe0f\\u200d\\u26a7\\ufe0f|\\ud83c\\udff3\\ufe0f\\u200d\\ud83c\\udf08|\\ud83d\\ude36\\u200d\\ud83c\\udf2b\\ufe0f|\\u26d3\\ufe0f\\u200d\\ud83d\\udca5|\\u2764\\ufe0f\\u200d\\ud83d\\udd25|\\u2764\\ufe0f\\u200d\\ud83e\\ude79|\\ud83c\\udf44\\u200d\\ud83d\\udfeb|\\ud83c\\udf4b\\u200d\\ud83d\\udfe9|\\ud83c\\udff4\\u200d\\u2620\\ufe0f|\\ud83d\\udc15\\u200d\\ud83e\\uddba|\\ud83d\\udc26\\u200d\\ud83d\\udd25|\\ud83d\\udc3b\\u200d\\u2744\\ufe0f|\\ud83d\\udc41\\u200d\\ud83d\\udde8|\\ud83d\\udc68\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc69\\u200d\\ud83d[\\udc66\\udc67]|\\ud83d\\udc6f\\u200d\\u2640\\ufe0f|\\ud83d\\udc6f\\u200d\\u2642\\ufe0f|\\ud83d\\ude2e\\u200d\\ud83d\\udca8|\\ud83d\\ude35\\u200d\\ud83d\\udcab|\\ud83d\\ude42\\u200d\\u2194\\ufe0f|\\ud83d\\ude42\\u200d\\u2195\\ufe0f|\\ud83e\\udd3c\\u200d\\u2640\\ufe0f|\\ud83e\\udd3c\\u200d\\u2642\\ufe0f|\\ud83e\\uddd1\\u200d\\ud83e\\uddd2|\\ud83e\\uddde\\u200d\\u2640\\ufe0f|\\ud83e\\uddde\\u200d\\u2642\\ufe0f|\\ud83e\\udddf\\u200d\\u2640\\ufe0f|\\ud83e\\udddf\\u200d\\u2642\\ufe0f|\\ud83d\\udc08\\u200d\\u2b1b|\\ud83d\\udc26\\u200d\\u2b1b)|[#*0-9]\\ufe0f?\\u20e3|(?:[©®\\u2122\\u265f]\\ufe0f)|(?:\\ud83c[\\udc04\\ude02\\ude1a\\ude2f\\ude37\\udf21\\udf24-\\udf2c\\udf36\\udf7d\\udf96\\udf97\\udf99-\\udf9b\\udf9e\\udf9f\\udfcd\\udfce\\udfd4-\\udfdf\\udff3\\udff5\\udff7]|\\ud83d[\\udc3f\\udc41\\udcfd\\udd49\\udd4a\\udd6f\\udd70\\udd73\\udd76-\\udd79\\udd87\\udd8a-\\udd8d\\udda5\\udda8\\uddb1\\uddb2\\uddbc\\uddc2-\\uddc4\\uddd1-\\uddd3\\udddc-\\uddde\\udde1\\udde3\\udde8\\uddef\\uddf3\\uddfa\\udecb\\udecd-\\udecf\\udee0-\\udee5\\udee9\\udef0\\udef3]|[\\u203c\\u2049\\u2139\\u2194-\\u2199\\u21a9\\u21aa\\u231a\\u231b\\u2328\\u23cf\\u23ed-\\u23ef\\u23f1\\u23f2\\u23f8-\\u23fa\\u24c2\\u25aa\\u25ab\\u25b6\\u25c0\\u25fb-\\u25fe\\u2600-\\u2604\\u260e\\u2611\\u2614\\u2615\\u2618\\u2620\\u2622\\u2623\\u2626\\u262a\\u262e\\u262f\\u2638-\\u263a\\u2640\\u2642\\u2648-\\u2653\\u2660\\u2663\\u2665\\u2666\\u2668\\u267b\\u267f\\u2692-\\u2697\\u2699\\u269b\\u269c\\u26a0\\u26a1\\u26a7\\u26aa\\u26ab\\u26b0\\u26b1\\u26bd\\u26be\\u26c4\\u26c5\\u26c8\\u26cf\\u26d1\\u26d3\\u26d4\\u26e9\\u26ea\\u26f0-\\u26f5\\u26f8\\u26fa\\u26fd\\u2702\\u2708\\u2709\\u270f\\u2712\\u2714\\u2716\\u271d\\u2721\\u2733\\u2734\\u2744\\u2747\\u2757\\u2763\\u2764\\u27a1\\u2934\\u2935\\u2b05-\\u2b07\\u2b1b\\u2b1c\\u2b50\\u2b55\\u3030\\u303d\\u3297\\u3299])(?:\\ufe0f|(?!\\ufe0e))|(?:(?:\\ud83c[\\udfcb\\udfcc]|\\ud83d[\\udd74\\udd75\\udd90]|\\ud83e\\udef0|[\\u261d\\u26f7\\u26f9\\u270c\\u270d])(?:\\ufe0f|(?!\\ufe0e))|(?:\\ud83c[\\udf85\\udfc2-\\udfc4\\udfc7\\udfca]|\\ud83d[\\udc42\\udc43\\udc46-\\udc50\\udc66-\\udc69\\udc6e\\udc70-\\udc78\\udc7c\\udc81-\\udc83\\udc85-\\udc87\\udcaa\\udd7a\\udd95\\udd96\\ude45-\\ude47\\ude4b-\\ude4f\\udea3\\udeb4-\\udeb6\\udec0\\udecc]|\\ud83e[\\udd0c\\udd0f\\udd18-\\udd1c\\udd1e\\udd1f\\udd26\\udd30-\\udd39\\udd3d\\udd3e\\udd77\\uddb5\\uddb6\\uddb8\\uddb9\\uddbb\\uddcd-\\uddcf\\uddd1-\\udddd\\udec3-\\udec5\\udef1-\\udef8]|[\\u270a\\u270b]))(?:\\ud83c[\\udffb-\\udfff])?|(?:\\ud83c\\udff4\\udb40\\udc67\\udb40\\udc62\\udb40\\udc65\\udb40\\udc6e\\udb40\\udc67\\udb40\\udc7f|\\ud83c\\udff4\\udb40\\udc67\\udb40\\udc62\\udb40\\udc73\\udb40\\udc63\\udb40\\udc74\\udb40\\udc7f|\\ud83c\\udff4\\udb40\\udc67\\udb40\\udc62\\udb40\\udc77\\udb40\\udc6c\\udb40\\udc73\\udb40\\udc7f|\\ud83c\\udde6\\ud83c[\\udde8-\\uddec\\uddee\\uddf1\\uddf2\\uddf4\\uddf6-\\uddfa\\uddfc\\uddfd\\uddff]|\\ud83c\\udde7\\ud83c[\\udde6\\udde7\\udde9-\\uddef\\uddf1-\\uddf4\\uddf6-\\uddf9\\uddfb\\uddfc\\uddfe\\uddff]|\\ud83c\\udde8\\ud83c[\\udde6\\udde8\\udde9\\uddeb-\\uddee\\uddf0-\\uddf5\\uddf7\\uddfa-\\uddff]|\\ud83c\\udde9\\ud83c[\\uddea\\uddec\\uddef\\uddf0\\uddf2\\uddf4\\uddff]|\\ud83c\\uddea\\ud83c[\\udde6\\udde8\\uddea\\uddec\\udded\\uddf7-\\uddfa]|\\ud83c\\uddeb\\ud83c[\\uddee-\\uddf0\\uddf2\\uddf4\\uddf7]|\\ud83c\\uddec\\ud83c[\\udde6\\udde7\\udde9-\\uddee\\uddf1-\\uddf3\\uddf5-\\uddfa\\uddfc\\uddfe]|\\ud83c\\udded\\ud83c[\\uddf0\\uddf2\\uddf3\\uddf7\\uddf9\\uddfa]|\\ud83c\\uddee\\ud83c[\\udde8-\\uddea\\uddf1-\\uddf4\\uddf6-\\uddf9]|\\ud83c\\uddef\\ud83c[\\uddea\\uddf2\\uddf4\\uddf5]|\\ud83c\\uddf0\\ud83c[\\uddea\\uddec-\\uddee\\uddf2\\uddf3\\uddf5\\uddf7\\uddfc\\uddfe\\uddff]|\\ud83c\\uddf1\\ud83c[\\udde6-\\udde8\\uddee\\uddf0\\uddf7-\\uddfb\\uddfe]|\\ud83c\\uddf2\\ud83c[\\udde6\\udde8-\\udded\\uddf0-\\uddff]|\\ud83c\\uddf3\\ud83c[\\udde6\\udde8\\uddea-\\uddec\\uddee\\uddf1\\uddf4\\uddf5\\uddf7\\uddfa\\uddff]|\\ud83c\\uddf4\\ud83c\\uddf2|\\ud83c\\uddf5\\ud83c[\\udde6\\uddea-\\udded\\uddf0-\\uddf3\\uddf7-\\uddf9\\uddfc\\uddfe]|\\ud83c\\uddf6\\ud83c\\udde6|\\ud83c\\uddf7\\ud83c[\\uddea\\uddf4\\uddf8\\uddfa\\uddfc]|\\ud83c\\uddf8\\ud83c[\\udde6-\\uddea\\uddec-\\uddf4\\uddf7-\\uddf9\\uddfb\\uddfd-\\uddff]|\\ud83c\\uddf9\\ud83c[\\udde6\\udde8\\udde9\\uddeb-\\udded\\uddef-\\uddf4\\uddf7\\uddf9\\uddfb\\uddfc\\uddff]|\\ud83c\\uddfa\\ud83c[\\udde6\\uddec\\uddf2\\uddf3\\uddf8\\uddfe\\uddff]|\\ud83c\\uddfb\\ud83c[\\udde6\\udde8\\uddea\\uddec\\uddee\\uddf3\\uddfa]|\\ud83c\\uddfc\\ud83c[\\uddeb\\uddf8]|\\ud83c\\uddfd\\ud83c\\uddf0|\\ud83c\\uddfe\\ud83c[\\uddea\\uddf9]|\\ud83c\\uddff\\ud83c[\\udde6\\uddf2\\uddfc]|\\ud83c[\\udccf\\udd8e\\udd91-\\udd9a\\udde6-\\uddff\\ude01\\ude32-\\ude36\\ude38-\\ude3a\\ude50\\ude51\\udf00-\\udf20\\udf2d-\\udf35\\udf37-\\udf7c\\udf7e-\\udf84\\udf86-\\udf93\\udfa0-\\udfc1\\udfc5\\udfc6\\udfc8\\udfc9\\udfcf-\\udfd3\\udfe0-\\udff0\\udff4\\udff8-\\udfff]|\\ud83d[\\udc00-\\udc3e\\udc40\\udc44\\udc45\\udc51-\\udc65\\udc6a\\udc6f\\udc79-\\udc7b\\udc7d-\\udc80\\udc84\\udc88-\\udc8e\\udc90\\udc92-\\udca9\\udcab-\\udcfc\\udcff-\\udd3d\\udd4b-\\udd4e\\udd50-\\udd67\\udda4\\uddfb-\\ude44\\ude48-\\ude4a\\ude80-\\udea2\\udea4-\\udeb3\\udeb7-\\udebf\\udec1-\\udec5\\uded0-\\uded2\\uded5-\\uded7\\udedc-\\udedf\\udeeb\\udeec\\udef4-\\udefc\\udfe0-\\udfeb\\udff0]|\\ud83e[\\udd0d\\udd0e\\udd10-\\udd17\\udd20-\\udd25\\udd27-\\udd2f\\udd3a\\udd3c\\udd3f-\\udd45\\udd47-\\udd76\\udd78-\\uddb4\\uddb7\\uddba\\uddbc-\\uddcc\\uddd0\\uddde-\\uddff\\ude70-\\ude7c\\ude80-\\ude88\\ude90-\\udebd\\udebf-\\udec2\\udece-\\udedb\\udee0-\\udee8]|[\\u23e9-\\u23ec\\u23f0\\u23f3\\u267e\\u26ce\\u2705\\u2728\\u274c\\u274e\\u2753-\\u2755\\u2795-\\u2797\\u27b0\\u27bf\\ue50a])|\\ufe0f/g;\n","import type { TeactNode } from '../lib/teact/teact';\n\nimport type {\n  ApiBotInlineMediaResult,\n  ApiBotInlineResult,\n  ApiBotInlineSwitchPm,\n  ApiBotInlineSwitchWebview,\n  ApiChatInviteImporter,\n  ApiDocument,\n  ApiDraft,\n  ApiExportedInvite,\n  ApiFakeType,\n  ApiFormattedText,\n  ApiLabeledPrice,\n  ApiMediaFormat,\n  ApiMessage,\n  ApiPhoto,\n  ApiReaction,\n  ApiReactionWithPaid,\n  ApiStarGiftRegular,\n  ApiStarsSubscription,\n  ApiStarsTransaction,\n  ApiStickerSet,\n  ApiThreadInfo,\n  ApiTopic,\n  ApiTypingStatus,\n  ApiVideo,\n} from '../api/types';\nimport type { SearchResultKey } from '../util/keys/searchResultKey';\nimport type { IconName } from './icons';\n\nexport type TextPart = TeactNode;\n\nexport enum LoadMoreDirection {\n  Backwards,\n  Forwards,\n  Around,\n}\n\nexport enum FocusDirection {\n  Up,\n  Down,\n  Static,\n}\n\nexport type ScrollTargetPosition = ScrollLogicalPosition | 'centerOrTop';\n\nexport interface IAlbum {\n  albumId: string;\n  messages: ApiMessage[];\n  isPaidMedia?: boolean;\n  mainMessage: ApiMessage;\n  captionMessage?: ApiMessage;\n  hasMultipleCaptions: boolean;\n  commentsMessage?: ApiMessage;\n}\n\nexport type ThreadId = string | number;\n\nexport type ThemeKey = 'light' | 'dark';\nexport type AnimationLevel = 0 | 1 | 2;\nexport type PerformanceTypeKey = (\n  'pageTransitions' | 'messageSendingAnimations' | 'mediaViewerAnimations'\n  | 'messageComposerAnimations' | 'contextMenuAnimations' | 'contextMenuBlur' | 'rightColumnAnimations'\n  | 'animatedEmoji' | 'loopAnimatedStickers' | 'reactionEffects' | 'stickerEffects' | 'autoplayGifs' | 'autoplayVideos'\n  | 'storyRibbonAnimations' | 'snapEffect'\n);\nexport type PerformanceType = {\n  [key in PerformanceTypeKey]: boolean;\n};\n\nexport interface IThemeSettings {\n  background?: string;\n  backgroundColor?: string;\n  patternColor?: string;\n  isBlurred?: boolean;\n}\n\nexport type LangCode = (\n  'en' | 'ar' | 'be' | 'ca' | 'nl' | 'fr' | 'de' | 'id' | 'it' | 'ko' | 'ms' | 'fa' | 'pl' | 'pt-br' | 'ru' | 'es'\n  | 'tr' | 'uk' | 'uz'\n);\n\nexport type TimeFormat = '24h' | '12h';\n\nexport interface ISettings {\n  theme: ThemeKey;\n  shouldUseSystemTheme: boolean;\n  messageTextSize: number;\n  animationLevel: AnimationLevel;\n  messageSendKeyCombo: 'enter' | 'ctrl-enter';\n  canAutoLoadPhotoFromContacts: boolean;\n  canAutoLoadPhotoInPrivateChats: boolean;\n  canAutoLoadPhotoInGroups: boolean;\n  canAutoLoadPhotoInChannels: boolean;\n  canAutoLoadVideoFromContacts: boolean;\n  canAutoLoadVideoInPrivateChats: boolean;\n  canAutoLoadVideoInGroups: boolean;\n  canAutoLoadVideoInChannels: boolean;\n  canAutoLoadFileFromContacts: boolean;\n  canAutoLoadFileInPrivateChats: boolean;\n  canAutoLoadFileInGroups: boolean;\n  canAutoLoadFileInChannels: boolean;\n  autoLoadFileMaxSizeMb: number;\n  shouldSuggestStickers: boolean;\n  shouldSuggestCustomEmoji: boolean;\n  shouldUpdateStickerSetOrder: boolean;\n  hasPassword?: boolean;\n  language: string;\n  isSensitiveEnabled?: boolean;\n  canChangeSensitive?: boolean;\n  timeFormat: TimeFormat;\n  wasTimeFormatSetManually: boolean;\n  isConnectionStatusMinimized: boolean;\n  shouldArchiveAndMuteNewNonContact?: boolean;\n  shouldNewNonContactPeersRequirePremium?: boolean;\n  shouldHideReadMarks?: boolean;\n  canTranslate: boolean;\n  canTranslateChats: boolean;\n  translationLanguage?: string;\n  doNotTranslate: string[];\n  canDisplayChatInTitle: boolean;\n  shouldForceHttpTransport?: boolean;\n  shouldAllowHttpTransport?: boolean;\n  shouldCollectDebugLogs?: boolean;\n  shouldDebugExportedSenders?: boolean;\n  shouldWarnAboutSvg?: boolean;\n  shouldSkipWebAppCloseConfirmation: boolean;\n  hasContactJoinedNotifications?: boolean;\n  hasWebNotifications: boolean;\n  hasPushNotifications: boolean;\n  notificationSoundVolume: number;\n}\n\nexport type IAnchorPosition = {\n  x: number;\n  y: number;\n};\n\nexport interface ShippingOption {\n  id: string;\n  title: string;\n  amount: number;\n  prices: ApiLabeledPrice[];\n}\n\nexport enum SettingsScreens {\n  Main,\n  EditProfile,\n  Notifications,\n  DataStorage,\n  Language,\n  ActiveSessions,\n  General,\n  GeneralChatBackground,\n  GeneralChatBackgroundColor,\n  Privacy,\n  PrivacyPhoneNumber,\n  PrivacyAddByPhone,\n  PrivacyLastSeen,\n  PrivacyProfilePhoto,\n  PrivacyBio,\n  PrivacyBirthday,\n  PrivacyGifts,\n  PrivacyPhoneCall,\n  PrivacyPhoneP2P,\n  PrivacyForwarding,\n  PrivacyVoiceMessages,\n  PrivacyMessages,\n  PrivacyGroupChats,\n  PrivacyPhoneNumberAllowedContacts,\n  PrivacyPhoneNumberDeniedContacts,\n  PrivacyLastSeenAllowedContacts,\n  PrivacyLastSeenDeniedContacts,\n  PrivacyProfilePhotoAllowedContacts,\n  PrivacyProfilePhotoDeniedContacts,\n  PrivacyBioAllowedContacts,\n  PrivacyBioDeniedContacts,\n  PrivacyBirthdayAllowedContacts,\n  PrivacyBirthdayDeniedContacts,\n  PrivacyGiftsAllowedContacts,\n  PrivacyGiftsDeniedContacts,\n  PrivacyPhoneCallAllowedContacts,\n  PrivacyPhoneCallDeniedContacts,\n  PrivacyPhoneP2PAllowedContacts,\n  PrivacyPhoneP2PDeniedContacts,\n  PrivacyForwardingAllowedContacts,\n  PrivacyForwardingDeniedContacts,\n  PrivacyVoiceMessagesAllowedContacts,\n  PrivacyVoiceMessagesDeniedContacts,\n  PrivacyGroupChatsAllowedContacts,\n  PrivacyGroupChatsDeniedContacts,\n  PrivacyBlockedUsers,\n  Performance,\n  Folders,\n  FoldersCreateFolder,\n  FoldersEditFolder,\n  FoldersEditFolderFromChatList,\n  FoldersEditFolderInvites,\n  FoldersIncludedChats,\n  FoldersIncludedChatsFromChatList,\n  FoldersExcludedChats,\n  FoldersExcludedChatsFromChatList,\n  TwoFaDisabled,\n  TwoFaNewPassword,\n  TwoFaNewPasswordConfirm,\n  TwoFaNewPasswordHint,\n  TwoFaNewPasswordEmail,\n  TwoFaNewPasswordEmailCode,\n  TwoFaEnabled,\n  TwoFaChangePasswordCurrent,\n  TwoFaChangePasswordNew,\n  TwoFaChangePasswordConfirm,\n  TwoFaChangePasswordHint,\n  TwoFaTurnOff,\n  TwoFaRecoveryEmailCurrentPassword,\n  TwoFaRecoveryEmail,\n  TwoFaRecoveryEmailCode,\n  TwoFaCongratulations,\n  ActiveWebsites,\n  PasscodeDisabled,\n  PasscodeNewPasscode,\n  PasscodeNewPasscodeConfirm,\n  PasscodeEnabled,\n  PasscodeChangePasscodeCurrent,\n  PasscodeChangePasscodeNew,\n  PasscodeChangePasscodeConfirm,\n  PasscodeTurnOff,\n  PasscodeCongratulations,\n  Experimental,\n  Stickers,\n  QuickReaction,\n  CustomEmoji,\n  DoNotTranslate,\n  FoldersShare,\n}\n\nexport type StickerSetOrReactionsSetOrRecent = Pick<ApiStickerSet, (\n  'id' | 'accessHash' | 'title' | 'count' | 'stickers' | 'isEmoji' | 'installedDate' | 'isArchived' |\n  'hasThumbnail' | 'hasStaticThumb' | 'hasAnimatedThumb' | 'hasVideoThumb' | 'thumbCustomEmojiId'\n)> & { reactions?: ApiReactionWithPaid[] };\n\nexport enum LeftColumnContent {\n  ChatList,\n  GlobalSearch,\n  Settings,\n  Contacts,\n  Archived,\n  NewChannelStep1,\n  NewChannelStep2,\n  NewGroupStep1,\n  NewGroupStep2,\n}\n\nexport enum GlobalSearchContent {\n  ChatList,\n  ChannelList,\n  BotApps,\n  Media,\n  Links,\n  Files,\n  Music,\n  Voice,\n}\n\nexport enum RightColumnContent {\n  ChatInfo,\n  Management,\n  Statistics,\n  BoostStatistics,\n  MessageStatistics,\n  StoryStatistics,\n  StickerSearch,\n  GifSearch,\n  PollResults,\n  AddingMembers,\n  CreateTopic,\n  EditTopic,\n  MonetizationStatistics,\n}\n\nexport type MediaViewerMedia = ApiPhoto | ApiVideo | ApiDocument;\n\nexport enum MediaViewerOrigin {\n  Inline,\n  ScheduledInline,\n  SharedMedia,\n  ProfileAvatar,\n  SettingsAvatar,\n  MiddleHeaderAvatar,\n  Album,\n  ScheduledAlbum,\n  SearchResult,\n  ChannelAvatar,\n  SuggestedAvatar,\n  StarsTransaction,\n  PreviewMedia,\n  SponsoredMessage,\n}\n\nexport enum StoryViewerOrigin {\n  StoryRibbon,\n  MiddleHeaderAvatar,\n  ChatList,\n  SearchResult,\n}\n\nexport enum AudioOrigin {\n  Inline,\n  SharedMedia,\n  Search,\n  OneTimeModal,\n}\n\nexport enum ChatCreationProgress {\n  Idle,\n  InProgress,\n  Complete,\n  Error,\n}\n\nexport enum ProfileEditProgress {\n  Idle,\n  InProgress,\n  Complete,\n  Error,\n}\n\nexport enum ManagementProgress {\n  Idle,\n  InProgress,\n  Complete,\n  Error,\n}\n\nexport interface ManagementState {\n  isActive: boolean;\n  nextScreen?: ManagementScreens;\n  checkedUsername?: string;\n  isUsernameAvailable?: boolean;\n  error?: string;\n  invites?: ApiExportedInvite[];\n  revokedInvites?: ApiExportedInvite[];\n  editingInvite?: ApiExportedInvite;\n  inviteInfo?: {\n    invite: ApiExportedInvite;\n    importers?: ApiChatInviteImporter[];\n    requesters?: ApiChatInviteImporter[];\n  };\n}\n\nexport enum NewChatMembersProgress {\n  Closed,\n  InProgress,\n  Loading,\n}\n\nexport type ProfileTabType =\n  | 'members'\n  | 'commonChats'\n  | 'media'\n  | 'previewMedia'\n  | 'documents'\n  | 'links'\n  | 'audio'\n  | 'voice'\n  | 'stories'\n  | 'storiesArchive'\n  | 'similarChannels'\n  | 'similarBots'\n  | 'dialogs'\n  | 'gifts';\nexport type SharedMediaType = 'media' | 'documents' | 'links' | 'audio' | 'voice';\nexport type MiddleSearchType = 'chat' | 'myChats' | 'channels';\nexport type MiddleSearchParams = {\n  requestedQuery?: string;\n  savedTag?: ApiReaction;\n  isHashtag?: boolean;\n  fetchingQuery?: string;\n  type: MiddleSearchType;\n  results?: MiddleSearchResults;\n};\nexport type MiddleSearchResults = {\n  query: string;\n  totalCount?: number;\n  nextOffsetId?: number;\n  nextOffsetPeerId?: string;\n  nextOffsetRate?: number;\n  foundIds?: SearchResultKey[];\n};\n\nexport interface LoadingState {\n  areAllItemsLoadedForwards: boolean;\n  areAllItemsLoadedBackwards: boolean;\n}\n\nexport interface ChatMediaSearchSegment {\n  foundIds: number[];\n  loadingState: LoadingState;\n}\n\nexport interface ChatMediaSearchParams {\n  currentSegment: ChatMediaSearchSegment;\n  segments: ChatMediaSearchSegment[];\n  isLoading: boolean;\n}\n\nexport enum ProfileState {\n  Profile,\n  SharedMedia,\n  MemberList,\n  GiftList,\n  StoryList,\n  SavedDialogs,\n}\n\nexport enum PaymentStep {\n  Checkout,\n  SavedPayments,\n  ConfirmPassword,\n  PaymentInfo,\n  ShippingInfo,\n  Shipping,\n  ConfirmPayment,\n}\n\nexport const UPLOADING_WALLPAPER_SLUG = 'UPLOADING_WALLPAPER_SLUG';\n\nexport enum ManagementScreens {\n  Initial,\n  ChatPrivacyType,\n  Discussion,\n  ChannelSubscribers,\n  GroupType,\n  GroupPermissions,\n  GroupRemovedUsers,\n  ChannelRemovedUsers,\n  GroupUserPermissionsCreate,\n  GroupUserPermissions,\n  ChatAdministrators,\n  GroupRecentActions,\n  ChatAdminRights,\n  ChatNewAdminRights,\n  GroupMembers,\n  GroupAddAdmins,\n  Invites,\n  EditInvite,\n  Reactions,\n  InviteInfo,\n  JoinRequests,\n}\n\nexport type ManagementType = 'user' | 'group' | 'channel' | 'bot';\n\nexport type EmojiKeywords = {\n  isLoading?: boolean;\n  version?: number;\n  keywords?: Record<string, string[]>;\n};\n\nexport type InlineBotSettings = {\n  id: string;\n  help?: string;\n  query?: string;\n  offset?: string;\n  canLoadMore?: boolean;\n  results?: (ApiBotInlineResult | ApiBotInlineMediaResult)[];\n  isGallery?: boolean;\n  switchPm?: ApiBotInlineSwitchPm;\n  switchWebview?: ApiBotInlineSwitchWebview;\n  cacheTime: number;\n};\n\nexport type CustomPeerType = 'premium' | 'toBeDistributed' | 'contacts' | 'nonContacts'\n| 'groups' | 'channels' | 'bots' | 'excludeMuted' | 'excludeArchived' | 'excludeRead' | 'stars';\n\nexport type CustomPeer = {\n  isCustomPeer: true;\n  key?: string | number;\n  subtitleKey?: string;\n  avatarIcon?: IconName;\n  isAvatarSquare?: boolean;\n  peerColorId?: number;\n  isVerified?: boolean;\n  fakeType?: ApiFakeType;\n  emojiStatusId?: string;\n  customPeerAvatarColor?: string;\n  withPremiumGradient?: boolean;\n} & ({\n  titleKey: string;\n  title?: undefined;\n} | {\n  title: string;\n  titleKey?: undefined;\n});\n\nexport type UniqueCustomPeer<T = CustomPeerType> = CustomPeer & {\n  type: T;\n};\n\nexport type MessageListType =\n  'thread'\n  | 'pinned'\n  | 'scheduled';\n\nexport type ChatListType = 'active' | 'archived' | 'saved';\n\nexport interface MessageList {\n  chatId: string;\n  threadId: ThreadId;\n  type: MessageListType;\n}\n\nexport interface ActiveEmojiInteraction {\n  id: number;\n  x: number;\n  y: number;\n  messageId?: number;\n  startSize?: number;\n  animatedEffect?: string;\n  isReversed?: boolean;\n}\n\nexport type ActiveDownloads = Record<string, {\n  format: ApiMediaFormat;\n  filename: string;\n  size: number;\n  originChatId?: string;\n  originMessageId?: number;\n}>;\n\nexport type IDimensions = {\n  width: number;\n  height: number;\n};\n\nexport type StarsTransactionType = 'all' | 'inbound' | 'outbound';\nexport type StarsTransactionHistory = Record<StarsTransactionType, {\n  transactions: ApiStarsTransaction[];\n  nextOffset?: string;\n} | undefined>;\nexport type StarsSubscriptions = {\n  list: ApiStarsSubscription[];\n  nextOffset?: string;\n  isLoading?: boolean;\n};\n\nexport type ConfettiStyle = 'poppers' | 'top-down';\n\nexport type StarGiftInfo = {\n  peerId: string;\n  gift: ApiStarGiftRegular;\n  shouldHideName?: boolean;\n  message?: ApiFormattedText;\n  shouldUpgrade?: boolean;\n};\n\nexport interface TabThread {\n  scrollOffset?: number;\n  replyStack?: number[];\n  viewportIds?: number[];\n}\n\nexport interface Thread {\n  lastScrollOffset?: number;\n  lastViewportIds?: number[];\n  listedIds?: number[];\n  outlyingLists?: number[][];\n  pinnedIds?: number[];\n  scheduledIds?: number[];\n  editingId?: number;\n  editingScheduledId?: number;\n  editingDraft?: ApiFormattedText;\n  editingScheduledDraft?: ApiFormattedText;\n  draft?: ApiDraft;\n  noWebPage?: boolean;\n  threadInfo?: ApiThreadInfo;\n  firstMessageId?: number;\n  typingStatus?: ApiTypingStatus;\n}\n\nexport interface ServiceNotification {\n  id: number;\n  message: ApiMessage;\n  version?: string;\n  isUnread?: boolean;\n  isDeleted?: boolean;\n}\n\nexport interface TopicsInfo {\n  totalCount: number;\n  topicsById: Record<ThreadId, ApiTopic>;\n  listedTopicIds?: number[];\n  orderedPinnedTopicIds?: number[];\n}\n\nexport type TranslatedMessage = {\n  isPending?: boolean;\n  text?: ApiFormattedText;\n};\n\nexport type ChatTranslatedMessages = {\n  byLangCode: Record<string, Record<number, TranslatedMessage>>;\n};\n\nexport type ChatRequestedTranslations = {\n  toLanguage?: string;\n  manualMessages?: Record<number, string>;\n};\n\nexport type SimilarBotsInfo = {\n  similarBotsIds?: string[];\n  count: number;\n};\n\nexport type ConfettiParams = OptionalCombine<{\n  style?: ConfettiStyle;\n  withStars?: boolean;\n}, {\n  top?: number;\n  left?: number;\n  width?: number;\n  height?: number;\n}>;\n\nexport interface Size {\n  width: number;\n  height: number;\n}\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport type WebPageMediaSize = 'large' | 'small';\n\nexport type StarGiftCategory = number | 'all' | 'limited' | 'stock';\n\nexport type CallSound = (\n  'join' | 'allowTalk' | 'leave' | 'connecting' | 'incoming' | 'end' | 'connect' | 'busy' | 'ringing'\n);\n\nexport type BotAppPermissions = {\n  geolocation?: boolean;\n};\n\nexport type GiftProfileFilterOptions = {\n  sortType: 'byDate' | 'byValue';\n  shouldIncludeUnlimited: boolean;\n  shouldIncludeLimited: boolean;\n  shouldIncludeUnique: boolean;\n  shouldIncludeDisplayed: boolean;\n  shouldIncludeHidden: boolean;\n};\n","export default class Deferred<T = void> {\n  promise: Promise<T>;\n\n  reject!: (reason?: any) => void;\n\n  resolve!: (value: T | PromiseLike<T>) => void;\n\n  constructor() {\n    this.promise = new Promise((resolve, reject) => {\n      this.reject = reject;\n      this.resolve = resolve;\n    });\n  }\n\n  static resolved(): Deferred<void>;\n  static resolved<T>(value: T): Deferred<T>;\n  static resolved<T>(value?: T): Deferred<T | void> {\n    const deferred = new Deferred<T | void>();\n    deferred.resolve(value);\n    return deferred;\n  }\n}\n","import type { Scheduler } from './schedulers';\n\nimport { requestMeasure } from '../lib/fasterdom/fasterdom';\n\ninterface AnimationInstance {\n  isCancelled: boolean;\n}\n\nlet currentInstance: AnimationInstance | undefined;\n\nexport function animateSingle(tick: Function, schedulerFn: Scheduler, instance?: AnimationInstance) {\n  if (!instance) {\n    if (currentInstance && !currentInstance.isCancelled) {\n      currentInstance.isCancelled = true;\n    }\n\n    instance = { isCancelled: false };\n    currentInstance = instance;\n  }\n\n  if (!instance!.isCancelled && tick()) {\n    schedulerFn(() => {\n      animateSingle(tick, schedulerFn, instance);\n    });\n  }\n}\n\nexport function cancelSingleAnimation() {\n  const dumbScheduler = (cb: AnyFunction) => cb;\n  const dumbCb = () => undefined;\n\n  animateSingle(dumbCb, dumbScheduler);\n}\n\nexport function animate(tick: Function, schedulerFn: Scheduler) {\n  schedulerFn(() => {\n    if (tick()) {\n      animate(tick, schedulerFn);\n    }\n  });\n}\n\nexport function animateInstantly(tick: Function, schedulerFn: Scheduler) {\n  if (tick()) {\n    schedulerFn(() => {\n      animateInstantly(tick, schedulerFn);\n    });\n  }\n}\n\ntype TimingFn = (t: number) => number;\n\ntype AnimateNumberProps<T extends number | number[]> = {\n  to: T;\n  from: T;\n  duration: number;\n  onUpdate: (value: T) => void;\n  timing?: TimingFn;\n  onEnd?: (isCanceled?: boolean) => void;\n};\n\nexport const timingFunctions = {\n  linear: (t: number) => t,\n  easeIn: (t: number) => t ** 1.675,\n  easeOut: (t: number) => -1 * t ** 1.675,\n  easeInOut: (t: number) => 0.5 * (Math.sin((t - 0.5) * Math.PI) + 1),\n  easeInQuad: (t: number) => t * t,\n  easeOutQuad: (t: number) => t * (2 - t),\n  easeInOutQuad: (t: number) => (t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t),\n  easeInCubic: (t: number) => t ** 3,\n  easeOutCubic: (t: number) => (--t) * t * t + 1,\n  easeInOutCubic: (t: number) => (t < 0.5 ? 4 * t ** 3 : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1),\n  easeInQuart: (t: number) => t ** 4,\n  easeOutQuart: (t: number) => 1 - (--t) * t ** 3,\n  easeInOutQuart: (t: number) => (t < 0.5 ? 8 * t ** 4 : 1 - 8 * (--t) * t ** 3),\n  easeInQuint: (t: number) => t ** 5,\n  easeOutQuint: (t: number) => 1 + (--t) * t ** 4,\n  easeInOutQuint: (t: number) => (t < 0.5 ? 16 * t ** 5 : 1 + 16 * (--t) * t ** 4),\n};\n\nexport function animateNumber<T extends number | number[]>({\n  timing = timingFunctions.linear,\n  onUpdate,\n  duration,\n  onEnd,\n  from,\n  to,\n}: AnimateNumberProps<T>) {\n  const t0 = Date.now();\n\n  let isCanceled = false;\n\n  animateInstantly(() => {\n    if (isCanceled) return false;\n\n    const t1 = Date.now();\n    const t = Math.min((t1 - t0) / duration, 1);\n\n    const progress = timing(t);\n    if (typeof from === 'number' && typeof to === 'number') {\n      onUpdate((from + ((to - from) * progress)) as T);\n    } else if (Array.isArray(from) && Array.isArray(to)) {\n      const result = from.map((f, i) => f + ((to[i] - f) * progress));\n      onUpdate(result as T);\n    }\n\n    if (t === 1) {\n      onEnd?.();\n    }\n\n    return t < 1;\n  }, requestMeasure);\n\n  return () => {\n    isCanceled = true;\n    onEnd?.(true);\n  };\n}\n\nexport function applyStyles(element: HTMLElement, css: Record<string, string>) {\n  Object.assign(element.style, css);\n}\n","import { getGlobal } from '../global';\n\nimport { DEBUG } from '../config';\nimport { selectTabState } from '../global/selectors';\n\nexport function updateAppBadge(unreadCount: number) {\n  if (!selectTabState(getGlobal()).isMasterTab) return;\n  if (typeof window.navigator.setAppBadge !== 'function') {\n    return;\n  }\n\n  window.navigator.setAppBadge(unreadCount).catch((err) => {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.error(err);\n    }\n  });\n}\n","export function areDeepEqual<T extends any>(value1: T, value2: T): boolean {\n  const type1 = typeof value1;\n  const type2 = typeof value2;\n  if (type1 !== type2) {\n    return false;\n  }\n\n  // eslint-disable-next-line no-null/no-null\n  if (type1 !== 'object' || value1 === null || value2 === null) {\n    return value1 === value2;\n  }\n\n  const isArray1 = Array.isArray(value1);\n  const isArray2 = Array.isArray(value2);\n\n  if (isArray1 !== isArray2) {\n    return false;\n  }\n\n  if (isArray1) {\n    const array1 = value1 as any[];\n    const array2 = value2 as any[];\n\n    if (array1.length !== array2.length) {\n      return false;\n    }\n\n    return array1.every((member1, i) => areDeepEqual(member1, array2[i]));\n  }\n\n  const object1 = value1 as AnyLiteral;\n  const object2 = value2 as AnyLiteral;\n  const keys1 = Object.keys(object1);\n\n  return keys1.length === Object.keys(object2).length\n    && keys1.every((key1) => areDeepEqual(object1[key1], object2[key1]));\n}\n","export default function arePropsShallowEqual(currentProps: AnyLiteral, newProps: AnyLiteral) {\n  if (currentProps === newProps) {\n    return true;\n  }\n\n  const currentKeys = Object.keys(currentProps);\n  const currentKeysLength = currentKeys.length;\n  const newKeysLength = Object.keys(newProps).length;\n\n  if (currentKeysLength !== newKeysLength) {\n    return false;\n  }\n\n  if (currentKeysLength === 0) {\n    return true;\n  }\n\n  for (let i = 0; i < currentKeysLength; i++) {\n    const prop = currentKeys[i];\n    if (currentProps[prop] !== newProps[prop]) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nexport function logUnequalProps(currentProps: AnyLiteral, newProps: AnyLiteral, msg: string, debugKey = '') {\n  const currentKeys = Object.keys(currentProps);\n  const currentKeysLength = currentKeys.length;\n  const newKeysLength = Object.keys(newProps).length;\n\n  if (currentKeysLength !== newKeysLength) {\n    // eslint-disable-next-line no-console\n    console.log(`${msg} LENGTH`);\n    return;\n  }\n\n  // eslint-disable-next-line no-console\n  console.log(msg);\n  currentKeys.forEach((prop) => {\n    if (currentProps[prop] !== newProps[prop]) {\n      // eslint-disable-next-line no-console\n      console.log(debugKey, prop, ':', currentProps[prop], '=>', newProps[prop]);\n    }\n  });\n}\n","function promisifyRequest(request) {\n    return new Promise((resolve, reject) => {\n        // @ts-ignore - file size hacks\n        request.oncomplete = request.onsuccess = () => resolve(request.result);\n        // @ts-ignore - file size hacks\n        request.onabort = request.onerror = () => reject(request.error);\n    });\n}\nfunction createStore(dbName, storeName) {\n    const request = indexedDB.open(dbName);\n    request.onupgradeneeded = () => request.result.createObjectStore(storeName);\n    const dbp = promisifyRequest(request);\n    return (txMode, callback) => dbp.then((db) => callback(db.transaction(storeName, txMode).objectStore(storeName)));\n}\nlet defaultGetStoreFunc;\nfunction defaultGetStore() {\n    if (!defaultGetStoreFunc) {\n        defaultGetStoreFunc = createStore('keyval-store', 'keyval');\n    }\n    return defaultGetStoreFunc;\n}\n/**\n * Get a value by its key.\n *\n * @param key\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction get(key, customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => promisifyRequest(store.get(key)));\n}\n/**\n * Set a value with a key.\n *\n * @param key\n * @param value\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction set(key, value, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        store.put(value, key);\n        return promisifyRequest(store.transaction);\n    });\n}\n/**\n * Set multiple values at once. This is faster than calling set() multiple times.\n * It's also atomic – if one of the pairs can't be added, none will be added.\n *\n * @param entries Array of entries, where each entry is an array of `[key, value]`.\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction setMany(entries, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        entries.forEach((entry) => store.put(entry[1], entry[0]));\n        return promisifyRequest(store.transaction);\n    });\n}\n/**\n * Get multiple values by their keys\n *\n * @param keys\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction getMany(keys, customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => Promise.all(keys.map((key) => promisifyRequest(store.get(key)))));\n}\n/**\n * Update a value. This lets you see the old value and update it as an atomic operation.\n *\n * @param key\n * @param updater A callback that takes the old value and returns a new value.\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction update(key, updater, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => \n    // Need to create the promise manually.\n    // If I try to chain promises, the transaction closes in browsers\n    // that use a promise polyfill (IE10/11).\n    new Promise((resolve, reject) => {\n        store.get(key).onsuccess = function () {\n            try {\n                store.put(updater(this.result), key);\n                resolve(promisifyRequest(store.transaction));\n            }\n            catch (err) {\n                reject(err);\n            }\n        };\n    }));\n}\n/**\n * Delete a particular key from the store.\n *\n * @param key\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction del(key, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        store.delete(key);\n        return promisifyRequest(store.transaction);\n    });\n}\n/**\n * Delete multiple keys at once.\n *\n * @param keys List of keys to delete.\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction delMany(keys, customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        keys.forEach((key) => store.delete(key));\n        return promisifyRequest(store.transaction);\n    });\n}\n/**\n * Clear all values in the store.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction clear(customStore = defaultGetStore()) {\n    return customStore('readwrite', (store) => {\n        store.clear();\n        return promisifyRequest(store.transaction);\n    });\n}\nfunction eachCursor(store, callback) {\n    store.openCursor().onsuccess = function () {\n        if (!this.result)\n            return;\n        callback(this.result);\n        this.result.continue();\n    };\n    return promisifyRequest(store.transaction);\n}\n/**\n * Get all keys in the store.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction keys(customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => {\n        // Fast path for modern browsers\n        if (store.getAllKeys) {\n            return promisifyRequest(store.getAllKeys());\n        }\n        const items = [];\n        return eachCursor(store, (cursor) => items.push(cursor.key)).then(() => items);\n    });\n}\n/**\n * Get all values in the store.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction values(customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => {\n        // Fast path for modern browsers\n        if (store.getAll) {\n            return promisifyRequest(store.getAll());\n        }\n        const items = [];\n        return eachCursor(store, (cursor) => items.push(cursor.value)).then(() => items);\n    });\n}\n/**\n * Get all entries in the store. Each entry is an array of `[key, value]`.\n *\n * @param customStore Method to get a custom store. Use with caution (see the docs).\n */\nfunction entries(customStore = defaultGetStore()) {\n    return customStore('readonly', (store) => {\n        // Fast path for modern browsers\n        // (although, hopefully we'll get a simpler path some day)\n        if (store.getAll && store.getAllKeys) {\n            return Promise.all([\n                promisifyRequest(store.getAllKeys()),\n                promisifyRequest(store.getAll()),\n            ]).then(([keys, values]) => keys.map((key, i) => [key, values[i]]));\n        }\n        const items = [];\n        return customStore('readonly', (store) => eachCursor(store, (cursor) => items.push([cursor.key, cursor.value])).then(() => items));\n    });\n}\n\nexport { clear, createStore, del, delMany, entries, get, getMany, keys, promisifyRequest, set, setMany, update, values };\n","import {\n  clear,\n  createStore,\n  del,\n  delMany,\n  entries as getEntries,\n  get,\n  getMany,\n  keys as getKeys,\n  set,\n  setMany,\n  update,\n  values as getValues,\n} from 'idb-keyval';\n\nclass IdbStore {\n  public store: ReturnType<typeof createStore>;\n\n  constructor(name: string) {\n    this.store = createStore(name, 'store');\n  }\n\n  public set(key: string, value: any) {\n    return set(key, value, this.store);\n  }\n\n  public setMany(entries: [string, any][]) {\n    return setMany(entries, this.store);\n  }\n\n  public get<T = unknown>(key: string) {\n    return get<T>(key, this.store);\n  }\n\n  public getMany<T = unknown>(keys: string[]) {\n    return getMany<T>(keys, this.store);\n  }\n\n  public clear() {\n    return clear(this.store);\n  }\n\n  public del(key: string) {\n    return del(key, this.store);\n  }\n\n  public delMany(keys: string[]) {\n    return delMany(keys, this.store);\n  }\n\n  public entries() {\n    return getEntries(this.store);\n  }\n\n  public keys() {\n    return getKeys(this.store);\n  }\n\n  public values<T = unknown>() {\n    return getValues<T>(this.store);\n  }\n\n  public update<T = unknown>(key: string, updater: (oldValue: T | undefined) => T) {\n    return update(key, updater, this.store);\n  }\n}\n\nexport const MAIN_IDB_STORE = new IdbStore('tt-data');\nexport const PASSCODE_IDB_STORE = new IdbStore('tt-passcode');\n","export default function unloadVideo(video: HTMLVideoElement) {\n  video.pause();\n  // https://github.com/shaka-project/shaka-player/commit/0e3d10e61cb08cc35750e48face4e58f24542fc8\n  video.removeAttribute('src');\n  while (video.firstChild) {\n    video.removeChild(video.firstChild);\n  }\n\n  video.load();\n}\n","/* eslint-disable no-nested-ternary */\n/* eslint-disable no-bitwise */\n/* eslint-disable @typescript-eslint/naming-convention */\n\nconst utf16 = {\n  // The utf16-class is necessary to convert from javascripts internal character representation to unicode and back.\n  decode: (input) => {\n    const output = [];\n    let i = 0;\n    const len = input.length;\n    let value;\n    let extra;\n\n    while (i < len) {\n      value = input.charCodeAt(i++);\n      if ((value & 0xf800) === 0xd800) {\n        extra = input.charCodeAt(i++);\n        if ((value & 0xfc00) !== 0xd800 || (extra & 0xfc00) !== 0xdc00) {\n          throw new RangeError('UTF-16(decode): Illegal UTF-16 sequence');\n        }\n        value = ((value & 0x3ff) << 10) + (extra & 0x3ff) + 0x10000;\n      }\n      output.push(value);\n    }\n    return output;\n  },\n  encode: (input) => {\n    const output = [];\n    let i = 0;\n    const len = input.length;\n    let value;\n\n    while (i < len) {\n      value = input[i++];\n      if ((value & 0xf800) === 0xd800) {\n        throw new RangeError('UTF-16(encode): Illegal UTF-16 value');\n      }\n      if (value > 0xffff) {\n        value -= 0x10000;\n        output.push(String.fromCharCode(((value >>> 10) & 0x3ff) | 0xd800));\n        value = 0xdc00 | (value & 0x3ff);\n      }\n      output.push(String.fromCharCode(value));\n    }\n    return output.join('');\n  },\n};\n\n// Default parameters\nconst initial_n = 0x80;\nconst initial_bias = 72;\nconst delimiter = '\\x2D';\nconst base = 36;\nconst damp = 700;\nconst tmin = 1;\nconst tmax = 26;\nconst skew = 38;\nconst maxint = 0x7fffffff;\n\n// decode_digit(cp) returns the numeric value of a basic code\n// point (for use in representing integers) in the range 0 to\n// base-1, or base if cp is does not represent a value.\n\nfunction decode_digit(cp) {\n  return cp - 48 < 10 ? cp - 22 : cp - 65 < 26 ? cp - 65 : cp - 97 < 26 ? cp - 97 : base;\n}\n\n// ** Bias adaptation function **\nfunction adapt(delta, numpoints, firsttime) {\n  let k;\n  delta = firsttime ? Math.floor(delta / damp) : delta >> 1;\n  delta += Math.floor(delta / numpoints);\n\n  for (k = 0; delta > ((base - tmin) * tmax) >> 1; k += base) {\n    delta = Math.floor(delta / (base - tmin));\n  }\n  return Math.floor(k + ((base - tmin + 1) * delta) / (delta + skew));\n}\n\n// Main decode\nfunction decode(input, preserveCase) {\n  // Dont use utf16\n  const output = [];\n  const case_flags = [];\n  const input_length = input.length;\n\n  let n; let out; let i; let bias; let basic; let j; let ic; let oldi; let w; let k; let digit; let t; let len;\n\n  // Initialize the state:\n\n  n = initial_n;\n  i = 0;\n  bias = initial_bias;\n\n  // Handle the basic code points: Let basic be the number of input code\n  // points before the last delimiter, or 0 if there is none, then\n  // copy the first basic code points to the output.\n\n  basic = input.lastIndexOf(delimiter);\n  if (basic < 0) basic = 0;\n\n  for (j = 0; j < basic; ++j) {\n    if (preserveCase) case_flags[output.length] = input.charCodeAt(j) - 65 < 26;\n    if (input.charCodeAt(j) >= 0x80) {\n      throw new RangeError('Illegal input >= 0x80');\n    }\n    output.push(input.charCodeAt(j));\n  }\n\n  // Main decoding loop: Start just after the last delimiter if any\n  // basic code points were copied; start at the beginning otherwise.\n\n  for (ic = basic > 0 ? basic + 1 : 0; ic < input_length;) {\n    // ic is the index of the next character to be consumed,\n\n    // Decode a generalized variable-length integer into delta,\n    // which gets added to i. The overflow checking is easier\n    // if we increase i as we go, then subtract off its starting\n    // value at the end to obtain delta.\n    for (oldi = i, w = 1, k = base; ; k += base) {\n      if (ic >= input_length) {\n        throw RangeError('punycode_bad_input(1)');\n      }\n      digit = decode_digit(input.charCodeAt(ic++));\n\n      if (digit >= base) {\n        throw RangeError('punycode_bad_input(2)');\n      }\n      if (digit > Math.floor((maxint - i) / w)) {\n        throw RangeError('punycode_overflow(1)');\n      }\n      i += digit * w;\n      t = k <= bias ? tmin : k >= bias + tmax ? tmax : k - bias;\n      if (digit < t) {\n        break;\n      }\n      if (w > Math.floor(maxint / (base - t))) {\n        throw RangeError('punycode_overflow(2)');\n      }\n      w *= base - t;\n    }\n\n    out = output.length + 1;\n    bias = adapt(i - oldi, out, oldi === 0);\n\n    // i was supposed to wrap around from out to 0,\n    // incrementing n each time, so we'll fix that now:\n    if (Math.floor(i / out) > maxint - n) {\n      throw RangeError('punycode_overflow(3)');\n    }\n    n += Math.floor(i / out);\n    i %= out;\n\n    // Insert n at position i of the output:\n    // Case of last character determines uppercase flag:\n    if (preserveCase) {\n      case_flags.splice(i, 0, input.charCodeAt(ic - 1) - 65 < 26);\n    }\n\n    output.splice(i, 0, n);\n    i++;\n  }\n  if (preserveCase) {\n    for (i = 0, len = output.length; i < len; i++) {\n      if (case_flags[i]) {\n        output[i] = String.fromCharCode(output[i])\n          .toUpperCase()\n          .charCodeAt(0);\n      }\n    }\n  }\n  return utf16.encode(output);\n}\n\nfunction toUnicode(domain) {\n  const domain_array = domain.split('.');\n  const out = [];\n  for (let i = 0; i < domain_array.length; ++i) {\n    const s = domain_array[i];\n    out.push(s.match(/^xn--/) ? decode(s.slice(4)) : s);\n  }\n  return out.join('.');\n}\n\nexport default toUnicode;\n","import { DEBUG } from '../../config';\nimport convertPunycode from '../../lib/punycode';\n\nconst PROTOCOL_WHITELIST = new Set(['http:', 'https:', 'tg:', 'ton:', 'mailto:', 'tel:']);\nconst FALLBACK_PREFIX = 'https://';\n\nexport function ensureProtocol(url: string) {\n  try {\n    const parsedUrl = new URL(url);\n    // eslint-disable-next-line no-script-url\n    if (!PROTOCOL_WHITELIST.has(parsedUrl.protocol)) {\n      return `${FALLBACK_PREFIX}${url}`;\n    }\n\n    return url;\n  } catch (err) {\n    return `${FALLBACK_PREFIX}${url}`;\n  }\n}\n\nexport function getUnicodeUrl(url: string) {\n  const href = ensureProtocol(url);\n\n  try {\n    const parsedUrl = new URL(href);\n    const unicodeDomain = convertPunycode(parsedUrl.hostname);\n\n    try {\n      return decodeURI(parsedUrl.toString()).replace(parsedUrl.hostname, unicodeDomain);\n    } catch (err) { // URL contains invalid sequences, keep it as it is\n      return parsedUrl.toString().replace(parsedUrl.hostname, unicodeDomain);\n    }\n  } catch (error) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('SafeLink.getDecodedUrl error ', url, error);\n    }\n  }\n\n  return undefined;\n}\n\nexport function isMixedScriptUrl(url: string): boolean {\n  let domain;\n  try {\n    domain = convertPunycode(new URL(ensureProtocol(url)!).hostname);\n  } catch (e) {\n    return true; // If URL is invalid, treat it as mixed script\n  }\n\n  let hasLatin = false;\n  let hasNonLatin = false;\n\n  for (const char of Array.from(domain)) {\n    if (!/\\p{L}/u.test(char)) continue; // Ignore non-letter characters\n\n    if (/\\p{Script=Latin}/u.test(char)) {\n      hasLatin = true;\n    } else {\n      hasNonLatin = true;\n    }\n\n    if (hasLatin && hasNonLatin) return true;\n  }\n\n  return false;\n}\n","type Parts = (string | false | undefined)[];\ntype PartsWithGlobals = (string | false | undefined | string[])[];\ntype ClassNameBuilder =\n  ((elementName: string, ...modifiers: PartsWithGlobals) => string)\n  & Record<string, string>;\n\nexport default function buildClassName(...parts: Parts) {\n  return parts.filter(Boolean).join(' ');\n}\n\nexport function createClassNameBuilder(componentName: string) {\n  return ((elementName: string, ...modifiers: PartsWithGlobals) => {\n    const baseName = elementName === '&' ? componentName : `${componentName}__${elementName}`;\n\n    return modifiers.reduce<string[]>((acc, modifier) => {\n      if (modifier) {\n        // A bit hacky way to pass global class names\n        if (Array.isArray(modifier)) {\n          acc.push(...modifier);\n        } else {\n          acc.push(`${baseName}--${modifier}`);\n        }\n      }\n\n      return acc;\n    }, [baseName]).join(' ');\n  }) as ClassNameBuilder;\n}\n","type Parts = (string | false | undefined)[];\n\nexport default function buildStyle(...parts: Parts) {\n  return parts.filter(Boolean).join(';');\n}\n","import { ELECTRON_HOST_URL, IS_PACKAGED_ELECTRON } from '../config';\n\n// eslint-disable-next-line no-restricted-globals\nconst cacheApi = self.caches;\n\nlet isSupported: boolean | undefined;\n\nexport async function isCacheApiSupported() {\n  if (!cacheApi) return false;\n\n  isSupported = isSupported ?? await cacheApi.has('test').then(() => true).catch(() => false);\n  return isSupported;\n}\n\nexport enum Type {\n  Text,\n  Blob,\n  Json,\n  ArrayBuffer,\n}\n\nexport async function fetch(\n  cacheName: string, key: string, type: Type, isHtmlAllowed = false,\n) {\n  if (!cacheApi) {\n    return undefined;\n  }\n\n  try {\n    // To avoid the error \"Request scheme 'webdocument' is unsupported\"\n    const request = IS_PACKAGED_ELECTRON\n      ? `${ELECTRON_HOST_URL}/${key.replace(/:/g, '_')}`\n      : new Request(key.replace(/:/g, '_'));\n    const cache = await cacheApi.open(cacheName);\n    const response = await cache.match(request);\n    if (!response) {\n      return undefined;\n    }\n\n    const contentType = response.headers.get('Content-Type');\n\n    switch (type) {\n      case Type.Text:\n        return await response.text();\n      case Type.Blob: {\n        // Ignore deprecated data-uri avatars\n        if (key.startsWith('avatar') && contentType && contentType.startsWith('text')) {\n          return undefined;\n        }\n\n        const blob = await response.blob();\n        const shouldRecreate = !blob.type || (!isHtmlAllowed && blob.type.includes('html'));\n        // iOS Safari fails to preserve `type` in cache\n        let resolvedType = blob.type || contentType;\n\n        if (!(shouldRecreate && resolvedType)) {\n          return blob;\n        }\n\n        // Prevent HTML-in-video attacks (for files that were cached before fix)\n        if (!isHtmlAllowed) {\n          resolvedType = resolvedType.replace(/html/gi, '');\n        }\n\n        return new Blob([blob], { type: resolvedType });\n      }\n      case Type.Json:\n        return await response.json();\n      case Type.ArrayBuffer:\n        return await response.arrayBuffer();\n      default:\n        return undefined;\n    }\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.warn(err);\n    return undefined;\n  }\n}\n\nexport async function save(cacheName: string, key: string, data: AnyLiteral | Blob | ArrayBuffer | string) {\n  if (!cacheApi) {\n    return false;\n  }\n\n  try {\n    const cacheData = typeof data === 'string' || data instanceof Blob || data instanceof ArrayBuffer\n      ? data\n      : JSON.stringify(data);\n    // To avoid the error \"Request scheme 'webdocument' is unsupported\"\n    const request = IS_PACKAGED_ELECTRON\n      ? `${ELECTRON_HOST_URL}/${key.replace(/:/g, '_')}`\n      : new Request(key.replace(/:/g, '_'));\n    const response = new Response(cacheData);\n    const cache = await cacheApi.open(cacheName);\n    await cache.put(request, response);\n    return true;\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.warn(err);\n    return false;\n  }\n}\n\nexport async function remove(cacheName: string, key: string) {\n  try {\n    if (!cacheApi) {\n      return undefined;\n    }\n\n    const cache = await cacheApi.open(cacheName);\n    return await cache.delete(key);\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.warn(err);\n    return undefined;\n  }\n}\n\nexport async function clear(cacheName: string) {\n  try {\n    if (!cacheApi) {\n      return undefined;\n    }\n\n    return await cacheApi.delete(cacheName);\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.warn(err);\n    return undefined;\n  }\n}\n","export function createCallbackManager<T extends AnyToVoidFunction = AnyToVoidFunction>() {\n  const callbacks = new Set<T>();\n\n  function addCallback(cb: T) {\n    callbacks.add(cb);\n\n    return () => {\n      removeCallback(cb);\n    };\n  }\n\n  function removeCallback(cb: T) {\n    callbacks.delete(cb);\n  }\n\n  function runCallbacks(...args: Parameters<T>) {\n    callbacks.forEach((callback) => {\n      callback(...args);\n    });\n  }\n\n  function hasCallbacks() {\n    return Boolean(callbacks.size);\n  }\n\n  return {\n    runCallbacks,\n    addCallback,\n    removeCallback,\n    hasCallbacks,\n  };\n}\n\nexport type CallbackManager<T extends AnyToVoidFunction = AnyToVoidFunction>\n  = ReturnType<typeof createCallbackManager<T>>;\n","import captureKeyboardListener from './captureKeyboardListeners';\n\ntype IHandlerFunction = () => void;\n\nexport default function captureEscKeyListener(handler: IHandlerFunction) {\n  return captureKeyboardListener({ onEsc: handler });\n}\n","import { Lethargy } from './lethargy';\nimport { clamp, round } from './math';\nimport { debounce } from './schedulers';\nimport { IS_IOS, IS_WINDOWS } from './windowEnvironment';\nimport windowSize from './windowSize';\n\nexport enum SwipeDirection {\n  Up,\n  Down,\n  Left,\n  Right,\n}\n\nexport interface MoveOffsets {\n  dragOffsetX: number;\n  dragOffsetY: number;\n}\n\ninterface CaptureOptions {\n  onCapture?: (e: MouseEvent | TouchEvent | WheelEvent) => void;\n  onRelease?: (e: MouseEvent | TouchEvent | WheelEvent) => void;\n  onDrag?: (\n    e: MouseEvent | TouchEvent | WheelEvent,\n    captureEvent: MouseEvent | TouchEvent | WheelEvent,\n    offsets: MoveOffsets,\n    cancelDrag?: (x: boolean, y: boolean) => void,\n  ) => void;\n  onSwipe?: (e: Event, direction: SwipeDirection, offsets: MoveOffsets) => boolean;\n  onZoom?: (e: TouchEvent | WheelEvent, params: {\n    // Absolute zoom level\n    zoom?: number;\n    // Relative zoom factor\n    zoomFactor?: number;\n\n    // center coordinate of the initial pinch\n    initialCenterX: number;\n    initialCenterY: number;\n\n    // offset of the pinch center (current from initial)\n    dragOffsetX: number;\n    dragOffsetY: number;\n\n    // center coordinate of the current pinch\n    currentCenterX: number;\n    currentCenterY: number;\n  }) => void;\n  onClick?: (e: MouseEvent | TouchEvent) => void;\n  onDoubleClick?: (e: MouseEvent | RealTouchEvent | WheelEvent, params: { centerX: number; centerY: number }) => void;\n  excludedClosestSelector?: string;\n  includedClosestSelector?: string;\n  selectorToPreventScroll?: string;\n  withNativeDrag?: boolean;\n  maxZoom?: number;\n  minZoom?: number;\n  doubleTapZoom?: number;\n  initialZoom?: number;\n  isNotPassive?: boolean;\n  withCursor?: boolean;\n  swipeThreshold?: number;\n  withWheelDrag?: boolean;\n}\n\n// https://stackoverflow.com/questions/11287877/how-can-i-get-e-offsetx-on-mobile-ipad\n// Android does not have this value, and iOS has it but as read-only\nexport interface RealTouchEvent extends TouchEvent {\n  pageX?: number;\n  pageY?: number;\n}\n\ntype TSwipeAxis =\n  'x'\n  | 'y'\n  | undefined;\n\nexport const IOS_SCREEN_EDGE_THRESHOLD = 20;\nexport const SWIPE_DIRECTION_THRESHOLD = 10;\nexport const SWIPE_DIRECTION_TOLERANCE = 1.5;\n\nconst MOVE_THRESHOLD = 15;\nconst SWIPE_THRESHOLD_DEFAULT = 20;\nconst RELEASE_WHEEL_ZOOM_DELAY = 150;\nconst RELEASE_WHEEL_DRAG_DELAY = 150;\n\nfunction getDistance(a: Touch, b?: Touch) {\n  if (!b) return 0;\n  return Math.hypot((b.pageX - a.pageX), (b.pageY - a.pageY));\n}\n\nfunction getTouchCenter(a: Touch, b: Touch) {\n  return {\n    x: (a.pageX + b.pageX) / 2,\n    y: (a.pageY + b.pageY) / 2,\n  };\n}\n\nlet lastClickTime = 0;\nconst lethargy = new Lethargy({\n  stability: 5,\n  sensitivity: 25,\n  tolerance: IS_WINDOWS ? 1 : 0.6, // Windows `scrollDelta` does not die down to 0\n  delay: 150,\n});\n\nexport function captureEvents(element: HTMLElement, options: CaptureOptions) {\n  let captureEvent: MouseEvent | RealTouchEvent | WheelEvent | undefined;\n  let hasMoved = false;\n  let hasSwiped = false;\n  let isZooming = false;\n  let initialDistance = 0;\n  let wheelZoom = options.initialZoom ?? 1;\n  let initialDragOffset = {\n    x: 0,\n    y: 0,\n  };\n  let isDragCanceled = {\n    x: false,\n    y: false,\n  };\n  const currentWindowSize = windowSize.get();\n  let initialTouchCenter = {\n    x: currentWindowSize.width / 2,\n    y: currentWindowSize.height / 2,\n  };\n  let initialSwipeAxis: TSwipeAxis | undefined;\n  const minZoom = options.minZoom ?? 1;\n  const maxZoom = options.maxZoom ?? 4;\n\n  function onCapture(e: MouseEvent | RealTouchEvent) {\n    const target = e.target as HTMLElement;\n    const {\n      excludedClosestSelector,\n      includedClosestSelector,\n      withNativeDrag,\n      withCursor,\n      onDrag,\n    } = options;\n\n    if (element !== target && !element.contains(target)) {\n      return;\n    }\n\n    if (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA') {\n      return;\n    }\n\n    if (\n      (excludedClosestSelector && (target.matches(excludedClosestSelector) || target.closest(excludedClosestSelector)))\n      || (\n        includedClosestSelector && !(target.matches(includedClosestSelector) || target.closest(includedClosestSelector))\n      )\n    ) {\n      return;\n    }\n\n    captureEvent = e;\n\n    if (e.type === 'mousedown') {\n      if (!withNativeDrag && onDrag) {\n        e.preventDefault();\n      }\n\n      document.addEventListener('mousemove', onMove);\n      document.addEventListener('mouseup', onRelease);\n    } else if (e.type === 'touchstart') {\n      // We need to always listen on `touchstart` target:\n      // https://stackoverflow.com/questions/33298828/touch-move-event-dont-fire-after-touch-start-target-is-removed\n      target.addEventListener('touchmove', onMove, { passive: true });\n      target.addEventListener('touchend', onRelease, { passive: true });\n      target.addEventListener('touchcancel', onRelease, { passive: true });\n\n      if ('touches' in e) {\n        if (e.pageX === undefined) {\n          e.pageX = e.touches[0].pageX;\n        }\n\n        if (e.pageY === undefined) {\n          e.pageY = e.touches[0].pageY;\n        }\n\n        if (e.touches.length === 2) {\n          initialDistance = getDistance(e.touches[0], e.touches[1]);\n          initialTouchCenter = getTouchCenter(e.touches[0], e.touches[1]);\n        }\n      }\n    }\n\n    if (withCursor) {\n      document.body.classList.add('cursor-grabbing');\n    }\n\n    options.onCapture?.(e);\n  }\n\n  function onRelease(e?: MouseEvent | TouchEvent) {\n    if (captureEvent) {\n      if (options.withCursor) {\n        document.body.classList.remove('cursor-grabbing');\n      }\n\n      document.removeEventListener('mouseup', onRelease);\n      document.removeEventListener('mousemove', onMove);\n      (captureEvent.target as HTMLElement).removeEventListener('touchcancel', onRelease);\n      (captureEvent.target as HTMLElement).removeEventListener('touchend', onRelease);\n      (captureEvent.target as HTMLElement).removeEventListener('touchmove', onMove);\n\n      if (IS_IOS && options.selectorToPreventScroll) {\n        Array.from(document.querySelectorAll<HTMLElement>(options.selectorToPreventScroll))\n          .forEach((scrollable) => {\n            scrollable.style.overflow = '';\n          });\n      }\n\n      if (e) {\n        if (hasMoved) {\n          if (options.onRelease) {\n            options.onRelease(e);\n          }\n        } else if (e.type === 'mouseup') {\n          if (options.onDoubleClick && Date.now() - lastClickTime < 300) {\n            options.onDoubleClick(e, {\n              centerX: captureEvent!.pageX!,\n              centerY: captureEvent!.pageY!,\n            });\n          } else if (options.onClick && (!('button' in e) || e.button === 0)) {\n            options.onClick(e);\n          }\n          lastClickTime = Date.now();\n        }\n      }\n    }\n\n    hasMoved = false;\n    hasSwiped = false;\n    isZooming = false;\n    initialDistance = 0;\n    wheelZoom = clamp(wheelZoom, minZoom, maxZoom);\n    initialSwipeAxis = undefined;\n    initialDragOffset = {\n      x: 0,\n      y: 0,\n    };\n    isDragCanceled = {\n      x: false,\n      y: false,\n    };\n    const newWindowSize = windowSize.get();\n    initialTouchCenter = {\n      x: newWindowSize.width / 2,\n      y: newWindowSize.height / 2,\n    };\n    captureEvent = undefined;\n  }\n\n  function onMove(e: MouseEvent | RealTouchEvent) {\n    if (captureEvent) {\n      if (e.type === 'touchmove' && ('touches' in e)) {\n        if (e.pageX === undefined) {\n          e.pageX = e.touches[0].pageX;\n        }\n\n        if (e.pageY === undefined) {\n          e.pageY = e.touches[0].pageY;\n        }\n\n        if (options.onZoom && initialDistance > 0 && e.touches.length === 2) {\n          const endDistance = getDistance(e.touches[0], e.touches[1]);\n          const touchCenter = getTouchCenter(e.touches[0], e.touches[1]);\n          const dragOffsetX = touchCenter.x - initialTouchCenter.x;\n          const dragOffsetY = touchCenter.y - initialTouchCenter.y;\n          const zoomFactor = endDistance / initialDistance;\n          options.onZoom(e, {\n            zoomFactor,\n            initialCenterX: initialTouchCenter.x,\n            initialCenterY: initialTouchCenter.y,\n            dragOffsetX,\n            dragOffsetY,\n            currentCenterX: touchCenter.x,\n            currentCenterY: touchCenter.y,\n          });\n          if (zoomFactor !== 1) hasMoved = true;\n        }\n      }\n\n      const dragOffsetX = e.pageX! - captureEvent.pageX!;\n      const dragOffsetY = e.pageY! - captureEvent.pageY!;\n\n      if (Math.abs(dragOffsetX) >= MOVE_THRESHOLD || Math.abs(dragOffsetY) >= MOVE_THRESHOLD) {\n        hasMoved = true;\n      }\n\n      let shouldPreventScroll = false;\n\n      if (options.onDrag) {\n        options.onDrag(e, captureEvent, {\n          dragOffsetX,\n          dragOffsetY,\n        });\n        shouldPreventScroll = true;\n      }\n\n      if (options.onSwipe && !hasSwiped) {\n        hasSwiped = onSwipe(e, dragOffsetX, dragOffsetY);\n        shouldPreventScroll = hasSwiped;\n      }\n\n      if (IS_IOS && shouldPreventScroll && options.selectorToPreventScroll) {\n        Array.from(document.querySelectorAll<HTMLElement>(options.selectorToPreventScroll))\n          .forEach((scrollable) => {\n            scrollable.style.overflow = 'hidden';\n          });\n      }\n    }\n  }\n\n  function onSwipe(e: MouseEvent | RealTouchEvent, dragOffsetX: number, dragOffsetY: number) {\n    // Avoid conflicts with swipe-to-back gestures\n    if (IS_IOS) {\n      const x = (e as RealTouchEvent).touches[0].pageX;\n      if (x <= IOS_SCREEN_EDGE_THRESHOLD || x >= windowSize.get().width - IOS_SCREEN_EDGE_THRESHOLD) {\n        return false;\n      }\n    }\n\n    const xAbs = Math.abs(dragOffsetX);\n    const yAbs = Math.abs(dragOffsetY);\n    const threshold = options.swipeThreshold ?? SWIPE_THRESHOLD_DEFAULT;\n\n    let axis: TSwipeAxis | undefined;\n    if (xAbs > yAbs && xAbs >= threshold) {\n      axis = 'x';\n    } else if (yAbs > xAbs && yAbs >= threshold) {\n      axis = 'y';\n    }\n\n    if (!axis) {\n      return false;\n    }\n\n    if (!initialSwipeAxis) {\n      initialSwipeAxis = axis;\n    } else if (initialSwipeAxis !== axis) {\n      // Prevent horizontal swipe after vertical to prioritize scroll\n      return false;\n    }\n\n    return processSwipe(e, axis, dragOffsetX, dragOffsetY, options.onSwipe!);\n  }\n\n  const releaseWheelDrag = debounce(onRelease, RELEASE_WHEEL_DRAG_DELAY, false);\n  const releaseWheelZoom = debounce(onRelease, RELEASE_WHEEL_ZOOM_DELAY, false);\n\n  function onWheelCapture(e: WheelEvent) {\n    if (hasMoved) return;\n    onCapture(e);\n    hasMoved = true;\n    initialTouchCenter = { x: e.x, y: e.y };\n  }\n\n  function onWheelZoom(e: WheelEvent) {\n    if (!options.onZoom) return;\n    onWheelCapture(e);\n    const dragOffsetX = e.x - initialTouchCenter.x;\n    const dragOffsetY = e.y - initialTouchCenter.y;\n    const delta = clamp(e.deltaY, -25, 25);\n    wheelZoom -= delta * 0.01;\n    wheelZoom = clamp(wheelZoom, minZoom * 0.5, maxZoom * 3);\n    isZooming = true;\n    options.onZoom(e, {\n      zoom: round(wheelZoom, 2),\n      initialCenterX: initialTouchCenter.x,\n      initialCenterY: initialTouchCenter.y,\n      dragOffsetX,\n      dragOffsetY,\n      currentCenterX: e.x,\n      currentCenterY: e.y,\n    });\n    releaseWheelZoom(e);\n  }\n\n  function onWheelDrag(e: WheelEvent) {\n    if (!options.onDrag) return;\n    onWheelCapture(e);\n    // Ignore wheel inertia if drag is canceled in this direction\n    if (!isDragCanceled.x || Math.sign(initialDragOffset.x) === Math.sign(e.deltaX)) {\n      initialDragOffset.x -= e.deltaX;\n    }\n    if (!isDragCanceled.y || Math.sign(initialDragOffset.y) === Math.sign(e.deltaY)) {\n      initialDragOffset.y -= e.deltaY;\n    }\n    const { x, y } = initialDragOffset;\n    options.onDrag(e, captureEvent!, {\n      dragOffsetX: x,\n      dragOffsetY: y,\n    }, (dx, dy) => {\n      isDragCanceled = { x: dx, y: dy };\n    });\n    releaseWheelDrag(e);\n  }\n\n  function onWheel(e: WheelEvent) {\n    if (!options.onZoom && !options.onDrag) return;\n    if (options.excludedClosestSelector && (\n      (e.target as HTMLElement).matches(options.excludedClosestSelector)\n      || (e.target as HTMLElement).closest(options.excludedClosestSelector)\n    )) {\n      return;\n    }\n    e.preventDefault();\n    e.stopPropagation();\n    const { doubleTapZoom = 3 } = options;\n    if (options.onDoubleClick && Object.is(e.deltaX, -0) && Object.is(e.deltaY, -0) && e.ctrlKey) {\n      onWheelCapture(e);\n      wheelZoom = wheelZoom > 1 ? 1 : doubleTapZoom;\n      options.onDoubleClick(e, { centerX: e.pageX, centerY: e.pageY });\n      hasMoved = false;\n      return;\n    }\n    const metaKeyPressed = e.metaKey || e.ctrlKey || e.shiftKey;\n    if (metaKeyPressed) {\n      onWheelZoom(e);\n    }\n    if (!metaKeyPressed && !isZooming) {\n      // Check if this event produced by user scroll and not by inertia\n      const isUserEvent = lethargy.check(e);\n      if (wheelZoom !== 1 || isUserEvent) {\n        onWheelDrag(e);\n      }\n    }\n  }\n\n  if (options.withWheelDrag) {\n    element.addEventListener('wheel', onWheel);\n  }\n\n  element.addEventListener('mousedown', onCapture);\n  document.body.addEventListener('touchstart', onCapture, { passive: !options.isNotPassive });\n\n  return () => {\n    onRelease();\n    document.body.removeEventListener('touchstart', onCapture);\n    element.removeEventListener('mousedown', onCapture);\n    element.removeEventListener('wheel', onWheel);\n  };\n}\n\nfunction processSwipe(\n  e: Event,\n  currentSwipeAxis: TSwipeAxis,\n  dragOffsetX: number,\n  dragOffsetY: number,\n  onSwipe: (e: Event, direction: SwipeDirection, offsets: MoveOffsets) => boolean,\n) {\n  const offsets = { dragOffsetX, dragOffsetY };\n\n  if (currentSwipeAxis === 'x') {\n    if (dragOffsetX < 0) {\n      return onSwipe(e, SwipeDirection.Left, offsets);\n    } else {\n      return onSwipe(e, SwipeDirection.Right, offsets);\n    }\n  } else if (currentSwipeAxis === 'y') {\n    if (dragOffsetY < 0) {\n      return onSwipe(e, SwipeDirection.Up, offsets);\n    } else {\n      return onSwipe(e, SwipeDirection.Down, offsets);\n    }\n  }\n\n  return false;\n}\n","/**\n * Lethargy help distinguish between scroll events initiated by the user, and those by inertial scrolling.\n * Lethargy does not have external dependencies.\n *\n * @param stability - Specifies the length of the rolling average.\n * In effect, the larger the value, the smoother the curve will be.\n * This attempts to prevent anomalies from firing 'real' events. Valid values are all positive integers,\n * but in most cases, you would need to stay between 5 and around 30.\n *\n * @param sensitivity - Specifies the minimum value for wheelDelta for it to register as a valid scroll event.\n * Because the tail of the curve have low wheelDelta values,\n * this will stop them from registering as valid scroll events.\n * The unofficial standard wheelDelta is 120, so valid values are positive integers below 120.\n *\n * @param tolerance - Prevent small fluctuations from affecting results.\n * Valid values are decimals from 0, but should ideally be between 0.05 and 0.3.\n *\n * Based on https://github.com/d4nyll/lethargy\n */\n\nexport type LethargyConfig = {\n  stability?: number;\n  sensitivity?: number;\n  tolerance?: number;\n  delay?: number;\n};\n\nexport class Lethargy {\n  stability: number;\n\n  sensitivity: number;\n\n  tolerance: number;\n\n  delay: number;\n\n  lastUpDeltas: Array<number>;\n\n  lastDownDeltas: Array<number>;\n\n  deltasTimestamp: Array<number>;\n\n  constructor({\n    stability = 8,\n    sensitivity = 100,\n    tolerance = 1.1,\n    delay = 150,\n  }: LethargyConfig = {}) {\n    this.stability = stability;\n    this.sensitivity = sensitivity;\n    this.tolerance = tolerance;\n    this.delay = delay;\n    this.lastUpDeltas = new Array(this.stability * 2).fill(0);\n    this.lastDownDeltas = new Array(this.stability * 2).fill(0);\n    this.deltasTimestamp = new Array(this.stability * 2).fill(0);\n  }\n\n  check(e: any) {\n    let lastDelta;\n    e = e.originalEvent || e;\n    if (e.wheelDelta !== undefined) {\n      lastDelta = e.wheelDelta;\n    } else if (e.deltaY !== undefined) {\n      lastDelta = e.deltaY * -40;\n    } else if (e.detail !== undefined || e.detail === 0) {\n      lastDelta = e.detail * -40;\n    }\n    this.deltasTimestamp.push(Date.now());\n    this.deltasTimestamp.shift();\n    if (lastDelta > 0) {\n      this.lastUpDeltas.push(lastDelta);\n      this.lastUpDeltas.shift();\n      return this.isInertia(1);\n    } else {\n      this.lastDownDeltas.push(lastDelta);\n      this.lastDownDeltas.shift();\n      return this.isInertia(-1);\n    }\n  }\n\n  isInertia(direction: number) {\n    const lastDeltas = direction === -1 ? this.lastDownDeltas : this.lastUpDeltas;\n    if (lastDeltas[0] === undefined) return direction;\n    if (\n      this.deltasTimestamp[this.stability * 2 - 2] + this.delay > Date.now()\n      && lastDeltas[0] === lastDeltas[this.stability * 2 - 1]\n    ) {\n      return false;\n    }\n    const lastDeltasOld = lastDeltas.slice(0, this.stability);\n    const lastDeltasNew = lastDeltas.slice(this.stability, this.stability * 2);\n    const oldSum = lastDeltasOld.reduce((t, s) => t + s);\n    const newSum = lastDeltasNew.reduce((t, s) => t + s);\n    const oldAverage = oldSum / lastDeltasOld.length;\n    const newAverage = newSum / lastDeltasNew.length;\n    return Math.abs(oldAverage) <= Math.abs(newAverage * this.tolerance)\n      && this.sensitivity < Math.abs(newAverage);\n  }\n}\n","type HandlerName =\n  'onEnter'\n  | 'onBackspace'\n  | 'onDelete'\n  | 'onEsc'\n  | 'onUp'\n  | 'onDown'\n  | 'onLeft'\n  | 'onRight'\n  | 'onTab';\ntype Handler = (e: KeyboardEvent) => void | boolean;\ntype CaptureOptions = Partial<Record<HandlerName, Handler>>;\n\nconst keyToHandlerName: Record<string, HandlerName> = {\n  Enter: 'onEnter',\n  Backspace: 'onBackspace',\n  Delete: 'onDelete',\n  Esc: 'onEsc',\n  Escape: 'onEsc',\n  ArrowUp: 'onUp',\n  ArrowDown: 'onDown',\n  ArrowLeft: 'onLeft',\n  ArrowRight: 'onRight',\n  Tab: 'onTab',\n};\n\nconst handlers: Record<HandlerName, Handler[]> = {\n  onEnter: [],\n  onDelete: [],\n  onBackspace: [],\n  onEsc: [],\n  onUp: [],\n  onDown: [],\n  onLeft: [],\n  onRight: [],\n  onTab: [],\n};\n\nexport default function captureKeyboardListeners(options: CaptureOptions) {\n  if (!hasActiveHandlers()) {\n    document.addEventListener('keydown', handleKeyDown, true);\n  }\n\n  (Object.keys(options) as Array<HandlerName>).forEach((handlerName) => {\n    const handler = options[handlerName];\n    if (!handler) {\n      return;\n    }\n\n    const currentEventHandlers = handlers[handlerName];\n    if (currentEventHandlers) {\n      currentEventHandlers.push(handler);\n    }\n  });\n\n  return () => {\n    releaseKeyboardListener(options);\n  };\n}\n\nfunction hasActiveHandlers() {\n  return Object.values(handlers).some((keyHandlers) => Boolean(keyHandlers.length));\n}\n\nfunction handleKeyDown(e: KeyboardEvent) {\n  const handlerName = keyToHandlerName[e.key];\n  if (!handlerName) {\n    return;\n  }\n\n  const { length } = handlers[handlerName];\n  if (!length) {\n    return;\n  }\n\n  for (let i = length - 1; i >= 0; i--) {\n    const handler = handlers[handlerName][i]!;\n    if (handler(e) !== false) {\n      e.stopPropagation();\n      break;\n    }\n  }\n}\n\nfunction releaseKeyboardListener(options: CaptureOptions) {\n  (Object.keys(options) as Array<HandlerName>).forEach((handlerName) => {\n    const handler = options[handlerName];\n    const currentEventHandlers = handlers[handlerName];\n    if (currentEventHandlers) {\n      const index = currentEventHandlers.findIndex((cb) => cb === handler);\n      if (index !== -1) {\n        currentEventHandlers.splice(index, 1);\n      }\n    }\n  });\n\n  if (!hasActiveHandlers()) {\n    document.removeEventListener('keydown', handleKeyDown, false);\n  }\n}\n","import { DEBUG } from '../config';\n\nexport const CLIPBOARD_ITEM_SUPPORTED = window.navigator.clipboard && window.ClipboardItem;\n\nconst textCopyEl = document.createElement('textarea');\ntextCopyEl.setAttribute('readonly', '');\ntextCopyEl.tabIndex = -1;\ntextCopyEl.className = 'visually-hidden';\n\nexport const copyTextToClipboard = (str: string): void => {\n  textCopyEl.value = str;\n  document.body.appendChild(textCopyEl);\n  const selection = document.getSelection();\n\n  if (selection) {\n    // Store previous selection\n    const rangeToRestore = selection.rangeCount > 0 && selection.getRangeAt(0);\n    textCopyEl.select();\n    document.execCommand('copy');\n    // Restore the original selection\n    if (rangeToRestore) {\n      selection.removeAllRanges();\n      selection.addRange(rangeToRestore);\n    }\n  }\n\n  document.body.removeChild(textCopyEl);\n};\n\nexport const copyHtmlToClipboard = (html: string, text: string): void => {\n  if (!window.navigator.clipboard?.write) {\n    copyTextToClipboard(text);\n    return;\n  }\n\n  window.navigator.clipboard.write([\n    new ClipboardItem({\n      'text/plain': new Blob([text], { type: 'text/plain' }),\n      'text/html': new Blob([html], { type: 'text/html' }),\n    }),\n  ]);\n};\n\nexport const copyImageToClipboard = (imageUrl?: string) => {\n  if (!imageUrl) return;\n  const canvas = document.createElement('canvas');\n  const ctx = canvas.getContext('2d');\n  const imageEl = new Image();\n  imageEl.onload = (e: Event) => {\n    if (ctx && e.currentTarget) {\n      const img = e.currentTarget as HTMLImageElement;\n      canvas.width = img.width;\n      canvas.height = img.height;\n      ctx.drawImage(img, 0, 0, img.width, img.height);\n      canvas.toBlob(copyBlobToClipboard, 'image/png', 1);\n    }\n  };\n\n  imageEl.src = imageUrl;\n};\n\nexport const copyTextToClipboardFromPromise = async (\n  getTextPromise: Promise<string | undefined>,\n  onSuccess: NoneToVoidFunction,\n  onFailure: NoneToVoidFunction,\n) => {\n  const copyTextToClipboardFallback = async () => {\n    try {\n      const text = await getTextPromise;\n      if (text) {\n        copyTextToClipboard(text);\n      } else {\n        onFailure();\n      }\n      return Boolean(text);\n    } catch {\n      onFailure();\n      return false;\n    }\n  };\n  if (!CLIPBOARD_ITEM_SUPPORTED || !navigator.clipboard.write) {\n    if (await copyTextToClipboardFallback()) onSuccess();\n    return;\n  }\n  try {\n    let hasGetDataError = false;\n    const rejectGetDataError = () => Promise.reject(new Error('GET_DATA_ERROR'));\n\n    const clipboardTextItem = new ClipboardItem({\n      'text/plain': getTextPromise.then((text) => text || rejectGetDataError()).catch(() => {\n        hasGetDataError = true;\n        return '';\n      }),\n    });\n    await navigator.clipboard.write([clipboardTextItem]);\n    if (hasGetDataError) {\n      onFailure();\n      return;\n    }\n  } catch {\n    // Promises in ClipboardItem aren't supported in older Chrome versions\n    if (!await copyTextToClipboardFallback()) return;\n  }\n  onSuccess();\n};\n\nasync function copyBlobToClipboard(pngBlob: Blob | null) {\n  if (!pngBlob || !CLIPBOARD_ITEM_SUPPORTED) {\n    return;\n  }\n\n  try {\n    await window.navigator.clipboard.write?.([\n      new ClipboardItem({\n        [pngBlob.type]: pngBlob,\n      }),\n    ]);\n  } catch (error) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.error(error);\n    }\n  }\n}\n","// Sometimes event is fired earlier than animation completes\nconst ANIMATION_END_DELAY = 50;\n\nexport function waitForTransitionEnd(\n  node: Node, handler: NoneToVoidFunction, propertyName?: string, fallbackMs?: number,\n) {\n  return waitForEndEvent('transitionend', node, handler, propertyName, fallbackMs);\n}\n\nexport function waitForAnimationEnd(\n  node: Node, handler: NoneToVoidFunction, animationName?: string, fallbackMs?: number,\n) {\n  return waitForEndEvent('animationend', node, handler, animationName, fallbackMs);\n}\n\nfunction waitForEndEvent(\n  eventType: 'transitionend' | 'animationend',\n  node: Node,\n  handler: NoneToVoidFunction,\n  detailedName?: string,\n  fallbackMs?: number,\n) {\n  let isHandled = false;\n\n  function cleanup() {\n    node.removeEventListener(eventType, handleAnimationEnd);\n  }\n\n  function handleAnimationEnd(e: TransitionEvent | AnimationEvent | Event) {\n    if (isHandled || e.target !== e.currentTarget) {\n      return;\n    }\n\n    if (detailedName && (\n      (e instanceof TransitionEvent && e.propertyName === detailedName)\n      || (e instanceof AnimationEvent && e.animationName === detailedName)\n    )) {\n      return;\n    }\n\n    isHandled = true;\n\n    cleanup();\n\n    setTimeout(() => {\n      handler();\n    }, ANIMATION_END_DELAY);\n  }\n\n  node.addEventListener(eventType, handleAnimationEnd);\n\n  if (fallbackMs) {\n    setTimeout(() => {\n      if (isHandled) return;\n\n      cleanup();\n\n      handler();\n    }, fallbackMs);\n  }\n\n  return cleanup;\n}\n","import type { OldLangFn } from '../../hooks/useOldLang';\nimport type { TimeFormat } from '../../types';\nimport type { LangFn } from '../localization';\n\nimport withCache from '../withCache';\nimport { getDays } from './units';\n\nconst WEEKDAYS_FULL = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\nconst MONTHS_FULL = [\n  'January', 'February', 'March', 'April', 'May', 'June',\n  'July', 'August', 'September', 'October', 'November', 'December',\n];\n\nconst MONTHS_FULL_LOWERCASE = MONTHS_FULL.map((month) => month.toLowerCase());\nconst MIN_SEARCH_YEAR = 2015;\nconst MAX_DAY_IN_MONTH = 31;\nconst MAX_MONTH_IN_YEAR = 12;\nexport const MILLISECONDS_IN_DAY = 24 * 60 * 60 * 1000;\n\nexport function isToday(date: Date) {\n  return getDayStartAt(new Date()) === getDayStartAt(date);\n}\n\nexport function getDayStart(datetime: number | Date) {\n  const date = new Date(datetime);\n  date.setHours(0, 0, 0, 0);\n  return date;\n}\n\nexport function getDayStartAt(datetime: number | Date) {\n  return getDayStart(datetime).getTime();\n}\n\nexport function toYearMonth(timestamp: number) {\n  const date = new Date(timestamp * 1000);\n  return `${date.getFullYear()}-${date.getMonth()}`;\n}\n\nfunction toIsoString(date: Date) {\n  return `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;\n}\n\n// @optimization `toLocaleTimeString` is avoided because of bad performance\nexport function formatTime(lang: OldLangFn, datetime: number | Date) {\n  const date = typeof datetime === 'number' ? new Date(datetime) : datetime;\n  const timeFormat = lang.timeFormat || '24h';\n\n  let hours = date.getHours();\n  let marker = '';\n  if (timeFormat === '12h') {\n    marker = hours >= 12 ? '\\xa0PM' : '\\xa0AM'; // NBSP\n    hours = hours > 12 ? hours % 12 : hours;\n  }\n\n  return `${String(hours).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}${marker}`;\n}\n\nexport function formatPastTimeShort(lang: OldLangFn, datetime: number | Date, alwaysShowTime = false) {\n  const date = typeof datetime === 'number' ? new Date(datetime) : datetime;\n\n  const time = formatTime(lang, date);\n\n  const today = getDayStart(new Date());\n  if (date >= today) {\n    return time;\n  }\n\n  const weekAgo = new Date(today);\n  weekAgo.setDate(today.getDate() - 7);\n  if (date >= weekAgo) {\n    const weekday = lang(`Weekday.Short${WEEKDAYS_FULL[date.getDay()]}`);\n    return alwaysShowTime ? lang('FullDateTimeFormat', [weekday, time]) : weekday;\n  }\n\n  const noYear = date.getFullYear() === today.getFullYear();\n\n  const formattedDate = formatDateToString(date, lang.code, noYear);\n  return alwaysShowTime ? lang('FullDateTimeFormat', [formattedDate, time]) : formattedDate;\n}\n\nexport function formatFullDate(lang: OldLangFn, datetime: number | Date) {\n  return formatDateToString(datetime, lang.code, false, 'numeric');\n}\n\nexport function formatMonthAndYear(lang: OldLangFn, date: Date, isShort = false) {\n  return formatDateToString(date, lang.code, false, isShort ? 'short' : 'long', true);\n}\n\nexport function formatCountdown(\n  lang: LangFn,\n  secondsLeft: number,\n) {\n  const days = getDays(secondsLeft);\n  if (secondsLeft < 0) {\n    return 0;\n  } else if (days < 1) {\n    return formatMediaDuration(secondsLeft);\n  } else if (days < 7) {\n    const count = days;\n    return lang('Days', { count }, { pluralValue: count });\n  } else if (days < 30) {\n    const count = Math.floor(days / 7);\n    return lang('Weeks', { count }, { pluralValue: count });\n  } else if (days < 365) {\n    const count = Math.floor(days / 30);\n    return lang('Months', { count }, { pluralValue: count });\n  } else {\n    const count = Math.floor(days / 365);\n    return lang('Years', { count }, { pluralValue: count });\n  }\n}\n\nexport function formatCountdownShort(lang: OldLangFn, msLeft: number): string {\n  if (msLeft < 60 * 1000) {\n    return Math.ceil(msLeft / 1000).toString();\n  } else if (msLeft < 60 * 60 * 1000) {\n    return Math.ceil(msLeft / (60 * 1000)).toString();\n  } else if (msLeft < MILLISECONDS_IN_DAY) {\n    return lang('MessageTimer.ShortHours', Math.ceil(msLeft / (60 * 60 * 1000)));\n  } else {\n    return lang('MessageTimer.ShortDays', Math.ceil(msLeft / MILLISECONDS_IN_DAY));\n  }\n}\n\nexport function formatLastUpdated(lang: OldLangFn, currentTime: number, lastUpdated = currentTime) {\n  const seconds = currentTime - lastUpdated;\n  if (seconds < 60) {\n    return lang('LiveLocationUpdated.JustNow');\n  } else if (seconds < 60 * 60) {\n    return lang('LiveLocationUpdated.MinutesAgo', Math.floor(seconds / 60));\n  } else {\n    return lang('LiveLocationUpdated.TodayAt', formatTime(lang, lastUpdated));\n  }\n}\n\nexport function formatRelativeTime(lang: OldLangFn, currentTime: number, lastUpdated = currentTime) {\n  const seconds = currentTime - lastUpdated;\n\n  if (seconds < 60) {\n    return lang('Time.JustNow');\n  }\n\n  // within an hour\n  if (seconds < 60 * 60) {\n    return lang('Time.MinutesAgo', Math.floor(seconds / 60));\n  }\n\n  const lastUpdatedDate = new Date(lastUpdated * 1000);\n  const today = getDayStart(new Date());\n  if (lastUpdatedDate >= today) {\n    return lang('Time.TodayAt', formatTime(lang, lastUpdatedDate));\n  }\n\n  const yesterday = new Date(today);\n  yesterday.setDate(today.getDate() - 1);\n  if (lastUpdatedDate > yesterday) {\n    return lang('Time.YesterdayAt', formatTime(lang, lastUpdatedDate));\n  }\n\n  return lang('Time.AtDate', formatFullDate(lang, lastUpdatedDate));\n}\n\ntype DurationType = 'Seconds' | 'Minutes' | 'Hours' | 'Days' | 'Weeks';\n\nexport function formatTimeDuration(lang: OldLangFn, duration: number, showLast = 2) {\n  if (!duration) {\n    return undefined;\n  }\n\n  const durationRecords: { duration: number; type: DurationType }[] = [];\n  const labels = [\n    { multiplier: 1, type: 'Seconds' },\n    { multiplier: 60, type: 'Minutes' },\n    { multiplier: 60, type: 'Hours' },\n    { multiplier: 24, type: 'Days' },\n    { multiplier: 7, type: 'Weeks' },\n  ] as Array<{ multiplier: number; type: DurationType }>;\n  let t = 1;\n  labels.forEach((label, idx) => {\n    t *= label.multiplier;\n\n    if (duration < t) {\n      return;\n    }\n\n    const modulus = labels[idx === (labels.length - 1) ? idx : idx + 1].multiplier!;\n    durationRecords.push({\n      duration: Math.floor((duration / t) % modulus),\n      type: label.type,\n    });\n  });\n\n  const out = durationRecords.slice(-showLast).reverse();\n  for (let i = out.length - 1; i >= 0; --i) {\n    if (out[i].duration === 0) {\n      out.splice(i, 1);\n    }\n  }\n\n  // TODO In arabic we don't use \",\" as delimiter rather we use \"and\" each time\n  return out.map((part) => lang(part.type, part.duration, 'i')).join(', ');\n}\n\nexport function formatHumanDate(\n  lang: OldLangFn,\n  datetime: number | Date,\n  isShort = false,\n  noWeekdays = false,\n  isUpperFirst?: boolean,\n) {\n  const date = typeof datetime === 'number' ? new Date(datetime) : datetime;\n\n  const today = getDayStart(new Date());\n\n  if (!noWeekdays) {\n    if (toIsoString(date) === toIsoString(today)) {\n      return (isUpperFirst || !isShort ? upperFirst : lowerFirst)(lang('Weekday.Today'));\n    }\n\n    const yesterday = new Date(today);\n    yesterday.setDate(today.getDate() - 1);\n    if (toIsoString(date) === toIsoString(yesterday)) {\n      return (isUpperFirst || !isShort ? upperFirst : lowerFirst)(lang('Weekday.Yesterday'));\n    }\n\n    const limitBefore = new Date(today);\n    limitBefore.setDate(today.getDate() - 6); // Avoid returning same weekday as today\n    const limitAhead = new Date(today);\n    limitAhead.setDate(today.getDate() + 6);\n\n    if (date >= limitBefore && date <= limitAhead) {\n      const weekDayString = formatWeekday(lang, date.getDay(), isShort);\n      return (isUpperFirst || !isShort ? upperFirst : lowerFirst)(weekDayString);\n    }\n  }\n\n  const noYear = date.getFullYear() === today.getFullYear();\n  const formattedDate = formatDateToString(date, lang.code, noYear, isShort ? 'short' : 'long');\n\n  return (isUpperFirst || !isShort ? upperFirst : lowerFirst)(formattedDate);\n}\n\n/**\n * Returns weekday name\n * @param day 0 - Sunday, 1 - Monday, ...\n */\nexport function formatWeekday(lang: OldLangFn, day: number, isShort = false) {\n  const weekDay = WEEKDAYS_FULL[day];\n  return isShort ? lang(`Weekday.Short${weekDay}`) : lang(`Weekday.${weekDay}`);\n}\n\nexport function formatMediaDateTime(\n  lang: OldLangFn,\n  datetime: number | Date,\n  isUpperFirst?: boolean,\n) {\n  const date = typeof datetime === 'number' ? new Date(datetime) : datetime;\n\n  return `${formatHumanDate(lang, date, true, undefined, isUpperFirst)}, ${formatTime(lang, date)}`;\n}\n\nexport function formatMediaDuration(duration: number, maxValue?: number) {\n  const hours = Math.floor(duration / 3600);\n  const minutes = Math.floor((duration % 3600) / 60);\n  const seconds = Math.floor(duration % 3600 % 60);\n\n  const maxHours = maxValue ? Math.floor(maxValue / 3600) : 0;\n  const maxMinutes = maxValue ? Math.floor((maxValue % 3600) / 60) : 0;\n  let string = '';\n  if (hours > 0 || maxHours > 0) {\n    string += `${String(hours).padStart(2, '0')}:`;\n    string += `${String(minutes).padStart(2, '0')}:`;\n  } else if (maxMinutes >= 10) {\n    string += `${String(minutes).padStart(2, '0')}:`;\n  } else {\n    string += `${String(minutes)}:`;\n  }\n  string += String(seconds).padStart(2, '0');\n\n  return string;\n}\n\nexport function formatVoiceRecordDuration(durationInMs: number) {\n  const parts = [];\n\n  let milliseconds = durationInMs % 1000;\n  durationInMs -= milliseconds;\n  milliseconds = Math.floor(milliseconds / 10);\n\n  durationInMs = Math.floor(durationInMs / 1000);\n  const seconds = durationInMs % 60;\n  durationInMs -= seconds;\n\n  durationInMs = Math.floor(durationInMs / 60);\n  const minutes = durationInMs % 60;\n  durationInMs -= minutes;\n\n  durationInMs = Math.floor(durationInMs / 60);\n  const hours = durationInMs % 60;\n\n  if (hours > 0) {\n    parts.push(String(hours).padStart(2, '0'));\n  }\n  parts.push(String(minutes).padStart(hours > 0 ? 2 : 1, '0'));\n  parts.push(String(seconds).padStart(2, '0'));\n\n  return `${parts.join(':')},${String(milliseconds).padStart(2, '0')}`;\n}\n\nconst formatDayToStringWithCache = withCache((\n  dayStartAt: number,\n  locale: string,\n  noYear?: boolean,\n  monthFormat: 'short' | 'long' | 'numeric' = 'short',\n  noDay?: boolean,\n) => {\n  return new Date(dayStartAt).toLocaleString(\n    locale,\n    {\n      year: noYear ? undefined : 'numeric',\n      month: monthFormat,\n      day: noDay ? undefined : 'numeric',\n    },\n  );\n});\n\nexport function formatDateToString(\n  datetime: Date | number,\n  locale = 'en-US',\n  noYear = false,\n  monthFormat: 'short' | 'long' | 'numeric' = 'short',\n  noDay = false,\n) {\n  const date = typeof datetime === 'number' ? new Date(datetime) : datetime;\n  const dayStartAt = getDayStartAt(date);\n\n  return formatDayToStringWithCache(dayStartAt, locale, noYear, monthFormat, noDay);\n}\n\nexport function formatDateTimeToString(\n  datetime: Date | number, locale = 'en-US', noSeconds?: boolean,\n  timeFormat?: TimeFormat,\n) {\n  const date = typeof datetime === 'number' ? new Date(datetime) : datetime;\n  return date.toLocaleString(\n    locale,\n    {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric',\n      hour: 'numeric',\n      minute: 'numeric',\n      second: noSeconds ? undefined : 'numeric',\n      hourCycle: timeFormat === '12h' ? 'h12' : 'h23',\n    },\n  );\n}\n\nexport function formatDateAtTime(\n  lang: OldLangFn,\n  datetime: number | Date,\n) {\n  const date = typeof datetime === 'number' ? new Date(datetime) : datetime;\n\n  const today = getDayStart(new Date());\n  const time = formatTime(lang, date);\n\n  if (toIsoString(date) === toIsoString(today)) {\n    return lang('Time.TodayAt', time);\n  }\n\n  const yesterday = new Date(today);\n  yesterday.setDate(today.getDate() - 1);\n  if (toIsoString(date) === toIsoString(yesterday)) {\n    return lang('Time.YesterdayAt', time);\n  }\n\n  const noYear = date.getFullYear() === today.getFullYear();\n  const formattedDate = formatDateToString(date, lang.code, noYear);\n\n  return lang('formatDateAtTime', [formattedDate, time]);\n}\n\nexport function formatShortDuration(lang: LangFn, duration: number) {\n  if (duration < 0) {\n    return lang('RightNow');\n  }\n\n  if (duration < 60) {\n    const count = Math.ceil(duration);\n    return lang('Seconds', { count }, { pluralValue: duration });\n  }\n\n  if (duration < 60 * 60) {\n    const count = Math.ceil(duration / 60);\n    return lang('Minutes', { count }, { pluralValue: count });\n  }\n\n  if (duration < 60 * 60 * 24) {\n    const count = Math.ceil(duration / (60 * 60));\n    return lang('Hours', { count }, { pluralValue: count });\n  }\n\n  const count = Math.ceil(duration / (60 * 60 * 24));\n  return lang('Days', { count }, { pluralValue: count });\n}\n\nfunction isValidDate(day: number, month: number, year = 2021): boolean {\n  if (month > (MAX_MONTH_IN_YEAR - 1) || day > MAX_DAY_IN_MONTH) {\n    return false;\n  }\n  const date = new Date(year, month, day);\n  return !Number.isNaN(date.getTime()) && date.getDate() === day;\n}\n\nexport function parseDateString(query = ''): string | undefined {\n  const matchStringDate = query.match(/\\d{1,2}\\s[a-zA-Z]{3,}/);\n  const matchEuropeStringDate = query.match(/[a-zA-Z]{3,}\\s\\d{1,2}/);\n  const matchNumberDate = query.match(/\\d{1,2}[./-]\\d{1,2}([./-]\\d{2,4})?/);\n  if (!matchStringDate && !matchNumberDate && !matchEuropeStringDate) {\n    return undefined;\n  }\n\n  if (matchNumberDate) {\n    const [date, month, year] = query.split(/[./-]/).map(Number);\n    return !(year && year < MIN_SEARCH_YEAR) && isValidDate(date, month - 1, year || undefined)\n      ? `${year ? `${year}-` : ''}${String(month).padStart(2, '0')}-${String(date).padStart(2, '0')}`\n      : undefined;\n  }\n\n  const dateParts = query.split(' ');\n  const date = matchStringDate ? dateParts[0] : dateParts[1];\n  const month = (matchStringDate ? dateParts[1] : dateParts[0]).toLowerCase();\n  const monthIndex = MONTHS_FULL_LOWERCASE.findIndex((item) => item.startsWith(month));\n\n  return monthIndex !== -1 && isValidDate(Number(date), monthIndex)\n    ? `${String(monthIndex + 1).padStart(2, '0')}-${String(date).padStart(2, '0')}`\n    : undefined;\n}\n\nexport function timestampPlusDay(timestamp: number) {\n  return timestamp + MILLISECONDS_IN_DAY / 1000;\n}\n\nfunction lowerFirst(str: string) {\n  return `${str[0].toLowerCase()}${str.slice(1)}`;\n}\n\nfunction upperFirst(str: string) {\n  return `${str[0].toUpperCase()}${str.slice(1)}`;\n}\n","import {\n  type ApiFormattedText,\n  type ApiMessageEntityTimestamp,\n  ApiMessageEntityTypes,\n} from '../../api/types';\n\nimport { getSeconds } from './units';\n\nconst TIMESTAMP_RE = /\\b(?:(\\d{1,2}):)?([0-5]?\\d):([0-5]\\d)\\b/g;\n\nexport function addTimestampEntities(apiText: ApiFormattedText): ApiFormattedText {\n  const resultText = {\n    text: apiText.text,\n    entities: apiText.entities?.filter((e) => e.type !== ApiMessageEntityTypes.Timestamp) || [],\n  };\n\n  const text = resultText.text;\n\n  for (const match of text.matchAll(TIMESTAMP_RE)) {\n    const fullMatch = match[0];\n    const hourStr = match[1];\n    const minuteStr = match[2];\n    const secondStr = match[3];\n    const offset = match.index ?? 0;\n    const length = fullMatch.length;\n\n    const minutes = parseInt(minuteStr, 10);\n    const seconds = parseInt(secondStr, 10);\n\n    if (minutes > 59 || seconds > 59) {\n      continue;\n    }\n\n    let totalSeconds: number;\n    if (hourStr !== undefined) {\n      const hours = parseInt(hourStr, 10);\n      totalSeconds = getSeconds(hours, minutes, seconds);\n    } else {\n      totalSeconds = getSeconds(0, minutes, seconds);\n    }\n\n    let overlaps = false;\n    for (const entity of resultText.entities) {\n      if (offset < entity.offset + entity.length && offset + length > entity.offset) {\n        overlaps = true;\n        break;\n      }\n    }\n    if (overlaps) {\n      continue;\n    }\n\n    const newEntity: ApiMessageEntityTimestamp = {\n      type: ApiMessageEntityTypes.Timestamp,\n      offset,\n      length,\n      timestamp: totalSeconds,\n    };\n\n    let inserted = false;\n    for (let i = 0; i < resultText.entities.length; i++) {\n      if (offset < resultText.entities[i].offset) {\n        resultText.entities.splice(i, 0, newEntity);\n        inserted = true;\n        break;\n      }\n    }\n    if (!inserted) {\n      resultText.entities.push(newEntity);\n    }\n  }\n\n  return resultText;\n}\n\nexport function parseTimestampDuration(input: string): number | undefined {\n  input = input.trim();\n\n  if (!input.startsWith('-') && Number.isInteger(Number(input))) {\n    return parseInt(input, 10);\n  }\n\n  if (input.includes(':')) {\n    const parts = input.split(':');\n\n    if (parts.length === 2) {\n      const minutes = parseInt(parts[0], 10);\n      const seconds = parseInt(parts[1], 10);\n\n      if (\n        Number.isNaN(minutes) || Number.isNaN(seconds)\n        || minutes < 0 || seconds < 0 || seconds >= 60\n      ) {\n        return undefined;\n      }\n      return minutes * 60 + seconds;\n    }\n\n    if (parts.length === 3) {\n      const hours = parseInt(parts[0], 10);\n      const minutes = parseInt(parts[1], 10);\n      const seconds = parseInt(parts[2], 10);\n\n      if (\n        Number.isNaN(hours) || Number.isNaN(minutes) || Number.isNaN(seconds)\n        || hours < 0 || minutes < 0 || seconds < 0 || minutes >= 60 || seconds >= 60\n      ) {\n        return undefined;\n      }\n      return hours * 3600 + minutes * 60 + seconds;\n    }\n\n    return undefined;\n  }\n\n  const regex = /^(?:(\\d+)h)?(?:(\\d+)m)?(?:(\\d+)s)?$/i;\n  const match = input.match(regex);\n  if (!match) {\n    return undefined;\n  }\n\n  const hours = match[1] ? parseInt(match[1], 10) : 0;\n  const minutes = match[2] ? parseInt(match[2], 10) : 0;\n  const seconds = match[3] ? parseInt(match[3], 10) : 0;\n\n  if (\n    Number.isNaN(hours) || Number.isNaN(minutes) || Number.isNaN(seconds)\n    || minutes >= 60 || seconds >= 60\n  ) {\n    return undefined;\n  }\n  return hours * 3600 + minutes * 60 + seconds;\n}\n","/// In seconds\nexport const MINUTE = 60;\nexport const HOUR = 3600;\nexport const DAY = 86400;\n\nexport function getMinutes(seconds: number, roundDown?: boolean) {\n  const roundFunc = roundDown ? Math.floor : Math.ceil;\n  return roundFunc(seconds / MINUTE);\n}\n\nexport function getHours(seconds: number, roundDown?: boolean) {\n  const roundFunc = roundDown ? Math.floor : Math.ceil;\n  return roundFunc(seconds / HOUR);\n}\n\nexport function getDays(seconds: number, roundDown?: boolean) {\n  const roundFunc = roundDown ? Math.floor : Math.ceil;\n  return roundFunc(seconds / DAY);\n}\n\nexport function getSeconds(hours: number, minutes: number, seconds: number) {\n  return hours * HOUR + minutes * MINUTE + seconds;\n}\n","/* eslint-disable no-console */\n\nexport const DEBUG_LEVELS = ['log', 'error', 'warn', 'info', 'debug'] as const;\nexport type DebugLevel = typeof DEBUG_LEVELS[number];\n// @ts-ignore\nconst ORIGINAL_FUNCTIONS: Record<DebugLevel, (...args: any[]) => void> = DEBUG_LEVELS.reduce((acc, level) => {\n  // @ts-ignore\n  acc[level] = console[level];\n  return acc;\n}, {});\n\ntype DebugEntry = {\n  level: DebugLevel;\n  args: any[];\n  date: Date;\n};\nlet DEBUG_LOGS: DebugEntry[] = [];\n\nexport function logDebugMessage(level: DebugLevel, ...args: any[]) {\n  DEBUG_LOGS.push({\n    level,\n    args,\n    date: new Date(),\n  });\n  ORIGINAL_FUNCTIONS[level](...args);\n}\n\nexport function initDebugConsole() {\n  DEBUG_LOGS = [];\n  DEBUG_LEVELS.forEach((level) => {\n    // @ts-ignore\n    console[level] = (...args: any[]) => {\n      logDebugMessage(level, ...args);\n    };\n  });\n}\n\nexport function disableDebugConsole() {\n  DEBUG_LEVELS.forEach((level) => {\n    // @ts-ignore\n    console[level] = ORIGINAL_FUNCTIONS[level];\n  });\n  DEBUG_LOGS = [];\n}\n\nexport function getDebugLogs() {\n  return JSON.stringify(DEBUG_LOGS, (key, value) => (typeof value === 'bigint'\n    ? value.toString()\n    : value));\n}\n","import type { ThreadId } from '../types';\n\nimport { RE_TG_LINK, RE_TME_LINK } from '../config';\nimport { toChannelId } from '../global/helpers';\nimport { ensureProtocol } from './browser/url';\nimport { parseTimestampDuration } from './dates/timestamp';\nimport { isUsernameValid } from './username';\nimport { IS_BAD_URL_PARSER } from './windowEnvironment';\n\nexport type DeepLinkMethod = 'resolve' | 'login' | 'passport' | 'settings' | 'join' | 'addstickers' | 'addemoji' |\n'setlanguage' | 'addtheme' | 'confirmphone' | 'socks' | 'proxy' | 'privatepost' | 'bg' | 'share' | 'msg' | 'msg_url' |\n'invoice' | 'addlist' | 'boost' | 'giftcode' | 'message' | 'premium_offer' | 'premium_multigift' | 'stars_topup'\n| 'nft';\n\ninterface PublicMessageLink {\n  type: 'publicMessageLink';\n  username: string;\n  messageId: number;\n  isSingle: boolean;\n  threadId?: ThreadId;\n  commentId?: number;\n  timestamp?: number;\n}\n\nexport interface PrivateMessageLink {\n  type: 'privateMessageLink';\n  channelId: string;\n  messageId: number;\n  isSingle: boolean;\n  threadId?: ThreadId;\n  commentId?: number;\n  timestamp?: number;\n}\n\ninterface ShareLink {\n  type: 'shareLink';\n  url: string;\n  text?: string;\n}\n\ninterface ChatFolderLink {\n  type: 'chatFolderLink';\n  slug: string;\n}\n\ninterface LoginCodeLink {\n  type: 'loginCodeLink';\n  code: string;\n}\n\ninterface TelegramPassportLink {\n  type: 'telegramPassportLink';\n  botId: number;\n  scope: string;\n  publicKey: string;\n  nonce: string;\n  callbackUrl?: string;\n  payload?: string;\n}\n\ninterface PublicUsernameOrBotLink {\n  type: 'publicUsernameOrBotLink';\n  username: string;\n  start?: string;\n  ref?: string;\n  startApp?: string;\n  mode?: string;\n  appName?: string;\n  startAttach?: string;\n  attach?: string;\n  text?: string;\n  choose?: string;\n}\n\ninterface PrivateChannelLink {\n  type: 'privateChannelLink';\n  channelId: string;\n}\n\ninterface ChatBoostLink {\n  type: 'chatBoostLink';\n  username?: string;\n  id?: string;\n}\n\ninterface BusinessChatLink {\n  type: 'businessChatLink';\n  slug: string;\n}\n\ninterface PremiumReferrerLink {\n  type: 'premiumReferrerLink';\n  referrer: string;\n}\n\ninterface PremiumMultigiftLink {\n  type: 'premiumMultigiftLink';\n  referrer: string;\n}\n\ninterface GiftUniqueLink {\n  type: 'giftUniqueLink';\n  slug: string;\n}\n\ntype DeepLink =\n  TelegramPassportLink |\n  LoginCodeLink |\n  PublicMessageLink |\n  PrivateMessageLink |\n  ShareLink |\n  ChatFolderLink |\n  PublicUsernameOrBotLink |\n  PrivateChannelLink |\n  BusinessChatLink |\n  PremiumReferrerLink |\n  PremiumMultigiftLink |\n  ChatBoostLink |\n  GiftUniqueLink;\n\ntype BuilderParams<T extends DeepLink> = Record<keyof Omit<T, 'type'>, string | undefined>;\ntype BuilderReturnType<T extends DeepLink> = T | undefined;\ntype DeepLinkType = DeepLink['type'] | 'unknown';\n\ntype PrivateMessageLinkBuilderParams = Omit<BuilderParams<PrivateMessageLink>, 'isSingle'> & {\n  single?: string;\n};\n\ntype PublicMessageLinkBuilderParams = Omit<BuilderParams<PublicMessageLink>, 'isSingle'> & {\n  single?: string;\n};\n\nconst ELIGIBLE_HOSTNAMES = new Set(['t.me', 'telegram.me', 'telegram.dog']);\n\nexport function isDeepLink(link: string): boolean {\n  return Boolean(link.match(RE_TME_LINK) || link.match(RE_TG_LINK));\n}\n\nexport function tryParseDeepLink(link: string): DeepLink | undefined {\n  if (!isDeepLink(link)) {\n    return undefined;\n  }\n  try {\n    return parseDeepLink(link);\n  } catch (err) {\n    return undefined;\n  }\n}\n\nfunction parseDeepLink(url: string) {\n  const correctUrl = ensureProtocol(url);\n  if (!correctUrl) {\n    return undefined;\n  }\n  if (correctUrl.startsWith('https:') || correctUrl.startsWith('http:')) {\n    const urlParsed = new URL(correctUrl);\n    return parseHttpLink(urlParsed);\n  }\n  if (correctUrl.startsWith('tg:')) {\n    const urlToParse = IS_BAD_URL_PARSER ? correctUrl.replace(/^tg:\\/\\//, 'https://') : correctUrl;\n    const urlParsed = new URL(urlToParse);\n    return parseTgLink(urlParsed);\n  }\n  return undefined;\n}\n\nfunction parseTgLink(url: URL) {\n  const { hostname } = url;\n  const queryParams = getQueryParams(url);\n  const pathParams = getPathParams(url);\n  const method = hostname as DeepLinkMethod;\n\n  const deepLinkType = getTgDeepLinkType(queryParams, pathParams, method);\n  switch (deepLinkType) {\n    case 'publicMessageLink': {\n      const {\n        domain, post, single, thread, comment, t,\n      } = queryParams;\n      return buildPublicMessageLink({\n        username: domain,\n        messageId: post,\n        single,\n        threadId: thread,\n        commentId: comment,\n        timestamp: t,\n      });\n    }\n    case 'privateMessageLink': {\n      const {\n        channel, post, single, thread, comment, t,\n      } = queryParams;\n      return buildPrivateMessageLink({\n        channelId: channel,\n        messageId: post,\n        single,\n        threadId: thread,\n        commentId: comment,\n        timestamp: t,\n      });\n    }\n    case 'shareLink':\n      return buildShareLink({ text: queryParams.text, url: queryParams.url });\n    case 'chatFolderLink':\n      return buildChatFolderLink({ slug: queryParams.slug });\n    case 'loginCodeLink':\n      return buildLoginCodeLink({ code: queryParams.code });\n    case 'telegramPassportLink':\n      return buildTelegramPassportLink({\n        botId: queryParams.bot_id,\n        scope: queryParams.scope,\n        publicKey: queryParams.public_key,\n        nonce: queryParams.nonce,\n        callbackUrl: queryParams.callback_url,\n        payload: queryParams.payload,\n      });\n    case 'publicUsernameOrBotLink':\n      return buildPublicUsernameOrBotLink({\n        username: queryParams.domain,\n        start: queryParams.start,\n        text: queryParams.text,\n        appName: queryParams.appname,\n        startApp: queryParams.startapp,\n        mode: queryParams.mode,\n        startAttach: queryParams.startattach,\n        attach: queryParams.attach,\n        choose: queryParams.choose,\n        ref: queryParams.ref,\n      });\n    case 'privateChannelLink': {\n      return buildPrivateChannelLink({ channelId: queryParams.channel });\n    }\n    case 'businessChatLink':\n      return buildBusinessChatLink({ slug: queryParams.slug });\n    case 'premiumReferrerLink':\n      return buildPremiumReferrerLink({ referrer: queryParams.ref });\n    case 'premiumMultigiftLink':\n      return buildPremiumMultigiftLink({ referrer: queryParams.ref });\n    case 'chatBoostLink':\n      return buildChatBoostLink({ username: queryParams.domain, id: queryParams.channel });\n    case 'giftUniqueLink':\n      return buildGiftUniqueLink({ slug: queryParams.slug });\n    default:\n      break;\n  }\n  return undefined;\n}\n\nfunction parseHttpLink(url: URL) {\n  if (!ELIGIBLE_HOSTNAMES.has(url.hostname)) {\n    return undefined;\n  }\n  const queryParams = getQueryParams(url);\n  const pathParams = getPathParams(url);\n\n  const deepLinkType = getHttpDeepLinkType(queryParams, pathParams);\n  switch (deepLinkType) {\n    case 'publicMessageLink': {\n      const {\n        single, comment, t,\n      } = queryParams;\n      const {\n        username,\n        thread,\n        messageId,\n      } = pathParams.length === 2 ? {\n        username: pathParams[0],\n        thread: queryParams.thread,\n        messageId: pathParams[1],\n      } : {\n        username: pathParams[0],\n        thread: pathParams[1],\n        messageId: pathParams[2],\n      };\n      return buildPublicMessageLink({\n        username,\n        messageId,\n        single,\n        threadId: thread,\n        commentId: comment,\n        timestamp: t,\n      });\n    }\n    case 'privateMessageLink': {\n      const {\n        single, comment, t,\n      } = queryParams;\n      const {\n        channelId,\n        thread,\n        messageId,\n      } = pathParams.length === 3 ? {\n        channelId: pathParams[1],\n        thread: queryParams.thread,\n        messageId: pathParams[2],\n      } : {\n        channelId: pathParams[1],\n        thread: pathParams[2],\n        messageId: pathParams[3],\n      };\n      return buildPrivateMessageLink({\n        channelId,\n        messageId,\n        single,\n        threadId: thread,\n        commentId: comment,\n        timestamp: t,\n      });\n    }\n    case 'shareLink': {\n      return buildShareLink({ text: queryParams.text, url: queryParams.url });\n    }\n    case 'chatFolderLink':\n      return buildChatFolderLink({ slug: pathParams[1] });\n    case 'loginCodeLink':\n      return buildLoginCodeLink({ code: pathParams[1] });\n    case 'publicUsernameOrBotLink':\n      return buildPublicUsernameOrBotLink({\n        username: pathParams[0],\n        start: queryParams.start,\n        text: queryParams.text,\n        startApp: queryParams.startapp,\n        mode: queryParams.mode,\n        appName: undefined,\n        startAttach: queryParams.startattach,\n        attach: queryParams.attach,\n        choose: queryParams.choose,\n        ref: queryParams.ref,\n      });\n    case 'privateChannelLink': {\n      return buildPrivateChannelLink({ channelId: pathParams[1] });\n    }\n    case 'businessChatLink':\n      return buildBusinessChatLink({ slug: pathParams[1] });\n    case 'chatBoostLink': {\n      if (pathParams[0] === 'boost') {\n        return buildChatBoostLink({ username: pathParams[1], id: queryParams.c });\n      }\n      const isPrivateChannel = pathParams[0] === 'c';\n      return buildChatBoostLink({\n        username: !isPrivateChannel ? pathParams[0] : undefined,\n        id: isPrivateChannel ? pathParams[1] : undefined,\n      });\n    }\n    case 'giftUniqueLink': {\n      const slug = pathParams.slice(1).join('/');\n      return buildGiftUniqueLink({\n        slug,\n      });\n    }\n    default:\n      break;\n  }\n  return undefined;\n}\n\nfunction getHttpDeepLinkType(\n  queryParams: Record<string, string>,\n  pathParams: string[],\n): DeepLinkType {\n  const len = pathParams.length;\n  const method = pathParams[0];\n  if (len === 1) {\n    if (method === 'share') return 'shareLink';\n    if (method === 'boost' || queryParams.boost !== undefined) return 'chatBoostLink';\n\n    if (isUsernameValid(method)) {\n      return 'publicUsernameOrBotLink';\n    }\n  } else if (len === 2) {\n    if (method === 'addlist') return 'chatFolderLink';\n    if (method === 'login') return 'loginCodeLink';\n    if (method === 'm') return 'businessChatLink';\n    if (method === 'boost') return 'chatBoostLink';\n    if (method === 'nft') return 'giftUniqueLink';\n    if (method === 'c') {\n      if (queryParams.boost !== undefined) return 'chatBoostLink';\n      return 'privateChannelLink';\n    }\n\n    if (isUsernameValid(pathParams[0]) && isNumber(pathParams[1])) {\n      return 'publicMessageLink';\n    }\n  } else if (len === 3) {\n    if (method === 'c' && pathParams.slice(1).every(isNumber)) {\n      return 'privateMessageLink';\n    }\n    if (isUsernameValid(pathParams[0]) && pathParams.slice(1).every(isNumber)) {\n      return 'publicMessageLink';\n    }\n    if (method === 'nft') return 'giftUniqueLink';\n  } else if (len === 4) {\n    if (method === 'c' && pathParams.slice(1).every(isNumber)) {\n      return 'privateMessageLink';\n    }\n  }\n  return 'unknown';\n}\n\nfunction getTgDeepLinkType(\n  queryParams: Record<string, string>,\n  pathParams: string[],\n  method: DeepLinkMethod,\n): DeepLinkType {\n  switch (method) {\n    case 'resolve': {\n      const {\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        domain, post, bot_id, scope, public_key, nonce,\n      } = queryParams;\n      if (domain === 'telegrampassport' && bot_id && scope && public_key && nonce) {\n        return 'telegramPassportLink';\n      }\n      if (domain && post) {\n        return 'publicMessageLink';\n      }\n      if (isUsernameValid(domain)) {\n        return 'publicUsernameOrBotLink';\n      }\n      break;\n    }\n    case 'privatepost': {\n      const { channel, post } = queryParams;\n      if (channel) {\n        if (post) return 'privateMessageLink';\n        return 'privateChannelLink';\n      }\n      break;\n    }\n    case 'msg_url':\n      return 'shareLink';\n    case 'addlist':\n      return 'chatFolderLink';\n    case 'login':\n      return 'loginCodeLink';\n    case 'passport':\n      return 'telegramPassportLink';\n    case 'message':\n      return 'businessChatLink';\n    case 'premium_offer':\n      return 'premiumReferrerLink';\n    case 'premium_multigift':\n      return 'premiumMultigiftLink';\n    case 'boost':\n      return 'chatBoostLink';\n    case 'nft':\n      return 'giftUniqueLink';\n    default:\n      break;\n  }\n  return 'unknown';\n}\n\nfunction buildShareLink(params: BuilderParams<ShareLink>): BuilderReturnType<ShareLink> {\n  const { url, text } = params;\n  if (!url) {\n    return undefined;\n  }\n  return {\n    type: 'shareLink',\n    url,\n    text,\n  };\n}\n\nfunction buildPublicMessageLink(params: PublicMessageLinkBuilderParams): BuilderReturnType<PublicMessageLink> {\n  const {\n    messageId, threadId, commentId, username, single, timestamp,\n  } = params;\n  if (!username || !isUsernameValid(username)) {\n    return undefined;\n  }\n  if (!messageId || !isNumber(messageId)) {\n    return undefined;\n  }\n  if (threadId && !isNumber(threadId)) {\n    return undefined;\n  }\n  if (commentId && !isNumber(commentId)) {\n    return undefined;\n  }\n  return {\n    type: 'publicMessageLink',\n    username,\n    messageId: Number(messageId),\n    isSingle: single === '',\n    threadId: threadId ? Number(threadId) : undefined,\n    commentId: commentId ? Number(commentId) : undefined,\n    timestamp: timestamp ? parseTimestampDuration(timestamp) : undefined,\n  };\n}\n\nfunction buildPrivateMessageLink(params: PrivateMessageLinkBuilderParams): BuilderReturnType<PrivateMessageLink> {\n  const {\n    messageId, threadId, commentId, channelId, single, timestamp,\n  } = params;\n  if (!channelId || !isNumber(channelId)) {\n    return undefined;\n  }\n  if (!messageId || !isNumber(messageId)) {\n    return undefined;\n  }\n  if (threadId && !isNumber(threadId)) {\n    return undefined;\n  }\n  if (commentId && !isNumber(commentId)) {\n    return undefined;\n  }\n  return {\n    type: 'privateMessageLink',\n    channelId: toChannelId(channelId),\n    messageId: Number(messageId),\n    isSingle: single === '',\n    threadId: threadId ? Number(threadId) : undefined,\n    commentId: commentId ? Number(commentId) : undefined,\n    timestamp: timestamp ? parseTimestampDuration(timestamp) : undefined,\n  };\n}\n\nfunction buildChatFolderLink(params: BuilderParams<ChatFolderLink>): BuilderReturnType<ChatFolderLink> {\n  const {\n    slug,\n  } = params;\n  if (!slug) {\n    return undefined;\n  }\n  return {\n    type: 'chatFolderLink',\n    slug,\n  };\n}\n\nfunction buildLoginCodeLink(params: BuilderParams<LoginCodeLink>): BuilderReturnType<LoginCodeLink> {\n  const {\n    code,\n  } = params;\n  if (!code) {\n    return undefined;\n  }\n  return {\n    type: 'loginCodeLink',\n    code,\n  };\n}\n\nfunction buildTelegramPassportLink(\n  params: BuilderParams<TelegramPassportLink>,\n): BuilderReturnType<TelegramPassportLink> {\n  const {\n    botId,\n    scope,\n    publicKey,\n    nonce,\n    callbackUrl,\n    payload,\n  } = params;\n  if (!botId || !isNumber(botId) || !scope || !publicKey || !nonce) {\n    return undefined;\n  }\n  return {\n    type: 'telegramPassportLink',\n    botId: Number(botId),\n    scope,\n    publicKey,\n    nonce,\n    callbackUrl,\n    payload,\n  };\n}\n\nfunction buildPublicUsernameOrBotLink(\n  params: BuilderParams<PublicUsernameOrBotLink>,\n): BuilderReturnType<PublicUsernameOrBotLink> {\n  const {\n    username,\n    start,\n    text,\n    startApp,\n    mode,\n    startAttach,\n    attach,\n    appName,\n    choose,\n    ref,\n  } = params;\n  if (!username) {\n    return undefined;\n  }\n  if (!isUsernameValid(username)) {\n    return undefined;\n  }\n  return {\n    type: 'publicUsernameOrBotLink',\n    username,\n    start,\n    startApp,\n    mode,\n    appName,\n    startAttach,\n    attach,\n    text,\n    choose,\n    ref,\n  };\n}\n\nfunction buildPrivateChannelLink(params: BuilderParams<PrivateChannelLink>): BuilderReturnType<PrivateChannelLink> {\n  const {\n    channelId,\n  } = params;\n  if (!channelId) {\n    return undefined;\n  }\n\n  return {\n    type: 'privateChannelLink',\n    channelId: toChannelId(channelId),\n  };\n}\n\nexport function buildChatBoostLink(params: BuilderParams<ChatBoostLink>): BuilderReturnType<ChatBoostLink> {\n  const {\n    username,\n    id,\n  } = params;\n\n  if (!username && !id) {\n    return undefined;\n  }\n\n  return {\n    type: 'chatBoostLink',\n    username,\n    id: id ? toChannelId(id) : undefined,\n  };\n}\n\nfunction buildBusinessChatLink(params: BuilderParams<BusinessChatLink>): BuilderReturnType<BusinessChatLink> {\n  const {\n    slug,\n  } = params;\n\n  if (!slug) {\n    return undefined;\n  }\n\n  return {\n    type: 'businessChatLink',\n    slug,\n  };\n}\n\nfunction buildGiftUniqueLink(params: BuilderParams<GiftUniqueLink>): BuilderReturnType<GiftUniqueLink> {\n  const {\n    slug,\n  } = params;\n\n  if (!slug) {\n    return undefined;\n  }\n\n  return {\n    type: 'giftUniqueLink',\n    slug,\n  };\n}\n\nfunction buildPremiumReferrerLink(params: BuilderParams<PremiumReferrerLink>): BuilderReturnType<PremiumReferrerLink> {\n  const {\n    referrer,\n  } = params;\n\n  if (!referrer) {\n    return undefined;\n  }\n\n  return {\n    type: 'premiumReferrerLink',\n    referrer,\n  };\n}\n\nfunction buildPremiumMultigiftLink(\n  params: BuilderParams<PremiumMultigiftLink>,\n): BuilderReturnType<PremiumMultigiftLink> {\n  const {\n    referrer,\n  } = params;\n\n  if (!referrer) {\n    return undefined;\n  }\n\n  return {\n    type: 'premiumMultigiftLink',\n    referrer,\n  };\n}\n\nfunction isNumber(s: string) {\n  return /^-?\\d+$/.test(s);\n}\n\nfunction getPathParams(url: URL) {\n  const parts = url.pathname.split('/').filter(Boolean);\n  if (parts[0] === 's') {\n    parts.shift();\n  }\n  return parts.map(decodeURI);\n}\n\nfunction getQueryParams(url: URL) {\n  return Object.fromEntries(url.searchParams);\n}\n","import { getActions } from '../global';\n\nimport type { ApiChatType, ApiFormattedText } from '../api/types';\nimport type { DeepLinkMethod } from './deepLinkParser';\n\nimport { API_CHAT_TYPES, RE_TG_LINK } from '../config';\nimport { tryParseDeepLink } from './deepLinkParser';\nimport { IS_BAD_URL_PARSER } from './windowEnvironment';\n\nexport const processDeepLink = (url: string): boolean => {\n  const actions = getActions();\n\n  const parsedLink = tryParseDeepLink(url);\n  if (parsedLink) {\n    switch (parsedLink.type) {\n      case 'privateMessageLink':\n        actions.openPrivateChannel({\n          id: parsedLink.channelId,\n          threadId: parsedLink.threadId,\n          messageId: parsedLink.messageId,\n          commentId: parsedLink.commentId,\n          timestamp: parsedLink.timestamp,\n        });\n        return true;\n      case 'publicMessageLink': {\n        actions.openChatByUsername({\n          username: parsedLink.username,\n          threadId: parsedLink.threadId,\n          messageId: parsedLink.messageId,\n          commentId: parsedLink.commentId,\n          timestamp: parsedLink.timestamp,\n        });\n        return true;\n      }\n      case 'publicUsernameOrBotLink': {\n        const choose = parseChooseParameter(parsedLink.choose);\n\n        actions.openChatByUsername({\n          username: parsedLink.username,\n          startParam: parsedLink.start,\n          ref: parsedLink.ref,\n          text: parsedLink.text,\n          startApp: parsedLink.startApp,\n          mode: parsedLink.mode,\n          startAttach: parsedLink.startAttach,\n          attach: parsedLink.attach,\n          choose,\n          originalParts: [parsedLink.username, parsedLink.appName],\n        });\n        return true;\n      }\n      case 'privateChannelLink': {\n        actions.openPrivateChannel({\n          id: parsedLink.channelId,\n        });\n        return true;\n      }\n      case 'businessChatLink':\n        actions.resolveBusinessChatLink({\n          slug: parsedLink.slug,\n        });\n        return true;\n      case 'premiumReferrerLink':\n        actions.openPremiumModal();\n        return true;\n      case 'premiumMultigiftLink':\n        actions.openGiftRecipientPicker();\n        return true;\n      case 'chatBoostLink':\n        actions.processBoostParameters({\n          usernameOrId: (parsedLink.username || parsedLink.id)!,\n          isPrivate: Boolean(parsedLink.id),\n        });\n        return true;\n      case 'giftUniqueLink':\n        actions.openUniqueGiftBySlug({ slug: parsedLink.slug });\n        return true;\n      default:\n        break;\n    }\n  }\n\n  if (!url.match(RE_TG_LINK)) {\n    return false;\n  }\n\n  const urlToParse = IS_BAD_URL_PARSER ? url.replace(/^tg:\\/\\//, 'https://') : url;\n\n  const {\n    protocol, searchParams, hostname,\n  } = new URL(urlToParse);\n\n  if (protocol !== 'tg:') return false;\n\n  const method = hostname as DeepLinkMethod;\n  const params = Object.fromEntries(searchParams);\n\n  const {\n    checkChatInvite,\n    openChatByUsername,\n    openChatByPhoneNumber,\n    openStickerSet,\n    joinVoiceChatByLink,\n    openInvoice,\n    openChatWithDraft,\n    checkChatlistInvite,\n    openStoryViewerByUsername,\n    checkGiftCode,\n    openStarsBalanceModal,\n  } = actions;\n\n  switch (method) {\n    case 'resolve': {\n      const {\n        domain, phone, post, comment, voicechat, livestream, start, startattach, attach, thread, topic,\n        appname, startapp, mode, story, text,\n      } = params;\n\n      const threadId = Number(thread) || Number(topic) || undefined;\n\n      if (domain !== 'telegrampassport') {\n        if (appname) {\n          openChatByUsername({\n            username: domain,\n            startApp: startapp,\n            mode,\n            originalParts: [domain, appname],\n            text,\n          });\n        } else if (params.hasOwnProperty('voicechat') || params.hasOwnProperty('livestream')) {\n          joinVoiceChatByLink({\n            username: domain,\n            inviteHash: voicechat || livestream,\n          });\n        } else if (phone) {\n          openChatByPhoneNumber({\n            phoneNumber: phone,\n            startAttach: startattach,\n            attach,\n            text,\n          });\n        } else if (story) {\n          openStoryViewerByUsername({ username: domain, storyId: Number(story) });\n        } else {\n          openChatByUsername({\n            username: domain,\n            messageId: post ? Number(post) : undefined,\n            commentId: comment ? Number(comment) : undefined,\n            startParam: start,\n            mode,\n            startAttach: startattach,\n            attach,\n            threadId,\n          });\n        }\n      }\n      break;\n    }\n    case 'bg': {\n      // const {\n      //   slug, color, rotation, mode, intensity, bg_color: bgColor, gradient,\n      // } = params;\n      break;\n    }\n    case 'join': {\n      const { invite } = params;\n\n      checkChatInvite({ hash: invite });\n      break;\n    }\n    case 'addemoji':\n    case 'addstickers': {\n      const { set } = params;\n\n      openStickerSet({\n        stickerSetInfo: {\n          shortName: set,\n        },\n      });\n      break;\n    }\n    case 'share':\n    case 'msg':\n    case 'msg_url': {\n      const { url: urlParam, text } = params;\n      openChatWithDraft({ text: formatShareText(urlParam, text) });\n      break;\n    }\n    case 'addlist': {\n      checkChatlistInvite({ slug: params.slug });\n      break;\n    }\n\n    case 'login': {\n      // const { code, token } = params;\n      break;\n    }\n\n    case 'invoice': {\n      const { slug } = params;\n      openInvoice({ type: 'slug', slug });\n      break;\n    }\n\n    case 'stars_topup': {\n      const { balance, purpose } = params;\n      const balanceNeeded = Number(balance);\n      if (!balanceNeeded || balanceNeeded < 0) return true;\n\n      openStarsBalanceModal({ topup: { balanceNeeded, purpose } });\n      break;\n    }\n\n    case 'giftcode': {\n      const { slug } = params;\n      checkGiftCode({ slug });\n      break;\n    }\n    default:\n      // Unsupported deeplink\n      return false;\n  }\n  return true;\n};\n\nexport function formatShareText(url?: string, text?: string, title?: string): ApiFormattedText {\n  return {\n    text: [url, title, text].filter(Boolean).join('\\n'),\n  };\n}\n\nfunction parseChooseParameter(choose?: string) {\n  if (!choose) return undefined;\n  const types = choose.toLowerCase().split(' ').flatMap((type) => {\n    if (type === 'groups') {\n      return ['chats', 'groups'];\n    }\n    return [type];\n  });\n  return types.filter((type): type is ApiChatType => API_CHAT_TYPES.includes(type as ApiChatType));\n}\n","export default function calcTextLineHeightAndCount(textContainer: HTMLElement) {\n  const lineHeight = parseInt(getComputedStyle(textContainer).lineHeight, 10);\n\n  const totalLines = textContainer.scrollHeight / lineHeight;\n\n  return {\n    totalLines,\n    lineHeight,\n  };\n}\n","import type { VirtualElement } from '../../lib/teact/teact';\nimport TeactDOM from '../../lib/teact/teact-dom';\n\nexport default function jsxToHtml(jsx: VirtualElement) {\n  const fragment = document.createElement('div');\n  TeactDOM.render(jsx, fragment);\n\n  const children = Array.from(fragment.children);\n  TeactDOM.render(undefined, fragment);\n\n  return children;\n}\n","import { addCallback } from '../../lib/teact/teactn';\nimport { getGlobal } from '../../global';\n\nimport type { ApiSticker } from '../../api/types';\nimport type { GlobalState } from '../../global/types';\nimport { ApiMediaFormat } from '../../api/types';\n\nimport { requestMutation } from '../../lib/fasterdom/fasterdom';\nimport { getStickerHashById } from '../../global/helpers';\nimport { selectCanPlayAnimatedEmojis } from '../../global/selectors';\nimport { createCallbackManager } from '../callbacks';\nimport generateUniqueId from '../generateUniqueId';\nimport * as mediaLoader from '../mediaLoader';\nimport { throttle } from '../schedulers';\nimport { IS_WEBM_SUPPORTED } from '../windowEnvironment';\n\nimport blankSrc from '../../assets/blank.png';\nimport placeholderSrc from '../../assets/square.svg';\n\ntype CustomEmojiLoadCallback = (customEmojis: GlobalState['customEmojis']) => void;\ntype CustomEmojiInputRenderCallback = (emojiId: string) => void;\n\nconst DOM_PROCESS_THROTTLE = 500;\n\nconst INPUT_WAITING_CUSTOM_EMOJI_IDS: Set<string> = new Set();\n\nconst handlers = new Map<CustomEmojiLoadCallback, string>();\nconst renderCallbacks = createCallbackManager<CustomEmojiInputRenderCallback>();\n\nlet prevGlobal: GlobalState | undefined;\n\naddCallback((global: GlobalState) => {\n  if (\n    global.customEmojis.byId !== prevGlobal?.customEmojis.byId\n    || selectCanPlayAnimatedEmojis(global) !== selectCanPlayAnimatedEmojis(prevGlobal)\n  ) {\n    for (const entry of handlers) {\n      const [handler, id] = entry;\n      if (global.customEmojis.byId[id]) {\n        handler(global.customEmojis);\n      }\n    }\n\n    checkInputCustomEmojiLoad(global.customEmojis);\n  }\n\n  prevGlobal = global;\n});\n\nexport function addCustomEmojiCallback(handler: CustomEmojiLoadCallback, emojiId: string) {\n  handlers.set(handler, emojiId);\n}\n\nexport function removeCustomEmojiCallback(handler: CustomEmojiLoadCallback) {\n  handlers.delete(handler);\n}\n\nexport const addCustomEmojiInputRenderCallback = renderCallbacks.addCallback;\nconst callInputRenderHandlers = throttle(renderCallbacks.runCallbacks, DOM_PROCESS_THROTTLE);\n\nfunction processDomForCustomEmoji() {\n  const emojis = document.querySelectorAll<HTMLImageElement>('.custom-emoji.placeholder');\n  emojis.forEach((emoji) => {\n    const customEmoji = getGlobal().customEmojis.byId[emoji.dataset.documentId!];\n    if (!customEmoji) {\n      INPUT_WAITING_CUSTOM_EMOJI_IDS.add(emoji.dataset.documentId!);\n      return;\n    }\n    const [isPlaceholder, src, uniqueId] = getInputCustomEmojiParams(customEmoji);\n\n    if (customEmoji.shouldUseTextColor && !emoji.classList.contains('colorable')) {\n      requestMutation(() => {\n        emoji.classList.add('colorable');\n      });\n    }\n\n    if (!isPlaceholder) {\n      requestMutation(() => {\n        emoji.src = src;\n        emoji.classList.remove('placeholder');\n        if (uniqueId) emoji.dataset.uniqueId = uniqueId;\n\n        callInputRenderHandlers(customEmoji.id);\n      });\n    }\n  });\n}\n\nexport const processMessageInputForCustomEmoji = throttle(processDomForCustomEmoji, DOM_PROCESS_THROTTLE);\n\nfunction checkInputCustomEmojiLoad(customEmojis: GlobalState['customEmojis']) {\n  const loaded = Array.from(INPUT_WAITING_CUSTOM_EMOJI_IDS).filter((id) => Boolean(customEmojis.byId[id]));\n  if (loaded.length) {\n    loaded.forEach((id) => INPUT_WAITING_CUSTOM_EMOJI_IDS.delete(id));\n    processMessageInputForCustomEmoji();\n  }\n}\n\nexport function getCustomEmojiMediaDataForInput(emojiId: string, isPreview?: boolean) {\n  const mediaHash = getStickerHashById(emojiId, isPreview);\n  const data = mediaLoader.getFromMemory(mediaHash);\n  if (data) {\n    return data;\n  }\n\n  fetchAndProcess(mediaHash);\n  return undefined;\n}\n\nfunction fetchAndProcess(mediaHash: string) {\n  return mediaLoader.fetch(mediaHash, ApiMediaFormat.BlobUrl).then(() => {\n    processMessageInputForCustomEmoji();\n  });\n}\n\nexport function getInputCustomEmojiParams(customEmoji?: ApiSticker) {\n  if (!customEmoji) return [true, placeholderSrc, undefined];\n  const shouldUseStaticFallback = !IS_WEBM_SUPPORTED && customEmoji.isVideo;\n  const isUsingSharedCanvas = customEmoji.isLottie || (customEmoji.isVideo && !shouldUseStaticFallback);\n  if (isUsingSharedCanvas) {\n    fetchAndProcess(`sticker${customEmoji.id}`);\n    return [false, blankSrc, generateUniqueId()];\n  }\n\n  const mediaData = getCustomEmojiMediaDataForInput(customEmoji.id, shouldUseStaticFallback);\n\n  return [!mediaData, mediaData || placeholderSrc, undefined];\n}\n","import { addExtraClass } from '../../lib/teact/teact-dom';\n\nimport { requestMutation } from '../../lib/fasterdom/fasterdom';\nimport { removeVS16s } from '../../lib/twemojiRegex';\nimport withCache from '../withCache';\n\n// Due to the fact that emoji from Apple do not contain some characters, it is necessary to remove them from emoji-data\n// https://github.com/iamcal/emoji-data/issues/136\nconst EXCLUDE_EMOJIS = ['female_sign', 'male_sign', 'medical_symbol'];\n\nconst ISO_FLAGS_OFFSET = 127397;\n\nexport type EmojiRawData = typeof import('emoji-data-ios/emoji-data.json');\nexport type EmojiModule = { default: EmojiRawData };\n\nexport type EmojiData = {\n  categories: Array<EmojiCategory>;\n  emojis: Record<string, Emoji>;\n};\n\nfunction unifiedToNative(unified: string) {\n  const unicodes = unified.split('-');\n  const codePoints = unicodes.map((i) => parseInt(i, 16));\n\n  return String.fromCodePoint(...codePoints);\n}\n\nexport const LOADED_EMOJIS = new Set<string>();\n\nexport function handleEmojiLoad(event: React.SyntheticEvent<HTMLImageElement>) {\n  const emoji = event.currentTarget;\n\n  LOADED_EMOJIS.add(event.currentTarget.dataset.path!);\n\n  requestMutation(() => {\n    addExtraClass(emoji, 'open');\n  });\n}\n\nexport function nativeToUnified(emoji: string) {\n  let code;\n\n  if (emoji.length === 1) {\n    code = emoji.charCodeAt(0).toString(16).padStart(4, '0');\n  } else {\n    const pairs = [];\n    for (let i = 0; i < emoji.length; i++) {\n      if (emoji.charCodeAt(i) >= 0xd800 && emoji.charCodeAt(i) <= 0xdbff) {\n        if (emoji.charCodeAt(i + 1) >= 0xdc00 && emoji.charCodeAt(i + 1) <= 0xdfff) {\n          pairs.push(\n            (emoji.charCodeAt(i) - 0xd800) * 0x400\n            + (emoji.charCodeAt(i + 1) - 0xdc00) + 0x10000,\n          );\n        }\n      } else if (emoji.charCodeAt(i) < 0xd800 || emoji.charCodeAt(i) > 0xdfff) {\n        pairs.push(emoji.charCodeAt(i));\n      }\n    }\n\n    code = pairs.map((x) => x.toString(16).padStart(4, '0')).join('-');\n  }\n\n  return code;\n}\n\nfunction nativeToUnifiedExtended(emoji: string) {\n  return nativeToUnified(removeVS16s(emoji));\n}\n\nexport const nativeToUnifiedExtendedWithCache = withCache(nativeToUnifiedExtended);\n\nexport function uncompressEmoji(data: EmojiRawData): EmojiData {\n  const emojiData: EmojiData = { categories: [], emojis: {} };\n\n  for (let i = 0; i < data.length; i += 2) {\n    const category = {\n      id: data[i][0],\n      name: data[i][1],\n      emojis: [],\n    } as EmojiCategory;\n\n    for (let j = 0; j < data[i + 1].length; j++) {\n      const emojiRaw = data[i + 1][j];\n      if (!EXCLUDE_EMOJIS.includes(emojiRaw[1][0])) {\n        category.emojis.push(emojiRaw[1][0]);\n        emojiData.emojis[emojiRaw[1][0]] = {\n          id: emojiRaw[1][0],\n          names: emojiRaw[1] as string[],\n          native: unifiedToNative(emojiRaw[0] as string),\n          image: (emojiRaw[0] as string).toLowerCase(),\n        };\n      }\n    }\n\n    emojiData.categories.push(category);\n  }\n\n  return emojiData;\n}\n\nexport function isoToEmoji(iso: string) {\n  // Special case for Fragment numbers\n  if (iso === 'FT') {\n    return '\\uD83C\\uDFF4\\u200D\\u2620\\uFE0F';\n  }\n\n  const code = iso.toUpperCase();\n\n  if (!/^[A-Z]{2}$/.test(code)) return iso;\n  const codePoints = [...code].map((c) => c.codePointAt(0)! + ISO_FLAGS_OFFSET);\n  return String.fromCodePoint(...codePoints);\n}\n","import EMOJI_REGEX from '../../lib/twemojiRegex';\n\n// Non-standard variations of emojis, used on some devices\nconst EMOJI_EXCEPTIONS: [string | RegExp, string][] = [\n  [/\\u{1f3f3}\\u200d\\u{1f308}/gu, '\\u{1f3f3}\\ufe0f\\u200d\\u{1f308}'], // 🏳‍🌈\n  [/\\u{1f3f3}\\u200d\\u26a7\\ufe0f?/gu, '\\u{1f3f3}\\ufe0f\\u200d\\u26a7\\ufe0f'], // 🏳️‍⚧️\n  [/\\u26d3\\u200d\\u{1f4a5}/gu, '\\u26d3\\ufe0f\\u200d\\u{1f4a5}'], // ⛓‍💥\n  [/\\u200d([\\u2640\\u2642])(?!\\ufe0f)/gu, '\\u200d$1\\ufe0f'], // Gender variation without 0xFE0F\n];\n\nexport default function fixNonStandardEmoji(text: string) {\n  // Non-standard sequences typically parsed as separate emojis, so no need to fix text without any\n  if (!text.match(EMOJI_REGEX)) return text;\n  // eslint-disable-next-line no-restricted-syntax\n  for (const [regex, replacement] of EMOJI_EXCEPTIONS) {\n    text = text.replace(regex, replacement);\n  }\n\n  return text;\n}\n","import EMOJI_REGEX from '../../lib/twemojiRegex';\nimport fixNonStandardEmoji from './fixNonStandardEmoji';\n\nconst DETECT_UP_TO = 100;\nconst MAX_LENGTH = DETECT_UP_TO * 8; // Maximum 8 code points per one emoji.\n\nexport default function parseEmojiOnlyString(text: string): number | false {\n  const standardizedText = fixNonStandardEmoji(text);\n  const lines = standardizedText.split('\\n');\n  const textWithoutNewlines = lines.join('');\n  if (textWithoutNewlines.length > MAX_LENGTH) {\n    return false;\n  }\n\n  const totalCount = countIfEmojiOnly(textWithoutNewlines);\n  if (!totalCount || totalCount > DETECT_UP_TO) {\n    return false;\n  }\n\n  // Calculate max emoji count per column or line. Used in UI to determine the size of the emoji.\n  let max = lines.length;\n  for (const line of lines) {\n    const count = countIfEmojiOnly(line);\n    if (count === false) {\n      return false;\n    }\n    if (count > max) {\n      max = count;\n    }\n  }\n\n  return max;\n}\n\nfunction countIfEmojiOnly(line: string): false | number {\n  const iterator = line.matchAll(EMOJI_REGEX);\n  let count = 0;\n  let currentIndex = 0;\n\n  for (const match of iterator) {\n    if (match.index !== currentIndex) {\n      return false;\n    }\n\n    count++;\n    currentIndex = match.index + match[0].length;\n  }\n\n  if (currentIndex !== line.length) {\n    return false;\n  }\n\n  return count;\n}\n","import { ESTABLISH_BROADCAST_CHANNEL_NAME } from '../config';\nimport { createCallbackManager } from './callbacks';\nimport { getPasscodeHash, setPasscodeHash } from './passcode';\nimport { IS_MULTITAB_SUPPORTED } from './windowEnvironment';\n\nimport Deferred from './Deferred';\n\nconst ESTABLISH_TIMEOUT = 100;\n\nconst { addCallback, runCallbacks } = createCallbackManager();\nconst { addCallback: addCallbackTokenDied, runCallbacks: runCallbacksTokenDied } = createCallbackManager();\nconst token = Number(Math.random().toString().substring(2));\nconst collectedTokens = new Set([token]);\nlet channel = IS_MULTITAB_SUPPORTED ? new BroadcastChannel(ESTABLISH_BROADCAST_CHANNEL_NAME) : undefined;\n\nlet isEstablished = false;\nconst initialEstablishment = new Deferred();\nlet masterToken: number | undefined;\nlet isWaitingForMaster = false;\nlet reestablishToken: number | undefined;\n\ntype EstablishMessage = {\n  collectedTokens: Set<number>;\n  masterToken?: number;\n  tokenDied?: number;\n  currentPasscodeHash?: ArrayBuffer;\n  reestablishToken?: number;\n  shouldGiveUpMaster?: boolean;\n  hasGaveUpMaster?: boolean;\n};\n\nconst handleMessage = ({ data }: { data: EstablishMessage }) => {\n  if (!channel || !data) return;\n\n  if (data.currentPasscodeHash) {\n    setPasscodeHash(data.currentPasscodeHash);\n  }\n\n  if (data.hasGaveUpMaster && isWaitingForMaster) {\n    masterToken = token;\n    isWaitingForMaster = false;\n    initialEstablishment.resolve();\n    runCallbacks(true);\n    return;\n  }\n\n  if (data.shouldGiveUpMaster) {\n    if (masterToken === token) {\n      runCallbacks(false);\n      channel.postMessage({ currentPasscodeHash: getPasscodeHash(), hasGaveUpMaster: true });\n    }\n    masterToken = data.masterToken;\n    return;\n  }\n\n  if (data.tokenDied) {\n    runCallbacksTokenDied(data.tokenDied);\n    collectedTokens.delete(data.tokenDied);\n    if (data.tokenDied === masterToken) {\n      collectedTokens.delete(data.tokenDied);\n      masterToken = undefined;\n      isEstablished = false;\n      reestablishToken = data.tokenDied;\n\n      channel.postMessage({\n        collectedTokens,\n        masterToken,\n        reestablishToken,\n      });\n      if (collectedTokens.size === 1) {\n        isEstablished = true;\n        masterToken = token;\n        reestablishToken = undefined;\n        initialEstablishment.resolve();\n        runCallbacks(true);\n      }\n    }\n  }\n\n  if (data.collectedTokens) {\n    if (!data.reestablishToken && reestablishToken) {\n      return;\n    }\n    if (data.reestablishToken && reestablishToken !== data.reestablishToken) {\n      data.collectedTokens.delete(data.reestablishToken);\n\n      reestablishToken = data.reestablishToken;\n    }\n    const prevLength = collectedTokens.size;\n    data.collectedTokens.forEach((l) => collectedTokens.add(l));\n    if (reestablishToken) data.collectedTokens.delete(reestablishToken);\n\n    if (!isEstablished) {\n      if (data.masterToken) {\n        reestablishToken = undefined;\n        masterToken = data.masterToken;\n        runCallbacks(masterToken === token);\n\n        if (!isEstablished) {\n          channel.postMessage({\n            collectedTokens,\n            masterToken,\n            reestablishToken,\n          });\n        }\n        initialEstablishment.resolve();\n        isEstablished = true;\n      } else if (prevLength !== collectedTokens.size) {\n        channel.postMessage({\n          collectedTokens,\n          masterToken,\n          reestablishToken,\n        });\n      } else {\n        reestablishToken = undefined;\n        masterToken = Math.max(...Array.from(collectedTokens));\n        runCallbacks(masterToken === token);\n\n        if (!isEstablished) {\n          channel.postMessage({\n            collectedTokens,\n            masterToken,\n            reestablishToken,\n          });\n        }\n        initialEstablishment.resolve();\n        isEstablished = true;\n      }\n    } else if (!data.masterToken) {\n      channel.postMessage({\n        collectedTokens,\n        masterToken,\n        reestablishToken,\n      });\n    }\n  }\n};\n\nexport function establishMultitabRole(shouldReestablishMasterToSelf?: boolean) {\n  if (!channel) return;\n\n  channel.addEventListener('message', handleMessage);\n\n  channel.postMessage({ collectedTokens });\n\n  // To make the connection faster, we can ignore the waiting and connect right away,\n  // and then if we realize we're not master, drop the connection\n  setTimeout(() => {\n    if (masterToken === undefined) {\n      masterToken = token;\n      initialEstablishment.resolve();\n      runCallbacks(true);\n    } else if (shouldReestablishMasterToSelf) {\n      reestablishMasterToSelf();\n    }\n  }, ESTABLISH_TIMEOUT);\n\n  window.addEventListener('beforeunload', signalTokenDead);\n}\n\nexport function signalTokenDead() {\n  if (!channel) return;\n\n  runCallbacksTokenDied(token);\n  channel.removeEventListener('message', handleMessage);\n  channel.postMessage({ tokenDied: token, currentPasscodeHash: getPasscodeHash() });\n  channel.close();\n  channel = undefined;\n}\n\nexport function signalPasscodeHash() {\n  if (!channel) return;\n  channel.postMessage({ currentPasscodeHash: getPasscodeHash() });\n}\n\nexport function getCurrentTabId() {\n  return token;\n}\n\nexport function getAllMultitabTokens() {\n  return Array.from(collectedTokens);\n}\n\nexport function reestablishMasterToSelf() {\n  if (!channel) return;\n\n  isWaitingForMaster = true;\n  channel.postMessage({\n    collectedTokens, masterToken: token, shouldGiveUpMaster: true,\n  });\n}\n\nexport const subscribeToTokenDied = addCallbackTokenDied;\nexport const subscribeToMasterChange = addCallback;\n\nexport const initialEstablishmentPromise = initialEstablishment.promise;\n\nexport function isCurrentTabMaster() {\n  return masterToken === token;\n}\n","import { CONTENT_TYPES_WITH_PREVIEW } from '../config';\nimport { pause } from './schedulers';\n\n// Polyfill for Safari: `File` is not available in web worker\nif (typeof File === 'undefined') {\n  // eslint-disable-next-line no-global-assign, no-restricted-globals, func-names\n  self.File = class extends Blob {\n    name: string;\n\n    constructor(fileBits: BlobPart[], fileName: string, options?: FilePropertyBag) {\n      if (options) {\n        const { type, ...rest } = options;\n        super(fileBits, { type });\n        Object.assign(this, rest);\n      } else {\n        super(fileBits);\n      }\n\n      this.name = fileName;\n    }\n  } as typeof File;\n}\n\nexport function blobToDataUri(blob: Blob): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n\n    reader.onload = (e: ProgressEvent<FileReader>) => {\n      const { result } = e.target || {};\n      if (typeof result === 'string') {\n        resolve(result);\n      }\n\n      reject(new Error('Failed to read blob'));\n    };\n\n    reader.onerror = reject;\n    reader.readAsDataURL(blob);\n  });\n}\n\nexport function blobToFile(blob: Blob, fileName: string) {\n  return new File([blob], fileName, {\n    lastModified: Date.now(),\n    type: blob.type,\n  });\n}\n\nexport function preloadImage(url: string): Promise<HTMLImageElement> {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.onload = () => resolve(img);\n    img.onerror = reject;\n    img.src = url;\n  });\n}\n\nexport function preloadVideo(url: string): Promise<HTMLVideoElement> {\n  return new Promise((resolve, reject) => {\n    const video = document.createElement('video');\n    video.volume = 0;\n    video.onloadedmetadata = () => resolve(video);\n    video.onerror = reject;\n    video.src = url;\n  });\n}\n\nexport async function createPosterForVideo(url: string): Promise<string | undefined> {\n  try {\n    const video = await preloadVideo(url);\n\n    return await Promise.race([\n      pause(2000) as Promise<undefined>,\n      new Promise<string | undefined>((resolve, reject) => {\n        video.onseeked = () => {\n          if (!video.videoWidth || !video.videoHeight) {\n            resolve(undefined);\n          }\n\n          const canvas = document.createElement('canvas');\n          canvas.width = video.videoWidth;\n          canvas.height = video.videoHeight;\n          const ctx = canvas.getContext('2d')!;\n          ctx.drawImage(video, 0, 0);\n\n          canvas.toBlob((blob) => {\n            resolve(blob ? URL.createObjectURL(blob) : undefined);\n          });\n        };\n        video.onerror = reject;\n        video.currentTime = Math.min(video.duration, 1);\n      }),\n    ]);\n  } catch (e) {\n    return undefined;\n  }\n}\n\nexport async function fetchBlob(blobUrl: string) {\n  const response = await fetch(blobUrl);\n  return response.blob();\n}\n\nexport async function fetchFile(blobUrl: string, fileName: string) {\n  const blob = await fetchBlob(blobUrl);\n  return blobToFile(blob, fileName);\n}\n\nexport function imgToCanvas(img: HTMLImageElement) {\n  const canvas = document.createElement('canvas');\n  canvas.width = img.width;\n  canvas.height = img.height;\n\n  const ctx = canvas.getContext('2d')!;\n  ctx.drawImage(img, 0, 0);\n\n  return canvas;\n}\n\nexport function hasPreview(file: File) {\n  return CONTENT_TYPES_WITH_PREVIEW.has(file.type);\n}\n\nexport function validateFiles(files: File[] | FileList | null): File[] | undefined {\n  if (!files?.length) {\n    return undefined;\n  }\n  return Array.from(files).map(fixMovMime).filter((file) => file.size);\n}\n\n// .mov MIME type not reported sometimes https://developer.mozilla.org/en-US/docs/Web/API/File/type#sect1\nfunction fixMovMime(file: File) {\n  const ext = file.name.split('.').pop()!;\n  if (!file.type && ext.toLowerCase() === 'mov') {\n    return new File([file], file.name, { type: 'video/quicktime' });\n  }\n  return file;\n}\n","import { onFullyIdle } from '../lib/teact/teact';\nimport { addCallback } from '../lib/teact/teactn';\nimport { addActionHandler, getGlobal } from '../global';\n\nimport type {\n  ApiChat, ApiChatFolder, ApiNotifyPeerType, ApiPeerNotifySettings, ApiUser,\n} from '../api/types';\nimport type { GlobalState } from '../global/types';\nimport type { CallbackManager } from './callbacks';\n\nimport {\n  ALL_FOLDER_ID, ARCHIVED_FOLDER_ID, DEBUG, SAVED_FOLDER_ID, SERVICE_NOTIFICATIONS_USER_ID,\n} from '../config';\nimport { getIsChatMuted } from '../global/helpers/notifications';\nimport {\n  selectChatLastMessage,\n  selectNotifyDefaults,\n  selectTabState,\n  selectTopics,\n} from '../global/selectors';\nimport arePropsShallowEqual from './arePropsShallowEqual';\nimport { createCallbackManager } from './callbacks';\nimport { areSortedArraysEqual, unique } from './iteratees';\nimport { throttle } from './schedulers';\n\ninterface FolderSummary {\n  id: number;\n  listIds?: Set<string>;\n  orderedPinnedIds?: string[];\n  contacts?: true;\n  nonContacts?: true;\n  groups?: true;\n  channels?: true;\n  bots?: true;\n  excludeMuted?: true;\n  excludeRead?: true;\n  excludeArchived?: true;\n  excludedChatIds?: Set<string>;\n  includedChatIds?: Set<string>;\n  pinnedChatIds?: Set<string>;\n}\n\ninterface ChatSummary {\n  id: string;\n  type: ApiChat['type'];\n  isListedInAll: boolean;\n  isListedInSaved: boolean;\n  isArchived: boolean;\n  isMuted: boolean;\n  isUnread: boolean;\n  unreadCount?: number;\n  unreadMentionsCount?: number;\n  orderInAll: number;\n  orderInSaved: number;\n  isUserBot?: boolean;\n  isUserContact?: boolean;\n}\n\nconst UPDATE_THROTTLE = 500;\nconst DEBUG_DURATION_LIMIT = 6;\n\nconst initials = buildInitials();\n\nlet prevGlobal: {\n  allFolderListIds?: GlobalState['chats']['listIds']['active'];\n  allFolderPinnedIds?: GlobalState['chats']['orderedPinnedIds']['active'];\n  archivedFolderListIds?: GlobalState['chats']['listIds']['archived'];\n  archivedFolderPinnedIds?: GlobalState['chats']['orderedPinnedIds']['archived'];\n  savedFolderListIds?: GlobalState['chats']['listIds']['saved'];\n  savedFolderPinnedIds?: GlobalState['chats']['orderedPinnedIds']['saved'];\n  isAllFolderFullyLoaded?: boolean;\n  isArchivedFolderFullyLoaded?: boolean;\n  isSavedFolderFullyLoaded?: boolean;\n  lastAllMessageIds?: GlobalState['chats']['lastMessageIds']['all'];\n  lastSavedMessageIds?: GlobalState['chats']['lastMessageIds']['saved'];\n  topicsInfoById: GlobalState['chats']['topicsInfoById'];\n  chatsById: Record<string, ApiChat>;\n  foldersById: Record<string, ApiChatFolder>;\n  usersById: Record<string, ApiUser>;\n  notifyDefaults?: Record<ApiNotifyPeerType, ApiPeerNotifySettings>;\n  notifyExceptions?: Record<number, ApiPeerNotifySettings>;\n} = initials.prevGlobal;\n\nlet prepared: {\n  folderSummariesById: Record<string, FolderSummary>;\n  chatSummariesById: Map<string, ChatSummary>;\n  folderIdsByChatId: Record<string, number[]>;\n  chatIdsByFolderId: Record<number, Set<string> | undefined>;\n  isOrderedListJustPatched: Record<number, boolean | undefined>;\n} = initials.prepared;\n\nlet results: {\n  orderedIdsByFolderId: Record<string, string[] | undefined>;\n  pinnedCountByFolderId: Record<string, number | undefined>; // Also watched by `callbacks.orderedIdsByFolderId`\n  chatsCountByFolderId: Record<string, number | undefined>;\n  unreadCountersByFolderId: Record<string, {\n    chatsCount: number;\n    notificationsCount: number;\n  } | undefined>;\n} = initials.results;\n\nlet callbacks: {\n  orderedIdsByFolderId: Record<number, CallbackManager>;\n  chatsCountByFolderId: CallbackManager;\n  unreadCountersByFolderId: CallbackManager;\n} = initials.callbacks;\n\nif (DEBUG) {\n  (window as any).DEBUG_getFolderManager = () => ({\n    prepared,\n    results,\n  });\n}\n\nconst updateFolderManagerThrottled = throttle(() => {\n  onFullyIdle(() => {\n    updateFolderManager(getGlobal());\n  });\n}, UPDATE_THROTTLE);\n\nlet inited = false;\n\n/* Getters */\n\nexport function init() {\n  inited = true;\n\n  addCallback(updateFolderManagerThrottled);\n  addActionHandler('reset', reset);\n\n  const global = getGlobal();\n  if (!selectTabState(global).isMasterTab) {\n    updateFolders(global, true, true, true, true);\n  }\n  updateFolderManager(global);\n}\n\nexport function getOrderedIds(folderId: number) {\n  if (!inited) init();\n\n  return results.orderedIdsByFolderId[folderId];\n}\n\nexport function getPinnedChatsCount(folderId: number) {\n  if (!inited) init();\n\n  return results.pinnedCountByFolderId[folderId] || 0;\n}\n\nexport function getChatsCount() {\n  if (!inited) init();\n\n  return results.chatsCountByFolderId;\n}\n\nexport function getUnreadCounters() {\n  if (!inited) init();\n\n  return results.unreadCountersByFolderId;\n}\n\nexport function getAllNotificationsCount() {\n  return getUnreadCounters()[ALL_FOLDER_ID]?.notificationsCount || 0;\n}\n\nexport function getOrderKey(chatId: string, isForSaved?: boolean) {\n  const summary = prepared.chatSummariesById.get(chatId)!;\n  return isForSaved ? summary.orderInSaved : summary.orderInAll;\n}\n\n/* Callback managers */\n\nexport function addOrderedIdsCallback(folderId: number, callback: (orderedIds: string[]) => void) {\n  if (!callbacks.orderedIdsByFolderId[folderId]) {\n    callbacks.orderedIdsByFolderId[folderId] = createCallbackManager();\n  }\n\n  return callbacks.orderedIdsByFolderId[folderId].addCallback(callback);\n}\n\nexport function addChatsCountCallback(callback: (chatsCount: typeof results.chatsCountByFolderId) => void) {\n  return callbacks.chatsCountByFolderId.addCallback(callback);\n}\n\nexport function addUnreadCountersCallback(callback: (unreadCounters: typeof results.unreadCountersByFolderId) => void) {\n  return callbacks.unreadCountersByFolderId.addCallback(callback);\n}\n\n/* Global update handlers */\n\nfunction updateFolderManager(global: GlobalState) {\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  let DEBUG_startedAt: number;\n  if (DEBUG) {\n    DEBUG_startedAt = performance.now();\n  }\n\n  const isAllFolderChanged = Boolean(\n    global.chats.listIds.active\n    && isMainFolderChanged(ALL_FOLDER_ID, global.chats.listIds.active, global.chats.orderedPinnedIds.active),\n  );\n  const isArchivedFolderChanged = Boolean(\n    global.chats.listIds.archived\n    && isMainFolderChanged(ARCHIVED_FOLDER_ID, global.chats.listIds.archived, global.chats.orderedPinnedIds.archived),\n  );\n  const isSavedFolderChanged = Boolean(\n    global.chats.listIds.saved\n    && isMainFolderChanged(SAVED_FOLDER_ID, global.chats.listIds.saved, global.chats.orderedPinnedIds.saved),\n  );\n  const isAllFullyLoadedChanged = global.chats.isFullyLoaded.active !== prevGlobal.isAllFolderFullyLoaded;\n  const isArchivedFullyLoadedChanged = global.chats.isFullyLoaded.archived !== prevGlobal.isArchivedFolderFullyLoaded;\n  const isSavedFolderFullyLoadedChanged = global.chats.isFullyLoaded.saved !== prevGlobal.isSavedFolderFullyLoaded;\n\n  const areFoldersChanged = global.chatFolders.byId !== prevGlobal.foldersById;\n  const areChatsChanged = global.chats.byId !== prevGlobal.chatsById;\n  const areSavedLastMessageIdsChanged = global.chats.lastMessageIds.saved !== prevGlobal.lastSavedMessageIds;\n  const areAllLastMessageIdsChanged = global.chats.lastMessageIds.all !== prevGlobal.lastAllMessageIds;\n  const areTopicsChanged = global.chats.topicsInfoById !== prevGlobal.topicsInfoById;\n  const areUsersChanged = global.users.byId !== prevGlobal.usersById;\n  const areNotifyDefaultsChanged = selectNotifyDefaults(global) !== prevGlobal.notifyDefaults;\n  const areNotifyExceptionsChanged = global.chats.notifyExceptionById !== prevGlobal.notifyExceptions;\n\n  let affectedFolderIds: number[] = [];\n\n  if (isAllFullyLoadedChanged || isArchivedFullyLoadedChanged || isSavedFolderFullyLoadedChanged) {\n    affectedFolderIds = affectedFolderIds.concat(\n      updateFullyLoaded(global, isArchivedFullyLoadedChanged, isSavedFolderFullyLoadedChanged),\n    );\n  }\n\n  if (!(\n    isAllFolderChanged || isArchivedFolderChanged || isSavedFolderChanged || areFoldersChanged\n    || areChatsChanged || areUsersChanged || areTopicsChanged || areNotifyDefaultsChanged || areNotifyExceptionsChanged\n    || areSavedLastMessageIdsChanged || areAllLastMessageIdsChanged\n  )\n  ) {\n    if (affectedFolderIds.length) {\n      updateResults(affectedFolderIds);\n    }\n\n    return;\n  }\n\n  const prevAllFolderListIds = prevGlobal.allFolderListIds;\n  const prevArchivedFolderListIds = prevGlobal.archivedFolderListIds;\n  const prevSavedFolderListIds = prevGlobal.savedFolderListIds;\n\n  updateFolders(global, isAllFolderChanged, isArchivedFolderChanged, isSavedFolderChanged, areFoldersChanged);\n\n  affectedFolderIds = affectedFolderIds.concat(updateChats(\n    global,\n    areFoldersChanged || isAllFolderChanged || isArchivedFolderChanged || isSavedFolderChanged,\n    areNotifyDefaultsChanged,\n    areNotifyExceptionsChanged,\n    prevAllFolderListIds,\n    prevArchivedFolderListIds,\n    prevSavedFolderListIds,\n  ));\n\n  updateResults(unique(affectedFolderIds));\n\n  if (DEBUG) {\n    const duration = performance.now() - DEBUG_startedAt!;\n    if (duration > DEBUG_DURATION_LIMIT) {\n      // eslint-disable-next-line no-console\n      console.warn(`Slow \\`updateFolderManager\\`: ${Math.round(duration)} ms`);\n    }\n  }\n}\n\nfunction isMainFolderChanged(folderId: number, newListIds?: string[], newPinnedIds?: string[]) {\n  const currentListIds = folderId === ALL_FOLDER_ID\n    ? prevGlobal.allFolderListIds\n    : folderId === SAVED_FOLDER_ID\n      ? prevGlobal.savedFolderListIds : prevGlobal.archivedFolderListIds;\n  const currentPinnedIds = folderId === ALL_FOLDER_ID\n    ? prevGlobal.allFolderPinnedIds\n    : folderId === SAVED_FOLDER_ID\n      ? prevGlobal.savedFolderPinnedIds : prevGlobal.archivedFolderPinnedIds;\n\n  return currentListIds !== newListIds || currentPinnedIds !== newPinnedIds;\n}\n\nfunction updateFullyLoaded(\n  global: GlobalState,\n  isArchivedFullyLoadedChanged = false,\n  isSavedFolderFullyLoadedChanged = false,\n) {\n  let affectedFolderIds = [];\n\n  if (isArchivedFullyLoadedChanged) {\n    affectedFolderIds.push(ARCHIVED_FOLDER_ID);\n  }\n\n  if (isSavedFolderFullyLoadedChanged) {\n    affectedFolderIds.push(SAVED_FOLDER_ID);\n  }\n\n  const isAllFolderFullyLoaded = global.chats.isFullyLoaded.active;\n  const isArchivedFolderFullyLoaded = global.chats.isFullyLoaded.archived;\n  const isSavedFolderFullyLoaded = global.chats.isFullyLoaded.saved;\n\n  if (isAllFolderFullyLoaded && isArchivedFolderFullyLoaded) {\n    const emptyFolderIds = Object.keys(prepared.folderSummariesById)\n      .filter((folderId) => !results.orderedIdsByFolderId[folderId])\n      .map(Number);\n\n    affectedFolderIds = affectedFolderIds.concat(emptyFolderIds);\n  }\n\n  prevGlobal.isAllFolderFullyLoaded = isAllFolderFullyLoaded;\n  prevGlobal.isArchivedFolderFullyLoaded = isArchivedFolderFullyLoaded;\n  prevGlobal.isSavedFolderFullyLoaded = isSavedFolderFullyLoaded;\n\n  return affectedFolderIds;\n}\n\nfunction updateFolders(\n  global: GlobalState,\n  isAllFolderChanged: boolean,\n  isArchivedFolderChanged: boolean,\n  isSavedFolderChanged: boolean,\n  areFoldersChanged: boolean,\n) {\n  const changedFolders = [];\n\n  if (isAllFolderChanged) {\n    const newListIds = global.chats.listIds.active!;\n    const newPinnedIds = global.chats.orderedPinnedIds.active;\n\n    prepared.folderSummariesById[ALL_FOLDER_ID] = buildFolderSummaryFromMainList(\n      ALL_FOLDER_ID, newListIds, newPinnedIds,\n    );\n\n    prevGlobal.allFolderListIds = newListIds;\n    prevGlobal.allFolderPinnedIds = newPinnedIds;\n\n    changedFolders.push(ALL_FOLDER_ID);\n  }\n\n  if (isArchivedFolderChanged) {\n    const newListIds = global.chats.listIds.archived!;\n    const newPinnedIds = global.chats.orderedPinnedIds.archived;\n\n    prepared.folderSummariesById[ARCHIVED_FOLDER_ID] = buildFolderSummaryFromMainList(\n      ARCHIVED_FOLDER_ID, newListIds, newPinnedIds,\n    );\n\n    prevGlobal.archivedFolderListIds = newListIds;\n    prevGlobal.archivedFolderPinnedIds = newPinnedIds;\n\n    changedFolders.push(ARCHIVED_FOLDER_ID);\n  }\n\n  if (isSavedFolderChanged) {\n    const newListIds = global.chats.listIds.saved!;\n    const newPinnedIds = global.chats.orderedPinnedIds.saved;\n\n    prepared.folderSummariesById[SAVED_FOLDER_ID] = buildFolderSummaryFromMainList(\n      SAVED_FOLDER_ID, newListIds, newPinnedIds,\n    );\n\n    prevGlobal.savedFolderListIds = newListIds;\n    prevGlobal.savedFolderPinnedIds = newPinnedIds;\n\n    changedFolders.push(SAVED_FOLDER_ID);\n  }\n\n  if (areFoldersChanged) {\n    const newFoldersById = global.chatFolders.byId;\n\n    Object.values(newFoldersById).forEach((folder) => {\n      if (folder === prevGlobal.foldersById[folder.id]) {\n        return;\n      }\n\n      prepared.folderSummariesById[folder.id] = buildFolderSummary(folder);\n\n      changedFolders.push(folder.id);\n    });\n\n    prevGlobal.foldersById = newFoldersById;\n  }\n\n  return changedFolders;\n}\n\nfunction buildFolderSummaryFromMainList(\n  folderId: number, listIds: string[], orderedPinnedIds?: string[],\n): FolderSummary {\n  return {\n    id: folderId,\n    listIds: new Set(listIds),\n    orderedPinnedIds,\n    pinnedChatIds: new Set(orderedPinnedIds),\n  };\n}\n\nfunction buildFolderSummary(folder: ApiChatFolder): FolderSummary {\n  return {\n    ...folder,\n    orderedPinnedIds: folder.pinnedChatIds,\n    excludedChatIds: folder.excludedChatIds ? new Set(folder.excludedChatIds) : undefined,\n    includedChatIds: folder.excludedChatIds ? new Set(folder.includedChatIds) : undefined,\n    pinnedChatIds: folder.excludedChatIds ? new Set(folder.pinnedChatIds) : undefined,\n  };\n}\n\nfunction updateChats(\n  global: GlobalState,\n  areFoldersChanged: boolean,\n  areNotifyDefaultsChanged: boolean,\n  areNotifyExceptionsChanged: boolean,\n  prevAllFolderListIds?: string[],\n  prevArchivedFolderListIds?: string[],\n  prevSavedFolderListIds?: string[],\n) {\n  const newChatsById = global.chats.byId;\n  const newUsersById = global.users.byId;\n  const newAllLastMessageIds = global.chats.lastMessageIds.all;\n  const newSavedLastMessageIds = global.chats.lastMessageIds.saved;\n  const newNotifyDefaults = selectNotifyDefaults(global);\n  const newNotifyExceptions = global.chats.notifyExceptionById;\n  const folderSummaries = Object.values(prepared.folderSummariesById);\n  const affectedFolderIds = new Set<number>();\n\n  const newAllFolderListIds = global.chats.listIds.active;\n  const newArchivedFolderListIds = global.chats.listIds.archived;\n  const newSavedFolderListIds = global.chats.listIds.saved;\n\n  const newGeneralIds = [...newAllFolderListIds || [], ...newArchivedFolderListIds || []];\n  const newAllIds = [...newGeneralIds, ...newSavedFolderListIds || []];\n  let allIds = newAllIds;\n  if (newAllFolderListIds !== prevAllFolderListIds || newArchivedFolderListIds !== prevArchivedFolderListIds\n    || newSavedFolderListIds !== prevSavedFolderListIds) {\n    allIds = unique(allIds.concat(\n      prevAllFolderListIds || [], prevArchivedFolderListIds || [], prevSavedFolderListIds || [],\n    ));\n  }\n\n  allIds.forEach((chatId) => {\n    const chat = newChatsById[chatId];\n\n    if (\n      !areFoldersChanged\n      && !areNotifyDefaultsChanged\n      && !areNotifyExceptionsChanged\n      && chat === prevGlobal.chatsById[chatId]\n      && newUsersById[chatId] === prevGlobal.usersById[chatId]\n      && newAllLastMessageIds?.[chatId] === prevGlobal.lastAllMessageIds?.[chatId]\n      && newSavedLastMessageIds?.[chatId] === prevGlobal.lastSavedMessageIds?.[chatId]\n    ) {\n      return;\n    }\n\n    let newFolderIds: number[];\n    if (chat) {\n      const currentSummary = prepared.chatSummariesById.get(chatId);\n      const isRemovedFromAll = !newGeneralIds.includes(chatId);\n      const isRemovedFromSaved = !newSavedFolderListIds?.includes(chatId);\n      const newSummary = buildChatSummary(\n        global,\n        chat,\n        newNotifyDefaults,\n        newNotifyExceptions,\n        newUsersById[chatId],\n        isRemovedFromAll,\n        isRemovedFromSaved,\n      );\n\n      if (!areFoldersChanged && currentSummary && arePropsShallowEqual(newSummary, currentSummary)) {\n        return;\n      }\n\n      prepared.chatSummariesById.set(chatId, newSummary);\n\n      newFolderIds = buildChatFolderIds(newSummary, folderSummaries);\n      newFolderIds.forEach((folderId) => {\n        affectedFolderIds.add(folderId);\n      });\n    } else {\n      prepared.chatSummariesById.delete(chatId);\n      newFolderIds = [];\n    }\n\n    const currentFolderIds = prepared.folderIdsByChatId[chatId] || [];\n    if (areSortedArraysEqual(newFolderIds, currentFolderIds)) {\n      return;\n    }\n\n    const deletedFolderIds = updateListsForChat(chatId, currentFolderIds, newFolderIds);\n    deletedFolderIds.forEach((folderId) => {\n      affectedFolderIds.add(folderId);\n    });\n  });\n\n  prevGlobal.chatsById = newChatsById;\n  prevGlobal.usersById = newUsersById;\n  prevGlobal.lastAllMessageIds = newAllLastMessageIds;\n  prevGlobal.lastSavedMessageIds = newSavedLastMessageIds;\n  prevGlobal.notifyDefaults = newNotifyDefaults;\n  prevGlobal.notifyExceptions = newNotifyExceptions;\n\n  return Array.from(affectedFolderIds);\n}\n\nfunction buildChatSummary<T extends GlobalState>(\n  global: T,\n  chat: ApiChat,\n  notifyDefaults?: Record<ApiNotifyPeerType, ApiPeerNotifySettings>,\n  notifyExceptions?: Record<string, ApiPeerNotifySettings>,\n  user?: ApiUser,\n  isRemovedFromAll?: boolean,\n  isRemovedFromSaved?: boolean,\n): ChatSummary {\n  const {\n    id, type, isRestricted, isNotJoined, migratedTo, folderId,\n    unreadCount: chatUnreadCount, unreadMentionsCount: chatUnreadMentionsCount, hasUnreadMark,\n    isForum,\n  } = chat;\n  const topics = selectTopics(global, chat.id);\n\n  const { unreadCount, unreadMentionsCount } = isForum\n    ? Object.values(topics || {}).reduce((acc, topic) => {\n      acc.unreadCount += topic.unreadCount;\n      acc.unreadMentionsCount += topic.unreadMentionsCount;\n\n      return acc;\n    }, { unreadCount: 0, unreadMentionsCount: 0 })\n    : { unreadCount: chatUnreadCount, unreadMentionsCount: chatUnreadMentionsCount };\n\n  const userInfo = type === 'chatTypePrivate' && user;\n  const lastMessage = selectChatLastMessage(global, chat.id);\n  const shouldHideServiceChat = chat.id === SERVICE_NOTIFICATIONS_USER_ID && (\n    !lastMessage || lastMessage.content.action?.type === 'historyClear'\n  );\n\n  const orderInAll = Math.max(chat.creationDate || 0, chat.draftDate || 0, lastMessage?.date || 0);\n\n  const lastMessageInSaved = selectChatLastMessage(global, chat.id, 'saved');\n  const orderInSaved = lastMessageInSaved?.date || 0;\n\n  return {\n    id,\n    type,\n    isListedInAll: Boolean(!isRestricted && !isNotJoined && !migratedTo && !shouldHideServiceChat && !isRemovedFromAll),\n    isListedInSaved: !isRemovedFromSaved,\n    isArchived: folderId === ARCHIVED_FOLDER_ID,\n    isMuted: getIsChatMuted(chat, notifyDefaults, notifyExceptions?.[chat.id]),\n    isUnread: Boolean(unreadCount || unreadMentionsCount || hasUnreadMark),\n    unreadCount,\n    unreadMentionsCount,\n    isUserBot: userInfo ? userInfo.type === 'userTypeBot' : undefined,\n    isUserContact: userInfo ? userInfo.isContact : undefined,\n    orderInAll,\n    orderInSaved,\n  };\n}\n\nfunction buildChatFolderIds(chatSummary: ChatSummary, folderSummaries: FolderSummary[]) {\n  return folderSummaries.reduce<number[]>((acc, folderSummary) => {\n    if (isChatInFolder(chatSummary, folderSummary)) {\n      acc.push(folderSummary.id);\n    }\n\n    return acc;\n  }, []).sort();\n}\n\nfunction isChatInFolder(\n  chatSummary: ChatSummary,\n  folderSummary: FolderSummary,\n) {\n  const isListed = folderSummary.id === SAVED_FOLDER_ID ? chatSummary.isListedInSaved : chatSummary.isListedInAll;\n  if (!isListed) {\n    return false;\n  }\n\n  const { id: chatId, type } = chatSummary;\n\n  if (folderSummary.listIds) {\n    if (\n      (chatSummary.isArchived && folderSummary.id === ALL_FOLDER_ID)\n      || (!chatSummary.isArchived && folderSummary.id === ARCHIVED_FOLDER_ID)\n    ) {\n      return false;\n    }\n\n    return folderSummary.listIds.has(chatId);\n  }\n\n  if (folderSummary.excludedChatIds?.has(chatId)) {\n    return false;\n  }\n\n  if (folderSummary.includedChatIds?.has(chatId)) {\n    return true;\n  }\n\n  if (folderSummary.pinnedChatIds?.has(chatId)) {\n    return true;\n  }\n\n  if (folderSummary.excludeArchived && chatSummary.isArchived) {\n    return false;\n  }\n\n  if (folderSummary.excludeRead && !chatSummary.isUnread) {\n    return false;\n  }\n\n  if (folderSummary.excludeMuted && chatSummary.isMuted && !chatSummary.unreadMentionsCount) {\n    return false;\n  }\n\n  if (type === 'chatTypePrivate') {\n    if (chatSummary.isUserBot) {\n      if (folderSummary.bots) {\n        return true;\n      }\n    } else {\n      if (folderSummary.contacts && chatSummary.isUserContact) {\n        return true;\n      }\n\n      if (folderSummary.nonContacts && !chatSummary.isUserContact) {\n        return true;\n      }\n    }\n  } else if (type === 'chatTypeChannel') {\n    return Boolean(folderSummary.channels);\n  } else if (type === 'chatTypeBasicGroup' || type === 'chatTypeSuperGroup') {\n    return Boolean(folderSummary.groups);\n  }\n\n  return false;\n}\n\nfunction updateListsForChat(chatId: string, currentFolderIds: number[], newFolderIds: number[]) {\n  const currentFolderIdsSet = new Set(currentFolderIds);\n  const newFolderIdsSet = new Set(newFolderIds);\n  const deletedFolderIds: number[] = [];\n\n  unique([...currentFolderIds, ...newFolderIds]).forEach((folderId) => {\n    let currentFolderOrderedIds = results.orderedIdsByFolderId[folderId];\n\n    if (currentFolderIdsSet.has(folderId) && !newFolderIdsSet.has(folderId)) {\n      prepared.chatIdsByFolderId[folderId]!.delete(chatId);\n\n      deletedFolderIds.push(folderId);\n\n      if (currentFolderOrderedIds) {\n        currentFolderOrderedIds = currentFolderOrderedIds.filter((id) => id !== chatId);\n        prepared.isOrderedListJustPatched[folderId] = true;\n      }\n    } else if (!currentFolderIdsSet.has(folderId) && newFolderIdsSet.has(folderId)) {\n      if (!prepared.chatIdsByFolderId[folderId]) {\n        prepared.chatIdsByFolderId[folderId] = new Set();\n      }\n\n      prepared.chatIdsByFolderId[folderId]!.add(chatId);\n\n      if (currentFolderOrderedIds) {\n        currentFolderOrderedIds.push(chatId);\n        prepared.isOrderedListJustPatched[folderId] = true;\n      }\n    }\n\n    results.orderedIdsByFolderId[folderId] = currentFolderOrderedIds;\n  });\n\n  prepared.folderIdsByChatId[chatId] = newFolderIds;\n\n  return deletedFolderIds;\n}\n\nfunction updateResults(affectedFolderIds: number[]) {\n  let wasUnreadCountersChanged = false;\n  let wasChatsCountChanged = false;\n\n  Array.from(affectedFolderIds).forEach((folderId) => {\n    const { pinnedCount: newPinnedCount, orderedIds: newOrderedIds } = buildFolderOrderedIds(folderId);\n    // When signed out\n    if (!newOrderedIds) {\n      return;\n    }\n\n    const currentOrderedIds = results.orderedIdsByFolderId[folderId];\n    const currentPinnedCount = results.pinnedCountByFolderId[folderId];\n    const areOrderedIdsChanged = (\n      !currentOrderedIds\n      || currentPinnedCount === undefined || currentPinnedCount !== newPinnedCount\n      || prepared.isOrderedListJustPatched[folderId]\n      || !areSortedArraysEqual(newOrderedIds, currentOrderedIds)\n    );\n    if (areOrderedIdsChanged) {\n      prepared.isOrderedListJustPatched[folderId] = false;\n      results.orderedIdsByFolderId[folderId] = newOrderedIds;\n      results.pinnedCountByFolderId[folderId] = newPinnedCount;\n      callbacks.orderedIdsByFolderId[folderId]?.runCallbacks(newOrderedIds);\n    }\n\n    const currentChatsCount = results.chatsCountByFolderId[folderId];\n    const newChatsCount = newOrderedIds.length;\n    if (!wasChatsCountChanged) {\n      wasChatsCountChanged = currentChatsCount !== newChatsCount;\n    }\n    results.chatsCountByFolderId[folderId] = newChatsCount;\n\n    const currentUnreadCounters = results.unreadCountersByFolderId[folderId];\n    const newUnreadCounters = buildFolderUnreadCounters(folderId);\n    if (!wasUnreadCountersChanged) {\n      wasUnreadCountersChanged = (\n        !currentUnreadCounters || !arePropsShallowEqual(newUnreadCounters, currentUnreadCounters)\n      );\n    }\n    results.unreadCountersByFolderId[folderId] = newUnreadCounters;\n  });\n\n  if (wasChatsCountChanged) {\n    // We need to update the entire object as it will be returned from a hook\n    const newValue = { ...results.chatsCountByFolderId };\n    results.chatsCountByFolderId = newValue;\n    callbacks.chatsCountByFolderId.runCallbacks(newValue);\n  }\n\n  if (wasUnreadCountersChanged) {\n    // We need to update the entire object as it will be returned from a hook\n    const newValue = { ...results.unreadCountersByFolderId };\n    results.unreadCountersByFolderId = newValue;\n    callbacks.unreadCountersByFolderId.runCallbacks(newValue);\n  }\n}\n\nfunction buildFolderOrderedIds(folderId: number) {\n  const folderSummary = prepared.folderSummariesById[folderId];\n  if (!folderSummary) {\n    return {};\n  }\n\n  const { orderedPinnedIds, pinnedChatIds } = folderSummary;\n  const {\n    chatIdsByFolderId: { [folderId]: chatIds },\n  } = prepared;\n  const {\n    orderedIdsByFolderId: { [folderId]: prevOrderedIds },\n  } = results;\n\n  const isSavedFolder = folderId === SAVED_FOLDER_ID;\n\n  const sortedPinnedIds = chatIds ? orderedPinnedIds?.filter((id) => chatIds.has(id)) : orderedPinnedIds;\n  const allListIds = prevOrderedIds || (chatIds && Array.from(chatIds)) || [];\n  const notPinnedIds = pinnedChatIds ? allListIds.filter((id) => !pinnedChatIds.has(id)) : allListIds;\n  const sortedNotPinnedIds = notPinnedIds.sort((chatId1: string, chatId2: string) => {\n    return getOrderKey(chatId2, isSavedFolder) - getOrderKey(chatId1, isSavedFolder);\n  });\n\n  return {\n    pinnedCount: sortedPinnedIds?.length || 0,\n    orderedIds: [\n      ...(sortedPinnedIds || []),\n      ...sortedNotPinnedIds,\n    ],\n  };\n}\n\nfunction buildFolderUnreadCounters(folderId: number) {\n  const {\n    chatSummariesById,\n  } = prepared;\n  const {\n    orderedIdsByFolderId: { [folderId]: orderedIds },\n  } = results;\n\n  return orderedIds!.reduce((newUnreadCounters, chatId) => {\n    const chatSummary = chatSummariesById.get(chatId);\n    if (!chatSummary) {\n      return newUnreadCounters;\n    }\n\n    if (chatSummary.isUnread) {\n      newUnreadCounters.chatsCount++;\n\n      if (chatSummary.unreadMentionsCount) {\n        newUnreadCounters.notificationsCount += chatSummary.unreadMentionsCount;\n      }\n\n      if (!chatSummary.isMuted) {\n        if (chatSummary.unreadCount) {\n          newUnreadCounters.notificationsCount += chatSummary.unreadCount;\n        } else if (!chatSummary.unreadMentionsCount) {\n          newUnreadCounters.notificationsCount += 1; // Manually marked unread\n        }\n      }\n    }\n\n    return newUnreadCounters;\n  }, {\n    chatsCount: 0,\n    notificationsCount: 0,\n  });\n}\n\nfunction buildInitials() {\n  return {\n    prevGlobal: {\n      foldersById: {},\n      chatsById: {},\n      usersById: {},\n      topicsInfoById: {},\n    },\n\n    prepared: {\n      folderSummariesById: {},\n      chatSummariesById: new Map(),\n      folderIdsByChatId: {},\n      chatIdsByFolderId: {},\n      isOrderedListJustPatched: {},\n    },\n\n    results: {\n      orderedIdsByFolderId: {},\n      pinnedCountByFolderId: {},\n      chatsCountByFolderId: {},\n      unreadCountersByFolderId: {},\n    },\n\n    callbacks: {\n      orderedIdsByFolderId: {},\n      chatsCountByFolderId: createCallbackManager(),\n      unreadCountersByFolderId: createCallbackManager(),\n    },\n  };\n}\n\nfunction reset() {\n  const newInitials = buildInitials();\n\n  prevGlobal = newInitials.prevGlobal;\n  prepared = newInitials.prepared;\n  results = newInitials.results;\n  callbacks = newInitials.callbacks;\n}\n","// Used before applying CSS transition\nexport default function forceReflow(element: HTMLElement) {\n  // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n  element.offsetWidth;\n}\n","import { type TeactNode } from '../lib/teact/teact';\n\nimport type { LangFn } from './localization';\n\nimport { STARS_CURRENCY_CODE } from '../config';\nimport { formatStarsAsIcon } from './localization/format';\n\nexport function formatCurrency(\n  lang: LangFn,\n  totalPrice: number,\n  currency: string,\n  options?: {\n    shouldOmitFractions?: boolean;\n    iconClassName?: string;\n    asFontIcon?: boolean;\n  },\n): TeactNode {\n  const price = totalPrice / 10 ** getCurrencyExp(currency);\n\n  if (currency === STARS_CURRENCY_CODE) {\n    return formatStarsAsIcon(lang, price, { asFont: options?.asFontIcon, className: options?.iconClassName });\n  }\n\n  return formatCurrencyAsString(totalPrice, currency, lang.code, options);\n}\n\nexport function formatCurrencyAsString(\n  totalPrice: number,\n  currency: string,\n  locale: string = 'en',\n  options?: {\n    shouldOmitFractions?: boolean;\n  },\n) {\n  const price = totalPrice / 10 ** getCurrencyExp(currency);\n\n  if ((options?.shouldOmitFractions || currency === STARS_CURRENCY_CODE) && Number.isInteger(price)) {\n    return new Intl.NumberFormat(locale, {\n      style: 'currency',\n      currency,\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 0,\n    }).format(price);\n  }\n\n  return new Intl.NumberFormat(locale, {\n    style: 'currency',\n    currency,\n  }).format(price);\n}\n\nfunction getCurrencyExp(currency: string) {\n  if (currency === 'TON') {\n    return 9;\n  }\n  if (currency === 'CLF') {\n    return 4;\n  }\n  if (['BHD', 'IQD', 'JOD', 'KWD', 'LYD', 'OMR', 'TND'].includes(currency)) {\n    return 3;\n  }\n  if ([\n    'BIF', 'BYR', 'CLP', 'CVE', 'DJF', 'GNF', 'ISK', 'JPY', 'KMF', 'KRW', 'MGA', 'PYG', 'RWF', 'UGX', 'UYI',\n    'VND', 'VUV', 'XAF', 'XOF', 'XPF', STARS_CURRENCY_CODE,\n  ].includes(currency)) {\n    return 0;\n  }\n  if (currency === 'MRO') {\n    return 1;\n  }\n  return 2;\n}\n","import blue from '../assets/icons/forumTopic/blue.svg';\nimport green from '../assets/icons/forumTopic/green.svg';\nimport grey from '../assets/icons/forumTopic/grey.svg';\nimport red from '../assets/icons/forumTopic/red.svg';\nimport rose from '../assets/icons/forumTopic/rose.svg';\nimport violet from '../assets/icons/forumTopic/violet.svg';\nimport yellow from '../assets/icons/forumTopic/yellow.svg';\n\n// eslint-disable-next-line max-len\n// https://github.com/telegramdesktop/tdesktop/blob/1aece79a471d99a8b63d826b1bce1f36a04d7293/Telegram/SourceFiles/data/data_forum_topic.cpp#L50\nconst TOPIC_MAPPING: Record<number, [string, string]> = {\n  0x6FB9F0: [blue, 'blue'],\n  0xFFD67E: [yellow, 'yellow'],\n  0xCB86DB: [violet, 'violet'],\n  0x8EEE98: [green, 'green'],\n  0xFF93B2: [rose, 'rose'],\n  0xFB6F5F: [red, 'red'],\n};\n\nexport function getTopicColors() {\n  return Object.keys(TOPIC_MAPPING).map((key) => parseInt(key, 10));\n}\n\nexport function getTopicDefaultIcon(iconColor?: number) {\n  return (iconColor && TOPIC_MAPPING[iconColor as keyof typeof TOPIC_MAPPING][0]) || grey;\n}\n\nexport function getTopicColorCssVariable(iconColor?: number) {\n  const color = (iconColor && TOPIC_MAPPING[iconColor as keyof typeof TOPIC_MAPPING][1]) || 'grey';\n  return `--color-topic-${color}`;\n}\n","export default function generateUniqueId() {\n  return Date.now().toString(36) + Math.random().toString(36).slice(2);\n}\n","import type { ApiError, ApiFieldError } from '../api/types';\n\nimport { DEBUG } from '../config';\n\nconst READABLE_ERROR_MESSAGES: Record<string, string> = {\n  CHAT_RESTRICTED: 'You can\\'t send messages in this chat, you were restricted',\n  CHAT_SEND_POLL_FORBIDDEN: 'You can\\'t create polls in this chat',\n  CHAT_SEND_STICKERS_FORBIDDEN: 'You can\\'t send stickers in this chat',\n  CHAT_SEND_GIFS_FORBIDDEN: 'You can\\'t send gifs in this chat',\n  CHAT_SEND_MEDIA_FORBIDDEN: 'You can\\'t send media in this chat',\n  CHAT_LINK_EXISTS: 'The chat is public, you can\\'t hide the history to new users',\n  // eslint-disable-next-line max-len\n  SLOWMODE_WAIT_X: 'Slowmode is enabled in this chat: you must wait for the specified number of seconds before sending another message to the chat.',\n  USER_BANNED_IN_CHANNEL: 'You\\'re banned from sending messages in supergroups / channels',\n  USER_IS_BLOCKED: 'You were blocked by this user',\n  YOU_BLOCKED_USER: 'You blocked this user',\n  IMAGE_PROCESS_FAILED: 'Failure while processing image',\n  MEDIA_EMPTY: 'The provided media object is invalid',\n  MEDIA_GROUPED_INVALID: 'Failed to replace album media',\n  MEDIA_NEW_INVALID: 'Failed to replace new media',\n  MESSAGE_NOT_MODIFIED: 'Message not modified. The new content is identical to the current one.',\n  MEDIA_INVALID: 'Media invalid',\n  PASSWORD_HASH_INVALID: 'Incorrect password',\n  PHOTO_EXT_INVALID: 'The extension of the photo is invalid',\n  PHOTO_INVALID_DIMENSIONS: 'The photo dimensions are invalid',\n  PHOTO_SAVE_FILE_INVALID: 'Internal issues, try again later',\n  // eslint-disable-next-line max-len\n  MESSAGE_DELETE_FORBIDDEN: 'You can\\'t delete one of the messages you tried to delete, most likely because it is a service message.',\n  MESSAGE_POLL_CLOSED: 'Poll closed',\n  MESSAGE_EDIT_TIME_EXPIRED: 'You can\\'t edit this message anymore.',\n  PINNED_DIALOGS_TOO_MUCH: 'Sorry, you can only pin 5 chats to the top',\n  CHANNEL_PRIVATE: 'This channel is private',\n  MEDIA_CAPTION_TOO_LONG: 'The provided caption is too long',\n  ADDRESS_STREET_LINE1_INVALID: 'The address you provided is not valid',\n  ADDRESS_STREET_LINE2_INVALID: 'The address you provided is not valid',\n  ADDRESS_CITY_INVALID: 'The city you provided is not valid',\n  ADDRESS_COUNTRY_INVALID: 'The country you provided is not valid',\n  ADDRESS_POSTCODE_INVALID: 'The postcode you provided is not valid',\n  ADDRESS_STATE_INVALID: 'The state you provided is not valid',\n  REQ_INFO_NAME_INVALID: 'The name you provided is not valid',\n  REQ_INFO_PHONE_INVALID: 'The phone you provided is not valid',\n  REQ_INFO_EMAIL_INVALID: 'The email you provided is not valid',\n  // TODO Bring back after fixing the weird bug\n  // CHANNEL_INVALID: 'An error occurred. Please try again later',\n  LINK_NOT_MODIFIED: 'This discussion is already linked to the channel',\n  MESSAGE_TOO_LONG: 'Message is too long',\n\n  // Non-API errors\n  // eslint-disable-next-line max-len\n  SERVICE_WORKER_DISABLED: 'Service Worker is disabled. Streaming media may not be supported. Try reloading the page without holding <Shift> key',\n  // eslint-disable-next-line max-len\n  MESSAGE_TOO_LONG_PLEASE_REMOVE_CHARACTERS: 'The provided message is too long. Please remove {EXTRA_CHARS_COUNT} character{PLURAL_S}.',\n  // eslint-disable-next-line max-len\n  FRESH_RESET_AUTHORISATION_FORBIDDEN: 'You can’t logout other sessions if less than 24 hours have passed since you logged on the current session',\n\n  BOTS_TOO_MUCH: 'There are too many bots in this chat/channel',\n  BOT_GROUPS_BLOCKED: 'This bot can\\'t be added to groups',\n  USERS_TOO_MUCH: 'The maximum number of users has been exceeded',\n  USER_CHANNELS_TOO_MUCH: 'One of the users you tried to add is already in too many channels/supergroups',\n  USER_KICKED: 'This user was kicked from this supergroup/channel',\n  USER_NOT_MUTUAL_CONTACT: 'The provided user is not a mutual contact',\n  USER_PRIVACY_RESTRICTED: 'The user\\'s privacy settings do not allow you to do this',\n  INVITE_HASH_EMPTY: 'The invite hash is empty',\n  INVITE_HASH_EXPIRED: 'The invite link has expired',\n  INVITE_HASH_INVALID: 'The invite hash is invalid',\n  CHANNELS_TOO_MUCH: 'You have joined too many channels/supergroups',\n  USER_ALREADY_PARTICIPANT: 'You already in the group',\n  SCHEDULE_DATE_INVALID: 'Invalid schedule date provided',\n  WALLPAPER_DIMENSIONS_INVALID: 'The wallpaper dimensions are invalid, please select another file',\n  ADMINS_TOO_MUCH: 'There are too many admins',\n  ADMIN_RANK_EMOJI_NOT_ALLOWED: 'An admin rank cannot contain emojis',\n  ADMIN_RANK_INVALID: 'The specified admin rank is invalid',\n  FRESH_CHANGE_ADMINS_FORBIDDEN: 'You were just elected admin, you can\\'t add or modify other admins yet',\n  INPUT_USER_DEACTIVATED: 'Can\\'t do this action to a deleted account',\n  BOT_PRECHECKOUT_TIMEOUT: 'The request for payment has expired',\n  PROVIDER_ACCOUNT_TIMEOUT: 'Request to the payment provider has expired',\n\n  STARGIFT_CONVERT_TOO_OLD: 'This gift no longer can be converted to Stars',\n  SUBSCRIPTION_ALREADY_ACTIVE: 'You are already subscribed',\n\n  PEERS_LIST_EMPTY: 'No chats are added to the list',\n\n  PAID_MEDIA_FORBIDDEN: 'You can\\'t send paid media in this chat',\n};\n\nif (DEBUG) {\n  READABLE_ERROR_MESSAGES.CHAT_WRITE_FORBIDDEN = 'You can\\'t write in this chat';\n  READABLE_ERROR_MESSAGES.CHAT_ADMIN_REQUIRED = 'You must be an admin in this chat to do this';\n}\n\nexport const SHIPPING_ERRORS: Record<string, ApiFieldError> = {\n  ADDRESS_STREET_LINE1_INVALID: {\n    field: 'streetLine1',\n    message: 'Incorrect street address',\n  },\n  ADDRESS_STREET_LINE2_INVALID: {\n    field: 'streetLine2',\n    message: 'Incorrect street address',\n  },\n  ADDRESS_CITY_INVALID: {\n    field: 'city',\n    message: 'Incorrect city',\n  },\n  ADDRESS_COUNTRY_INVALID: {\n    field: 'countryIso2',\n    message: 'Incorrect country',\n  },\n  ADDRESS_POSTCODE_INVALID: {\n    field: 'postCode',\n    message: 'Incorrect post code',\n  },\n  ADDRESS_STATE_INVALID: {\n    field: 'state',\n    message: 'Incorrect state',\n  },\n  REQ_INFO_NAME_INVALID: {\n    field: 'fullName',\n    message: 'Incorrect name',\n  },\n  REQ_INFO_PHONE_INVALID: {\n    field: 'phone',\n    message: 'Incorrect phone',\n  },\n  REQ_INFO_EMAIL_INVALID: {\n    field: 'email',\n    message: 'Incorrect email',\n  },\n};\n\nconst FINAL_PAYMENT_ERRORS = new Set([\n  'BOT_PRECHECKOUT_FAILED',\n  'PAYMENT_FAILED',\n]);\n\nexport default function getReadableErrorText(error: ApiError) {\n  const { message, isSlowMode, textParams } = error;\n  // Currently, Telegram API doesn't return `SLOWMODE_WAIT_X` error as described in the docs\n  if (isSlowMode) {\n    const extraPartIndex = message.indexOf(' (caused by');\n    return extraPartIndex > 0 ? message.substring(0, extraPartIndex) : message;\n  }\n  let errorMessage = READABLE_ERROR_MESSAGES[message];\n  if (errorMessage && textParams) {\n    errorMessage = Object.keys(textParams).reduce((acc, current) => {\n      return acc.replace(current, textParams[current]);\n    }, errorMessage as string);\n  }\n  return errorMessage;\n}\n\nexport function getShippingError(error: ApiError): ApiFieldError | undefined {\n  return SHIPPING_ERRORS[error.message];\n}\n\nexport function shouldClosePaymentModal(error: ApiError): boolean {\n  return FINAL_PAYMENT_ERRORS.has(error.message);\n}\n","import { DEBUG, DEBUG_ALERT_MSG } from '../config';\nimport { isCurrentTabMaster } from './establishMultitabRole';\nimport { throttle } from './schedulers';\n\nlet showError = true;\nlet error: Error | undefined;\n\nwindow.addEventListener('error', handleErrorEvent);\nwindow.addEventListener('unhandledrejection', handleErrorEvent);\n\nif (DEBUG) {\n  window.addEventListener('focus', () => {\n    if (!isCurrentTabMaster()) {\n      return;\n    }\n    showError = true;\n    if (error) {\n      // eslint-disable-next-line no-alert\n      window.alert(getErrorMessage(error));\n      error = undefined;\n    }\n  });\n  window.addEventListener('blur', () => {\n    if (!isCurrentTabMaster()) {\n      return;\n    }\n    showError = false;\n  });\n}\n\nconst throttleError = throttle((err) => {\n  if (showError) {\n    // eslint-disable-next-line no-alert\n    window.alert(getErrorMessage(err));\n  } else {\n    error = err;\n  }\n}, 1500);\n\nexport function handleError(err: Error) {\n  // eslint-disable-next-line no-console\n  console.error(err);\n  if (DEBUG) {\n    throttleError(err);\n  }\n}\n\nfunction handleErrorEvent(e: ErrorEvent | PromiseRejectionEvent) {\n  // https://stackoverflow.com/questions/49384120/resizeobserver-loop-limit-exceeded\n  if (e instanceof ErrorEvent && e.message === 'ResizeObserver loop limit exceeded') {\n    return;\n  }\n\n  e.preventDefault();\n  handleError(e instanceof ErrorEvent ? (e.error || e.message) : e.reason);\n}\n\nfunction getErrorMessage(err: Error) {\n  return `${DEBUG_ALERT_MSG}\\n\\n${(err?.message) || err}\\n${err?.stack}`;\n}\n","import { getActions } from '../global';\n\nlet promptInstall: () => Promise<void>;\n\nexport function setupBeforeInstallPrompt() {\n  window.addEventListener('beforeinstallprompt', (e: any) => {\n    promptInstall = async () => {\n      e.prompt();\n      const userChoice = await e.userChoice;\n      const isInstalled = userChoice.outcome === 'accepted';\n\n      if (!isInstalled) return;\n      getActions().setInstallPrompt({ canInstall: false });\n    };\n    getActions().setInstallPrompt({ canInstall: true });\n  });\n}\n\nexport function getPromptInstall() {\n  return promptInstall;\n}\n","type CollectionByKey<Member> = Record<number | string, Member>;\n\ntype OrderDirection =\n  'asc'\n  | 'desc';\n\ninterface OrderCallback<T> {\n  (member: T): any;\n}\n\nexport function buildCollectionByKey<T extends AnyLiteral>(collection: T[], key: keyof T) {\n  return collection.reduce((byKey: CollectionByKey<T>, member: T) => {\n    byKey[member[key]] = member;\n\n    return byKey;\n  }, {});\n}\n\nexport function buildCollectionByCallback<T extends AnyLiteral, K extends number | string, R extends unknown>(\n  collection: T[],\n  callback: (member: T) => [K, R],\n) {\n  return collection.reduce((byKey: Record<K, R>, member: T) => {\n    const [key, value] = callback(member);\n    byKey[key] = value;\n\n    return byKey;\n  }, {} as Record<K, R>);\n}\n\nexport function mapValues<R extends any, M extends any>(\n  byKey: CollectionByKey<M>,\n  callback: (member: M, key: string, index: number, originalByKey: CollectionByKey<M>) => R,\n): CollectionByKey<R> {\n  return Object.keys(byKey).reduce((newByKey: CollectionByKey<R>, key, index) => {\n    newByKey[key] = callback(byKey[key], key, index, byKey);\n    return newByKey;\n  }, {});\n}\n\nexport function pick<T, K extends keyof T>(object: T, keys: K[]) {\n  return keys.reduce((result, key) => {\n    result[key] = object[key];\n    return result;\n  }, {} as Pick<T, K>);\n}\n\nexport function pickTruthy<T, K extends keyof T>(object: T, keys: K[]) {\n  return keys.reduce((result, key) => {\n    if (object[key]) {\n      result[key] = object[key];\n    }\n\n    return result;\n  }, {} as Pick<T, K>);\n}\n\nexport function omit<T extends object, K extends keyof T>(object: T, keys: K[]): Omit<T, K> {\n  const stringKeys = new Set(keys.map(String));\n  const savedKeys = Object.keys(object)\n    .filter((key) => !stringKeys.has(key)) as Array<Exclude<keyof T, K>>;\n\n  return pick(object, savedKeys);\n}\n\nexport function omitUndefined<T extends object>(object: T): T {\n  return Object.keys(object).reduce((result, stringKey) => {\n    const key = stringKey as keyof T;\n    if (object[key] !== undefined) {\n      result[key as keyof T] = object[key];\n    }\n    return result;\n  }, {} as T);\n}\n\nexport function orderBy<T>(\n  collection: T[],\n  orderRule: (keyof T) | OrderCallback<T> | ((keyof T) | OrderCallback<T>)[],\n  mode: OrderDirection | [OrderDirection, OrderDirection] = 'asc',\n): T[] {\n  function compareValues(a: T, b: T, currentOrderRule: (keyof T) | OrderCallback<T>, isAsc: boolean) {\n    const aValue = (typeof currentOrderRule === 'function' ? currentOrderRule(a) : a[currentOrderRule]) || 0;\n    const bValue = (typeof currentOrderRule === 'function' ? currentOrderRule(b) : b[currentOrderRule]) || 0;\n\n    return isAsc ? aValue - bValue : bValue - aValue;\n  }\n\n  if (Array.isArray(orderRule)) {\n    const [mode1, mode2] = Array.isArray(mode) ? mode : [mode, mode];\n    const [orderRule1, orderRule2] = orderRule;\n    const isAsc1 = mode1 === 'asc';\n    const isAsc2 = mode2 === 'asc';\n\n    return collection.sort((a, b) => {\n      return compareValues(a, b, orderRule1, isAsc1) || compareValues(a, b, orderRule2, isAsc2);\n    });\n  }\n\n  const isAsc = mode === 'asc';\n  return collection.sort((a, b) => {\n    return compareValues(a, b, orderRule, isAsc);\n  });\n}\n\nexport function unique<T extends any>(array: T[]): T[] {\n  return Array.from(new Set(array));\n}\n\nexport function uniqueByField<T extends any>(array: T[], field: keyof T): T[] {\n  return [...new Map(array.map((item) => [item[field], item])).values()];\n}\n\nexport function compact<T extends any>(array: T[]) {\n  return array.filter(Boolean);\n}\n\nexport function areSortedArraysEqual(array1: any[], array2: any[]) {\n  if (array1.length !== array2.length) {\n    return false;\n  }\n\n  return array1.every((item, i) => item === array2[i]);\n}\n\nexport function areSortedArraysIntersecting(array1: any[], array2: any[]) {\n  return array1[0] <= array2[array2.length - 1] && array1[array1.length - 1] >= array2[0];\n}\nexport function isInsideSortedArrayRange(value:any, array: any[]) {\n  return array[0] <= value && value <= array[array.length - 1];\n}\n\nexport function findIntersectionWithSet<T>(array: T[], set: Set<T>): T[] {\n  return array.filter((a) => set.has(a));\n}\n/**\n * Exlude elements from base array. Both arrays should be sorted in same order\n * @param base\n * @param toExclude\n * @returns New array without excluded elements\n */\nexport function excludeSortedArray<T extends any>(base: T[], toExclude: T[]) {\n  if (!base?.length) return base;\n\n  const result: T[] = [];\n\n  let excludeIndex = 0;\n\n  for (let i = 0; i < base.length; i++) {\n    if (toExclude[excludeIndex] === base[i]) {\n      excludeIndex += 1;\n    } else {\n      result.push(base[i]);\n    }\n  }\n\n  return result;\n}\n\nexport function split<T extends any>(array: T[], chunkSize: number) {\n  const result: T[][] = [];\n  for (let i = 0; i < array.length; i += chunkSize) {\n    result.push(array.slice(i, i + chunkSize));\n  }\n\n  return result;\n}\n\nexport function partition<T extends unknown>(\n  array: T[], filter: (value: T, index: number, array: T[]) => boolean | undefined,\n): [T[], T[]] {\n  const pass: T[] = [];\n  const fail: T[] = [];\n\n  array.forEach((e, idx, arr) => (filter(e, idx, arr) ? pass : fail).push(e));\n\n  return [pass, fail];\n}\n\nexport function cloneDeep<T>(value: T): T {\n  if (!isObject(value)) {\n    return value;\n  }\n\n  if (Array.isArray(value)) {\n    return value.map(cloneDeep) as typeof value;\n  }\n\n  return Object.keys(value).reduce((acc, key) => {\n    acc[key as keyof T] = cloneDeep(value[key as keyof T]);\n    return acc;\n  }, {} as T);\n}\n\nexport function isLiteralObject(value: any): value is AnyLiteral {\n  return isObject(value) && !Array.isArray(value);\n}\n\nfunction isObject(value: any): value is object {\n  // eslint-disable-next-line no-null/no-null\n  return typeof value === 'object' && value !== null;\n}\n\nexport function findLast<T>(array: Array<T>, predicate: (value: T, index: number, obj: T[]) => boolean): T | undefined {\n  let cursor = array.length;\n\n  while (cursor--) {\n    if (predicate(array[cursor], cursor, array)) {\n      return array[cursor];\n    }\n  }\n\n  return undefined;\n}\n\nexport function compareFields<T>(a: T, b: T) {\n  return Number(b) - Number(a);\n}\n","import type { ApiMessage, ApiSponsoredMessage } from '../../api/types';\n\nexport type MessageKey = `msg${string}-${number}`;\n\nexport function getMessageKey(message: ApiMessage | ApiSponsoredMessage): MessageKey {\n  const {\n    chatId,\n  } = message;\n\n  if ('randomId' in message) {\n    return buildMessageKey(chatId, Number(message.randomId));\n  }\n  return buildMessageKey(chatId, message.previousLocalId || message.id);\n}\n\nexport function getMessageServerKey(message: ApiMessage): MessageKey | undefined {\n  if (isLocalMessageId(message.id)) {\n    return undefined;\n  }\n  const { chatId, id } = message;\n  return buildMessageKey(chatId, id);\n}\n\nexport function buildMessageKey(chatId: string, msgId: number): MessageKey {\n  return `msg${chatId}-${msgId}`;\n}\n\nexport function parseMessageKey(key: MessageKey) {\n  const match = key.match(/^msg(-?\\d+)-(\\d+)/)!;\n\n  return { chatId: match[1], messageId: Number(match[2]) };\n}\n\nexport function isLocalMessageId(id: number) {\n  return !Number.isInteger(id);\n}\n","import type { ApiMessage } from '../../api/types';\n\nexport type SearchResultKey = `${string}_${number}`;\n\nexport function getSearchResultKey(message: ApiMessage): SearchResultKey {\n  const { chatId, id } = message;\n\n  return `${chatId}_${id}`;\n}\n\nexport function parseSearchResultKey(key: SearchResultKey) {\n  const [chatId, messageId] = key.split('_');\n\n  return [chatId, Number(messageId)] as const;\n}\n","import React from '../../lib/teact/teact';\n\nimport type { LangFn } from './types';\n\nimport { STARS_ICON_PLACEHOLDER } from '../../config';\nimport buildClassName from '../buildClassName';\n\nimport Icon from '../../components/common/icons/Icon';\nimport StarIcon from '../../components/common/icons/StarIcon';\n\nexport function formatStarsAsText(lang: LangFn, amount: number) {\n  return lang('StarsAmountText', { amount }, { pluralValue: amount });\n}\n\nexport function formatStarsAsIcon(lang: LangFn, amount: number, options?: { asFont?: boolean; className?: string }) {\n  const { asFont, className } = options || {};\n  const icon = asFont\n    ? <Icon name=\"star\" className={buildClassName('star-amount-icon', className)} />\n    : <StarIcon type=\"gold\" className={buildClassName('star-amount-icon', className)} size=\"adaptive\" />;\n  return lang('StarsAmount', { amount }, {\n    withNodes: true,\n    specialReplacement: {\n      [STARS_ICON_PLACEHOLDER]: icon,\n    },\n  });\n}\n","import { DEBUG } from '../../config';\n\nexport default function readStrings(data: string): Record<string, string> {\n  const lines = data.split(/;\\r?\\n?/);\n  const result: Record<string, string> = {};\n  for (const line of lines) {\n    if (!line.startsWith('\"')) continue;\n    const [key, value] = parseLine(line) || [];\n    if (!key || !value) {\n      // eslint-disable-next-line no-console\n      console.warn('Bad formatting in line:', line);\n      continue;\n    }\n    if (result[key]) {\n      // eslint-disable-next-line no-console\n      console.warn('Duplicate key:', key);\n    }\n    result[key] = value;\n  }\n  return result;\n}\n\nfunction parseLine(line: string) {\n  let isEscaped = false;\n  let isInsideString = false;\n\n  let separatorIndex;\n  for (let i = 0; i < line.length; i++) {\n    const char = line[i];\n    if (char === '\\\\') {\n      isEscaped = !isEscaped;\n      continue;\n    }\n\n    if (char === '\"' && !isEscaped) {\n      isInsideString = !isInsideString;\n      continue;\n    }\n\n    if (char === '=' && !isInsideString) {\n      separatorIndex = i;\n      break;\n    }\n\n    isEscaped = false;\n  }\n\n  if (separatorIndex === undefined || separatorIndex === line.length - 1) return undefined;\n\n  try {\n    const key = JSON.parse(line.slice(0, separatorIndex));\n    const value = JSON.parse(line.slice(separatorIndex + 1));\n\n    return [key, value];\n  } catch (e) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.error('Error parsing line:', line, e);\n    }\n  }\n\n  return undefined;\n}\n","import type {\n  ApiLanguage, CachedLangData, LangPack, LangPackStringValuePlural,\n} from '../../api/types';\n\nimport readStrings from './readStrings';\n\nconst FALLBACK_LANG_CODE = 'en';\nconst FALLBACK_VERSION = 0;\nconst FALLBACK_TRANSLATE_URL = 'https://translations.telegram.org/en/weba';\n\nexport default async function readFallbackStrings(forLocalScript?: boolean): Promise<CachedLangData> {\n  let fileData;\n  if (forLocalScript) {\n    fileData = (await import('fs')).readFileSync('./src/assets/localization/fallback.strings', 'utf8');\n  } else {\n    const file = await import('../../assets/localization/fallback.strings');\n    fileData = file.default;\n  }\n  const rawStrings = readStrings(fileData);\n\n  const strings: LangPack['strings'] = {};\n\n  Object.entries(rawStrings).forEach(([key, value]) => {\n    const [clearKey, pluralSuffix] = key.split('_');\n\n    if (!pluralSuffix) {\n      strings[clearKey] = value;\n      return;\n    }\n\n    const knownValue = (strings[clearKey] || {}) as LangPackStringValuePlural;\n    knownValue[pluralSuffix as keyof LangPackStringValuePlural] = value;\n    strings[clearKey] = knownValue;\n  });\n\n  const langPack: LangPack = {\n    langCode: FALLBACK_LANG_CODE,\n    version: FALLBACK_VERSION,\n    strings,\n  };\n\n  const stringsCount = Object.keys(strings).length;\n\n  const language: ApiLanguage = {\n    langCode: FALLBACK_LANG_CODE,\n    name: 'English',\n    nativeName: 'English',\n    pluralCode: FALLBACK_LANG_CODE,\n    stringsCount,\n    translatedCount: stringsCount,\n    translationsUrl: FALLBACK_TRANSLATE_URL,\n  };\n\n  return {\n    langPack,\n    language,\n  };\n}\n","/* eslint-disable */\n// This file is generated by dev/generateInitialLangFallback.ts. Do not edit it manually.\n\nimport type { LangPackStringValue } from '../../api/types';\nimport type { LangKey } from '../../types/language';\n\nexport default {\n  \"WrongNumber\": \"Wrong number?\",\n  \"SentAppCode\": \"We've sent the code to the **Telegram** app on your other device.\",\n  \"LoginJustSentSms\": \"We've sent you a code via SMS. Please enter it above.\",\n  \"LoginHeaderPassword\": \"Enter Password\",\n  \"LoginEnterPasswordDescription\": \"You have Two-Step Verification enabled, so your account is protected with an additional password.\",\n  \"StartText\": \"Please confirm your country code\\nand enter your phone number.\",\n  \"LoginPhonePlaceholder\": \"Your phone number\",\n  \"LoginNext\": \"Next\",\n  \"LoginQRLogin\": \"Log in by QR Code\",\n  \"LoginQRTitle\": \"Log in to Telegram by QR Code\",\n  \"LoginQRHelp1\": \"Open Telegram on your phone\",\n  \"LoginQRHelp2\": \"Go to **Settings** > **Devices** > **Link Desktop Device**\",\n  \"LoginQRHelp3\": \"Point your phone at this screen to confirm login\",\n  \"LoginQRCancel\": \"Log in by phone Number\",\n  \"YourName\": \"Your Name\",\n  \"LoginRegisterDesc\": \"Enter your name and add a profile photo.\",\n  \"LoginRegisterFirstNamePlaceholder\": \"First Name\",\n  \"LoginRegisterLastNamePlaceholder\": \"Last Name\",\n  \"LoginSelectCountryTitle\": \"Country\",\n  \"CountryNone\": \"Country not found\",\n  \"PleaseEnterPassword\": \"Enter your new password\",\n  \"ErrorPhoneNumberInvalid\": \"Invalid phone number, please try again.\",\n  \"ErrorCodeInvalid\": \"Invalid code, please try again.\",\n  \"ErrorIncorrectPassword\": \"Invalid password, please try again.\",\n  \"ErrorPasswordFlood\": \"Too many attempts, please try again later.\",\n  \"ErrorPhoneBanned\": \"This phone number is banned.\",\n  \"ErrorFloodTime\": \"Too many attempts, please try again in {time}.\",\n  \"ErrorUnexpected\": \"Unexpected error\",\n  \"ErrorUnexpectedMessage\": \"Unexpected error: {error}\"\n} as Record<LangKey, LangPackStringValue>;\n","import type { TeactNode } from '../../lib/teact/teact';\n\nimport type {\n  ApiLanguage,\n  CachedLangData,\n  LangPack,\n  LangPackStringValue,\n} from '../../api/types';\nimport type { LangKey, LangVariable } from '../../types/language';\nimport {\n  type AdvancedLangFnOptions,\n  type AdvancedLangFnOptionsWithPlural,\n  type AdvancedLangFnParameters,\n  areAdvancedLangFnOptions,\n  isDeletedLangString,\n  isPluralLangString,\n  type LangFn,\n  type LangFnOptions,\n  type LangFnOptionsWithPlural,\n  type LangFnParameters,\n  type LangFormatters,\n  type RegularLangFnParameters,\n} from './types';\n\nimport { DEBUG, LANG_PACK } from '../../config';\nimport { callApi } from '../../api/gramjs';\nimport renderText, { type TextFilter } from '../../components/common/helpers/renderText';\nimport { MAIN_IDB_STORE } from '../browser/idb';\nimport { getBasicListFormat } from '../browser/intlListFormat';\nimport { createCallbackManager } from '../callbacks';\nimport readFallbackStrings from '../data/readFallbackStrings';\nimport { initialEstablishmentPromise, isCurrentTabMaster } from '../establishMultitabRole';\nimport { omit, unique } from '../iteratees';\nimport { notifyLangpackUpdate } from '../multitab';\nimport { replaceInStringsWithTeact } from '../replaceWithTeact';\nimport { fastRaf } from '../schedulers';\nimport { IS_INTL_LIST_FORMAT_SUPPORTED, IS_MULTITAB_SUPPORTED } from '../windowEnvironment';\n\nimport Deferred from '../Deferred';\nimport LimitedMap from '../primitives/LimitedMap';\n\nimport initialStrings from '../../assets/localization/initialStrings';\n\nconst LANGPACK_STORE_PREFIX = 'langpack-';\nconst FORMATTERS_FALLBACK_LANG = 'en';\n\nconst STRING_CACHE_LIMIT = 400;\nconst TRANSLATION_CACHE = new LimitedMap<string, string>(STRING_CACHE_LIMIT);\n\nlet language: ApiLanguage | undefined;\nlet formatters: LangFormatters | undefined;\n\nlet langPack: LangPack | undefined;\nlet fallbackLangPack: LangPack | undefined;\n\nlet translationFn = createTranslationFn();\n\nconst {\n  addCallback,\n  removeCallback,\n  runCallbacks,\n} = createCallbackManager();\n\nlet areCallbacksScheduled = false;\nfunction scheduleCallbacks() {\n  if (areCallbacksScheduled) return;\n  areCallbacksScheduled = true;\n  fastRaf(() => {\n    runCallbacks();\n    areCallbacksScheduled = false;\n  });\n}\n\nconst localizationReady = new Deferred<void>();\n\nfunction loadCachedLangData(langCode: string) {\n  return MAIN_IDB_STORE.get<CachedLangData>(`${LANGPACK_STORE_PREFIX}${langCode}`);\n}\n\nfunction cacheLangData(data: CachedLangData) {\n  notifyLangpackUpdate(data.language.langCode);\n  return MAIN_IDB_STORE.set(`${LANGPACK_STORE_PREFIX}${data.language.langCode}`, data);\n}\n\nlet fallbackLoadPromise: Promise<CachedLangData> | undefined;\nasync function loadFallbackPack() {\n  if (fallbackLangPack || fallbackLoadPromise) return;\n  fallbackLoadPromise = readFallbackStrings();\n  const fallbackData = await fallbackLoadPromise;\n  fallbackLangPack = fallbackData.langPack;\n\n  TRANSLATION_CACHE.clear();\n\n  if (!language) {\n    updateLanguage(fallbackData.language);\n  } else {\n    translationFn = createTranslationFn();\n    scheduleCallbacks();\n  }\n}\n\nasync function fetchDifference() {\n  if (!langPack || !language) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('[Localization] Trying to fetch difference without loaded data');\n    }\n    return;\n  }\n\n  if (IS_MULTITAB_SUPPORTED) {\n    await initialEstablishmentPromise;\n    if (!isCurrentTabMaster()) return;\n  }\n\n  const result = await callApi('fetchLangDifference', {\n    langPack: LANG_PACK,\n    langCode: langPack.langCode,\n    fromVersion: langPack.version,\n  });\n  if (!result) return;\n\n  applyLangPackDifference(result.version, result.strings, result.keysToRemove);\n}\n\nexport function applyLangPackDifference(\n  version: number, strings: Record<string, LangPackStringValue>, keysToRemove: string[],\n) {\n  if (!langPack || !language || version === langPack.version) return;\n\n  const newLangPack = {\n    ...langPack,\n    version,\n    strings: {\n      ...omit(langPack.strings, keysToRemove),\n      ...strings,\n    },\n  };\n  updateLangPack(newLangPack);\n\n  cacheLangData({\n    langPack: newLangPack,\n    language,\n  });\n  scheduleCallbacks();\n}\n\nfunction updateLanguage(newLang: ApiLanguage) {\n  language = newLang;\n\n  createFormatters();\n\n  translationFn = createTranslationFn();\n\n  scheduleCallbacks();\n}\n\nfunction createFormatters() {\n  if (!language) return;\n  const langCode = language.pluralCode;\n  const listFormatFallback = getBasicListFormat();\n\n  function createListFormat(lang: string, type: 'conjunction' | 'disjunction') {\n    return IS_INTL_LIST_FORMAT_SUPPORTED ? new Intl.ListFormat(lang, { type }) : listFormatFallback;\n  }\n\n  try {\n    formatters = {\n      pluralRules: new Intl.PluralRules(langCode),\n      region: new Intl.DisplayNames(langCode, { type: 'region' }),\n      conjunction: createListFormat(langCode, 'conjunction'),\n      disjunction: createListFormat(langCode, 'disjunction'),\n      number: new Intl.NumberFormat(langCode),\n    };\n  } catch (e) {\n    // eslint-disable-next-line no-console\n    console.warn('Failed to create formatters:', e);\n    formatters = {\n      pluralRules: new Intl.PluralRules(FORMATTERS_FALLBACK_LANG),\n      region: new Intl.DisplayNames(FORMATTERS_FALLBACK_LANG, { type: 'region' }),\n      conjunction: createListFormat(FORMATTERS_FALLBACK_LANG, 'conjunction'),\n      disjunction: createListFormat(FORMATTERS_FALLBACK_LANG, 'disjunction'),\n      number: new Intl.NumberFormat(FORMATTERS_FALLBACK_LANG),\n    };\n  }\n}\n\nfunction updateLangPack(newLangPack: LangPack) {\n  langPack = newLangPack;\n\n  TRANSLATION_CACHE.clear();\n\n  scheduleCallbacks();\n}\n\nexport async function initLocalization(langCode: string, canLoadFromServer?: boolean) {\n  if (language) return;\n\n  const cachedData = await loadCachedLangData(langCode);\n  if (cachedData) {\n    langPack = cachedData.langPack;\n    language = cachedData.language;\n    createFormatters();\n\n    fetchDifference();\n  } else if (canLoadFromServer) {\n    await loadAndChangeLanguage(langCode);\n  }\n\n  // Always start loading fallback pack in the background. Some languages may not have every string translated.\n  loadFallbackPack();\n\n  translationFn = createTranslationFn();\n  scheduleCallbacks();\n  localizationReady.resolve();\n}\n\nexport async function refreshFromCache(langCode: string) {\n  if (isCurrentTabMaster()) return;\n\n  const cachedData = await loadCachedLangData(langCode);\n  if (cachedData) {\n    updateLangPack(cachedData.langPack);\n    updateLanguage(cachedData.language);\n  }\n}\n\nexport async function loadAndChangeLanguage(langCode: string, shouldCheckCache?: boolean) {\n  if (shouldCheckCache) { // Can be removed when old lang provider is phased out. Cache is checked in `initLocalization`.\n    const cachedData = await loadCachedLangData(langCode);\n    if (cachedData) {\n      return changeLanguage(cachedData.language);\n    }\n  }\n\n  if (IS_MULTITAB_SUPPORTED) {\n    await initialEstablishmentPromise;\n    if (!isCurrentTabMaster()) return undefined;\n  }\n\n  const remoteLanguage = await callApi('fetchLanguage', {\n    langPack: LANG_PACK,\n    langCode,\n  });\n\n  if (!remoteLanguage) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('Failed to fetch language', langCode);\n    }\n    return undefined;\n  }\n\n  return changeLanguage(remoteLanguage);\n}\n\nexport function requestLangPackDifference(langCode: string) {\n  if (language?.langCode !== langCode) return;\n  fetchDifference();\n}\n\nexport async function changeLanguage(newLanguage: ApiLanguage) {\n  if (langPack && language?.langCode === newLanguage.langCode) return;\n\n  const cachedData = await loadCachedLangData(newLanguage.langCode);\n  if (cachedData) {\n    updateLangPack(cachedData.langPack);\n    updateLanguage(cachedData.language);\n\n    fetchDifference();\n  } else {\n    if (IS_MULTITAB_SUPPORTED) {\n      await initialEstablishmentPromise;\n      if (!isCurrentTabMaster()) return;\n    }\n    const remoteLangPack = await callApi('fetchLangPack', {\n      langPack: LANG_PACK,\n      langCode: newLanguage.langCode,\n    });\n    if (!remoteLangPack) {\n      // eslint-disable-next-line no-console\n      console.warn('Failed to fetch lang pack');\n      return;\n    }\n\n    updateLangPack({\n      langCode: newLanguage.langCode,\n      version: remoteLangPack.version,\n      strings: remoteLangPack.strings,\n    });\n    updateLanguage(newLanguage);\n\n    cacheLangData({\n      langPack: langPack!,\n      language: newLanguage,\n    });\n  }\n\n  document.documentElement.lang = newLanguage.baseLangCode || newLanguage.langCode;\n\n  scheduleCallbacks();\n}\n\nfunction createTranslationFn(): LangFn {\n  const fn: LangFn = ((\n    key: LangKey,\n    variables: Record<string, unknown> | undefined,\n    options: LangFnOptions | AdvancedLangFnOptions | undefined,\n  ) => {\n    if (options && areAdvancedLangFnOptions(options)) {\n      return processTranslationAdvanced(key, variables as Record<string, TeactNode>, options);\n    }\n    return processTranslation(key, variables as Record<string, string | number>, options);\n  }) as LangFn;\n  fn.code = language?.langCode || FORMATTERS_FALLBACK_LANG;\n  fn.isRtl = language?.isRtl;\n  fn.pluralCode = language?.pluralCode || FORMATTERS_FALLBACK_LANG;\n  fn.with = (({ key, variables, options }: LangFnParameters) => {\n    if (options && areAdvancedLangFnOptions(options)) {\n      return processTranslationAdvanced(key, variables as Record<string, TeactNode | undefined>, options);\n    }\n    return processTranslation(key, variables as Record<string, LangVariable>, options);\n  });\n  fn.withRegular = (({ key, variables, options }: RegularLangFnParameters) => {\n    return processTranslation(key, variables, options);\n  });\n  fn.withAdvanced = (({ key, variables, options }: AdvancedLangFnParameters) => {\n    return processTranslationAdvanced(key, variables, options);\n  });\n  fn.region = (code: string) => formatters?.region.of(code);\n  fn.conjunction = (list: string[]) => formatters?.conjunction.format(list) || list.join(', ');\n  fn.disjunction = (list: string[]) => formatters?.disjunction.format(list) || list.join(', ');\n  fn.number = (value: number) => formatters?.number.format(value) || String(value);\n  fn.internalFormatters = formatters!;\n  fn.languageInfo = language!;\n  return fn;\n}\n\nexport function getTranslationFn(): LangFn {\n  return translationFn;\n}\n\nfunction getString(langKey: LangKey, count: number) {\n  let langPackStringValue = langPack?.strings[langKey];\n\n  if (!langPackStringValue && !fallbackLangPack) {\n    loadFallbackPack();\n  }\n\n  langPackStringValue ||= fallbackLangPack?.strings[langKey];\n  langPackStringValue ||= initialStrings[langKey];\n\n  if (!langPackStringValue || isDeletedLangString(langPackStringValue)) return undefined;\n\n  const pluralSuffix = formatters?.pluralRules.select(count) || 'other';\n\n  const string = isPluralLangString(langPackStringValue)\n    ? (langPackStringValue[pluralSuffix] || langPackStringValue.other)\n    : langPackStringValue;\n\n  return string;\n}\n\nfunction processTranslation(\n  langKey: LangKey,\n  variables?: Record<string, LangVariable | RegularLangFnParameters>,\n  options?: LangFnOptions | LangFnOptionsWithPlural,\n): string {\n  const cacheKey = `${langKey}-${JSON.stringify(variables)}-${JSON.stringify(options)}`;\n  if (TRANSLATION_CACHE.has(cacheKey)) {\n    return TRANSLATION_CACHE.get(cacheKey)!;\n  }\n\n  const pluralValue = options && 'pluralValue' in options ? Number(options.pluralValue) : 0;\n  const string = getString(langKey, pluralValue);\n\n  if (!string) return langKey;\n\n  const variableEntries = variables ? Object.entries(variables) : [];\n  const finalString = variableEntries.reduce((result, [key, value]) => {\n    if (value === undefined) return result;\n    if (typeof value === 'object') { // Allow recursive variables in basic `lang.with`\n      value = processTranslation(value.key, value.variables, value.options);\n    }\n\n    const valueAsString = Number.isFinite(value) ? formatters!.number.format(value as number) : String(value);\n    return result.replace(`{${key}}`, valueAsString);\n  }, string);\n\n  TRANSLATION_CACHE.set(cacheKey, finalString);\n\n  return finalString;\n}\n\nfunction processTranslationAdvanced(\n  langKey: LangKey,\n  variables?: Record<string, TeactNode | undefined>,\n  options?: AdvancedLangFnOptions | AdvancedLangFnOptionsWithPlural,\n): TeactNode {\n  const pluralValue = options && 'pluralValue' in options ? Number(options.pluralValue) : 0;\n  const string = getString(langKey, pluralValue);\n  if (!string) return langKey;\n\n  const variableEntries = variables ? Object.entries(variables) : [];\n\n  let tempResult: TeactNode = [string];\n  if (options?.specialReplacement) {\n    const specialReplacements = Object.entries(options.specialReplacement);\n    tempResult = specialReplacements.reduce((acc, [key, value]) => {\n      return replaceInStringsWithTeact(acc, key, value);\n    }, tempResult);\n  }\n\n  const withRenderText = options?.withMarkdown || options?.renderTextFilters;\n\n  if (withRenderText) {\n    const filters = options?.withMarkdown\n      ? unique((options.renderTextFilters || []).concat(['simple_markdown', 'emoji']) as TextFilter[])\n      : options.renderTextFilters;\n\n    return tempResult.flatMap((curr: TeactNode) => {\n      if (typeof curr !== 'string') {\n        return curr;\n      }\n\n      return renderText(curr, filters, {\n        markdownPostProcessor: (part: string) => {\n          return variableEntries.reduce((result, [key, value]): TeactNode[] => {\n            if (value === undefined) return result;\n\n            const preparedValue = Number.isFinite(value) ? formatters!.number.format(value as number) : value;\n            return replaceInStringsWithTeact(result, `{${key}}`, preparedValue);\n          }, [part] as TeactNode[]);\n        },\n      });\n    });\n  }\n\n  return variableEntries.reduce((result, [key, value]): TeactNode[] => {\n    if (value === undefined) return result;\n\n    const preparedValue = Number.isFinite(value) ? formatters!.number.format(value as number) : value;\n    return replaceInStringsWithTeact(result, `{${key}}`, preparedValue);\n  }, tempResult);\n}\n\nexport const localizationReadyPromise = localizationReady.promise;\n\nexport {\n  addCallback as addLocalizationCallback,\n  removeCallback as removeLocalizationCallback,\n};\n\nexport type {\n  LangFn,\n  LangFnParameters,\n  RegularLangFnParameters,\n  AdvancedLangFnParameters,\n};\n","type Part = {\n  type: 'literal' | 'element';\n  value: string;\n};\n\nexport function getBasicListFormat() {\n  return {\n    format: (items: string[]) => items.join(', '),\n    formatToParts: (items: string[]): Part[] => {\n      const result: Part[] = [];\n\n      items.forEach((item, i) => {\n        if (i > 0) {\n          result.push({ type: 'literal', value: ', ' });\n        }\n        result.push({ type: 'element', value: item });\n      });\n\n      return result;\n    },\n  };\n}\n","import type { TeactNode } from '../../lib/teact/teact';\n\nimport type {\n  ApiLanguage,\n  LangPackStringValue,\n  LangPackStringValueDeleted,\n  LangPackStringValuePlural,\n  LangPackStringValueRegular,\n} from '../../api/types';\nimport type { TextFilter } from '../../components/common/helpers/renderText';\nimport type {\n  LangPairPluralWithVariables,\n  LangPairWithVariables,\n  LangVariable,\n  PluralLangKey,\n  PluralLangKeyWithVariables,\n  RegularLangKey,\n  RegularLangKeyWithVariables,\n} from '../../types/language';\n\nexport interface LangFnOptionsRegular {\n  withNodes?: never;\n  withMarkdown?: never;\n  pluralValue?: never;\n}\n\nexport type LangFnOptionsWithPlural = Omit<LangFnOptionsRegular, 'pluralValue'> & {\n  pluralValue: number;\n};\n\nexport type LangFnOptions = LangFnOptionsRegular | LangFnOptionsWithPlural;\n\nexport interface AdvancedLangFnOptionsRegular {\n  withNodes: true;\n  withMarkdown?: boolean;\n  pluralValue?: never;\n  renderTextFilters?: TextFilter[];\n  specialReplacement?: Record<string, TeactNode>;\n}\n\nexport type AdvancedLangFnOptionsWithPlural = Omit<AdvancedLangFnOptionsRegular, 'pluralValue'> & {\n  pluralValue: number;\n};\n\nexport type AdvancedLangFnOptions = AdvancedLangFnOptionsRegular | AdvancedLangFnOptionsWithPlural;\n\ntype LangPairWithNodes = LangPairWithVariables<TeactNode | undefined>;\ntype LangPairPluralWithNodes = LangPairPluralWithVariables<TeactNode | undefined>;\n\ntype RegularLangFnParametersWithoutVariables = {\n  key: RegularLangKey;\n  variables?: undefined;\n  options?: LangFnOptions;\n};\n\ntype RegularLangFnParametersWithVariables<T = LangPairWithVariables> = {\n  [K in keyof T]: {\n    key: K;\n    variables: {\n      [key in keyof T[K]]: LangVariable | RegularLangFnParameters;\n    };\n    options?: LangFnOptions;\n  }\n}[keyof T];\n\ntype RegularLangFnPluralParameters = {\n  key: PluralLangKey;\n  variables?: undefined;\n  options: LangFnOptionsWithPlural;\n};\n\ntype RegularLangFnPluralParametersWithVariables<T = LangPairPluralWithVariables> = {\n  [K in keyof T]: {\n    key: K;\n    variables: {\n      [key in keyof T[K]]: LangVariable | RegularLangFnParameters;\n    };\n    options: LangFnOptionsWithPlural;\n  }\n}[keyof T];\n\nexport type RegularLangFnParameters =\n| RegularLangFnParametersWithoutVariables\n| RegularLangFnParametersWithVariables\n| RegularLangFnPluralParameters\n| RegularLangFnPluralParametersWithVariables;\n\ntype AdvancedLangFnParametersWithoutVariables = {\n  key: RegularLangKey;\n  variables?: undefined;\n  options: AdvancedLangFnOptions;\n};\n\ntype AdvancedLangFnParametersWithVariables<T = LangPairWithNodes> = {\n  [K in keyof T]: {\n    key: K;\n    variables: T[K];\n    options: AdvancedLangFnOptions;\n  }\n}[keyof T];\n\ntype AdvancedLangFnPluralParameters = {\n  key: PluralLangKey;\n  variables?: undefined;\n  options: AdvancedLangFnOptionsWithPlural;\n};\n\ntype AdvancedLangFnPluralParametersWithVariables<T = LangPairPluralWithNodes> = {\n  [K in keyof T]: {\n    key: K;\n    variables: T[K];\n    options: AdvancedLangFnOptionsWithPlural;\n  }\n}[keyof T];\n\nexport type AdvancedLangFnParameters =\n| AdvancedLangFnParametersWithoutVariables\n| AdvancedLangFnParametersWithVariables\n| AdvancedLangFnPluralParameters\n| AdvancedLangFnPluralParametersWithVariables;\n\nexport type LangFnParameters = RegularLangFnParameters | AdvancedLangFnParameters;\n\nexport type LangFn = {\n  <K extends RegularLangKey = RegularLangKey>(\n    key: K, variables?: undefined, options?: LangFnOptions,\n  ): string;\n  <K extends PluralLangKey = PluralLangKey>(\n    key: K, variables: undefined, options: LangFnOptionsWithPlural,\n  ): string;\n  <K extends RegularLangKeyWithVariables = RegularLangKeyWithVariables>(\n    key: K, variables: LangPairWithVariables[K], options?: LangFnOptions,\n  ): string;\n  <K extends PluralLangKeyWithVariables = PluralLangKeyWithVariables>(\n    key: K, variables: LangPairPluralWithVariables[K], options: LangFnOptionsWithPlural,\n  ): string;\n\n  <K extends RegularLangKey = RegularLangKey>(\n    key: K, variables?: undefined, options?: AdvancedLangFnOptions,\n  ): TeactNode;\n  <K extends PluralLangKey = PluralLangKey>(\n    key: K, variables: undefined, options: AdvancedLangFnOptionsWithPlural,\n  ): TeactNode;\n  <K extends RegularLangKeyWithVariables = RegularLangKeyWithVariables>(\n    key: K, variables: LangPairWithVariables<TeactNode | undefined>[K], options: AdvancedLangFnOptions,\n  ): TeactNode;\n  <K extends PluralLangKeyWithVariables = PluralLangKeyWithVariables>(\n    key: K, variables: LangPairPluralWithVariables<TeactNode | undefined>[K], options: AdvancedLangFnOptionsWithPlural,\n  ): TeactNode;\n\n  with: (params: LangFnParameters) => TeactNode;\n  withRegular: (params: RegularLangFnParameters) => string;\n  withAdvanced: (params: AdvancedLangFnParameters) => TeactNode;\n  region: (code: string) => string | undefined;\n  conjunction: (list: string[]) => string;\n  disjunction: (list: string[]) => string;\n  number: (value: number) => string;\n  internalFormatters: LangFormatters;\n  isRtl?: boolean;\n  code: string;\n  pluralCode: string;\n  languageInfo: ApiLanguage;\n};\n\n// Allow basic polyfill\ntype ListFormat = Pick<Intl.ListFormat, 'format' | 'formatToParts'>;\n\nexport type LangFormatters = {\n  pluralRules: Intl.PluralRules;\n  region: Intl.DisplayNames;\n  conjunction: ListFormat;\n  disjunction: ListFormat;\n  number: Intl.NumberFormat;\n};\n\n/* GUARDS */\n\nexport function isDeletedLangString(string: LangPackStringValue): string is LangPackStringValueDeleted {\n  return typeof string === 'object' && 'isDeleted' in string;\n}\n\nexport function isRegularLangString(string: LangPackStringValue): string is LangPackStringValueRegular {\n  return typeof string === 'string';\n}\n\nexport function isPluralLangString(string: LangPackStringValue): string is LangPackStringValuePlural {\n  return !isRegularLangString(string) && !isDeletedLangString(string);\n}\n\nexport function isLangFnParam(object: unknown): object is LangFnParameters {\n  return Boolean(object) && typeof object === 'object' && 'key' in object! && !('type' in object);\n}\n\nexport function areAdvancedLangFnOptions(\n  params: LangFnOptions | AdvancedLangFnOptions,\n): params is AdvancedLangFnOptions {\n  return 'withNodes' in params && Boolean(params.withNodes);\n}\n","export const clamp = (num: number, min: number, max: number) => (Math.min(max, Math.max(min, num)));\nexport const isBetween = (num: number, min: number, max: number) => (num >= min && num <= max);\nexport const round = (num: number, decimals: number = 0) => Math.round(num * 10 ** decimals) / 10 ** decimals;\nexport const lerp = (start: number, end: number, interpolationRatio: number) => {\n  return (1 - interpolationRatio) * start + interpolationRatio * end;\n};\n\n// Fractional values cause blurry text & canvas. Round to even to keep whole numbers while centering\nexport function roundToNearestEven(value: number) {\n  return Math.round(value / 2) * 2;\n}\n","const SAMPLE_RATE = 48000;\nconst BIT_DEPTH = 16;\n\nexport async function oggToWav(opusData: Blob): Promise<Blob> {\n  const arrayBuffer = await new Response(opusData).arrayBuffer();\n\n  return new Promise((resolve) => {\n    const typedArray = new Uint8Array(arrayBuffer);\n\n    let decoderWorker: Worker | undefined = new Worker(\n      new URL('opus-recorder/dist/decoderWorker.min.js', import.meta.url),\n    );\n    let wavWorker: Worker | undefined = new Worker(new URL('opus-recorder/dist/waveWorker.min.js', import.meta.url));\n\n    decoderWorker.onmessage = (e) => {\n      // eslint-disable-next-line no-null/no-null\n      if (e.data === null) {\n        // `null` means decoder is finished\n        wavWorker!.postMessage({ command: 'done' });\n      } else {\n        // `e.data` contains decoded buffers as float32 values\n        wavWorker!.postMessage(\n          {\n            command: 'encode',\n            buffers: e.data,\n          },\n          e.data.map(({ buffer }: Float32Array) => buffer),\n        );\n      }\n    };\n\n    wavWorker.onmessage = (e) => {\n      if (e.data.message === 'page') {\n        resolve(new Blob([e.data.page], { type: 'audio/wav' }));\n\n        decoderWorker!.terminate();\n        decoderWorker = undefined;\n        wavWorker!.terminate();\n        wavWorker = undefined;\n      }\n    };\n\n    wavWorker.postMessage({\n      command: 'init',\n      wavBitDepth: BIT_DEPTH,\n      wavSampleRate: SAMPLE_RATE,\n    });\n\n    decoderWorker.postMessage({\n      command: 'init',\n      decoderSampleRate: SAMPLE_RATE,\n      outputBufferSampleRate: SAMPLE_RATE,\n    });\n\n    decoderWorker.postMessage({\n      command: 'decode',\n      pages: typedArray,\n    }, [typedArray.buffer]);\n  });\n}\n","import type {\n  ApiOnProgress,\n  ApiParsedMedia,\n  ApiPreparedMedia,\n} from '../api/types';\nimport {\n  ApiMediaFormat,\n} from '../api/types';\n\nimport {\n  DEBUG, ELECTRON_HOST_URL,\n  IS_PACKAGED_ELECTRON, MEDIA_CACHE_DISABLED, MEDIA_CACHE_NAME, MEDIA_CACHE_NAME_AVATARS,\n} from '../config';\nimport { callApi, cancelApiProgress } from '../api/gramjs';\nimport * as cacheApi from './cacheApi';\nimport { fetchBlob } from './files';\nimport { oggToWav } from './oggToWav';\nimport {\n  IS_OPUS_SUPPORTED, IS_PROGRESSIVE_SUPPORTED,\n} from './windowEnvironment';\n\nconst asCacheApiType = {\n  [ApiMediaFormat.BlobUrl]: cacheApi.Type.Blob,\n  [ApiMediaFormat.Text]: cacheApi.Type.Text,\n  [ApiMediaFormat.DownloadUrl]: undefined,\n  [ApiMediaFormat.Progressive]: undefined,\n};\n\nconst PROGRESSIVE_URL_PREFIX = `${IS_PACKAGED_ELECTRON ? ELECTRON_HOST_URL : '.'}/progressive/`;\nconst URL_DOWNLOAD_PREFIX = './download/';\nconst MAX_MEDIA_RETRIES = 5;\n\nconst memoryCache = new Map<string, ApiPreparedMedia>();\nconst fetchPromises = new Map<string, Promise<ApiPreparedMedia | undefined>>();\nconst progressCallbacks = new Map<string, Map<string, ApiOnProgress>>();\nconst cancellableCallbacks = new Map<string, ApiOnProgress>();\n\nexport function fetch<T extends ApiMediaFormat>(\n  url: string,\n  mediaFormat: T,\n  isHtmlAllowed = false,\n  onProgress?: ApiOnProgress,\n  callbackUniqueId?: string,\n): Promise<ApiPreparedMedia> {\n  if (mediaFormat === ApiMediaFormat.Progressive) {\n    return (\n      IS_PROGRESSIVE_SUPPORTED\n        ? getProgressive(url)\n        : fetch(url, ApiMediaFormat.BlobUrl, isHtmlAllowed, onProgress, callbackUniqueId)\n    ) as Promise<ApiPreparedMedia>;\n  }\n\n  if (mediaFormat === ApiMediaFormat.DownloadUrl) {\n    return (\n      IS_PROGRESSIVE_SUPPORTED\n        ? getDownloadUrl(url)\n        : fetch(url, ApiMediaFormat.BlobUrl, isHtmlAllowed, onProgress, callbackUniqueId)\n    ) as Promise<ApiPreparedMedia>;\n  }\n\n  if (!fetchPromises.has(url)) {\n    const promise = fetchFromCacheOrRemote(url, mediaFormat, isHtmlAllowed)\n      .catch((err) => {\n        if (DEBUG) {\n          // eslint-disable-next-line no-console\n          console.warn(err);\n        }\n\n        return undefined;\n      })\n      .finally(() => {\n        fetchPromises.delete(url);\n        progressCallbacks.delete(url);\n        cancellableCallbacks.delete(url);\n      });\n\n    fetchPromises.set(url, promise);\n  }\n\n  if (onProgress && callbackUniqueId) {\n    let activeCallbacks = progressCallbacks.get(url);\n    if (!activeCallbacks) {\n      activeCallbacks = new Map<string, ApiOnProgress>();\n      progressCallbacks.set(url, activeCallbacks);\n    }\n    activeCallbacks.set(callbackUniqueId, onProgress);\n  }\n\n  return fetchPromises.get(url) as Promise<ApiPreparedMedia>;\n}\n\nexport function getFromMemory(url: string) {\n  return memoryCache.get(url) as ApiPreparedMedia;\n}\n\nexport function cancelProgress(progressCallback: ApiOnProgress) {\n  progressCallbacks.forEach((map, url) => {\n    map.forEach((callback) => {\n      if (callback === progressCallback) {\n        const parentCallback = cancellableCallbacks.get(url);\n        if (!parentCallback) return;\n\n        cancelApiProgress(parentCallback);\n        cancellableCallbacks.delete(url);\n        progressCallbacks.delete(url);\n      }\n    });\n  });\n}\n\nexport function removeCallback(url: string, callbackUniqueId: string) {\n  const callbacks = progressCallbacks.get(url);\n  if (!callbacks) return;\n  callbacks.delete(callbackUniqueId);\n}\n\nexport function getProgressiveUrl(url: string) {\n  return `${PROGRESSIVE_URL_PREFIX}${url}`;\n}\n\nfunction getProgressive(url: string) {\n  const progressiveUrl = `${PROGRESSIVE_URL_PREFIX}${url}`;\n\n  memoryCache.set(url, progressiveUrl);\n\n  return Promise.resolve(progressiveUrl);\n}\n\nfunction getDownloadUrl(url: string) {\n  return Promise.resolve(`${URL_DOWNLOAD_PREFIX}${url}`);\n}\n\nasync function fetchFromCacheOrRemote(\n  url: string, mediaFormat: ApiMediaFormat, isHtmlAllowed: boolean, retryNumber = 0,\n): Promise<string> {\n  if (!MEDIA_CACHE_DISABLED) {\n    const cacheName = url.startsWith('avatar') ? MEDIA_CACHE_NAME_AVATARS : MEDIA_CACHE_NAME;\n    const cached = await cacheApi.fetch(cacheName, url, asCacheApiType[mediaFormat]!, isHtmlAllowed);\n\n    if (cached) {\n      let media = cached;\n\n      if (cached.type === 'audio/ogg' && !IS_OPUS_SUPPORTED) {\n        media = await oggToWav(media);\n      }\n\n      const prepared = prepareMedia(media);\n\n      memoryCache.set(url, prepared);\n\n      return prepared;\n    }\n  }\n\n  const onProgress = makeOnProgress(url);\n  cancellableCallbacks.set(url, onProgress);\n\n  const remote = await callApi('downloadMedia', { url, mediaFormat, isHtmlAllowed }, onProgress);\n  if (!remote) {\n    if (retryNumber >= MAX_MEDIA_RETRIES) {\n      throw new Error(`Failed to fetch media ${url}`);\n    }\n    await new Promise((resolve) => {\n      setTimeout(resolve, getRetryTimeout(retryNumber));\n    });\n    // eslint-disable-next-line no-console\n    if (DEBUG) console.debug(`Retrying to fetch media ${url}`);\n    return fetchFromCacheOrRemote(url, mediaFormat, isHtmlAllowed, retryNumber + 1);\n  }\n\n  let { mimeType } = remote;\n  let prepared = prepareMedia(remote.dataBlob);\n\n  if (mimeType === 'audio/ogg' && !IS_OPUS_SUPPORTED) {\n    const blob = await fetchBlob(prepared as string);\n    URL.revokeObjectURL(prepared as string);\n    const media = await oggToWav(blob);\n    prepared = prepareMedia(media);\n    mimeType = media.type;\n  }\n\n  memoryCache.set(url, prepared);\n\n  return prepared;\n}\n\nfunction makeOnProgress(url: string) {\n  const onProgress: ApiOnProgress = (progress: number) => {\n    progressCallbacks.get(url)?.forEach((callback) => {\n      callback(progress);\n      if (callback.isCanceled) onProgress.isCanceled = true;\n    });\n  };\n\n  return onProgress;\n}\n\nfunction prepareMedia(mediaData: Exclude<ApiParsedMedia, ArrayBuffer>): ApiPreparedMedia {\n  if (mediaData instanceof Blob) {\n    return URL.createObjectURL(mediaData);\n  }\n\n  return mediaData;\n}\n\nif (IS_PROGRESSIVE_SUPPORTED) {\n  navigator.serviceWorker.addEventListener('message', async (e) => {\n    const { type, messageId, params } = e.data as {\n      type: string;\n      messageId: string;\n      params: { url: string; start: number; end: number };\n    };\n\n    if (type !== 'requestPart') {\n      return;\n    }\n\n    const result = await callApi('downloadMedia', { mediaFormat: ApiMediaFormat.Progressive, ...params });\n    if (!result) {\n      return;\n    }\n\n    const { arrayBuffer, mimeType, fullSize } = result;\n\n    navigator.serviceWorker.controller!.postMessage({\n      type: 'partResponse',\n      messageId,\n      result: {\n        arrayBuffer,\n        mimeType,\n        fullSize,\n      },\n    }, [arrayBuffer!]);\n  });\n}\n\nfunction getRetryTimeout(retryNumber: number) {\n  // 250ms, 500ms, 1s, 2s, 4s\n  return 250 * 2 ** retryNumber;\n}\n","export const MEMO_EMPTY_ARRAY = [];\n","import { DEBUG } from '../config';\nimport { createCallbackManager } from './callbacks';\n\nexport enum Bundles {\n  Auth,\n  Main,\n  Extra,\n  Calls,\n  Stars,\n}\n\ninterface ImportedBundles {\n  [Bundles.Auth]: typeof import('../bundles/auth');\n  [Bundles.Main]: typeof import('../bundles/main');\n  [Bundles.Extra]: typeof import('../bundles/extra');\n  [Bundles.Calls]: typeof import('../bundles/calls');\n  [Bundles.Stars]: typeof import('../bundles/stars');\n}\n\ntype BundlePromises = {\n  [K in keyof ImportedBundles]: Promise<ImportedBundles[K]>\n};\n\nexport type BundleModules<B extends keyof ImportedBundles> = keyof ImportedBundles[B];\n\nconst LOAD_PROMISES: Partial<BundlePromises> = {};\nconst MEMORY_CACHE: Partial<ImportedBundles> = {};\n\nconst { addCallback, runCallbacks } = createCallbackManager();\n\nexport async function loadBundle<B extends Bundles>(bundleName: B) {\n  if (!LOAD_PROMISES[bundleName]) {\n    switch (bundleName) {\n      case Bundles.Auth:\n        LOAD_PROMISES[Bundles.Auth] = import(/* webpackChunkName: \"BundleAuth\" */ '../bundles/auth');\n        break;\n      case Bundles.Main:\n        if (DEBUG) {\n          // eslint-disable-next-line no-console\n          console.log('>>> START LOAD MAIN BUNDLE');\n        }\n\n        LOAD_PROMISES[Bundles.Main] = import(/* webpackChunkName: \"BundleMain\" */ '../bundles/main');\n        break;\n      case Bundles.Extra:\n        LOAD_PROMISES[Bundles.Extra] = import(/* webpackChunkName: \"BundleExtra\" */ '../bundles/extra');\n        break;\n      case Bundles.Calls:\n        LOAD_PROMISES[Bundles.Calls] = import(/* webpackChunkName: \"BundleCalls\" */ '../bundles/calls');\n        break;\n      case Bundles.Stars:\n        LOAD_PROMISES[Bundles.Stars] = import(/* webpackChunkName: \"BundleStars\" */ '../bundles/stars');\n        break;\n    }\n\n    (LOAD_PROMISES[bundleName] as Promise<ImportedBundles[B]>).then(runCallbacks);\n  }\n\n  const bundle = (await LOAD_PROMISES[bundleName]) as unknown as ImportedBundles[B];\n\n  if (!MEMORY_CACHE[bundleName]) {\n    MEMORY_CACHE[bundleName] = bundle;\n  }\n\n  return bundle;\n}\n\nexport async function loadModule<B extends Bundles>(bundleName: B) {\n  await loadBundle(bundleName);\n}\n\nexport function getModuleFromMemory<B extends Bundles, M extends BundleModules<B>>(\n  bundleName: B, moduleName: M,\n): ImportedBundles[B][M] | undefined {\n  const bundle = MEMORY_CACHE[bundleName] as ImportedBundles[B];\n\n  if (!bundle) {\n    return undefined;\n  }\n\n  return bundle[moduleName];\n}\n\nexport const addLoadListener = addCallback;\n","import { isLiteralObject, unique } from './iteratees';\n\nconst EQUAL = Symbol('EQUAL');\nconst DELETE = { __delete: true };\nconst DELETE_ALL_CHILDREN = { __deleteAllChildren: true };\n\nexport function deepDiff<T extends any>(value1: T, value2: T): Partial<T> | typeof EQUAL | typeof DELETE_ALL_CHILDREN {\n  if (value1 === value2) {\n    return EQUAL;\n  }\n\n  const type1 = typeof value1;\n  const type2 = typeof value2;\n\n  if (type1 !== type2) {\n    return value2;\n  }\n\n  if (Array.isArray(value1) && Array.isArray(value2) && areSortedArraysDeepEqual(value1, value2)) {\n    return EQUAL;\n  }\n\n  if (!isLiteralObject(value1) || !isLiteralObject(value2)) {\n    return value2;\n  }\n\n  const object1 = value1 as AnyLiteral;\n  const object2 = value2 as AnyLiteral;\n  const keys1 = Object.keys(object1);\n  const keys2 = Object.keys(object2);\n\n  if (!keys2.length) {\n    return !keys1.length ? EQUAL : DELETE_ALL_CHILDREN;\n  }\n\n  const allKeys = unique(keys1.concat(keys2));\n\n  const diff = allKeys.reduce((acc: any, key) => {\n    const subValue1 = object1[key];\n    const subValue2 = object2[key];\n\n    if (!object2.hasOwnProperty(key)) {\n      acc[key] = DELETE;\n      return acc;\n    }\n\n    if (!object1!.hasOwnProperty(key)) {\n      acc[key] = subValue2;\n      return acc;\n    }\n\n    const subDiff = deepDiff(subValue1, subValue2);\n    if (subDiff !== EQUAL) {\n      acc[key] = subDiff;\n    }\n\n    return acc;\n  }, {});\n\n  if (Object.keys(diff).length === 0) {\n    return EQUAL;\n  }\n\n  return diff;\n}\n\nfunction areSortedArraysDeepEqual<T extends Array<any>>(array1: T, array2: T) {\n  if (array1.length !== array2.length) {\n    return false;\n  }\n\n  return array1.every((item, i) => deepDiff(item, array2[i]) === EQUAL);\n}\n","import { isLiteralObject, unique } from './iteratees';\n\nexport function deepMerge<T extends any>(value1: T, value2: T): T {\n  if (value1 === value2) {\n    return value2;\n  }\n\n  if (!isLiteralObject(value2)) {\n    return value2;\n  }\n\n  if (!isLiteralObject(value1)) {\n    return reduceDiff(value2) as T;\n  }\n\n  // eslint-disable-next-line no-underscore-dangle\n  if (value2.__deleteAllChildren) {\n    return {} as T;\n  }\n\n  const allKeys = unique(Object.keys(value1).concat(Object.keys(value2)));\n\n  return allKeys.reduce((acc: AnyLiteral, key) => {\n    const oldValue = value1[key];\n\n    if (!value2.hasOwnProperty(key)) {\n      acc[key] = oldValue;\n    } else {\n      const newValue = value2[key];\n      // eslint-disable-next-line no-underscore-dangle\n      if (!newValue?.__delete) {\n        acc[key] = deepMerge(oldValue, newValue);\n      }\n    }\n\n    return acc;\n  }, {}) as T;\n}\n\nfunction reduceDiff(diff: AnyLiteral) {\n  // eslint-disable-next-line no-underscore-dangle\n  if (diff.__deleteAllChildren) {\n    return {};\n  }\n\n  return Object.entries(diff).reduce((acc: AnyLiteral, [key, value]) => {\n    // eslint-disable-next-line no-underscore-dangle\n    if (!value?.__delete) {\n      // eslint-disable-next-line no-null/no-null\n      acc[key] = isLiteralObject(value) ? reduceDiff(value) : value;\n    }\n\n    return acc;\n  }, {});\n}\n","/* eslint-disable eslint-multitab-tt/set-global-only-variable */\nimport { onFullyIdle } from '../lib/teact/teact';\nimport { addCallback } from '../lib/teact/teactn';\nimport { getActions, getGlobal, setGlobal } from '../global';\n\nimport type { LocalDb } from '../api/gramjs/localDb';\nimport type { MethodArgs, Methods } from '../api/gramjs/methods/types';\nimport type { ApiInitialArgs } from '../api/types';\nimport type { GlobalState } from '../global/types';\n\nimport { DATA_BROADCAST_CHANNEL_NAME, MULTITAB_LOCALSTORAGE_KEY } from '../config';\nimport { selectTabState } from '../global/selectors';\nimport {\n  callApiLocal,\n  cancelApiProgressMaster,\n  handleMethodCallback,\n  handleMethodResponse,\n  initApi,\n  updateFullLocalDb,\n  updateLocalDb,\n} from '../api/gramjs';\nimport { deepDiff } from './deepDiff';\nimport { deepMerge } from './deepMerge';\nimport { getCurrentTabId, signalPasscodeHash, subscribeToTokenDied } from './establishMultitabRole';\nimport { omit } from './iteratees';\nimport { IS_MULTITAB_SUPPORTED } from './windowEnvironment';\n\ntype BroadcastChannelRefreshLangpack = {\n  type: 'langpackRefresh';\n  langCode: string;\n};\n\ntype BroadcastChannelRequestGlobal = {\n  type: 'requestGlobal';\n  token?: number;\n  appVersion: string;\n};\n\ntype BroadcastChannelGlobalUpdate = {\n  type: 'globalUpdate';\n  global: GlobalState;\n};\n\ntype BroadcastChannelCancelApiProgress = {\n  type: 'cancelApiProgress';\n  token: number;\n  messageId: string;\n};\n\ntype BroadcastChannelCallApi = {\n  type: 'callApi';\n  token: number;\n  messageId: string;\n  name: keyof Methods;\n  args: MethodArgs<keyof Methods>;\n  withCallback?: boolean;\n};\n\ntype BroadcastChannelMessageResponse = {\n  type: 'messageResponse';\n  token: number;\n  messageId: string;\n  response: any;\n};\n\ntype BroadcastChannelLocalDbUpdate = {\n  type: 'localDbUpdate';\n  batchedUpdates: {\n    name: keyof LocalDb;\n    prop: string;\n    value: any;\n  }[];\n};\n\ntype BroadcastChannelLocalDbUpdateFull = {\n  type: 'localDbUpdateFull';\n  localDb: any;\n};\n\ntype BroadcastChannelMessageCallback = {\n  type: 'messageCallback';\n  token: number;\n  messageId: string;\n  callbackArgs: any;\n};\n\ntype BroadcastChannelGlobalDiff = {\n  type: 'globalDiffUpdate';\n  diff: any;\n};\n\ntype BroadcastChannelInitApi = {\n  type: 'initApi';\n  token: number;\n  initialArgs: ApiInitialArgs;\n};\n\nconst MULTITAB_ESTABLISH_TIMEOUT = 800;\n\nexport type TypedBroadcastChannel = {\n  postMessage: (message: BroadcastChannelMessage) => void;\n  addEventListener: (type: 'message', listener: (event: { data: BroadcastChannelMessage }) => void) => void;\n  removeEventListener: (type: 'message', listener: (event: { data: BroadcastChannelMessage }) => void) => void;\n};\n\ntype BroadcastChannelMessage = (\n  BroadcastChannelRequestGlobal | BroadcastChannelGlobalUpdate | BroadcastChannelCallApi |\n  BroadcastChannelMessageResponse | BroadcastChannelRefreshLangpack |\n  BroadcastChannelMessageCallback | BroadcastChannelCancelApiProgress | BroadcastChannelLocalDbUpdate |\n  BroadcastChannelLocalDbUpdateFull | BroadcastChannelGlobalDiff | BroadcastChannelInitApi\n);\n\nlet resolveGlobalPromise: VoidFunction | undefined;\nlet isFirstGlobalResolved = false;\nlet currentGlobal: GlobalState | undefined;\nlet isDisabled = false;\n\nconst channel = IS_MULTITAB_SUPPORTED\n  ? new BroadcastChannel(DATA_BROADCAST_CHANNEL_NAME) as TypedBroadcastChannel\n  : undefined;\n\nlet isBroadcastDiffScheduled = false;\nlet lastBroadcastDiffGlobal: GlobalState | undefined;\n\nfunction broadcastDiffOnIdle() {\n  if (isBroadcastDiffScheduled) return;\n\n  isBroadcastDiffScheduled = true;\n  lastBroadcastDiffGlobal = currentGlobal;\n\n  onFullyIdle(() => {\n    if (!channel) return;\n\n    const diff = deepDiff(lastBroadcastDiffGlobal, currentGlobal);\n\n    if (typeof diff !== 'symbol') {\n      channel.postMessage({\n        type: 'globalDiffUpdate',\n        diff,\n      });\n    }\n\n    isBroadcastDiffScheduled = false;\n  });\n}\n\nexport function unsubcribeFromMultitabBroadcastChannel() {\n  if (channel) {\n    channel.removeEventListener('message', handleMessage);\n    isDisabled = true;\n  }\n}\n\nexport function subscribeToMultitabBroadcastChannel() {\n  if (!channel) return;\n\n  subscribeToTokenDied((token) => {\n    if (token === getCurrentTabId()) {\n      unsubcribeFromMultitabBroadcastChannel();\n      const global = getGlobal();\n      const newGlobal = {\n        ...global,\n        byTabId: omit(global.byTabId, [token]),\n      };\n\n      const diff = deepDiff(global, newGlobal);\n\n      if (typeof diff !== 'symbol') {\n        channel.postMessage({\n          type: 'globalDiffUpdate',\n          diff,\n        });\n      }\n      return;\n    }\n    let global = getGlobal();\n    global = {\n      ...global,\n      byTabId: omit(global.byTabId, [token]),\n    };\n\n    setGlobal(global);\n  });\n\n  addCallback((global: GlobalState) => {\n    if (!isFirstGlobalResolved || isDisabled) {\n      currentGlobal = global;\n      return;\n    }\n\n    if (currentGlobal === global) {\n      return;\n    }\n\n    if (!currentGlobal) {\n      currentGlobal = global;\n      channel.postMessage({\n        type: 'globalUpdate',\n        global,\n      });\n      return;\n    }\n\n    broadcastDiffOnIdle();\n\n    currentGlobal = global;\n  });\n\n  channel.addEventListener('message', handleMessage);\n}\n\nexport function handleMessage({ data }: { data: BroadcastChannelMessage }) {\n  if (!data || !channel) return;\n\n  switch (data.type) {\n    case 'initApi': {\n      const global = getGlobal();\n      if (!selectTabState(global).isMasterTab) return;\n\n      const { initialArgs } = data;\n      initApi(getActions().apiUpdate, initialArgs);\n      break;\n    }\n\n    case 'globalDiffUpdate': {\n      if (!isFirstGlobalResolved) return;\n      const { diff } = data;\n      const oldGlobal = getGlobal();\n      const global = deepMerge(oldGlobal, diff);\n\n      // @ts-ignore\n      global.DEBUG_randomId = oldGlobal.DEBUG_randomId;\n\n      currentGlobal = global;\n      setGlobal(global);\n      break;\n    }\n\n    case 'globalUpdate': {\n      if (isFirstGlobalResolved) return;\n      const oldGlobal = getGlobal();\n      // @ts-ignore\n      data.global.DEBUG_randomId = oldGlobal.DEBUG_randomId;\n      currentGlobal = data.global;\n      setGlobal(data.global);\n      if (resolveGlobalPromise) {\n        resolveGlobalPromise();\n        resolveGlobalPromise = undefined;\n        isFirstGlobalResolved = true;\n      }\n      break;\n    }\n\n    case 'requestGlobal': {\n      const { appVersion } = data;\n      if (appVersion !== APP_VERSION) {\n        // If app version on the other tab was updated, reload the current page immediately and don't respond\n        // to the other tab's request because our current global might be incompatible with the new version\n        window.location.reload();\n        return;\n      }\n\n      if (!isFirstGlobalResolved) return;\n      const global = getGlobal();\n\n      if (!selectTabState(global).isMasterTab) return;\n\n      channel.postMessage({\n        type: 'globalUpdate',\n        global,\n      });\n\n      signalPasscodeHash();\n      break;\n    }\n\n    case 'messageCallback': {\n      if (!isFirstGlobalResolved) return;\n      const global = getGlobal();\n      if (selectTabState(global).isMasterTab) return;\n\n      handleMethodCallback(data);\n      break;\n    }\n\n    case 'localDbUpdate': {\n      if (!isFirstGlobalResolved) return;\n      const global = getGlobal();\n      if (selectTabState(global).isMasterTab) return;\n\n      const {\n        batchedUpdates,\n      } = data;\n\n      batchedUpdates.forEach(({\n        name,\n        prop,\n        value,\n      }) => {\n        updateLocalDb(name, prop, value);\n      });\n      break;\n    }\n\n    case 'localDbUpdateFull': {\n      if (!isFirstGlobalResolved) return;\n      const global = getGlobal();\n      if (selectTabState(global).isMasterTab) return;\n\n      const { localDb } = data;\n\n      updateFullLocalDb(localDb);\n      break;\n    }\n\n    case 'messageResponse': {\n      if (!isFirstGlobalResolved) return;\n      const global = getGlobal();\n\n      if (selectTabState(global).isMasterTab) return;\n\n      handleMethodResponse(data);\n      break;\n    }\n\n    case 'cancelApiProgress': {\n      if (!isFirstGlobalResolved) return;\n      const global = getGlobal();\n      if (!selectTabState(global).isMasterTab) return;\n\n      const { messageId } = data;\n\n      cancelApiProgressMaster(messageId);\n      break;\n    }\n\n    case 'callApi': {\n      if (!isFirstGlobalResolved) return;\n      const global = getGlobal();\n      if (!selectTabState(global).isMasterTab) return;\n\n      const {\n        name, messageId, token, args, withCallback,\n      } = data;\n\n      const argsWithCallback = (withCallback ? [...args, (...callbackArgs: any[]) => {\n        channel.postMessage({\n          type: 'messageCallback',\n          token,\n          messageId,\n          callbackArgs,\n        });\n      }] : args) as MethodArgs<keyof Methods>;\n\n      (async () => {\n        const result = await (callApiLocal(name, ...argsWithCallback));\n\n        channel.postMessage({\n          type: 'messageResponse',\n          token,\n          messageId,\n          response: result,\n        });\n      })();\n\n      break;\n    }\n\n    case 'langpackRefresh': {\n      getActions().refreshLangPackFromCache({ langCode: data.langCode });\n      break;\n    }\n  }\n}\n\nexport function requestGlobal(appVersion: string): Promise<void> {\n  if (channel) {\n    channel.postMessage({\n      type: 'requestGlobal',\n      appVersion,\n    });\n  }\n\n  const resolveWithoutGlobal = () => {\n    if (resolveGlobalPromise) {\n      resolveGlobalPromise();\n      resolveGlobalPromise = undefined;\n    }\n    isFirstGlobalResolved = true;\n  };\n\n  if (localStorage.getItem(MULTITAB_LOCALSTORAGE_KEY)) {\n    setTimeout(resolveWithoutGlobal, MULTITAB_ESTABLISH_TIMEOUT);\n  } else {\n    resolveWithoutGlobal();\n    return Promise.resolve();\n  }\n\n  return new Promise((resolve) => {\n    resolveGlobalPromise = resolve;\n  });\n}\n\nexport function notifyLangpackUpdate(langCode: string) {\n  if (!channel) return;\n\n  channel.postMessage({\n    type: 'langpackRefresh',\n    langCode,\n  });\n}\n","import React from '../lib/teact/teact';\nimport { getActions, getGlobal, setGlobal } from '../global';\n\nimport type {\n  ApiChat, ApiMessage, ApiPeer, ApiPeerReaction,\n  ApiPhoneCall, ApiUser,\n} from '../api/types';\nimport { ApiMediaFormat } from '../api/types';\n\nimport { APP_NAME, DEBUG, IS_TEST } from '../config';\nimport {\n  getChatAvatarHash,\n  getChatTitle,\n  getMessageRecentReaction,\n  getMessageSenderName,\n  getPrivateChatUserId,\n  getUserFullName,\n  isChatChannel,\n} from '../global/helpers';\nimport { getIsChatMuted, getIsChatSilent, getShouldShowMessagePreview } from '../global/helpers/notifications';\nimport {\n  selectChat,\n  selectCurrentMessageList,\n  selectIsChatWithSelf,\n  selectNotifyDefaults,\n  selectNotifyException,\n  selectSettingsKeys,\n  selectTopicFromMessage,\n  selectUser,\n} from '../global/selectors';\nimport { callApi } from '../api/gramjs';\nimport jsxToHtml from './element/jsxToHtml';\nimport { buildCollectionByKey } from './iteratees';\nimport * as mediaLoader from './mediaLoader';\nimport { oldTranslate } from './oldLangProvider';\nimport { debounce } from './schedulers';\nimport { getServerTime } from './serverTime';\nimport { IS_ELECTRON, IS_SERVICE_WORKER_SUPPORTED, IS_TOUCH_ENV } from './windowEnvironment';\n\nimport MessageSummary from '../components/common/MessageSummary';\n\nfunction getDeviceToken(subscription: PushSubscription) {\n  const data = subscription.toJSON();\n  return JSON.stringify({\n    endpoint: data.endpoint,\n    keys: data.keys,\n  });\n}\n\nfunction checkIfPushSupported() {\n  if (!IS_SERVICE_WORKER_SUPPORTED || IS_ELECTRON) return false;\n\n  if (!('showNotification' in ServiceWorkerRegistration.prototype)) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('[PUSH] Push notifications aren\\'t supported.');\n    }\n    return false;\n  }\n\n  // If permission is denied, it is blocked until the user manually changes their settings\n  if (Notification.permission === 'denied') {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('[PUSH] The user has blocked push notifications.');\n    }\n    return false;\n  }\n\n  // Check if push messaging is supported\n  if (!('PushManager' in window)) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('[PUSH] Push messaging isn\\'t supported.');\n    }\n    return false;\n  }\n\n  return true;\n}\n\nexport function checkIfNotificationsSupported() {\n  // Let's check if the browser supports notifications\n  if (!('Notification' in window)) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('[PUSH] This browser does not support desktop notification');\n    }\n    return false;\n  }\n\n  if (Notification.permission === 'denied' as NotificationPermission) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('[PUSH] The user has blocked push notifications.');\n    }\n    return false;\n  }\n  return true;\n}\n\nconst expirationTime = 12 * 60 * 60 * 1000; // 12 hours\n// Notification id is removed from soundPlayed cache after 3 seconds\nconst soundPlayedDelay = 3 * 1000;\nconst soundPlayedIds = new Set<string>();\nconst notificationSound = new Audio('./notification.mp3');\nnotificationSound.setAttribute('mozaudiochannel', 'notification');\n\nexport async function playNotifySound(id?: string, volume?: number) {\n  if (id !== undefined && soundPlayedIds.has(id)) return;\n  const { notificationSoundVolume } = selectSettingsKeys(getGlobal());\n  const currentVolume = volume ? volume / 10 : notificationSoundVolume / 10;\n  if (currentVolume === 0) return;\n  notificationSound.volume = currentVolume;\n  if (id !== undefined) {\n    notificationSound.addEventListener('ended', () => {\n      soundPlayedIds.add(id);\n    }, { once: true });\n\n    setTimeout(() => {\n      soundPlayedIds.delete(id);\n    }, soundPlayedDelay);\n  }\n\n  try {\n    await notificationSound.play();\n  } catch (error) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('[PUSH] Unable to play notification sound');\n    }\n  }\n}\n\nexport const playNotifySoundDebounced = debounce(playNotifySound, 1000, true, false);\n\nfunction checkIfShouldResubscribe(subscription: PushSubscription | null) {\n  const global = getGlobal();\n  if (!global.push || !subscription) return true;\n  if (getDeviceToken(subscription) !== global.push.deviceToken) return true;\n  return Date.now() - global.push.subscribedAt > expirationTime;\n}\n\nexport async function requestPermission() {\n  if (!('Notification' in window)) {\n    return false;\n  }\n  let permission = Notification.permission;\n  if (!['granted', 'denied'].includes(permission)) {\n    permission = await Notification.requestPermission();\n  }\n  return permission === 'granted';\n}\n\nasync function unsubscribeFromPush(subscription: PushSubscription | null) {\n  const global = getGlobal();\n  const { deleteDeviceToken } = getActions();\n  if (subscription) {\n    try {\n      const deviceToken = getDeviceToken(subscription);\n      await callApi('unregisterDevice', deviceToken);\n      await subscription.unsubscribe();\n      deleteDeviceToken();\n      return;\n    } catch (error) {\n      if (DEBUG) {\n        // eslint-disable-next-line no-console\n        console.log('[PUSH] Unable to unsubscribe from push.', error);\n      }\n    }\n  }\n  if (global.push) {\n    await callApi('unregisterDevice', global.push.deviceToken);\n    deleteDeviceToken();\n  }\n}\n\nexport async function unsubscribe() {\n  if (!checkIfPushSupported()) return;\n  const serviceWorkerRegistration = await navigator.serviceWorker.ready;\n  const subscription = await serviceWorkerRegistration.pushManager.getSubscription();\n  await unsubscribeFromPush(subscription);\n}\n\n// Load custom emoji from the api if it's not cached already\nasync function loadCustomEmoji(id: string) {\n  let global = getGlobal();\n  if (global.customEmojis.byId[id]) return;\n  const customEmoji = await callApi('fetchCustomEmoji', {\n    documentId: [id],\n  });\n  if (!customEmoji) return;\n  global = getGlobal();\n  global = {\n    ...global,\n    customEmojis: {\n      ...global.customEmojis,\n      byId: {\n        ...global.customEmojis.byId,\n        ...buildCollectionByKey(customEmoji, 'id'),\n      },\n    },\n  };\n  setGlobal(global);\n}\n\nlet isSubscriptionFailed = false;\nexport function checkIfOfflinePushFailed() {\n  return isSubscriptionFailed;\n}\n\nexport async function subscribe() {\n  const { setDeviceToken, updateWebNotificationSettings } = getActions();\n  let hasWebNotifications = false;\n  let hasPushNotifications = false;\n  if (!checkIfPushSupported()) {\n    // Ask for notification permissions only if service worker notifications are not supported\n    // As pushManager.subscribe automatically triggers permission popup\n    hasWebNotifications = await requestPermission();\n    updateWebNotificationSettings({\n      hasWebNotifications,\n      hasPushNotifications,\n    });\n    return;\n  }\n  const serviceWorkerRegistration = await navigator.serviceWorker.ready;\n  let subscription = await serviceWorkerRegistration.pushManager.getSubscription();\n  if (!checkIfShouldResubscribe(subscription)) return;\n  await unsubscribeFromPush(subscription);\n  try {\n    subscription = await serviceWorkerRegistration.pushManager.subscribe({\n      userVisibleOnly: true,\n    });\n    const deviceToken = getDeviceToken(subscription);\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.log('[PUSH] Received push subscription: ', deviceToken);\n    }\n    await callApi('registerDevice', deviceToken);\n    setDeviceToken(deviceToken);\n    hasPushNotifications = true;\n    hasWebNotifications = true;\n  } catch (error: any) {\n    if (Notification.permission === 'denied') {\n      // The user denied the notification permission which\n      // means we failed to subscribe and the user will need\n      // to manually change the notification permission to\n      // subscribe to push messages\n      if (DEBUG) {\n        // eslint-disable-next-line no-console\n        console.warn('[PUSH] The user has blocked push notifications.');\n      }\n    } else {\n      // A problem occurred with the subscription, this can\n      // often be down to an issue or lack of the gcm_sender_id\n      // and / or gcm_user_visible_only\n      if (DEBUG) {\n        // eslint-disable-next-line no-console\n        console.log('[PUSH] Unable to subscribe to push.', error);\n      }\n      // Request permissions and fall back to local notifications\n      // if pushManager.subscribe was aborted due to invalid VAPID key.\n      if ([DOMException.ABORT_ERR, DOMException.NOT_SUPPORTED_ERR].includes(error.code)) {\n        isSubscriptionFailed = true;\n        hasWebNotifications = await requestPermission();\n      }\n    }\n  }\n  updateWebNotificationSettings({\n    hasWebNotifications,\n    hasPushNotifications,\n  });\n}\n\nfunction checkIfShouldNotify(chat: ApiChat, message: Partial<ApiMessage>) {\n  const global = getGlobal();\n  const isChatMuted = getIsChatMuted(chat, selectNotifyDefaults(global), selectNotifyException(global, chat.id));\n  const topic = selectTopicFromMessage(global, message as ApiMessage);\n  const topicMutedUntil = topic?.notifySettings.mutedUntil;\n  const isMuted = topicMutedUntil === undefined ? isChatMuted : topicMutedUntil > getServerTime();\n  const shouldIgnoreMute = message.isMentioned;\n\n  const shouldNotifyAboutMessage = message.content?.action?.type !== 'phoneCall';\n  if ((isMuted && !shouldIgnoreMute) || !shouldNotifyAboutMessage\n     || chat.isNotJoined || !chat.isListed || selectIsChatWithSelf(global, chat.id)) {\n    return false;\n  }\n  // On touch devices show notifications when chat is not active\n  if (IS_TOUCH_ENV) {\n    const {\n      chatId,\n      type,\n    } = selectCurrentMessageList(global) || {};\n    return !(chatId === chat.id && type === 'thread');\n  }\n  // On desktop show notifications when window is not focused\n  return !document.hasFocus();\n}\n\nfunction getNotificationContent(chat: ApiChat, message: ApiMessage, reaction?: ApiPeerReaction) {\n  const global = getGlobal();\n  let {\n    senderId,\n  } = message;\n  const hasReaction = Boolean(reaction);\n  if (hasReaction) senderId = reaction.peerId;\n\n  const { isScreenLocked } = global.passcode;\n  const messageSenderChat = senderId ? selectChat(global, senderId) : undefined;\n  const messageSenderUser = senderId ? selectUser(global, senderId) : undefined;\n  const privateChatUserId = getPrivateChatUserId(chat);\n  const isSelf = privateChatUserId === global.currentUserId;\n\n  let body: string;\n  if (\n    !isScreenLocked\n    && getShouldShowMessagePreview(chat, selectNotifyDefaults(global), selectNotifyException(global, chat.id))\n  ) {\n    const isChat = chat && (isChatChannel(chat) || message.senderId === message.chatId);\n\n    // TODO[forums] Support ApiChat\n    const senderName = getMessageSenderName(oldTranslate, chat.id, isChat ? messageSenderChat : messageSenderUser);\n    let summary = jsxToHtml(<span><MessageSummary message={message} /></span>)[0].textContent || '';\n\n    if (hasReaction) {\n      const emoji = getReactionEmoji(reaction);\n      summary = oldTranslate('PushReactText', [emoji, summary]);\n    }\n\n    body = senderName ? `${senderName}: ${summary}` : summary;\n  } else {\n    body = 'New message';\n  }\n\n  let title = isScreenLocked ? APP_NAME : getChatTitle(oldTranslate, chat, isSelf);\n\n  if (message.isSilent) {\n    title += ' 🔕';\n  }\n\n  return { title, body };\n}\n\nasync function getAvatar(chat: ApiPeer) {\n  const imageHash = getChatAvatarHash(chat);\n  if (!imageHash) return undefined;\n  let mediaData = mediaLoader.getFromMemory(imageHash);\n  if (!mediaData) {\n    await mediaLoader.fetch(imageHash, ApiMediaFormat.BlobUrl);\n    mediaData = mediaLoader.getFromMemory(imageHash);\n  }\n  return mediaData;\n}\n\nfunction getReactionEmoji(reaction: ApiPeerReaction) {\n  let emoji;\n  if (reaction.reaction.type === 'emoji') {\n    emoji = reaction.reaction.emoticon;\n  }\n\n  if (reaction.reaction.type === 'custom') {\n    // eslint-disable-next-line eslint-multitab-tt/no-immediate-global\n    emoji = getGlobal().customEmojis.byId[reaction.reaction.documentId]?.emoji;\n  }\n  return emoji || '❤️';\n}\n\nexport async function notifyAboutCall({\n  call, user,\n}: {\n  call: ApiPhoneCall; user: ApiUser;\n}) {\n  const { hasWebNotifications } = selectSettingsKeys(getGlobal());\n  if (document.hasFocus() || !hasWebNotifications) return;\n  const areNotificationsSupported = checkIfNotificationsSupported();\n  if (!areNotificationsSupported) return;\n\n  const icon = await getAvatar(user);\n\n  const options: NotificationOptions = {\n    body: getUserFullName(user),\n    icon,\n    badge: icon,\n    tag: `call_${call.id}`,\n  };\n\n  if ('vibrate' in navigator) {\n    // @ts-ignore\n    options.vibrate = [200, 100, 200];\n  }\n\n  const notification = new Notification(oldTranslate('VoipIncoming'), options);\n\n  notification.onclick = () => {\n    notification.close();\n    if (window.focus) {\n      window.focus();\n    }\n  };\n}\n\nexport async function notifyAboutMessage({\n  chat,\n  message,\n  isReaction = false,\n}: { chat: ApiChat; message: Partial<ApiMessage>; isReaction?: boolean }) {\n  const global = getGlobal();\n  const { hasWebNotifications } = selectSettingsKeys(global);\n  if (!checkIfShouldNotify(chat, message)) return;\n  const isChatSilent = getIsChatSilent(\n    chat, selectNotifyDefaults(getGlobal()), selectNotifyException(getGlobal(), chat.id),\n  );\n  const topic = selectTopicFromMessage(global, message as ApiMessage);\n  const isSilent = topic?.notifySettings.hasSound === undefined ? isChatSilent : !topic.notifySettings.hasSound;\n\n  const areNotificationsSupported = checkIfNotificationsSupported();\n  if (!hasWebNotifications || !areNotificationsSupported) {\n    if (!isSilent && !message.isSilent && !isReaction && !IS_ELECTRON) {\n      // Only play sound if web notifications are disabled\n      playNotifySoundDebounced(String(message.id) || chat.id);\n    }\n\n    return;\n  }\n  if (!areNotificationsSupported) return;\n\n  if (!message.id) return;\n\n  const activeReaction = getMessageRecentReaction(message);\n  // Do not notify about reactions on messages that are not outgoing\n  if (isReaction && !activeReaction) return;\n\n  // If this is a custom emoji reaction we need to make sure it is loaded\n  if (isReaction && activeReaction && activeReaction.reaction.type === 'custom') {\n    await loadCustomEmoji(activeReaction.reaction.documentId);\n  }\n\n  const icon = await getAvatar(chat);\n\n  const {\n    title,\n    body,\n  } = getNotificationContent(chat, message as ApiMessage, activeReaction);\n\n  if (checkIfPushSupported()) {\n    if (navigator.serviceWorker?.controller) {\n      // notify service worker about new message notification\n      navigator.serviceWorker.controller.postMessage({\n        type: 'showMessageNotification',\n        payload: {\n          title,\n          body,\n          icon,\n          chatId: chat.id,\n          messageId: message.id,\n          shouldReplaceHistory: true,\n          isSilent: isSilent || message.isSilent,\n          reaction: activeReaction?.reaction,\n        },\n      });\n    }\n  } else {\n    const dispatch = getActions();\n    const options: NotificationOptions = {\n      body,\n      icon,\n      badge: icon,\n      tag: String(message.id),\n    };\n\n    if ('vibrate' in navigator) {\n      // @ts-ignore\n      options.vibrate = [200, 100, 200];\n    }\n\n    const notification = new Notification(title, options);\n\n    notification.onclick = () => {\n      notification.close();\n      dispatch.focusMessage({\n        chatId: chat.id,\n        messageId: message.id!,\n        shouldReplaceHistory: true,\n      });\n      if (window.focus) {\n        window.focus();\n      }\n    };\n\n    // Play sound when notification is displayed\n    notification.onshow = () => {\n      // TODO Update when reaction badges are implemented\n      if (isReaction || message.isSilent || IS_ELECTRON) return;\n      playNotifySoundDebounced(String(message.id) || chat.id);\n    };\n  }\n}\n\nexport function closeMessageNotifications(payload: { chatId: string; lastReadInboxMessageId?: number }) {\n  if (IS_TEST || !navigator.serviceWorker?.controller) return;\n  navigator.serviceWorker.controller.postMessage({\n    type: 'closeMessageNotifications',\n    payload,\n  });\n}\n\n// Notify service worker that client is fully loaded\nexport function notifyClientReady() {\n  if (!navigator.serviceWorker?.controller) return;\n  navigator.serviceWorker.controller.postMessage({\n    type: 'clientReady',\n  });\n}\n","import { getGlobal } from '../global';\n\nimport type { ApiOldLangPack, ApiOldLangString } from '../api/types';\nimport type { LangCode, TimeFormat } from '../types';\n\nimport {\n  LANG_CACHE_NAME, LANG_PACKS,\n} from '../config';\nimport { callApi } from '../api/gramjs';\nimport * as cacheApi from './cacheApi';\nimport { createCallbackManager } from './callbacks';\nimport { loadAndChangeLanguage } from './localization';\nimport { formatInteger } from './textFormat';\n\nexport interface LangFn {\n  (key: string, value?: any, format?: 'i', pluralValue?: number): string;\n\n  isRtl?: boolean;\n  code?: LangCode;\n  langName?: string;\n  timeFormat?: TimeFormat;\n}\n\nconst SUBSTITUTION_REGEX = /%\\d?\\$?[sdf@]/g;\nconst PLURAL_OPTIONS = ['value', 'zeroValue', 'oneValue', 'twoValue', 'fewValue', 'manyValue', 'otherValue'] as const;\n// Some rules edited from https://github.com/eemeli/make-plural/blob/master/packages/plurals/cardinals.js\nconst PLURAL_RULES = {\n  /* eslint-disable max-len */\n  en: (n: number) => (n !== 1 ? 6 : 2),\n  ar: (n: number) => (n === 0 ? 1 : n === 1 ? 2 : n === 2 ? 3 : n % 100 >= 3 && n % 100 <= 10 ? 4 : n % 100 >= 11 ? 5 : 6),\n  be: (n: number) => {\n    const s = String(n).split('.');\n    const t0 = Number(s[0]) === n;\n    const n10 = t0 ? Number(s[0].slice(-1)) : 0;\n    const n100 = t0 ? Number(s[0].slice(-2)) : 0;\n    return n10 === 1 && n100 !== 11 ? 2\n      : (n10 >= 2 && n10 <= 4) && (n100 < 12 || n100 > 14) ? 4\n        : (t0 && n10 === 0) || (n10 >= 5 && n10 <= 9) || (n100 >= 11 && n100 <= 14) ? 5\n          : 6;\n  },\n  ca: (n: number) => (n !== 1 ? 6 : 2),\n  cs: (n: number) => {\n    const s = String(n).split('.');\n    const i = Number(s[0]);\n    const v0 = !s[1];\n    return n === 1 && v0 ? 2 : (i >= 2 && i <= 4) && v0 ? 4 : !v0 ? 5 : 6;\n  },\n  de: (n: number) => (n !== 1 ? 6 : 2),\n  es: (n: number) => (n !== 1 ? 6 : 2),\n  fa: (n: number) => (n > 1 ? 6 : 2),\n  fi: (n: number) => (n !== 1 ? 6 : 2),\n  fr: (n: number) => (n > 1 ? 6 : 2),\n  id: () => 0,\n  it: (n: number) => (n !== 1 ? 6 : 2),\n  hr: (n: number) => {\n    const s = String(n).split('.');\n    const i = s[0];\n    const f = s[1] || '';\n    const v0 = !s[1];\n    const i10 = Number(i.slice(-1));\n    const i100 = Number(i.slice(-2));\n    const f10 = Number(f.slice(-1));\n    const f100 = Number(f.slice(-2));\n    return (v0 && i10 === 1 && i100 !== 11) || (f10 === 1 && f100 !== 11) ? 2\n      : (v0 && (i10 >= 2 && i10 <= 4) && (i100 < 12 || i100 > 14)) || ((f10 >= 2 && f10 <= 4) && (f100 < 12 || f100 > 14)) ? 4\n        : 6;\n  },\n  hu: (n: number) => (n > 1 ? 6 : 2),\n  ko: () => 0,\n  ms: () => 0,\n  nb: (n: number) => (n > 1 ? 6 : 2),\n  nl: (n: number) => (n !== 1 ? 6 : 2),\n  pl: (n: number) => (n === 1 ? 2 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 4 : 5),\n  'pt-br': (n: number) => (n > 1 ? 6 : 2),\n  ru: (n: number) => (n % 10 === 1 && n % 100 !== 11 ? 2 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 4 : 5),\n  sk: (n: number) => {\n    const s = String(n).split('.');\n    const i = Number(s[0]);\n    const v0 = !s[1];\n    return n === 1 && v0 ? 2 : (i >= 2 && i <= 4) && v0 ? 4 : !v0 ? 5 : 6;\n  },\n  sr: (n: number) => {\n    const s = String(n).split('.');\n    const i = s[0];\n    const f = s[1] || '';\n    const v0 = !s[1];\n    const i10 = Number(i.slice(-1));\n    const i100 = Number(i.slice(-2));\n    const f10 = Number(f.slice(-1));\n    const f100 = Number(f.slice(-2));\n    return (v0 && i10 === 1 && i100 !== 11) || (f10 === 1 && f100 !== 11) ? 2\n      : (v0 && (i10 >= 2 && i10 <= 4) && (i100 < 12 || i100 > 14)) || ((f10 >= 2 && f10 <= 4) && (f100 < 12 || f100 > 14)) ? 4\n        : 6;\n  },\n  tr: (n: number) => (n > 1 ? 6 : 2),\n  uk: (n: number) => (n % 10 === 1 && n % 100 !== 11 ? 2 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 4 : 5),\n  uz: (n: number) => (n > 1 ? 6 : 2),\n  /* eslint-enable max-len */\n};\n\nconst cache = new Map<string, string>();\n\nlet langPack: ApiOldLangPack | undefined;\nlet fallbackLangPack: ApiOldLangPack | undefined;\n\nconst {\n  addCallback,\n  removeCallback,\n  runCallbacks,\n} = createCallbackManager();\n\nexport { addCallback, removeCallback };\n\nlet currentLangCode: string | undefined;\nlet currentTimeFormat: TimeFormat | undefined;\n\nfunction createLangFn() {\n  return (key: string, value?: any, format?: 'i', pluralValue?: number) => {\n    if (value !== undefined) {\n      const cacheValue = Array.isArray(value) ? JSON.stringify(value) : value;\n      const cached = cache.get(`${key}_${cacheValue}_${format}${pluralValue ? `_${pluralValue}` : ''}`);\n      if (cached) {\n        return cached;\n      }\n    }\n\n    if (!fallbackLangPack) {\n      void importFallbackLangPack();\n    }\n\n    const langString = langPack?.[key] || fallbackLangPack?.[key];\n    if (!langString) {\n      return key;\n    }\n\n    return processTranslation(langString, key, value, format, pluralValue);\n  };\n}\n\nlet translationFn: LangFn = createLangFn();\n\n/**\n * @deprecated Do not translate inside non-reactive contexts. Pass parameters to the component instead\n */\nexport function oldTranslate(...args: Parameters<LangFn>) {\n  return translationFn(...args);\n}\n\nexport function getTranslationFn(): LangFn {\n  return translationFn;\n}\n\n/**\n * @deprecated Migrate to `changeLanguage` in `util/localization.ts` instead\n */\nexport async function oldSetLanguage(langCode: LangCode, callback?: NoneToVoidFunction, withFallback = false) {\n  loadAndChangeLanguage(langCode, true);\n  if (langPack && langCode === currentLangCode) {\n    if (callback) {\n      callback();\n    }\n\n    return;\n  }\n\n  let newLangPack = await cacheApi.fetch(LANG_CACHE_NAME, langCode, cacheApi.Type.Json);\n  if (!newLangPack) {\n    if (withFallback) {\n      await importFallbackLangPack();\n    }\n\n    newLangPack = await fetchRemote(langCode);\n    if (!newLangPack) {\n      return;\n    }\n  }\n\n  cache.clear();\n\n  currentLangCode = langCode;\n  langPack = newLangPack;\n  document.documentElement.lang = langCode;\n\n  const global = getGlobal();\n  const { languages, byKey } = global.settings;\n  const timeFormat = byKey?.timeFormat;\n  const langInfo = languages?.find((lang) => lang.langCode === langCode);\n  translationFn = createLangFn();\n  translationFn.isRtl = Boolean(langInfo?.isRtl);\n  translationFn.code = langCode.replace('-raw', '') as LangCode;\n  translationFn.langName = langInfo?.nativeName;\n  translationFn.timeFormat = timeFormat;\n\n  if (callback) {\n    callback();\n  }\n\n  runCallbacks();\n}\n\nexport function setTimeFormat(timeFormat: TimeFormat) {\n  if (timeFormat && timeFormat === currentTimeFormat) {\n    return;\n  }\n\n  currentTimeFormat = timeFormat;\n  translationFn.timeFormat = timeFormat;\n\n  runCallbacks();\n}\n\nasync function importFallbackLangPack() {\n  if (fallbackLangPack) {\n    return;\n  }\n\n  fallbackLangPack = (await import('./fallbackLangPack')).default;\n  runCallbacks();\n}\n\nasync function fetchRemote(langCode: string): Promise<ApiOldLangPack | undefined> {\n  const remote = await callApi('oldFetchLangPack', { sourceLangPacks: LANG_PACKS, langCode });\n  if (remote) {\n    await cacheApi.save(LANG_CACHE_NAME, langCode, remote.langPack);\n    return remote.langPack;\n  }\n\n  return undefined;\n}\n\nfunction getPluralOption(amount: number) {\n  const langCode = currentLangCode || 'en';\n  const optionIndex = PLURAL_RULES[langCode as keyof typeof PLURAL_RULES]\n    ? PLURAL_RULES[langCode as keyof typeof PLURAL_RULES](amount)\n    : 0;\n\n  return PLURAL_OPTIONS[optionIndex];\n}\n\nfunction processTemplate(template: string, value: any) {\n  value = Array.isArray(value) ? value : [value];\n  const translationSlices = template.split(SUBSTITUTION_REGEX);\n  const initialValue = translationSlices.shift();\n\n  return translationSlices.reduce((result, str, index) => {\n    return `${result}${String(value[index] ?? '')}${str}`;\n  }, initialValue || '');\n}\n\nfunction processTranslation(\n  langString: ApiOldLangString | undefined, key: string, value?: any, format?: 'i', pluralValue?: number,\n) {\n  const preferredPluralOption = typeof value === 'number' || pluralValue !== undefined\n    ? getPluralOption(pluralValue ?? value)\n    : 'value';\n  const template = typeof langString === 'string'\n    ? langString\n    : preferredPluralOption === 'value'\n      // Support cached older `langString` interface\n      ? (typeof langString === 'object' ? (langString as any).value : langString)\n      : typeof langString === 'object'\n        ? langString[preferredPluralOption] || langString.otherValue\n        : undefined;\n\n  if (!template?.trim()) {\n    const parts = key.split('.');\n\n    return parts[parts.length - 1];\n  }\n\n  if (value !== undefined) {\n    const formattedValue = format === 'i' ? formatInteger(value) : value;\n    const result = processTemplate(template, formattedValue);\n    const cacheValue = Array.isArray(value) ? JSON.stringify(value) : value;\n    cache.set(`${key}_${cacheValue}_${format}${pluralValue ? `_${pluralValue}` : ''}`, result);\n    return result;\n  }\n\n  return template;\n}\n","import { LEGACY_PASSCODE_CACHE_NAME } from '../config';\nimport { PASSCODE_IDB_STORE } from './browser/idb';\nimport * as cacheApi from './cacheApi';\n\nconst IV_LENGTH = 12;\nconst SALT = 'harder better faster stronger';\n\nlet currentPasscodeHash: ArrayBuffer | undefined;\n\nexport class UnrecoverablePasscodeError extends Error {}\n\nexport function getPasscodeHash() {\n  return currentPasscodeHash;\n}\n\nexport function setPasscodeHash(passcodeHash: ArrayBuffer) {\n  currentPasscodeHash = passcodeHash;\n}\n\nexport async function setupPasscode(passcode: string) {\n  currentPasscodeHash = await sha256(passcode);\n}\n\nexport async function encryptSession(sessionJson?: string, globalJson?: string) {\n  if (!currentPasscodeHash) {\n    // eslint-disable-next-line no-console\n    console.error('[api/passcode] Missing current passcode');\n    throw new Error('[api/passcode] Missing current passcode');\n  }\n\n  await Promise.all([\n    (async () => {\n      if (!sessionJson) return;\n\n      const sessionEncrypted = await aesEncrypt(sessionJson, currentPasscodeHash);\n      await store('sessionEncrypted', sessionEncrypted);\n    })(),\n    (async () => {\n      if (!globalJson) return;\n\n      const globalEncrypted = await aesEncrypt(globalJson, currentPasscodeHash);\n      await store('globalEncrypted', globalEncrypted);\n    })(),\n  ]);\n}\n\nexport async function decryptSessionByCurrentHash() {\n  if (!currentPasscodeHash) {\n    // eslint-disable-next-line no-console\n    console.error('[api/passcode] Missing current passcode');\n    throw new Error('[api/passcode] Missing current passcode');\n  }\n\n  const [sessionEncrypted, globalEncrypted] = await Promise.all([\n    load('sessionEncrypted'),\n    load('globalEncrypted'),\n  ]);\n\n  if (!sessionEncrypted || !globalEncrypted) {\n    // eslint-disable-next-line no-console\n    console.error('[api/passcode] Missing required stored fields');\n    throw new Error('[api/passcode] Missing required stored fields');\n  }\n\n  try {\n    const [sessionJson, globalJson] = await Promise.all([\n      aesDecrypt(sessionEncrypted, currentPasscodeHash),\n      aesDecrypt(globalEncrypted, currentPasscodeHash),\n    ]);\n\n    return { sessionJson, globalJson };\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.error('[api/passcode] Error decrypting session', err);\n    throw err;\n  }\n}\n\nexport async function decryptSession(passcode: string) {\n  const passcodeHash = await sha256(passcode);\n\n  const [sessionEncrypted, globalEncrypted] = await Promise.all([\n    load('sessionEncrypted'),\n    load('globalEncrypted'),\n  ]);\n\n  if (!sessionEncrypted || !globalEncrypted) {\n    // eslint-disable-next-line no-console\n    console.error('[api/passcode] Missing required stored fields');\n    throw new UnrecoverablePasscodeError('[api/passcode] Missing required stored fields');\n  }\n\n  try {\n    const [sessionJson, globalJson] = await Promise.all([\n      aesDecrypt(sessionEncrypted, passcodeHash),\n      aesDecrypt(globalEncrypted, passcodeHash),\n    ]);\n\n    currentPasscodeHash = passcodeHash;\n\n    return { sessionJson, globalJson };\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.error('[api/passcode] Error decrypting session', err);\n    throw err;\n  }\n}\n\nexport function forgetPasscode() {\n  currentPasscodeHash = undefined;\n}\n\nexport function clearEncryptedSession() {\n  forgetPasscode();\n  PASSCODE_IDB_STORE.clear();\n  return cacheApi.clear(LEGACY_PASSCODE_CACHE_NAME);\n}\n\nfunction sha256(plaintext: string) {\n  return crypto.subtle.digest('SHA-256', new TextEncoder().encode(`${plaintext}${SALT}`));\n}\n\nfunction store(key: string, value: ArrayBuffer) {\n  const asArray = Array.from(new Uint8Array(value));\n  PASSCODE_IDB_STORE.set(key, asArray);\n}\n\nasync function load(key: string) {\n  const cached = await PASSCODE_IDB_STORE.get<number[]>(key);\n  if (cached) {\n    const asArrayBuffer = new Uint8Array(cached).buffer;\n    return asArrayBuffer;\n  }\n  // Fallback for old data\n  return cacheApi.fetch(LEGACY_PASSCODE_CACHE_NAME, key, cacheApi.Type.ArrayBuffer);\n}\n\nasync function aesEncrypt(plaintext: string, pwHash: ArrayBuffer) {\n  const iv = crypto.getRandomValues(new Uint8Array(IV_LENGTH));\n  const alg = { name: 'AES-GCM', iv };\n  const key = await crypto.subtle.importKey('raw', pwHash, alg, false, ['encrypt']);\n  const ptUint8 = new TextEncoder().encode(plaintext);\n  const ctBuffer = await crypto.subtle.encrypt(alg, key, ptUint8);\n  const ct = new Uint8Array(ctBuffer);\n  const result = new Uint8Array(IV_LENGTH + ct.length);\n  result.set(iv, 0);\n  result.set(ct, IV_LENGTH);\n  return result.buffer;\n}\n\nasync function aesDecrypt(data: ArrayBuffer, pwHash: ArrayBuffer) {\n  const dataArray = new Uint8Array(data);\n  const iv = dataArray.slice(0, IV_LENGTH);\n  const alg = { name: 'AES-GCM', iv };\n  const key = await crypto.subtle.importKey('raw', pwHash, alg, false, ['decrypt']);\n  const ct = dataArray.slice(IV_LENGTH);\n  const plainBuffer = await crypto.subtle.decrypt(alg, key, ct);\n\n  return new TextDecoder().decode(plainBuffer);\n}\n","/*\n * Thanks to Ace Monkey for this mind-blowing patch.\n */\n\nexport function patchSafariProgressiveAudio(audioEl: HTMLAudioElement) {\n  if (audioEl.dataset.patchedForSafari) {\n    return;\n  }\n\n  audioEl.addEventListener('play', () => {\n    const t = audioEl.currentTime;\n\n    audioEl.dataset.patchForSafariInProgress = 'true';\n    function onProgress() {\n      if (!audioEl.buffered.length) {\n        return;\n      }\n      audioEl.currentTime = audioEl.duration - 1;\n      audioEl.addEventListener('progress', () => {\n        delete audioEl.dataset.patchForSafariInProgress;\n        audioEl.currentTime = t;\n        if (audioEl.paused && !audioEl.dataset.preventPlayAfterPatch) {\n          audioEl.play();\n        }\n      }, { once: true });\n\n      audioEl.removeEventListener('progress', onProgress);\n    }\n\n    audioEl.addEventListener('progress', onProgress);\n  }, { once: true });\n\n  audioEl.dataset.patchedForSafari = 'true';\n}\n\nexport function isSafariPatchInProgress(audioEl: HTMLAudioElement) {\n  return Boolean(audioEl.dataset.patchForSafariInProgress);\n}\n","import type { PerformanceType } from '../types';\n\nexport function applyPerformanceSettings(performanceType: PerformanceType) {\n  const {\n    pageTransitions,\n    messageSendingAnimations,\n    mediaViewerAnimations,\n    messageComposerAnimations,\n    contextMenuAnimations,\n    contextMenuBlur,\n    rightColumnAnimations,\n  } = performanceType;\n\n  const root = document.body;\n\n  root.classList.toggle('no-page-transitions', !pageTransitions);\n  root.classList.toggle('no-message-sending-animations', !messageSendingAnimations);\n  root.classList.toggle('no-media-viewer-animations', !mediaViewerAnimations);\n  root.classList.toggle('no-message-composer-animations', !messageComposerAnimations);\n  root.classList.toggle('no-context-menu-animations', !contextMenuAnimations);\n  root.classList.toggle('no-menu-blur', !contextMenuBlur);\n  root.classList.toggle('no-right-column-animations', !rightColumnAnimations);\n}\n","import { getActions } from '../global';\n\nimport { PRODUCTION_HOSTNAME, WEB_VERSION_BASE } from '../config';\nimport { clearWebsync } from './websync';\n\nconst SEARCH_ENGINE_REGEX = /(^|\\.)(google|bing|duckduckgo|ya|yandex)\\./i;\n// Handled by the legacy version. Cannot be updated\nconst PERMANENT_VERSION_KEY = 'kz_version';\nconst AVAILABLE_VERSIONS = ['Z', 'K'] as const;\nconst CLIENT_VERSION = 'Z';\ntype AvailableVersions = typeof AVAILABLE_VERSIONS[number];\n\nfunction setPermanentWebVersion(version: AvailableVersions) {\n  localStorage.setItem(PERMANENT_VERSION_KEY, JSON.stringify(version));\n}\n\nexport function getPermanentWebVersion(): AvailableVersions | undefined {\n  const version = localStorage.getItem(PERMANENT_VERSION_KEY);\n  if (version) {\n    return JSON.parse(version);\n  }\n\n  return undefined;\n}\n\nexport function switchPermanentWebVersion(version: AvailableVersions) {\n  setPermanentWebVersion(version);\n  clearWebsync();\n  getActions().skipLockOnUnload();\n  window.location.assign(`${WEB_VERSION_BASE}${version.toLowerCase()}`);\n}\n\nexport function checkAndAssignPermanentWebVersion() {\n  if (window.location.hostname !== PRODUCTION_HOSTNAME) return;\n\n  const referrer = document.referrer.toLowerCase();\n  if (!referrer) return;\n  try {\n    const isSearchEngine = new URL(referrer).host.match(SEARCH_ENGINE_REGEX);\n    if (!isSearchEngine) return;\n\n    const currentVersion = getPermanentWebVersion();\n    if (currentVersion) {\n      if (currentVersion !== CLIENT_VERSION) {\n        switchPermanentWebVersion(currentVersion);\n      }\n      return;\n    }\n\n    const urlParams = new URLSearchParams(window.location.search);\n    const hasTest = (urlParams.get('test') ?? undefined) !== undefined;\n    const shouldRedirect = Math.random() < 0.5;\n\n    if (hasTest || !shouldRedirect) {\n      setPermanentWebVersion('Z');\n      return;\n    }\n\n    switchPermanentWebVersion('K');\n  } catch (e) {\n    // Ignore\n  }\n}\n","import type { ApiCountryCode } from '../api/types';\n\nconst PATTERN_PLACEHOLDER = 'X';\nconst DEFAULT_PATTERN = 'XXX XXX XXX XXX';\n\nexport function getCountryCodesByIso(phoneCodeList: ApiCountryCode[], iso: string) {\n  return phoneCodeList.filter((country) => country.iso2 === iso);\n}\n\nexport function getCountryFromPhoneNumber(phoneCodeList: ApiCountryCode[], input = '') {\n  let phoneNumber = input.replace(/[^\\d+]+/g, '');\n  if (phoneNumber.startsWith('+')) {\n    phoneNumber = phoneNumber.substr(1);\n  }\n\n  const possibleCountries = phoneCodeList\n    .filter((country) => phoneNumber.startsWith(country.countryCode));\n  const codesWithPrefix: { code: string; country: ApiCountryCode }[] = possibleCountries\n    .map((country) => (country.prefixes || ['']).map((prefix) => {\n      return {\n        code: `${country.countryCode}${prefix}`,\n        country,\n      };\n    }))\n    .flat();\n\n  const bestMatches = codesWithPrefix\n    .filter(({ code }) => phoneNumber.startsWith(code))\n    .sort((a, b) => a.code.length - b.code.length);\n\n  return bestMatches[bestMatches.length - 1]?.country;\n}\n\nexport function formatPhoneNumber(input: string, country?: ApiCountryCode) {\n  if (!input) {\n    return '';\n  }\n\n  let phoneNumber = input.replace(/[^\\d]+/g, '');\n  if (country) {\n    phoneNumber = phoneNumber.substr(country.countryCode.length);\n  } else if (input.startsWith('+')) {\n    return input;\n  }\n  const pattern = getBestPattern(phoneNumber, country?.patterns);\n\n  const result: string[] = []; // Result character array\n  let j = 0; // Position inside pattern\n  for (let i = 0; i < phoneNumber.length; i++) {\n    while (pattern[j] !== PATTERN_PLACEHOLDER && j < pattern.length) {\n      result.push(pattern[j]);\n      if (pattern[j] === phoneNumber[i]) { // If pattern contains digits, move input position too\n        i++;\n        if (i === phoneNumber.length) break; // But don't overdo it, or it will insert full pattern unexpectedly\n      }\n      j++;\n    }\n\n    result.push(phoneNumber[i]); // For placeholder characters, setting current input digit\n    j++;\n  }\n\n  return result.join('');\n}\n\nfunction getBestPattern(numberWithoutCode: string, patterns?: string[]) {\n  if (!patterns || patterns.length === 0) return DEFAULT_PATTERN;\n  if (patterns.length === 1) return patterns[0];\n\n  const defaultPattern = patterns.find((pattern) => pattern.startsWith(PATTERN_PLACEHOLDER)) || DEFAULT_PATTERN;\n\n  const bestMatches = patterns.filter((pattern) => {\n    const stripped = pattern.replace(/[^\\dX]+/g, '');\n    if (stripped.startsWith(PATTERN_PLACEHOLDER)) return false; // Don't consider default number format here\n    for (let i = 0; i < numberWithoutCode.length; i++) {\n      if (i > stripped.length - 1 || (stripped[i] !== PATTERN_PLACEHOLDER && stripped[i] !== numberWithoutCode[i])) {\n        return false;\n      }\n    }\n    return true;\n  });\n\n  // Playing it safe: if not sure, use default for that region\n  return bestMatches.length === 1 ? bestMatches[0] : defaultPattern;\n}\n\nexport function formatPhoneNumberWithCode(phoneCodeList: ApiCountryCode[], phoneNumber: string) {\n  if (!phoneNumber) {\n    return '';\n  }\n\n  const numberWithPlus = phoneNumber.startsWith('+') ? phoneNumber : `+${phoneNumber}`;\n  const country = getCountryFromPhoneNumber(phoneCodeList, numberWithPlus);\n  if (!country) {\n    return numberWithPlus;\n  }\n  return `+${country.countryCode} ${formatPhoneNumber(numberWithPlus, country)}`;\n}\n","/**\n * A Map that has a limited size. When the limit is reached, the oldest entry is removed.\n * Ignores last access time, only cares about insertion order.\n */\nexport default class LimitedMap<K, V> {\n  private map: Map<K, V>;\n\n  private insertionQueue: Set<K>;\n\n  constructor(private limit: number) {\n    this.map = new Map();\n    this.insertionQueue = new Set<K>();\n  }\n\n  public get(key: K): V | undefined {\n    return this.map.get(key);\n  }\n\n  public set(key: K, value: V): this {\n    if (this.map.size === this.limit) {\n      const keyToRemove = Array.from(this.insertionQueue).shift();\n      if (keyToRemove) {\n        this.map.delete(keyToRemove);\n        this.insertionQueue.delete(keyToRemove);\n      }\n    }\n\n    this.map.set(key, value);\n    this.insertionQueue.add(key);\n\n    return this;\n  }\n\n  public has(key: K): boolean {\n    return this.map.has(key);\n  }\n\n  public delete(key: K): boolean {\n    const result = this.map.delete(key);\n    if (result) {\n      this.insertionQueue.delete(key);\n    }\n    return result;\n  }\n\n  public clear(): void {\n    this.map.clear();\n    this.insertionQueue.clear();\n  }\n\n  public forEach(callbackfn: (value: V, key: K, map: Map<K, V>) => void, thisArg?: any): void {\n    this.map.forEach(callbackfn, thisArg);\n  }\n\n  public get size(): number {\n    return this.map.size;\n  }\n\n  public get [Symbol.toStringTag](): string {\n    return this.map[Symbol.toStringTag];\n  }\n\n  public [Symbol.iterator](): IterableIterator<[K, V]> {\n    return this.map[Symbol.iterator]();\n  }\n\n  public entries(): IterableIterator<[K, V]> {\n    return this.map.entries();\n  }\n\n  public keys(): IterableIterator<K> {\n    return this.map.keys();\n  }\n\n  public values(): IterableIterator<V> {\n    return this.map.values();\n  }\n}\n","import { type TeactNode } from '../lib/teact/teact';\n\nexport function replaceWithTeact(\n  input: string, searchValue: string | RegExp, replaceValue: TeactNode,\n) {\n  const parts = input.split(searchValue);\n  const [firstElement, ...rest] = parts;\n\n  return rest.reduce((acc: TeactNode[], curr: string): TeactNode[] => (\n    acc.concat(replaceValue, curr)\n  ), [firstElement]).filter(Boolean);\n}\n\nexport function replaceInStringsWithTeact(\n  input: TeactNode[], searchValue: string | RegExp, replaceValue: TeactNode,\n) {\n  return input.flatMap((curr: TeactNode) => {\n    if (typeof curr === 'string') return replaceWithTeact(curr, searchValue, replaceValue);\n    return curr;\n  }, []);\n}\n","import { getActions } from '../global';\n\nimport type { CallbackAction } from '../global/types';\n\nconst callbacks = new Map<string, number>();\n\n// TODO Pass callbacks to the master tab. Sync them on master change\nexport default function requestActionTimeout(action: CallbackAction, timeout: number) {\n  const name = action.action;\n  clearTimeout(callbacks.get(name));\n  const timerId = window.setTimeout(() => {\n    // @ts-ignore\n    getActions()[name](action.payload);\n  }, timeout);\n  callbacks.set(name, timerId);\n}\n","import type { MessageListType, ThreadId } from '../types';\nimport { MAIN_THREAD_ID } from '../api/types';\n\nimport { IS_MOCKED_CLIENT } from '../config';\n\nlet parsedInitialLocationHash: Record<string, string> | undefined;\nlet messageHash: string | undefined;\nlet isAlreadyParsed = false;\nlet initialLocationHash = window.location.hash;\n\nexport function resetInitialLocationHash() {\n  isAlreadyParsed = false;\n  messageHash = undefined;\n  parsedInitialLocationHash = undefined;\n  initialLocationHash = '';\n}\n\nexport function resetLocationHash() {\n  window.location.hash = '';\n}\n\nexport const createLocationHash = (chatId: string, type: MessageListType, threadId: ThreadId): string => {\n  const displayType = type === 'thread' ? undefined : type;\n  const parts = threadId === MAIN_THREAD_ID ? [chatId, displayType] : [chatId, threadId, displayType];\n\n  return parts.filter(Boolean).join('_');\n};\n\nexport function parseLocationHash(currentUserId?: string) {\n  parseInitialLocationHash();\n\n  if (!messageHash) return undefined;\n\n  const parts = messageHash.split('_');\n  let chatId: string | undefined;\n  let type: string | undefined;\n  let threadId: string | undefined;\n  if (parts.length === 1) {\n    chatId = parts[0];\n  } else if (parts.length === 2) {\n    const isType = ['thread', 'pinned', 'scheduled'].includes(parts[1]);\n    chatId = parts[0];\n    type = isType ? parts[1] : 'thread';\n    threadId = !isType ? parts[1] : undefined;\n  } else if (parts.length >= 3) {\n    [chatId, threadId, type] = parts;\n  }\n  if (!chatId?.match(/^-?\\d+$/)) return undefined;\n\n  const isType = ['thread', 'pinned', 'scheduled'].includes(type!);\n\n  const castedThreadId = (chatId === currentUserId ? threadId : Number(threadId)) || MAIN_THREAD_ID;\n\n  return {\n    chatId,\n    type: type && isType ? (type as MessageListType) : 'thread',\n    threadId: castedThreadId,\n  };\n}\n\nexport const createMessageHashUrl = (chatId: string, type: MessageListType, threadId: ThreadId): string => {\n  const url = new URL(window.location.href);\n  url.hash = createLocationHash(chatId, type, threadId);\n  return url.href;\n};\n\nexport function parseInitialLocationHash() {\n  if (parsedInitialLocationHash) return parsedInitialLocationHash;\n\n  if (isAlreadyParsed) return undefined;\n\n  const locationHash = getInitialLocationHash();\n  if (!locationHash) return undefined;\n\n  let parsedHash = locationHash.replace(/^#/, '');\n  if (parsedHash.includes('?')) {\n    [messageHash, parsedHash] = parsedHash.split('?');\n    if (!IS_MOCKED_CLIENT) {\n      window.location.hash = messageHash;\n    }\n  } else if (parsedHash.includes('=')) {\n    if (!IS_MOCKED_CLIENT) {\n      window.location.hash = '';\n    }\n  }\n\n  parsedInitialLocationHash = parsedHash.includes('=') ? parsedHash.split('&').reduce((acc, cur) => {\n    const [key, value] = cur.split('=');\n    acc[key] = value;\n    return acc;\n  }, {} as Record<string, string>) : undefined;\n  isAlreadyParsed = true;\n  if (!parsedInitialLocationHash) {\n    messageHash = parsedHash;\n  }\n\n  return parsedInitialLocationHash;\n}\n\nexport function clearWebTokenAuth() {\n  if (!parsedInitialLocationHash) return;\n\n  delete parsedInitialLocationHash.tgWebAuthToken;\n}\n\nfunction getInitialLocationHash() {\n  return initialLocationHash;\n}\n","import { DEBUG_MORE } from '../config';\nimport { handleError } from './handleError';\n\nconst SAFE_EXEC_ENABLED = !DEBUG_MORE;\n\ntype SafeExecOptions = {\n  rescue?: (err: Error) => void;\n  always?: NoneToVoidFunction;\n  shouldIgnoreError?: boolean;\n};\n\nexport default function safeExec<T extends AnyFunction>(cb: T, options?: SafeExecOptions): ReturnType<T> | undefined {\n  if (!SAFE_EXEC_ENABLED) {\n    return cb();\n  }\n\n  const { rescue, always, shouldIgnoreError } = options ?? {};\n\n  try {\n    return cb();\n  } catch (err: any) {\n    rescue?.(err);\n    if (!shouldIgnoreError) {\n      handleError(err);\n    }\n    return undefined;\n  } finally {\n    always?.();\n  }\n}\n","import { DEBUG } from '../config';\n\nconst safePlay = (mediaEl: HTMLMediaElement) => {\n  mediaEl.play().catch((err) => {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn(err, mediaEl);\n    }\n  });\n};\n\nexport const getIsVideoPlaying = (video: HTMLVideoElement) => {\n  return video.currentTime > 0 && !video.paused && !video.ended && video.readyState > 2;\n};\n\nexport default safePlay;\n","export type Scheduler = typeof requestAnimationFrame | typeof onTickEnd;\n\nexport function debounce<F extends AnyToVoidFunction>(\n  fn: F,\n  ms: number,\n  shouldRunFirst = true,\n  shouldRunLast = true,\n) {\n  let waitingTimeout: number | undefined;\n\n  return (...args: Parameters<F>) => {\n    if (waitingTimeout) {\n      clearTimeout(waitingTimeout);\n      waitingTimeout = undefined;\n    } else if (shouldRunFirst) {\n      fn(...args);\n    }\n\n    // eslint-disable-next-line no-restricted-globals\n    waitingTimeout = self.setTimeout(() => {\n      if (shouldRunLast) {\n        fn(...args);\n      }\n\n      waitingTimeout = undefined;\n    }, ms);\n  };\n}\n\nexport function throttle<F extends AnyToVoidFunction>(\n  fn: F,\n  ms: number,\n  shouldRunFirst = true,\n) {\n  let interval: number | undefined;\n  let isPending: boolean;\n  let args: Parameters<F>;\n\n  return (..._args: Parameters<F>) => {\n    isPending = true;\n    args = _args;\n\n    if (!interval) {\n      if (shouldRunFirst) {\n        isPending = false;\n        fn(...args);\n      }\n\n      // eslint-disable-next-line no-restricted-globals\n      interval = self.setInterval(() => {\n        if (!isPending) {\n          // eslint-disable-next-line no-restricted-globals\n          self.clearInterval(interval!);\n          interval = undefined;\n          return;\n        }\n\n        isPending = false;\n        fn(...args);\n      }, ms);\n    }\n  };\n}\n\nexport function throttleWithTickEnd<F extends AnyToVoidFunction>(fn: F) {\n  return throttleWith(onTickEnd, fn);\n}\n\nexport function throttleWith<F extends AnyToVoidFunction>(schedulerFn: Scheduler, fn: F) {\n  let waiting = false;\n  let args: Parameters<F>;\n\n  return (..._args: Parameters<F>) => {\n    args = _args;\n\n    if (!waiting) {\n      waiting = true;\n\n      schedulerFn(() => {\n        waiting = false;\n        fn(...args);\n      });\n    }\n  };\n}\n\nexport const pause = (ms: number) => new Promise<void>((resolve) => {\n  setTimeout(() => resolve(), ms);\n});\n\nexport function rafPromise() {\n  return new Promise<void>((resolve) => {\n    fastRaf(resolve);\n  });\n}\n\nconst FAST_RAF_TIMEOUT_FALLBACK_MS = 35; // < 30 FPS\n\nlet fastRafCallbacks: Set<NoneToVoidFunction> | undefined;\nlet fastRafFallbackCallbacks: Set<NoneToVoidFunction> | undefined;\nlet fastRafFallbackTimeout: number | undefined;\n\n// May result in an immediate execution if called from another RAF callback which was scheduled\n// (and therefore is executed) earlier than RAF callback scheduled by `fastRaf`\nexport function fastRaf(callback: NoneToVoidFunction, withTimeoutFallback = false) {\n  if (!fastRafCallbacks) {\n    fastRafCallbacks = new Set([callback]);\n\n    requestAnimationFrame(() => {\n      const currentCallbacks = fastRafCallbacks!;\n\n      fastRafCallbacks = undefined;\n      fastRafFallbackCallbacks = undefined;\n\n      if (fastRafFallbackTimeout) {\n        clearTimeout(fastRafFallbackTimeout);\n        fastRafFallbackTimeout = undefined;\n      }\n\n      currentCallbacks.forEach((cb) => cb());\n    });\n  } else {\n    fastRafCallbacks.add(callback);\n  }\n\n  if (withTimeoutFallback) {\n    if (!fastRafFallbackCallbacks) {\n      fastRafFallbackCallbacks = new Set([callback]);\n    } else {\n      fastRafFallbackCallbacks.add(callback);\n    }\n\n    if (!fastRafFallbackTimeout) {\n      fastRafFallbackTimeout = window.setTimeout(() => {\n        const currentTimeoutCallbacks = fastRafFallbackCallbacks!;\n\n        if (fastRafCallbacks) {\n          currentTimeoutCallbacks.forEach(fastRafCallbacks.delete, fastRafCallbacks);\n        }\n        fastRafFallbackCallbacks = undefined;\n\n        if (fastRafFallbackTimeout) {\n          clearTimeout(fastRafFallbackTimeout);\n          fastRafFallbackTimeout = undefined;\n        }\n\n        currentTimeoutCallbacks.forEach((cb) => cb());\n      }, FAST_RAF_TIMEOUT_FALLBACK_MS);\n    }\n  }\n}\n\nlet onTickEndCallbacks: NoneToVoidFunction[] | undefined;\n\nexport function onTickEnd(callback: NoneToVoidFunction) {\n  if (!onTickEndCallbacks) {\n    onTickEndCallbacks = [callback];\n\n    Promise.resolve().then(() => {\n      const currentCallbacks = onTickEndCallbacks!;\n      onTickEndCallbacks = undefined;\n      currentCallbacks.forEach((cb) => cb());\n    });\n  } else {\n    onTickEndCallbacks.push(callback);\n  }\n}\n\nconst IDLE_TIMEOUT = 500;\n\nlet onIdleCallbacks: NoneToVoidFunction[] | undefined;\n\nexport function onIdle(callback: NoneToVoidFunction) {\n  // eslint-disable-next-line no-restricted-globals\n  if (!self.requestIdleCallback) {\n    onTickEnd(callback);\n    return;\n  }\n\n  if (!onIdleCallbacks) {\n    onIdleCallbacks = [callback];\n\n    requestIdleCallback((deadline) => {\n      const currentCallbacks = onIdleCallbacks!;\n      onIdleCallbacks = undefined;\n\n      while (currentCallbacks.length) {\n        const cb = currentCallbacks.shift()!;\n        cb();\n\n        if (!deadline.timeRemaining()) break;\n      }\n\n      if (currentCallbacks.length) {\n        if (onIdleCallbacks) {\n          // Prepend the remaining callbacks if the next pass is already planned\n          onIdleCallbacks = currentCallbacks.concat(onIdleCallbacks);\n        } else {\n          currentCallbacks.forEach(onIdle);\n        }\n      }\n    }, { timeout: IDLE_TIMEOUT });\n  } else {\n    onIdleCallbacks.push(callback);\n  }\n}\n\nlet beforeUnloadCallbacks: NoneToVoidFunction[] | undefined;\n\nexport function onBeforeUnload(callback: NoneToVoidFunction, isLast = false) {\n  if (!beforeUnloadCallbacks) {\n    beforeUnloadCallbacks = [];\n    // eslint-disable-next-line no-restricted-globals\n    self.addEventListener('beforeunload', () => {\n      beforeUnloadCallbacks!.forEach((cb) => cb());\n    });\n  }\n\n  if (isLast) {\n    beforeUnloadCallbacks.push(callback);\n  } else {\n    beforeUnloadCallbacks.unshift(callback);\n  }\n\n  return () => {\n    beforeUnloadCallbacks = beforeUnloadCallbacks!.filter((cb) => cb !== callback);\n  };\n}\n","let RE_NOT_LETTER: RegExp;\n\ntry {\n  RE_NOT_LETTER = /[^\\p{L}\\p{M}]+/ui;\n} catch (e) {\n  // Support for older versions of firefox\n  RE_NOT_LETTER = /[^\\wа-яёґєії]+/i;\n}\n\nexport default function searchWords(haystack: string, needle: string | string[]) {\n  if (!haystack || !needle) {\n    return false;\n  }\n\n  const needleWords = typeof needle === 'string' ? needle.toLowerCase().split(RE_NOT_LETTER) : needle;\n  const haystackLower = haystack.toLowerCase();\n\n  // @optimization\n  if (needleWords.length === 1 && !haystackLower.includes(needleWords[0])) {\n    return false;\n  }\n\n  let haystackWords: string[];\n\n  return needleWords.every((needleWord) => {\n    if (!haystackLower.includes(needleWord)) {\n      return false;\n    }\n\n    if (!haystackWords) {\n      haystackWords = haystackLower.split(RE_NOT_LETTER);\n    }\n\n    return haystackWords.some((haystackWord) => haystackWord.startsWith(needleWord));\n  });\n}\n\nexport function prepareSearchWordsForNeedle(needle: string) {\n  const needleWords = needle.toLowerCase().split(RE_NOT_LETTER);\n\n  return (haystack: string) => searchWords(haystack, needleWords);\n}\n","let serverTimeOffset = 0;\n\nexport function setServerTimeOffset(_serverTimeOffset: number) {\n  serverTimeOffset = _serverTimeOffset;\n}\n\nexport function getServerTimeOffset() {\n  return serverTimeOffset;\n}\n\nexport function getServerTime() {\n  return Math.floor(Date.now() / 1000) + serverTimeOffset;\n}\n","import type { ApiSessionData } from '../api/types';\n\nimport {\n  DEBUG, IS_SCREEN_LOCKED_CACHE_KEY,\n  SESSION_USER_KEY,\n} from '../config';\n\nconst DC_IDS = [1, 2, 3, 4, 5];\n\nexport function hasStoredSession() {\n  if (checkSessionLocked()) {\n    return true;\n  }\n\n  const userAuthJson = localStorage.getItem(SESSION_USER_KEY);\n  if (!userAuthJson) {\n    return false;\n  }\n\n  try {\n    const userAuth = JSON.parse(userAuthJson);\n    return Boolean(userAuth && userAuth.id && userAuth.dcID);\n  } catch (err) {\n    // Do nothing.\n    return false;\n  }\n}\n\nexport function storeSession(sessionData: ApiSessionData, currentUserId?: string) {\n  const {\n    mainDcId, keys, isTest,\n  } = sessionData;\n\n  localStorage.setItem(SESSION_USER_KEY, JSON.stringify({\n    dcID: mainDcId,\n    id: currentUserId,\n    test: isTest,\n  }));\n  localStorage.setItem('dc', String(mainDcId));\n  Object.keys(keys).map(Number).forEach((dcId) => {\n    localStorage.setItem(`dc${dcId}_auth_key`, JSON.stringify(keys[dcId]));\n  });\n}\n\nexport function clearStoredSession() {\n  [\n    SESSION_USER_KEY,\n    'dc',\n    ...DC_IDS.map((dcId) => `dc${dcId}_auth_key`),\n    ...DC_IDS.map((dcId) => `dc${dcId}_hash`),\n    ...DC_IDS.map((dcId) => `dc${dcId}_server_salt`),\n  ].forEach((key) => {\n    localStorage.removeItem(key);\n  });\n}\n\nexport function loadStoredSession(): ApiSessionData | undefined {\n  if (!hasStoredSession()) {\n    return undefined;\n  }\n\n  const userAuth = JSON.parse(localStorage.getItem(SESSION_USER_KEY)!);\n  if (!userAuth) {\n    return undefined;\n  }\n  const mainDcId = Number(userAuth.dcID);\n  const isTest = userAuth.test;\n  const keys: Record<number, string> = {};\n\n  DC_IDS.forEach((dcId) => {\n    try {\n      const key = localStorage.getItem(`dc${dcId}_auth_key`);\n      if (key) {\n        keys[dcId] = JSON.parse(key);\n      }\n    } catch (err) {\n      if (DEBUG) {\n        // eslint-disable-next-line no-console\n        console.warn('Failed to load stored session', err);\n      }\n      // Do nothing.\n    }\n  });\n\n  if (!Object.keys(keys).length) return undefined;\n\n  return {\n    mainDcId,\n    keys,\n    isTest,\n  };\n}\n\nexport function importTestSession() {\n  const sessionJson = process.env.TEST_SESSION!;\n  try {\n    const sessionData = JSON.parse(sessionJson) as ApiSessionData & { userId: string };\n    storeSession(sessionData, sessionData.userId);\n  } catch (err) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn('Failed to load test session', err);\n    }\n  }\n}\n\nfunction checkSessionLocked() {\n  return localStorage.getItem(IS_SCREEN_LOCKED_CACHE_KEY) === 'true';\n}\n","import type { CallbackManager } from './callbacks';\n\nimport { createCallbackManager } from './callbacks';\n\ninterface SignalState<T> {\n  value: T;\n  effects: CallbackManager;\n}\n\nconst SIGNAL_MARK = Symbol('SIGNAL_MARK');\n\nexport type Signal<T = any> = ((() => T) & {\n  readonly [SIGNAL_MARK]: symbol;\n  subscribe: (cb: AnyToVoidFunction) => NoneToVoidFunction;\n  once: (cb: AnyToVoidFunction) => NoneToVoidFunction;\n});\n\nexport type SignalSetter = (newValue: any) => void;\n\nexport function isSignal(obj: any): obj is Signal {\n  return typeof obj === 'function' && SIGNAL_MARK in obj;\n}\n\n// A shorthand to unsubscribe effect from all signals\nconst unsubscribesByEffect = new Map<NoneToVoidFunction, Set<NoneToVoidFunction>>();\n\nlet currentEffect: NoneToVoidFunction | undefined;\n\nexport function createSignal<T>(defaultValue?: T) {\n  const state: SignalState<typeof defaultValue> = {\n    value: defaultValue,\n    effects: createCallbackManager(),\n  };\n\n  function subscribe(effect: NoneToVoidFunction) {\n    const unsubscribe = state.effects.addCallback(effect);\n\n    if (!unsubscribesByEffect.has(effect)) {\n      unsubscribesByEffect.set(effect, new Set([unsubscribe]));\n    } else {\n      unsubscribesByEffect.get(effect)!.add(unsubscribe);\n    }\n\n    return () => {\n      unsubscribe();\n\n      const unsubscribes = unsubscribesByEffect.get(effect)!;\n      unsubscribes.delete(unsubscribe);\n      if (!unsubscribes.size) {\n        unsubscribesByEffect.delete(effect);\n      }\n    };\n  }\n\n  function once(effect: NoneToVoidFunction) {\n    const unsub = subscribe(() => {\n      unsub();\n      effect();\n    });\n\n    return unsub;\n  }\n\n  function getter() {\n    if (currentEffect) {\n      subscribe(currentEffect);\n    }\n\n    return state.value;\n  }\n\n  function setter(newValue: T) {\n    if (state.value === newValue) {\n      return;\n    }\n\n    state.value = newValue;\n    state.effects.runCallbacks();\n  }\n\n  const signal = Object.assign(getter as Signal<T>, {\n    [SIGNAL_MARK]: SIGNAL_MARK,\n    subscribe,\n    once,\n  });\n\n  return [signal, setter] as const;\n}\n\nexport function cleanupEffect(effect: NoneToVoidFunction) {\n  unsubscribesByEffect.get(effect)?.forEach((unsubscribe) => {\n    unsubscribe();\n  });\n  unsubscribesByEffect.delete(effect);\n}\n","import type React from '../lib/teact/teact';\n\nconst stopEvent = (e: React.UIEvent | Event | React.FormEvent) => {\n  e.stopPropagation();\n  e.preventDefault();\n};\n\nexport default stopEvent;\n","import { SVG_NAMESPACE } from '../config';\nimport { requestMutation } from '../lib/fasterdom/fasterdom';\nimport jsxToHtml from './element/jsxToHtml';\nimport generateUniqueId from './generateUniqueId';\n\nconst DEFINITION_MAP = new Map<string, Element>();\n\nlet defs: SVGElement | undefined;\n\nfunction init() {\n  if (defs) return;\n\n  const container = document.createElementNS(SVG_NAMESPACE, 'svg');\n  container.setAttribute('width', '0');\n  container.setAttribute('height', '0');\n  container.setAttribute('viewBox', '0 0 1 1');\n  container.classList.add('svg-definitions');\n  document.body.appendChild(container);\n\n  defs = document.createElementNS(SVG_NAMESPACE, 'defs');\n  container.appendChild(defs);\n}\n\nfunction appendElement(element: Element) {\n  requestMutation(() => {\n    if (!defs) init();\n    defs!.appendChild(element);\n  });\n}\n\nexport function addSvgDefinition(element: React.JSX.Element, id?: string) {\n  id ??= generateUniqueId();\n  element.props.id = id;\n\n  const htmlElement = jsxToHtml(element)[0];\n  DEFINITION_MAP.set(element.props.id, htmlElement);\n  appendElement(htmlElement);\n  return id;\n}\n\nexport function removeSvgDefinition(id: string) {\n  const element = DEFINITION_MAP.get(id);\n  if (element) {\n    requestMutation(() => {\n      element.remove();\n    });\n    DEFINITION_MAP.delete(id);\n  }\n}\n","import type { MoveOffsets } from './captureEvents';\n\nimport { requestMeasure, requestMutation } from '../lib/fasterdom/fasterdom';\nimport { animateNumber, timingFunctions } from './animation';\nimport { captureEvents, SwipeDirection } from './captureEvents';\nimport { waitForAnimationEnd } from './cssAnimationEndListeners';\nimport { clamp } from './math';\nimport { IS_IOS } from './windowEnvironment';\n\nconst INERTIA_DURATION = 300;\nconst INERTIA_EASING = timingFunctions.easeOutCubic;\n\nlet isSwipeActive = false;\nlet swipeOffsets: MoveOffsets | undefined;\nlet onDrag: ((offsets: MoveOffsets) => void) | undefined;\nlet onRelease: ((onCancel: NoneToVoidFunction) => void) | undefined;\nlet cancelCurrentReleaseAnimation: NoneToVoidFunction | undefined;\n\nexport function captureControlledSwipe(\n  element: HTMLElement, options: {\n    excludedClosestSelector?: string;\n    selectorToPreventScroll?: string;\n    onSwipeLeftStart?: NoneToVoidFunction;\n    onSwipeRightStart?: NoneToVoidFunction;\n    onCancel: NoneToVoidFunction;\n  },\n) {\n  return captureEvents(element, {\n    excludedClosestSelector: options.excludedClosestSelector,\n    selectorToPreventScroll: options.selectorToPreventScroll,\n    swipeThreshold: 10,\n\n    onSwipe(e, direction, offsets) {\n      if (direction === SwipeDirection.Left) {\n        options.onSwipeLeftStart?.();\n      } else if (direction === SwipeDirection.Right) {\n        options.onSwipeRightStart?.();\n      } else {\n        return false;\n      }\n\n      if (IS_IOS) {\n        isSwipeActive = true;\n        swipeOffsets = offsets;\n      }\n\n      return true;\n    },\n\n    onDrag(e, captureEvent, offsets) {\n      if (!isSwipeActive) return;\n\n      onDrag?.(offsets);\n    },\n\n    onRelease() {\n      if (!isSwipeActive) return;\n\n      isSwipeActive = false;\n\n      onRelease?.(options.onCancel);\n\n      onDrag = undefined;\n      onRelease = undefined;\n    },\n  });\n}\n\nexport function allowSwipeControlForTransition(\n  currentSlide: HTMLElement,\n  nextSlide: HTMLElement,\n  onCancelForTransition: NoneToVoidFunction,\n) {\n  cancelCurrentReleaseAnimation?.();\n\n  if (!isSwipeActive) return;\n\n  const targetPosition = extractAnimationEndPosition(currentSlide);\n  if (!targetPosition) return;\n\n  currentSlide.getAnimations().forEach((a) => a.pause());\n  nextSlide.getAnimations().forEach((a) => a.pause());\n\n  currentSlide.style.animationTimingFunction = 'linear';\n  nextSlide.style.animationTimingFunction = 'linear';\n\n  let currentDirection: 1 | -1 | undefined;\n\n  requestMeasure(() => {\n    const computedStyle = getComputedStyle(currentSlide);\n    const initialPositionPx = extractPositionFromMatrix(computedStyle.transform, targetPosition.axis);\n    const targetPositionPx = targetPosition.units === 'px'\n      ? targetPosition.value\n      : ((targetPosition.value / 100) * (\n        targetPosition.axis === 'X' ? currentSlide.offsetWidth : currentSlide.offsetHeight\n      ));\n    const distance = targetPositionPx - initialPositionPx;\n\n    let progress = 0;\n\n    onDrag = ({ dragOffsetX, dragOffsetY }) => {\n      const dragOffset = targetPosition.axis === 'X'\n        ? dragOffsetX - swipeOffsets!.dragOffsetX\n        : dragOffsetY - swipeOffsets!.dragOffsetY;\n\n      const newProgress = clamp(dragOffset / distance, 0, 1);\n      currentDirection = newProgress > progress ? 1 : -1;\n      progress = newProgress;\n\n      updateAnimationProgress([currentSlide, nextSlide], progress);\n    };\n\n    onRelease = (onCancelForClient: NoneToVoidFunction) => {\n      const isRevertSwipe = currentDirection === -1;\n\n      function cleanup() {\n        currentSlide.getAnimations().forEach((a) => a.cancel());\n        nextSlide.getAnimations().forEach((a) => a.cancel());\n\n        requestMutation(() => {\n          currentSlide.style.animationTimingFunction = '';\n          nextSlide.style.animationTimingFunction = '';\n        });\n      }\n\n      if (!isRevertSwipe) {\n        // For some reason animations are not cleared when CSS class is removed\n        waitForAnimationEnd(currentSlide, cleanup);\n      }\n\n      cancelCurrentReleaseAnimation = animateNumber({\n        from: progress,\n        to: isRevertSwipe ? 0 : 1,\n        duration: INERTIA_DURATION,\n        timing: INERTIA_EASING,\n        onUpdate(releaseProgress) {\n          updateAnimationProgress([currentSlide, nextSlide], releaseProgress);\n        },\n        onEnd(isCanceled = false) {\n          cancelCurrentReleaseAnimation = undefined;\n\n          if (isCanceled || isRevertSwipe) {\n            cleanup();\n            onCancelForTransition();\n            onCancelForClient();\n          }\n        },\n      });\n    };\n  });\n}\n\nfunction updateAnimationProgress(elements: HTMLElement[], progress: number) {\n  elements.map((e) => e.getAnimations()).flat().forEach((animation) => {\n    animation.currentTime = (animation.effect!.getTiming().duration as number) * progress;\n  });\n}\n\nfunction extractAnimationEndPosition(element: HTMLElement) {\n  for (const animation of element.getAnimations()) {\n    if (!(animation.effect instanceof KeyframeEffect)) continue;\n\n    for (const keyframe of animation.effect.getKeyframes()) {\n      if (keyframe.offset !== 1 || !keyframe.transform) continue;\n\n      const position = extractPositionFromTransform(keyframe.transform as string);\n      if (position) {\n        return position;\n      }\n    }\n  }\n\n  return undefined;\n}\n\nfunction extractPositionFromTransform(transformRule: string) {\n  const match = transformRule.match(/([XY])\\((-?\\d+)(%|px)\\)/);\n  if (!match) return undefined;\n\n  return {\n    axis: match[1] as 'X' | 'Y',\n    value: Number(match[2]),\n    units: match[3],\n  };\n}\n\nfunction extractPositionFromMatrix(transform: string, axis: 'X' | 'Y') {\n  const matrix = transform.slice(7, -1).split(',').map(Number);\n  return matrix[axis === 'X' ? 4 : 5];\n}\n","import type { ISettings } from '../types';\n\nimport { requestMutation } from '../lib/fasterdom/fasterdom';\nimport themeColors from '../styles/themes.json';\nimport { animate } from './animation';\nimport { lerp } from './math';\n\ntype RGBAColor = {\n  r: number;\n  g: number;\n  b: number;\n  a?: number;\n};\n\nlet isInitialized = false;\n\nconst DECIMAL_PLACES = 3;\nconst HEX_COLOR_REGEX = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})?$/i;\nconst DURATION_MS = 200;\nconst ENABLE_ANIMATION_DELAY_MS = 500;\nconst RGB_VARIABLES = new Set([\n  '--color-text',\n  '--color-primary-shade',\n  '--color-text-secondary',\n  '--color-accent-own',\n]);\n\nconst DISABLE_ANIMATION_CSS = `\n.no-animations #root *,\n.no-animations #root *::before,\n.no-animations #root *::after {\n  transition: none !important;\n}`;\n\nconst colors = (Object.keys(themeColors) as Array<keyof typeof themeColors>).map((property) => ({\n  property,\n  colors: [hexToRgb(themeColors[property][0]), hexToRgb(themeColors[property][1])],\n}));\n\nconst injectCss = (css: string) => {\n  const style = document.createElement('style');\n  style.textContent = css;\n  document.head.appendChild(style);\n  return () => {\n    document.head.removeChild(style);\n  };\n};\n\nconst switchTheme = (theme: ISettings['theme'], withAnimation: boolean) => {\n  const themeClassName = `theme-${theme}`;\n  if (document.documentElement.classList.contains(themeClassName)) {\n    return;\n  }\n  const isDarkTheme = theme === 'dark';\n  const shouldAnimate = isInitialized && withAnimation;\n  const startIndex = isDarkTheme ? 0 : 1;\n  const endIndex = isDarkTheme ? 1 : 0;\n  const startAt = Date.now();\n  const themeColorTag = document.querySelector('meta[name=\"theme-color\"]');\n\n  requestMutation(() => {\n    document.documentElement.classList.remove(`theme-${isDarkTheme ? 'light' : 'dark'}`);\n    let uninjectCss: (() => void) | undefined;\n    if (isInitialized) {\n      uninjectCss = injectCss(DISABLE_ANIMATION_CSS);\n      document.documentElement.classList.add('no-animations');\n    }\n    document.documentElement.classList.add(themeClassName);\n    if (themeColorTag) {\n      themeColorTag.setAttribute('content', isDarkTheme ? '#212121' : '#fff');\n    }\n\n    setTimeout(() => {\n      requestMutation(() => {\n        uninjectCss?.();\n        document.documentElement.classList.remove('no-animations');\n      });\n    }, ENABLE_ANIMATION_DELAY_MS);\n\n    isInitialized = true;\n\n    if (shouldAnimate) {\n      animate(() => {\n        const t = Math.min((Date.now() - startAt) / DURATION_MS, 1);\n\n        applyColorAnimationStep(startIndex, endIndex, transition(t));\n\n        return t < 1;\n      }, requestMutation);\n    } else {\n      applyColorAnimationStep(startIndex, endIndex);\n    }\n  });\n};\n\nfunction transition(t: number) {\n  return 1 - ((1 - t) ** 3.5);\n}\n\nexport function hexToRgb(hex: string): RGBAColor {\n  const result = HEX_COLOR_REGEX.exec(hex)!;\n\n  return {\n    r: parseInt(result[1], 16),\n    g: parseInt(result[2], 16),\n    b: parseInt(result[3], 16),\n    a: result[4] !== undefined ? parseInt(result[4], 16) : undefined,\n  };\n}\n\nexport function lerpRgb(start: RGBAColor, end: RGBAColor, interpolationRatio: number): RGBAColor {\n  const r = Math.round(lerp(start.r, end.r, interpolationRatio));\n  const g = Math.round(lerp(start.g, end.g, interpolationRatio));\n  const b = Math.round(lerp(start.b, end.b, interpolationRatio));\n  const a = start.a !== undefined\n    ? Math.round(lerp(start.a!, end.a!, interpolationRatio))\n    : undefined;\n\n  return {\n    r, g, b, a,\n  };\n}\n\nfunction applyColorAnimationStep(startIndex: number, endIndex: number, interpolationRatio: number = 1) {\n  colors.forEach(({ property, colors: propertyColors }) => {\n    const {\n      r, g, b, a,\n    } = lerpRgb(propertyColors[startIndex], propertyColors[endIndex], interpolationRatio);\n\n    const roundedA = a !== undefined ? Math.round((a / 255) * 10 ** DECIMAL_PLACES) / 10 ** DECIMAL_PLACES : undefined;\n\n    document.documentElement.style.setProperty(property, `rgb(${r},${g},${b}${roundedA ? `,${roundedA}` : ''})`);\n\n    if (RGB_VARIABLES.has(property)) {\n      document.documentElement.style.setProperty(`${property}-rgb`, `${r},${g},${b}`);\n    }\n  });\n}\n\nexport default switchTheme;\n","import type { ThemeKey } from '../types';\n\nlet systemThemeCache: ThemeKey = (\n  window.matchMedia?.('(prefers-color-scheme: dark)').matches\n) ? 'dark' : 'light';\n\nlet themeChangeCallback: ((newTheme: ThemeKey) => void) | undefined;\n\nexport function getSystemTheme() {\n  return systemThemeCache;\n}\n\nfunction handleSystemThemeChange(e: MediaQueryListEventMap['change']) {\n  systemThemeCache = e.matches ? 'dark' : 'light';\n\n  themeChangeCallback?.(systemThemeCache);\n}\n\nexport function setSystemThemeChangeCallback(callback: (newTheme: ThemeKey) => void) {\n  themeChangeCallback = callback;\n}\n\nwindow.matchMedia('(prefers-color-scheme: dark)')\n  .addEventListener('change', handleSystemThemeChange);\n","import type { OldLangFn } from '../hooks/useOldLang';\n\nimport EMOJI_REGEX from '../lib/twemojiRegex';\nimport fixNonStandardEmoji from './emoji/fixNonStandardEmoji';\nimport withCache from './withCache';\n\nexport function formatInteger(value: number) {\n  return String(value).replace(/\\d(?=(\\d{3})+$)/g, '$& ');\n}\n\nfunction formatFixedNumber(number: number) {\n  const fixed = String(number.toFixed(1));\n  if (fixed.substr(-2) === '.0') {\n    return Math.floor(number);\n  }\n\n  return number.toFixed(1).replace('.', ',');\n}\n\nexport function formatIntegerCompact(views: number) {\n  if (views < 1e3) {\n    return views.toString();\n  }\n\n  if (views < 1e6) {\n    return `${formatFixedNumber(views / 1e3)}K`;\n  }\n\n  return `${formatFixedNumber(views / 1e6)}M`;\n}\n\nexport function formatPercent(value: number, fractionDigits = 1) {\n  return `${Number.isInteger(value) ? value : value.toFixed(fractionDigits)}%`;\n}\n\nexport const getFirstLetters = withCache((phrase: string, count = 2) => {\n  return phrase\n    .replace(/[.,!@#$%^&*()_+=\\-`~[\\]/\\\\{}:\"|<>?]+/gi, '')\n    .trim()\n    .split(/\\s+/)\n    .slice(0, count)\n    .map((word: string) => {\n      if (!word.length) return '';\n      word = fixNonStandardEmoji(word);\n      const emojis = word.match(EMOJI_REGEX);\n      if (emojis && word.startsWith(emojis[0])) {\n        return emojis[0];\n      }\n      return word.match(/./u)![0].toUpperCase();\n    })\n    .join('');\n});\n\nconst FILE_SIZE_UNITS = ['B', 'KB', 'MB', 'GB'];\nexport function formatFileSize(lang: OldLangFn, bytes: number, decimals = 1): string {\n  if (bytes === 0) {\n    return lang('FileSize.B', 0);\n  }\n\n  const k = 1024;\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  const value = (bytes / (k ** i)).toFixed(Math.max(decimals, 0));\n\n  return lang(`FileSize.${FILE_SIZE_UNITS[i]}`, value);\n}\n","import type { ApiPeerColors } from '../api/types';\n\nimport { PEER_COLOR_BG_ACTIVE_OPACITY, PEER_COLOR_BG_OPACITY, PEER_COLOR_GRADIENT_STEP } from '../config';\nimport { fastRaf } from './schedulers';\n\nconst GENERAL_VARIABLES = new Map<string, string>();\nconst LIGHT_VARIABLES = new Map<string, string>();\nconst DARK_VARIABLES = new Map<string, string>();\n\nconst style = document.createElement('style');\ndocument.head.appendChild(style);\n\nexport function setVariable(name: string, generalValue: string): void;\nexport function setVariable(name: string, lightValue: string, darkValue?: string): void;\nexport function setVariable(name: string, lightValueOrGeneral: string, darkValue?: string) {\n  if (!darkValue) {\n    GENERAL_VARIABLES.set(name, lightValueOrGeneral);\n    LIGHT_VARIABLES.delete(name);\n    DARK_VARIABLES.delete(name);\n  } else {\n    GENERAL_VARIABLES.delete(name);\n    LIGHT_VARIABLES.set(name, lightValueOrGeneral);\n    DARK_VARIABLES.set(name, darkValue);\n  }\n\n  scheduleVariableUpdate();\n}\n\nlet isUpdateScheduled = false;\nfunction scheduleVariableUpdate() {\n  if (isUpdateScheduled) return;\n  isUpdateScheduled = true;\n  fastRaf(updateVariables);\n}\n\nfunction updateVariables() {\n  const generalVariables = buildVariables(GENERAL_VARIABLES);\n  const lightVariables = buildVariables(LIGHT_VARIABLES);\n  const darkVariables = buildVariables(DARK_VARIABLES);\n\n  style.textContent = `\n    html {\n      ${generalVariables}\n    }\n\n    html.theme-light {\n      ${lightVariables}\n    }\n\n    html.theme-dark {\n      ${darkVariables}\n    }\n  `;\n}\n\nfunction buildVariables(map: Map<string, string>) {\n  return Array.from(map.entries()).map(([name, value]) => `--${name}: ${value};`).join(' ');\n}\n\nexport function updatePeerColors(\n  peerColors: ApiPeerColors['general'],\n) {\n  setPeerColor('0', ['#D45246']);\n  setPeerColor('1', ['#F68136']);\n  setPeerColor('2', ['#6C61DF']);\n  setPeerColor('3', ['#46BA43']);\n  setPeerColor('4', ['#5CAFFA']);\n  setPeerColor('5', ['#408ACF']);\n  setPeerColor('6', ['#D95574']);\n\n  Object.entries(peerColors).forEach(([key, value]) => {\n    if (!value.colors) return;\n    setPeerColor(key, value.colors, value.darkColors);\n  });\n}\n\nfunction setPeerColor(n: string, colors: string[], darkColors?: string[]) {\n  const mainLightColor = colors[0];\n  const mainDarkColor = darkColors?.[0];\n  if (!mainLightColor) return;\n\n  const lightBgColor = `${mainLightColor}${PEER_COLOR_BG_OPACITY}`;\n  const darkBgColor = mainDarkColor ? `${mainDarkColor}${PEER_COLOR_BG_OPACITY}` : undefined;\n\n  const lightBgActiveColor = `${mainLightColor}${PEER_COLOR_BG_ACTIVE_OPACITY}`;\n  const darkBgActiveColor = mainDarkColor ? `${mainDarkColor}${PEER_COLOR_BG_ACTIVE_OPACITY}` : undefined;\n\n  setVariable(`color-peer-${n}`, mainLightColor, mainDarkColor);\n  setVariable(`color-peer-bg-${n}`, lightBgColor, darkBgColor);\n  setVariable(`color-peer-bg-active-${n}`, lightBgActiveColor, darkBgActiveColor);\n\n  if (colors.length > 1) {\n    const lightGradientColors = colors.map((color, i) => (\n      `${color} ${i * PEER_COLOR_GRADIENT_STEP}px, ${color} ${(i + 1) * PEER_COLOR_GRADIENT_STEP}px`\n    ));\n    const darkGradientColors = darkColors?.map((color, i) => (\n      `${color} ${i * PEER_COLOR_GRADIENT_STEP}px, ${color} ${(i + 1) * PEER_COLOR_GRADIENT_STEP}px`\n    ));\n\n    const lightGradient = `repeating-linear-gradient(-45deg, ${lightGradientColors.join(', ')})`;\n    const darkGradient = darkGradientColors ? `repeating-linear-gradient(-45deg, ${darkGradientColors.join(', ')})`\n      : undefined;\n    setVariable(`color-peer-gradient-${n}`, lightGradient, darkGradient);\n  }\n}\n","import type { ApiThemeParameters } from '../api/types';\n\nexport function extractCurrentThemeParams(): ApiThemeParameters {\n  const style = getComputedStyle(document.documentElement);\n\n  const backgroundColor = getPropertyHexColor(style, '--color-background')!;\n  const secondaryTextColor = getPropertyHexColor(style, '--color-text-secondary')!;\n\n  const bgColor = backgroundColor;\n  const textColor = getPropertyHexColor(style, '--color-text')!;\n  const buttonColor = getPropertyHexColor(style, '--color-primary')!;\n  const buttonTextColor = getPropertyHexColor(style, '--color-white')!;\n  const linkColor = getPropertyHexColor(style, '--color-links')!;\n  const hintColor = secondaryTextColor;\n  const secondaryBgColor = getPropertyHexColor(style, '--color-background-secondary')!;\n  const sectionSeparatorColor = getPropertyHexColor(style, '--color-divider')!;\n\n  const headerBgColor = backgroundColor;\n  const accentTextColor = getPropertyHexColor(style, '--color-primary')!;\n  const sectionBgColor = backgroundColor;\n  const sectionHeaderTextColor = secondaryTextColor;\n  const subtitleTextColor = hintColor;\n  const destructiveTextColor = getPropertyHexColor(style, '--color-error')!;\n\n  return {\n    bg_color: bgColor,\n    text_color: textColor,\n    hint_color: hintColor,\n    link_color: linkColor,\n    button_color: buttonColor,\n    button_text_color: buttonTextColor,\n    secondary_bg_color: secondaryBgColor,\n    header_bg_color: headerBgColor,\n    accent_text_color: accentTextColor,\n    section_bg_color: sectionBgColor,\n    section_header_text_color: sectionHeaderTextColor,\n    subtitle_text_color: subtitleTextColor,\n    destructive_text_color: destructiveTextColor,\n    section_separator_color: sectionSeparatorColor,\n  };\n}\n\nexport function validateHexColor(color: string) {\n  return /^#[0-9A-F]{6}$/i.test(color);\n}\n\nexport function getPropertyHexColor(style: CSSStyleDeclaration, property: string) {\n  const value = style.getPropertyValue(property);\n  if (!value) return undefined;\n  return prepareHexColor(value.trim());\n}\n\nexport function prepareHexColor(color: string) {\n  if (validateHexColor(color)) return color;\n  return `#${color.match(/^rgba?\\((\\d+),\\s*(\\d+),\\s*(\\d+)(?:,\\s*(\\d+\\.{0,1}\\d*))?\\)$/)!\n    .slice(1)\n    .map((n: string, i: number) => (i === 3 ? Math.round(parseFloat(n) * 255) : parseFloat(n))\n      .toString(16)\n      .padStart(2, '0')\n      .replace('NaN', ''))\n    .join('')}`;\n}\n","export default function trimText<T extends string | undefined>(text: T, length?: number) {\n  if (!text || !length || text.length <= length) {\n    return text;\n  }\n\n  return `${text.substring(0, length)}...`;\n}\n","export const MIN_USERNAME_LENGTH = 3; // Some bots have 3-letter usernames\nexport const MIN_UPDATE_USERNAME_LENGTH = 5; // 4 letter usernames are only available on Fragment\nexport const MAX_USERNAME_LENGTH = 32;\nexport const USERNAME_REGEX = /^[a-zA-Z]\\w+$/;\n\nexport function isUsernameValid(username: string, isUpdating?: boolean) {\n  const minUsernameLength = isUpdating ? MIN_UPDATE_USERNAME_LENGTH : MIN_USERNAME_LENGTH;\n  return username.length >= minUsernameLength\n    && username.length <= MAX_USERNAME_LENGTH\n    && USERNAME_REGEX.test(username);\n}\n","import { getGlobal } from '../global';\n\nimport {\n  APP_CODE_NAME,\n  DEBUG, IS_MOCKED_CLIENT,\n} from '../config';\nimport { hasStoredSession } from './sessions';\nimport { IS_ELECTRON } from './windowEnvironment';\n\nconst WEBSYNC_URLS = [\n  't.me',\n  'telegram.me',\n].map((domain) => `https://${domain}/_websync_?`);\nconst WEBSYNC_VERSION = `${APP_VERSION} ${APP_CODE_NAME}`;\nconst WEBSYNC_KEY = 'tgme_sync';\nconst WEBSYNC_TIMEOUT = 86400;\n\nconst getTs = () => {\n  return Math.floor(Number(new Date()) / 1000);\n};\n\nconst saveSync = (authed: boolean) => {\n  const ts = getTs();\n  localStorage.setItem(WEBSYNC_KEY, JSON.stringify({\n    canRedirect: authed,\n    ts,\n  }));\n};\n\nlet lastTimeout: NodeJS.Timeout | undefined;\n\nexport const forceWebsync = (authed: boolean) => {\n  if (IS_MOCKED_CLIENT || IS_ELECTRON) return undefined;\n  const currentTs = getTs();\n\n  const { canRedirect, ts } = JSON.parse(localStorage.getItem(WEBSYNC_KEY) || '{}');\n\n  if (canRedirect !== authed || ts + WEBSYNC_TIMEOUT <= currentTs) {\n    return Promise.all(WEBSYNC_URLS.map((url) => {\n      return new Promise<void>((resolve, reject) => {\n        const script = document.createElement('script');\n\n        const removeElement = () => Boolean(document.body.removeChild(script));\n\n        script.src = url + new URLSearchParams({\n          authed: Number(authed).toString(),\n          version: WEBSYNC_VERSION,\n        });\n\n        document.body.appendChild(script);\n\n        script.onload = () => {\n          saveSync(authed);\n          removeElement();\n          if (lastTimeout) {\n            clearTimeout(lastTimeout);\n            lastTimeout = undefined;\n          }\n          startWebsync();\n          resolve();\n        };\n\n        script.onerror = () => {\n          removeElement();\n          reject();\n        };\n      });\n    }));\n  } else {\n    return Promise.resolve();\n  }\n};\n\nexport function stopWebsync() {\n  if (DEBUG || IS_ELECTRON) return;\n\n  if (lastTimeout) clearTimeout(lastTimeout);\n}\n\nexport function startWebsync() {\n  if (DEBUG || IS_ELECTRON) {\n    return;\n  }\n\n  if (lastTimeout !== undefined) return;\n  const currentTs = getTs();\n\n  const { ts } = JSON.parse(localStorage.getItem(WEBSYNC_KEY) || '{}');\n\n  const timeout = WEBSYNC_TIMEOUT - (currentTs - ts);\n\n  lastTimeout = setTimeout(() => {\n    const { authState } = getGlobal();\n\n    const authed = authState === 'authorizationStateReady' || hasStoredSession();\n    forceWebsync(authed);\n  }, Math.max(0, timeout * 1000));\n}\n\nexport function clearWebsync() {\n  localStorage.removeItem(WEBSYNC_KEY);\n}\n","import { IS_TEST, PRODUCTION_HOSTNAME } from '../config';\n\nexport function getPlatform() {\n  const { userAgent, platform } = window.navigator;\n\n  const iosPlatforms = ['iPhone', 'iPad', 'iPod'];\n  if (\n    iosPlatforms.indexOf(platform) !== -1\n    // For new IPads with M1 chip and IPadOS platform returns \"MacIntel\"\n    || (platform === 'MacIntel' && ('maxTouchPoints' in navigator && navigator.maxTouchPoints > 2))\n  ) return 'iOS';\n\n  const macosPlatforms = ['Macintosh', 'MacIntel', 'MacPPC', 'Mac68K'];\n  if (macosPlatforms.indexOf(platform) !== -1) return 'macOS';\n\n  const windowsPlatforms = ['Win32', 'Win64', 'Windows', 'WinCE'];\n  if (windowsPlatforms.indexOf(platform) !== -1) return 'Windows';\n\n  if (/Android/.test(userAgent)) return 'Android';\n\n  if (/Linux/.test(platform)) return 'Linux';\n\n  return undefined;\n}\n\nexport const IS_PRODUCTION_HOST = window.location.host === PRODUCTION_HOSTNAME;\nexport const PLATFORM_ENV = getPlatform();\nexport const IS_MAC_OS = PLATFORM_ENV === 'macOS';\nexport const IS_WINDOWS = PLATFORM_ENV === 'Windows';\nexport const IS_LINUX = PLATFORM_ENV === 'Linux';\nexport const IS_IOS = PLATFORM_ENV === 'iOS';\nexport const IS_ANDROID = PLATFORM_ENV === 'Android';\nexport const IS_MOBILE = IS_IOS || IS_ANDROID;\nexport const IS_SAFARI = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\nexport const IS_YA_BROWSER = navigator.userAgent.includes('YaBrowser');\nexport const IS_FIREFOX = navigator.userAgent.toLowerCase().includes('firefox')\n  || navigator.userAgent.toLowerCase().includes('iceweasel')\n  || navigator.userAgent.toLowerCase().includes('icecat');\nexport const IS_ELECTRON = Boolean(window.electron);\n\nexport enum MouseButton {\n  Main = 0,\n  Auxiliary = 1,\n  Secondary = 2,\n  Fourth = 3,\n  Fifth = 4,\n}\n\nexport const IS_PWA = (\n  window.matchMedia('(display-mode: standalone)').matches\n  || (window.navigator as any).standalone\n  || document.referrer.includes('android-app://')\n);\n\nexport const IS_APP = IS_PWA || IS_ELECTRON;\n\nexport const IS_TOUCH_ENV = window.matchMedia('(pointer: coarse)').matches;\nexport const IS_VOICE_RECORDING_SUPPORTED = Boolean(\n  window.navigator.mediaDevices && 'getUserMedia' in window.navigator.mediaDevices && (\n    window.AudioContext || (window as any).webkitAudioContext\n  ),\n);\nexport const IS_EMOJI_SUPPORTED = PLATFORM_ENV && (IS_MAC_OS || IS_IOS) && isLastEmojiVersionSupported();\n\nexport const IS_SERVICE_WORKER_SUPPORTED = 'serviceWorker' in navigator;\n\n// Remove in mid-late 2025 when Chromium 132 is no longer a problem\n// https://issues.chromium.org/issues/390581541\nconst chromeVersion = navigator.userAgent.match(/Chrom(e|ium)\\/([0-9]+)\\./)?.[2];\nconst hasBrokenServiceWorkerStreaming = chromeVersion && Number(chromeVersion) === 132;\n// TODO Consider failed service worker\nexport const IS_PROGRESSIVE_SUPPORTED = IS_SERVICE_WORKER_SUPPORTED && !hasBrokenServiceWorkerStreaming;\nexport const IS_OPUS_SUPPORTED = Boolean((new Audio()).canPlayType('audio/ogg; codecs=opus'));\nexport const IS_CANVAS_FILTER_SUPPORTED = (\n  !IS_TEST && 'filter' in (document.createElement('canvas').getContext('2d') || {})\n);\nexport const IS_REQUEST_FULLSCREEN_SUPPORTED = 'requestFullscreen' in document.createElement('div');\nexport const ARE_CALLS_SUPPORTED = !IS_FIREFOX; // https://bugzilla.mozilla.org/show_bug.cgi?id=1923416\nexport const LAYERS_ANIMATION_NAME = IS_ANDROID ? 'slideFade' : IS_IOS ? 'slideLayers' : 'pushSlide';\n\nexport const IS_WAVE_TRANSFORM_SUPPORTED = !IS_MOBILE\n  && !IS_FIREFOX // https://bugzilla.mozilla.org/show_bug.cgi?id=1808785\n  && !IS_SAFARI; // https://bugs.webkit.org/show_bug.cgi?id=245510\nexport const IS_SNAP_EFFECT_SUPPORTED = !IS_MOBILE\n  && !IS_FIREFOX // https://bugzilla.mozilla.org/show_bug.cgi?id=1896504\n  && !IS_SAFARI;\nexport const IS_FLUID_BACKGROUND_SUPPORTED = !IS_FIREFOX;\n\nconst TEST_VIDEO = document.createElement('video');\n\nexport const IS_WEBM_SUPPORTED = Boolean(TEST_VIDEO.canPlayType('video/webm; codecs=\"vp9\"').replace('no', ''));\n\nexport const ARE_WEBCODECS_SUPPORTED = 'VideoDecoder' in window;\n\nexport const MASK_IMAGE_DISABLED = true;\nexport const IS_OPFS_SUPPORTED = Boolean(navigator.storage?.getDirectory);\nif (IS_OPFS_SUPPORTED) {\n  // Clear old contents\n  (async () => {\n    try {\n      const directory = await navigator.storage.getDirectory();\n      await directory.removeEntry('downloads', { recursive: true });\n    } catch {\n      // Ignore\n    }\n  })();\n}\n\nexport const IS_OFFSET_PATH_SUPPORTED = CSS.supports('offset-rotate: 0deg');\nexport const IS_BACKDROP_BLUR_SUPPORTED = CSS.supports('backdrop-filter: blur()')\n  || CSS.supports('-webkit-backdrop-filter: blur()');\nexport const IS_INSTALL_PROMPT_SUPPORTED = 'onbeforeinstallprompt' in window;\nexport const IS_MULTITAB_SUPPORTED = 'BroadcastChannel' in window;\nexport const IS_OPEN_IN_NEW_TAB_SUPPORTED = IS_MULTITAB_SUPPORTED && !(IS_PWA && IS_MOBILE);\nexport const IS_TRANSLATION_SUPPORTED = !IS_TEST;\nexport const IS_INTL_LIST_FORMAT_SUPPORTED = 'ListFormat' in Intl;\nexport const IS_VIEW_TRANSITION_SUPPORTED = 'ViewTransition' in window;\n\nexport const IS_BAD_URL_PARSER = new URL('tg://host').host !== 'host';\n\nexport const MESSAGE_LIST_SENSITIVE_AREA = 750;\n\nexport const SCROLLBAR_WIDTH = (() => {\n  const el = document.createElement('div');\n  el.style.cssText = 'overflow:scroll; visibility:hidden; position:absolute;';\n  el.classList.add('custom-scroll');\n  document.body.appendChild(el);\n  const width = el.offsetWidth - el.clientWidth;\n  el.remove();\n\n  document.documentElement.style.setProperty('--scrollbar-width', `${width}px`);\n\n  return width;\n})();\n\nexport const MAX_BUFFER_SIZE = (IS_MOBILE ? 512 : 2000) * 1024 ** 2; // 512 OR 2000 MB\n\nfunction isLastEmojiVersionSupported() {\n  const ALLOWABLE_CALCULATION_ERROR_SIZE = 5;\n  const inlineEl = document.createElement('span');\n  inlineEl.classList.add('emoji-test-element');\n  document.body.appendChild(inlineEl);\n\n  inlineEl.innerText = '🐦‍🔥'; // Emoji from 15.1 version\n  const newEmojiWidth = inlineEl.offsetWidth;\n  inlineEl.innerText = '❤️'; // Emoji from 1.0 version\n  const legacyEmojiWidth = inlineEl.offsetWidth;\n\n  document.body.removeChild(inlineEl);\n\n  return Math.abs(newEmojiWidth - legacyEmojiWidth) < ALLOWABLE_CALCULATION_ERROR_SIZE;\n}\n\nexport const IS_GEOLOCATION_SUPPORTED = 'geolocation' in navigator;\n\nexport const getGeolocationStatus = async () => {\n  try {\n    const permissionStatus = await navigator.permissions.query({ name: 'geolocation' });\n\n    if (permissionStatus.state === 'granted' || permissionStatus.state === 'prompt') {\n      const geolocation = await new Promise<GeolocationCoordinates>((resolve, reject) => {\n        navigator.geolocation.getCurrentPosition(\n          (position) => resolve(position.coords),\n          (error) => reject(error),\n        );\n      });\n      return { accessRequested: true, accessGranted: true, geolocation };\n    }\n    if (permissionStatus.state === 'denied') {\n      return { accessRequested: true, accessGranted: false };\n    }\n  } catch (error) {\n    return { accessRequested: false, accessGranted: false };\n  }\n\n  return { accessRequested: false, accessGranted: false };\n};\n","import type { IDimensions } from '../types';\n\nimport { requestMutation } from '../lib/fasterdom/fasterdom';\nimport { throttle } from './schedulers';\nimport { IS_IOS } from './windowEnvironment';\n\nconst WINDOW_ORIENTATION_CHANGE_THROTTLE_MS = 100;\nconst WINDOW_RESIZE_THROTTLE_MS = 250;\n\nlet initialHeight = window.innerHeight;\nlet currentWindowSize = updateSizes();\n\nconst handleResize = throttle(() => {\n  currentWindowSize = updateSizes();\n}, WINDOW_RESIZE_THROTTLE_MS, true);\n\nconst handleOrientationChange = throttle(() => {\n  initialHeight = window.innerHeight;\n  handleResize();\n}, WINDOW_ORIENTATION_CHANGE_THROTTLE_MS, false);\n\nwindow.addEventListener('orientationchange', handleOrientationChange);\nif (IS_IOS) {\n  window.visualViewport!.addEventListener('resize', handleResize);\n} else {\n  window.addEventListener('resize', handleResize);\n}\n\nexport function updateSizes(): IDimensions {\n  let height: number;\n  if (IS_IOS) {\n    height = window.visualViewport!.height + window.visualViewport!.pageTop;\n  } else {\n    height = window.innerHeight;\n  }\n\n  requestMutation(() => {\n    const vh = height * 0.01;\n    document.documentElement.style.setProperty('--vh', `${vh}px`);\n  });\n\n  return {\n    width: window.innerWidth,\n    height: window.innerHeight,\n  };\n}\n\nconst windowSize = {\n  get: () => currentWindowSize,\n  getIsKeyboardVisible: () => initialHeight > currentWindowSize.height,\n};\n\nexport default windowSize;\n","const cache = new WeakMap<AnyFunction, Map<string, any>>();\n\nexport default function withCache<T extends AnyFunction>(fn: T) {\n  return (...args: Parameters<T>): ReturnType<T> => {\n    let fnCache = cache.get(fn);\n    const cacheKey = args.map(String).join('_');\n\n    if (fnCache) {\n      const cached = fnCache.get(cacheKey);\n      if (cached) {\n        return cached;\n      }\n    } else {\n      fnCache = new Map();\n      cache.set(fn, fnCache);\n    }\n\n    const newValue = fn(...args);\n\n    fnCache.set(cacheKey, newValue);\n\n    return newValue;\n  };\n}\n","// extracted by mini-css-extract-plugin\nexport default {\"root\":\"W4ndaFuS\",\"contentBox\":\"qIESjPFU\",\"textContent\":\"cgQoy2xy\",\"hasFullContent\":\"x0D811xX\",\"inlineWrapper\":\"CrZTrncJ\",\"singleLine\":\"j1bGIpWD\",\"strong\":\"d5ep97lr\",\"messageLink\":\"Soqky8rY\",\"contextContainer\":\"Rz1leKMF\",\"fluidMultiline\":\"oL3NoM4Y\",\"fluidBackground\":\"faqkTF52\",\"info\":\"Jcta1qBG\",\"stickerWrapper\":\"F8w9vDlr\",\"channelPhoto\":\"wnjg6GZj\",\"suggestedAvatar\":\"ClHX4zX1\",\"suggestedText\":\"jT6o01vL\",\"actionButton\":\"LB5i9s3a\",\"title\":\"Cp_BJqe5\",\"subtitle\":\"VCJyqpS8\",\"starGift\":\"lcncBNHa\",\"uniqueGift\":\"jxcv_A2w\",\"uniqueBackgroundWrapper\":\"lsTgPDw1\",\"uniqueBackground\":\"uzTnIOE7\",\"uniqueValue\":\"pae10ItJ\"};","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = (chunkId) => {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce((promises, key) => {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks\n__webpack_require__.u = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + chunkId + \".\" + {\"26\":\"c6aa48f26cf2c480ba22\",\"59\":\"cd45091cb5c130745405\",\"61\":\"36c66587faab069a921b\",\"69\":\"a6db53a4f00742fd1462\",\"90\":\"f7637ad4b6d9882054f9\",\"103\":\"06562548b3fda65effcc\",\"194\":\"c1f5ffb04238d98d648b\",\"244\":\"1774aa2e7bcb7144d884\",\"304\":\"48b0b40adff5d3e137ef\",\"313\":\"0f4bc4fa205668ed808c\",\"356\":\"1bc44e46652fa5288bf8\",\"373\":\"75fdc0ccff654eeecb30\",\"387\":\"81529401c679841b397b\",\"400\":\"a47601ed4b358f8abbb5\",\"405\":\"d66329eb14453a8b3d34\",\"409\":\"0fd7b0b4fa794dd68108\",\"433\":\"ad060437ffb6916a9321\",\"453\":\"28c197282b5d28a55117\",\"482\":\"f539aab19c85ff61ce44\",\"562\":\"08644faea2a11dc03715\",\"564\":\"d622f298de832ee1c2f8\",\"633\":\"0c008db6ee63daf3e6e9\",\"641\":\"164761f4ccf9a75f69a7\",\"676\":\"575fa56db35097bc4a32\",\"683\":\"eaf2b99781f1220c4b86\",\"695\":\"f0a5c6ee6dd921565497\",\"768\":\"f5aea4b0692ec4ad998e\",\"835\":\"e84d44ebdf9dd2ae222c\",\"947\":\"58aaed90385beda86fce\",\"970\":\"7044f00deb7b3fdc1ab5\",\"996\":\"9460a03c6edee870f315\",\"1022\":\"10e6de63c64b3b9a18af\",\"1095\":\"95cc2d575059e9f6054f\",\"1105\":\"82a58e981ea92040fe89\",\"1164\":\"ce743c2bcc23d3043fe9\",\"1168\":\"456d17d716ba7e4d4ec5\",\"1184\":\"0e4d0ce897fcb11461d9\",\"1215\":\"e157a49d04b225308f77\",\"1348\":\"f655ca346b82779f07c5\",\"1387\":\"394c9143713a7fd68235\",\"1401\":\"5b095c8c14e292f91887\",\"1465\":\"acaade6ed215d80122fa\",\"1516\":\"91af49804dee1af8631e\",\"1575\":\"e5726d1c745dcc9873f2\",\"1586\":\"d55ded8aa155fbd69470\",\"1620\":\"8c85ba900a4207ce4da9\",\"1644\":\"04559fdbf95cc570aea3\",\"1692\":\"66caee8054d626d59d48\",\"1700\":\"dd59d0dbdf3ef22443b3\",\"1775\":\"8b47df32db7309502f49\",\"1780\":\"f39d3ff745c63d496160\",\"1877\":\"13c44f38e27f297965ef\",\"2012\":\"7840eb9e814692fc48e3\",\"2049\":\"65ad02e0f79f40733484\",\"2057\":\"114033549ec88321349c\",\"2118\":\"4d5cef94fa94e132add7\",\"2158\":\"a6754dbfe1f8d591a114\",\"2164\":\"e492657dac2eb724da50\",\"2225\":\"aadcce9013263158a5df\",\"2230\":\"3a602927b9e118113ffa\",\"2356\":\"62885c482aa05268a204\",\"2394\":\"3c7efedc5d20d83af7d4\",\"2440\":\"e89152702b001cdd81aa\",\"2448\":\"da0e561a2055927d551f\",\"2498\":\"94264e7f6126aa416ec1\",\"2651\":\"60007143ecc35556d2be\",\"2670\":\"9e12093c5acef62f3f98\",\"2729\":\"0065c8652592670fe035\",\"2800\":\"fe61871efd4cf024ed73\",\"2801\":\"218e3e05568344bfc382\",\"2856\":\"2ad12ce521ce05aaeb25\",\"2857\":\"e46d806152d3634a3af0\",\"2859\":\"6cb173d9eb92083a8051\",\"2916\":\"30141131c0e95e8b9171\",\"2990\":\"544b6eac560aef426853\",\"3080\":\"15f4cdecf7bd92fd8cd7\",\"3325\":\"4d3c50092b95852e606d\",\"3363\":\"d0e8f9c9ad9af93e091f\",\"3405\":\"bf0efec17f73eea62691\",\"3499\":\"fb9028f6a91578dbeb7e\",\"3524\":\"e86bdc871cc7d384bb9f\",\"3564\":\"e1d4da9993f41f931d4a\",\"3715\":\"b369e2fb06fef4e03112\",\"3731\":\"4c3ad0d715104f8c9a90\",\"3745\":\"70fa1408b56b531c8b70\",\"3747\":\"9d65fbf6607c2639f1ac\",\"3787\":\"738b7fcddf703bfdba93\",\"3813\":\"322d1f0835139c813fc2\",\"3906\":\"20c0ac801cb25871d36d\",\"3981\":\"7181a4ce1bc076373789\",\"4008\":\"59b7339e18feff0fcf48\",\"4019\":\"5436e42f5f05697217c5\",\"4020\":\"7fd110ec1a610079e678\",\"4102\":\"6d3f605113d2ca62c370\",\"4128\":\"932954ee591c37fcab93\",\"4134\":\"71cfa5405de2ba0d28f9\",\"4180\":\"9be92536a6ec7980a981\",\"4204\":\"9b422b9bac0e923d0800\",\"4230\":\"fa2f1dbe863bef3e5337\",\"4326\":\"344ecd11d90386e0b584\",\"4336\":\"a6113c3827c4e53ba062\",\"4383\":\"108071f9a50471133448\",\"4435\":\"303678ebd6d3a95a6ad0\",\"4448\":\"6d46b3fccdf6fdc05fbd\",\"4484\":\"697013986f9f8314725b\",\"4550\":\"79ec4a71200382a8bb30\",\"4765\":\"180ce66c8229abf270be\",\"4785\":\"ee250366df8843a67094\",\"4903\":\"7b2461fbeeed521475dc\",\"4917\":\"451a5721d4c10bda0cef\",\"4940\":\"d4766f8c482b18850eb3\",\"5032\":\"c2d32c817b8fcd096923\",\"5046\":\"cae7eb2c1eb178edb5cb\",\"5073\":\"b7b27ed7a495221c6f61\",\"5116\":\"7e3a6f36b5b79abb782a\",\"5148\":\"e9ddaa9b7e6d1b5c2689\",\"5193\":\"277e1fb9e38cc39cf421\",\"5246\":\"f6aacfbe9ae9257098d1\",\"5260\":\"963906e0cff8dcb3a5f2\",\"5269\":\"cb8357f44d3e42279470\",\"5284\":\"11f42fb17acfdc0fd04a\",\"5336\":\"7c49be58112e63514c13\",\"5345\":\"323a678ecb6d1df232ca\",\"5361\":\"b67441dffa58f8924636\",\"5429\":\"7a4bdbe76dc672994511\",\"5434\":\"9f2b0084773cc370a809\",\"5438\":\"60c9f65511b76d590655\",\"5499\":\"13cb3031a94ce4aaa036\",\"5525\":\"8cefdbd7798ac454e0d4\",\"5628\":\"404c65b7e2448f632b03\",\"5719\":\"fd58667cc73b93bde774\",\"5735\":\"31b6059ae6ea6bfde1ee\",\"5819\":\"59e9c49233dabd77f9df\",\"5962\":\"ede17865912f35b1a90f\",\"6047\":\"56c21fd26028a86e4eeb\",\"6058\":\"30cefd831f035595b5d0\",\"6167\":\"b42a04fdc12fb4b4a4aa\",\"6168\":\"ada3094042ebc5125641\",\"6241\":\"33e68803b77e2df83262\",\"6265\":\"c6c542183797c639fc12\",\"6272\":\"b25825eb9cace64817d5\",\"6308\":\"fc757fb049f7befef6c5\",\"6338\":\"b7431caf1d83069b35a0\",\"6441\":\"596e674263fc662c6563\",\"6442\":\"61a6ce48a2c67daada31\",\"6473\":\"504b8bde338f548d384e\",\"6685\":\"d3f3addf37c9d0774537\",\"6686\":\"78266345eeede412e9b8\",\"6708\":\"7c7ced3866c04adf95b0\",\"6726\":\"738df768f67f2b3ae4e7\",\"6802\":\"c56f82fa0a9d57ab7e5f\",\"6827\":\"f9dabc7d712e3f363fd8\",\"6860\":\"7724ac0b43a96ee6e42c\",\"6869\":\"fd1804ea75e26a748a15\",\"6930\":\"1673a7c82f2edcd83d2d\",\"6947\":\"4089f0e6e5cacb406a13\",\"7001\":\"edd8f550449c6534ea87\",\"7120\":\"4351a393dfb081ce0d24\",\"7244\":\"c74333bf67d0d0e5f0b7\",\"7276\":\"30fdb090c835b9699945\",\"7283\":\"fffaae54cb7b28e809f3\",\"7357\":\"cb6f3aabbdaa5f7b258b\",\"7405\":\"dae81782a14890385b48\",\"7424\":\"920b4bb14b7ef164f6ea\",\"7487\":\"f99a7245241b40c68b5a\",\"7499\":\"b71077d766e8046190f9\",\"7561\":\"1665e25dd14333ec9826\",\"7586\":\"77f6f39b7a4e6f37ed3f\",\"7594\":\"5628b088a8023fd67b16\",\"7612\":\"6c8ab8862b830976b5db\",\"7617\":\"34d0c937e4603648722e\",\"7643\":\"4a0415a020164e1d66ce\",\"7688\":\"f95d71b512dcd8a147b1\",\"7738\":\"0dc02b731f56895b7357\",\"7768\":\"d962ee2e41b27723707c\",\"7854\":\"7be62b41cdba936c60e4\",\"7880\":\"68b59de98783ddb9efe1\",\"7901\":\"4aadbe5fa9ab2c7611da\",\"7939\":\"2813aac25a1b171b9989\",\"7972\":\"678efa36d93c19ed26e7\",\"7978\":\"212c9932786ab38c4554\",\"8043\":\"21401193a3b398303cb2\",\"8062\":\"ebd3ad90c39cc5e25350\",\"8100\":\"bd041507440eee866dc6\",\"8114\":\"c9802556b70ecf3759ff\",\"8142\":\"81da796ad6faa53a5d68\",\"8150\":\"0ba591eb0c58e1fdb970\",\"8169\":\"532cb82eb3a3a8271112\",\"8201\":\"c49763b6fd5c4015d0f2\",\"8213\":\"e581afc854c202a6b6fb\",\"8214\":\"3f3aaca4fffbb683fc2f\",\"8233\":\"ae517c59765c3b7bce41\",\"8308\":\"da1f7667512be214d174\",\"8349\":\"775185f0387e663c5027\",\"8393\":\"db6445b7c7e7f2fb5e93\",\"8590\":\"cf975040964a340ab445\",\"8602\":\"c402ccf8ff9e705db27d\",\"8804\":\"f84ae4c11366a3801534\",\"8843\":\"6d23d4789571778235b2\",\"8924\":\"d08e780338c62690dbf5\",\"8980\":\"fec0192ca5989767fd0c\",\"9004\":\"e7575d29ea537f158935\",\"9030\":\"1f951cbe1fc3eed05dbe\",\"9072\":\"39603f8ff791f6826f87\",\"9141\":\"1085becfec856ba7da56\",\"9183\":\"d41c104abc24b4ac62f9\",\"9238\":\"bff8dd1dc0e66d5d0a90\",\"9250\":\"e581647d2044927ff610\",\"9287\":\"cf23b13bca02aebb5369\",\"9295\":\"a6b850b7b7099199fa9c\",\"9359\":\"5f9ee572512a6fae40ed\",\"9375\":\"d7efd3e904f1ac293240\",\"9451\":\"348b9891a5d592e60a1b\",\"9549\":\"9a06199a86d29568470b\",\"9623\":\"fdf70ce01a3b6098d93c\",\"9677\":\"a7ac09b5833e5c014541\",\"9710\":\"9b76a0cb719752bfb867\",\"9722\":\"8b761ac80ffc8b383d90\",\"9753\":\"10215189de20ab980550\",\"9761\":\"62397d08b14e4d5fd188\",\"9849\":\"90f9bfd38c2507007b51\",\"9869\":\"543fec634f8285cd1377\",\"9998\":\"987bf83d84b82dcc5e6d\"}[chunkId] + \".js\";\n};","// This function allow to reference async chunks\n__webpack_require__.miniCssF = (chunkId) => {\n\t// return url for filenames based on template\n\treturn \"\" + ({\"2394\":\"BundleCalls\",\"4765\":\"shared-components\",\"6930\":\"BundleStars\",\"7405\":\"BundleAuth\",\"7768\":\"BundleMain\",\"9451\":\"BundleExtra\"}[chunkId] || chunkId) + \".\" + {\"1184\":\"0e4d0ce897fcb11461d9\",\"1644\":\"04559fdbf95cc570aea3\",\"2356\":\"62885c482aa05268a204\",\"2394\":\"3c7efedc5d20d83af7d4\",\"4765\":\"180ce66c8229abf270be\",\"6930\":\"1673a7c82f2edcd83d2d\",\"7405\":\"dae81782a14890385b48\",\"7643\":\"4a0415a020164e1d66ce\",\"7768\":\"d962ee2e41b27723707c\",\"9451\":\"348b9891a5d592e60a1b\"}[chunkId] + \".css\";\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var scriptUrl;\nif (__webpack_require__.g.importScripts) scriptUrl = __webpack_require__.g.location + \"\";\nvar document = __webpack_require__.g.document;\nif (!scriptUrl && document) {\n\tif (document.currentScript)\n\t\tscriptUrl = document.currentScript.src;\n\tif (!scriptUrl) {\n\t\tvar scripts = document.getElementsByTagName(\"script\");\n\t\tif(scripts.length) {\n\t\t\tvar i = scripts.length - 1;\n\t\t\twhile (i > -1 && (!scriptUrl || !/^http(s?):/.test(scriptUrl))) scriptUrl = scripts[i--].src;\n\t\t}\n\t}\n}\n// When supporting browsers where an automatic publicPath is not supported you must specify an output.publicPath manually via configuration\n// or pass an empty string (\"\") and set the __webpack_public_path__ variable from your code to use your own logic.\nif (!scriptUrl) throw new Error(\"Automatic publicPath is not supported in this browser\");\nscriptUrl = scriptUrl.replace(/#.*$/, \"\").replace(/\\?.*$/, \"\").replace(/\\/[^\\/]+$/, \"/\");\n__webpack_require__.p = scriptUrl;","if (typeof document === \"undefined\") return;\nvar createStylesheet = (chunkId, fullhref, oldTag, resolve, reject) => {\n\tvar linkTag = document.createElement(\"link\");\n\n\tlinkTag.rel = \"stylesheet\";\n\tlinkTag.type = \"text/css\";\n\tif (__webpack_require__.nc) {\n\t\tlinkTag.nonce = __webpack_require__.nc;\n\t}\n\tvar onLinkComplete = (event) => {\n\t\t// avoid mem leaks.\n\t\tlinkTag.onerror = linkTag.onload = null;\n\t\tif (event.type === 'load') {\n\t\t\tresolve();\n\t\t} else {\n\t\t\tvar errorType = event && event.type;\n\t\t\tvar realHref = event && event.target && event.target.href || fullhref;\n\t\t\tvar err = new Error(\"Loading CSS chunk \" + chunkId + \" failed.\\n(\" + errorType + \": \" + realHref + \")\");\n\t\t\terr.name = \"ChunkLoadError\";\n\t\t\terr.code = \"CSS_CHUNK_LOAD_FAILED\";\n\t\t\terr.type = errorType;\n\t\t\terr.request = realHref;\n\t\t\tif (linkTag.parentNode) linkTag.parentNode.removeChild(linkTag)\n\t\t\treject(err);\n\t\t}\n\t}\n\tlinkTag.onerror = linkTag.onload = onLinkComplete;\n\tlinkTag.href = fullhref;\n\n\n\tif (oldTag) {\n\t\toldTag.parentNode.insertBefore(linkTag, oldTag.nextSibling);\n\t} else {\n\t\tdocument.head.appendChild(linkTag);\n\t}\n\treturn linkTag;\n};\nvar findStylesheet = (href, fullhref) => {\n\tvar existingLinkTags = document.getElementsByTagName(\"link\");\n\tfor(var i = 0; i < existingLinkTags.length; i++) {\n\t\tvar tag = existingLinkTags[i];\n\t\tvar dataHref = tag.getAttribute(\"data-href\") || tag.getAttribute(\"href\");\n\t\tif(tag.rel === \"stylesheet\" && (dataHref === href || dataHref === fullhref)) return tag;\n\t}\n\tvar existingStyleTags = document.getElementsByTagName(\"style\");\n\tfor(var i = 0; i < existingStyleTags.length; i++) {\n\t\tvar tag = existingStyleTags[i];\n\t\tvar dataHref = tag.getAttribute(\"data-href\");\n\t\tif(dataHref === href || dataHref === fullhref) return tag;\n\t}\n};\nvar loadStylesheet = (chunkId) => {\n\treturn new Promise((resolve, reject) => {\n\t\tvar href = __webpack_require__.miniCssF(chunkId);\n\t\tvar fullhref = __webpack_require__.p + href;\n\t\tif(findStylesheet(href, fullhref)) return resolve();\n\t\tcreateStylesheet(chunkId, fullhref, null, resolve, reject);\n\t});\n}\n// object to store loaded CSS chunks\nvar installedCssChunks = {\n\t8792: 0\n};\n\n__webpack_require__.f.miniCss = (chunkId, promises) => {\n\tvar cssChunks = {\"1184\":1,\"1644\":1,\"2356\":1,\"2394\":1,\"4765\":1,\"6930\":1,\"7405\":1,\"7643\":1,\"7768\":1,\"9451\":1};\n\tif(installedCssChunks[chunkId]) promises.push(installedCssChunks[chunkId]);\n\telse if(installedCssChunks[chunkId] !== 0 && cssChunks[chunkId]) {\n\t\tpromises.push(installedCssChunks[chunkId] = loadStylesheet(chunkId).then(() => {\n\t\t\tinstalledCssChunks[chunkId] = 0;\n\t\t}, (e) => {\n\t\t\tdelete installedCssChunks[chunkId];\n\t\t\tthrow e;\n\t\t}));\n\t}\n};\n\n// no hmr\n\n// no prefetching\n\n// no preloaded","__webpack_require__.b = document.baseURI || self.location.href;\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t8792: 0\n};\n\n__webpack_require__.f.j = (chunkId, promises) => {\n\t\t// JSONP chunk loading for javascript\n\t\tvar installedChunkData = __webpack_require__.o(installedChunks, chunkId) ? installedChunks[chunkId] : undefined;\n\t\tif(installedChunkData !== 0) { // 0 means \"already installed\".\n\n\t\t\t// a Promise means \"currently loading\".\n\t\t\tif(installedChunkData) {\n\t\t\t\tpromises.push(installedChunkData[2]);\n\t\t\t} else {\n\t\t\t\tif(true) { // all chunks have JS\n\t\t\t\t\t// setup Promise in chunk cache\n\t\t\t\t\tvar promise = new Promise((resolve, reject) => (installedChunkData = installedChunks[chunkId] = [resolve, reject]));\n\t\t\t\t\tpromises.push(installedChunkData[2] = promise);\n\n\t\t\t\t\t// start chunk loading\n\t\t\t\t\tvar url = __webpack_require__.p + __webpack_require__.u(chunkId);\n\t\t\t\t\t// create error before stack unwound to get useful stacktrace later\n\t\t\t\t\tvar error = new Error();\n\t\t\t\t\tvar loadingEnded = (event) => {\n\t\t\t\t\t\tif(__webpack_require__.o(installedChunks, chunkId)) {\n\t\t\t\t\t\t\tinstalledChunkData = installedChunks[chunkId];\n\t\t\t\t\t\t\tif(installedChunkData !== 0) installedChunks[chunkId] = undefined;\n\t\t\t\t\t\t\tif(installedChunkData) {\n\t\t\t\t\t\t\t\tvar errorType = event && (event.type === 'load' ? 'missing' : event.type);\n\t\t\t\t\t\t\t\tvar realSrc = event && event.target && event.target.src;\n\t\t\t\t\t\t\t\terror.message = 'Loading chunk ' + chunkId + ' failed.\\n(' + errorType + ': ' + realSrc + ')';\n\t\t\t\t\t\t\t\terror.name = 'ChunkLoadError';\n\t\t\t\t\t\t\t\terror.type = errorType;\n\t\t\t\t\t\t\t\terror.request = realSrc;\n\t\t\t\t\t\t\t\tinstalledChunkData[1](error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\t__webpack_require__.l(url, loadingEnded, \"chunk-\" + chunkId, chunkId);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n};\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunktelegram_t\"] = self[\"webpackChunktelegram_t\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","import { getActions } from '../global';\n\nimport { DEBUG, DEBUG_MORE, IS_TEST } from '../config';\nimport { formatShareText } from './deeplink';\nimport { validateFiles } from './files';\nimport { notifyClientReady, playNotifySoundDebounced } from './notifications';\nimport { IS_ANDROID, IS_IOS, IS_SERVICE_WORKER_SUPPORTED } from './windowEnvironment';\n\ntype WorkerAction = {\n  type: string;\n  payload: Record<string, any>;\n};\n\nconst IGNORE_WORKER_PATH = '/k/';\n\nfunction handleWorkerMessage(e: MessageEvent) {\n  const action: WorkerAction = e.data;\n  if (DEBUG_MORE) {\n    // eslint-disable-next-line no-console\n    console.log('[SW] Message from worker', action);\n  }\n  if (!action.type) return;\n  const dispatch = getActions();\n  const payload = action.payload;\n  switch (action.type) {\n    case 'focusMessage':\n      dispatch.focusMessage?.(payload as any);\n      break;\n    case 'playNotificationSound':\n      playNotifySoundDebounced(action.payload.id);\n      break;\n    case 'share':\n      dispatch.openChatWithDraft({\n        text: formatShareText(payload.url, payload.text, payload.title),\n        files: validateFiles(payload.files),\n      });\n      break;\n  }\n}\n\nfunction subscribeToWorker() {\n  navigator.serviceWorker.removeEventListener('message', handleWorkerMessage);\n  navigator.serviceWorker.addEventListener('message', handleWorkerMessage);\n  // Notify web worker that client is ready to receive messages\n  notifyClientReady();\n}\n\nif (IS_SERVICE_WORKER_SUPPORTED) {\n  window.addEventListener('load', async () => {\n    try {\n      const controller = navigator.serviceWorker.controller;\n      if (!controller || controller.scriptURL.includes(IGNORE_WORKER_PATH)) {\n        const registrations = await navigator.serviceWorker.getRegistrations();\n        const ourRegistrations = registrations.filter((r) => !r.scope.includes(IGNORE_WORKER_PATH));\n        if (ourRegistrations.length) {\n          if (DEBUG) {\n            // eslint-disable-next-line no-console\n            console.log('[SW] Hard reload detected, re-enabling Service Worker');\n          }\n          await Promise.all(ourRegistrations.map((r) => r.unregister()));\n        }\n      }\n\n      await navigator.serviceWorker.register(new URL('../serviceWorker', import.meta.url));\n\n      if (DEBUG) {\n        // eslint-disable-next-line no-console\n        console.log('[SW] ServiceWorker registered');\n      }\n\n      await navigator.serviceWorker.ready;\n\n      // Wait for registration to be available\n      await navigator.serviceWorker.getRegistration();\n\n      if (navigator.serviceWorker.controller) {\n        if (DEBUG) {\n          // eslint-disable-next-line no-console\n          console.log('[SW] ServiceWorker ready');\n        }\n        subscribeToWorker();\n      } else {\n        if (DEBUG) {\n          // eslint-disable-next-line no-console\n          console.error('[SW] ServiceWorker not available');\n        }\n\n        if (!IS_IOS && !IS_ANDROID && !IS_TEST) {\n          getActions().showDialog?.({ data: { message: 'SERVICE_WORKER_DISABLED', hasErrorKey: true } });\n        }\n      }\n    } catch (err) {\n      if (DEBUG) {\n        // eslint-disable-next-line no-console\n        console.error('[SW] ServiceWorker registration failed: ', err);\n      }\n    }\n  });\n  window.addEventListener('focus', async () => {\n    await navigator.serviceWorker.ready;\n    subscribeToWorker();\n  });\n}\n","import { addCallback } from '../lib/teact/teactn';\n\nimport type { GlobalState } from './types';\n\nimport { getServerTime } from '../util/serverTime';\nimport { removePeerStory } from './reducers';\nimport { selectTabState } from './selectors';\nimport { getGlobal, setGlobal } from '.';\n\nconst STORY_EXPIRATION_INTERVAL = 2 * 60 * 1000; // 2 min\n\nlet intervals: number[] = [];\n\nlet prevGlobal: GlobalState | undefined;\n\naddCallback((global: GlobalState) => {\n  const previousGlobal = prevGlobal;\n  prevGlobal = global;\n\n  const isCurrentMaster = selectTabState(global)?.isMasterTab;\n  const isPreviousMaster = previousGlobal && selectTabState(previousGlobal)?.isMasterTab;\n  if (isCurrentMaster === isPreviousMaster) return;\n\n  if (isCurrentMaster && !isPreviousMaster) {\n    startIntervals();\n  } else {\n    stopIntervals();\n  }\n});\n\nfunction startIntervals() {\n  if (intervals.length) return;\n  intervals.push(window.setInterval(checkStoryExpiration, STORY_EXPIRATION_INTERVAL));\n}\n\nfunction stopIntervals() {\n  intervals.forEach((interval) => clearInterval(interval));\n  intervals = [];\n}\n\nfunction checkStoryExpiration() {\n  // eslint-disable-next-line eslint-multitab-tt/no-immediate-global\n  let global = getGlobal();\n  if (!global.isInited) return;\n\n  const serverTime = getServerTime();\n\n  Object.values(global.stories.byPeerId).forEach((peerStories) => {\n    const stories = Object.values(peerStories.byId);\n    stories.forEach((story) => {\n      if (!('expireDate' in story)) return;\n      if (story.expireDate > serverTime) return;\n      if ('isInProfile' in story && story.isInProfile) return;\n      if ('isPublic' in story && !story.isPublic) return;\n\n      global = removePeerStory(global, story.peerId, story.id);\n    });\n  });\n\n  setGlobal(global);\n}\n","import type { GlobalState } from '../global/types';\n\nimport { IS_MOCKED_CLIENT } from '../config';\nimport { loadCache } from '../global/cache';\nimport {\n  getGlobal, setGlobal,\n} from '../global/index';\nimport { INITIAL_GLOBAL_STATE } from '../global/initialState';\nimport { updatePasscodeSettings } from '../global/reducers';\nimport { cloneDeep } from './iteratees';\nimport { clearStoredSession } from './sessions';\n\nexport async function initGlobal(force: boolean = false, prevGlobal?: GlobalState) {\n  prevGlobal = prevGlobal || getGlobal();\n  if (!force && 'byTabId' in prevGlobal) {\n    return;\n  }\n\n  const initial = cloneDeep(INITIAL_GLOBAL_STATE);\n  let global = await loadCache(initial) || initial;\n  if (IS_MOCKED_CLIENT) global.authState = 'authorizationStateReady';\n\n  const { hasPasscode, isScreenLocked } = global.passcode;\n  if (hasPasscode && !isScreenLocked) {\n    global = updatePasscodeSettings(global, {\n      isScreenLocked: true,\n    });\n\n    clearStoredSession();\n  }\n\n  if (force) {\n    global.byTabId = prevGlobal.byTabId;\n\n    // Keep the theme if it was set before\n    global.settings.byKey.theme = prevGlobal.settings.byKey.theme;\n  }\n\n  setGlobal(global);\n}\n","import './intervals';\n\nimport type { ActionReturnType, GlobalState } from './types';\n\nimport { isCacheApiSupported } from '../util/cacheApi';\nimport { getCurrentTabId, reestablishMasterToSelf } from '../util/establishMultitabRole';\nimport { initGlobal } from '../util/init';\nimport { cloneDeep } from '../util/iteratees';\nimport { isLocalMessageId } from '../util/keys/messageKey';\nimport { Bundles, loadBundle } from '../util/moduleLoader';\nimport { parseLocationHash } from '../util/routing';\nimport { updatePeerColors } from '../util/theme';\nimport { IS_MULTITAB_SUPPORTED } from '../util/windowEnvironment';\nimport { initializeChatMediaSearchResults } from './reducers/middleSearch';\nimport { updateTabState } from './reducers/tabs';\nimport { initCache } from './cache';\nimport {\n  addActionHandler, getGlobal, setGlobal,\n} from './index';\nimport { INITIAL_TAB_STATE } from './initialState';\nimport { replaceTabThreadParam, replaceThreadParam } from './reducers';\nimport { selectTabState, selectThreadParam } from './selectors';\n\ninitCache();\n\naddActionHandler('initShared', async (prevGlobal, actions, payload): Promise<void> => {\n  const { force } = payload || {};\n  await initGlobal(force, prevGlobal);\n});\n\naddActionHandler('init', (global, actions, payload): ActionReturnType => {\n  const { tabId = getCurrentTabId(), isMasterTab } = payload || {};\n\n  const initialTabState = cloneDeep(INITIAL_TAB_STATE);\n  initialTabState.id = tabId;\n  initialTabState.isChatInfoShown = Boolean(global.lastIsChatInfoShown);\n  initialTabState.audioPlayer.playbackRate = global.audioPlayer.lastPlaybackRate;\n  initialTabState.audioPlayer.isPlaybackRateActive = global.audioPlayer.isLastPlaybackRateActive;\n  initialTabState.mediaViewer.playbackRate = global.mediaViewer.lastPlaybackRate;\n\n  global = {\n    ...global,\n    byTabId: {\n      ...global.byTabId,\n      [tabId]: initialTabState,\n    },\n  };\n\n  if (isMasterTab || !IS_MULTITAB_SUPPORTED) {\n    initialTabState.isMasterTab = true;\n  }\n\n  Object.keys(global.messages.byChatId).forEach((chatId) => {\n    const threadsById = global.messages.byChatId[chatId].threadsById;\n    Object.keys(threadsById).forEach((thread) => {\n      const threadId = Number(thread);\n      const lastViewportIds = selectThreadParam(global, chatId, threadId, 'lastViewportIds');\n      // Check if migration from previous version is faulty\n      if (!lastViewportIds?.every((id) => isLocalMessageId(id) || global.messages.byChatId[chatId]?.byId[id])) {\n        global = replaceThreadParam(global, chatId, threadId, 'lastViewportIds', undefined);\n        return;\n      }\n      global = initializeChatMediaSearchResults(global, chatId, threadId, tabId);\n      global = replaceTabThreadParam(\n        global,\n        chatId,\n        threadId,\n        'viewportIds',\n        lastViewportIds,\n        tabId,\n      );\n    });\n  });\n\n  // Temporary state fix\n  Object.keys(global.messages.byChatId).forEach((chatId) => {\n    const threadsById = global.messages.byChatId[chatId].threadsById;\n    const fixedThreadsById = Object.keys(threadsById).reduce((acc, key) => {\n      const t = threadsById[Number(key)];\n      acc[Number(key)] = {\n        ...t,\n        listedIds: t.lastViewportIds,\n      };\n      return acc;\n    }, {} as GlobalState['messages']['byChatId'][string]['threadsById']);\n\n    global = {\n      ...global,\n      messages: {\n        ...global.messages,\n        byChatId: {\n          ...global.messages.byChatId,\n          [chatId]: {\n            ...global.messages.byChatId[chatId],\n            threadsById: fixedThreadsById,\n          },\n        },\n      },\n    };\n  });\n\n  const parsedMessageList = parseLocationHash(global.currentUserId);\n\n  if (global.authState !== 'authorizationStateReady'\n    && !global.passcode.hasPasscode && !global.passcode.isScreenLocked) {\n    Object.values(global.byTabId).forEach(({ id: otherTabId }) => {\n      if (otherTabId === tabId) return;\n      global = updateTabState(global, {\n        isInactive: true,\n      }, otherTabId);\n    });\n  }\n\n  if (!IS_MULTITAB_SUPPORTED) {\n    actions.initApi();\n  }\n\n  isCacheApiSupported().then((isSupported) => {\n    global = getGlobal();\n    global.isCacheApiSupported = isSupported;\n    setGlobal(global);\n  });\n\n  if (global.peerColors) {\n    updatePeerColors(global.peerColors.general);\n  }\n\n  return updateTabState(global, {\n    messageLists: parsedMessageList ? [parsedMessageList] : initialTabState.messageLists,\n  }, tabId);\n});\n\naddActionHandler('requestMasterAndCallAction', async (\n  global, actions, payload,\n): Promise<void> => {\n  const { tabId = getCurrentTabId() } = payload;\n\n  if (selectTabState(global, tabId).isMasterTab) {\n    const { action, payload: actionPayload } = payload;\n    // @ts-ignore\n    actions[action](actionPayload);\n    return;\n  }\n\n  if (global.phoneCall || global.groupCalls.activeGroupCallId) {\n    await loadBundle(Bundles.Calls);\n    if ('hangUp' in actions) actions.hangUp({ tabId });\n    if ('leaveGroupCall' in actions) actions.leaveGroupCall({ tabId });\n  } else {\n    reestablishMasterToSelf();\n  }\n\n  global = getGlobal();\n  global = updateTabState(global, {\n    multitabNextAction: payload,\n  }, tabId);\n  setGlobal(global);\n});\n\naddActionHandler('clearMultitabNextAction', (global, actions, payload): ActionReturnType => {\n  const { tabId = getCurrentTabId() } = payload || {};\n\n  return updateTabState(global, {\n    multitabNextAction: undefined,\n  }, tabId);\n});\n","import { animate } from './animation';\nimport { fastRaf } from './schedulers';\nimport { IS_IOS } from './windowEnvironment';\n\nconst TEST_INTERVAL = 5000; // 5 sec\nconst FRAMES_TO_TEST = 10;\nconst REDUCED_FPS = 35;\n\nlet isImproved = false;\n\nexport function betterView() {\n  if (!IS_IOS) return;\n\n  let interval: number | undefined;\n  let lastFocusAt = Date.now();\n\n  function setupInterval() {\n    if (interval || isImproved) return;\n\n    interval = window.setInterval(testAndImprove, TEST_INTERVAL);\n  }\n\n  window.addEventListener('focus', () => {\n    const now = Date.now();\n    if (now - lastFocusAt < 100) return; // iOS triggers two `focus` events for some reason\n    lastFocusAt = now;\n\n    setupInterval();\n    testAndImprove();\n  });\n\n  window.addEventListener('blur', () => {\n    clearInterval(interval);\n    interval = undefined;\n  });\n\n  if (document.hasFocus()) {\n    setupInterval();\n    testAndImprove();\n  }\n}\n\nasync function testAndImprove() {\n  const fps = await testFps();\n  if (fps <= REDUCED_FPS) {\n    improveView();\n  }\n}\n\nfunction testFps() {\n  return new Promise<number>((resolve) => {\n    const frames: number[] = [];\n    let lastFrameAt = performance.now();\n\n    animate(() => {\n      const now = performance.now();\n      frames.push(now - lastFrameAt);\n      lastFrameAt = now;\n\n      if (frames.length === FRAMES_TO_TEST) {\n        const mean = frames.sort()[Math.floor(frames.length / 2)];\n        resolve(Math.round(1000 / mean));\n        return false;\n      }\n\n      return true;\n    }, fastRaf);\n  });\n}\n\nfunction improveView() {\n  isImproved = true;\n\n  const containerEl = document.createElement('div');\n  containerEl.style.cssText = 'position: absolute; top: 0; left: 0; width: 0; height: 100%; overflow: hidden;';\n\n  const boosterEl = document.createElement('div');\n  const height = window.screen.height * 1.5;\n  boosterEl.style.cssText = `width: 0; height: ${height}px; transform: translateX(100%); transition: transform 100ms;`;\n  boosterEl.innerHTML = '&nbsp;';\n\n  containerEl.appendChild(boosterEl);\n  document.body.appendChild(containerEl);\n\n  requestAnimationFrame(() => {\n    boosterEl.addEventListener('transitionend', () => {\n      containerEl.remove();\n    });\n\n    boosterEl.style.transform = '';\n  });\n}\n","const STORAGE_KEY = 'tt-active-tab';\nconst INTERVAL = 2000;\n\nconst tabKey = String(Date.now() + Math.random());\n\nlocalStorage.setItem(STORAGE_KEY, tabKey);\n\nlet callback: NoneToVoidFunction;\n\nconst interval = window.setInterval(() => {\n  if (callback && localStorage.getItem(STORAGE_KEY) !== tabKey) {\n    callback();\n    clearInterval(interval);\n  }\n}, INTERVAL);\n\nexport function addActiveTabChangeListener(_callback: NoneToVoidFunction) {\n  callback = _callback;\n}\n","import type { FC } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\n\nimport { Bundles } from '../../util/moduleLoader';\n\nimport useModuleLoader from '../../hooks/useModuleLoader';\n\nimport Loading from '../ui/Loading';\n\nconst AuthCodeAsync: FC = () => {\n  const AuthCode = useModuleLoader(Bundles.Auth, 'AuthCode');\n\n  return AuthCode ? <AuthCode /> : <Loading />;\n};\n\nexport default AuthCodeAsync;\n","import type { FC } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\n\nimport { Bundles } from '../../util/moduleLoader';\n\nimport useModuleLoader from '../../hooks/useModuleLoader';\n\nimport Loading from '../ui/Loading';\n\nconst AuthPasswordAsync: FC = () => {\n  const AuthPassword = useModuleLoader(Bundles.Auth, 'AuthPassword');\n\n  return AuthPassword ? <AuthPassword /> : <Loading />;\n};\n\nexport default AuthPasswordAsync;\n","const SITE_FONTS = ['400 1em Roboto', '500 1em Roboto', \"500 1em 'Numbers Rounded'\"];\n\nexport default function preloadFonts() {\n  if ('fonts' in document) {\n    return Promise.all(SITE_FONTS.map((font) => document.fonts.load(font)));\n  }\n\n  return undefined;\n}\n","import type { LangCode } from '../../../types';\n\nexport function getSuggestedLanguage() {\n  let suggestedLanguage = navigator.language.toLowerCase();\n\n  if (suggestedLanguage && suggestedLanguage !== 'pt-br') {\n    suggestedLanguage = suggestedLanguage.substr(0, 2);\n  }\n\n  return suggestedLanguage as LangCode;\n}\n","import { useEffect, useState } from '../lib/teact/teact';\n\nimport type { RegularLangKey } from '../types/language';\n\nimport { LANG_PACK } from '../config';\nimport { callApi } from '../api/gramjs';\nimport useLastCallback from './useLastCallback';\n\nexport default function useLangString(key: RegularLangKey, langCode?: string) {\n  const [value, setValue] = useState<string | undefined>(undefined);\n\n  const fetchLangString = useLastCallback(async () => {\n    if (!langCode) return undefined;\n\n    const result = await callApi('fetchLangStrings', {\n      langCode,\n      langPack: LANG_PACK,\n      keys: [key],\n    });\n    const langString = result?.strings[key];\n    if (!langString || typeof langString !== 'string') return undefined;\n    return langString;\n  });\n\n  useEffect(() => {\n    fetchLangString().then(setValue);\n  }, [key, langCode]);\n\n  return value;\n}\n","import type { FC } from '../../lib/teact/teact';\nimport React, {\n  memo, useCallback, useRef, useState,\n} from '../../lib/teact/teact';\nimport { withGlobal } from '../../global';\n\nimport type { ApiCountryCode } from '../../api/types';\n\nimport { ANIMATION_END_DELAY } from '../../config';\nimport buildClassName from '../../util/buildClassName';\nimport { isoToEmoji } from '../../util/emoji/emoji';\nimport { prepareSearchWordsForNeedle } from '../../util/searchWords';\nimport { IS_EMOJI_SUPPORTED } from '../../util/windowEnvironment';\nimport renderText from '../common/helpers/renderText';\n\nimport useLang from '../../hooks/useLang';\nimport useSyncEffect from '../../hooks/useSyncEffect';\n\nimport DropdownMenu from '../ui/DropdownMenu';\nimport MenuItem from '../ui/MenuItem';\nimport Spinner from '../ui/Spinner';\n\nimport './CountryCodeInput.scss';\n\ntype StateProps = {\n  phoneCodeList: ApiCountryCode[];\n};\n\ntype OwnProps = {\n  id: string;\n  value?: ApiCountryCode;\n  isLoading?: boolean;\n  onChange: (value: ApiCountryCode) => void;\n};\n\nconst MENU_HIDING_DURATION = 200 + ANIMATION_END_DELAY;\nconst SELECT_TIMEOUT = 50;\n\nconst CountryCodeInput: FC<OwnProps & StateProps> = ({\n  id,\n  value,\n  isLoading,\n  onChange,\n  phoneCodeList,\n}) => {\n  const lang = useLang();\n  // eslint-disable-next-line no-null/no-null\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  const [filter, setFilter] = useState<string | undefined>();\n  const [filteredList, setFilteredList] = useState<ApiCountryCode[]>([]);\n\n  const updateFilter = useCallback((filterValue?: string) => {\n    setFilter(filterValue);\n    setFilteredList(getFilteredList(phoneCodeList, filterValue));\n  }, [phoneCodeList]);\n\n  useSyncEffect(([prevPhoneCodeList]) => {\n    if (!prevPhoneCodeList?.length && phoneCodeList.length) {\n      setFilteredList(getFilteredList(phoneCodeList, filter));\n    }\n  }, [phoneCodeList, filter]);\n\n  const handleChange = useCallback((country: ApiCountryCode) => {\n    onChange(country);\n\n    setTimeout(() => updateFilter(undefined), MENU_HIDING_DURATION);\n  }, [onChange, updateFilter]);\n\n  const handleInput = useCallback((e: React.FormEvent<HTMLInputElement>) => {\n    updateFilter(e.currentTarget.value);\n  }, [updateFilter]);\n\n  const handleInputKeyDown = useCallback((e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (e.keyCode !== 8) {\n      return;\n    }\n\n    const target = e.currentTarget;\n    if (value && filter === undefined) {\n      target.value = '';\n    }\n\n    updateFilter(target.value);\n  }, [filter, updateFilter, value]);\n\n  const CodeInput: FC<{ onTrigger: () => void; isOpen?: boolean }> = useCallback(({ onTrigger, isOpen }) => {\n    const handleTrigger = () => {\n      if (isOpen) {\n        return;\n      }\n\n      setTimeout(() => {\n        inputRef.current!.select();\n      }, SELECT_TIMEOUT);\n\n      onTrigger();\n\n      const formEl = document.getElementById('auth-phone-number-form')!;\n      formEl.scrollTo({ top: formEl.scrollHeight, behavior: 'smooth' });\n    };\n\n    const handleCodeInput = (e: React.FormEvent<HTMLInputElement>) => {\n      handleInput(e);\n      handleTrigger();\n    };\n\n    const emoji = value && IS_EMOJI_SUPPORTED && renderText(isoToEmoji(value.iso2), ['hq_emoji']);\n    const name = value?.name || value?.defaultName || '';\n    const inputValue = filter ?? [emoji, name].filter(Boolean).join(' ');\n\n    return (\n      <div className={buildClassName('input-group', value && 'touched')}>\n        <input\n          ref={inputRef}\n          className={buildClassName('form-control', isOpen && 'focus')}\n          type=\"text\"\n          id={id}\n          value={inputValue}\n          autoComplete=\"off\"\n          onClick={handleTrigger}\n          onFocus={handleTrigger}\n          onInput={handleCodeInput}\n          onKeyDown={handleInputKeyDown}\n        />\n        <label>{lang('LoginSelectCountryTitle')}</label>\n        {isLoading ? (\n          <Spinner color=\"black\" />\n        ) : (\n          <i onClick={handleTrigger} className={buildClassName('css-icon-down', isOpen && 'open')} />\n        )}\n      </div>\n    );\n  }, [filter, handleInput, handleInputKeyDown, id, isLoading, lang, value]);\n\n  return (\n    <DropdownMenu\n      className=\"CountryCodeInput\"\n      trigger={CodeInput}\n    >\n      {filteredList\n        .map((country: ApiCountryCode) => (\n          <MenuItem\n            key={`${country.iso2}-${country.countryCode}`}\n            className={value && country.iso2 === value.iso2 ? 'selected' : ''}\n            // eslint-disable-next-line react/jsx-no-bind\n            onClick={() => handleChange(country)}\n          >\n            <span className=\"country-flag\">{renderText(isoToEmoji(country.iso2), ['hq_emoji'])}</span>\n            <span className=\"country-name\">{country.name || country.defaultName}</span>\n            <span className=\"country-code\">+{country.countryCode}</span>\n          </MenuItem>\n        ))}\n      {!filteredList.length && (\n        <MenuItem\n          key=\"no-results\"\n          className=\"no-results\"\n          disabled\n        >\n          <span>{lang('CountryNone')}</span>\n        </MenuItem>\n      )}\n    </DropdownMenu>\n  );\n};\n\nfunction getFilteredList(countryList: ApiCountryCode[], filter = ''): ApiCountryCode[] {\n  if (!filter.length) {\n    return countryList;\n  }\n\n  const searchWords = prepareSearchWordsForNeedle(filter);\n\n  return countryList.filter((country) => (\n    searchWords(country.defaultName) || (country.name && searchWords(country.name))\n  ));\n}\n\nexport default memo(withGlobal<OwnProps>(\n  (global): StateProps => {\n    const { countryList: { phoneCodes: phoneCodeList } } = global;\n    return {\n      phoneCodeList,\n    };\n  },\n)(CountryCodeInput));\n","import type { ChangeEvent } from 'react';\nimport type { FC } from '../../lib/teact/teact';\nimport React, {\n  memo, useCallback, useEffect, useLayoutEffect, useRef, useState,\n} from '../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../global';\n\nimport type { ApiCountryCode } from '../../api/types';\nimport type { GlobalState } from '../../global/types';\n\nimport { requestMeasure } from '../../lib/fasterdom/fasterdom';\nimport { preloadImage } from '../../util/files';\nimport preloadFonts from '../../util/fonts';\nimport { pick } from '../../util/iteratees';\nimport { oldSetLanguage } from '../../util/oldLangProvider';\nimport { formatPhoneNumber, getCountryCodesByIso, getCountryFromPhoneNumber } from '../../util/phoneNumber';\nimport { IS_SAFARI, IS_TOUCH_ENV } from '../../util/windowEnvironment';\nimport { getSuggestedLanguage } from './helpers/getSuggestedLanguage';\n\nimport useFlag from '../../hooks/useFlag';\nimport useLang from '../../hooks/useLang';\nimport useLangString from '../../hooks/useLangString';\n\nimport Button from '../ui/Button';\nimport Checkbox from '../ui/Checkbox';\nimport InputText from '../ui/InputText';\nimport Loading from '../ui/Loading';\nimport CountryCodeInput from './CountryCodeInput';\n\nimport monkeyPath from '../../assets/monkey.svg';\n\ntype StateProps = Pick<GlobalState, (\n  'connectionState' | 'authState' |\n  'authPhoneNumber' | 'authIsLoading' |\n  'authIsLoadingQrCode' | 'authErrorKey' |\n  'authRememberMe' | 'authNearestCountry'\n)> & {\n  language?: string;\n  phoneCodeList: ApiCountryCode[];\n};\n\nconst MIN_NUMBER_LENGTH = 7;\n\nlet isPreloadInitiated = false;\n\nconst AuthPhoneNumber: FC<StateProps> = ({\n  connectionState,\n  authState,\n  authPhoneNumber,\n  authIsLoading,\n  authIsLoadingQrCode,\n  authErrorKey,\n  authRememberMe,\n  authNearestCountry,\n  phoneCodeList,\n  language,\n}) => {\n  const {\n    setAuthPhoneNumber,\n    setAuthRememberMe,\n    loadNearestCountry,\n    loadCountryList,\n    clearAuthErrorKey,\n    goToAuthQrCode,\n    setSettingOption,\n  } = getActions();\n\n  const lang = useLang();\n  // eslint-disable-next-line no-null/no-null\n  const inputRef = useRef<HTMLInputElement>(null);\n  const suggestedLanguage = getSuggestedLanguage();\n\n  const isConnected = connectionState === 'connectionStateReady';\n  const continueText = useLangString('AuthContinueOnThisLanguage', suggestedLanguage);\n  const [country, setCountry] = useState<ApiCountryCode | undefined>();\n  const [phoneNumber, setPhoneNumber] = useState<string | undefined>();\n  const [isTouched, setIsTouched] = useState(false);\n  const [lastSelection, setLastSelection] = useState<[number, number] | undefined>();\n  const [isLoading, markIsLoading, unmarkIsLoading] = useFlag();\n\n  const fullNumber = country ? `+${country.countryCode} ${phoneNumber || ''}` : phoneNumber;\n  const canSubmit = fullNumber && fullNumber.replace(/[^\\d]+/g, '').length >= MIN_NUMBER_LENGTH;\n\n  useEffect(() => {\n    if (!IS_TOUCH_ENV) {\n      inputRef.current!.focus();\n    }\n  }, [country]);\n\n  useEffect(() => {\n    if (isConnected && !authNearestCountry) {\n      loadNearestCountry();\n    }\n  }, [isConnected, authNearestCountry]);\n\n  useEffect(() => {\n    if (isConnected) {\n      loadCountryList({ langCode: language });\n    }\n  }, [isConnected, language]);\n\n  useEffect(() => {\n    if (authNearestCountry && phoneCodeList && !country && !isTouched) {\n      setCountry(getCountryCodesByIso(phoneCodeList, authNearestCountry)[0]);\n    }\n  }, [country, authNearestCountry, isTouched, phoneCodeList]);\n\n  const parseFullNumber = useCallback((newFullNumber: string) => {\n    if (!newFullNumber.length) {\n      setPhoneNumber('');\n    }\n\n    const suggestedCountry = phoneCodeList && getCountryFromPhoneNumber(phoneCodeList, newFullNumber);\n\n    // Any phone numbers should be allowed, in some cases ignoring formatting\n    const selectedCountry = !country\n    || (suggestedCountry && suggestedCountry.iso2 !== country.iso2)\n    || (!suggestedCountry && newFullNumber.length)\n      ? suggestedCountry\n      : country;\n\n    if (!country || !selectedCountry || (selectedCountry && selectedCountry.iso2 !== country.iso2)) {\n      setCountry(selectedCountry);\n    }\n    setPhoneNumber(formatPhoneNumber(newFullNumber, selectedCountry));\n  }, [phoneCodeList, country]);\n\n  const handleLangChange = useCallback(() => {\n    markIsLoading();\n\n    void oldSetLanguage(suggestedLanguage, () => {\n      unmarkIsLoading();\n\n      setSettingOption({ language: suggestedLanguage });\n    });\n  }, [markIsLoading, setSettingOption, suggestedLanguage, unmarkIsLoading]);\n\n  useEffect(() => {\n    if (phoneNumber === undefined && authPhoneNumber) {\n      parseFullNumber(authPhoneNumber);\n    }\n  }, [authPhoneNumber, phoneNumber, parseFullNumber]);\n\n  useLayoutEffect(() => {\n    if (inputRef.current && lastSelection) {\n      inputRef.current.setSelectionRange(...lastSelection);\n    }\n  }, [lastSelection]);\n\n  const isJustPastedRef = useRef(false);\n  const handlePaste = useCallback(() => {\n    isJustPastedRef.current = true;\n    requestMeasure(() => {\n      isJustPastedRef.current = false;\n    });\n  }, []);\n\n  const handleCountryChange = useCallback((value: ApiCountryCode) => {\n    setCountry(value);\n    setPhoneNumber('');\n  }, []);\n\n  const handlePhoneNumberChange = useCallback((e: ChangeEvent<HTMLInputElement>) => {\n    if (authErrorKey) {\n      clearAuthErrorKey();\n    }\n\n    // This is for further screens. We delay it until user input to speed up the initial loading.\n    if (!isPreloadInitiated) {\n      isPreloadInitiated = true;\n      preloadFonts();\n      void preloadImage(monkeyPath);\n    }\n\n    const { value, selectionStart, selectionEnd } = e.target;\n    setLastSelection(\n      selectionStart && selectionEnd && selectionEnd < value.length\n        ? [selectionStart, selectionEnd]\n        : undefined,\n    );\n\n    setIsTouched(true);\n\n    const shouldFixSafariAutoComplete = (\n      IS_SAFARI && country && fullNumber !== undefined\n      && value.length - fullNumber.length > 1 && !isJustPastedRef.current\n    );\n    parseFullNumber(shouldFixSafariAutoComplete ? `${country!.countryCode} ${value}` : value);\n  }, [authErrorKey, country, fullNumber, parseFullNumber]);\n\n  const handleKeepSessionChange = useCallback((e: ChangeEvent<HTMLInputElement>) => {\n    setAuthRememberMe(e.target.checked);\n  }, [setAuthRememberMe]);\n\n  function handleSubmit(event: React.FormEvent<HTMLFormElement>) {\n    event.preventDefault();\n\n    if (authIsLoading) {\n      return;\n    }\n\n    if (canSubmit) {\n      setAuthPhoneNumber({ phoneNumber: fullNumber });\n    }\n  }\n\n  const handleGoToAuthQrCode = useCallback(() => {\n    goToAuthQrCode();\n  }, [goToAuthQrCode]);\n\n  const isAuthReady = authState === 'authorizationStateWaitPhoneNumber';\n\n  return (\n    <div id=\"auth-phone-number-form\" className=\"custom-scroll\">\n      <div className=\"auth-form\">\n        <div id=\"logo\" />\n        <h1>{lang('AuthTitle')}</h1>\n        <p className=\"note\">{lang('StartText')}</p>\n        <form className=\"form\" action=\"\" onSubmit={handleSubmit}>\n          <CountryCodeInput\n            id=\"sign-in-phone-code\"\n            value={country}\n            isLoading={!authNearestCountry && !country}\n            onChange={handleCountryChange}\n          />\n          <InputText\n            ref={inputRef}\n            id=\"sign-in-phone-number\"\n            label={lang('LoginPhonePlaceholder')}\n            value={fullNumber}\n            error={authErrorKey && lang.withRegular(authErrorKey)}\n            inputMode=\"tel\"\n            onChange={handlePhoneNumberChange}\n            onPaste={IS_SAFARI ? handlePaste : undefined}\n          />\n          <Checkbox\n            id=\"sign-in-keep-session\"\n            label={lang('AuthKeepSignedIn')}\n            checked={Boolean(authRememberMe)}\n            onChange={handleKeepSessionChange}\n          />\n          {canSubmit && (\n            isAuthReady ? (\n              <Button size=\"smaller\" type=\"submit\" ripple isLoading={authIsLoading}>{lang('LoginNext')}</Button>\n            ) : (\n              <Loading />\n            )\n          )}\n          {isAuthReady && (\n            <Button size=\"smaller\" isText ripple isLoading={authIsLoadingQrCode} onClick={handleGoToAuthQrCode}>\n              {lang('LoginQRLogin')}\n            </Button>\n          )}\n          {suggestedLanguage && suggestedLanguage !== language && continueText && (\n            <Button size=\"smaller\" isText isLoading={isLoading} onClick={handleLangChange}>{continueText}</Button>\n          )}\n        </form>\n      </div>\n    </div>\n  );\n};\n\nexport default memo(withGlobal(\n  (global): StateProps => {\n    const {\n      settings: { byKey: { language } },\n      countryList: { phoneCodes: phoneCodeList },\n    } = global;\n\n    return {\n      ...pick(global, [\n        'connectionState',\n        'authState',\n        'authPhoneNumber',\n        'authIsLoading',\n        'authIsLoadingQrCode',\n        'authErrorKey',\n        'authRememberMe',\n        'authNearestCountry',\n      ]),\n      language,\n      phoneCodeList,\n    };\n  },\n)(AuthPhoneNumber));\n","import React, {\n  memo, useCallback, useLayoutEffect, useRef,\n} from '../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../global';\n\nimport type { GlobalState } from '../../global/types';\n\nimport { STRICTERDOM_ENABLED } from '../../config';\nimport { disableStrict, enableStrict } from '../../lib/fasterdom/stricterdom';\nimport buildClassName from '../../util/buildClassName';\nimport { oldSetLanguage } from '../../util/oldLangProvider';\nimport { LOCAL_TGS_URLS } from '../common/helpers/animatedAssets';\nimport { getSuggestedLanguage } from './helpers/getSuggestedLanguage';\n\nimport useAsync from '../../hooks/useAsync';\nimport useFlag from '../../hooks/useFlag';\nimport useLang from '../../hooks/useLang';\nimport useLangString from '../../hooks/useLangString';\nimport useMediaTransitionDeprecated from '../../hooks/useMediaTransitionDeprecated';\n\nimport AnimatedIcon from '../common/AnimatedIcon';\nimport Button from '../ui/Button';\nimport Loading from '../ui/Loading';\n\nimport blankUrl from '../../assets/blank.png';\n\ntype StateProps =\n  Pick<GlobalState, 'connectionState' | 'authState' | 'authQrCode'>\n  & { language?: string };\n\nconst DATA_PREFIX = 'tg://login?token=';\nconst QR_SIZE = 280;\nconst QR_PLANE_SIZE = 54;\nconst QR_CODE_MUTATION_DURATION = 50; // The library is asynchronous and we need to wait for its mutation code\n\nlet qrCodeStylingPromise: Promise<typeof import('qr-code-styling')>;\n\nfunction ensureQrCodeStyling() {\n  if (!qrCodeStylingPromise) {\n    qrCodeStylingPromise = import('qr-code-styling');\n  }\n  return qrCodeStylingPromise;\n}\n\nconst AuthCode = ({\n  connectionState,\n  authState,\n  authQrCode,\n  language,\n}: StateProps) => {\n  const {\n    returnToAuthPhoneNumber,\n    setSettingOption,\n  } = getActions();\n\n  const suggestedLanguage = getSuggestedLanguage();\n  const lang = useLang();\n  // eslint-disable-next-line no-null/no-null\n  const qrCodeRef = useRef<HTMLDivElement>(null);\n\n  const isConnected = connectionState === 'connectionStateReady';\n  const continueText = useLangString('AuthContinueOnThisLanguage', suggestedLanguage);\n  const [isLoading, markIsLoading, unmarkIsLoading] = useFlag();\n  const [isQrMounted, markQrMounted, unmarkQrMounted] = useFlag();\n\n  const { result: qrCode } = useAsync(async () => {\n    const QrCodeStyling = (await ensureQrCodeStyling()).default;\n    return new QrCodeStyling({\n      width: QR_SIZE,\n      height: QR_SIZE,\n      image: blankUrl,\n      margin: 10,\n      type: 'svg',\n      dotsOptions: {\n        type: 'rounded',\n      },\n      cornersSquareOptions: {\n        type: 'extra-rounded',\n      },\n      imageOptions: {\n        imageSize: 0.4,\n        margin: 8,\n      },\n      qrOptions: {\n        errorCorrectionLevel: 'M',\n      },\n    });\n  }, []);\n\n  const transitionClassNames = useMediaTransitionDeprecated(isQrMounted);\n\n  useLayoutEffect(() => {\n    if (!authQrCode || !qrCode) {\n      return () => {\n        unmarkQrMounted();\n      };\n    }\n\n    if (!isConnected) {\n      return undefined;\n    }\n\n    const container = qrCodeRef.current!;\n    const data = `${DATA_PREFIX}${authQrCode.token}`;\n\n    if (STRICTERDOM_ENABLED) {\n      disableStrict();\n    }\n\n    qrCode.update({\n      data,\n    });\n\n    if (!isQrMounted) {\n      qrCode.append(container);\n      markQrMounted();\n    }\n\n    if (STRICTERDOM_ENABLED) {\n      setTimeout(() => {\n        enableStrict();\n      }, QR_CODE_MUTATION_DURATION);\n    }\n\n    return undefined;\n  }, [isConnected, authQrCode, isQrMounted, markQrMounted, unmarkQrMounted, qrCode]);\n\n  const handleLangChange = useCallback(() => {\n    markIsLoading();\n\n    void oldSetLanguage(suggestedLanguage, () => {\n      unmarkIsLoading();\n\n      setSettingOption({ language: suggestedLanguage });\n    });\n  }, [markIsLoading, setSettingOption, suggestedLanguage, unmarkIsLoading]);\n\n  const habdleReturnToAuthPhoneNumber = useCallback(() => {\n    returnToAuthPhoneNumber();\n  }, [returnToAuthPhoneNumber]);\n\n  const isAuthReady = authState === 'authorizationStateWaitQrCode';\n\n  return (\n    <div id=\"auth-qr-form\" className=\"custom-scroll\">\n      <div className=\"auth-form qr\">\n        <div className=\"qr-outer\">\n          <div\n            className={buildClassName('qr-inner', transitionClassNames)}\n            key=\"qr-inner\"\n          >\n            <div\n              key=\"qr-container\"\n              className=\"qr-container\"\n              ref={qrCodeRef}\n              style={`width: ${QR_SIZE}px; height: ${QR_SIZE}px`}\n            />\n            <AnimatedIcon\n              tgsUrl={LOCAL_TGS_URLS.QrPlane}\n              size={QR_PLANE_SIZE}\n              className=\"qr-plane\"\n              nonInteractive\n              noLoop={false}\n            />\n          </div>\n          {!isQrMounted && <div className=\"qr-loading\"><Loading /></div>}\n        </div>\n        <h1>{lang('LoginQRTitle')}</h1>\n        <ol>\n          <li><span>{lang('LoginQRHelp1')}</span></li>\n          <li><span>{lang('LoginQRHelp2', undefined, { withNodes: true, withMarkdown: true })}</span></li>\n          <li><span>{lang('LoginQRHelp3')}</span></li>\n        </ol>\n        {isAuthReady && (\n          <Button size=\"smaller\" isText onClick={habdleReturnToAuthPhoneNumber}>{lang('LoginQRCancel')}</Button>\n        )}\n        {suggestedLanguage && suggestedLanguage !== language && continueText && (\n          <Button size=\"smaller\" isText isLoading={isLoading} onClick={handleLangChange}>{continueText}</Button>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default memo(withGlobal(\n  (global): StateProps => {\n    const {\n      connectionState, authState, authQrCode, settings: { byKey: { language } },\n    } = global;\n\n    return {\n      connectionState,\n      authState,\n      authQrCode,\n      language,\n    };\n  },\n)(AuthCode));\n","import type { FC } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\n\nimport { Bundles } from '../../util/moduleLoader';\n\nimport useModuleLoader from '../../hooks/useModuleLoader';\n\nimport Loading from '../ui/Loading';\n\nconst AuthRegisterAsync: FC = () => {\n  const AuthRegister = useModuleLoader(Bundles.Auth, 'AuthRegister');\n\n  return AuthRegister ? <AuthRegister /> : <Loading />;\n};\n\nexport default AuthRegisterAsync;\n","import '../../global/actions/initial';\n\nimport type { FC } from '../../lib/teact/teact';\nimport React, { memo, useRef } from '../../lib/teact/teact';\nimport { getActions, withGlobal } from '../../global';\n\nimport type { GlobalState } from '../../global/types';\n\nimport { PLATFORM_ENV } from '../../util/windowEnvironment';\n\nimport useCurrentOrPrev from '../../hooks/useCurrentOrPrev';\nimport useElectronDrag from '../../hooks/useElectronDrag';\nimport useHistoryBack from '../../hooks/useHistoryBack';\n\nimport Transition from '../ui/Transition';\nimport AuthCode from './AuthCode.async';\nimport AuthPassword from './AuthPassword.async';\nimport AuthPhoneNumber from './AuthPhoneNumber';\nimport AuthQrCode from './AuthQrCode';\nimport AuthRegister from './AuthRegister.async';\n\nimport './Auth.scss';\n\ntype StateProps = Pick<GlobalState, 'authState'>;\n\nconst Auth: FC<StateProps> = ({\n  authState,\n}) => {\n  const {\n    returnToAuthPhoneNumber, goToAuthQrCode,\n  } = getActions();\n\n  const isMobile = PLATFORM_ENV === 'iOS' || PLATFORM_ENV === 'Android';\n\n  const handleChangeAuthorizationMethod = () => {\n    if (!isMobile) {\n      goToAuthQrCode();\n    } else {\n      returnToAuthPhoneNumber();\n    }\n  };\n\n  useHistoryBack({\n    isActive: (!isMobile && authState === 'authorizationStateWaitPhoneNumber')\n      || (isMobile && authState === 'authorizationStateWaitQrCode'),\n    onBack: handleChangeAuthorizationMethod,\n  });\n\n  // eslint-disable-next-line no-null/no-null\n  const containerRef = useRef<HTMLDivElement>(null);\n  useElectronDrag(containerRef);\n\n  // For animation purposes\n  const renderingAuthState = useCurrentOrPrev(\n    authState !== 'authorizationStateReady' ? authState : undefined,\n    true,\n  );\n\n  function getScreen() {\n    switch (renderingAuthState) {\n      case 'authorizationStateWaitCode':\n        return <AuthCode />;\n      case 'authorizationStateWaitPassword':\n        return <AuthPassword />;\n      case 'authorizationStateWaitRegistration':\n        return <AuthRegister />;\n      case 'authorizationStateWaitPhoneNumber':\n        return <AuthPhoneNumber />;\n      case 'authorizationStateWaitQrCode':\n        return <AuthQrCode />;\n      default:\n        return isMobile ? <AuthPhoneNumber /> : <AuthQrCode />;\n    }\n  }\n\n  function getActiveKey() {\n    switch (renderingAuthState) {\n      case 'authorizationStateWaitCode':\n        return 0;\n      case 'authorizationStateWaitPassword':\n        return 1;\n      case 'authorizationStateWaitRegistration':\n        return 2;\n      case 'authorizationStateWaitPhoneNumber':\n        return 3;\n      case 'authorizationStateWaitQrCode':\n        return 4;\n      default:\n        return isMobile ? 3 : 4;\n    }\n  }\n\n  return (\n    <Transition activeKey={getActiveKey()} name=\"fade\" className=\"Auth\" ref={containerRef}>\n      {getScreen()}\n    </Transition>\n  );\n};\n\nexport default memo(withGlobal(\n  (global): StateProps => {\n    return {\n      authState: global.authState,\n    };\n  },\n)(Auth));\n","// extracted by mini-css-extract-plugin\nexport default {\"bg\":\"ThfRMqwq\"};","// extracted by mini-css-extract-plugin\nexport default {\"mask\":\"U9MowLv_\",\"main\":\"RcG6eRZw\",\"left\":\"oL7XcRwI\",\"middle\":\"LYe7IaQO\",\"right\":\"wYSGQZXX\",\"blank\":\"kN2M6u9m\"};","import type { FC } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\nimport { getActions, getGlobal, withGlobal } from '../../global';\n\nimport type { TabState } from '../../global/types';\nimport { ApiMediaFormat } from '../../api/types';\n\nimport { getChatAvatarHash } from '../../global/helpers/chats'; // Direct import for better module splitting\nimport { selectIsRightColumnShown, selectTabState } from '../../global/selectors';\nimport buildClassName from '../../util/buildClassName';\nimport { preloadImage } from '../../util/files';\nimport preloadFonts from '../../util/fonts';\nimport { localizationReadyPromise } from '../../util/localization';\nimport * as mediaLoader from '../../util/mediaLoader';\nimport { Bundles, loadModule } from '../../util/moduleLoader';\nimport { pause } from '../../util/schedulers';\n\nimport useEffectOnce from '../../hooks/useEffectOnce';\nimport useFlag from '../../hooks/useFlag';\nimport useShowTransitionDeprecated from '../../hooks/useShowTransitionDeprecated';\n\n// Workaround for incorrect bundling by Webpack: force including in the main chunk\nimport '../ui/Modal.scss';\nimport './Avatar.scss';\nimport appStyles from '../App.module.scss';\nimport styles from './UiLoader.module.scss';\n\nimport lockPreviewPath from '../../assets/lock.png';\nimport monkeyPath from '../../assets/monkey.svg';\nimport spoilerMaskPath from '../../assets/spoilers/mask.svg';\nimport telegramLogoPath from '../../assets/telegram-logo.svg';\n\nexport type UiLoaderPage =\n  'main'\n  | 'lock'\n  | 'inactive'\n  | 'authCode'\n  | 'authPassword'\n  | 'authPhoneNumber'\n  | 'authQrCode';\n\ntype OwnProps = {\n  page?: UiLoaderPage;\n  children: React.ReactNode;\n  isMobile?: boolean;\n};\n\ntype StateProps = Pick<TabState, 'uiReadyState' | 'shouldSkipHistoryAnimations'> & {\n  isRightColumnShown?: boolean;\n  leftColumnWidth?: number;\n};\n\nconst MAX_PRELOAD_DELAY = 700;\nconst SECOND_STATE_DELAY = 1000;\nconst AVATARS_TO_PRELOAD = 10;\n\nfunction preloadAvatars() {\n  const { listIds, byId } = getGlobal().chats;\n  if (!listIds.active) {\n    return undefined;\n  }\n\n  return Promise.all(listIds.active.slice(0, AVATARS_TO_PRELOAD).map((chatId) => {\n    const chat = byId[chatId];\n    if (!chat) {\n      return undefined;\n    }\n\n    const avatarHash = getChatAvatarHash(chat);\n    if (!avatarHash) {\n      return undefined;\n    }\n\n    return mediaLoader.fetch(avatarHash, ApiMediaFormat.BlobUrl);\n  }));\n}\n\nconst preloadTasks = {\n  main: () => Promise.all([\n    loadModule(Bundles.Main)\n      .then(preloadFonts),\n    preloadAvatars(),\n    preloadImage(spoilerMaskPath),\n    localizationReadyPromise,\n  ]),\n  authPhoneNumber: () => Promise.all([\n    preloadFonts(),\n    preloadImage(telegramLogoPath),\n  ]),\n  authCode: () => preloadImage(monkeyPath),\n  authPassword: () => preloadImage(monkeyPath),\n  authQrCode: preloadFonts,\n  lock: () => Promise.all([\n    preloadFonts(),\n    preloadImage(lockPreviewPath),\n  ]),\n  inactive: () => {\n  },\n};\n\nconst UiLoader: FC<OwnProps & StateProps> = ({\n  page,\n  children,\n  isRightColumnShown,\n  shouldSkipHistoryAnimations,\n  leftColumnWidth,\n}) => {\n  const { setIsUiReady } = getActions();\n\n  const [isReady, markReady] = useFlag();\n  const {\n    shouldRender: shouldRenderMask, transitionClassNames,\n  } = useShowTransitionDeprecated(!isReady, undefined, true);\n\n  useEffectOnce(() => {\n    let timeout: number | undefined;\n\n    const safePreload = async () => {\n      try {\n        await preloadTasks[page!]();\n      } catch (err) {\n        // Do nothing\n      }\n    };\n\n    Promise.race([\n      pause(MAX_PRELOAD_DELAY),\n      page ? safePreload() : Promise.resolve(),\n    ]).then(() => {\n      markReady();\n      setIsUiReady({ uiReadyState: 1 });\n\n      timeout = window.setTimeout(() => {\n        setIsUiReady({ uiReadyState: 2 });\n      }, SECOND_STATE_DELAY);\n    });\n\n    return () => {\n      if (timeout) {\n        clearTimeout(timeout);\n        timeout = undefined;\n      }\n\n      setIsUiReady({ uiReadyState: 0 });\n    };\n  });\n\n  return (\n    <>\n      {children}\n      {shouldRenderMask && !shouldSkipHistoryAnimations && Boolean(page) && (\n        <div className={buildClassName(styles.mask, transitionClassNames)}>\n          {page === 'main' ? (\n            <div className={styles.main}>\n              <div\n                className={styles.left}\n                style={leftColumnWidth ? `width: ${leftColumnWidth}px` : undefined}\n              />\n              <div className={buildClassName(styles.middle, appStyles.bg)} />\n              {isRightColumnShown && <div className={styles.right} />}\n            </div>\n          ) : (page === 'inactive' || page === 'lock') ? (\n            <div className={buildClassName(styles.blank, appStyles.bg)} />\n          ) : (\n            <div className={styles.blank} />\n          )}\n        </div>\n      )}\n    </>\n  );\n};\n\nexport default withGlobal<OwnProps>(\n  (global, { isMobile }): StateProps => {\n    const tabState = selectTabState(global);\n\n    return {\n      shouldSkipHistoryAnimations: tabState.shouldSkipHistoryAnimations,\n      uiReadyState: tabState.uiReadyState,\n      isRightColumnShown: selectIsRightColumnShown(global, isMobile),\n      leftColumnWidth: global.leftColumnWidth,\n    };\n  },\n)(UiLoader);\n","import type { FC } from '../../lib/teact/teact';\nimport React, { useCallback } from '../../lib/teact/teact';\n\nimport useHistoryBack from '../../hooks/useHistoryBack';\n\nimport Button from '../ui/Button';\n\nimport './AppInactive.scss';\n\nimport appInactivePath from '../../assets/app-inactive.png';\n\nconst AppInactive: FC = () => {\n  const handleReload = useCallback(() => {\n    window.location.reload();\n  }, []);\n\n  useHistoryBack({\n    isActive: true,\n    onBack: handleReload,\n    shouldResetUrlHash: true,\n  });\n\n  return (\n    <div id=\"AppInactive\">\n      <div className=\"content\">\n        <img src={appInactivePath} alt=\"\" />\n        <h3 className=\"title\">Such error, many tabs</h3>\n        <div className=\"description\">\n          Telegram supports only one active tab with the app.\n          <br />\n          Please reload this page to continue using this tab or close it.\n        </div>\n        <div className=\"actions\">\n          <Button isText ripple onClick={handleReload}>\n            Reload app\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default AppInactive;\n","import type { FC } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\n\nimport type { OwnProps } from './LockScreen';\n\nimport { Bundles } from '../../util/moduleLoader';\n\nimport useModuleLoader from '../../hooks/useModuleLoader';\n\nconst LockScreenAsync: FC<OwnProps> = (props) => {\n  const { isLocked } = props;\n  const LockScreen = useModuleLoader(Bundles.Main, 'LockScreen', !isLocked);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return LockScreen ? <LockScreen {...props} /> : undefined;\n};\n\nexport default LockScreenAsync;\n","import type { FC } from '../../lib/teact/teact';\nimport React from '../../lib/teact/teact';\n\nimport type { OwnProps } from './Main';\n\nimport { Bundles } from '../../util/moduleLoader';\n\nimport useModuleLoader from '../../hooks/useModuleLoader';\n\nconst MainAsync: FC<OwnProps> = (props) => {\n  const Main = useModuleLoader(Bundles.Main, 'Main');\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return Main ? <Main {...props} /> : undefined;\n};\n\nexport default MainAsync;\n","import type { FC } from '../lib/teact/teact';\nimport React, { useEffect, useLayoutEffect } from '../lib/teact/teact';\nimport { getActions, withGlobal } from '../global';\n\nimport type { GlobalState } from '../global/types';\nimport type { ThemeKey } from '../types';\nimport type { UiLoaderPage } from './common/UiLoader';\n\nimport {\n  DARK_THEME_BG_COLOR, INACTIVE_MARKER, LIGHT_THEME_BG_COLOR, PAGE_TITLE,\n} from '../config';\nimport { selectTabState, selectTheme } from '../global/selectors';\nimport { addActiveTabChangeListener } from '../util/activeTabMonitor';\nimport buildClassName from '../util/buildClassName';\nimport { setupBeforeInstallPrompt } from '../util/installPrompt';\nimport { parseInitialLocationHash } from '../util/routing';\nimport { hasStoredSession } from '../util/sessions';\nimport { IS_INSTALL_PROMPT_SUPPORTED, IS_MULTITAB_SUPPORTED, PLATFORM_ENV } from '../util/windowEnvironment';\nimport { updateSizes } from '../util/windowSize';\n\nimport useAppLayout from '../hooks/useAppLayout';\nimport useFlag from '../hooks/useFlag';\nimport usePreviousDeprecated from '../hooks/usePreviousDeprecated';\n\n// import Test from './test/TestLocale';\nimport Auth from './auth/Auth';\nimport UiLoader from './common/UiLoader';\nimport AppInactive from './main/AppInactive';\nimport LockScreen from './main/LockScreen.async';\nimport Main from './main/Main.async';\nimport Transition from './ui/Transition';\n\nimport styles from './App.module.scss';\n\ntype StateProps = {\n  authState: GlobalState['authState'];\n  isScreenLocked?: boolean;\n  hasPasscode?: boolean;\n  isInactiveAuth?: boolean;\n  hasWebAuthTokenFailed?: boolean;\n  isTestServer?: boolean;\n  theme: ThemeKey;\n};\n\nenum AppScreens {\n  auth,\n  main,\n  lock,\n  inactive,\n}\n\nconst TRANSITION_RENDER_COUNT = Object.keys(AppScreens).length / 2;\nconst INACTIVE_PAGE_TITLE = `${PAGE_TITLE} ${INACTIVE_MARKER}`;\n\nconst App: FC<StateProps> = ({\n  authState,\n  isScreenLocked,\n  hasPasscode,\n  isInactiveAuth,\n  hasWebAuthTokenFailed,\n  isTestServer,\n  theme,\n}) => {\n  const { disconnect } = getActions();\n\n  const [isInactive, markInactive, unmarkInactive] = useFlag(false);\n  const { isMobile } = useAppLayout();\n  const isMobileOs = PLATFORM_ENV === 'iOS' || PLATFORM_ENV === 'Android';\n\n  useEffect(() => {\n    if (IS_INSTALL_PROMPT_SUPPORTED) {\n      setupBeforeInstallPrompt();\n    }\n  }, []);\n\n  // Prevent drop on elements that do not accept it\n  useEffect(() => {\n    const body = document.body;\n    const handleDrag = (e: DragEvent) => {\n      e.preventDefault();\n      if (!e.dataTransfer) return;\n      if (!(e.target as HTMLElement).dataset.dropzone) {\n        e.dataTransfer.dropEffect = 'none';\n      } else {\n        e.dataTransfer.dropEffect = 'copy';\n      }\n    };\n    const handleDrop = (e: DragEvent) => {\n      e.preventDefault();\n    };\n    body.addEventListener('drop', handleDrop);\n    body.addEventListener('dragover', handleDrag);\n    body.addEventListener('dragenter', handleDrag);\n\n    return () => {\n      body.removeEventListener('drop', handleDrop);\n      body.removeEventListener('dragover', handleDrag);\n      body.removeEventListener('dragenter', handleDrag);\n    };\n  }, []);\n\n  // return <Test />;\n\n  let activeKey: number;\n  let page: UiLoaderPage | undefined;\n\n  if (isInactive) {\n    activeKey = AppScreens.inactive;\n  } else if (isScreenLocked) {\n    page = 'lock';\n    activeKey = AppScreens.lock;\n  } else if (authState) {\n    switch (authState) {\n      case 'authorizationStateWaitPhoneNumber':\n        page = 'authPhoneNumber';\n        activeKey = AppScreens.auth;\n        break;\n      case 'authorizationStateWaitCode':\n        page = 'authCode';\n        activeKey = AppScreens.auth;\n        break;\n      case 'authorizationStateWaitPassword':\n        page = 'authPassword';\n        activeKey = AppScreens.auth;\n        break;\n      case 'authorizationStateWaitRegistration':\n        activeKey = AppScreens.auth;\n        break;\n      case 'authorizationStateWaitQrCode':\n        page = 'authQrCode';\n        activeKey = AppScreens.auth;\n        break;\n      case 'authorizationStateClosed':\n      case 'authorizationStateClosing':\n      case 'authorizationStateLoggingOut':\n      case 'authorizationStateReady':\n        page = 'main';\n        activeKey = AppScreens.main;\n        break;\n    }\n  } else if (hasStoredSession()) {\n    page = 'main';\n    activeKey = AppScreens.main;\n  } else if (hasPasscode) {\n    activeKey = AppScreens.lock;\n  } else {\n    page = isMobileOs ? 'authPhoneNumber' : 'authQrCode';\n    activeKey = AppScreens.auth;\n  }\n\n  if (activeKey !== AppScreens.lock\n    && activeKey !== AppScreens.inactive\n    && activeKey !== AppScreens.main\n    && parseInitialLocationHash()?.tgWebAuthToken\n    && !hasWebAuthTokenFailed) {\n    page = 'main';\n    activeKey = AppScreens.main;\n  }\n\n  useEffect(() => {\n    updateSizes();\n  }, []);\n\n  useEffect(() => {\n    if (IS_MULTITAB_SUPPORTED) return;\n\n    addActiveTabChangeListener(() => {\n      disconnect();\n      document.title = INACTIVE_PAGE_TITLE;\n\n      markInactive();\n    });\n  }, [activeKey, disconnect, markInactive]);\n\n  useEffect(() => {\n    if (isInactiveAuth) {\n      document.title = INACTIVE_PAGE_TITLE;\n      markInactive();\n    } else {\n      document.title = PAGE_TITLE;\n      unmarkInactive();\n    }\n  }, [isInactiveAuth, markInactive, unmarkInactive]);\n\n  const prevActiveKey = usePreviousDeprecated(activeKey);\n\n  // eslint-disable-next-line consistent-return\n  function renderContent() {\n    switch (activeKey) {\n      case AppScreens.auth:\n        return <Auth />;\n      case AppScreens.main:\n        return <Main isMobile={isMobile} />;\n      case AppScreens.lock:\n        return <LockScreen isLocked={isScreenLocked} />;\n      case AppScreens.inactive:\n        return <AppInactive />;\n    }\n  }\n\n  useLayoutEffect(() => {\n    document.body.classList.add(styles.bg);\n  }, []);\n\n  useLayoutEffect(() => {\n    document.body.style.setProperty(\n      '--theme-background-color',\n      theme === 'dark' ? DARK_THEME_BG_COLOR : LIGHT_THEME_BG_COLOR,\n    );\n  }, [theme]);\n\n  return (\n    <UiLoader page={page} isMobile={isMobile}>\n      <Transition\n        name=\"fade\"\n        activeKey={activeKey}\n        shouldCleanup\n        className={buildClassName(\n          'full-height',\n          (activeKey === AppScreens.auth || prevActiveKey === AppScreens.auth) && 'is-auth',\n        )}\n        renderCount={TRANSITION_RENDER_COUNT}\n      >\n        {renderContent}\n      </Transition>\n      {activeKey === AppScreens.auth && isTestServer && <div className=\"test-server-badge\">Test server</div>}\n    </UiLoader>\n  );\n};\n\nexport default withGlobal(\n  (global): StateProps => {\n    return {\n      authState: global.authState,\n      isScreenLocked: global.passcode?.isScreenLocked,\n      hasPasscode: global.passcode?.hasPasscode,\n      isInactiveAuth: selectTabState(global).isInactive,\n      hasWebAuthTokenFailed: global.hasWebAuthTokenFailed || global.hasWebAuthTokenPasswordRequired,\n      theme: selectTheme(global),\n      isTestServer: global.config?.isTestServer,\n    };\n  },\n)(App);\n","import './util/handleError';\nimport './util/setupServiceWorker';\nimport './global/init';\n\nimport React from './lib/teact/teact';\nimport TeactDOM from './lib/teact/teact-dom';\nimport {\n  getActions, getGlobal,\n} from './global';\n\nimport {\n  DEBUG, MULTITAB_LOCALSTORAGE_KEY, STRICTERDOM_ENABLED,\n} from './config';\nimport { enableStrict, requestMutation } from './lib/fasterdom/fasterdom';\nimport { selectTabState } from './global/selectors';\nimport { betterView } from './util/betterView';\nimport { establishMultitabRole, subscribeToMasterChange } from './util/establishMultitabRole';\nimport { initGlobal } from './util/init';\nimport { initLocalization } from './util/localization';\nimport { requestGlobal, subscribeToMultitabBroadcastChannel } from './util/multitab';\nimport { checkAndAssignPermanentWebVersion } from './util/permanentWebVersion';\nimport { onBeforeUnload } from './util/schedulers';\nimport updateWebmanifest from './util/updateWebmanifest';\nimport { IS_MULTITAB_SUPPORTED } from './util/windowEnvironment';\n\nimport App from './components/App';\n\nimport './assets/fonts/roboto.css';\nimport './styles/index.scss';\n\nif (STRICTERDOM_ENABLED) {\n  enableStrict();\n}\n\ninit();\n\nasync function init() {\n  if (DEBUG) {\n    // eslint-disable-next-line no-console\n    console.log('>>> INIT');\n  }\n\n  if (!(window as any).isCompatTestPassed) return;\n\n  checkAndAssignPermanentWebVersion();\n\n  await window.electron?.restoreLocalStorage();\n\n  if (IS_MULTITAB_SUPPORTED) {\n    subscribeToMultitabBroadcastChannel();\n    await requestGlobal(APP_VERSION);\n    localStorage.setItem(MULTITAB_LOCALSTORAGE_KEY, '1');\n    onBeforeUnload(() => {\n      const global = getGlobal();\n      if (Object.keys(global.byTabId).length === 1) {\n        localStorage.removeItem(MULTITAB_LOCALSTORAGE_KEY);\n      }\n    });\n  }\n\n  await initGlobal();\n  getActions().init();\n\n  getActions().updateShouldEnableDebugLog();\n  getActions().updateShouldDebugExportedSenders();\n\n  const global = getGlobal();\n\n  initLocalization(global.settings.byKey.language, true);\n\n  if (IS_MULTITAB_SUPPORTED) {\n    subscribeToMasterChange((isMasterTab) => {\n      getActions()\n        .switchMultitabRole({ isMasterTab }, { forceSyncOnIOs: true });\n    });\n    const shouldReestablishMasterToSelf = getGlobal().authState !== 'authorizationStateReady';\n    establishMultitabRole(shouldReestablishMasterToSelf);\n  }\n\n  if (DEBUG) {\n    // eslint-disable-next-line no-console\n    console.log('>>> START INITIAL RENDER');\n  }\n\n  requestMutation(() => {\n    updateWebmanifest();\n\n    TeactDOM.render(\n      <App />,\n      document.getElementById('root')!,\n    );\n\n    betterView();\n  });\n\n  if (DEBUG) {\n    // eslint-disable-next-line no-console\n    console.log('>>> FINISH INITIAL RENDER');\n  }\n\n  if (DEBUG) {\n    document.addEventListener('dblclick', () => {\n      // eslint-disable-next-line no-console\n      console.warn('TAB STATE', selectTabState(getGlobal()));\n      // eslint-disable-next-line no-console\n      console.warn('GLOBAL STATE', getGlobal());\n    });\n  }\n}\n\nonBeforeUnload(() => {\n  const actions = getActions();\n  actions.leaveGroupCall?.({ isPageUnload: true });\n  actions.hangUp?.({ isPageUnload: true });\n});\n","// Original idea was found here\n// https://medium.com/@alshakero/how-to-setup-your-web-app-manifest-dynamically-using-javascript-f7fbee899a61\n\nimport { DEBUG } from '../config';\nimport { IS_MAC_OS } from './windowEnvironment';\n\nexport default function updateWebmanifest() {\n  if (!IS_MAC_OS) {\n    return;\n  }\n\n  const manifest = document.getElementById('the-manifest-placeholder');\n  if (!manifest) {\n    return;\n  }\n\n  const url = `site_apple${DEBUG ? '_dev' : ''}.webmanifest`;\n  manifest.setAttribute('href', url);\n}\n"],"names":["leafPrototypes","getProto","inProgress","dataWebpackPrefix","HEALTH_CHECK_TIMEOUT","HEALTH_CHECK_MIN_DELAY","NO_QUEUE_BEFORE_INIT","Set","worker","requestStates","Map","requestStatesByCallback","pendingPayloads","savedLocalDb","chats","users","documents","stickerSets","photos","webDocuments","commonBoxState","channelPtsById","isMasterTab","subscribeToMasterChange","isMasterTabNew","channel","IS_MULTITAB_SUPPORTED","BroadcastChannel","DATA_BROADCAST_CHANNEL_NAME","undefined","postMessagesOnTickEnd","throttleWithTickEnd","payloads","postMessage","postMessageOnTickEnd","payload","push","updateCallback","localApiRequestsQueue","apiRequestsQueue","isInited","initApi","onUpdate","initialArgs","DEBUG","console","log","Worker","URL","addEventListener","data","forEach","type","DEBUG_startAt","performance","now","updates","duration","warn","length","handleMethodResponse","handleMethodCallback","message","error","IGNORE_UNHANDLED_ERRORS","has","Error","navigator","sendBeacon","url","logDebugMessage","level","args","subscribeToWorker","platform","window","ensureWorkerPing","setTimeout","makeRequest","then","request","callApi","fnName","deferred","resolve","catch","reject","callApiLocal","token","getCurrentTabId","initApiOnMasterTab","Promise","updateLocalDb","name","prop","value","updateFullLocalDb","initial","Object","assign","setShouldEnableDebugLog","isEnabled","Deferred","promise","err","messageId","generateUniqueId","requestState","withCallback","callback","pop","set","finally","delete","callApiOnMasterTab","makeRequestToMaster","cancelApiProgress","progressCallback","isCanceled","get","cancelApiProgressMaster","response","callbackArgs","DEBUG_payload","startedAt","Date","async","isResolved","race","pause","terminate","ApiMediaFormat","ApiMessageEntityTypes","MAIN_THREAD_ID","MESSAGE_DELETED","DEFAULT_SIZE","memo","props","size","play","noLoop","className","noTransition","nonInteractive","onLoad","onClick","otherProps","isAnimationLoaded","markAnimationLoaded","useFlag","transitionClassNames","useMediaTransitionDeprecated","handleLoad","useLastCallback","playKey","setPlayKey","useState","String","Math","random","handleClick","React","createElement","AnimatedSticker","_extends","buildClassName","ref","renderId","style","tgsUrl","playSegment","speed","quality","isLowPriority","color","forceAlways","forceOnHeavyAnimation","sharedCanvas","sharedCanvasCoords","onEnded","onLoop","containerRef","useRef","viewId","useUniqueId","animation","setAnimation","animationRef","isFirstRender","shouldUseColorFilter","colorFilter","useColorFilter","playRef","useStateRef","playSegmentRef","rgbColor","shouldForceOnHeavyAnimation","canInitialize","markCanInitialize","unmarkCanInitialize","getIsHeavyAnimating","useHeavyAnimation","useEffect","useSyncEffect","r","g","b","hexToRgb","current","isUnmountedRef","useUnmountCleanup","init","offsetWidth","offsetHeight","container","newAnimation","getRLottie","coords","setSpeed","ensureRLottie","throttledInit","useThrottledCallback","useSharedIntersectionObserver","setColor","removeView","playAnimation","shouldRestart","isFrozen","playAnimationOnRaf","requestMeasure","pauseAnimation","isPlaying","useEffectWithPrevDeps","prevNoLoop","setNoLoop","prevSharedCanvasCoords","setSharedCanvasCoords","changeData","usePriorityPlaybackCheck","useBackgroundMode","buildStyle","IS_ELECTRON","isPriorityPlaybackActive","isBackgroundModeActive","CustomEmoji","documentId","isBig","noPlay","noVideoOnMobile","loopLimit","isSelectable","withSharedAnimation","sharedCanvasRef","sharedCanvasHqRef","withTranslucentThumb","shouldPreloadPreview","observeIntersectionForLoading","observeIntersectionForPlaying","onAnimationEnd","withSparkles","sparklesStyle","sparklesClassName","customEmoji","canPlay","useCustomEmoji","loopCountRef","shouldPlay","setShouldPlay","hasCustomColor","shouldUseTextColor","customColor","useDynamicColorListener","handleVideoEnded","e","currentTarget","currentTime","safePlay","handleStickerLoop","isHq","stickerSetInfo","selectIsAlwaysHighPriorityEmoji","getGlobal","emoji","Sparkles","preset","src","blankImg","alt","draggable","StickerView","sticker","isSmall","thumbClassName","fullMediaClassName","shouldLoop","onVideoEnded","onAnimatedStickerLoop","withGlobal","global","poll","selectPollFromMessage","storyData","content","story","selectPeerStory","peerId","id","translatedText","noEmoji","highlight","truncateLength","TRUNCATED_SUMMARY_LENGTH","withTranslucentThumbs","inChatList","emojiSize","lang","useOldLang","extractedText","extractMessageText","hasPoll","Boolean","getMessagePollId","isAction","isActionMessage","statefulContent","groupStatefulContent","summaryText","text","getMessageSummaryText","trimmedText","trimText","renderText","getMessageSummaryEmoji","Fragment","getMessageSummaryDescription","ActionMessageText","asPreview","MessageText","messageOrStory","flat","filter","isForAnimation","isProtected","shouldRenderAsHtml","forcePlayback","focusedQuote","isInSelectMode","canBeEmpty","maxTimestamp","threadId","textCacheBusterRef","formattedText","adaptedFormattedText","stripCustomEmoji","entities","containerId","withSharedCanvas","useMemo","hasSpoilers","some","Spoiler","renderTextWithEntities","cacheBuster","toString","chatId","CONTENT_NOT_SUPPORTED","peer","peerColor","noUserColors","shouldReset","emojiIconClassName","children","getPeerColorClass","getApiPeerColorClass","backgroundEmojiId","EmojiIconBackground","emojiDocumentId","SafeLink","isRtl","shouldSkipModal","openUrl","getActions","isRegularLink","preventDefault","isTrustedLink","isMixedScriptUrl","classNames","href","ensureProtocol","title","getUnicodeUrl","target","rel","dir","Url","BUTTON_POSITIONS","x","y","durationShift","PROGRESS_POSITIONS","count","positions","i","velocityX","velocityY","scale","generateRandomProgressPositions","presetSettings","styles","map","position","shiftX","cos","atan2","shiftY","sin","fullMediaHash","noLoad","isLottie","isVideoBroken","markVideoBroken","isUnsupportedVideo","isVideo","IS_WEBM_SUPPORTED","IS_IOS","IS_ANDROID","isStatic","previewMediaHash","getStickerMediaHash","dpr","useDevicePixelRatio","filterStyle","isIntersectingForLoading","useIsIntersecting","shouldLoad","isIntersectingForPlaying","hasIntersectedForPlayingRef","cachedPreview","mediaLoader","isReadyToMountFullMedia","hasIntersected","getNoHeavyAnimation","setNoHeavyAnimation","useSignal","$getIsHeavyAnimating","useDerivedState","useMountAfterHeavyAnimation","shouldForcePreview","shouldLoadPreview","previewMediaData","useMedia","withPreview","shouldSkipLoadingFullMedia","fullMediaData","shouldRenderFullMedia","isPlayerReady","markPlayerReady","isFullMediaReady","thumbDataUri","useThumbnail","thumbnail","thumbData","isThumbOpaque","noCrossTransition","thumbRef","useMediaTransition","noCloseTransition","fullMediaRef","noOpenTransition","useCoordsInSharedCanvas","randomIdPrefix","join","key","OptimizedVideo","playsInline","muted","loop","isPriority","disablePictureInPicture","onReady","onBroken","TopicDefaultIcon","letterClassName","topicId","iconColor","iconSrc","getTopicDefaultIcon","GENERAL_TOPIC_ID","Icon","getFirstLetters","ICON_POSITIONS","inline","block","opacity","EMOJI_SIZE","REM","canvasRef","emojiImage","setEmojiImage","previewUrl","preloadAfterHeavyAnimation","useThrottleForHeavyAnimation","preloadImage","updateCanvas","canvas","context","getContext","width","height","clearRect","save","globalAlpha","translate","drawImage","restore","tintColor","fillStyle","globalCompositeOperation","fillRect","updateCanvasAfterHeavyAnimation","updateCanvasSize","parentWidth","parentHeight","requestMutation","handleResize","entry","contentRect","useResizeObserver","getBoundingClientRect","LOCAL_TGS_URLS","MonkeyIdle","MonkeyTracking","MonkeyClose","MonkeyPeek","FoldersAll","FoldersNew","FoldersShare","DiscussionGroups","Lock","CameraFlip","HandFilled","HandOutline","Speaker","VoiceAllowTalk","VoiceMini","VoiceMuted","VoiceOutlined","JoinRequest","Invite","QrPlane","Congratulations","Experimental","PartyPopper","Flame","ReadTime","Unlock","LastSeen","Mention","StarReactionEffect","StarReaction","Report","SearchingDuck","ONE_GIGABYTE","ONE_MEGABYTE","getFileSizeString","bytes","toFixed","getDocumentExtension","document","fileName","mimeType","getFileExtension","indexOf","split","getColorFromExtension","extension","getDocumentHasPreview","previewBlobUrl","MEDIA_VIEWER_MEDIA_QUERY","parseInt","getComputedStyle","documentElement","fontSize","ROUND_VIDEO_DIMENSIONS_PX","GIF_MIN_WIDTH","AVATAR_FULL_DIMENSIONS","VIDEO_AVATAR_FULL_DIMENSIONS","LIKE_STICKER_ID","DEFAULT_MEDIA_DIMENSIONS","MOBILE_SCREEN_NO_AVATARS_MESSAGE_EXTRA_WIDTH_REM","MOBILE_SCREEN_MESSAGE_EXTRA_WIDTH_REM","MESSAGE_MAX_WIDTH_REM","MESSAGE_OWN_MAX_WIDTH_REM","cachedMaxWidthOwn","cachedMaxWidth","cachedMaxWidthNoAvatar","getAvailableWidth","fromOwnMessage","isWebPageMedia","noAvatars","isMobile","extraPaddingRem","availableWidthRem","windowWidth","windowSize","min","getMaxMessageWidthRem","calculateDimensionsForMessageMedia","isGif","aspectRatio","availableWidth","availableHeight","getAvailableHeight","mediaWidth","max","calculateDimensions","getMediaViewerAvailableDimensions","withFooter","mql","matchMedia","windowHeight","occupiedHeightRem","matches","IS_TOUCH_ENV","calculateInlineImageDimensions","photo","asForwarded","getPhotoInlineDimensions","calculateVideoDimensions","video","getVideoDimensions","calculateExtendedPreviewDimensions","preview","getPictogramDimensions","getDocumentThumbnailDimensions","smaller","getStickerDimensions","baseWidth","STICKER_SIZE_INLINE_MOBILE_FACTOR","STICKER_SIZE_INLINE_DESKTOP_FACTOR","calculatedHeight","round","calculateMediaViewerDimensions","mediaHeight","calculatedWidth","peerColorId","getPeerColorCount","getPeerColorKey","SIMPLE_MARKDOWN_REGEX","part","filters","params","compact","reduce","textParts","divEl","result","innerText","innerHTML","escapeHtml","EMOJI_REGEX","lastIndex","replaceEmojis","addLineBreaks","addHighlight","quote","addLinks","replaceSimpleMarkdown","markdownPostProcessor","IS_EMOJI_SUPPORTED","parts","fixNonStandardEmoji","emojis","match","emojiResult","code","nativeToUnifiedExtendedWithCache","IS_PACKAGED_ELECTRON","BASE_URL","isLoaded","LOADED_EMOJIS","handleEmojiLoad","index","splittenParts","line","source","trimmedLine","trimLeft","indentLength","fromCharCode","repeat","isQuote","queryPosition","toLowerCase","newParts","substring","RE_LINK","RegExp","RE_LINK_TEMPLATE","RE_MENTION_TEMPLATE","allowOnlyTgLinks","links","nextLink","shift","startsWith","MentionLink","username","endsWith","slice","isDeepLink","postProcessor","postProcess","entityResult","entity","replace","areLinesWrapping","element","lines","trim","lineHeight","lineHeightParsed","parseFloat","clientHeight","Blockquote","canBeCollapsible","isToggleDisabled","isCollapsed","isCollapsible","setIsCollapsed","useCollapsibleLines","canExpand","handleExpand","handleToggle","prev","PRETTY_BY_ALIAS","js","javascript","ts","typescript","python","py","go","rust","func","c","cpp","fortran","f90","f","java","sql","swift","kotlin","ruby","rb","php","perl","bash","sh","markdown","cs","json","yaml","yml","solidity","sol","tl","CodeOverlay","noCopy","onWordWrapToggle","showNotification","useWindowSize","isWordWrap","setIsWordWrap","withWordWrapButton","setWithWordWrapButton","checkWordWrap","useCallback","isWrap","parentElement","handleCopy","copyTextToClipboard","handleWordWrapClick","contentClass","overlayClass","wrapClass","CodeBlock","language","setWordWrap","highlighted","useAsync","lib","default","handleWordWrapToggle","wrap","blockClass","PeerColorWrapper","codeLanguage","Pre","revealByContainerId","createClassNameBuilder","contentRef","isRevealed","revealSpoiler","stopEvent","reveal","HQ_EMOJI_THRESHOLD","noCustomEmojiPlayback","renderMessagePart","deleteLineBreakAfterPre","organizedEntities","organizedEntityIndexes","organizedEntity","organizeEntity","organizedIndexes","organizedIndex","add","organizeEntities","renderEntity","textPartStart","textPartEnd","isLastEntity","renderResult","nestedEntities","offset","textBefore","textBeforeLength","substr","entityStartIndex","entityEndIndex","entityContent","nestedEntityContent","nestedIndex","nestedEntity","nestedEntityIndex","nestedResult","nestedEntityEndIndex","newEntity","rawEntityText","trimEnd","renderedContent","Bold","Italic","Underline","Code","Strike","MentionName","userId","TextUrl","getLinkUrl","buildCustomEmojiHtmlFromEntity","processEntityAsHtml","entityText","renderNestedMessagePart","canCollapse","BotCommand","handleBotCommandClick","Hashtag","tag","handleHashtagClick","Cashtag","handleCodeClick","role","tabIndex","Email","Phone","Timestamp","timestamp","openMediaFromTimestamp","handleTimecodeClick","processEntity","Array","isArray","textAfter","arrayIndex","getTextWithEntitiesAsHtml","parsedEntity","isChanged","sendBotCommand","command","hashtag","openChatByUsername","onChatChanged","action","searchHashtag","oldTranslate","LOAD_QUEUE","RENDER_HISTORY","loadFromQueue","throttle","queue","queueToLoad","otherQueue","LIMIT_PER_REQUEST","loadCustomEmojis","ids","updateLastRendered","updateLastRenderedCustomEmojis","reverse","clear","notifyCustomEmojiRender","emojiId","addCustomEmojiInputRenderCallback","setCustomEmoji","customEmojis","byId","setCanPlay","selectCanPlayAnimatedEmojis","handleGlobalChange","newGlobal","addCustomEmojiCallback","removeCustomEmojiCallback","ariaLabel","character","STAR_PATH","GoldStarIcon","randomId","mask1Id","mask2Id","gradient1Id","gradient2Id","gradient3Id","svg","viewBox","fill","maskUnits","d","mask","x1","y1","x2","y2","gradientUnits","PremiumStarIcon","RegularStarIcon","StarIcon","validSvgRandomId","root","clickable","renderIcon","INPUT_CUSTOM_EMOJI_SELECTOR","buildCustomEmojiHtml","isPlaceholder","uniqueId","getInputCustomEmojiParams","rawText","getCustomEmojiSize","maxEmojisInLine","EMOJI_SIZES","preventMessageInputBlur","withBubbling","activeElement","EDITABLE_INPUT_ID","preventMessageInputBlurWithBubbling","conjuctionWithNodes","langFn","nodes","placeholders","node","replaced","internalFormatters","conjunction","formatToParts","Number","UNIQUE_PLACEHOLDER_PREFIX","UNSUPPORTED_LANG_KEY","chat","selectChat","sender","selectSender","replyToMsgId","replyToPeerId","getMessageReplyInfo","replyMessage","selectChatMessage","currentUserId","isInsideTopic","openThread","openTelegramLink","isOutgoing","useLang","renderStrong","strong","isChannel","isChatChannel","isServiceNotificationsChat","SERVICE_NOTIFICATIONS_USER_ID","isSavedMessages","senderTitle","getPeerTitle","chatTitle","userFallbackText","chatFallbackText","channelFallbackText","senderLink","renderPeerLink","chatLink","getMessageText","textLink","renderMessageLink","translateWithYou","from","mediaValue","getPinnedMediaValue","messageLink","media","score","gameTitle","game","gameLink","pluralValue","withNodes","isViaRequest","inviterId","inviter","selectPeer","inviterLink","channelId","channelLink","originalChatId","originalChatLink","iconEmojiId","selectThreadIdFromMessage","topicLink","Link","topic","isClosed","isHidden","currentTopic","selectTopic","topicPlaceholderLink","link","boosts","userIds","user","userTitle","userLink","userLinks","app","domain","isAttachMenu","isFromRequest","usernames","TME_LINK_PREFIX","shortName","appLink","stars","amount","formatStarsAsText","winnersCount","isStars","unclaimedCount","currency","cryptoAmount","cryptoCurrency","price","formatCurrency","asFontIcon","cryptoPrice","cost","durationText","formatShortDuration","scheduleDate","formattedDate","formatDateTimeToString","date","totalAmount","isRecurringInit","isRecurringUsed","invoice","getMessageInvoice","invoiceTitle","peerTitle","peerLink","gift","alreadyPaidUpgradeStars","savedId","fromId","isToChannel","fromPeer","fromTitle","fromLink","starsAmount","channelPeer","isYou","channelTitle","isTransferred","isUpgrade","isAnonymous","actionPeer","actionPeerLink","isRoundVideo","isVoice","getCallMessageKey","renderActionText","userOrChat","selectUser","openChat","closeStoryViewer","setShouldCloseRightColumn","useAppLayout","variables","options","asText","isMarkdown","audio","contact","giveaway","giveawayResults","paidMedia","location","pollId","voice","getMessageContent","groupedId","isRound","stopPropagation","withMultilineFix","IS_SAFARI","targetMessage","focusMessage","isMissed","reason","isCancelled","Button","onContextMenu","onMouseDown","onMouseUp","onMouseEnter","onMouseLeave","onFocus","backgroundImage","pill","badge","fluid","isText","isLoading","isShiny","withPremiumGradient","withSparkleEffect","onTransitionEnd","ariaControls","hasPopup","download","disabled","allowDisabledClick","noFastClick","ripple","faded","isRectangular","noPreventDefault","shouldStopPropagation","noForcedUpperCase","elementRef","isClicked","setIsClicked","isNotInteractive","fullClassName","handleMouseDown","button","MouseButton","Main","Spinner","RippleEffect","Checkbox","label","labelText","subLabel","checked","withIcon","blocking","permissionGroup","rightIcon","onlyInput","nestedCheckbox","nestedCheckboxCount","nestedOptionList","leftElement","values","onChange","onCheck","onClickLabel","labelRef","showNested","setShowNested","handleChange","event","toggleNested","labelClassName","nestedOptions","nestedOption","DropdownMenu","trigger","bubbleClassName","transformOriginX","transformOriginY","positionX","positionY","footer","forceOpen","onOpen","onClose","onMouseEnterBackdrop","onHide","autoClose","menuRef","isOpen","setIsOpen","handleClose","triggerComponent","onTrigger","isMenuOpen","onKeyDown","menu","keyCode","focusedElement","elementChildren","focus","toggleIsOpen","Menu","onCloseAnimationEnd","InputText","success","readOnly","placeholder","autoComplete","inputMode","maxLength","teactExperimentControlled","onInput","onKeyPress","onBlur","onPaste","htmlFor","isPrimary","Loading","backgroundColor","EMPTY_RECT","left","top","applyStaticOptions","bubbleRef","bubbleStyle","containerEl","bubbleEl","cssText","addExtraClass","setExtraStyles","transformOrigin","externalRef","shouldCloseFast","ariaLabelledBy","noCloseOnBackdrop","backdropExcludedSelector","noCompact","withPortal","positionOptions","isTouchScreen","useShowTransition","optionsRef","useLayoutEffect","options2","requestForcedReflow","staticOptions","anchor","getRootElement","getMenuElement","getTriggerElement","getLayout","withMaxHeight","triggerEl","anchorX","anchorY","menuEl","rootEl","extraPaddingX","extraTopPadding","extraMarginTop","topShiftY","menuElMinWidth","deltaX","shouldAvoidNegativePosition","isDense","marginTop","menuElWidth","menuElHeight","menuRect","rootRect","yWithTopShift","triggerRect","addedYForPortalPositioning","addedXForPortalPositioning","leftWithPossibleNegative","addedXForMenuPositioning","offsetX","offsetY","processDynamically","useMenuPosition","captureEscKeyListener","useHistoryBack","isActive","onBack","shouldBeReplaced","prevIsOpen","beginHeavyAnimation","handleKeyDown","useKeyboardListNavigation","useVirtualBackdrop","bubbleFullClassName","IS_BACKDROP_BLUR_SUPPORTED","Portal","icon","isCharIcon","customIcon","destructive","withWrap","clickArg","withPreventDefaultOnMouseDown","origin","IS_TEST","onTimeUpdate","restProps","localRef","handlePlaying","handlePlayingForAutoPause","playerRef","canPlayRef","mediaRef","shouldPauseRef","isLoadingPlayRef","body","contains","usePlayPause","unfreezePlaying","unfreezePlayingOnRaf","useVideoAutoPause","isReadyRef","handleReady","isBuffered","bufferingHandlers","useBuffering","onPlaying","handlePlayingForBuffering","otherBufferingHandlers","prevIsBuffered","mergedOtherBufferingHandlers","mergedHandlers","keys","keyString","useVideoCleanup","autoPlay","containerSelector","querySelector","classList","appendChild","TeactDOM","render","removeChild","ripples","setRipples","cleanUpDebounced","debounce","rippleSize","clientX","clientY","CLASSES","ACTIVE_SLIDE_CLASS_NAME","TO_SLIDE_CLASS_NAME","DISABLEABLE_ANIMATIONS","activeKey","nextKey","direction","renderCount","shouldRestoreHeight","shouldCleanup","cleanupExceptionKey","cleanupOnlyKey","shouldWrap","wrapExceptionKey","slideClassName","withSwipeControl","isBlockingAnimation","onStart","onStop","currentKeyRef","shouldDisableAnimation","selectCanAnimateInterface","rendersRef","prevActiveKey","usePreviousDeprecated","forceUpdate","useForceUpdate","isAnimatingRef","isSwipeJustCancelledRef","hasActiveKeyChanged","isBackwards","cleanup","omit","isSlideOptimized","prevActiveIndex","activeIndex","childNodes","childElements","el","childElement","transition","transform","toSlide","fromSlide","toggleExtraClass","HTMLElement","removeExtraClass","endHeavyAnimation","forceReflow","waitForTransitionEnd","performSlideOptimized","watchedNode","giveUpAnimationEnd","waitForAnimationEnd","allowSwipeControlForTransition","clientWidth","flexBasis","asFastList","renders","contents","rendered","teactOrderKey","teactFastList","APP_CODE_NAME","APP_NAME","RELEASE_DATETIME","process","PRODUCTION_HOSTNAME","PRODUCTION_URL","WEB_VERSION_BASE","IS_MOCKED_CLIENT","IS_BETA","DEBUG_MORE","DEBUG_LOG_FILENAME","STRICTERDOM_ENABLED","BOT_VERIFICATION_PEERS_LIMIT","BETA_CHANGELOG_URL","ELECTRON_HOST_URL","DEBUG_ALERT_MSG","PAGE_TITLE","INACTIVE_MARKER","DEBUG_PAYMENT_SMART_GLOCAL","SESSION_USER_KEY","LEGACY_PASSCODE_CACHE_NAME","GLOBAL_STATE_CACHE_DISABLED","GLOBAL_STATE_CACHE_KEY","GLOBAL_STATE_CACHE_USER_LIST_LIMIT","GLOBAL_STATE_CACHE_CHAT_LIST_LIMIT","GLOBAL_STATE_CACHE_ARCHIVED_CHAT_LIST_LIMIT","GLOBAL_STATE_CACHE_CUSTOM_EMOJI_LIMIT","IS_SCREEN_LOCKED_CACHE_KEY","MEDIA_CACHE_DISABLED","MEDIA_CACHE_NAME","MEDIA_CACHE_NAME_AVATARS","MEDIA_PROGRESSIVE_CACHE_NAME","CUSTOM_BG_CACHE_NAME","LANG_CACHE_NAME","AUTODOWNLOAD_FILESIZE_MB_LIMITS","ESTABLISH_BROADCAST_CHANNEL_NAME","MULTITAB_LOCALSTORAGE_KEY","isBigScreen","innerHeight","MIN_PASSWORD_LENGTH","MESSAGE_LIST_SLICE","MESSAGE_LIST_VIEWPORT_LIMIT","ARCHIVE_MINIMIZED_HEIGHT","CHAT_HEIGHT_PX","TOPIC_HEIGHT_PX","PEER_PICKER_ITEM_HEIGHT_PX","CHAT_LIST_SLICE","CHAT_LIST_LOAD_SLICE","SHARED_MEDIA_SLICE","CHAT_MEDIA_SLICE","MESSAGE_SEARCH_SLICE","GLOBAL_SEARCH_SLICE","GLOBAL_TOPIC_SEARCH_SLICE","MEMBERS_SLICE","MEMBERS_LOAD_SLICE","PROFILE_SENSITIVE_AREA","TOPIC_LIST_SENSITIVE_AREA","API_GENERAL_ID_LIMIT","STATISTICS_PUBLIC_FORWARDS_LIMIT","STORY_VIEWS_MIN_SEARCH","STORY_MIN_REACTIONS_SORT","STORY_VIEWS_MIN_CONTACTS_FILTER","MEDIA_TIMESTAMP_SAVE_MINIMUM_DURATION","GLOBAL_SUGGESTED_CHANNELS_ID","TOPICS_SLICE","TOPICS_SLICE_SECOND_LOAD","TOP_CHAT_MESSAGES_PRELOAD_LIMIT","DEFAULT_VOLUME","DEFAULT_PLAYBACK_RATE","PLAYBACK_RATE_FOR_AUDIO_MIN_DURATION","ANIMATION_LEVEL_CUSTOM","ANIMATION_LEVEL_MIN","ANIMATION_LEVEL_MED","ANIMATION_LEVEL_MAX","ANIMATION_LEVEL_DEFAULT","DEFAULT_MESSAGE_TEXT_SIZE_PX","IOS_DEFAULT_MESSAGE_TEXT_SIZE_PX","MACOS_DEFAULT_MESSAGE_TEXT_SIZE_PX","PREVIEW_AVATAR_COUNT","DRAFT_DEBOUNCE","SEND_MESSAGE_ACTION_INTERVAL","APP_CONFIG_REFETCH_INTERVAL","GENERAL_REFETCH_INTERVAL","EDITABLE_INPUT_MODAL_ID","EDITABLE_STORY_INPUT_ID","EDITABLE_INPUT_CSS_SELECTOR","EDITABLE_INPUT_MODAL_CSS_SELECTOR","EDITABLE_STORY_INPUT_CSS_SELECTOR","CUSTOM_APPENDIX_ATTRIBUTE","MESSAGE_CONTENT_CLASS_NAME","MESSAGE_CONTENT_SELECTOR","VIEW_TRANSITION_CLASS_NAME","RESIZE_HANDLE_CLASS_NAME","RESIZE_HANDLE_SELECTOR","SNAP_EFFECT_CONTAINER_ID","SNAP_EFFECT_ID","STARS_ICON_PLACEHOLDER","STARS_CURRENCY_CODE","MIN_SCREEN_WIDTH_FOR_STATIC_RIGHT_COLUMN","MIN_SCREEN_WIDTH_FOR_STATIC_LEFT_COLUMN","MOBILE_SCREEN_MAX_WIDTH","MOBILE_SCREEN_LANDSCAPE_MAX_WIDTH","MOBILE_SCREEN_LANDSCAPE_MAX_HEIGHT","MAX_INT_32","TMP_CHAT_ID","ANIMATION_END_DELAY","ANIMATION_WAVE_MIN_INTERVAL","MESSAGE_APPEARANCE_DELAY","SCROLL_MIN_DURATION","SCROLL_MAX_DURATION","SCROLL_MAX_DISTANCE","SCROLL_SHORT_TRANSITION_MAX_DISTANCE","LOCK_SCREEN_ANIMATION_DURATION_MS","STICKER_SIZE_AUTH","STICKER_SIZE_AUTH_MOBILE","STICKER_SIZE_PICKER","EMOJI_SIZE_PICKER","COMPOSER_EMOJI_SIZE_PICKER","STICKER_SIZE_GENERAL_SETTINGS","STICKER_SIZE_PICKER_HEADER","STICKER_PICKER_MAX_SHARED_COVERS","STICKER_SIZE_SEARCH","STICKER_SIZE_MODAL","EMOJI_SIZE_MODAL","STICKER_SIZE_TWO_FA","STICKER_SIZE_PASSCODE","STICKER_SIZE_DISCUSSION_GROUPS","STICKER_SIZE_FOLDER_SETTINGS","STICKER_SIZE_INLINE_BOT_RESULT","STICKER_SIZE_JOIN_REQUESTS","STICKER_SIZE_INVITES","EMOJI_STATUS_LOOP_LIMIT","TOP_SYMBOL_SET_ID","POPULAR_SYMBOL_SET_ID","RECENT_SYMBOL_SET_ID","COLLECTIBLE_STATUS_SET_ID","FAVORITE_SYMBOL_SET_ID","EFFECT_STICKERS_SET_ID","EFFECT_EMOJIS_SET_ID","CHAT_STICKER_SET_ID","DEFAULT_TOPIC_ICON_STICKER_ID","DEFAULT_STATUS_ICON_ID","EMOJI_IMG_REGEX","BASE_EMOJI_KEYWORD_LANG","MENU_TRANSITION_DURATION","SLIDE_TRANSITION_DURATION","BIRTHDAY_NUMBERS_SET","RESTRICTED_EMOJI_SET","SVG_NAMESPACE","GIF_MIME_TYPE","LOTTIE_STICKER_MIME_TYPE","VIDEO_STICKER_MIME_TYPE","SUPPORTED_PHOTO_CONTENT_TYPES","SUPPORTED_VIDEO_CONTENT_TYPES","SUPPORTED_AUDIO_CONTENT_TYPES","CONTENT_TYPES_WITH_PREVIEW","SUPPORTED_TRANSLATION_LANGUAGES","RE_TG_LINK","RE_TME_LINK","RE_TELEGRAM_LINK","BOT_FATHER_USERNAME","USERNAME_PURCHASE_ERROR","MESSAGE_ID_REQUIRED_ERROR","PURCHASE_USERNAME","TME_WEB_DOMAINS","LANG_PACK","COUNTRIES_WITH_12H_TIME_FORMAT","API_CHAT_TYPES","HEART_REACTION","emoticon","REPLIES_USER_ID","VERIFICATION_CODES_USER_ID","ANONYMOUS_USER_ID","RESTRICTED_EMOJI_SET_ID","CHANNEL_ID_LENGTH","ALL_FOLDER_ID","ARCHIVED_FOLDER_ID","SAVED_FOLDER_ID","MAX_MEDIA_FILES_FOR_ALBUM","MAX_ACTIVE_PINNED_CHATS","SCHEDULED_WHEN_ONLINE","LANG_PACKS","FEEDBACK_URL","FAQ_URL","PRIVACY_URL","MINI_APP_TOS_URL","FRESH_AUTH_PERIOD","GIVEAWAY_BOOST_PER_PREMIUM","GIVEAWAY_MAX_ADDITIONAL_CHANNELS","GIVEAWAY_MAX_ADDITIONAL_USERS","GIVEAWAY_MAX_ADDITIONAL_COUNTRIES","FRAGMENT_PHONE_CODE","FRAGMENT_PHONE_LENGTH","LIGHT_THEME_BG_COLOR","DARK_THEME_BG_COLOR","DEFAULT_PATTERN_COLOR","DARK_THEME_PATTERN_COLOR","PEER_COLOR_BG_OPACITY","PEER_COLOR_BG_ACTIVE_OPACITY","PEER_COLOR_GRADIENT_STEP","MAX_UPLOAD_FILEPART_SIZE","MAX_UNIQUE_REACTIONS","GROUP_CALL_VOLUME_MULTIPLIER","GROUP_CALL_DEFAULT_VOLUME","DEFAULT_LIMITS","uploadMaxFileparts","stickersFaved","savedGifs","dialogFiltersChats","dialogFilters","dialogFolderPinned","captionLength","channels","channelsPublic","aboutLength","chatlistInvites","chatlistJoined","recommendedChannels","savedDialogsPinned","DEFAULT_MAX_MESSAGE_LENGTH","ONE_TIME_MEDIA_TTL_SECONDS","PREMIUM_FEATURE_SECTIONS","PREMIUM_BOTTOM_VIDEOS","PREMIUM_LIMITS_ORDER","DEFAULT_GIFT_PROFILE_FILTER_OPTIONS","sortType","shouldIncludeUnlimited","shouldIncludeLimited","shouldIncludeUnique","shouldIncludeDisplayed","shouldIncludeHidden","addActionHandler","actions","initialLocationHash","parseInitialLocationHash","hasTestParam","search","includes","tgWebAuthTest","apiUpdate","userAgent","PLATFORM_ENV","sessionData","loadStoredSession","isWebmSupported","maxBufferSize","MAX_BUFFER_SIZE","webAuthToken","tgWebAuthToken","dcId","tgWebAuthDcId","mockScenario","shouldAllowHttpTransport","settings","byKey","shouldForceHttpTransport","shouldDebugExportedSenders","langCode","isTestServerRequested","shouldCollectDebugLogs","phoneNumber","authIsLoading","authErrorKey","password","file","isFallback","videoTs","bot","tabId","updateManagementProgress","ManagementProgress","InProgress","setGlobal","Complete","loadFullUser","firstName","lastName","authIsLoadingQrCode","passcode","isScreenLocked","storeSession","clearStoredSession","hangUp","leaveGroupCall","resetInitialLocationHash","resetLocationHash","unsubscribe","forceWebsync","reset","forceInitApi","clearEncryptedSession","cacheApi","MAIN_IDB_STORE","PASSCODE_IDB_STORE","langCachePrefix","langCacheVersion","updateAppBadge","initShared","force","byTabId","otherTabId","connectionState","authNearestCountry","deviceToken","subscribedAt","sessionJson","JSON","stringify","globalJson","serializeGlobal","encryptSession","forgetPasscode","updatePasscodeSettings","invalidAttemptsCount","timeoutUntil","clearGlobalForLockScreen","bio","about","updateTabState","profileEdit","progress","ProfileEditProgress","currentUser","updateUser","updateUserFullInfo","shouldUsernameUpdate","find","u","isEditable","withPhotos","avatarPhotoId","profilePhoto","deletePeerPhoto","tabState","selectTabState","Idle","checkedUsername","isUsernameAvailable","loadedWallpapers","wallpapers","createObjectURL","slug","UPLOADING_WALLPAPER_SLUG","mediaType","wallpaper","firstWallpaper","withLocalMedia","blocked","blockedIds","totalCount","isOnlyStories","addBlockedUser","removeBlockedUser","addNotifyExceptions","signUpNotification","notifyDefaults","all","replaceSettings","hasContactJoinedNotifications","peerType","isMuted","shouldShowPreviews","addNotifyException","mutedUntil","oldSettings","hasWebNotifications","hasPushNotifications","subscribe","requestPermission","isSilent","languages","phoneNumberSettings","addByPhoneSettings","lastSeenSettings","profilePhotoSettings","forwardsSettings","chatInviteSettings","phoneCallSettings","phoneP2PSettings","voiceMessagesSettings","bioSettings","birthdaySettings","giftsSettings","privacy","rules","addByPhone","lastSeen","forwards","chatInvite","phoneCall","phoneP2P","voiceMessages","birthday","gifts","privacyKey","visibility","onSuccess","buildApiInputPrivacyRules","allowedIds","allowUserIds","allowChatIds","blockUserIds","blockChatIds","botsPrivacy","isAllowList","updatedIds","isPremiumAllowed","isUnspecified","shouldAllowPremium","isSensitiveEnabled","countryList","timeFormat","toUpperCase","setSettingOption","setTimeFormat","wasTimeFormatSetManually","nearestCountryCode","hash","appConfig","requestActionTimeout","config","timeout","expiresAt","getServerTime","peerColors","generalHash","general","colors","timezones","buildCollectionByKey","globalSettings","shouldArchiveAndMuteNewNonContact","shouldHideReadMarks","shouldNewNonContactPeersRequirePremium","item","updateChat","accessHash","loadFullChat","loadUser","prevUsernames","sortedUsernames","res","currentUsername","findIndex","onUpdateConnectionState","update","multitabNextAction","clearMultitabNextAction","isSynced","channelStackIds","flatMap","tab","messageLists","messageList","isChatSuperGroup","unique","requestChannelDifference","signOut","oldSetLanguage","onUpdateApiReady","wasAuthReady","authState","authorizationState","isLoggingOut","authIsCodeViaApp","isCodeViaApp","authHint","hint","noReset","hasWebAuthTokenPasswordRequired","authQrCode","qrCode","isInactive","onUpdateAuthorizationState","errorKey","onUpdateAuthorizationError","clearWebTokenAuth","hasWebAuthTokenFailed","onUpdateWebAuthTokenFailed","authRememberMe","isEmpty","mainDcId","isTest","isTestServer","saveSession","onUpdateSession","setServerTimeOffset","serverTimeOffset","onUpdateServerTimeOffset","currentUserFullInfo","sessionUserAuth","localStorage","getItem","userAuth","parse","setItem","updateSessionUserId","onUpdateCurrentUser","sync","isFetchingDifference","isFetching","paymentShippingError","getShippingError","addPaymentError","shouldClosePaymentModal","closePaymentModal","showDialog","setSystemThemeChangeCallback","theme","shouldUseSystemTheme","forceSyncOnIOs","hasPasscode","decryptSessionByCurrentHash","session","hasStoredSession","setupCaching","startWebsync","destroyConnection","stopWebsync","clearCaching","onSomeTabSwitchedMultitabRole","selectSettingsKeys","events","subscribeAfterUserGesture","removeEventListener","once","addCallback","isUpdated","shouldInit","messageTextSize","globalTheme","selectTheme","systemTheme","getSystemTheme","performanceType","selectPerformanceSettings","setProperty","floor","setAttribute","applyPerformanceSettings","IS_MAC_OS","IS_WINDOWS","IS_LINUX","canAnimate","switchTheme","canInstall","uiReadyState","remove","authPhoneNumber","shouldSkipHistoryAnimations","prevGlobal","updatePageTitle","updateShouldDebugExportedSenders","updateShouldEnableDebugLog","oldGlobal","prevSettings","prevPerformance","prevPeerColors","updatePeerColors","withAnimation","hasFocus","canDisplayChatInTitle","initDebugConsole","disableDebugConsole","replaceThemeSettings","screen","foldersAction","nextSettingsScreen","nextFoldersAction","folderId","isOnlyInvites","chatFolder","selectChatFolder","requestNextSettingsScreen","SettingsScreens","FoldersEditFolderInvites","FoldersEditFolderFromChatList","noRequestNextScreen","isChatList","shareFolderScreen","isFromSettings","openEditChatFolder","updateCacheThrottled","onFullyIdle","updateCache","updateCacheForced","unsubscribeFromBeforeUnload","isCaching","isRemovingCache","cacheGlobal","cacheIsScreenLocked","initCache","resetCache","del","removeItem","loadCache","initialState","cache","time","cachedFromLocalStorage","cached","timeEnd","migrateCache","readCache","onBeforeUnload","removeCallback","untypedCached","themes","chatFolders","animationLevel","INITIAL_PERFORMANCE_STATE_MIN","INITIAL_PERFORMANCE_STATE_MID","limits","similarChannelsById","similarBotsById","lastMessageIds","darkPeerColors","fileUploads","byMessageKey","reactions","quickReplies","previewMediaByBotId","loadingParameters","topBotApps","defaultTags","commonChatsById","botAppPermissionsById","topicsInfoById","messages","pollById","botVerificationShownPeerIds","peers","cacheVersion","listIds","playbackByChatId","dark","patternColor","light","notifyExceptionById","unsafeMigrateCache","forceUpdateCache","noEncrypt","serializedGlobal","reduceGlobal","availableReactions","INITIAL_GLOBAL_STATE","pick","lastIsChatInfoShown","getIsMobile","reduceCustomEmojis","reduceUsers","reduceChats","reduceMessages","reduceSettings","reduceChatFolders","groupCalls","reduceGroupCalls","lastRendered","idsToSave","forEmoji","added","statusRecent","statusesById","fullInfoById","currentChatIds","selectCurrentMessageList","isUserId","visibleUserIds","selectVisibleUsers","chatStoriesUserIds","selectChatMessages","webPage","attachBotIds","attachMenu","bots","topPeers","recentlyFoundChatIds","getOrderedIds","contactList","pickTruthy","messagesChatIds","viewportIds","selectViewportIds","replyPeer","replyInfo","isFullyLoaded","saved","byChatId","forumPanelChatIds","forumPanelChatId","chatIdsToSave","openedChatThreadIds","acc","tabChatId","pollIdsToSave","chatLastMessageId","selectChatLastMessageId","openedThreadIds","commentThreadIds","threadsById","threadInfo","isCommentsInfo","originMessageId","threadIds","concat","threadsToSave","viewportIdsToSave","thread","lastViewportIds","topics","selectTopics","topicLastMessageIds","lastMessageId","savedLastMessageIds","lastMessageIdsToSave","listedIds","pinnedIds","typingStatus","cleanedById","cleanedMessage","blobUrl","isPreloadedGlobally","previousLocalId","omitLocalMedia","results","reaction","localAmount","omitLocalPaidReactions","sponsoredByChatId","miniAppsCachedPosition","miniAppsCachedSize","activeGroupCallId","getBotCoverMediaHash","convertToApiChatType","getWebAppKey","webApp","requestUrl","appName","botId","isSystemBot","FOREVER_BANNED_DATE","entityId","isPeerChat","isPeerUser","toChannelId","mtpId","padStart","isChatGroup","isChatBasicGroup","isCommonBoxChat","isChatWithRepliesBot","isChatWithVerificationCodesBot","isAnonymousForwardsChat","getChatTypeString","getPrivateChatUserId","getChatTitle","isSelf","getChatLink","activeUsername","getMainUsername","getChatAvatarHash","owner","isChatAdmin","adminRights","isCreator","getHasAdminRight","getCanManageTopic","isOwner","isUserRightBanned","chatFullInfo","unrestrictedByBoosts","boostsToUnrestrict","boostsApplied","currentUserBannedRights","defaultBannedRights","getCanPostInChat","isMessageThread","isForum","isNotJoined","isRestricted","isForbidden","migratedTo","getAllowedAttachmentOptions","isChatWithBot","isStoryReply","canAttachMedia","canAttachPolls","canSendStickers","canSendGifs","canAttachEmbedLinks","canSendPhotos","canSendVideos","canSendRoundVideos","canSendAudios","canSendVoices","canSendPlainText","canSendDocuments","isAdmin","getMessageSendingRestrictionReason","sendMessages","untilDate","formatDateToString","formatTime","getForumComposerPlaceholder","isReplying","isChatArchived","getCanDeleteChat","getFolderDescriptionText","folder","chatsCount","excludedChatIds","includedChatIds","groups","contacts","nonContacts","getMessageSenderName","getUserFirstOrLastName","isChatPublic","getOrderedTopics","pinnedOrder","shouldSortByLastMessage","sort","a","pinned","isPinned","ordered","hidden","getCleanPeerId","abs","getIsSavedDialog","getGroupStatus","chatTypeString","membersCount","getCustomPeerFromInvite","invite","isVerified","isFake","isScam","isCustomPeer","fakeType","getMockPreparedMessageFromResult","preparedMessage","inlineButtons","sendMessage","replyMarkup","viaBotId","getMessageRecentReaction","recentReactions","checkIfHasUnreadReactions","isUnread","isOwn","areReactionsEmpty","getReactionKey","isSameReaction","first","second","canSendReaction","chatReactions","areCustomAllowed","allowed","sortReactions","topReactions","right","reactionOne","reactionTwo","indexOne","indexTwo","Infinity","getUserReactions","isReactionChosen","chosenOrder","updateReactionCount","reactionCount","newReactions","existingIndex","addPaidReaction","localIsPrivate","localPeerId","localPreviousChosenOrder","STORY_ALT_VIDEO_WIDTH","getStoryMediaHash","isAlt","altVideos","curr","getVideoMediaHash","getPhotoMediaHash","getStoryKey","storyId","usersById","chatsById","allowedUserIds","allowedChatIds","partition","blockedUserIds","blockedChatIds","allowedUsers","allowedChats","blockedUsers","blockedChats","hasMessageMedia","getMessagePhoto","getMessageVideo","getMessageDocument","getMessageSticker","getMessageContact","getMessageAction","getMessageAudio","getMessageVoice","canEditMedia","otherMedia","getMessageRoundVideo","isDocumentPhoto","innerMediaType","isDocumentVideo","isMessageDocumentSticker","getMessageLocation","getMessageWebPage","getMessagePaidMedia","getMessageWebPagePhoto","getMessageWebPageVideo","getMessageWebPageAudio","getMessageDownloadableMedia","getMessageMediaThumbDataUri","extendedMedia","getMessageMediaThumbnail","dataUri","getMediaThumbUri","getMessageIsSpoiler","invoiceMedia","isSpoiler","buildStaticMapHash","geo","zoom","long","lat","accuracyRadius","getMessageMediaHash","messagePhoto","actionPhoto","getMessageActionPhoto","messageVideo","messageDocument","getMessageWebPageDocument","messageAudio","getDocumentMediaHash","getAudioMediaHash","getVoiceMediaHash","base","hasMediaLocalBlobUrl","getVideoProfilePhotoMediaHash","getProfilePhotoMediaHash","appendProgressiveQueryParameters","getVideoPreviewMediaHash","hasVideoPreview","getAudioHasCover","getWebDocumentHash","webDocument","previewPhotoSizes","getMediaHash","getGamePreviewPhotoHash","getGamePreviewVideoHash","IS_PROGRESSIVE_SUPPORTED","thumbnailSizes","getMediaFormat","hasInnerVideo","isAudio","getMediaFileSize","IS_OPFS_SUPPORTED","DownloadUrl","BlobUrl","Progressive","IS_OPUS_SUPPORTED","getChatMediaMessageIds","isFromSharedMedia","getMessageContentIds","getPhotoFullDimensions","sizes","getMediaTransferState","isLoadNeeded","isUploading","isTransferring","transferProgress","messageIds","contentType","validator","matchLinkInMessageText","getMediaDuration","canReplaceMessageMedia","attachment","isPhotoOrVideo","isFile","fileType","getAttachmentMediaType","isMediaLoadableInViewer","newMessage","getMediaFilename","getIsDownloading","activeDownloads","getTimestampableMedia","SPOILER_CHARS","isExtended","getMessageTextWithSpoilers","transcription","getMessageTranscription","textWithoutTranscription","accText","spoiler","generateBrailleSpoiler","getMediaContentTypeDescription","getSummaryDescription","truncatedText","mediaContent","summary","hasUsedTruncatedText","boughtExtendedMedia","isBought","previewExtendedMedia","isPaidMediaAlbum","isPaidMediaSingleVideo","isPaidMediaSinglePhoto","performer","getMessageAudioCaption","question","description","getMessageHtmlId","getMessageOriginalId","transcriptionId","transcriptions","hasMessageText","getMessageStatefulContent","storyPeerId","stories","byPeerId","getMessageCustomShape","hasOtherFormatting","emojiOnlyCount","getMessageSingleRegularEmoji","getMessageSingleCustomEmoji","getFirstLinkInMessage","firstTextUrl","firstUrl","isOwnMessage","isReplyToMessage","isForwardedMessage","forwardInfo","isServiceNotificationMessage","isAnonymousOwnMessage","senderId","titleKey","getPeerFullTitle","getUserFullName","getSendingState","sendingState","isMessageLocal","isLocalMessageId","isMessageFailed","isHistoryClearMessage","isGeoLiveExpired","period","isMessageTranslatable","allowOutgoing","isLocal","isServiceNotification","isScheduled","getMessageSingleInlineButton","orderHistoryIds","orderPinnedIds","mergeIdRanges","ranges","idsUpdate","hasIntersection","newOutlyingLists","list","areSortedArraysIntersecting","array","prevArray","splice","contentText","authCode","oldEntities","isExpiredMessage","hasMessageTtl","ttlSeconds","shouldSendAsFile","isUploadingFileSticker","getMessageLink","chatUsername","normalizedId","chatPart","topicPart","messagePart","splitMessagesForForwarding","limit","currentArr","lastGroup","batch","buildChatThreadKey","getIsChatMuted","notifyException","getChatNotifySettings","getIsChatSilent","hasSound","getShouldShowMessagePreview","defaults","getNotificationPeerType","omitUndefined","getStoryReplyInfo","getStickerHashById","stickerId","isPreview","containsCustomEmoji","isDeletedUser","formatPhoneNumber","getUserStatus","userStatus","isSupport","botActiveUsers","wasOnline","getServerTimeOffset","wasOnlineDate","diff","getTime","today","setHours","yesterday","setDate","getDate","formatFullDate","isUserOnline","withSelfOnline","isUserBot","getCanAddContact","isContact","sortUserIds","userStatusesById","priorityIds","orderBy","expires","DAY","getPeerStoryHtmlId","typed","typify","INITIAL_PERFORMANCE_STATE_MAX","animatedEmoji","autoplayGifs","autoplayVideos","contextMenuAnimations","contextMenuBlur","loopAnimatedStickers","mediaViewerAnimations","messageComposerAnimations","messageSendingAnimations","pageTransitions","reactionEffects","rightColumnAnimations","stickerEffects","storyRibbonAnimations","snapEffect","twoFaSettings","isAppUpdateAvailable","isElectronUpdateAvailable","shouldShowContextMenuHint","audioPlayer","lastPlaybackRate","mediaViewer","phoneCodes","profilePhotosById","orderedPinnedIds","active","archived","orderedPeerIds","hasNext","hasNextInArchive","stealthMode","attachmentSettings","shouldCompress","shouldSendGrouped","isInvertedMedia","webPageMediaSize","scheduledMessages","messagesById","invites","recentEmojis","recentCustomEmojis","effectReactions","availableEffectById","stickers","setsById","recent","favorite","greeting","premium","featured","setIds","effect","emojiKeywords","gifs","topInlineBots","activeSessions","byHash","orderedHashes","activeWebSessions","messageSendKeyCombo","canAutoLoadPhotoFromContacts","canAutoLoadPhotoInPrivateChats","canAutoLoadPhotoInGroups","canAutoLoadPhotoInChannels","canAutoLoadVideoFromContacts","canAutoLoadVideoInPrivateChats","canAutoLoadVideoInGroups","canAutoLoadVideoInChannels","canAutoLoadFileFromContacts","canAutoLoadFileInPrivateChats","canAutoLoadFileInGroups","canAutoLoadFileInChannels","autoLoadFileMaxSizeMb","notificationSoundVolume","shouldSuggestStickers","shouldSuggestCustomEmoji","shouldSkipWebAppCloseConfirmation","shouldUpdateStickerSetOrder","isConnectionStatusMinimized","canTranslate","canTranslateChats","doNotTranslate","shouldWarnAboutSvg","isBlurred","serviceNotifications","trustedBotIds","translations","archiveSettings","isMinimized","INITIAL_TAB_STATE","isLeftColumnShown","isChatInfoShown","newChatMembersProgress","NewChatMembersProgress","Closed","gifSearch","stickerSearch","activeChatFolder","tabThreads","inlineBots","byUsername","webApps","openedWebApps","openedOrderedKeys","sessionKeys","modalState","isModalOpen","isMoreAppsTabActive","globalSearch","userSearch","middleSearch","byChatThreadKey","sharedMediaSearch","chatMediaSearch","management","savedGifts","giftsByPeerId","storyViewer","isRibbonShown","volume","playbackRate","isShareMessageModalShown","isWebAppsCloseConfirmationModalOpen","forwardMessages","replyingMessage","pollResults","payment","starsPayment","notifications","dialogs","activeReactions","statistics","pollModal","requestedTranslations","DEFAULT_CHAT_LISTS","replaceChatListIds","newIds","replaceChatListLoadingParameters","nextOffsetId","nextOffsetPeerId","nextOffsetDate","updateChatLastMessageId","listType","updateChatsLastMessageId","addChatListIds","replaceChats","newById","addUnreadMentions","shouldUpdateCount","prevChatUnreadMentions","unreadMentions","updatedUnreadMentions","unreadMentionsCount","removeUnreadMentions","removedCount","chatUpdate","noOmitUnreadReactionCount","withDeepCheck","updateKeys","areDeepEqual","updatedChat","getUpdatedChat","updateChatFullInfo","fullInfoUpdate","currentFullInfo","selectChatFullInfo","updatedFullInfo","replaceChatFullInfo","fullInfo","updateChats","updatedById","addChats","addedById","existingChat","newChat","membersCountChanged","isMin","omitProps","updateChatListType","currentListIds","listTypeKey","currentFolderList","updateChatListSecondaryInfo","info","totalCountKey","totalChatCount","leaveChat","leftChatId","removeChatFromChatLists","joinInfo","addChatMembers","membersToAdd","currentMembers","members","newMemberIds","m","updatedMembers","currentIds","areSortedArraysEqual","adminMembers","adminMembersById","replaceSimilarChannels","similarChannelIds","toggleSimilarChannels","similarChannels","isExpanded","addSimilarBots","similarBotsIds","updateStickerSearch","resultIds","updateStickerSets","category","sets","updatedSets","stickerSet","existing","regularSetIds","updateCustomEmojiSets","addedSetIds","updateStickerSet","stickerSetId","currentStickerSet","isCustomEmoji","isEmoji","addedSets","installedDate","isArchived","customEmojiById","updateGifSearch","isNew","nextOffset","currentResults","newResults","gif","replaceAnimatedEmojis","animatedEmojis","updateStickersForEmoji","remoteStickers","allStickers","selectStickersForEmoji","uniqueIds","updateCustomEmojiForEmoji","localStickers","selectCustomEmojiForEmoji","updateRecentStatusCustomEmojis","rebuildStickersForEmoji","replaceUsers","updateContactList","updatedUsers","contactUserIds","contactUserIdsFromUpdate","userUpdate","updatedUser","getUpdatedUser","updateUsers","addUsers","existingUser","newUser","deleteContact","MEMO_EMPTY_ARRAY","updateUserSearch","searchStatePartial","updateUserSearchFetchingStatus","newState","fetchingStatus","updateUserBlockedState","isBlocked","replaceUserStatuses","userFullInfo","updateUserCommonChats","commonChats","addUserStatuses","closeNewContactDialog","newContact","updateMissingInvitedUsers","missingUsers","inviteViaLinkModal","updateBotAppPermissions","permissions","replacePeerSavedGifts","updateGlobalSearch","updateGlobalSearchContent","currentContent","updateGlobalSearchResults","newFoundMessages","nextOffsetRate","resultsByType","newFoundMessagesById","getSearchResultKey","foundIdsForType","foundIds","every","newId","updateGlobalSearchFetchingStatus","prevFoundIds","newFoundIds","prototype","foundOrPrevFoundIds","updateManagement","newSettings","replaceNotifyExceptions","updateNotifyDefaults","contactId","updateTwoFaSettings","clearPasscodeSettings","withTabState","updatePayment","updateStarsPayment","starPayment","selectStarsPayment","updateShippingOptions","shippingOptions","setRequestInfoId","requestId","setPaymentStep","step","setStripeCardInfo","cardInfo","stripeCredentials","setSmartGlocalCardInfo","smartGlocalCredentials","setConfirmPaymentUrl","confirmPaymentUrl","setReceipt","receipt","clearPayment","clearStarPayment","closeInvoice","isPaymentModalOpen","isExtendedMedia","updateStarsBalance","balance","appendStarsTransactions","transactions","history","newTypeObject","appendStarsSubscriptions","subscriptions","newObject","updateStarsSubscriptionLoading","openStarsTransactionModal","transaction","starsTransactionModal","openStarsTransactionFromReceipt","transactionId","nanos","updateStatistics","updateMessageStatistics","currentMessage","currentStory","updateStoryStatistics","updateStatisticsGraph","updateChannelMonetizationStatistics","monetization","updateVerifyMonetizationModal","monetizationVerificationModal","updatePeer","peerUpdate","updatePeerFullInfo","peerFullInfoUpdate","updatePeerPhotosIsLoading","profilePhotos","selectPeerPhotos","replacePeerPhotos","updatePeerPhotos","newPhotos","shouldInvalidateCache","currentPhotos","fallbackPhoto","personalPhoto","unshift","currentPhotoArray","uniqueByField","photoId","isFromActionMessage","selectUserFullInfo","isAvatar","nextAvatarPhoto","newProfilePhoto","addStories","newStoriesByPeerId","updatedByPeerId","entries","newPeerStories","orderedIds","profileIds","lastUpdatedAt","lastReadId","updateOrderedStoriesPeerIds","addStoriesForPeer","newStories","newPinnedIds","addToArchive","archiveIds","deletedIds","updatedOrderedIds","updatedArchiveIds","updatedProfileIds","isInProfile","expireDate","selectIsChatWithSelf","storyChangelogUserId","peerStories","updatePeerLastUpdatedAt","updatePeerStoriesFullyLoaded","isArchive","updateLastReadStoryForPeer","selectPeerStories","hasUnreadStories","updateLastViewedStoryForPeer","lastViewedId","lastViewedByPeerIds","updatePeersWithStories","storiesByPeerId","hasStories","maxStoryId","updateStoryViews","views","viewModal","newViews","updateStoryViewsLoading","removePeerStory","newOrderedIds","newProfileIds","lastStoryId","previousStoryId","newLastReadId","isDeleted","updateStoriesForPeer","updateSentStoryReaction","reactionsCount","hasReaction","newReactionsCount","updatePeerStory","sentReaction","storyUpdate","updatePeerStoryViews","viewsUpdate","updatePeerProfileStory","updatePeerStoriesHidden","areHidden","areStoriesHidden","updatePeerIds","newOrderedPeerIds","compare","peerIdA","peerIdB","peerA","peerB","diffCurrentUser","compareFields","luaA","orderedA","lriA","hasUnreadA","luaB","orderedB","lriB","hasUnreadB","diffUnread","diffPremium","updateStealthMode","updateTopicsStore","updateListedTopicIds","topicIds","selectTopicsInfo","listedTopicIds","updateTopics","topicsCount","oldTopics","newTopics","topicsById","updateThread","firstMessageId","updateThreadInfo","updateTopic","updatedTopic","deleteTopic","replacePinnedTopicIds","pinnedTopicIds","orderedPinnedTopicIds","getEmojiOnlyCountForMessage","parseEmojiOnlyString","updateCurrentMessageList","shouldReplaceHistory","shouldReplaceLast","newMessageLists","previous","replaceChatMessages","updateMessageStore","threadUpdate","replaceTabThreadParam","paramName","newValue","replaceThreadParam","updateTabThread","addMessages","addedByChatId","messagesByChatId","addChatMessagesById","replaceMessages","updatedByChatId","updateChatMessage","messageUpdate","isMediaUnread","addTimestampEntities","updatedMessage","updateScheduledMessage","selectScheduledMessage","updateScheduledMessages","updateQuickReplyMessage","selectQuickReplyMessage","updateQuickReplyMessages","deleteQuickReplyMessages","deleteChatMessages","updatedThreads","mediaIdsToRemove","threadMessages","clearMessageTranslation","deletedForwardedPosts","isLinkedChannelPost","threadMessageIds","selectThreadInfo","selectListedIds","selectPinnedIds","outlyingLists","selectOutlyingLists","newMessageCount","messagesCount","excludeSortedArray","nonLocalMessageCount","originChatId","mediaHash","cancelMessageMediaDownload","mediaId","removeIdFromSearchResults","newViewportIds","currentMessageList","canDeleteCurrentThread","currentThreadId","fromChatId","fromMessageId","originalPost","deleteChatScheduledMessages","selectChatScheduledMessages","scheduledIds","selectScheduledIds","newScheduledIds","updateListedIds","removeOutlyingList","l","updateOutlyingLists","addViewportId","safeReplaceViewportIds","safeReplacePinnedIds","doNotUpdateLinked","newThreadInfo","linkedUpdate","fromChannelId","updateThreadInfos","originChannelId","updateFocusedMessage","noHighlight","isResizingContainer","scrollTargetPosition","focusedMessage","updateSponsoredMessage","deleteSponsoredMessage","updateFocusDirection","enterMessageSelectMode","selectedMessages","toggleMessageSelection","messageListType","childMessageIds","withShift","oldSelectedMessages","selectMessageIdsByGroupId","selectedMessageIds","newMessageIds","newSelectedMessageIds","selectCurrentMessageIds","prevIndex","currentIndex","to","exitMessageSelectMode","updateThreadUnreadFromForwardedMessage","originMessage","isDeleting","channelPostId","threadInfoOld","addActiveMediaDownload","metadata","mediaHashes","newActiveDownloads","updateUploadByMessageKey","messageKey","updateQuickReplies","quickRepliesUpdate","deleteQuickReply","quickReplyId","updatePoll","pollUpdate","selectPoll","oldResults","isChosen","option","updatedPoll","updatePollVote","recentVoterIds","totalVoters","newRecentVoterIds","newTotalVoters","targetOptionIndex","targetOption","updatedOption","votersCount","replaceMiddleSearch","chatThreadKey","searchParams","rest","updateMiddleSearch","currentSearch","updated","isHashtag","savedTag","resetMiddleSearch","replaceMiddleSearchResults","fetchingQuery","updateMiddleSearchResults","prevQuery","query","closeMiddleSearch","replaceSharedMediaSearch","updateSharedMediaSearchType","currentType","updateSharedMediaSearchResults","replaceSharedMediaSearchResults","mergeWithChatMediaSearchSegment","loadingState","segment","mergedFoundIds","mergedLoadingState","areAllItemsLoadedForwards","areAllItemsLoadedBackwards","updateChatMediaSearchResults","currentSegment","segments","mergeChatMediaSearchSegments","replaceChatMediaSearch","replaceChatMediaSearchResults","removeIdFromSegment","foundId","selectChatMediaSearch","updatedSearchParams","removeIdsFromChatMediaSearchParams","updateChatMediaLoadingState","resetForwardsLoadingStateInParams","initializeChatMediaSearchResults","setChatMediaSearchLoading","tabStatePartial","updateMessageTranslation","toLanguageCode","translation","translatedMessages","selectMessageTranslations","byLangCode","chatTranslations","newByLangCode","newTranslatedMessages","updateMessageTranslations","isPending","updateRequestedChatTranslation","toLanguage","updateRequestedMessageTranslation","manualMessages","removeRequestedMessageTranslation","newManualMessages","selectPeerFullInfo","selectChatListLoadingParameters","selectIsChatWithBot","selectChatUser","selectSupportChat","selectChatOnlineCount","onlineCount","selectIsTrustedBot","selectChatType","selectBot","selectIsChatBotNotStarted","lastMessage","selectChatLastMessage","selectAreActiveChatsLoaded","selectIsChatListed","targetList","selectChatListType","selectIsChatPinned","chatFoldersById","pinnedChatIds","selectChatByUsername","usernameLowered","selectIsServiceChatReady","selectSendAs","sendAsId","selectRequestedDraft","requestedDraft","files","selectRequestedDraftFiles","filterChatIdsByType","chatIds","selectCanInviteToChat","isJoinRequest","selectCanShareFolder","excludeArchived","excludeMuted","excludeRead","selectShouldDetectChatLanguage","isPremium","selectIsCurrentUserPremium","IS_TRANSLATION_SUPPORTED","selectCanTranslateChat","selectRequestedChatTranslationLanguage","isLanguageDetectable","detectedLanguage","selectSimilarChannelIds","selectSimilarBotsIds","realChatId","selectManagement","selectCurrentManagementType","selectCanManage","canAddContact","isBot","selectStatistics","selectIsMediaViewerOpen","isAvatarView","standaloneMedia","isSponsoredMessage","selectRightColumnContentKey","editTopicPanel","RightColumnContent","EditTopic","createTopicPanel","CreateTopic","PollResults","currentManagement","selectCurrentManagement","Management","isStatisticsShown","currentMessageId","MessageStatistics","currentStoryId","StoryStatistics","currentChatId","canViewStatistics","selectIsStatisticsShown","Statistics","boostStatistics","BoostStatistics","monetizationStatistics","MonetizationStatistics","StickerSearch","GifSearch","AddingMembers","ChatInfo","selectIsRightColumnShown","selectIsForumPanelOpen","isClosing","selectIsForumPanelClosed","selectIsReactionPickerOpen","reactionPicker","selectPerformanceSettingsValue","selectCanAutoPlayMedia","canAutoPlayVideos","canAutoPlayGifs","asGif","selectShouldLoopStickers","selectIsContextMenuTranslucent","selectIsSynced","selectCanAnimateSnapEffect","IS_SNAP_EFFECT_SUPPORTED","selectWebApp","selectActiveWebApp","activeWebAppKey","selectCurrentGlobalSearchQuery","selectPaymentInputInvoice","inputInvoice","selectPaymentRequestId","selectProviderPublishableKey","form","nativeParams","publishableKey","selectProviderPublicToken","publicToken","selectStripeCredentials","selectSmartGlocalCredentials","selectCanUseGiftProfileAdminFilter","selectCanUseGiftProfileFilter","selectGiftProfileFilter","selectNotifyDefaults","selectNotifyException","selectLanguageCode","selectCanSetPasscode","selectTranslationLanguage","translationLanguage","selectNewNoncontactPeersRequirePremium","selectShouldHideReadMarks","selectCurrentChat","selectTabThreadParam","selectThreadParam","selectThread","messageInfo","selectOutlyingListByMessageId","selectScrollOffset","selectLastScrollOffset","selectEditingId","selectEditingDraft","selectEditingScheduledId","selectEditingScheduledDraft","selectDraft","selectNoWebPage","selectFirstMessageId","selectReplyStack","selectThreadMessagesCount","selectThreadByMessage","selectIsMessageInCurrentMessageList","selectIsViewportNewest","isSavedDialog","chatMessages","selectEditingMessage","selectFocusedMessageId","focusedChatId","selectIsMessageFocused","focusedId","selectIsMessageUnread","lastReadOutboxMessageId","selectOutgoingStatus","isScheduledList","areProfilesShown","getSendersFromSelectedMessages","selectSenderFromMessage","selectSenderFromHeader","header","selectForwardedSender","isChannelPost","hiddenUserName","savedFromPeerId","selectTopicFromMessage","MAX_MESSAGES_TO_DELETE_OWNER_TOPIC","selectCanDeleteTopic","selectCanDeleteOwnerTopic","selectSavedDialogIdFromMessage","savedPeerId","savedDialogId","replyToTopId","isForumTopic","selectCanReplyToMessage","messageTopic","selectCanForwardMessage","hasTtl","isChatProtected","selectIsChatProtected","isStoryForwardForbidden","noForwards","isForwardingAllowed","selectAllowedMessageActionsSlow","isPrivate","isChatWithSelf","isBasicGroup","isSuperGroup","isBotChat","isFailed","isForwarded","isDocumentSticker","isBoostMessage","hasChatPinPermission","hasPinPermission","isMessageEditable","editTimeLimit","canReply","canReplyGlobally","canPin","canUnpin","pinnedMessageIds","canNotDeleteBoostMessage","canDelete","canReport","canDeleteForAll","hasMessageEditRight","canEdit","hasSticker","hasFavoriteSticker","selectIsStickerFavorite","canFaveSticker","canUnfaveSticker","canCopy","canCopyLink","canSelect","canDownload","canSaveGif","canRevote","closed","quiz","canClosePoll","noOptions","ability","selectCanDeleteSelectedMessages","messageIdList","messageActions","selectCanDeleteMessages","selectCanReportSelectedMessages","selectCanDownloadSelectedMessages","selectActiveDownloads","selectUploadProgress","getMessageKey","selectRealLastReadId","lastReadInboxMessageId","unreadCount","selectFirstUnreadId","lastReadServiceNotificationId","notification","findAfterLastReadId","isFromScheduled","found","selectIsForwardModalOpen","selectCommonBoxChatId","fromLastMessage","selectIsInSelectMode","selectIsMessageSelected","selectForwardedMessageIdsByGroupId","selectIsDocumentGroupSelected","selectedIds","groupIds","selectSelectedMessagesCount","selectNewestMessageWithBotKeyboardButtons","findLast","keyboardButtons","shouldHideKeyboardButtons","isKeyboardSelective","isMentioned","replyToMessageId","selectShouldDisplayReplyKeyboard","replyHideMessageId","isHideKeyboardSelective","selectShouldHideReplyKeyboard","selectCanAutoLoadMedia","isPhoto","canAutoLoadMedia","canAutoLoadMediaFromContacts","canAutoLoadMediaInPrivateChats","canAutoLoadMediaInGroups","canAutoLoadMediaInChannels","isMediaFromContact","selectLastServiceNotification","maxId","selectIsMessageProtected","selectHasProtectedMessage","selectCanForwardMessages","selectSponsoredMessage","selectDefaultReaction","defaultReaction","enabledReactions","selectMaxUserReactions","maxUserReactionsPremium","maxUserReactionsDefault","selectShouldSchedule","selectCanScheduleUntilOnline","chatBot","selectUserStatus","selectMessageCustomEmojiSets","selectCustomEmojis","doc","s","selectForwardsContainVoiceMessages","selectChatTranslations","selectRequestedMessageTranslationLanguage","requestedInChat","selectReplyCanBeSentToChat","toChatId","fromRealChatId","selectForwardsCanBeSentToChat","isDocument","isSticker","isPlainText","сheckMessageSendingDenied","selectCanTranslateMessage","isTranslationEnabled","canTranslateLanguage","isTranslatable","chatRequestedLanguage","selectTopicLink","selectMessageReplyInfo","additionalReplyInfo","isMainThread","selectReplyMessage","selectMessageTimestampableDuration","noReplies","timestampableMedia","replyTimestampableMedia","selectMessageLastPlaybackTimestamp","selectCurrentMiddleSearch","selectCurrentSharedMediaSearch","selectCurrentChatMediaSearch","selectCanGift","areStarGiftsAvailable","selectPeerSavedGifts","selectCurrentViewedStory","selectIsStoryViewerOpen","selectPinnedStories","selectPeerFirstUnreadStoryId","lastReadIndex","selectPeerFirstStoryId","selectStoryListForViewer","isSingleStory","isSinglePeer","peerIds","storyIdsByPeerId","storyIds","getPeerStoryIdsForViewer","currentPeerId","storySourceProp","MONTH_EMOTICON","STAR_EMOTICON","selectCurrentStickerSearch","selectCurrentGifSearch","selectStickerSet","stickersForEmoji","packs","cleanEmoji","isCurrentUserPremium","addedCustomSets","customEmojiForEmoji","isFree","selectCustomEmojiForEmojis","selectIsSetPremium","selectAnimatedEmoji","cleanedEmoji","selectRestrictedEmoji","restrictedEmoji","selectAnimatedEmojiEffect","animatedEmojiEffects","selectAnimatedEmojiSound","emojiSounds","defaultEmojiStatusesStickerSetId","selectGiftStickerForDuration","premiumGifts","selectGiftStickerForStars","starCount","selectUserCommonChats","selectIsUserBlocked","selectIsPremiumPurchaseBlocked","isPremiumPurchaseBlocked","selectIsGiveawayGiftsPurchaseAvailable","isGiveawayGiftsPurchaseAvailable","selectUserByPhoneNumber","phoneNumberCleaned","selectBotAppPermissions","hasActiveTransition","hasActiveViewTransition","useViewTransition","domUpdaterFn","transitionState","setTransitionState","startViewTransition","requestNextMutation","finished","ready","shouldApplyVtn","IS_VIEW_TRANSITION_SUPPORTED","useSelector","selector","selectorSignal","useSelectorSignal","bySelector","setter","state","getter","createSignal","clientsCount","state2","WINDOW_RESIZE_LINE_RECALC_DEBOUNCE","maxLinesBeforeCollapse","cutoutRef","isDisabled","isFirstRenderRef","cutoutHeightRef","setIsCollapsible","maxHeight","recalculateTextLines","totalLines","calcTextLineHeightAndCount","debouncedRecalcTextLines","useDebouncedCallback","SVG_MAP","SvgColorFilter","constructor","_defineProperty","this","filterId","addSvgDefinition","xmlns","getFilterId","referenceCount","removeReference","removeSvgDefinition","isUsed","asValue","prepareStyle","UPDATE_DEBOUNCE","DEBOUNCE","property","setValue","updateValue","computedValue","getPropertyValue","removeProperty","handleTransitionEnd","propertyName","useStyleObserver","prepareHexColor","mediaQueryCache","callbacks","createCallbackManager","isTablet","isLandscape","getIsTablet","getIsWebAppsFullscreenSupported","handleMediaQueryChange","updateSizes","runCallbacks","isDesktop","mobileQuery","tabletQuery","landscapeQuery","isTouchScreenQuery","initMediaQueryCache","fn","deps","defaultValue","setIsLoading","setError","setResult","wasCancelled","noInitiallyBuffered","setIsBuffered","isReady","setIsReady","bufferedProgress","setBufferedProgress","bufferedRanges","setBufferedRanges","setIsBufferedDebounced","handleBuffering","isSafariPatchInProgress","buffered","start","end","getTimeRanges","bufferedLength","currentRanges","readyState","onPLay","onLoadedData","onLoadStart","onPause","onProgress","checkBuffering","THROTTLE_MS","setX","setY","recalculate","targetBounds","canvasBounds","throttledRecalculate","useCurrentOrPrev","shouldSkipUndefined","shouldForceCurrent","ms","noFirst","noLast","fnMemo","resolverOrDependency","dependencies","isAsync","resolver","getValue","resolverRef","runCurrentResolver","currentResolver","useSignalEffect","resolverOrSignal","valueRef","isSync","cb","debugKey","prevDepsRef","prevDeps","isDragging","screenX","screenY","distance","handleMousedown","handleDrag","buttons","sqrt","handleDoubleClick","electron","setTrigger","startCallbacks","endCallbacks","onEnd","lastOnStart","lastOnEnd","afterHeavyAnimation","isScheduledRef","PATH_BASE","pathname","historyUniqueSessionId","historyState","historyCursor","isAlteringHistory","deferredHistoryOperations","deferredPopstateOperations","isSafariGestureAnimation","handleTouchEnd","applyDeferredHistoryOperations","goOperations","op","stateOperations","goCount","delta","processStateOperations","deferHistoryOperation","historyOperation","resetHistory","back","replaceState","cleanupClosed","alreadyClosedCount","countClosed","cleanupTrashedState","isAnimationDisabled","disableHistoryAnimations","shouldResetUrlHash","lastOnBack","indexRef","wasReplaced","pushState","forceReplace","shouldReplace","previousRecord","markReplaced","processBack","useEffectOnce","prevIsActive","TEST_getHistoryState","TEST_getHistoryCursor","touches","pageX","innerWidth","previousUniqueSessionId","useIntersectionObserver","rootRef","throttleMs","throttleScheduler","debounceMs","shouldSkipFirst","margin","threshold","rootCallback","controllerRef","rootCallbackRef","freezeFlagsRef","onUnfreezeRef","freeze","unfreeze","observer","disconnect","destroy","observe","targetCallback","entriesAccumulator","observerCallback","observerCallbackSync","callbackManager","throttleWith","IntersectionObserver","rootMargin","hasCallbacks","initController","controller","unobserve","useOnIntersect","targetRef","lastCallback","isIntersecting","setIsIntersecting","onSelectWithEnter","itemSelector","noCaptureFocus","focusedIndex","setFocusedIndex","querySelectorAll","newIndex","addLocalizationCallback","getTranslationFn","mediaFormat","delay","mediaData","spentTime","isMediaReady","noMountTransition","useShowTransitionDeprecated","useModuleLoader","bundleName","moduleName","autoUpdate","module","getModuleFromMemory","addLoadListener","loadModule","langProvider","next","dispatchPriorityPlaybackEvent","clearTimeout","elementObserverMap","onResize","onResizeRef","ResizeObserver","refOrElement","onIntersectionChange","onIntersectionChangeLast","flush","offsetParent","useLayoutEffectWithPrevDeps","CLOSE_DURATION","closeDuration","prefix","shouldForceOpen","closingTimeoutRef","getState","setState","onCloseEndLast","useSyncEffectWithPrevDeps","applyClassNames","shouldRender","hasOpenClass","withShouldRender","getIsClosing","useDerivedSignal","onCloseTransitionEnd","noFirstOpenTransition","setIsClosed","closeTimeoutRef","hasOpenClassName","setHasOpenClassName","exec","shouldHaveOpenClassName","hasShownClass","isFirstRun","dependency","isSignal","cleanupEffect","cleanupRef","msOrSchedulerFn","uri","idRef","videoRef","handlers","handlersRef","videoEl","handlers2","resolveEventType","unloadVideo","BACKDROP_CLASSNAME","ignoreRightClick","excludedClosestSelector","handleEvent","closest","blurCallbacks","focusCallbacks","isFocused","lastOnBlur","lastOnFocus","createListener","devicePixelRatio","setDpr","THROTTLE","initialWidth","initialHeight","setWidth","setHeight","isResizing","setIsResizing","setIsResizingDebounced","throttledSetIsResizing","throttledSetSize","newWidth","newHeight","pendingMeasureTasks","pendingMutationTasks","pendingForceReflowTasks","runUpdatePassOnRaf","currentMeasureTasks","task","safeExec","setPhase","currentMutationTasks","pendingForceReflowMutationTasks","mutationTask","throttledFn","fastRaf","Element","methods","VisualViewport","Document","HTMLInputElement","MouseEvent","Range","onError","nativeMethods","phase","isStrict","newPhase","enableStrict","LAYOUT_CAUSES","causes","nativeGetter","getOwnPropertyDescriptor","defineProperty","onMeasure","call","method","nativeMethod","apply","MutationObserver","mutations","attributeName","forcedMutationAllowedFor","contentEditable","childList","attributes","subtree","characterData","disableStrict","forceMeasure","forceMutation","propName","RLottie","NON_BUBBLEABLE_EVENTS","documentEventCounters","delegationRegistryByEventType","delegatedEventTypesByElement","handler","asCapture","eventType","canUseEventDelegation","resolveDelegationRegistry","newSet","resolveDelegatedEventTypes","addDelegatedListener","removeDelegatedListener","tagName","realEventType","removeAllDelegatedListeners","eventTypes","realEvent","furtherCallsPrevented","Proxy","p","Reflect","parentNode","documentListenersCount","delegatedHandlersCount1","counter","delegationRegistriesCount","delegatedHandlersCount2","delegationRegistry","delegationElementsCount","delegatedEventTypesCount","AUTO_END_TIMEOUT","counterBlocking","getIsAnimating","setIsAnimating","getIsBlockingAnimating","setIsBlockingAnimating","isBlocking","hasEnded","onIdle","throttleWithFullyIdle","HTML_NAMESPACE","FILTERED_ATTRIBUTES","HTML_ATTRIBUTES","CONTROLLABLE_TAGS","MAPPED_ATTRIBUTES","autoCapitalize","autoCorrect","spellCheck","INDEX_KEY_PREFIX","headsByElement","WeakMap","extraClasses","extraStyles","renderWithVirtual","parentEl","$current","$new","$parent","currentContext","skipComponentUpdate","fragment","nextSibling","namespace","isCurrentComponent","VirtualType","Component","isNewComponent","$newAsReal","isCurrentFragment","isNewFragment","Tag","hasElementChanged","componentInstance","renderComponent","updateComponent","mountState","MountState","Mounted","setupComponentUpdateListener","newTarget","initComponent","mountChildren","Text","firstChild","createNode","insertBefore","setElementRef","textContent","remount","getNextSibling","renderChildren","forceMoveToEnd","$currentAsReal","$newAsTag","processControlled","currentEntries","newEntries","currentValue","removeAttribute","updateAttributes","$element","Unmounted","mountComponent","$child","$renderedChild","Empty","createTextNode","createElementNS","hasOwnProperty","defaultChecked","processUncontrolledOnMount","componentNextSibling","isComponent","isFragment","unmountComponent","unmountChildren","replaceChild","unmountRealTree","currentEl","child","DEBUG_checkKeyUniqueness","currentChildren","newChildren","newKeys","$newChild","isParentElement","currentRemainingIndex","remainingByKey","$currentChild","isKeyPresent","newChildKey","orderKey","fragmentIndex","fragmentSize","currentPreservedIndex","currentChildInfo","renderFragment","newOrderKey","shouldMoveNode","isMovingDown","renderFastListChildren","currentChildrenLength","newChildrenLength","createDocumentFragment","lastCurrentChild","fragmentNextSibling","isValueControlled","isCheckedControlled","selectionStart","selectionEnd","isCaretAtEnd","setSelectionRange","selectionState","dataset","__teactSelectionState","updateClassName","inputEl","selectionStateJson","updateStyle","__html","htmlElement","extra","extraArray","applyExtraStyles","standardStyles","runImmediateEffects","captureImmediateEffects","$head","KEYS_TO_IGNORE","counters","renderCountersThrottled","loggerEl","clearEl","setupOverlay","halfSecondAgo","maxRenders","maxDuration","lastUpdateAt","factor","incrementOverlayCounter","Symbol","DEBUG_RENDER_THRESHOLD","DEBUG_EFFECT_THRESHOLD","DEBUG_SILENT_RENDERS_FOR","renderingInstance","lastComponentId","buildChildren","buildFragmentElement","buildComponentElement","createComponentInstance","buildTagElement","noEmpty","cleanChildren","isEmptyPlaceholder","dropEmptyTail","buildChildElement","DEBUG_components","TOTAL","DEBUG_memos","DEBUG_MEMOS_CALLS_THRESHOLD","avgRenderTime","calls","hitRate","instancesPendingUpdate","idsToExcludeFromUpdate","pendingEffects","pendingCleanups","pendingLayoutEffects","pendingLayoutCleanups","areImmediateEffectsCaptured","instancesToUpdate","currentCleanups","currentEffects","prepareComponentForFrame","instance","currentElement","forceUpdateComponent","runCapturedImmediateEffects","currentLayoutCleanups","currentLayoutEffects","newRenderedValue","hooks","cursor","effects","memos","refs","componentName","DEBUG_resolveComponentName","rescue","renderedValue","$old","Mounting","byCursor","releaseSignals","hook","schedule","nextValue","helpGc","useEffectBase","isLayout","effectConfig","cleanupsContainer","effectsContainer","effectId","runEffectCleanup","always","runEffect","scheduleEffect","causedBy","prevValue","cleanups","signal","setupSignals","debugHitRateKey","DEBUG_state","instanceKey","misses","msg","logUnequalProps","newCallback","signalRef","TeactMemoWrapper","DEBUG_contentComponentName","DEBUG_currentRandomId","currentGlobal","DEBUG_invalidateGlobalOnTickEnd","actionHandlers","containers","mapStateToProps","ownProps","mappedProps","activateContainer","newMappedProps","handleError","isNaN","DEBUG_componentName","arePropsShallowEqual","DEBUG_updates","updateTime","runCallbacksThrottled","setUntypedGlobal","forceOutdated","DEBUG_randomId","getUntypedGlobal","getUntypedActions","actionQueue","addUntypedActionHandler","handleAction","withUntypedGlobal","activationFn","TeactNContainer","stuckTo","stickTo","vs16RegExp","zeroWidthJoiner","removeVS16s","rawEmoji","LoadMoreDirection","FocusDirection","LeftColumnContent","GlobalSearchContent","MediaViewerOrigin","StoryViewerOrigin","AudioOrigin","ChatCreationProgress","ProfileState","PaymentStep","ManagementScreens","resolved","currentInstance","animateSingle","tick","schedulerFn","cancelSingleAnimation","dumbCb","animate","animateInstantly","timingFunctions","linear","t","easeIn","easeOut","easeInOut","PI","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","animateNumber","timing","t0","t1","applyStyles","css","setAppBadge","value1","value2","type1","isArray1","array1","array2","member1","object1","object2","keys1","key1","currentProps","newProps","currentKeys","currentKeysLength","promisifyRequest","oncomplete","onsuccess","onabort","onerror","createStore","dbName","storeName","indexedDB","open","onupgradeneeded","createObjectStore","dbp","txMode","db","objectStore","defaultGetStoreFunc","defaultGetStore","eachCursor","store","openCursor","continue","IdbStore","customStore","put","setMany","getMany","delMany","getAll","getAllKeys","items","getEntries","getKeys","getValues","updater","load","utf16","input","output","len","RangeError","damp","tmin","tmax","skew","maxint","adapt","numpoints","firsttime","k","decode","preserveCase","case_flags","input_length","n","out","bias","basic","j","ic","oldi","w","digit","lastIndexOf","charCodeAt","cp","domain_array","PROTOCOL_WHITELIST","FALLBACK_PREFIX","parsedUrl","protocol","unicodeDomain","convertPunycode","hostname","decodeURI","hasLatin","hasNonLatin","char","test","elementName","modifiers","baseName","modifier","self","caches","isSupported","isCacheApiSupported","Type","fetch","cacheName","isHtmlAllowed","Request","headers","Blob","blob","shouldRecreate","resolvedType","Json","ArrayBuffer","arrayBuffer","cacheData","Response","captureKeyboardListener","onEsc","SwipeDirection","IOS_SCREEN_EDGE_THRESHOLD","SWIPE_DIRECTION_THRESHOLD","SWIPE_DIRECTION_TOLERANCE","MOVE_THRESHOLD","SWIPE_THRESHOLD_DEFAULT","RELEASE_WHEEL_ZOOM_DELAY","RELEASE_WHEEL_DRAG_DELAY","getDistance","hypot","pageY","getTouchCenter","lastClickTime","lethargy","stability","sensitivity","tolerance","lastUpDeltas","lastDownDeltas","deltasTimestamp","check","lastDelta","originalEvent","wheelDelta","deltaY","detail","isInertia","lastDeltas","lastDeltasOld","lastDeltasNew","oldSum","newSum","oldAverage","newAverage","captureEvents","captureEvent","hasMoved","hasSwiped","isZooming","initialDistance","wheelZoom","initialZoom","initialDragOffset","isDragCanceled","currentWindowSize","initialSwipeAxis","initialTouchCenter","minZoom","maxZoom","onCapture","includedClosestSelector","withNativeDrag","withCursor","onDrag","onMove","onRelease","passive","selectorToPreventScroll","scrollable","overflow","onDoubleClick","centerX","centerY","clamp","newWindowSize","onZoom","endDistance","touchCenter","dragOffsetX","dragOffsetY","zoomFactor","initialCenterX","initialCenterY","currentCenterX","currentCenterY","shouldPreventScroll","onSwipe","xAbs","yAbs","swipeThreshold","axis","currentSwipeAxis","offsets","Left","Right","Up","Down","processSwipe","releaseWheelDrag","releaseWheelZoom","onWheelCapture","onWheel","doubleTapZoom","is","ctrlKey","metaKeyPressed","metaKey","shiftKey","onWheelZoom","isUserEvent","sign","dx","dy","onWheelDrag","withWheelDrag","isNotPassive","keyToHandlerName","Enter","Backspace","Delete","Esc","Escape","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Tab","onEnter","onDelete","onBackspace","onUp","onDown","onLeft","onRight","onTab","captureKeyboardListeners","hasActiveHandlers","handlerName","currentEventHandlers","releaseKeyboardListener","keyHandlers","CLIPBOARD_ITEM_SUPPORTED","clipboard","ClipboardItem","textCopyEl","str","selection","getSelection","rangeToRestore","rangeCount","getRangeAt","select","execCommand","removeAllRanges","addRange","copyHtmlToClipboard","html","write","copyImageToClipboard","imageUrl","ctx","imageEl","Image","onload","img","toBlob","copyBlobToClipboard","copyTextToClipboardFromPromise","getTextPromise","onFailure","copyTextToClipboardFallback","hasGetDataError","rejectGetDataError","clipboardTextItem","pngBlob","fallbackMs","waitForEndEvent","animationName","detailedName","isHandled","handleAnimationEnd","TransitionEvent","AnimationEvent","WEEKDAYS_FULL","MONTHS_FULL_LOWERCASE","month","MIN_SEARCH_YEAR","MAX_DAY_IN_MONTH","MAX_MONTH_IN_YEAR","MILLISECONDS_IN_DAY","isToday","getDayStartAt","getDayStart","datetime","toYearMonth","getFullYear","getMonth","toIsoString","hours","getHours","marker","getMinutes","formatPastTimeShort","alwaysShowTime","weekAgo","weekday","getDay","noYear","formatMonthAndYear","isShort","formatCountdown","secondsLeft","days","getDays","formatMediaDuration","formatCountdownShort","msLeft","ceil","formatLastUpdated","lastUpdated","seconds","formatRelativeTime","lastUpdatedDate","formatTimeDuration","showLast","durationRecords","labels","multiplier","idx","modulus","formatHumanDate","noWeekdays","isUpperFirst","upperFirst","lowerFirst","limitBefore","limitAhead","formatWeekday","day","weekDay","formatMediaDateTime","maxValue","minutes","maxHours","maxMinutes","string","formatVoiceRecordDuration","durationInMs","milliseconds","formatDayToStringWithCache","withCache","dayStartAt","locale","monthFormat","noDay","toLocaleString","year","noSeconds","hour","minute","hourCycle","formatDateAtTime","isValidDate","parseDateString","matchStringDate","matchEuropeStringDate","matchNumberDate","dateParts","monthIndex","timestampPlusDay","TIMESTAMP_RE","apiText","resultText","matchAll","fullMatch","hourStr","minuteStr","secondStr","totalSeconds","getSeconds","overlaps","inserted","parseTimestampDuration","isInteger","MINUTE","HOUR","roundDown","DEBUG_LEVELS","ORIGINAL_FUNCTIONS","DEBUG_LOGS","getDebugLogs","ELIGIBLE_HOSTNAMES","tryParseDeepLink","correctUrl","queryParams","getQueryParams","pathParams","getPathParams","boost","isUsernameValid","isNumber","getHttpDeepLinkType","single","comment","buildPublicMessageLink","commentId","buildPrivateMessageLink","buildShareLink","buildChatFolderLink","buildLoginCodeLink","buildPublicUsernameOrBotLink","startApp","startapp","mode","startAttach","startattach","attach","choose","buildPrivateChannelLink","buildBusinessChatLink","buildChatBoostLink","isPrivateChannel","buildGiftUniqueLink","parseHttpLink","urlToParse","IS_BAD_URL_PARSER","post","bot_id","scope","public_key","nonce","getTgDeepLinkType","publicKey","callbackUrl","buildTelegramPassportLink","callback_url","appname","referrer","buildPremiumReferrerLink","buildPremiumMultigiftLink","parseTgLink","parseDeepLink","isSingle","fromEntries","processDeepLink","parsedLink","openPrivateChannel","parseChooseParameter","startParam","originalParts","resolveBusinessChatLink","openPremiumModal","openGiftRecipientPicker","processBoostParameters","usernameOrId","openUniqueGiftBySlug","checkChatInvite","openChatByPhoneNumber","openStickerSet","joinVoiceChatByLink","openInvoice","openChatWithDraft","checkChatlistInvite","openStoryViewerByUsername","checkGiftCode","openStarsBalanceModal","phone","voicechat","livestream","inviteHash","urlParam","formatShareText","purpose","balanceNeeded","topup","textContainer","scrollHeight","jsxToHtml","jsx","INPUT_WAITING_CUSTOM_EMOJI_IDS","renderCallbacks","loaded","processMessageInputForCustomEmoji","checkInputCustomEmojiLoad","callInputRenderHandlers","getCustomEmojiMediaDataForInput","fetchAndProcess","placeholderSrc","shouldUseStaticFallback","blankSrc","EXCLUDE_EMOJIS","ISO_FLAGS_OFFSET","unifiedToNative","unified","codePoints","fromCodePoint","path","pairs","nativeToUnified","uncompressEmoji","emojiData","categories","emojiRaw","names","native","image","isoToEmoji","iso","codePointAt","EMOJI_EXCEPTIONS","regex","replacement","DETECT_UP_TO","MAX_LENGTH","textWithoutNewlines","countIfEmojiOnly","iterator","ESTABLISH_TIMEOUT","addCallbackTokenDied","runCallbacksTokenDied","collectedTokens","isEstablished","initialEstablishment","masterToken","reestablishToken","isWaitingForMaster","handleMessage","currentPasscodeHash","setPasscodeHash","hasGaveUpMaster","shouldGiveUpMaster","getPasscodeHash","tokenDied","prevLength","establishMultitabRole","shouldReestablishMasterToSelf","reestablishMasterToSelf","signalTokenDead","close","signalPasscodeHash","getAllMultitabTokens","subscribeToTokenDied","initialEstablishmentPromise","isCurrentTabMaster","blobToDataUri","reader","FileReader","readAsDataURL","blobToFile","File","lastModified","preloadVideo","onloadedmetadata","createPosterForVideo","onseeked","videoWidth","videoHeight","fetchBlob","imgToCanvas","validateFiles","fixMovMime","ext","fileBits","super","DEBUG_DURATION_LIMIT","initials","buildInitials","prepared","DEBUG_getFolderManager","updateFolderManagerThrottled","updateFolderManager","inited","updateFolders","orderedIdsByFolderId","getPinnedChatsCount","pinnedCountByFolderId","getChatsCount","chatsCountByFolderId","getUnreadCounters","unreadCountersByFolderId","getAllNotificationsCount","notificationsCount","getOrderKey","isForSaved","chatSummariesById","orderInSaved","orderInAll","addOrderedIdsCallback","addChatsCountCallback","addUnreadCountersCallback","DEBUG_startedAt","isAllFolderChanged","isMainFolderChanged","isArchivedFolderChanged","isSavedFolderChanged","isAllFullyLoadedChanged","isAllFolderFullyLoaded","isArchivedFullyLoadedChanged","isArchivedFolderFullyLoaded","isSavedFolderFullyLoadedChanged","isSavedFolderFullyLoaded","areFoldersChanged","foldersById","areChatsChanged","areSavedLastMessageIdsChanged","lastSavedMessageIds","areAllLastMessageIdsChanged","lastAllMessageIds","areTopicsChanged","areUsersChanged","areNotifyDefaultsChanged","areNotifyExceptionsChanged","notifyExceptions","affectedFolderIds","emptyFolderIds","folderSummariesById","updateFullyLoaded","updateResults","prevAllFolderListIds","allFolderListIds","prevArchivedFolderListIds","archivedFolderListIds","prevSavedFolderListIds","savedFolderListIds","newChatsById","newUsersById","newAllLastMessageIds","newSavedLastMessageIds","newNotifyDefaults","newNotifyExceptions","folderSummaries","newAllFolderListIds","newArchivedFolderListIds","newSavedFolderListIds","newGeneralIds","allIds","newFolderIds","currentSummary","isRemovedFromAll","isRemovedFromSaved","newSummary","chatUnreadCount","chatUnreadMentionsCount","hasUnreadMark","userInfo","shouldHideServiceChat","creationDate","draftDate","lastMessageInSaved","isListedInAll","isListedInSaved","isUserContact","buildChatSummary","chatSummary","folderSummary","isChatInFolder","buildChatFolderIds","currentFolderIds","folderIdsByChatId","deletedFolderIds","currentFolderIdsSet","newFolderIdsSet","currentFolderOrderedIds","chatIdsByFolderId","isOrderedListJustPatched","updateListsForChat","newListIds","currentPinnedIds","allFolderPinnedIds","savedFolderPinnedIds","archivedFolderPinnedIds","changedFolders","buildFolderSummaryFromMainList","newFoldersById","buildFolderSummary","wasUnreadCountersChanged","wasChatsCountChanged","pinnedCount","newPinnedCount","prevOrderedIds","isSavedFolder","sortedPinnedIds","allListIds","sortedNotPinnedIds","chatId1","chatId2","buildFolderOrderedIds","currentOrderedIds","currentPinnedCount","currentChatsCount","newChatsCount","currentUnreadCounters","newUnreadCounters","buildFolderUnreadCounters","newInitials","totalPrice","getCurrencyExp","formatStarsAsIcon","asFont","iconClassName","formatCurrencyAsString","shouldOmitFractions","Intl","NumberFormat","minimumFractionDigits","maximumFractionDigits","format","TOPIC_MAPPING","blue","violet","green","rose","red","getTopicColors","grey","getTopicColorCssVariable","READABLE_ERROR_MESSAGES","CHAT_RESTRICTED","CHAT_SEND_POLL_FORBIDDEN","CHAT_SEND_STICKERS_FORBIDDEN","CHAT_SEND_GIFS_FORBIDDEN","CHAT_SEND_MEDIA_FORBIDDEN","CHAT_LINK_EXISTS","SLOWMODE_WAIT_X","USER_BANNED_IN_CHANNEL","USER_IS_BLOCKED","YOU_BLOCKED_USER","IMAGE_PROCESS_FAILED","MEDIA_EMPTY","MEDIA_GROUPED_INVALID","MEDIA_NEW_INVALID","MESSAGE_NOT_MODIFIED","MEDIA_INVALID","PASSWORD_HASH_INVALID","PHOTO_EXT_INVALID","PHOTO_INVALID_DIMENSIONS","PHOTO_SAVE_FILE_INVALID","MESSAGE_DELETE_FORBIDDEN","MESSAGE_POLL_CLOSED","MESSAGE_EDIT_TIME_EXPIRED","PINNED_DIALOGS_TOO_MUCH","CHANNEL_PRIVATE","MEDIA_CAPTION_TOO_LONG","ADDRESS_STREET_LINE1_INVALID","ADDRESS_STREET_LINE2_INVALID","ADDRESS_CITY_INVALID","ADDRESS_COUNTRY_INVALID","ADDRESS_POSTCODE_INVALID","ADDRESS_STATE_INVALID","REQ_INFO_NAME_INVALID","REQ_INFO_PHONE_INVALID","REQ_INFO_EMAIL_INVALID","LINK_NOT_MODIFIED","MESSAGE_TOO_LONG","SERVICE_WORKER_DISABLED","MESSAGE_TOO_LONG_PLEASE_REMOVE_CHARACTERS","FRESH_RESET_AUTHORISATION_FORBIDDEN","BOTS_TOO_MUCH","BOT_GROUPS_BLOCKED","USERS_TOO_MUCH","USER_CHANNELS_TOO_MUCH","USER_KICKED","USER_NOT_MUTUAL_CONTACT","USER_PRIVACY_RESTRICTED","INVITE_HASH_EMPTY","INVITE_HASH_EXPIRED","INVITE_HASH_INVALID","CHANNELS_TOO_MUCH","USER_ALREADY_PARTICIPANT","SCHEDULE_DATE_INVALID","WALLPAPER_DIMENSIONS_INVALID","ADMINS_TOO_MUCH","ADMIN_RANK_EMOJI_NOT_ALLOWED","ADMIN_RANK_INVALID","FRESH_CHANGE_ADMINS_FORBIDDEN","INPUT_USER_DEACTIVATED","BOT_PRECHECKOUT_TIMEOUT","PROVIDER_ACCOUNT_TIMEOUT","STARGIFT_CONVERT_TOO_OLD","SUBSCRIPTION_ALREADY_ACTIVE","PEERS_LIST_EMPTY","PAID_MEDIA_FORBIDDEN","CHAT_WRITE_FORBIDDEN","CHAT_ADMIN_REQUIRED","SHIPPING_ERRORS","field","FINAL_PAYMENT_ERRORS","getReadableErrorText","isSlowMode","textParams","extraPartIndex","errorMessage","showError","handleErrorEvent","alert","getErrorMessage","throttleError","ErrorEvent","stack","promptInstall","setupBeforeInstallPrompt","prompt","userChoice","outcome","setInstallPrompt","getPromptInstall","collection","member","buildCollectionByCallback","mapValues","newByKey","object","stringKeys","stringKey","orderRule","compareValues","currentOrderRule","isAsc","aValue","bValue","mode1","mode2","orderRule1","orderRule2","isAsc1","isAsc2","isInsideSortedArrayRange","findIntersectionWithSet","toExclude","excludeIndex","chunkSize","pass","fail","arr","cloneDeep","isObject","isLiteralObject","predicate","buildMessageKey","getMessageServerKey","msgId","parseMessageKey","parseSearchResultKey","specialReplacement","parseLine","separatorIndex","isEscaped","isInsideString","FALLBACK_LANG_CODE","FALLBACK_VERSION","FALLBACK_TRANSLATE_URL","LANGPACK_STORE_PREFIX","FORMATTERS_FALLBACK_LANG","TRANSLATION_CACHE","LimitedMap","formatters","langPack","fallbackLangPack","translationFn","createTranslationFn","areCallbacksScheduled","scheduleCallbacks","localizationReady","loadCachedLangData","cacheLangData","notifyLangpackUpdate","fallbackLoadPromise","loadFallbackPack","forLocalScript","fileData","readFileSync","rawStrings","readStrings","strings","clearKey","pluralSuffix","knownValue","version","stringsCount","nativeName","pluralCode","translatedCount","translationsUrl","readFallbackStrings","fallbackData","updateLanguage","fetchDifference","fromVersion","applyLangPackDifference","keysToRemove","newLangPack","updateLangPack","newLang","createFormatters","listFormatFallback","createListFormat","IS_INTL_LIST_FORMAT_SUPPORTED","ListFormat","pluralRules","PluralRules","region","DisplayNames","disjunction","number","initLocalization","canLoadFromServer","cachedData","loadAndChangeLanguage","refreshFromCache","shouldCheckCache","changeLanguage","remoteLanguage","requestLangPackDifference","newLanguage","remoteLangPack","baseLangCode","areAdvancedLangFnOptions","processTranslationAdvanced","processTranslation","with","withRegular","withAdvanced","of","languageInfo","getString","langKey","langPackStringValue","initialStrings","isDeletedLangString","isPluralLangString","other","cacheKey","finalString","valueAsString","isFinite","variableEntries","tempResult","replaceInStringsWithTeact","withMarkdown","renderTextFilters","preparedValue","localizationReadyPromise","isRegularLangString","isLangFnParam","num","isBetween","decimals","lerp","interpolationRatio","roundToNearestEven","SAMPLE_RATE","BIT_DEPTH","oggToWav","opusData","typedArray","Uint8Array","decoderWorker","wavWorker","onmessage","buffers","buffer","page","wavBitDepth","wavSampleRate","decoderSampleRate","outputBufferSampleRate","pages","asCacheApiType","PROGRESSIVE_URL_PREFIX","URL_DOWNLOAD_PREFIX","MAX_MEDIA_RETRIES","memoryCache","fetchPromises","progressCallbacks","cancellableCallbacks","callbackUniqueId","progressiveUrl","getProgressive","getDownloadUrl","fetchFromCacheOrRemote","activeCallbacks","getFromMemory","cancelProgress","parentCallback","getProgressiveUrl","retryNumber","prepareMedia","makeOnProgress","remote","getRetryTimeout","debug","dataBlob","revokeObjectURL","serviceWorker","fullSize","Bundles","LOAD_PROMISES","MEMORY_CACHE","loadBundle","Auth","Extra","Calls","Stars","bundle","EQUAL","DELETE","__delete","DELETE_ALL_CHILDREN","__deleteAllChildren","deepDiff","keys2","subValue1","subValue2","subDiff","deepMerge","oldValue","reduceDiff","MULTITAB_ESTABLISH_TIMEOUT","resolveGlobalPromise","isFirstGlobalResolved","lastBroadcastDiffGlobal","isBroadcastDiffScheduled","subscribeToMultitabBroadcastChannel","appVersion","APP_VERSION","reload","batchedUpdates","localDb","argsWithCallback","refreshLangPackFromCache","requestGlobal","resolveWithoutGlobal","getDeviceToken","subscription","toJSON","endpoint","checkIfPushSupported","IS_SERVICE_WORKER_SUPPORTED","ServiceWorkerRegistration","Notification","permission","checkIfNotificationsSupported","expirationTime","soundPlayedDelay","soundPlayedIds","notificationSound","Audio","playNotifySound","currentVolume","playNotifySoundDebounced","unsubscribeFromPush","deleteDeviceToken","serviceWorkerRegistration","pushManager","getSubscription","isSubscriptionFailed","checkIfOfflinePushFailed","setDeviceToken","updateWebNotificationSettings","checkIfShouldResubscribe","userVisibleOnly","DOMException","ABORT_ERR","NOT_SUPPORTED_ERR","getAvatar","imageHash","notifyAboutCall","vibrate","onclick","notifyAboutMessage","isReaction","isChatMuted","topicMutedUntil","notifySettings","shouldIgnoreMute","shouldNotifyAboutMessage","isListed","checkIfShouldNotify","isChatSilent","areNotificationsSupported","activeReaction","loadCustomEmoji","messageSenderChat","messageSenderUser","isChat","senderName","MessageSummary","getReactionEmoji","getNotificationContent","dispatch","onshow","closeMessageNotifications","notifyClientReady","SUBSTITUTION_REGEX","PLURAL_OPTIONS","PLURAL_RULES","en","ar","be","n10","n100","ca","v0","de","es","fa","fi","fr","it","hr","i10","i100","f10","f100","hu","ko","nb","nl","pl","ru","sk","sr","tr","uk","uz","currentLangCode","currentTimeFormat","createLangFn","cacheValue","importFallbackLangPack","langString","preferredPluralOption","optionIndex","getPluralOption","template","otherValue","translationSlices","initialValue","processTemplate","formatInteger","withFallback","sourceLangPacks","fetchRemote","langInfo","langName","IV_LENGTH","SALT","UnrecoverablePasscodeError","passcodeHash","setupPasscode","sha256","sessionEncrypted","aesEncrypt","globalEncrypted","aesDecrypt","decryptSession","plaintext","crypto","subtle","digest","TextEncoder","encode","asArray","pwHash","iv","getRandomValues","alg","importKey","ptUint8","ctBuffer","encrypt","ct","dataArray","plainBuffer","decrypt","TextDecoder","patchSafariProgressiveAudio","audioEl","patchedForSafari","patchForSafariInProgress","paused","preventPlayAfterPatch","toggle","SEARCH_ENGINE_REGEX","PERMANENT_VERSION_KEY","CLIENT_VERSION","setPermanentWebVersion","switchPermanentWebVersion","clearWebsync","skipLockOnUnload","checkAndAssignPermanentWebVersion","host","currentVersion","getPermanentWebVersion","hasTest","URLSearchParams","shouldRedirect","PATTERN_PLACEHOLDER","DEFAULT_PATTERN","getCountryCodesByIso","phoneCodeList","country","iso2","getCountryFromPhoneNumber","bestMatches","countryCode","prefixes","pattern","numberWithoutCode","patterns","defaultPattern","stripped","getBestPattern","formatPhoneNumberWithCode","numberWithPlus","insertionQueue","keyToRemove","callbackfn","thisArg","toStringTag","replaceWithTeact","searchValue","replaceValue","firstElement","timerId","parsedInitialLocationHash","messageHash","isAlreadyParsed","createLocationHash","displayType","parseLocationHash","isType","createMessageHashUrl","parsedHash","cur","SAFE_EXEC_ENABLED","shouldIgnoreError","getIsVideoPlaying","ended","mediaEl","shouldRunFirst","shouldRunLast","waitingTimeout","interval","_args","setInterval","clearInterval","onTickEnd","waiting","rafPromise","FAST_RAF_TIMEOUT_FALLBACK_MS","fastRafCallbacks","fastRafFallbackCallbacks","fastRafFallbackTimeout","onTickEndCallbacks","withTimeoutFallback","requestAnimationFrame","currentCallbacks","currentTimeoutCallbacks","IDLE_TIMEOUT","onIdleCallbacks","beforeUnloadCallbacks","requestIdleCallback","deadline","timeRemaining","isLast","RE_NOT_LETTER","searchWords","haystack","needle","needleWords","haystackLower","haystackWords","needleWord","haystackWord","prepareSearchWordsForNeedle","_serverTimeOffset","DC_IDS","userAuthJson","dcID","SIGNAL_MARK","obj","unsubscribesByEffect","currentEffect","unsubscribes","unsub","DEFINITION_MAP","defs","appendElement","INERTIA_DURATION","INERTIA_EASING","swipeOffsets","cancelCurrentReleaseAnimation","isSwipeActive","captureControlledSwipe","onSwipeLeftStart","onSwipeRightStart","onCancel","currentSlide","nextSlide","onCancelForTransition","targetPosition","getAnimations","KeyframeEffect","keyframe","getKeyframes","extractPositionFromTransform","extractAnimationEndPosition","currentDirection","animationTimingFunction","initialPositionPx","units","dragOffset","newProgress","updateAnimationProgress","onCancelForClient","isRevertSwipe","cancel","releaseProgress","elements","getTiming","transformRule","isInitialized","HEX_COLOR_REGEX","RGB_VARIABLES","themeColors","hex","lerpRgb","applyColorAnimationStep","startIndex","endIndex","propertyColors","roundedA","themeClassName","isDarkTheme","shouldAnimate","startAt","themeColorTag","uninjectCss","head","injectCss","themeChangeCallback","systemThemeCache","formatFixedNumber","formatIntegerCompact","formatPercent","fractionDigits","phrase","word","FILE_SIZE_UNITS","formatFileSize","GENERAL_VARIABLES","LIGHT_VARIABLES","DARK_VARIABLES","setVariable","lightValueOrGeneral","darkValue","isUpdateScheduled","updateVariables","generalVariables","buildVariables","lightVariables","darkVariables","setPeerColor","darkColors","mainLightColor","mainDarkColor","lightBgColor","darkBgColor","lightBgActiveColor","darkBgActiveColor","lightGradientColors","darkGradientColors","extractCurrentThemeParams","getPropertyHexColor","secondaryTextColor","bgColor","textColor","buttonColor","buttonTextColor","linkColor","hintColor","secondaryBgColor","sectionSeparatorColor","bg_color","text_color","hint_color","link_color","button_color","button_text_color","secondary_bg_color","header_bg_color","accent_text_color","section_bg_color","section_header_text_color","subtitle_text_color","destructive_text_color","section_separator_color","validateHexColor","MIN_USERNAME_LENGTH","MIN_UPDATE_USERNAME_LENGTH","MAX_USERNAME_LENGTH","USERNAME_REGEX","isUpdating","minUsernameLength","WEBSYNC_URLS","WEBSYNC_VERSION","WEBSYNC_KEY","WEBSYNC_TIMEOUT","getTs","lastTimeout","authed","currentTs","canRedirect","script","removeElement","saveSync","maxTouchPoints","getPlatform","IS_MOBILE","IS_YA_BROWSER","IS_FIREFOX","IS_PWA","standalone","IS_APP","IS_VOICE_RECORDING_SUPPORTED","mediaDevices","AudioContext","webkitAudioContext","inlineEl","newEmojiWidth","legacyEmojiWidth","isLastEmojiVersionSupported","chromeVersion","hasBrokenServiceWorkerStreaming","canPlayType","IS_CANVAS_FILTER_SUPPORTED","IS_REQUEST_FULLSCREEN_SUPPORTED","ARE_CALLS_SUPPORTED","LAYERS_ANIMATION_NAME","IS_WAVE_TRANSFORM_SUPPORTED","IS_FLUID_BACKGROUND_SUPPORTED","TEST_VIDEO","ARE_WEBCODECS_SUPPORTED","MASK_IMAGE_DISABLED","storage","getDirectory","directory","removeEntry","recursive","IS_OFFSET_PATH_SUPPORTED","CSS","supports","IS_INSTALL_PROMPT_SUPPORTED","IS_OPEN_IN_NEW_TAB_SUPPORTED","MESSAGE_LIST_SENSITIVE_AREA","IS_GEOLOCATION_SUPPORTED","getGeolocationStatus","permissionStatus","accessRequested","accessGranted","geolocation","getCurrentPosition","handleOrientationChange","visualViewport","pageTop","vh","getIsKeyboardVisible","fnCache","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","__webpack_modules__","__esModule","getPrototypeOf","ns","create","def","getOwnPropertyNames","definition","o","enumerable","chunkId","promises","miniCssF","globalThis","Function","done","needAttach","scripts","getElementsByTagName","getAttribute","charset","nc","onScriptComplete","doneFns","bind","scriptUrl","importScripts","currentScript","installedCssChunks","miniCss","fullhref","existingLinkTags","dataHref","existingStyleTags","findStylesheet","oldTag","linkTag","errorType","realHref","createStylesheet","loadStylesheet","baseURI","installedChunks","installedChunkData","realSrc","webpackJsonpCallback","parentChunkLoadingFunction","chunkIds","moreModules","runtime","chunkLoadingGlobal","handleWorkerMessage","scriptURL","ourRegistrations","getRegistrations","unregister","register","getRegistration","hasErrorKey","intervals","checkStoryExpiration","serverTime","isPublic","previousGlobal","isCurrentMaster","isPreviousMaster","initGlobal","initialTabState","isPlaybackRateActive","isLastPlaybackRateActive","fixedThreadsById","parsedMessageList","actionPayload","isImproved","testAndImprove","frames","lastFrameAt","mean","boosterEl","improveView","STORAGE_KEY","tabKey","AuthCodeAsync","AuthCode","AuthPasswordAsync","AuthPassword","SITE_FONTS","preloadFonts","font","fonts","getSuggestedLanguage","suggestedLanguage","useLangString","fetchLangString","MENU_HIDING_DURATION","getFilteredList","defaultName","CountryCodeInput","inputRef","setFilter","filteredList","setFilteredList","updateFilter","filterValue","prevPhoneCodeList","handleInput","handleInputKeyDown","CodeInput","handleTrigger","formEl","getElementById","scrollTo","behavior","inputValue","MenuItem","isPreloadInitiated","AuthPhoneNumber","setAuthPhoneNumber","setAuthRememberMe","loadNearestCountry","loadCountryList","clearAuthErrorKey","goToAuthQrCode","isConnected","continueText","setCountry","setPhoneNumber","isTouched","setIsTouched","lastSelection","setLastSelection","markIsLoading","unmarkIsLoading","fullNumber","canSubmit","parseFullNumber","newFullNumber","suggestedCountry","selectedCountry","handleLangChange","isJustPastedRef","handlePaste","handleCountryChange","handlePhoneNumberChange","monkeyPath","shouldFixSafariAutoComplete","handleKeepSessionChange","handleGoToAuthQrCode","isAuthReady","onSubmit","qrCodeStylingPromise","returnToAuthPhoneNumber","qrCodeRef","isQrMounted","markQrMounted","unmarkQrMounted","QrCodeStyling","blankUrl","dotsOptions","cornersSquareOptions","imageOptions","imageSize","qrOptions","errorCorrectionLevel","append","habdleReturnToAuthPhoneNumber","AnimatedIcon","AuthRegisterAsync","AuthRegister","handleChangeAuthorizationMethod","useElectronDrag","renderingAuthState","Transition","getActiveKey","AuthQrCode","getScreen","preloadAvatars","avatarHash","preloadTasks","main","spoilerMaskPath","telegramLogoPath","authPassword","lock","lockPreviewPath","inactive","isRightColumnShown","leftColumnWidth","UiLoader","setIsUiReady","markReady","shouldRenderMask","safePreload","appStyles","AppInactive","handleReload","appInactivePath","isLocked","LockScreen","AppScreens","TRANSITION_RENDER_COUNT","INACTIVE_PAGE_TITLE","isInactiveAuth","App","markInactive","unmarkInactive","isMobileOs","dataTransfer","dropzone","dropEffect","handleDrop","auth","renderContent","isCompatTestPassed","restoreLocalStorage","switchMultitabRole","manifest","updateWebmanifest","lastFocusAt","setupInterval","betterView","isPageUnload"],"sourceRoot":""}